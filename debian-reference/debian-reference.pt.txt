Referência Debian

                             Osamu Aoki

Copyright © 2013-2021 Osamu Aoki

    Esta Referência Debian (versão 2.77) (2021-01-10 06:32:51 UTC)
    pretende fornecer uma visão geral do sistema Debian como um guia
    do utilizador pós-instalação. Cobre muitos aspetos da
    administração do sistema através de exemplos shell-command para
    não programadores.

Resumo

Este livro é livre; pode redistribuí-lo e/ou modificá-lo sob os
termos da Licença Pública Geral GNU de qualquer versão compatível com
a Definição Debian de Software Livre (DFSG).

---------------------------------------------------------------------

Esta Referência Debian (version 2.77) (2021-01-10 06:32:51 UTC)
destina-se a fornecer uma visão geral da administração do sistema
Debian como um guia do utilizador pós-instalação.

O leitor alvo é quem está disposto a aprender scripts shell, mas que
não está pronto para ler todas as fontes C para descobrir como o
sistema GNU/Linux funciona.

Para instruções de instalação, veja:

  * Guia de Instalação de Debian GNU/Linux para o sistema atualmente
    stable

  * Guia de Instalação de Debian GNU/Linux para o sistema atualmente
    stable

1. Aviso Legal

    Todas as garantias são recusadas. Todas as marcas registadas são
    propriedade dos respetivos proprietários de marcas registadas
    deles.

    O sistema Debian em si é um alvo em movimento. Isto torna a
    documentação dele difícil de ser atual e correta. Embora a versão
    instável atual do sistema Debian tenha sido usada como base para
    escrever isto, alguns conteúdos podem já estar desatualizados
    quando ler isto.

    Por favor, trate este documento como a referência secundária.
    Este documento não substitui nenhum guia autorizado. O autor e os
    colaboradores não se responsabilizam por consequências de erros,
    omissões ou ambiguidade neste documento.

2. O que é Debian

    O Projeto Debian é uma associação de indivíduos que fizeram causa
    comum para criar um sistema operacional livre. A distribuição
    dele é caracterizada pelo seguinte.

      * Compromisso com a liberdade do software: Contrato Social
        Debian e Definição Debian de Software Livre (DFSG)

      * Esforço distribuído de voluntários não remunerados através da
        Internet: https://www.debian.org

      * Grande quantidade de pacotes de softwares pré-compilados de
        alta qualidade

      * Foco em estabilidade e segurança com acesso fácil a
        atualizações de segurança

      * Foco na atualização tranquila para os pacotes de software
        mais recentes nos arquivos unstable e testing

      * Grande quantidade de arquitecturas de hardware suportadas

    As peças de Software Livre em Debian vêm de GNU, Linux, BSD, X,
    ISC, Apache, Ghostscript, Common Unix Printing System , Samba,
    GNOME, KDE, Mozilla, LibreOffice, Vim, TeX, LaTeX, DocBook, Perl,
    Python, Tcl, Java, Ruby, PHP, Berkeley DB, MariaDB, PostgreSQL,
    SQLite, Exim, Postfix, Mutt, FreeBSD, OpenBSD, Plan 9 e muitos
    mais projectos de software livre independentes. Debian integra
    esta diversidade de Software Livre num sistema.

3. Acerca deste documento

3.1. Regras orientadoras

    Foram seguidas as seguintes regras de orientação ao compilar este
    documento.

      * Dar uma visão geral e saltar casos não comuns. (Imagem Geral)

      * Manter Curto e Simples. (Principio KISS)

      * Não reinventar a roda. (Utilizar apontadores para as
        referências existentes)

      * Foco nas ferramentas não-GUI e consolas. (Utilizar exemplos
        de shell)

      * Ser objetivo. (Utilizar popcon etc.)

    Dica
   
    Tentei elucidar aspectos hierárquicos e níveis mais baixos do
    sistema.

%

3.2. Pré-requisitos

    Atenção

    Espera-se que se esforce a procurar respostas por si próprio e
    para além desta documentação. Este documento apenas oferece
    pontos de arranque eficientes.

    Tem de procurar a solução por si a partir de fontes primárias.

      * O Livro de Mão dos Administradores de Debian

      * O site Debian em https://www.debian.org para informação geral

      * A documentação sob o diretório "/usr/share/doc/
        <nome_do_pacote>"

      * O manual de estilo Unix: "dpkg -L <nome_de_pacote> |grep '/
        man/man.*/'"

      * A página info estilo GNU: "dpkg -L <nome_do_pacote> |grep '/
        info/'"
   
      * Relatórios de bugs http://bugs.debian.org/<package_name>

      * O Debian Wiki em https://wiki.debian.org/ para os tópicos
        específicos e em movimento

      * Os HOWTOs de The Linux Documentation Project (TLDP) em http:/
        /tldp.org/

      * The Single UNIX Specification de Open Group's The UNIX System
        Home Page em http://www.unix.org/

      * A enciclopédia livre Wikipedia em https://www.wikipedia.org/

    Nota

    Para documentação detalhada, pode necessitar instalar o
    correspondente pacote de documentação chamado com o sufixo
    "-doc".

%

3.3. Convenções

    Este documento fornece informação através do seguinte estilo de
    apresentação simplificado com exemplos de comandos de shell bash
    (1).

    # <comando na conta do root>
    $ <comando na conta do utilizador>

    Estas 'prompts' da shell distinguem a conta utilizada e
    correspondem a definir variáveis de ambiente como: "PS1='\$'" e
    "PS2=' '". Estes valores são escolhidos para bem da legibilidade
    deste documento e não são típicos do sistema instalado.

    Nota
   
    Veja o significado das variáveis de ambiente "$PS1" e "$PS2" em 
    bash(1).

    A acção necessária do administrador do sistema é escrita em
    sentido imperativo, p.e. "Carregue na tecla Enter após escrever
    cada string de comando na shell."

    A coluna descrição e semelhantes na tabela podem conter um 
    sintagma nominal seguido da convenção de descrição curta do
    pacote que deixa cair os artigos como "um" e "o". Pode em
    alternativa conter uma frase no infinitivo tal como um sintagma
    nominal sem o antecedente "para" a seguir a convenção de
    descrição curta de comando das 'manpages'. Isto pode parecer
    esquisito para algumas pessoas mas são as minhas escolhas
    intencionais de estilo para manter esta documentação o mais
    simples possível. Estes sintagmas nominais não começam por
    maiúscula nem terminam com ponto final a seguir esta convenção de
    descrição curta.

    Nota
   
    Substantivos próprios incluindo os nomes de comandos mantêm
    maiúscula/minúscula sem respeitarem a sua localização.

    Um bloco de comandos citado num parágrafo de texto é referido
    pelo tipo de letra de dactilografia entre aspas, tal como
    "aptitude safe-upgrade".

    Os dados em texto de um ficheiro de configuração citados num
    parágrafo de texto são referidos em tipo de letra de máquina de
    escrever entre aspas, tal como "deb-src".

    Um comando é referenciado pelo seu nome em tipo de letra de
    máquina de escrever seguido opcionalmente pelo número de secção
    da manpage em parêntesis, tal como bash(1). É encorajado a obter
    informação ao escrever o seguinte.

    $ man 1 bash

    Uma manpage é referida pelo seu nome em tipo de letra de máquina
    de escrever seguido pelo número de secção dele da manpage em
    parêntesis, tal como sources.list(5). É encorajado a obter
    informação ao escrever o seguinte.

    $ man 5 sources.list

    Uma página info é referenciada pelo seu comando em tipo de letra
    de máquina de escrever entre aspas, tal como "info make". É
    encorajado a obter informação ao escrever o seguinte.

    $ info make

    Um nome de ficheiro é referenciado em tipo de letra de máquina de
    escrever entre aspas, tal como "/etc/passwd". Para os ficheiros
    de configuração, é encorajado a obter informação ao escrever o
    seguinte.

    $ sensible-pager "/etc/passwd"

    Um nome de diretório é referenciado em tipo de letra de máquina
    de escrever entre aspas, tal como "/etc/apt/". É encorajado a
    explorar o conteúdo dele ao escrever o seguinte.

    $ mc "/etc/apt/"

    Um nome de pacote é referenciado pelo nome dele em tipo de letra
    de máquina de escrever, tal como vim. É encorajado a obter
    informação ao escrever o seguinte.

    $ dpkg -L vim
    $ apt-cache show vim
    $ aptitude show vim

    Uma documentação pode indicar a localização dela pelo nome de
    ficheiro em tipo de letra de dactilografia entre aspas, tal como
    "/usr/share/doc/base-passwd/users-and-groups.txt.gz" e "/usr/
    share/doc/base-passwd/users-and-groups.html"; ou pelo seu URL,
    tal como https://www.debian.org. É encorajado a ler a
    documentação ao escrever o seguinte.

    $ zcat "/usr/share/doc/base-passwd/users-and-groups.txt.gz" | sensible-pager
    $ sensible-browser "/usr/share/doc/base-passwd/users-and-groups.html"
    $ sensible-browser "https://www.debian.org"

    Uma variável de ambiente é referenciada pelo seu nome com um "$"
    inicial em tipo de letra de máquina de escrever, entre aspas, tal
    como "$TERM". É encorajado a obter o valor atual dele ao escrever
    o seguinte.

    $ echo "$TERM"

%

3.4. popcon

    Os dados popcon são apresentados como a medida objectiva da
    popularidade de cada pacote. Foi descarregado em 2021-01-10
    06:32:17 UTC e contém a submissão total de 197967 relatórios
    sobre 178828 pacotes binários e 26 arquitecturas.

    Nota

    Por favor note que o arquivo amd64 unstable contém atualmente
    apenas 62716 pacotes. Os dados popcon contém relatórios de muitas
    instalações de sistemas antigos.

    O número de popcon precedido de "V:" para "votos" é calculado por
    "1000 * (as submissões popcon para o pacote executado
    recentemente no PC) / (o total de submissões de popcon)".

    O número de popcon precedido de "I:" para "instalações" é
    calculado por "1000 * (as submissões popcon para o pacote
    instalado no PC) / (o total de submissões de popcon)".

    Nota

    As figuras do popcon não devem ser consideradas como medidas
    absolutas da importância dos pacotes. Existem muitos factores que
    podem desviar as estatísticas. Por exemplo, um sistema que
    participa no popcon pode ter diretórios montados como o "/bin"
    com a opção "noatime" para melhoria da performance do sistema e
    efectivamente desativar os "votos" de tal sistema.

%

3.5. O tamanho do pacote

    Os dados de tamanho do pacote são também apresentados como a
    medida objectiva para cada pacote. São baseados no
    "Installed-Size:" reportado pelo comando "apt-cache show" ou pelo
    "aptitude show" (atualmente na amd64 arquitectura para o
    lançamento unstable). O tamanho reportado está em KB (Kilobyte =
    unidade para 1024 bytes).

    Nota

    Um pacote com um tamanho de pacote numericamente pequeno pode
    indicar que o pacote no lançamento unstable é um pacote dummy que
    instala outros pacotes com conteúdos significativos por
    dependência. O pacote dummy activa uma transição suave ou divisão
    do pacote.

    Nota

    Um tamanho de pacote seguido por "(*)" indica que o pacote no
    lançamento unstable está em falta e em vez dele é usado o tamanho
    do pacote para o lançamento experimental.

%

3.6. Relatórios de bugs deste documento

    Se encontrar quaisquer problemas neste documento por favor
    preencha um relatório de bug contra o pacote debian-reference a
    utilizar o reportbug(1) . Por favor inclua sugestões de correção
    com "diff -u" sobre a versão de texto ou código-fonte.

%

4. Memorandos para novos utilizadores

    Aqui estão alguns memorandos para os novos utilizadores:

      * Faça salvaguardas dos seus dados

      * Mantenha a sua palavra-passe e chaves de segurança seguras

      * KISS (keep it simple stupid- manté-lo simples estupido)

          + Não exageres na engenharia do teu sistema

      * Leia os seus ficheiros log

          + O PRIMEIRO erro é aquele que conta

      * RTFM (read the fine manual - leia o manual)

      * Pesquise na Internet antes de fazer perguntas

      * Não seja root quando não precisa de o ser

      * Não brinque com o sistema de gestão de pacotes

      * Não escreve nada que não compreenda

      * Não altere as permissões do ficheiro (antes da revisão de
        segurança completa)

      * Não abandones a shell de root antes de TESTARES as tuas
        alterações

      * Tem sempre uma media de arranque alternativa (caneta USB, CD,
        ...)

%

5. Algumas citações para os novos utilizadores

    Aqui estão algumas citações interessantes da lista de email
    Debian que podem ajudar a elucidar novos utilizadores.

      * "Isto é Unix. Dá-lhe corda suficiente para se enforcar." ---
        Miquel van Smoorenburg <miquels em cistron.nl>
   
      * "Unix É amigo do utilizador... Apenas é selectivo sobre quem
        são os seus amigos." --- Tollef Fog Heen <tollef at add.no>

    A Wikipedia tem o artigo "Unix philosophy" que lista citações
    interessantes.

Capítulo 1. Manuais de GNU/Linux

    Acho que aprender um sistema de computador é como aprender uma
    nova língua estrangeira. Apesar dos livros e documentação darem
    ajuda, tem que praticar também. De modo a ajudá-lo a iniciar
    suavemente, elaborei alguns pontos básicos.

    O design poderoso da Debian GNU/Linux vem do sistema operativo
    Unix, isto é, um sistema operativo multi-utilizador e
    multi-tarefa. Necessita aprender a tirar vantagem do poder destas
    funcionalidades e semelhanças entre Unix e GNU/Linux.

    Não se esconda dos textos orientados ao Unix e não se guie
    somente nos textos de GNU/Linux, por isto rouba-lhe muita
    informação útil.

    Nota

    Se tem usado qualquer sistema de tipo Unix com ferramentas de
    linha de comandos, provavelmente já sabe tudo o que explico aqui.
    Por favor use isto como um teste de realidade e refrescamento.

1.1. Básico da consola

%

1.1.1. A linha de comandos da shell

    Após arrancar o sistema, é-lhe apresentado o ecrã de login
    baseado em caracteres se não instalou o X Window System com um
    gestor de visualização como o gdm3. Suponha que o nome do seu
    host é foo, o aviso de login parece-se com o seguinte.

    foo login:

    Se instalou um ambiente GUI, como o GNOME ou KDE, então pode ir
    para uma prompt de login ao pressionar Ctrl-Alt-F1 e pode
    regressar ao ambiente GUI com Alt-F7 (para mais informação veja
    em baixo Secção 1.1.6, “Consolas virtuais”).

    Na prompt de login, escreva o seu nome de utilizador, p.e.
    penguin e carregue na tecla Enter, depois escreva a sua
    palavra-passe e carregue novamente na tecla Enter.

    Nota

    A seguir a tradição do Unix, o nome de utilizador e palavra-passe
    do sistema Debian são sensíveis a maiúsculas/minúsculas. O nome
    de utilizador é geralmente escolhido apenas em minúsculas. A
    primeira conta de utilizador é normalmente criada durante a
    instalação. Podem ser criadas contas de utilizador adicionais com
    adduser(8) pelo root.

    O sistema inicia com a mensagem de boas vindas armazenada em "/
    etc/motd" (Mensagem do Dia) e apresenta uma prompt de comandos.

    Debian GNU/Linux jessie/sid foo tty1
    foo login: penguin
    Password:
    Last login: Mon Sep 23 19:36:44 JST 2013 on tty3
    Linux snoopy 3.11-1-amd64 #1 SMP Debian 3.11.6-2 (2013-11-01) x86_64

    The programs included with the Debian GNU/Linux system are free software;
    the exact distribution terms for each program are described in the
    individual files in /usr/share/doc/*/copyright.

    Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
    permitted by applicable law.
    foo:~$

    Está agora na shell. A shell interpreta os seus comandos.

%

1.1.2. A linha de comandos shell sob X

    Se instalou o X Window System com um gestor de ecrã como o gdm3
    do GNOME ao selecionar a tarefa "Ambiente de Trabalho" durante a
    instalação, é-lhe apresentado o ecrã de login gráfico após
    arrancar o sistema. Escreva o seu nome de utilizador e a sua
    palavra-passe para iniciar sessão na conta de utilizador
    não-privilegiado. Use a tecla Tab para navegar entre nome de
    utilizador e a palavra-passe ou utilize o rato e o clique
    principal.

    Pode obter uma linha de comandos no X ao iniciar um programa
    x-terminal-emulator tal como o gnome-terminal(1), rxvt(1) ou o 
    xterm(1). No ambiente de trabalho GNOME, clicar em "Aplicações" →
    "Acessórios" → "Consola".

    Pode ver também a secção Secção 1.1.6, “Consolas virtuais” .

    Em alguns Ambientes de Trabalho (como o fluxbox), pode não
    existir um ponto de partida óbvio para o menu. Se isto acontecer,
    tente clicar (botão direito) no fundo do ambiente de trabalho e
    espere que apareça um menu.

%

1.1.3. A conta root

    A conta root também é chamada como de super utilizador ou de
    utilizador privilegiado. A partir desta conta, pode executar as
    seguintes tarefas de administração do sistema:

      * Ler, escrever e remover quaisquer ficheiros no sistema
        independentemente das permissões deles

      * Definir o dono e permissões de quaisquer ficheiros no sistema
   
      * Definir a palavra-passe de quaisquer utilizadores não
        privilegiados do sistema

      * Iniciar sessão (Login) em qualquer conta sem a palavra-passe
        deles

    Este poder ilimitado da conta root requer que você seja atento e
    responsável quando a utilizar.

    Atenção
   
    Nunca partilhe a palavra-passe de root com outros.

    Nota

    As permissões de um ficheiro (incluindo aparelhos de hardware
    como CD-ROM etc. os quais são apenas outros ficheiros para o
    sistema Debian) podem torná-lo não-utilizável ou inacessível para
    utilizadores não-root. Apesar da utilização da conta root ser um
    modo rápido de testar este tipo de situação, a resolução dela
    deve ser feita através da definição correcta das permissões do
    ficheiro e membros dos grupos de utilizadores. (veja
    Secção 1.2.3, “Permissões do sistema de ficheiros”).

%

1.1.4. A linha de comandos shell do root

    Aqui estão alguns métodos básicos de obter o prompt da shell de
    root ao utilizar a palavra-passe do root:

      * Escreva root na prompt de login baseada em caracteres.

      * Clique "Aplicações" → "Acessórios" → "Terminal de Root", no
        ambiente de trabalho GNOME.

      * Escreva "su -l" na prompt da shell de qualquer utilizador.

          + Isto não preserva o ambiente do utilizador atual.

      * Escreva "su" na prompt de shell de qualquer utilizador.

          + Isto preserva algum do ambiente do utilizador atual.

%

1.1.5. GUI de ferramentas de administração do sistema

    Quando o menu do seu ambiente de trabalho não iniciar
    automaticamente as ferramentas GUI de administração do sistema
    com os privilégios apropriados, pode iniciá-las a partir da
    prompt da shell de root do emulador dum terminal X, tal como o 
    gnome-terminal(1), rxvt(1), ou xterm(1). Veja Secção 1.1.4, “A
    linha de comandos shell do root” e Secção 7.8.5, “Correr clientes
    X como root”.

    Atenção
   
    Nunca inicie o gestor de ecrã/sessão X com a conta root ao
    escrever root na prompt do gestor de ecrã/sessão como o gdm3(1).

    Atenção

    Nunca execute programas GUI remotos que não sejam confiáveis no X
    Window quando é mostrada informação critica porque pode "espiar"
    o seu ecrã X.

%

1.1.6. Consolas virtuais

    Por omissão no sistema Debian existem disponíveis seis consolas
    de caracteres alternáveis tipo VT100 para arrancar a shell de
    comandos directamente na máquina Linux. A menos queesteja num
    ambiente GUI, pode mudar entre consolas virtuais ao pressionar
    Left-Alt-key e simultaneamente numa das teclas F1 — F6. Cada
    consola de caracteres permite um login independente à conta e
    oferece um ambiente multi-utilizador. Este ambiente
    multi-utilizador é uma funcionalidade excelente do Unix e muito
    viciante.

    Se está no X Window System, pode ganhar acesso à consola 1 a
    pressionar as teclas Ctrl-Alt-F1, isto é, a tecla-Ctrl-esquerda,
    a tecla-Alt-esquerda e a tecla-F1 pressionadas em conjunto. Pode
    regressar ao X Window System, que normalmente executa na consola
    virtual 7, a pressionar Alt-F7.

    Pode, em alternativa, mudar para outra consola virtual, por
    exemplo á consola 1, a partir da linha de comandos.

    # chvt 1

%

1.1.7. Como abandonar a linha de comandos

    Escreva Ctrl-D, isto é, a tecla-Ctrl-esquerda e a tecla d
    pressionadas ao mesmo tempo, na linha de comandos para fechar a
    atividade da shell. Se estiver na consola de caracteres, com
    isto, retorna ao aviso de login. Mesmo que estes caracteres de
    controle sejam referidos como "control D" com letra maiúscula,
    não precisa de pressionar a tecla Shift. A expressão curta, ^D,
    também é usada para Ctrl-D. Em alternativa pode escrever "exit".

    Se estiver no x-terminal-emulator(1), com isto pode fechar a
    janela do x-terminal-emulator.

%

1.1.8. Como desligar o sistema

    Tal como qualquer outro SO moderno onde operar ficheiros involve
    pôr dados em cache em memória para melhorar a performance, o
    sistema Debian precisa de um processo apropriado de desligar
    antes que a energia possa ser, em segurança, desligada. Isto é
    para manter a integridade dos ficheiros, ao forçar todas as
    alterações em memória a serem escritas no disco. Se estiver
    disponível software de controle de energia, o processo de
    desligar desliga automaticamente a energia do sistema. (Caso
    contrário, pode ter de pressionar o botão de energia por alguns
    segundos após o procedimento de desligar.)

    Pode desligar o sistema sob o modo normal de multi-utilizador a
    partir da linha de comandos.

    # shutdown -h now

    Pode desligar o sistema sob o modo único-utilizador a partir da
    linha de comandos.

    # poweroff -i -f

    Em alternativa, pode pressionar Ctrl-Alt-Delete (A
    tecla-Ctrl-esquerda, a tecla-Alt-esquerda e Delete pressionadas
    ao mesmo tempo) para desligar o sistema se "/etc/inittab"
    contiver "ca:12345:ctrlaltdel:/sbin/shutdown -t1 -a -h now". Veja
    inittab(5) para detalhes.

    Veja a Secção 6.9.6, “Como desligar o sistema remoto em SSH”.

%

1.1.9. Recuperar uma consola sã

    Quando o ecrã fica estranho após fazer coisas estranhas tal como
    "cat <qualquer-ficheiro-binário>", escreva "reset" na linha de
    comandos. Poderá não ver o comando a aparecer quando o escreve.
    Também pode utilizar "clear" para limpar o ecrã.

%

1.1.10. Sugestões de pacotes adicionais para o novato

    Apesar de mesmo uma instalação mínima do sistema Debian sem
    quaisquer tarefas de ambiente de trabalho disponibilizar as
    funcionalidades básicas do Unix, é uma boa ideia instalar alguns
    pacotes baseados em linha de comandos e terminais de caracteres
    baseados em curses tais como o mc e o vim com o apt-get(8) para
    os iniciantes começarem, pelo seguinte:

    # apt-get update
     ...
    # apt-get install mc vim sudo
     ...

    Se já tiver estes pacotes instalados, não serão instalados novos
    pacotes.

    Tabela 1.1. Lista de pacotes de programas interessantes em modo
    de texto

    +---------------------------------------------------------------+
    | pacote  |popcon|tamanho|              descrição               |
    |---------+------+-------+--------------------------------------|
    |mc       |V:59, |1482   |Um gestor de ficheiro de ecrã completo|
    |         |I:236 |       |em modo de texto                      |
    |---------+------+-------+--------------------------------------|
    |sudo     |V:563,|4555   |Um programa para permitir privilégios |
    |         |I:806 |       |de root limitados aos utilizadores    |
    |---------+------+-------+--------------------------------------|
    |         |V:106,|       |O editor de texto de Unix Vi IMproved,|
    |vim      |I:398 |3231   |um editor de texto para programadores |
    |         |      |       |(versão standard)                     |
    |---------+------+-------+--------------------------------------|
    |         |V:62, |       |O editor de texto de Unix Vi IMproved,|
    |vim-tiny |I:970 |1553   |um editor de texto para programadores |
    |         |      |       |(versão compacta)                     |
    |---------+------+-------+--------------------------------------|
    |emacs-nox|V:4,  |18364  |Emacs do Projecto GNU, o editor de    |
    |         |I:17  |       |texto extensível baseado em Lisp      |
    |---------+------+-------+--------------------------------------|
    |w3m      |V:31, |2289   |Navegadores de WWW de modo de texto   |
    |         |I:284 |       |                                      |
    |---------+------+-------+--------------------------------------|
    |gpm      |V:11, |530    |O cortar-e-colar estilo Unix na       |
    |         |I:17  |       |consola de texto (daemon)             |
    +---------------------------------------------------------------+


    Pode ser uma boa ideia ler algumas documentações informativas.

    Tabela 1.2. Lista de pacotes de documentação informativa

    +---------------------------------------------------------------+
    |       pacote       |popcon|tamanho|         descrição         |
    |--------------------+------+-------+---------------------------|
    |                    |      |       |Documentação do Projecto   |
    |doc-debian          |I:854 |166    |Debian, (FAQ do Debian) e  |
    |                    |      |       |outros documentos          |
    |--------------------+------+-------+---------------------------|
    |debian-policy       |I:36  |4306   |Manual de Políticas Debian |
    |                    |      |       |e documentos relacionados  |
    |--------------------+------+-------+---------------------------|
    |developers-reference|I:6   |1917   |Guias e informação para    |
    |                    |      |       |programadores de Debian    |
    |--------------------+------+-------+---------------------------|
    |maint-guide         |I:4   |987    |Guia dos Novos Maintainers |
    |                    |      |       |de Debian                  |
    |--------------------+------+-------+---------------------------|
    |debian-history      |I:1   |4285   |História do Projecto Debian|
    |--------------------+------+-------+---------------------------|
    |debian-faq          |I:849 |817    |FAQ do Debian              |
    +---------------------------------------------------------------+


    Pode instalar alguns destes pacotes com o seguinte.

    # apt-get install nome_do_pacote

%

1.1.11. Uma conta de utilizador extra

    Se não deseja usar a sua conta de utilizador principal para as
    seguintes atividades de treino, pode criar uma conta de
    utilizador para treinos, por exemplo, fish, a fazer o seguinte:

    # adduser fish

    Responder a todas as questões.

    Isto cria uma conta chamada fish. Após praticar, pode remover
    esta conta de utilizador e o diretório home dele a fazer o
    seguinte:

    # deluser --remove-home fish

%

1.1.12. Configuração do sudo

    Para a típica estação de trabalho de um único utilizador como o
    ambiente de trabalho do sistema Debian no PC portátil, é comum
    implementar uma configuração simples do sudo(8) como a seguir
    para permitir ao utilizador não-privilegiado, ex. penguin, ganhar
    privilégios administrativos apenas com a sua palavra-passe de
    utilizador mas sem a palavra-passe do root.

    # echo "penguin  ALL=(ALL) ALL" >> /etc/sudoers

    Em alternativa, é também comum fazer como a seguir para permitir
    a um utilizador não privilegiado, ex. penguin, ganhar privilégios
    administrativos sem qualquer palavra-passe.

    # echo "penguin  ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers

    Este truque só deve ser usado na estação de trabalho de um único
    utilizador que administra e onde é o único utilizador.

    Atenção

    Não configure assim as contas de utilizadores normais numa
    estação de trabalho multi-utilizador porque seria muito mau para
    a segurança do sistema.

    Cuidado
   
    A palavra-passe e a conta penguin no exemplo em cima requer tanta
    protecção como a palavra-passe do root e a conta do root.

    Cuidado

    O privilégio administrativo neste contexto pertence a alguém
    autorizado a executar as tarefas de administração do sistema numa
    estação de trabalho. Nunca dê tais privilégios a um gestor do
    departamento Administrativo da sua firma ou ao seu chefe a menos
    que eles sejam autorizados e capazes.

    Nota

    Para disponibilizar privilégios de acesso a aparelhos limitados e
    ficheiros limitados, deve considerar usar o group para
    disponibilizar acesso limitado em vez de usar os privilégios do
    root via sudo(8).

    Nota

    Com uma configuração melhor pensada e cuidada, o sudo(8) pode
    garantir privilégios administrativos limitados a outros
    utilizadores num sistema partilhado sem partilhar a palavra-passe
    do root. Isto pode ajudar com as responsabilidades com máquinas
    com múltiplos administradores para que possa saber quem fez o
    quê. Por outro lado, pode querer que mais ninguém tenha tais
    privilégios.

%

1.1.13. Hora de brincar

    Agora está pronto para brincar com o sistema Debian sem riscos
    desde que use a conta de utilizador sem-privilégios.

    Isto porque o sistema Debian é, mesmo após uma instalação
    predefinida, configurado com permissões de ficheiros apropriadas
    que previne os utilizadores não privilegiados de danificarem o
    sistema. É claro, podem ainda existir alguns buracos que possam
    ser explorados mas aqueles que se preocupam com estes problemas
    não deveriam ler esta secção e deveriam ler o Manual de Segurança
    Debian.

    Aprendemos o sistema Debian como um sistema tipo Unix com o
    seguinte:

      * Secção 1.2, “Sistema de ficheiros tipo Unix” (conceitos
        básicos)

      * Secção 1.3, “Midnight Commander (MC)” (método de
        sobrevivência)

      * Secção 1.4, “O ambiente de trabalho estilo Unix básico”
        (método básico)

      * Secção 1.5, “O comando simples da shell” (mecanismo da shell)

      * Secção 1.6, “Processamento de texto estilo Unix” (método de
        processamento de texto)

%

1.2. Sistema de ficheiros tipo Unix

    No GNU/Linux e noutros sistemas operativos tipo Unix, os
    ficheiros estão organizados em diretórios. Todos os ficheiros e
    diretórios estão organizados numa grande árvore que nasce em "/".
    É chamada uma árvore porque se desenhar o sistema de ficheiros,
    parece-se com uma árvore mas está de cabeça para baixo.

    Estes ficheiros e diretórios podem estar espalhados por vários
    aparelhos. mount(8) serve para anexar o sistema de ficheiros
    encontrado num aparelho à grande árvore de ficheiros.
    Reciprocamente, umount(8) desanexa-os novamente. Nos kernel Linux
    recentes, o mount(8) com algumas opções pode unir parte de uma
    árvore de ficheiros noutro lugar ou pode montar um sistema de
    ficheiros como partilhado, privado, escravo ou não-unível. As
    opções do mount suportadas para cada sistema de ficheiros estão
    disponíveis em "/usr/share/doc/linux-doc-*/Documentation/
    filesystems/".

    Os diretórios no sistema Unix são chamados pastas nalguns outros
    sistemas. Por favor note também que não existe conceito para 
    drive tal como "A:" em qualquer sistema Unix. Existe um sistema
    de ficheiros e tudo está incluído nele. Esta é uma enorme
    vantagem em comparação com o Windows.

%

1.2.1. Noções básicas de ficheiros Unix

    Aqui estão algumas noções básicas de ficheiros Unix:

      * Os nomes de ficheiro são sensíveis a maiúsculas/minúsculas.
        Isto é, "MEUFICHEIRO" e "MeuFicheiro" são ficheiros
        diferentes.

      * O diretório raiz significa a raiz do sistema de ficheiros e é
        referido simplesmente como "/". Não confundir isto com o
        diretório pessoal do utilizador root: "/root".

      * Todos os diretórios têm um nome que pode conter quaisquer
        letras ou símbolos excepto "/". O diretório raiz é uma
        excepção. O nome dele é "/" (pronuncia-se "slash" ou "o
        diretório raiz") e não pode ser renomeado.

      * Cada ficheiro ou diretório é designado por um nome de
        ficheiro totalmente qualificado, nome de ficheiro absoluto,
        ou caminho, que fornece a sequência de diretórios que têm de
        ser percorridos para o alcançar. Estes três termos são
        sinónimos.

      * Todos os nomes de ficheiro totalmente qualificados começam
        com o diretório "/" e existe um "/" entre cada diretório ou
        ficheiro no nome do ficheiro. O primeiro "/" é o diretório de
        nível de topo e os outros "/"' separam sucessivamente os
        sub-diretórios, até que se chegue à última entrada que é o
        nome real do ficheiro. As palavras utilizadas aqui conseguem
        ser confusas. Veja o seguinte nome de ficheiro completamente
        qualificado como um exemplo: "/usr/share/keytables/
        us.map.gz". No entanto, as pessoas também se referem ao seu
        nome base sozinho "us.map.gz" como um nome de ficheiro.

      * O diretório raiz tem algumas ramificações, tais como "/etc/"
        e "/usr/". Estes sub-diretórios por sua vez ramificam-se em
        mais sub-diretórios, tais como "/etc/init.d/" e "/usr/local/
        ". O todo, visto em conjunto, é a chamada árvore de
        diretórios. Pode pensar num nome de ficheiro absoluto como um
        caminho desde a base da árvore ("/") até ao fim de um ramo
        (um ficheiro). Também pode ouvir pessoas falar da árvore de
        diretórios como se fosse uma árvore de família a juntar todos
        os descendentes diretos numa única figura chamada de
        diretório raiz ("/"): assim, os sub-diretórios têm pais e um
        caminho mostra a linhagem completa de um ficheiro. Existem
        também caminhos relativos que começam algures noutro ponto
        que não o diretório raiz. Deve lembrar-se que o diretório "..
        /" refere-se ao diretório pai. Esta terminologia também se
        aplica a outras estruturas semelhantes a diretórios, como
        estruturas hierárquicas de dados.

      * Não existe componente especial no nome de caminho que
        corresponde a um aparelhos físico, tal como o seu disco
        rígido. Isto difere de RT-11, CP/M, OpenVMS, MS-DOS, AmigaOS
        e Microsoft Windows, onde o caminho contém um nome de
        aparelho tal como "C:\". (No entanto, existem entradas nos
        diretórios que referem-se a aparelhos físicos como parte do
        sistema de ficheiros normal. Veja Secção 1.2.2, “Internos do
        sistema de ficheiros”.)

    Nota

    Apesar de poder usar quase todas as letras ou símbolos num nome
    de ficheiro, na prática é má ideia fazê-lo. É melhor evitar
    quaisquer caracteres que geralmente têm significados especiais na
    linha de comandos, incluindo espaços, tabs, novas linhas e outros
    caracteres especiais: { } ( ) [ ] ' ` " \ / > < | ; ! # & ^ * % @
    $ . Se deseja separar palavras num nome, as boas escolhas são o
    ponto, traço e underscore. Também pode capitalizar cada palavra
    assim "ComoEsteExemplo". Os utilizadores avançados de Linux
    procuram evitar espaços nos nomes de ficheiros.

    Nota

    A palavra "root" pode significar o "utilizador root" ou o
    "diretório raiz (root)". O contexto da utilização deles deve
    torná-lo claro.

    Nota

    A palavra caminho (path) é usada não apenas para o 
    nome-de-ficheiro totalmente qualificado como em cima mas também
    para o caminho de busca de comandos. O significado pretendido é
    geralmente claro a partir do contexto.

    As melhores práticas detalhadas para a hierarquia de ficheiros
    estão descritas no Filesystem Hierarchy Standard ("/usr/share/doc
    /debian-policy/fhs/fhs-2.3.txt.gz" e hier(7)). Deve lembrar-se
    dos seguintes factos como princípio:

    Tabela 1.3. Lista de utilização de diretórios chave

    +---------------------------------------------------------------+
    |diretório|               utilização do diretório               |
    |---------+-----------------------------------------------------|
    |/        |o diretório raiz                                     |
    |---------+-----------------------------------------------------|
    |/etc/    |ficheiros de configuração de todo o sistema          |
    |---------+-----------------------------------------------------|
    |/var/log/|ficheiros log do sistema                             |
    |---------+-----------------------------------------------------|
    |/home/   |todos os diretórios home de todos os utilizadores não|
    |         |privilegiados                                        |
    +---------------------------------------------------------------+


%

1.2.2. Internos do sistema de ficheiros

    A seguir a tradição do Unix, o sistema Debian GNU/Linux
    disponibiliza o sistema de ficheiros sob o qual residem os dados
    físicos em discos rígidos e outros aparelhos de armazenamento e a
    interacção com os aparelhos de hardware como ecrãs de consola e
    consolas série remotas são representados num modo unificado sob "
    /dev/".

    Cada ficheiro, diretório, 'named pipe' (um modo de dois programas
    partilharem dados), ou aparelho físico num sistema Debian GNU/
    Linux tem uma estrutura de dados chamada inode que descreve os
    seus atributos associados como o utilizador que o possui (o
    dono), o grupo a que pertence, a hora do último acesso, etc. A
    ideia de representar praticamente tudo no sistema de ficheiros
    foi uma inovação do Unix e os modernos kernel Linux desenvolveram
    esta ideia ainda mais. Atualmente, até informação sobre os
    processos que correm no computador encontra-se no sistema de
    ficheiros.

    Esta representação abstracta e unificada de entidades físicas e
    processos internos é muito poderosa porque permite-nos utilizar o
    mesmo comando para o mesmo tipo de operação em muitos aparelhos
    totalmente diferentes. É mesmo possível alterar o modo como o
    kernel funciona ao escrever dados em ficheiros especiais que
    estão ligados a processos em execução.

    Dica
   
    Se necessitar identificar a correspondência entre a árvore de
    ficheiros e a entrada física, execute mount(8) sem argumentos.

%

1.2.3. Permissões do sistema de ficheiros

    As Permissões de sistemas de ficheiros de sistemas tipo-Unix são
    definidas por três categorias de utilizadores afetados:

      * O utilizador que é dono do ficheiro (u)

      * Outros utilizadores no grupo ao qual o ficheiro pertence (g)

      * Todos os outros utilizadores (o) também referido como "mundo"
        e "todos"

    Para o ficheiro, cada permissão correspondente permite as
    seguintes ações:

      * A permissão read (r) permite ao dono examinar o conteúdo do
        ficheiro.

      * A permissão write (w) permite ao dono modificar o ficheiro.

      * A permissão execute (x) permite ao dono correr o ficheiro
        como um comando.

    Para o diretório, cada permissão correspondente permite as
    seguintes ações:

      * A permissão read (r) permite ao dono listar o conteúdo do
        diretório.

      * A permissão write (w) permite ao dono adicionar ou remover
        ficheiros no diretório.

      * A permissão execute (x) permite ao dono aceder aos ficheiro
        no diretório.

    Aqui, a permissão execute num diretório significa não só permitir
    a leitura dos ficheiros nesse diretório mas também permitir
    visualizar os seus atributos, tais como o tamanho e a hora de
    modificação.

    ls(1) é utilizado para mostrar informação de permissões (e mais)
    para ficheiros e diretórios. Quando é invocado com a opção "-l",
    mostra a seguinte informação na ordem apresentada:

      * Tipo de ficheiro (primeiro caractere)

      * Permissão de acesso do ficheiro (nove caracteres, a consistir
        em três caracteres cada para utilizador, grupo e outros por
        esta ordem)

      * Quantidade de ligações rígidas ao ficheiro

      * Nome do utilizador dono do ficheiro

      * Nome do grupo ao qual o ficheiro pertence

      * Tamanho do ficheiro em caracteres (bytes)

      * Data e hora do ficheiro (mtime)

      * Nome do ficheiro

    Tabela 1.4. Lista do primeiro caractere da saída de "ls -l"

    +-------------------------------------+
    |caractere|        significado        |
    |---------+---------------------------|
    |-        |ficheiro normal            |
    |---------+---------------------------|
    |d        |diretório                  |
    |---------+---------------------------|
    |l        |ligação simbólica          |
    |---------+---------------------------|
    |c        |nó de aparelho de caractere|
    |---------+---------------------------|
    |b        |nó de aparelho de bloco    |
    |---------+---------------------------|
    |p        |named pipe                 |
    |---------+---------------------------|
    |s        |socket                     |
    +-------------------------------------+


    chown(1) é utilizado a partir da conta de root para alterar o
    dono do ficheiro. chgrp(1) é utilizado a partir da conta do dono
    do ficheiro ou da conta root para alterar o grupo do ficheiro. 
    chmod(1) é usado a partir da conta do dono do ficheiro ou da
    conta root para alterar as permissões de acesso ao ficheiro ou
    diretório. A sintaxe básica para manipular o ficheiro foo é a
    seguinte:

    # chown <novo_dono> foo
    # chgrp <novo_grupo> foo
    # chmod  [ugoa][+-=][rwxXst][,...] foo

    Por exemplo, pode fazer com que uma árvore de diretórios tenha
    como dono o utilizador foo e seja partilhada pelo grupo bar pelo
    seguinte:

    # cd /qualquer/localização/
    # chown -R foo:bar .
    # chmod -R ug+rwX,o=rX .

    Existem mais três bits especiais de permissões.

      * O bit set user ID (s ou S em vez do x do utilizador)

      * O bit set group ID (s ou S em vez do x do grupo)

      * O bit sticky (t ou T em vez do x dos outros)

    Aqui o resultado de "ls -l" para estes bits é capitalizado se a
    execução de bits escondidos por estes resultados estiverem não
    definidos.

    Definir set user ID num ficheiro executável permite a um
    utilizador executar o ficheiro executável com o ID do dono do
    ficheiro (por exemplo root). De modo semelhante, definir set
    group ID num ficheiro executável permite a um utilizador executar
    o ficheiro executável com o ID de grupo do ficheiro (por exemplo 
    root). Porque estas definições podem causar riscos de segurança,
    activá-las requer precauções extra.

    Definir set group ID num diretório activa o esquema de criação de
    ficheiros ao estilo BSD onde todos os ficheiros criados no
    diretório pertencem ao grupo do diretório.

    Definir o sticky bit num diretório previne que um ficheiro nesse
    diretório seja removido por um utilizador que não seja o dono do
    ficheiro. De modo a tornar o conteúdo de um ficheiro seguro em
    diretórios onde todos têm acesso de escrita, como o "/tmp" ou em
    diretórios onde um grupo tem acesso de escrita, não basta
    reiniciar a permissão de escrita do ficheiro mas também definir o
    sticky bit no diretório. Caso contrário, o ficheiro pode ser
    removido e pode ser criado um novo ficheiro com o mesmo nome por
    qualquer utilizador que tenha acesso de escrita no diretório.

    Aqui estão alguns exemplos interessantes de permissões de
    ficheiros:

    $ ls -l /etc/passwd /etc/shadow /dev/ppp /usr/sbin/exim4
    crw------T 1 root root   108, 0 Oct 16 20:57 /dev/ppp
    -rw-r--r-- 1 root root     2761 Aug 30 10:38 /etc/passwd
    -rw-r----- 1 root shadow   1695 Aug 30 10:38 /etc/shadow
    -rwsr-xr-x 1 root root   973824 Sep 23 20:04 /usr/sbin/exim4
    $ ls -ld /tmp /var/tmp /usr/local /var/mail /usr/src
    drwxrwxrwt 14 root root  20480 Oct 16 21:25 /tmp
    drwxrwsr-x 10 root staff  4096 Sep 29 22:50 /usr/local
    drwxr-xr-x 10 root root   4096 Oct 11 00:28 /usr/src
    drwxrwsr-x  2 root mail   4096 Oct 15 21:40 /var/mail
    drwxrwxrwt  3 root root   4096 Oct 16 21:20 /var/tmp

    Existe um modo numérico alternativo para descrever as permissões
    do ficheiro com o chmod(1). Este modo numérico utiliza 3 ou 4
    dígitos em numeração octal (radix=8).

    Tabela 1.5. O modo numérico para permissões de ficheiros em
    comandos chmod(1)

    +---------------------------------------------------------------+
    |  digito   |                    significado                    |
    |-----------+---------------------------------------------------|
    |1º digito  |soma de set user ID (=4), set group ID (=2) e      |
    |opcional   |sticky bit (=1)                                    |
    |-----------+---------------------------------------------------|
    |2º digito  |soma das permissões leitura (=4), escrita (=2) e   |
    |           |executável (=1) para o utilizador                  |
    |-----------+---------------------------------------------------|
    |3º digito  |idem para grupo                                    |
    |-----------+---------------------------------------------------|
    |4º digito  |idem para outros                                   |
    +---------------------------------------------------------------+


    Isto parece complicado mas na verdade é bastante simples. Se
    observar as primeiras colunas (2-10) do resultado do comando "ls
    -l" e lê-las como uma representação binária (radix=2) das
    permissões do ficheiros ("-" a ser "0" e "rwx" a ser "1"), os
    últimos três dígitos do valor de modo numérico para si deverão
    fazer sentido como uma representação octal (radix=8) das
    permissões do ficheiro.

    Por exemplo, tente o seguinte:

    $ touch foo bar
    $ chmod u=rw,go=r foo
    $ chmod 644 bar
    $ ls -l foo bar
    -rw-r--r-- 1 penguin penguin 0 Oct 16 21:39 bar
    -rw-r--r-- 1 penguin penguin 0 Oct 16 21:35 foo

    Dica

    Se necessitar aceder a informação mostrada por "ls -l" num script
    da shell, deve utilizar comandos pertinentes como test(1), stat
    (1) e readlink(1). Os comandos da própria shell como "[" ou
    "test" também podem ser utilizados.

%

1.2.4. Controlo de permissões para ficheiros acabados de criar: umask

    As permissões que são aplicadas ao criar ficheiros e diretórios
    novos é restringida pelo comando embutido da shell umask. Veja 
    dash(1), bash(1) e builtins(7).

     (permissões de ficheiros) = (permissões de ficheiros pedidas) & ~(valor umask)

    Tabela 1.6. Exemplos do valor umask

    +---------------------------------------------------------------+
    |umask|  permissões do  |  permissões do  |     utilização      |
    |     |ficheiro criadas |diretório criadas|                     |
    |-----+-----------------+-----------------+---------------------|
    |     |                 |                 |apenas pode ser      |
    |0022 |-rw-r--r--       |-rwxr-xr-x       |escrito pelo         |
    |     |                 |                 |utilizador           |
    |-----+-----------------+-----------------+---------------------|
    |0002 |-rw-rw-r--       |-rwxrwxr-x       |pode ser escrito pelo|
    |     |                 |                 |grupo                |
    +---------------------------------------------------------------+


    O sistema Debian usa um esquema de grupo privado de utilizadores
    (UPG). Um UPG é criado sempre que um novo utilizador é adicionado
    ao sistema. Um UPG tem o mesmo nome que o utilizador para o qual
    foi criado e esse utilizador é o único membro do UPG. O esquema
    UPG torna seguro definir a umask para 0002 já que cada utilizador
    tem o próprio grupo privado dele. (Em algumas variantes de Unix,
    é bastante comum configurar os utilizadores normais a pertencerem
    a um único grupo users e por segurança é uma boa ideia definir a
    umask para 0022 nesses casos.)

    Dica
   
    Active UPG ao pôr "umask 002" no ficheiro ~/.bashrc.

%

1.2.5. Permissões para grupos de utilizadores (group)

    De modo a que as permissões de grupo sejam aplicadas a um
    utilizador particular, esse utilizador precisa de se tornar
    membro do grupo a usar "sudo vigr" para /etc/group e "sudo vigr
    -s" para /etc/gshadow. Precisa de iniciar sessão após terminar
    sessão (ou correr "exec newgrp") para ativar a nova configuração
    do grupo.

    Nota

    Em alternativa, pode adicionar dinamicamente utilizadores aos
    grupos durante o processo de autenticação ao adicionar a linha
    "auth optional pam_group.so" a "/etc/pam.d/common-auth" e
    configurar "/etc/security/group.conf". (Veja Capítulo 4, 
    Autenticação.)

    Os aparelhos de hardware são apenas outro tipo de ficheiros no
    sistema Debian. Se tiver problemas a aceder a aparelhos como o
    CD-ROM e memórias USB a partir de uma conta de utilizador, deve
    tornar esse utilizador um membro do grupo relevante.

    Alguns grupos notáveis disponibilizados pelo sistema permitem aos
    seus membros aceder a ficheiros e aparelhos particulares sem
    privilégios de root.

    Tabela 1.7. Lista de grupos notáveis disponibilizados pelo
    sistema para acesso a ficheiros

    +---------------------------------------------------------------+
    | grupo |    descrição para ficheiros e aparelhos acessíveis    |
    |-------+-------------------------------------------------------|
    |dialout|acesso completo e direto a portas série ("/dev/ttyS    |
    |       |[0-3]")                                                |
    |-------+-------------------------------------------------------|
    |dip    |Acesso limitado a portas série para ligação Dialup IP a|
    |       |peers de confiança                                     |
    |-------+-------------------------------------------------------|
    |cdrom  |drives CD-ROM, DVD+/-RW                                |
    |-------+-------------------------------------------------------|
    |audio  |aparelho de áudio                                      |
    |-------+-------------------------------------------------------|
    |video  |aparelho de vídeo                                      |
    |-------+-------------------------------------------------------|
    |scanner|scanner(es)                                            |
    |-------+-------------------------------------------------------|
    |adm    |logs (relatórios) de monitorização do sistema          |
    |-------+-------------------------------------------------------|
    |staff  |alguns diretórios para trabalho administrativo júnior: |
    |       |"/usr/local", "/home"                                  |
    +---------------------------------------------------------------+


    Dica

    Necessita pertencer ao grupo dialout para reconfigurar o modem,
    ligar para qualquer lado, etc. Mas se o root criar ficheiros de
    configuração pré-definidos para peers de confiança em "/etc/ppp/
    peers/", apenas precisa de pertencer ao grupo dip para criar uma
    ligação Dialup IP para esses peers de confiança a utilizar os
    comandos pppd(8), pon(1) e poff(1).

    Alguns grupos notáveis disponibilizados pelo sistema permitem aos
    seus membros executar comandos particulares sem privilégios de
    root.

    Tabela 1.8. Lista de grupos notáveis disponibilizados pelo
    sistema para execuções de comandos particulares

    +---------------------------------------------------------------+
    | grupo |                  comandos acessíveis                  |
    |-------+-------------------------------------------------------|
    |sudo   |executar sudo sem a palavra-passe deles                |
    |-------+-------------------------------------------------------|
    |lpadmin|executar comandos para adicionar, modificar e remover  |
    |       |impressoras das bases de dados de impressoras          |
    +---------------------------------------------------------------+


    Para a listagem completa dos utilizadores e grupos
    disponibilizados pelo sistema, veja a versão recente do documento
    "Utilizadores e Grupos" em "/usr/share/doc/base-passwd/
    users-and-groups.html" disponibilizado pelo pacote base-passwd.

    Para comandos de gestão para o sistema de utilizador e grupo veja
    passwd(5), group(5), shadow(5), newgrp(1), vipw(8), vigr(8) e 
    pam_group(8).

%

1.2.6. Marcas temporais (Timestamps)

    Existem três tipos de marcas temporais para um ficheiro de GNU/
    Linux.

    Tabela 1.9. Lista dos tipos de marcas temporais

    +--------------------------------------------------------+
    |tipo |      significado (definição Unix histórica)      |
    |-----+--------------------------------------------------|
    |mtime|a hora de modificação do ficheiro (ls -l)         |
    |-----+--------------------------------------------------|
    |ctime|a hora de alteração de estado do ficheiro (ls -lc)|
    |-----+--------------------------------------------------|
    |atime|a hora do último acesso ao ficheiro (ls -lu)      |
    +--------------------------------------------------------+


    Nota
   
    ctime não é o tempo de criação do ficheiro.

    Nota
   
    O valor atual de atime num sistema GNU/Linux pode ser diferente
    daquele da definição Unix histórica.

      * Sobrescrever um ficheiro altera todos os atributos mtime, 
        ctime e atime do ficheiro.

      * Alterar o dono ou as permissões de um ficheiro altera os
        atributos ctime e atime do ficheiro.

      * Ler um ficheiro altera o atributo atime do ficheiro.no
        sistema Unix histórico.

      * Ler um ficheiro altera o atributo atime do ficheiro no
        sistema GNU/Linux se o sistema de ficheiros dele estiver
        montado com "strictatime".

      * Ler um ficheiro pela primeira vez ou após um dia altera o
        atributo atime do ficheiro no sistema GNU/Linux se o sistema
        de ficheiros dele for montado com relatime". (comportamento
        predefinido desde Linux 2.6.30)

      * Ler um ficheiro não altera o atributo atime do ficheiro no
        sistema GNU/Linux se o sistema de ficheiros dele for montado
        com "noatime".

    Nota

    As opções de montagem "noatime" e "relatime" são introduzidas
    para melhorar a performance de leitura do sistema de ficheiros
    sob casos de utilização normal. Operações simples de leitura de
    ficheiros sob a opção "strictatime" acompanha a operação de
    escrita que consome tempo para atualizar o atributo atime. Mas o
    atributo atime é raramente usado excepto para ficheiro mbox(5).
    Veja mount(8).

    Utilize o comando touch(1) para alterar as marcas temporais de
    ficheiros existentes.

    Para marcas temporais, o comando ls gera diferentes strings sob o
    locale não-Inglês ("pt_PT.UTF-8") a partir do antigo ("C").

    $ LANG=pt_PT.UTF-8  ls -l foo
    -rw-rw-r-- 1 penguin penguin 0 oct. 16 21:35 foo
    $ LANG=C  ls -l foo
    -rw-rw-r-- 1 penguin penguin 0 Oct 16 21:35 foo

    Dica
   
    Veja Secção 9.2.5, “Amostragem personalizada de hora e data” para
    personalizar a saída do "ls -l".

%

1.2.7. Links (ligações)

    Existem dois métodos de associar um ficheiro "foo" com um nome de
    ficheiro diferente "bar".

      * Ligação rígida

          + Duplicar nome para um ficheiro existente

          + "ln foo bar"
   
      * Ligação simbólica ou symlink

          + Ficheiro especial que aponta para outro ficheiro pelo
            nome

          + "ln -s foo bar"

    Veja o seguinte exemplo para alterações nas contagens da ligação
    e as diferenças subtis nos resultados do comando rm.

    $ umask 002
    $ echo "Conteúdo Original" > foo
    $ ls -li foo
    1449840 -rw-rw-r-- 1 penguin penguin 17 Oct 16 21:42 foo
    $ ln foo bar     # ligação rígida
    $ ln -s foo baz  # ligação simbólica
    $ ls -li foo bar baz
    1449840 -rw-rw-r-- 2 penguin penguin 17 Oct 16 21:42 bar
    1450180 lrwxrwxrwx 1 penguin penguin  3 Oct 16 21:47 baz -> foo
    1449840 -rw-rw-r-- 2 penguin penguin 17 Oct 16 21:42 foo
    $ rm foo
    $ echo "Novo Conteúdo" > foo
    $ ls -li foo bar baz
    1449840 -rw-rw-r-- 1 penguin penguin 17 Oct 16 21:42 bar
    1450180 lrwxrwxrwx 1 penguin penguin  3 Oct 16 21:47 baz -> foo
    1450183 -rw-rw-r-- 1 penguin penguin 12 Oct 16 21:48 foo
    $ cat bar
    Conteúdo Original
    $ cat baz
    Novo Conteúdo

    A ligação rígida pode ser feita dentro do mesmo sistema de
    ficheiros e partilhar o mesmo número de inode tal como o ls(1)
    com a opção "-i" revela.

    A ligação simbólica tem sempre permissões nominais de acesso ao
    ficheiro "rwxrwxrwx", conforme mostrado no exemplo acima, com as
    permissões de acesso efectivas ditadas pelas permissões do
    ficheiro para o qual aponta.

    Cuidado

    Geralmente é boa ideia, de todo, não criar ligações simbólicas
    complicadas ou ligação rígidas a menos que tenha uma boa razão.
    Podem causar pesadelos onde a combinação lógica das ligações
    simbólicas resulta em círculos viciosos no sistema de ficheiros.

    Nota

    Geralmente é preferível utilizar ligações simbólicas em vez de
    ligação rígidas, a menos que tenha boas razões para usar uma
    ligação rígida.

    O diretório "." liga ao diretório onde ele aparece, assim a
    contagem de ligações de qualquer novo diretório começa em 2. O
    diretório ".." liga ao diretório pai, assim a contagem de
    ligações do diretório aumenta com a adição de novos
    sub-diretórios.

    Se está a mudar do Windows para Linux, em breve irá ficar claro o
    quão bem desenhado está a ligação de nomes de ficheiros em Unix,
    comparada com o equivalente mais próximo em Windows de "atalhos".
    Devido a estar implementado no sistema de ficheiros, aplicações
    não conseguem ver nenhuma diferença entre um ficheiro ligado e o
    original. No caso de ligações rígidas, não há realmente nenhuma
    diferença.

%

1.2.8. Pipes com nome (FIFOs)

    Um pipe com nome é um ficheiro que age como um pipe. Coloca algo
    no ficheiro e sai pelo outro lado. Por isso é chamado um FIFO, ou
    Primeiro-a-Entrar-Primeiro-a-Sair: a primeira coisa que pôe no
    pipe é a primeira coisa a sair pelo outro lado.

    Se escrever para um pipe com nome, o processo que escreve à pipe
    não termina até que a informação que está a ser escrita para o
    pipe seja lida a partir do pipe. Se ler de um pipe com nome, o
    processo que lê espera até que não haja mais nada para ler antes
    de terminar. O tamanho do pipe é sempre zero -- não armazena
    dados, apenas faz a ligação entre dois processos como a
    funcionalidade oferecida pelo "|" na sintaxe da shell. No
    entanto, como este pipe tem um nome, os dois processos não têm de
    estar na mesma linha de comando ou mesmo serem executados pelo
    mesmo utilizador. Os pipes foram uma inovação de muita influência
    do Unix.

    Por exemplo, tente o seguinte:

    $ cd; mkfifo mypipe
    $ echo "hello" >mypipe & # put into background
    [1] 8022
    $ ls -l mypipe
    prw-rw-r-- 1 penguin penguin 0 Oct 16 21:49 mypipe
    $ cat mypipe
    hello
    [1]+  Done                    echo "hello" >mypipe
    $ ls mypipe
    mypipe
    $ rm mypipe

%

1.2.9. Sockets

    Os sockets são usados extensivamente por toda a comunicação da
    Internet, bases de dados e pelo próprio sistema operativo. São
    semelhantes a pipes com nome (FIFO) e permitem aos processos
    trocarem informação mesmo entre computadores diferentes. Para o
    socket, esses processos não precisam de estar a correr ao mesmo
    tempo, nem correrem como filhos do mesmo processo pai. Isto é o
    destino da comunicação inter-processo (IPC). A troca de
    informação pode ocorrer sobre a rede entre máquinas diferentes.
    Os dois mais comuns são o socket de Internet e o socket de
    domínio Unix.

    Dica
   
    "netstat -an" dá uma visão geral, muito útil, dos sockets que
    estão abertos num determinado sistema.

%

1.2.10. Ficheiros de aparelho

    Os ficheiros de Aparelhos referem-se a aparelhos físicos ou
    virtuais no seu sistema, como o seu disco rígido, placa gráfica,
    monitor ou teclado. Um exemplo de aparelho virtual é a consola,
    que é representada por "/dev/console".

    Existem 2 tipos de ficheiros de aparelho.

      * Aparelho de Caractere

          + Acedido por um caractere de cada vez

          + 1 caractere = 1 byte

          + Por exemplo, aparelho de teclado, porta serial, …
   
      * Aparelho de Bloco

          + acedido em unidades maiores chamadas blocos

          + 1 bloco > 1 byte

          + Por exemplo, o disco rígido, …

    Pode ler e escrever nos ficheiros de aparelho, embora o ficheiro
    possa muito bem conter dados binários que podem ser uma salada
    incompreensível para humanos. Escrever dados directamente nestes
    ficheiros é por vezes útil para diagnosticar problemas com
    ligações de hardware. Por exemplo, pode despejar um ficheiro de
    texto para um aparelho de impressora "/dev/lp0" ou enviar
    comandos de modem à porta serial apropriada "/dev/ttyS0". Mas, a
    menos que isto seja feito com cuidado, pode causar problemas
    maiores. Portanto seja cauteloso.

    Nota
   
    Para o acesso normal a uma impressora, use lp(1).

    Os números de nós de aparelho são mostrados ao executar ls(1)
    como a seguir.

    $ ls -l /dev/sda /dev/sr0 /dev/ttyS0 /dev/zero
    brw-rw---T  1 root disk     8,  0 Oct 16 20:57 /dev/sda
    brw-rw---T+ 1 root cdrom   11,  0 Oct 16 21:53 /dev/sr0
    crw-rw---T  1 root dialout  4, 64 Oct 16 20:57 /dev/ttyS0
    crw-rw-rw-  1 root root     1,  5 Oct 16 20:57 /dev/zero

      * "/dev/sda" tem o número maior de aparelho 8 e o número menor
        de aparelho 0. Isto é acessível para leitura e escrita aos
        utilizadores que pertencem ao grupo disk.

      * "/dev/sr0" tem o número maior de aparelho 11 e o número menor
        de aparelho 0. Isto é acessível para leitura e escrita aos
        utilizadores que pertencem ao grupo cdrom.
   
      * "/dev/ttyS0" tem o número maior de aparelho 4 e o número
        menor de aparelho 64. Isto é acessível para leitura e escrita
        aos utilizadores que pertencem ao grupo dialout.

      * "/dev/zero" tem o número 1 no aparelho maior e o número 5 no
        número de aparelho menor. Isto é acessível para leitura/
        escrita a todos.

    No sistema Linux moderno, o sistema de ficheiros sob "/dev/" é
    povoado automaticamente pelo mecanismo udev(7).

%

1.2.11. Ficheiros de aparelhos especiais

    Existem alguns ficheiros de aparelhos especiais.

    Tabela 1.10. Lista de ficheiros de aparelhos especiais

    +---------------------------------------------------------------+
    |ficheiro|        |                                             |
    |   de   | acção  |            descrição da resposta            |
    |aparelho|        |                                             |
    |--------+--------+---------------------------------------------|
    |/dev/   |ler     |retorna o "caractere de fim-de-ficheiro (EOF)|
    |null    |        |"                                            |
    |--------+--------+---------------------------------------------|
    |/dev/   |escrever|retorna nada (um poço de despejo de dados sem|
    |null    |        |fundo)                                       |
    |--------+--------+---------------------------------------------|
    |/dev/   |ler     |retorna "o caractere \0 (NULO)" (não é o     |
    |zero    |        |mesmo que o número zero em ASCII)            |
    |--------+--------+---------------------------------------------|
    |/dev/   |        |retorna caracteres aleatórios a partir de um |
    |random  |ler     |verdadeiro gerador de números aleatórios, a  |
    |        |        |entregar entropia real (lento)               |
    |--------+--------+---------------------------------------------|
    |/dev/   |        |retorna caracteres aleatórios a partir de um |
    |urandom |ler     |gerador de números pseudo-aleatórios         |
    |        |        |criptograficamente seguros                   |
    |--------+--------+---------------------------------------------|
    |/dev/   |escrever|retorna o erro de disco cheio (ENOSPC)       |
    |full    |        |                                             |
    +---------------------------------------------------------------+


    Estes são usados frequentemente em conjunto com o
    redireccionamento da shell (veja Secção 1.5.8, “Sequências de
    comandos típicas e redireccionamento da shell”).

%

1.2.12. procfs e sysfs

    Os procfs e sysfs montados em "/proc" e "/sys" são os
    pseudo-sistemas-de-ficheiros e expõem estruturas de dados
    internas do kernel ao espaço de utilizador. Por outras palavras,
    estas entradas são virtuais, a significar que elas agem como uma
    janela de conveniência às operações do sistema operativo.

    O diretório "/proc" contém (entre outras coisas) um sub-diretório
    para cada processo em execução no sistema, o qual tem o nome do
    ID do processo (PID). Os utilitários do sistema que acedem à
    informação de processos, como o ps(1), obtêm a informação deles
    de esta estrutura de diretórios.

    Os diretórios sob "/proc/sys/" contêm interfaces para alterar
    certos parâmetros do kernel durante o funcionamento. (Pode fazer
    o mesmo através do comando especializado sysctl(8) ou do ficheiro
    de configuração/pré-carregamento dele "/etc/sysctl.conf".)

    As pessoas frequentemente assustam-se quando notam num ficheiro
    em particular - "/proc/kcore" - o qual é geralmente enorme. Isto
    é (mais ou menos) uma cópia do conteúdo da memória do seu
    computador. É usado para depuração do kernel. É um ficheiro
    virtual que aponta à memória do computador, portanto não se
    preocupe com o tamanho dele.

    O diretório em "/sys" contém estruturas de dados do kernel
    exportadas, os seus atributos e as suas ligações entre eles.
    Também contém interfaces para alterar certos parâmetros do kernel
    durante o funcionamento.

    Veja "proc.txt(.gz)", "sysfs.txt(.gz)" e outros documentos
    relacionados na documentação do kernel Linux ("/usr/share/doc/
    linux-doc-*/Documentation/filesystems/*") disponibilizados pelo
    pacote linux-doc-*.

%

1.2.13. tmpfs

    O tmpfs é um sistema de ficheiros temporário o qual mantém todos
    os ficheiros na memória virtual. Os dados de tmpfs na cache de
    páginas na memória pode ser ir ao espaço swap no disco, conforme
    necessário.

    O diretório "/run" é montado como tmpfs no inicio do processo de
    arranque. Isto ativa a escrita mesmo que o diretório "/ esteja
    montado como apenas-leitura. Esta é a nova localização para o
    armazenamento de ficheiros de estado transitório e substitui
    várias outras localizações descritas na Filesystem Hierarchy
    Standard, versão 2.3:

      * "/var/run" → "/run"

      * "/var/lock" → "/run/lock"

      * "/dev/shm" → "/run/shm"

    Veja "tmpfs.txt(.gz)" na documentação do kernel Linux ("/usr/
    share/doc/linux-doc-*/Documentation/filesystems/*")
    disponibilizada pelo pacote linux-doc-*.

%

1.3. Midnight Commander (MC)

    Midnight Commander (MC) é um "Canivete Suíço" GNU para a consola
    Linux e para outros ambientes de terminal. Isto oferece aos
    novatos uma experiência de consola movida por menus o que é mais
    fácil de aprender do que os comandos standard do Unix.

    Pode necessitar instalar o pacote Midnight Commander que é
    intitulado de "mc" com o seguinte:

    $ sudo apt-get install mc

    Utilize o comando mc(1) para explorar o sistema Debian. Esta é a
    melhor maneira de aprender. Por favor explore algumas
    localizações interessantes apenas a usar as teclas do cursor e
    Enter.

      * "/etc" e os seus sub-diretórios

      * e"/var/log" os seus sub-diretórios
   
      * "/usr/share/doc" os seus sub-diretórios

      * "/sbin" e "/bin"

%

1.3.1. Personalização do MC

    De modo a fazer o MC mudar o diretório de trabalho ao sair e cd
    para o diretório, sugiro modificar o "~/.bashrc" para incluir um
    script disponibilizado pelo pacote mc.

    . /usr/lib/mc/mc.sh

    Veja mc(1) (sob a opção "-P") para a razão. (Se não compreende
    exatamente do que estou a falar aqui, pode fazer isto mais
    tarde.)

%

1.3.2. Iniciar o MC

    O MC pode ser iniciado com o seguinte:

    $ mc

    O MC toma conta de operações de ficheiros através do menu dele, a
    requerer esforços mínimos do utilizador. Carregue em F1 para
    obter ajuda. Pode brincar com o MC apenas com as teclas de cursor
    e teclas de função.

    Nota

    Em algumas consolas como o gnome-terminal(1), as funções das
    teclas podem ser roubadas pelo programa de consola. Pode
    desativar estas funcionalidades em "Editar" → "Atalhos do
    Teclado" para o gnome-terminal.

    Se encontrar problemas com a codificação de caracteres que
    mostram caracteres com lixo, adicionar "-a" à linha de comandos
    do MC pode ajudar a prevenir problemas.

    Se isto não limpar os seus problemas no ecrã com o MC, veja
    Secção 9.4.6, “A configuração do terminal”.

%

1.3.3. Gestor de ficheiros no MC

    O predefinido são dois painéis de diretórios que contêm listas de
    ficheiros. Outro modo útil é definir a janela da direita para
    "informação" para ver informações de privilégios de acesso a
    ficheiros, etc. De seguida existem algumas teclas de atalho
    essenciais. Com o daemon gpm(8) em execução, também se pode usar
    um rato em consolas de caracteres no Linux. (Certifique-se que
    carrega na tecla shift para obter o comportamento normal de
    cortar e colar no MC.)

    Tabela 1.11. As teclas de atalho do MC

    +---------------------------------------------------------------+
    |   tecla   |                  tecla de atalho                  |
    |-----------+---------------------------------------------------|
    |F1         |menu de ajuda                                      |
    |-----------+---------------------------------------------------|
    |F3         |visualizador interno de ficheiros                  |
    |-----------+---------------------------------------------------|
    |F4         |editor interno                                     |
    |-----------+---------------------------------------------------|
    |F9         |ativar o menu de desenrolar                        |
    |-----------+---------------------------------------------------|
    |F10        |sair do Midnight Commander                         |
    |-----------+---------------------------------------------------|
    |Tab        |mover entre duas janelas                           |
    |-----------+---------------------------------------------------|
    |Insert ou  |marcar o ficheiro para uma operação de múltiplos   |
    |Ctrl-T     |ficheiros como uma cópia                           |
    |-----------+---------------------------------------------------|
    |Del        |apagar o ficheiro (tenha cuidado -- configure o MC |
    |           |para modo de apagar seguro)                        |
    |-----------+---------------------------------------------------|
    |Teclas do  |auto-explicativo                                   |
    |cursor     |                                                   |
    +---------------------------------------------------------------+


%

1.3.4. Truques de linha de comandos no MC

      * O comando cd altera o diretório mostrado no ecrã selcionado.

      * Ctrl-Enter ou Alt-Enter copia um nome de ficheiro para a
        linha de comandos. Utilize isto com os comandos cp(1) e mv(1)
        em conjunto com a edição de linha de comandos.

      * Alt-Tab mostra escolhas de expansão de nomes de ficheiros da
        shell.
   
      * Pode-se especificar os diretórios de inicio para ambas
        janelas como argumentos ao MC; por exemplo, "mc /etc /root".

      * Esc + n-key → Fn (i.e., Esc + 1 → F1, etc.; Esc + 0 → F10)

      * Carregar em Esc antes da tecla tem o mesmo efeito que
        carregar em Alt e na tecla em conjunto; isto é, carregar em
        Esc + c para Alt-C. Esc é chamada uma meta-tecla e por vezes
        mencionada como "M-".

%

1.3.5. O editor interno em MC

    O editor interno tem um esquema de cortar-e-colar interessante.
    Pressionar F3 marca o inicio da seleção, um segundo F3 marca o
    final da seleção e destaca a seleção. Depois pode mover o cursor.
    Se pressionar F6, a área selcionada é movida à localização do
    cursor. Se pressionar F5, a área selcionada é copiada e inserida
    na localização do cursor. F2 salva o ficheiro. F10 fá-lo sair. A
    maioria das teclas do cursor funcionam de modo intuitivo.

    Este editor pode ser iniciado directamente num ficheiro a usar um
    dos seguintes comandos.

    $ mc -e ficheiro_a_editar

    $ mcedit ficheiro_a_editar

    Este não é um editor de várias janelas, mas podem-se utilizar
    várias consolas de Linux para se conseguir o mesmo efeito. Para
    copiar entre janelas, utilize as teclas Alt-F<n> para mudar entre
    consolas virtuais utilize "Ficheiro→Inserir ficheiro" ou
    "Ficheiro→Copiar para ficheiro" para mover uma porção de um
    ficheiro para outro ficheiro.

    Este editor interno pode ser substituído por qualquer editor
    externo à escolha.

    Além disso, muitos programas utilizam as variáveis de ambiente
    "$EDITOR" ou "$VISUAL" para decidir que editor utilizar. Se não
    está confortável com o vim(1) ou com o nano(1), pode definir a
    "mcedit" a adicionar as seguintes linhas ao "~/.bashrc".

    export EDITOR=mcedit
    export VISUAL=mcedit

    Recomendo definir isto para "vim" se possível.

    Se não está confortável com o vim(1), pode continuar a utilizar o
    mcedit(1) para a maioria das tarefas de manutenção do sistema.

%

1.3.6. O visualizador interno no MC

    MC é um visualizador muito inteligente. Esta é uma grande
    ferramenta para procurar palavras em documentos. Uso sempre isto
    para ficheiros no diretório "/usr/share/doc". Esta é a maneira
    mais rápida para navegar por entre grandes quantidades de
    informação de Linux. Este visualizador pode ser iniciado
    diretamente a usar um dos seguintes comandos:

    $ mc -v caminho/para/nome_de_ficheiro_a_visualizar

    $ mcview caminho/para/nome_de_ficheiro_a_visualizar

%

1.3.7. Funcionalidades de auto-arranque do MC

    Carregue em Enter num ficheiro e o programa apropriado lida com o
    conteúdo do ficheiro (veja Secção 9.3.11, “Personalizar o
    programa a ser iniciado”). Esta é uma funcionalidade muito
    conveniente do MC.

    Tabela 1.12. A reacção à tecla enter no MC

    +---------------------------------------------------------------+
    |   tipo de ficheiro   |         reacção à tecla enter          |
    |----------------------+----------------------------------------|
    |ficheiro executável   |executa comando                         |
    |----------------------+----------------------------------------|
    |ficheiro man          |canaliza o conteúdo para software de    |
    |                      |visualização                            |
    |----------------------+----------------------------------------|
    |ficheiro html         |canaliza o conteúdo para explorador web |
    |----------------------+----------------------------------------|
    |ficheiros "*.tar.gz" e|explora o conteúdo dele como se fosse um|
    |"*.deb"               |sub-diretório                           |
    +---------------------------------------------------------------+


    De modo a permitir esta visualização e funcionalidades de
    ficheiros virtuais , os ficheiros a visualizar não devem ser
    definidos como executáveis. Mude o estado deles com o chmod(1) ou
    via menu ficheiro do MC.

%

1.3.8. Sistema de ficheiros virtual FTP no MC

    O MC pode ser utilizado para aceder a ficheiros pela Internet a
    usar FTP. Vá ao menu a pressionar F9 e depois escreva "p" para
    ativar o sistema de ficheiros virtual FTP. Insira um URL no formato
    "nome-de-utilizador:palavra-passe@nome-de-máquina.nome-de-domínio",
    o que obtém um diretório remoto que aparece como se fosse local.

    Tente "[deb.debian.org/debian]" como URL e explore o arquivo
    Debian.

%

1.4. O ambiente de trabalho estilo Unix básico

    Apesar do MC lhe permitir fazer quase tudo, é muito importante
    aprender a utilizar as ferramentas de linha de comandos invocadas
    a partir da prompt da shell e familiarizar-se com o ambiente de
    trabalho do tipo Unix.

%

1.4.1. A shell de login

    Pode selecionar a sua shell de login com chsh(1).

    Tabela 1.13. Lista de programas da shell

    +---------------------------------------------------------------+
    |      |      |       |Shell |                                  |
    |pacote|popcon|tamanho|  do  |            descrição             |
    |      |      |       |POSIX |                                  |
    |------+------+-------+------+----------------------------------|
    |bash  |V:791,|6469   |Sim   |Bash: a GNU Bourne Again SHell (o |
    |      |I:999 |       |      |standard de facto)                |
    |------+------+-------+------+----------------------------------|
    |tcsh  |V:9,  |1316   |Não   |Shell TENEX C: uma versão         |
    |      |I:29  |       |      |melhorada de Berkeley csh         |
    |------+------+-------+------+----------------------------------|
    |dash  |V:907,|221    |Sim   |Shell Almquist, bom para scripts  |
    |      |I:992 |       |      |da shell                          |
    |------+------+-------+------+----------------------------------|
    |zsh   |V:37, |2442   |Sim   |Z shell: a shell standard com     |
    |      |I:73  |       |      |muitas melhorias                  |
    |------+------+-------+------+----------------------------------|
    |mksh  |V:4,  |1469   |Sim   |Uma versão de Korn shell          |
    |      |I:12  |       |      |                                  |
    |------+------+-------+------+----------------------------------|
    |csh   |V:2,  |343    |Não   |OpenBSD shell C, uma versão do    |
    |      |I:8   |       |      |Berkeley csh                      |
    |------+------+-------+------+----------------------------------|
    |      |V:0,  |       |      |shell Stand-alone com comandos    |
    |sash  |I:6   |1054   |Sim   |embutidos (Não se destina a "/bin/|
    |      |      |       |      |sh" standard)                     |
    |------+------+-------+------+----------------------------------|
    |ksh   |V:3,  |3284   |Sim   |a real, versão AT&T da Korn shell |
    |      |I:16  |       |      |                                  |
    |------+------+-------+------+----------------------------------|
    |rc    |V:0,  |169    |Não   |implementação da rc shell AT&T    |
    |      |I:2   |       |      |Plan 9                            |
    |------+------+-------+------+----------------------------------|
    |posh  |V:0,  |190    |Sim   |Policy-compliant Ordinary SHell   |
    |      |I:0   |       |      |(deriva da pdksh)                 |
    +---------------------------------------------------------------+


    Dica

    Apesar das shells tipo POSIX partilharem a sintaxe básica, podem
    diferir no comportamento em coisas tão básicas como variáveis de
    shell e expansões glob. Por favor verifique as suas documentações
    para detalhes.

    Neste capítulo do tutorial, a shell interactiva significa sempre
    bash.

%

1.4.2. Personalizar bash

    Pode personalizar o comportamento da bash(1) em "~/.bashrc".

    Por exemplo, tente o seguinte.

    # enable bash-completion
    if ! shopt -oq posix; then
      if [ -f /usr/share/bash-completion/bash_completion ]; then
        . /usr/share/bash-completion/bash_completion
      elif [ -f /etc/bash_completion ]; then
        . /etc/bash_completion
      fi
    fi

    # CD upon exiting MC
    . /usr/lib/mc/mc.sh

    # set CDPATH to a good one
    CDPATH=.:/usr/share/doc:~:~/Desktop:~
    export CDPATH

    PATH="${PATH+$PATH:}/usr/sbin:/sbin"
    # set PATH so it includes user's private bin if it exists
    if [ -d ~/bin ] ; then
      PATH="~/bin${PATH+:$PATH}"
    fi
    export PATH

    EDITOR=vim
    export EDITOR

    Dica

    Pode encontrar mais dicas de personalização da bash, como os
    Secção 9.2.7, “Comandos coloridos”, em Capítulo 9, Dicas do
    sistema.

    Dica
   
    O pacote bash-completion activa preenchimento automático
    programável para bash.

%

1.4.3. Teclas especiais

    No ambiente do tipo Unix, existem algumas combinações de teclas
    que têm significados especiais. Por favor note que numa consola
    de caracteres normal do Linux, apenas as teclas Ctrl e Alt do
    lado esquerdo funcionam como se espera. Aqui estão algumas
    combinações de teclas notáveis para se lembrar.

    Tabela 1.14. Lista de teclas de atalho para bash

    +---------------------------------------------------------------+
    |         tecla          |     descrição do atalho da tecla     |
    |------------------------+--------------------------------------|
    |Ctrl-U                  |apagar a linha antes do cursor        |
    |------------------------+--------------------------------------|
    |Ctrl-H                  |apagar um caractere antes do cursor   |
    |------------------------+--------------------------------------|
    |Ctrl-D                  |termina a entrada (sai da shell se    |
    |                        |estiver a usar uma shell)             |
    |------------------------+--------------------------------------|
    |Ctrl-C                  |termina um programa em funcionamento  |
    |------------------------+--------------------------------------|
    |Ctrl-Z                  |pára temporariamente o programa ao    |
    |                        |movê-lo para segundo plano            |
    |------------------------+--------------------------------------|
    |Ctrl-S                  |pára a saída ao ecrã                  |
    |------------------------+--------------------------------------|
    |Ctrl-Q                  |reactiva a saída para o ecrã          |
    |------------------------+--------------------------------------|
    |Ctrl-Alt-Del            |reinicia/pára o sistema, veja inittab |
    |                        |(5)                                   |
    |------------------------+--------------------------------------|
    |Left-Alt-key            |meta-tecla para o Emacs e a UI        |
    |(opcionalmente,         |semelhante                            |
    |tecla-do-Windows)       |                                      |
    |------------------------+--------------------------------------|
    |Seta-para-cima          |inicia a busca no histórico de        |
    |                        |comandos em bash                      |
    |------------------------+--------------------------------------|
    |Ctrl-R                  |inicia o histórico de comandos        |
    |                        |incremental em bash                   |
    |------------------------+--------------------------------------|
    |Tab                     |completa a entrada do nome de ficheiro|
    |                        |para a linha de comandos em bash      |
    |------------------------+--------------------------------------|
    |Ctrl-V Tab              |entrada Tab sem expansão para a linha |
    |                        |de comandos em bash                   |
    +---------------------------------------------------------------+


    Dica
   
    A funcionalidade do terminal de Ctrl-S pode ser desactivada a
    usar stty(1).

%

1.4.4. Operações do rato ao estilo Unix

    As operações do rato ao estilo Unix são baseadas num sistema de
    rato de 3 botões.

    Tabela 1.15. Lista de operações de rato ao estilo Unix

    +---------------------------------------------------------------+
    |          acção           |              resposta              |
    |--------------------------+------------------------------------|
    |Clique-esquerdo-e-arrastar|selecionar e copiar para a área de  |
    |do rato                   |transferência                       |
    |--------------------------+------------------------------------|
    |Clique-esquerdo           |selciona o início da seleção        |
    |--------------------------+------------------------------------|
    |Clique-direito            |selciona o fim da seleção e copia à |
    |                          |área de transferência               |
    |--------------------------+------------------------------------|
    |Clique-central            |cola a área de transferência no     |
    |                          |cursor                              |
    +---------------------------------------------------------------+


    A roda central nos modernos ratos de roda é considerada o botão
    central do rato e pode ser usada como terceiro botão ou
    clique-central. Clicar nos botões esquerdo e direito ao mesmo
    tempo serve como clique-central em situações de sistema de rato
    de 2 botões. De modo a usar o rato em consolas de caracteres de
    Linux, necessita ter o daemon gpm(8) a correr.

%

1.4.5. O pager

    O comando less(1) é o paginador avançado (navegador de conteúdo
    de ficheiros). Ele lê o ficheiro especificado pelo seu argumento
    de comando ou pela sua entrada standard. Carregue em "h" se
    precisar de ajuda enquanto explora com o comando less. Pode fazer
    muito mais do que o more(1) e pode ser ampliado ao executar "eval
    $(lesspipe)" ou "eval $(lessfile)" no script de arranque de
    shell. Veja mais em "/usr/share/doc/less/LESSOPEN". A opção "-R"
    permite saída em caracteres em bruto e activa sequências de
    escape de cores ANSI. Veja less(1).

%

1.4.6. O editor de texto

    Deve tornar-se conhecedor de uma das variantes dos programas Vim
    ou Emacs que são populares em sistemas tipo Unix.

    Acho que habituar-se aos comandos do Vim é a coisa certa a fazer,
    pois o editor Vim está sempre presente no mundo Linux/Unix. (Na
    verdade, o vi original ou o novo nvi são programas que vai
    encontrar em todo o lado. Escolho o Vim para novatos porque é
    bastante semelhante e mais poderoso já que lhe oferece ajuda
    através da tecla F1 .)

    Pode escolher o Emacs ou o XEmacs como o seu editor favorito, que
    é realmente uma outra boa escolha, particularmente para a
    programação. O Emacs tem também um leque de outras
    funcionalidades, incluindo funcionar como um leitor de news,
    editor de diretório, programa de mail, etc. Quando é usado para
    programação ou edição de scripts de shell, é inteligente para
    reconhecer o formato daquilo em que está a trabalhar e tenta
    disponibilizar assistência. Algumas pessoas afirmam que o único
    programa que necessitam em Linux é o Emacs. 10 minutos a aprender
    Emacs agora pode poupar-lhe horas mais tarde. Ter o manual do
    Emacs GNU para referência quando se aprende Emacs é altamente
    recomendado.

    Todos estes programas vêm normalmente com um programa tutor para
    queaprenda a usá-los pela prática. Arranque o Vim ao escrever
    "vim" e carregue an tecla F1. Deverá ler pelo menos as primeiras
    35 linhas. Depois faça o curso de treino online ao mover o cursor
    para "|tutor|" e pressionar Ctrl-].

    Nota

    Os bons editores, como o Vim e o Emacs, podem lidar corretamente
    com UTF-8 e outros textos com codificações exóticas. É uma boa
    ideia usar o ambiente X com o locale UTF-8 e instalar as fontes e
    programas necessários para tal. Os editores têm opções para
    definir a codificação do ficheiro independentemente do ambiente
    X. Por favor consulte a documentação acerca de texto multibyte.

%

1.4.7. Definir um editor de texto predefinido

    Debian vem com uma quantia de editores diferentes. Recomendamos
    instalar o pacote vim, como mencionado anteriormente.

    Debian disponibiliza acesso unificado ao editor predefinido do
    sistema através do comando "/usr/bin/editor" para que outros
    programas (p.e., reportbug(1)) possam invocá-lo. Pode alterá-lo
    com o seguinte:

    $ sudo update-alternatives --config editor

    A escolha de "/usr/bin/vim.basic" em vez de "/usr/bin/vim.tiny" é
    uma recomendação minha para novatos pois suporta destaque de
    sintaxe.

    Dica

    Muitos programas utilizam as variáveis de ambiente "$EDITOR" ou
    "$VISUAL" para decidir qual o editor que vai utilizar (veja
    Secção 1.3.5, “O editor interno em MC” e Secção 9.3.11,
    “Personalizar o programa a ser iniciado”). Para consistência no
    sistema Debian, defina estas para "/usr/bin/editor".
    (Historicamente, "$EDITOR" era "ed" e "$VISUAL" era "vi".)

%

1.4.8. Personalizar o vim

    Pode personalizar o comportamento do vim(1) em "~/.vimrc".

    Por exemplo, tente o seguinte:

    " -------------------------------
    " Local configuration
    "
    set nocompatible
    set nopaste
    set pastetoggle=<f2>
    syn on
    if $USER == "root"
     set nomodeline
     set noswapfile
    else
     set modeline
     set swapfile
    endif
    " filler to avoid the line above being recognized as a modeline
    " filler
    " filler

%

1.4.9. Gravar as atividades da shell

    O resultado do comando na shell pode sair fora do seu ecrã e
    ficar perdido para sempre. É uma boa prática registar as
    atividades da shell num ficheiro para rever mais tarde. Este tipo
    de registo é essencial quando executa quaisquer tarefas de
    administração do sistema.

    O método básico de gravar a atividade da shell é corrê-la sob 
    script(1).

    Por exemplo, tente o seguinte:

    $ script
    Script iniciado, ficheiro é typescript

    Faz quaisquer comandos de shell sob script.

    Carregue em Ctrl-D para terminar o script.

    $ vim typescript

    Veja Secção 9.2.3, “Gravar as atividades da shell de modo limpo”
    .

%

1.4.10. Comandos básicos de Unix

    Vamos aprender comandos básicos do Unix. Aqui Uso "Unix" no
    sentido genérico dele. Geralmente qualquer SO clone do Unix
    oferece comandos equivalentes. O sistema Debian não é excepção.
    Não se preocupe se alguns comandos não funcionarem como deseja
    por agora. Se for utilizado alias na shell, as saídas dos
    comandos correspondentes serão diferentes. Estes exemplos não se
    destinam a ser executados por esta ordem.

    Tente os seguintes comandos a partir da conta de utilizador
    não-privilegiado.

    Tabela 1.16. lista dos comandos Unix básicos

    +---------------------------------------------------------------+
    |     comando     |                  descrição                  |
    |-----------------+---------------------------------------------|
    |pwd              |mostrar o nome do diretório atual            |
    |-----------------+---------------------------------------------|
    |whoami           |mostrar o nome do utilizador atual           |
    |-----------------+---------------------------------------------|
    |id               |mostrar a identidade do utilizador atual     |
    |                 |(nome, uid, gid e grupos associados)         |
    |-----------------+---------------------------------------------|
    |file <foo>       |mostrar o tipo de ficheiro para o ficheiro " |
    |                 |<foo>"                                       |
    |-----------------+---------------------------------------------|
    |type -p          |mostrar a localização de um ficheiro do      |
    |<nome_do_comando>|comando "<nome_do_comando>"                  |
    |-----------------+---------------------------------------------|
    |which            |, ,                                          |
    |<nome_do_comando>|                                             |
    |-----------------+---------------------------------------------|
    |type             |mostrar informação do comando "              |
    |<nome_do_comando>|<nome_do_comando>"                           |
    |-----------------+---------------------------------------------|
    |apropos          |mostrar comandos relacionados com a "        |
    |<palavra_chave>  |<palavra_chave>"                             |
    |-----------------+---------------------------------------------|
    |man -k           |, ,                                          |
    |<palavra_chave>  |                                             |
    |-----------------+---------------------------------------------|
    |whatis           |mostrar a explicação de uma linha para o     |
    |<nome_do_comando>|comando "<nome_do_comando>"                  |
    |-----------------+---------------------------------------------|
    |man -a           |mostrar a explicação do comando "            |
    |<nome_do_comando>|<nome_do_comando>" (estilo Unix)             |
    |-----------------+---------------------------------------------|
    |info             |mostrar uma explicação longa do comando "    |
    |<nome_do_comando>|<nome_do_comando>" (estilo GNU)              |
    |-----------------+---------------------------------------------|
    |ls               |listar o conteúdo do diretório (ficheiros e  |
    |                 |diretórios não escondidos)                   |
    |-----------------+---------------------------------------------|
    |ls -a            |listar o conteúdo do diretório (todos os     |
    |                 |ficheiros e diretórios)                      |
    |-----------------+---------------------------------------------|
    |                 |listar o conteúdo do diretório (quase todos  |
    |ls -A            |os ficheiros e diretórios, isto é, salta o   |
    |                 |".." e ".")                                  |
    |-----------------+---------------------------------------------|
    |ls -la           |listar todo o conteúdo do diretório com      |
    |                 |informação detalhada                         |
    |-----------------+---------------------------------------------|
    |ls -lai          |listar todo o conteúdo do diretório com      |
    |                 |número de inode e informação detalhada       |
    |-----------------+---------------------------------------------|
    |ls -d            |listar todos os diretórios sob o diretório   |
    |                 |atual                                        |
    |-----------------+---------------------------------------------|
    |tree             |mostrar o conteúdo da árvore de ficheiros    |
    |-----------------+---------------------------------------------|
    |lsof <foo>       |listar o estado aberto do ficheiro "<foo>"   |
    |-----------------+---------------------------------------------|
    |lsof -p <pid>    |listar ficheiros abertos pelo processo de ID:|
    |                 |"<pid>"                                      |
    |-----------------+---------------------------------------------|
    |mkdir <foo>      |criar um novo diretório "<foo>" no diretório |
    |                 |atual                                        |
    |-----------------+---------------------------------------------|
    |rmdir <foo>      |remover um diretório "<foo>" no diretório    |
    |                 |atual                                        |
    |-----------------+---------------------------------------------|
    |                 |mudar o diretório para o diretório "<foo>" no|
    |cd <foo>         |diretório atual ou no diretório listado na   |
    |                 |variável "$CDPATH"                           |
    |-----------------+---------------------------------------------|
    |cd /             |mudar o diretório para o diretório raiz      |
    |-----------------+---------------------------------------------|
    |cd               |mudar ao diretório home do utilizador atual  |
    |-----------------+---------------------------------------------|
    |cd /<foo>        |mudar para o diretório de caminho absoluto "/|
    |                 |<foo>"                                       |
    |-----------------+---------------------------------------------|
    |cd ..            |mudar ao diretório pai                       |
    |-----------------+---------------------------------------------|
    |cd ~<foo>        |mudar ao diretório home do utilizador "<foo>"|
    |-----------------+---------------------------------------------|
    |cd -             |mudar ao diretório anterior                  |
    |-----------------+---------------------------------------------|
    |</etc/motd pager |mostrar o conteúdo de "/etc/motd" a utilizar |
    |                 |o paginador predefinido                      |
    |-----------------+---------------------------------------------|
    |touch <junkfile> |criar um ficheiro vazio "<junkfile>"         |
    |-----------------+---------------------------------------------|
    |cp <foo> <bar>   |copiar um ficheiro "<foo>" existente para um |
    |                 |novo ficheiro "<bar>"                        |
    |-----------------+---------------------------------------------|
    |rm <junkfile>    |remover um ficheiro "<junkfile>"             |
    |-----------------+---------------------------------------------|
    |                 |renomear um ficheiro "<foo>" existente para  |
    |mv <foo> <bar>   |um novo nome "<bar>" ("<bar>" não pode       |
    |                 |existir)                                     |
    |-----------------+---------------------------------------------|
    |                 |mover um ficheiro "<foo>" existente para uma |
    |mv <foo> <bar>   |nova localização <bar>/<foo>" (o diretório " |
    |                 |<bar>" tem de existir)                       |
    |-----------------+---------------------------------------------|
    |                 |mover um ficheiro existente "<foo>" para uma |
    |mv <foo> <bar>/  |nova localização com um novo nome "<bar>/    |
    |<baz>            |<baz>" (o diretório "<bar>" tem de existir   |
    |                 |mas o diretório "<bar>/<baz>" não pode       |
    |                 |existir)                                     |
    |-----------------+---------------------------------------------|
    |                 |tornar um ficheiro existente "<foo>" proibido|
    |chmod 600 <foo>  |de ser lido e ser escrito por outras pessoas |
    |                 |(não executável para todos)                  |
    |-----------------+---------------------------------------------|
    |                 |tornar um ficheiro existente "<foo>"         |
    |chmod 644 <foo>  |permissível de ser lido mas proibido de ser  |
    |                 |escrito por outras pessoas (não executável   |
    |                 |para todos)                                  |
    |-----------------+---------------------------------------------|
    |                 |tornar um ficheiro existente "<foo>"         |
    |chmod 755 <foo>  |permissível de ser lido mas proibido de ser  |
    |                 |escrito por outras pessoas (executável para  |
    |                 |todos)                                       |
    |-----------------+---------------------------------------------|
    |find . -name     |procurar nomes de ficheiros correspondentes a|
    |<modelo>         |usar um "<modelo>" de shell (lento)          |
    |-----------------+---------------------------------------------|
    |locate -d .      |procurar nomes de ficheiros correspondentes a|
    |<modelo>         |usar um "<modelo>" de shell (mais rápido a   |
    |                 |usar uma base de dados gerada regularmente)  |
    |-----------------+---------------------------------------------|
    |grep -e "<modelo>|procura um "<modelo>" em todos os ficheiros  |
    |" *.html         |terminados com ".html" no diretório atual e  |
    |                 |mostra-os todos                              |
    |-----------------+---------------------------------------------|
    |top              |mostrar informação de processos a usar ecrã  |
    |                 |completo, carregue em "q" para sair          |
    |-----------------+---------------------------------------------|
    |ps aux | pager   |mostrar informação dos processos a correr a  |
    |                 |usar saída ao estilo BSD                     |
    |-----------------+---------------------------------------------|
    |ps -ef | pager   |mostrar informação dos processos a correr a  |
    |                 |usar saída ao estilo Unix system-V           |
    |-----------------+---------------------------------------------|
    |ps aux | grep -e |mostrar todos os processos que correm "exim" |
    |"[e]xim4*"       |e "exim4"                                    |
    |-----------------+---------------------------------------------|
    |ps axf | pager   |mostrar a informação de todos os processos a |
    |                 |correr com saída em arte de ASCII            |
    |-----------------+---------------------------------------------|
    |kill <1234>      |matar todos os processos identificados pelo  |
    |                 |ID de processo: "<1234>"                     |
    |-----------------+---------------------------------------------|
    |gzip <foo>       |comprimir "<foo>" para criar "<foo>.gz" a    |
    |                 |usar a codificação Lempel-Ziv (LZ77)         |
    |-----------------+---------------------------------------------|
    |gunzip <foo>.gz  |descomprimir "<foo>.gz" para criar "<foo>"   |
    |-----------------+---------------------------------------------|
    |                 |comprimir "<foo>" para criar "<foo>.bz2" a   |
    |                 |usar o algoritmo de compressão de texto      |
    |bzip2 <foo>      |organizado em blocos Burrows-Wheeler e       |
    |                 |codificação Huffman (melhor compressão que   |
    |                 |gzip)                                        |
    |-----------------+---------------------------------------------|
    |bunzip2 <foo>.bz2|descomprimir "<foo>.bz2" para criar "<foo>"  |
    |-----------------+---------------------------------------------|
    |                 |comprimir "<foo>" para criar "<foo>.xz" a    |
    |xz <foo>         |usar o algoritmo de cadeia Lempel–Ziv–Markov |
    |                 |(melhor compressão que bzip2)                |
    |-----------------+---------------------------------------------|
    |unxz <foo>.xz    |descomprimir "<foo>.xz" para criar "<foo>"   |
    |-----------------+---------------------------------------------|
    |tar -xvf         |extrair ficheiros do arquivo "<foo>.tar"     |
    |<foo>.tar        |                                             |
    |-----------------+---------------------------------------------|
    |tar -xvzf        |extrair ficheiros do arquivo gzipado "       |
    |<foo>.tar.gz     |<foo>.tar.gz"                                |
    |-----------------+---------------------------------------------|
    |tar -xvjf        |extrair ficheiros do arquivo "<foo>.tar.bz2" |
    |<foo>.tar.bz2    |                                             |
    |-----------------+---------------------------------------------|
    |tar -xvJf        |extrair ficheiros do arquivo "<foo>.tar.xz"  |
    |<foo>.tar.xz     |                                             |
    |-----------------+---------------------------------------------|
    |tar -cvf         |arquivar o conteúdo da pasta "<bar>/" no     |
    |<foo>.tar <bar>/ |arquivo "<foo>.tar"                          |
    |-----------------+---------------------------------------------|
    |tar -cvzf        |arquivar o conteúdo da pasta "<bar>/" no     |
    |<foo>.tar.gz     |arquivo comprimido "<foo>.tar.gz"            |
    |<bar>/           |                                             |
    |-----------------+---------------------------------------------|
    |tar -cvjf        |arquivar o conteúdo da pasta "<bar>/" no     |
    |<foo>.tar.bz2    |arquivo "<foo>.tar.bz2"                      |
    |<bar>/           |                                             |
    |-----------------+---------------------------------------------|
    |tar -cvJf        |arquivar o conteúdo da pasta "<bar>/" no     |
    |<foo>.tar.xz     |arquivo "<foo>.tar.xz"                       |
    |<bar>/           |                                             |
    |-----------------+---------------------------------------------|
    |zcat README.gz | |mostrar o conteúdo do "README.gz" comprimido |
    |pager            |a usar o paginador predefinido               |
    |-----------------+---------------------------------------------|
    |zcat README.gz > |criar o ficheiro "foo" com o conteúdo        |
    |foo              |descomprimido de "README.gz"                 |
    |-----------------+---------------------------------------------|
    |zcat README.gz >>|acrescentar o conteúdo descomprimido de      |
    |foo              |"README.gz" ao final do ficheiro "foo" (se   |
    |                 |ele não existir, é primeiro criado)          |
    +---------------------------------------------------------------+


    Nota

    Unix tem a tradição de esconder os nomes de ficheiros que começam
    por ".". Eles são tradicionalmente ficheiros que contêm
    informação de configuração e preferências do utilizador.

    Nota
   
    Para o comando cd, veja builtins(7).

    Nota

    O paginador predefinido da vastidão do sistema Debian é o more(1)
    , o qual não pode deslocar para trás. A instalar o pacote less a
    usar o comando "apt-get install less", o less(1) torna-se o
    paginador predefinido e pode deslocar para trás com as teclas do
    cursor.

    Nota

    O "[" e "]" na expressão regular do comando "ps aux | grep -e "
    [e]xim4*"" em cima activam grep para evitar a correspondência
    consigo próprio. O "4*" na expressão regular significa 0 ou mais
    repetições do caractere "4" assim activa o grep a corresponder a
    ambos "exim" e "exim4". Apesar de "*" ser usado no glob de nome
    de ficheiro da shell e na expressão regular, os seus significados
    são diferentes. Aprenda a expressão regular a partir do grep(1).

    Por favor percorra os diretórios e espreite no sistema a usar os
    comandos em cima como treino. Se tiver questões sobre qualquer
    comando de consola, por favor certifique-se de ler o manual dele.

    Por exemplo, tente o seguinte:

    $ man man
    $ man bash
    $ man builtins
    $ man grep
    $ man ls

    Pode ser um pouco difícil de habituar-se ao estilo dos manuais,
    porque são bastante concisos, particularmente os mais antigos,
    muito tradicionais. Mas assim que se habituar a eles, vai
    apreciar a brevidade deles.

    Por favor note que muitos comandos do tipo Unix incluindo os GNU
    e BSD mostram informação breve de ajuda se os invocar numa das
    seguintes formas (ou sem argumentos nalguns casos).

    $ <nome_do_comando> --help
    $ <nome_do_comando> -h

%

1.5. O comando simples da shell

    Agora tem alguma prática de como utilizar o sistema Debian. Vamos
    ver mais fundo no mecanismo da execução de comandos no sistema
    Debian. Aqui simplifiquei a realidade para o novato. Veja bash(1)
    para a explicação exata.

    Um comando simples é uma sequência de componentes.

     1. Atribuições de variáveis (opcional)

     2. Nome do comando

     3. Argumentos (opcional)

     4. Re-direcções (opcional: > , >> , < , << , etc.)

     5. Operador de controle (opcional: && , || , <nova-linha> , ; ,
        & , ( , ) )

%

1.5.1. Execução do comando e variável de ambiente

    Os valores de algumas variáveis de ambiente modificam o
    comportamento de alguns comandos de Unix.

    Os valores predefinidos das variáveis de ambiente são definidos
    inicialmente pelo sistema PAM e depois alguns deles podem ser
    redefinidos por alguns programas.

      * O gestor de ecrã como o gdm3 redefine variáveis de ambiente.
   
      * A shell nos seus códigos de arranque redefine variáveis de
        ambiente em "~/.bash_profile" e "~/.bashrc".

%

1.5.2. A variável "$LANG"

    O valor completo do locale dado à variável "$LANG" consiste em 3
    partes: "xx_YY.ZZZZ".

    Tabela 1.17. As 3 partes do valor locale

    +---------------------------------------------------------------+
    |   valor   |                    significado                    |
    |  locale   |                                                   |
    |-----------+---------------------------------------------------|
    |xx         |códigos de idioma ISO 639 (minúsculas) como em "en"|
    |-----------+---------------------------------------------------|
    |YY         |códigos de idioma ISO 3166 (maiúsculas) como em    |
    |           |"US"                                               |
    |-----------+---------------------------------------------------|
    |ZZZZ       |conjunto de codificação, definido sempre como      |
    |           |"UTF-8"                                            |
    +---------------------------------------------------------------+


    Para códigos de idioma e códigos de países, veja a informação
    pertinente em "info gettext".

    Para o conjunto de codificação no sistema Debian moderno, deverá
    sempre defini-lo para UTF-8 a menos que queira especificamente
    usar o histórico a ter boas razões e conhecimentos para o fazer.

    Para mais detalhes sobre configuração do locale, veja Secção 8.4,
    “O locale”.

    Nota
   
    No sistema Debian, certifique-se de instalar o pacote locales-all
    para usar todos os locales.

    Nota
   
    O "LANG=en_US" não é "LANG=C" nem "LANG=en_US.UTF-8". É "LANG=
    en_US.ISO-8859-1" (veja Secção 8.4.1, “Bases de codificação”).

    Tabela 1.18. Lista de recomendações de locale

    +-----------------------------------------------------+
    |recomendação de locale|        Idioma (área)         |
    |----------------------+------------------------------|
    |en_US.UTF-8           |Inglês (EUA)                  |
    |----------------------+------------------------------|
    |en_GB.UTF-8           |Inglês (Grã-Bretanha)         |
    |----------------------+------------------------------|
    |fr_FR.UTF-8           |Francês (França)              |
    |----------------------+------------------------------|
    |de_DE.UTF-8           |Alemão (Alemanha)             |
    |----------------------+------------------------------|
    |it_IT.UTF-8           |Italiano (Itália)             |
    |----------------------+------------------------------|
    |es_ES.UTF-8           |Espanhol (Espanha)            |
    |----------------------+------------------------------|
    |ca_ES.UTF-8           |Catalão (Espanha)             |
    |----------------------+------------------------------|
    |sv_SE.UTF-8           |Sueco (Suécia)                |
    |----------------------+------------------------------|
    |pt_BR.UTF-8           |Português (Brasil)            |
    |----------------------+------------------------------|
    |ru_RU.UTF-8           |Russo (Rússia)                |
    |----------------------+------------------------------|
    |zh_CN.UTF-8           |Chinês (Rep. Popular da China)|
    |----------------------+------------------------------|
    |zh_TW.UTF-8           |Chinês (Taiwan R.O.C.)        |
    |----------------------+------------------------------|
    |ja_JP.UTF-8           |Japonês (Japão)               |
    |----------------------+------------------------------|
    |ko_KR.UTF-8           |Coreano (República da Coreia) |
    |----------------------+------------------------------|
    |vi_VN.UTF-8           |Vietnamita (Vietname)         |
    +-----------------------------------------------------+


    A execução de comando típica utiliza uma sequência de linha de
    shell como o seguinte.

    $ date
    Sun Jun  3 10:27:39 JST 2007
    $ LANG=fr_FR.UTF-8 date
    dimanche 3 juin 2007, 10:27:33 (UTC+0900)

    Aqui, o programa date(1) é executado com diferentes valores da
    variável de ambiente "$LANG".

      * Para o primeiro comando, "$LANG" é definida ao valor locale
        predefinido do sistema "en_US.UTF-8".
   
      * Para o segundo comando, "$LANG" é definida ao valor locale
        UTF-8 Francês "fr_FR.UTF-8".

    A maioria das execuções de comandos geralmente não têm definições
    de variáveis de ambiente precedentes. Para o exemplo acima, pode
    executar em alternativa o seguinte:

    $ LANG=fr_FR.UTF-8
    $ date
    dimanche 3 juin 2007, 10:27:33 (UTC+0900)

    Como pode ver aqui, o resultado do comando é afectado pela
    variável de ambiente para produzir a saída em Francês. Se desejar
    que a variável de ambiente seja hereditária aos sub-processos
    (p.e. quando chama um script de shell), então necessita de 
    exportá-la com o seguinte.

    $ export LANG

    Nota

    Quando usa um terminal de consola típico, a variável de ambiente
    "$LANG" é geralmente definida para ser exportada pelo ambiente de
    trabalho. Portanto o exemplo de cima não é realmente um bom
    exemplo para testar o efeito do export.

    Dica

    Se utilizar um ambiente que não seja em Inglês quando preencher
    um relatório de bug, é uma boa ideia executar e verificar o
    comando com "LANG=en_US.UTF-8".

    Veja locale(5) e locale(7) para "$LANG" e variáveis de ambiente
    relacionadas.

    Nota

    Recomendo configurar o ambiente do sistema apenas pela variável
    "$LANG" e não mexer em variáveis "$LC_*" a menos que seja
    absolutamente necessário.

%

1.5.3. A variável "$PATH"

    Quando escreve um comando na shell, a shell procura o comando na
    lista de diretórios contida na variável de ambiente "$PATH". O
    valor da variável de ambiente "$PATH" também é chamado o caminho
    de procura da shell.

    Na instalação Debian, por omissão, a variável de ambiente "$PATH"
    das contas de utilizadores pode não incluir "/sbin" nem "/usr/
    sbin". Por exemplo, o comando ifconfig necessita ser chamado com
    o caminho completo como "/sbin/ifconfig". (De modo idêntico, o
    comando ip está localizado em "/bin".)

    Pode alterar a variável de ambiente "$PATH" da shell Bash pelos
    ficheiros "~/.bash_profile" ou "~/.bashrc".

%

1.5.4. A variável "$HOME"

    Muitos comandos armazenam configurações específicas do utilizador
    no diretório home do utilizador e mudam o comportamento dele de
    acordo com o conteúdo dele. O diretório de utilizador é
    identificado pela variável de ambiente "$HOME".

    Tabela 1.19. Lista de valores "$HOME"

    +---------------------------------------------------------------+
    | valor de "$HOME"  |     situação de execução do programa      |
    |-------------------+-------------------------------------------|
    |/                  |programa executado pelo processo de init   |
    |                   |(daemon)                                   |
    |-------------------+-------------------------------------------|
    |/root              |programa executado a partir da shell de    |
    |                   |root normal                                |
    |-------------------+-------------------------------------------|
    |/home/             |programa executado a partir da shell de    |
    |<utilizador_normal>|utilizador normal                          |
    |-------------------+-------------------------------------------|
    |/home/             |programa executado a partir menu do        |
    |<utilizador_normal>|ambiente GUI do utilizador normal          |
    |-------------------+-------------------------------------------|
    |/home/             |programa executado como root com o         |
    |<utilizador_normal>|"programa sudo"                            |
    |-------------------+-------------------------------------------|
    |/root              |programa executado como root com o         |
    |                   |"programa sudo -H"                         |
    +---------------------------------------------------------------+


    Dica

    A shell expande "~/" ao diretório home do utilizador atual, isto
    é, "$HOME/". A shell expande "~foo/" ao diretório home de foo,
    isto é, "/home/foo/".

%

1.5.5. Opções da linha de comandos

    Alguns comandos recebem argumentos. Os argumentos que começam com
    um "-" ou "--" são chamados opções e controlam o comportamento do
    comando.

    $ date
    Mon Oct 27 23:02:09 CET 2003
    $ date -R
    Mon, 27 Oct 2003 23:02:40 +0100

    Aqui o argumento de linha de comandos "-R" altera o comportamento
    de date(1) para gerar uma string da data compatível com RFC2822.

%

1.5.6. Glob da shell

    Frequentemente deseja trabalhar com um conjunto de ficheiros sem
    os digitar a todos. O modelo de expansão do nome de ficheiro a
    utilizar a glob da shell , (por vezes referida como wildcards),
    facilita esta necessidade.

    Tabela 1.20. Padrões glob da shell

    +---------------------------------------------------------------+
    |modelo glob|       descrição de regra de correspondência       |
    | da shell  |                                                   |
    |-----------+---------------------------------------------------|
    |*          |nome de ficheiro (segmento) não iniciado por "."   |
    |-----------+---------------------------------------------------|
    |.*         |nome de ficheiro (segmento) iniciado por "."       |
    |-----------+---------------------------------------------------|
    |?          |exatamente um caractere                            |
    |-----------+---------------------------------------------------|
    |[…]        |exatamente um caractere com qualquer caractere     |
    |           |envolvido em colchetes                             |
    |-----------+---------------------------------------------------|
    |[a-z]      |exatamente um caractere com qualquer caractere     |
    |           |entre "a" e "z"                                    |
    |-----------+---------------------------------------------------|
    |[^…]       |exatamente um caractere que não seja qualquer      |
    |           |caractere envolvido em colchetes (a excluir "^")   |
    +---------------------------------------------------------------+


    Por exemplo, tente o seguinte:

    $ mkdir junk; cd junk; touch 1.txt 2.txt 3.c 4.h .5.txt ..6.txt
    $ echo *.txt
    1.txt 2.txt
    $ echo *
    1.txt 2.txt 3.c 4.h
    $ echo *.[hc]
    3.c 4.h
    $ echo .*
    . .. .5.txt ..6.txt
    $ echo .*[^.]*
    .5.txt ..6.txt
    $ echo [^1-3]*
    4.h
    $ cd ..; rm -rf junk

    Veja glob(7).

    Nota

    Ao contrário da expansão de nome de ficheiro da shell, o modelo
    de shell "*" testado em find(1) com o teste "-name" etc.,
    corresponde ao "." inicial do nome de ficheiro. (Nova
    funcionalidade POSIX)

    Nota

    BASH pode ser moldado a alterar o comportamento de glob dele com
    as opções shopt dele embutidas como as "dotglob", "noglob",
    "nocaseglob", "nullglob", "extglob", etc. Veja bash(1).

%

1.5.7. Valor de retorno do comando

    Cada comando retorna o estado de saída dele (na variável: "$?")
    como o valor de retorno.

    Tabela 1.21. Códigos de saída do comando

    +---------------------------------------------------------------+
    | estado de saída do  |  valor de retorno   | valor de retorno  |
    |       comando       |      numérico       |      lógico       |
    |---------------------+---------------------+-------------------|
    |sucesso              |zero, 0              |TRUE               |
    |---------------------+---------------------+-------------------|
    |erro                 |não-zero, -1         |FALSE              |
    +---------------------------------------------------------------+


    Por exemplo, tente o seguinte.

    $ [ 1 = 1 ] ; echo $?
    0
    $ [ 1 = 2 ] ; echo $?
    1

    Nota

    Por favor note que, no contexto lógico da shell, sucesso é
    tratado como o VERDADEIRO lógico o qual tem 0 (zero) como valor.
    De certa maneira isto não é intuitivo e necessita ser lembrado
    aqui.

%

1.5.8. Sequências de comandos típicas e redireccionamento da shell

    Vamos tentar lembrar-nos dos seguintes idiomas de comando de
    shell escritos numa linha como parte de um comando de shell.

    Tabela 1.22. Idiomas de comandos de shell

    +---------------------------------------------------------------+
    | idioma do |                     descrição                     |
    |  comando  |                                                   |
    |-----------+---------------------------------------------------|
    |comando &  |execução em segundo plano do comando na sub-shell  |
    |-----------+---------------------------------------------------|
    |comando1 | |liga em pipe a saída standard do comando1 à entrada|
    |comando2   |standard do comando2 (execução concorrente)        |
    |-----------+---------------------------------------------------|
    |comando1 2>|liga em pipe a saídas standard e o erro standard do|
    |&1 |       |comando1 à entrada standard do comando2 (execução  |
    |comando2   |concorrente)                                       |
    |-----------+---------------------------------------------------|
    |comando1 ; |executa o comando1 e o comando2 sequencialmente    |
    |comando2   |                                                   |
    |-----------+---------------------------------------------------|
    |comando1 &&|executa o comando1; se tiver sucesso, executa o    |
    |comando2   |comando2 sequencialmente (retorna sucesso se ambos |
    |           |comando1 e comando2 tiverem sucesso)               |
    |-----------+---------------------------------------------------|
    |comando1 |||executa o comando1; se não tiver sucesso, executa o|
    |comando2   |comando2 sequencialmente (retorna sucesso se o     |
    |           |comando1 ou o comando2 tiverem sucesso             |
    |-----------+---------------------------------------------------|
    |comando >  |redirecciona a saída standard do comando para o    |
    |foo        |ficheiro foo (sobrescreve)                         |
    |-----------+---------------------------------------------------|
    |comando 2> |redirecciona o erro standard do comando para o     |
    |foo        |ficheiro foo (sobrescreve)                         |
    |-----------+---------------------------------------------------|
    |comando >> |redirecciona a saída standard do comando para o    |
    |foo        |ficheiro foo (acrescenta)                          |
    |-----------+---------------------------------------------------|
    |comando 2>>|redireciona o erro standard do comando ao ficheiro |
    |foo        |foo (acrescenta)                                   |
    |-----------+---------------------------------------------------|
    |comando >  |redirecciona ambos saída standard e erro standard  |
    |foo 2>&1   |do comando para o ficheiro foo                     |
    |-----------+---------------------------------------------------|
    |comando <  |redirecciona a entrada standard do comando ao      |
    |foo        |ficheiro foo                                       |
    |-----------+---------------------------------------------------|
    |comando << |redirecciona a entrada standard do comando para as |
    |delimitador|seguintes linhas até que o "delimitador" seja      |
    |           |atingido (documentar aqui)                         |
    |-----------+---------------------------------------------------|
    |           |redirecciona a entrada standard do comando às      |
    |comando <<-|seguintes linhas até que o "delimitador" seja      |
    |delimitador|atingido (aqui documento, os caracteres tab de     |
    |           |inicio são retirados das linhas de entrada)        |
    +---------------------------------------------------------------+


    O sistema Debian é um sistema de multi-tarefa. Os trabalhos em
    segundo plano permitem aos utilizadores correrem vários programas
    numa única shell. A gestão dos processos em segundo plano envolve
    os embutidos da shell: jobs, fg, bg e kill. Por favor leia as
    secções de bash(1) sob "SINAIS", "CONTROLE DE TAREFAS" e builtins
    (1).

    Por exemplo, tente o seguinte:

    $ </etc/motd pager

    $ pager </etc/motd

    $ pager /etc/motd

    $ cat /etc/motd | pager

    Apesar dos 4 exemplos de redireccionamentos de shell mostrarem a
    mesma coisa, o último exemplo corre um comando cat extra e
    desperdiça recursos sem nenhuma razão.

    A shell permite-lhe abrir ficheiros a usar o exec embutido com um
    descritor de ficheiro arbitrário.

    $ echo Hello >foo
    $ exec 3<foo 4>bar  # abrir ficheiros
    $ cat <&3 >&4       # redireccionar stdin para 3, stdout para 4
    $ exec 3<&- 4>&-    # fechar ficheiros
    $ cat bar
    Hello

    O descritores de ficheiro 0-2 são predefinidos.

    Tabela 1.23. Descritores de ficheiro predefinido

    +-----------------------------------------------+
    |aparelho|   descrição    |descritor de ficheiro|
    |--------+----------------+---------------------|
    |stdin   |entrada standard|0                    |
    |--------+----------------+---------------------|
    |stdout  |saída standard  |1                    |
    |--------+----------------+---------------------|
    |stderr  |erro standard   |2                    |
    +-----------------------------------------------+


%

1.5.9. Comando alias

    Pode definir um nome alternativo (alias) para um comando
    frequentemente utilizado.

    Por exemplo, tente o seguinte:

    $ alias la='ls -la'

    Agora, "la" funciona como atalho para "ls -la" o que lista todos
    os ficheiros no formato de lista longa.

    Pode listar quaisquer nomes alternativos existentes com o alias
    (veja bash(1) sob "COMANDOS EMBUTIDOS NA SHELL").

    $ alias
    ...
    alias la='ls -la'

    Pode identificar o caminho exacto ou a identidade do comando com
    type (veja bash(1) sob "COMANDOS EMBUTIDOS DA SHELL").

    Por exemplo, tente o seguinte:

    $ type ls
    ls is hashed (/bin/ls)
    $ type la
    la is aliased to ls -la
    $ type echo
    echo is a shell builtin
    $ type file
    file is /usr/bin/file

    Aqui o ls foi procurado recentemente enquanto o "file" não foi,
    assim o "ls" tem "hash", isto é, a shell tem um registo interno
    para o acesso rápido à localização do comando "ls".

    Dica
   
    Veja Secção 9.2.7, “Comandos coloridos”.

%

1.6. Processamento de texto estilo Unix

    Em ambientes de trabalho tipo Unix, o processamento de texto é
    feito ao canalizar texto por cadeias de ferramentas standard de
    processamento de texto. Esta foi outra inovação crucial do Unix.

%

1.6.1. Ferramentas de texto de Unix

    Existem algumas ferramentas standard de processamento de texto
    que são muito usadas nos sistemas tipo Unix.

      * Não é utilizada nenhuma expressão regular:

          + cat(1) concatena ficheiros e escreve o conteúdo inteiro.

          + tac(1) concatena ficheiros e escreve-os em reverso.

          + cut(1) seleciona partes de linhas e escreve-as.

          + head(1) escreve a parte inicial de ficheiros.

          + tail(1) escreve a parte final de ficheiros.

          + sort(1) organiza as linhas de ficheiros de texto.

          + uniq(1) remove linhas duplicadas de um ficheiro
            organizado.

          + tr(1) traduz ou apaga caracteres.

          + diff(1) compara ficheiros linha a linha.

      * É utilizada uma expressão regular básica (BRE):

          + grep(1) faz coincidir texto com padrões.

          + ed(1) é um editor de linhas primitivo.
   
          + sed(1) é um editor de streams.

          + vim(1) é um editor de ecrã.

          + emacs(1) é um editor de écran. (BRE de certo modo
            extensa)

      * É utilizada uma expressão regular extensa (ERE):

          + egrep(1) faz coincidir texto com padrões.

          + awk(1) faz processamento de texto simples.

          + tcl(3tcl) pode fazer todo o processamento de texto
            concebível: Veja re_syntax(3). Bastante usado com tk(3tk)
            .

          + perl(1) pode fazer todo o processamento de texto
            concebível. Veja perlre(1).

          + pcregrep(1) do pacote pcregrep corresponde texto com
            padrões Perl Compatible Regular Expressions (PCRE).

          + python(1) com o módulo re pode fazer todo o processamento
            de texto concebível. Veja "/usr/share/doc/python/html/
            index.html".

    Se não tiver a certeza do que estes comandos fazem, por favor
    utilize "man comando" para descobri-lo por si.

    Nota

    A ordenação e alcance da expressão dependem do locale. Se desejar
    obter o comportamento tradicional para um comando, use o locale C
    em vez dos UTF-8 ao preceder o comando com "LANG=C" (veja
    Secção 1.5.2, “A variável "$LANG"” e Secção 8.4, “O locale”).

    Nota

    As expressões regulares Perl (perlre(1)), Perl Compatible Regular
    Expressions (PCRE) e expressões regulares Python oferecidas pelo
    módulo re têm muitas extensões comuns ao ERE normal.

%

1.6.2. Expressões regulares

    As expressões regulares são utilizadas em muitas ferramentas de
    processamento de texto. São análogas aos "globs" da shell, mas
    são mais complicadas e poderosas.

    A expressão regular descreve o modelo de correspondência e é
    feita de caracteres de texto e de meta-caracteres.

    Um meta-caractere é apenas um caractere com um significado
    especial. Existem 2 estilos principais, BRE e ERE, a depender das
    ferramentas de texto conforme descrito acima.

    Tabela 1.24. Meta-caracteres para BRE e ERE

    +---------------------------------------------------------------+
    |  BRE   | ERE  |        descrição da expressão regular         |
    |--------+------+-----------------------------------------------|
    |\ . [ ] |\ . [ |                                               |
    |^ $ *   |] ^ $ |meta-caracteres comuns                         |
    |        |*     |                                               |
    |--------+------+-----------------------------------------------|
    |\+ \? \(|      |                                               |
    |\) \{ \}|      |BRE apenas meta-caracteres 'escapados' "\"     |
    |\|      |      |                                               |
    |--------+------+-----------------------------------------------|
    |        |+ ? ( |                                               |
    |        |) { } |ERE apenas meta-caracteres não 'escapados' "\" |
    |        ||     |                                               |
    |--------+------+-----------------------------------------------|
    |c       |c     |corresponde a não-meta-caractere "c"           |
    |--------+------+-----------------------------------------------|
    |\c      |\c    |corresponde a um caractere literal "c" mesmo se|
    |        |      |"c" é um meta-caractere por si só              |
    |--------+------+-----------------------------------------------|
    |.       |.     |corresponde a qualquer caractere incluindo nova|
    |        |      |linha                                          |
    |--------+------+-----------------------------------------------|
    |^       |^     |posição no início de uma string                |
    |--------+------+-----------------------------------------------|
    |$       |$     |posição no fim de uma string                   |
    |--------+------+-----------------------------------------------|
    |\<      |\<    |posição no início de uma palavra               |
    |--------+------+-----------------------------------------------|
    |\>      |\>    |posição no final de uma palavra                |
    |--------+------+-----------------------------------------------|
    |[abc…]  |[abc…]|corresponde a quaisquer caracteres em "abc…"   |
    |--------+------+-----------------------------------------------|
    |[^abc…] |[^    |corresponde a quaisquer caracteres excepto em  |
    |        |abc…] |"abc…"                                         |
    |--------+------+-----------------------------------------------|
    |r*      |r*    |corresponde a zero ou mais expressões regulares|
    |        |      |identificadas por "r"                          |
    |--------+------+-----------------------------------------------|
    |r\+     |r+    |corresponde a uma ou mais expressões regulares |
    |        |      |identificadas por "r"                          |
    |--------+------+-----------------------------------------------|
    |r\?     |r?    |corresponde a zero ou uma expressão regular    |
    |        |      |identificada por "r"                           |
    |--------+------+-----------------------------------------------|
    |r1\|r2  |r1|r2 |corresponde a uma das expressões regulares     |
    |        |      |identificadas por "r1" ou "r2"                 |
    |--------+------+-----------------------------------------------|
    |\(r1\|r2|(r1|  |corresponde a uma das expressões regulares     |
    |\)      |r2)   |identificadas por "r1" ou "r2" e trata-as como |
    |        |      |uma expressão regular entre colchetes          |
    +---------------------------------------------------------------+


    A expressão regular do emacs é basicamente BRE mas foi estendida
    para tratar "+" e "?" como meta-caracteres como em ERE. Assim,
    não há necessidade de os 'escapar' com "\" na expressão regular
    do emacs.

    grep(1) pode ser utilizado para executar a pesquisa de texto com
    expressão regular.

    Por exemplo, tente o seguinte:

    $ egrep 'GNU.*LICENSE|Yoyodyne' /usr/share/common-licenses/GPL
    GNU GENERAL PUBLIC LICENSE
    GNU GENERAL PUBLIC LICENSE
    Yoyodyne, Inc., hereby disclaims all copyright interest in the program

    Dica
   
    Veja Secção 9.2.7, “Comandos coloridos”.

%

1.6.3. Expressões de substituição

    Para a expressão de substituição, alguns caracteres têm
    significados especiais.

    Tabela 1.25. A expressão de substituição

    +---------------------------------------------------------------+
    | expressão de  |descrição do texto para substituir a expressão |
    | substituição  |                de substituição                |
    |---------------+-----------------------------------------------|
    |&              |que expressão regular corresponde (use \& no   |
    |               |emacs)                                         |
    |---------------+-----------------------------------------------|
    |\n             |que nº entre colchetes da expressão regular    |
    |               |correspondeu (a ser "n" um número)             |
    +---------------------------------------------------------------+


    Para cadeia de substituição Perl, "$&" é usado em vez de "&" e
    "$n" é usado em vez de "\n".

    Por exemplo, tente o seguinte:

    $ echo zzz1abc2efg3hij4 | \
    sed -e 's/\(1[a-z]*\)[0-9]*\(.*\)$/=&=/'
    zzz=1abc2efg3hij4=
    $ echo zzz1abc2efg3hij4 | \
    sed -e 's/\(1[a-z]*\)[0-9]*\(.*\)$/\2===\1/'
    zzzefg3hij4===1abc
    $ echo zzz1abc2efg3hij4 | \
    perl -pe 's/(1[a-z]*)[0-9]*(.*)$/$2===$1/'
    zzzefg3hij4===1abc
    $ echo zzz1abc2efg3hij4 | \
    perl -pe 's/(1[a-z]*)[0-9]*(.*)$/=$&=/'
    zzz=1abc2efg3hij4=

    Aqui por favor preste atenção extra ao estilo da expressão
    regular entre colchetes e como as strings correspondentes são
    utilizadas no processo de substituição de texto nas diferentes
    ferramentas.

    Estas expressões regulares também podem ser utilizadas para
    movimentos do cursor e acções de substituição de texto em alguns
    editores.

    A barra descendente "\" no fim da linha na linha de comandos da
    shell 'escapa' a nova linha como um caractere de espaço em branco
    e continua a entrada na linha de comandos da shell na próxima
    linha.

    Por favor leia todos os manuais relacionados para aprender estes
    comandos.

%

1.6.4. Substituição global com expressões regulares

    O comando ed(1) pode substituir todas as instâncias de
    "FROM_REGEX" por "TO_TEXT" em "file".

    $ ed file <<EOF
    ,s/FROM_REGEX/TO_TEXT/g
    w
    q
    EOF

    O comando sed(1) pode substituir todas as instâncias de
    "FROM_REGEX" por "TO_TEXT" em "file".

    $ sed -i -e 's/DE_REGEX/PARA_TEXT/g' ficheiro

    O comando vim(1) pode substituir todas as instâncias de
    "FROM_REGEX" com "TO_TEXT" em "ficheiro" ao usar comandos ex(1).

    $ vim '+%s/FROM_REGEX/TO_TEXT/gc' '+w' '+q' ficheiro

    Dica
   
    A flag "c" em cima assegura confirmação interactiva para cada
    substituição.

    Múltiplos ficheiros ("ficheiro1", "ficheiro2",e "ficheiro3")
    podem ser processados com expressões regulares à semelhança com 
    vim(1) ou perl(1).

    $ vim '+argdo %s/FROM_REGEX/TO_TEXT/ge|update' '+q' ficheiro1 ficheiro2 ficheiro3

    Dica
   
    A bandeira "e" em cima previne o erro "Nenhuma correspondência"
    de quebrar um mapeamento.

    $ perl -i -p -e 's/FROM_REGEX/TO_TEXT/g;' ficheiro1 ficheiro2 ficheiro3

    no exemplo perl(1), "-i" é para edição no-lugar de cada ficheiro
    objetivo e "-p" é para um ciclo implícito a todos os ficheiros
    fornecidos.

    Dica

    O uso do argumento "-i.bak" em vez de "-i" mantêm cada ficheiro
    original ao adicionar ".bak" ao seu nome de ficheiro. Isto torna
    a recuperação de erros mais fácil para substituições complexas.

    Nota
   
    ed(1) e vim(1) são BRE; perl(1) é ERE.

%

1.6.5. Extrair dados de tabela de ficheiro de texto

    Vamos considerar um ficheiro de texto chamado "DPL" no qual
    alguns nomes de líderes de projectos Debian pré-2004 e as suas
    datas de iniciação estão listados num formato separado por
    espaços.

    Ian     Murdock   August  1993
    Bruce   Perens    April   1996
    Ian     Jackson   January 1998
    Wichert Akkerman  January 1999
    Ben     Collins   April   2001
    Bdale   Garbee    April   2002
    Martin  Michlmayr March   2003

    Dica
   
    Veja "Uma História Breve de Debian" para o histórico de liderança
    de Debian mais recente.

    O awk é frequentemente utilizado para extrair dados deste tipo de
    ficheiros.

    Por exemplo, tente o seguinte:

    $ awk '{ print $3 }' <DPL                   # month started
    August
    April
    January
    January
    April
    April
    March
    $ awk '($1=="Ian") { print }' <DPL          # DPL called Ian
    Ian     Murdock   August  1993
    Ian     Jackson   January 1998
    $ awk '($2=="Perens") { print $3,$4 }' <DPL # When Perens started
    April 1996

    Shells como a Bash também podem ser utilizadas para analisar este
    tipo de ficheiro.

    Por exemplo, tente o seguinte:

    $ while read first last month year; do
        echo $month
      done <DPL
    ... os mesmos resultados que no primeiro exemplo do Awk

    Aqui, o comando embutido read usa caracteres em "$IFS"
    (separadores de campo internos) para dividir linhas em palavras.

    Se alterar "$IFS" a ":", pode analisar "/etc/passwd" facilmente
    com a shell.

    $ oldIFS="$IFS"   # guarda o valor antigo
    $ IFS=':'
    $ while read user password uid gid rest_of_line; do
        if [ "$user" = "bozo" ]; then
          echo "$user's ID is $uid"
        fi
      done < /etc/passwd
    bozo's ID is 1000
    $ IFS="$oldIFS"   # restaura o valor antigo

    (Se o Awk for utilizado para fazer o equivalente, utilize "FS=
    ':'" para definir o campo separador.)

    O IFS também é usado pela shell para dividir resultados de
    expansão de parâmetros, substituição de comandos e expansão
    aritmética. Estas não ocorrem em palavras dentro de citações
    simples ou duplas. O valor predefinido do IFS é <espaço>, <tab> e
    <nova-linha> combinados.

    Tenha cuidado ao usar estes truques IFS da shell. Podem acontecer
    coisas estranhas, quando a shell interpreta partes do script como
    a entrada dela.

    $ IFS=":,"                        # usa ":" e "," como IFS
    $ echo IFS=$IFS,   IFS="$IFS"     # echo é embutido no Bash
    IFS=  , IFS=:,
    $ date -R                         # apenas o resultado do comando
    Sat, 23 Aug 2003 08:30:15 +0200
    $ echo $(date -R)                 # sub shell --> entrada à shell principal
    Sat  23 Aug 2003 08 30 36 +0200
    $ unset IFS                       # reset IFS ao predefinido
    $ echo $(date -R)
    Sat, 23 Aug 2003 08:30:50 +0200

%

1.6.6. Trechos de script para canalizar comandos em pipe

    Os seguintes scripts fazem coisas bonitas como parte de um pipe.

    Tabela 1.26. Lista de trechos de script para canalizar comandos
    em pipe

    +---------------------------------------------------------------+
    |  trecho de script   |            efeito do comando            |
    |(escrito numa linha) |                                         |
    |---------------------+-----------------------------------------|
    |find /usr -print     |encontra todos os ficheiros sob "/usr"   |
    |---------------------+-----------------------------------------|
    |seq 1 100            |escreve 1 até 100                        |
    |---------------------+-----------------------------------------|
    || xargs -n 1         |corre o comando repetidamente com cada   |
    |<command>            |item do pipe como seu argumento          |
    |---------------------+-----------------------------------------|
    || xargs -n 1 echo    |divide itens separados por espaços do    |
    |                     |pipe em linhas                           |
    |---------------------+-----------------------------------------|
    || xargs echo         |junta todas as linhas do pipe numa linha |
    |---------------------+-----------------------------------------|
    || grep -e            |extrai as linhas do pipe que contêm o    |
    |<regex_pattern>      |<padrão_da_expressão_regular>            |
    |---------------------+-----------------------------------------|
    || grep -v -e         |extrai as linhas do pipe que não contêm o|
    |<regex_pattern>      |<padrão_da_expressão_regular>            |
    |---------------------+-----------------------------------------|
    || cut -d: -f3 -      |extrai do pipe o terceiro campo separado |
    |                     |por ":" (ficheiro passwd etc.)           |
    |---------------------+-----------------------------------------|
    || awk '{ print $3 }' |extrai do pipe o terceiro campo separado |
    |                     |por espaços                              |
    |---------------------+-----------------------------------------|
    || awk -F'\t' '{ print|extrai do pipe o terceiro campo separado |
    |$3 }'                |por tab                                  |
    |---------------------+-----------------------------------------|
    || col -bx            |remove os backspace e expande as tabs    |
    |                     |para espaços                             |
    |---------------------+-----------------------------------------|
    || expand -           |expande separadores                      |
    |---------------------+-----------------------------------------|
    || sort| uniq         |organiza e remove duplicados             |
    |---------------------+-----------------------------------------|
    || tr 'A-Z' 'a-z'     |converte maiúsculas para minúsculas      |
    |---------------------+-----------------------------------------|
    || tr -d '\n'         |concatena linhas numa linha              |
    |---------------------+-----------------------------------------|
    || tr -d '\r'         |remove CR                                |
    |---------------------+-----------------------------------------|
    || sed 's/^/# /'      |adiciona "#" ao inicio de cada linha     |
    |---------------------+-----------------------------------------|
    || sed 's/\.ext//g'   |remove ".ext"                            |
    |---------------------+-----------------------------------------|
    || sed -n -e 2p       |escreve a segunda linha                  |
    |---------------------+-----------------------------------------|
    || head -n 2 -        |escreve as primeiras duas linhas         |
    |---------------------+-----------------------------------------|
    || tail -n 2 -        |escreve as últimas duas linhas           |
    +---------------------------------------------------------------+


    Um script de shell de uma linha pode fazer ciclos sobre muitos
    ficheiros a usar o find(1) e xargs(1) para executar tarefas
    bastante complicadas. Veja Secção 10.1.5, “Idiomas para a seleção
    de ficheiros” e Secção 9.3.9, “Repetir um ciclo de comandos sobre
    ficheiros”.

    Quando a utilização dos modos interativos da shell se torna muito
    complicada, por favor considere escrever um script de shell (veja
    Secção 12.1, “O script de shell”).

Capítulo 2. Gestão de pacotes Debian

    Nota
   
    Este capítulo é escrito a assumir que o lançamento estável mais
    recente tem o nome de código: bullseye.

    Debian é uma organização voluntária que constrói distribuições 
    consistentes de pacotes binários pré-compilados de software livre
    e distribui-os a partir do arquivo dele.

    O arquivo Debian é oferecido por muitos sites mirror remotos para
    acesso através de métodos HTTP e FTP. Também está disponível em
    CD-ROM/DVD.

    O sistema de gestão de pacotes Debian, quando utilizado de modo
    apropriado, oferece ao utilizador o instalar de conjuntos
    consistentes de pacotes binários no sistema a partir do arquivo.
    atualmente, existem 62716 pacotes disponíveis para a arquitectura
    amd64.

    O sistema de gestão de pacotes Debian tem um histórico rico e
    muitas opções de escolha para o programa cliente do utilizador e
    de método de acesso ao arquivo. Atualmente, recomendamos o
    seguinte:

      * apt(8) para todas as operações de linha de comandos
        interactivas, incluindo instalação, remoção e dist-upgrades
        de pacotes. Disponível desde Debian Jessie (Debian 8).

      * apt-get(8) para chamar o sistema de gestão de pacotes Debian
        a partir de scripts. É também uma opção regressiva quando o
        apt não está disponível (comum em sistemas Debian antigos).

      * aptitude(8) para uma interface de texto interactiva para
        gerir os pacotes instalados e procurar os pacotes
        disponíveis.

    Tabela 2.1. Lista de ferramentas de gestão de pacotes Debian

    +---------------------------------------------------------------+
    |      pacote       |popcon|tamanho|         descrição          |
    |-------------------+------+-------+----------------------------|
    |                   |      |       |Advanced Packaging Tool     |
    |                   |      |       |(APT), front-end para o dpkg|
    |                   |V:868,|       |que disponibiliza os métodos|
    |apt                |I:999 |4299   |"http", "ftp" e "file" para |
    |                   |      |       |acesso a arquivos (comandos |
    |                   |      |       |apt/apt-get/apt-cache       |
    |                   |      |       |incluídos)                  |
    |-------------------+------+-------+----------------------------|
    |                   |V:80, |       |Gestor de pacotes baseado em|
    |aptitude           |I:431 |4249   |terminal interativo com     |
    |                   |      |       |aptitude(8)                 |
    |-------------------+------+-------+----------------------------|
    |                   |      |       |ferramenta para selecionar  |
    |tasksel            |V:36, |393    |tarefas para instalação no  |
    |                   |I:975 |       |sistema Debian (frontend    |
    |                   |      |       |para o APT)                 |
    |-------------------+------+-------+----------------------------|
    |                   |      |       |pacote de melhoria para o   |
    |unattended-upgrades|V:324,|325    |APT para ativar a instalação|
    |                   |I:447 |       |automática de atualizações  |
    |                   |      |       |de segurança                |
    |-------------------+------+-------+----------------------------|
    |                   |      |       |gestor de pacotes baseado em|
    |                   |V:3,  |       |terminal (foi o standard    |
    |dselect            |I:32  |2591   |anterior, frontend para o   |
    |                   |      |       |APT e outros métodos de     |
    |                   |      |       |acesso antigos)             |
    |-------------------+------+-------+----------------------------|
    |dpkg               |V:925,|6856   |sistema de gestão de pacotes|
    |                   |I:999 |       |para Debian                 |
    |-------------------+------+-------+----------------------------|
    |                   |V:47, |       |gestor de pacotes gráfico   |
    |synaptic           |I:320 |7873   |(frontend do GNOME para o   |
    |                   |      |       |APT)                        |
    |-------------------+------+-------+----------------------------|
    |                   |      |       |Programas utilitários do    |
    |apt-utils          |V:339,|1162   |APT: apt-extracttemplates(1)|
    |                   |I:996 |       |, apt-ftparchive(1) e       |
    |                   |      |       |apt-sortpkgs(1)             |
    |-------------------+------+-------+----------------------------|
    |                   |V:369,|       |ferramenta de notificação do|
    |apt-listchanges    |I:851 |421    |histórico de alterações do  |
    |                   |      |       |pacote                      |
    |-------------------+------+-------+----------------------------|
    |apt-listbugs       |V:7,  |465    |lista bugs críticos antes de|
    |                   |I:12  |       |cada instalação do APT      |
    |-------------------+------+-------+----------------------------|
    |                   |V:18, |       |Utilitário de busca de      |
    |apt-file           |I:78  |90     |pacotes do APT - interface  |
    |                   |      |       |de linha de comandos        |
    |-------------------+------+-------+----------------------------|
    |apt-rdepends       |V:0,  |40     |lista recursivamente        |
    |                   |I:6   |       |dependências de pacotes     |
    +---------------------------------------------------------------+


2.1. Pré-requisitos da gestão de pacotes Debian

%

2.1.1. Configuração de pacotes

    Aqui estão alguns pontos chave para a configuração de pacotes no
    sistema Debian.

      * A configuração manual feita pelo administrador do sistema é
        respeitada. Por outras palavras, o sistema de configuração de
        pacotes não faz configurações intrusivas por conveniência.

      * Cada pacote vem com o próprio script de configuração com a
        interface de utilizador standard chamada debconf(7) para
        ajudar no processo inicial de instalação do pacote.

      * Os Programadores do Debian dão o melhor para tornar a sua
        experiência de atualização isenta de falhas com scripts de
        configuração de pacotes.
   
      * As funcionalidades totais do software empacotado estão
        disponíveis ao administrador do sistema. Mas aquelas com
        riscos de segurança estão desactivadas na instalação
        predefinida.

      * Se manualmente ativou um serviço com alguns riscos de
        segurança você é o responsável pelo confinamento de risco.

      * A configuração esotérica pode ser activada manualmente pelo
        administrador do sistema. Isto pode criar interferência com
        programas de ajuda genéricos populares para a configuração do
        sistema.

%

2.1.2. Precauções básicas

    Atenção

    Não instale pacotes de misturas aleatórias de suites.
    Provavelmente vai quebrar a consistência do pacote o que requer
    conhecimentos profundos de gestão do sistema tais como ABI
    compilador, versão de biblioteca, funcionalidades do
    interpretador, etc.

    O administrador novato de sistemas Debian deve manter-se com o
    lançamento stable de Debian e aplicar apenas as atualizações de
    segurança. Quero dizer que é melhor evitar algumas das seguintes
    acções válidas, como uma precaução, até que compreenda muito bem
    o sistema Debian. Aqui ficam algumas lembranças.

      * Não inclua testing ou unstable em "/etc/apt/sources.list".

      * Não misture Debian standard com outros arquivos que não sejam
        Debian, como o Ubuntu em "/etc/apt/sources.list".

      * Não crie "/etc/apt/preferences".

      * Não altere o comportamento predefinido das ferramentas de
        gestão de pacotes através de ficheiros de configuração sem
        conhecer os seus impactos totais.

      * Não instale pacotes aleatórios com "dpkg -i <qualquer_pacote>
        ".

      * Nunca instale pacotes aleatórios com "dpkg --force-all -i
        <qualquer_pacote>".

      * Não apague ou altere os ficheiros em "/var/lib/dpkg/".

      * Não sobrescreva ficheiros do sistema ao instalar programas
        compilados a partir do código-fonte.

          + Instale-os em "/usr/local" ou "/opt", se necessário.

    Os efeitos não-compatíveis causados ao sistema de gestão de
    pacotes de Debian, pelas acções referidas acima, podem deixar o
    seu sistema inutilizado.

    O administrador de sistema Debian sério que corre servidores de
    missões críticas, deve tomar precauções extra.

      * Não instale nenhuns pacotes incluindo as atualizações de
        segurança da Debian sem os testar completamente com as suas
        configurações particulares sob condições seguras.

          + Como o administrador do sistema é o responsável final
            pelo seu sistema.

          + A longa história de estabilidade do sistema Debian não é
            uma garantia por si só.

%

2.1.3. A vida com atualizações eternas

    Apesar dos meus avisos em cima, sei que muitos leitores deste
    documento desejam correr as suites testing ou unstable de Debian
    como o sistema principal deles para ambientes de trabalho
    auto-administrados. Isto porque funcionam muito bem, são
    atualizadas frequentemente e oferecem as funcionalidades mais
    recentes.

    Cuidado

    Para o seu servidor de produção a suite stable é recomendada com
    as atualizações de segurança. O mesmo pode ser dito para PCs de
    ambiente de trabalho onde pode dispor de esforços limitados de
    administração.

    Não é preciso mais do que simplesmente definir a string da
    distribuição em "/etc/apt/sources.list" para o nome de suite:
    "testing" ou "unstable"; ou o nome de código: "bookworm" ou
    "sid". Isto fá-lo viver a vida das atualizações eternas.

    O uso de testing ou unstable é muito divertido mas vem com alguns
    riscos. Embora a suite unstable do sistema Debian pareça muito
    estável na maior parte do tempo, tem havido alguns problemas com
    pacotes nas suites testing e unstable do sistema Debian e alguns
    deles não foram triviais de resolver. Poderá ser muito doloroso
    para si. Por vezes, pode ter um pacote danificado ou uma
    funcionalidade com falta por algumas semanas.

    Aqui estão algumas ideias para assegurar recuperação fácil e
    rápida de bugs nos pacotes Debian:

      * Faça um sistema de duplo arranque ao instalar a suite stable
        do sistema Debian noutra partição

      * Tenha o CD de instalação 'à mão' para o arranque de
        recuperação

      * Considere instalar o apt-listbugs para verificar informação
        do Debian Bug Tracking System (BTS) antes das atualizações

      * Conheça o suficiente da infraestrutura do sistema de pacotes
        para contornar o problema

      * Crie um chroot ou ambiente semelhante para antecipadamente
        correr nele o sistema mais recente (veja Secção 9.10,
        “Sistema virtualizado”)

    (Se não conseguir fazer nenhumas destas acções de precaução,
    provavelmente não está preparado para as suites testing e
    unstable.)

    O Esclarecimento com o seguinte salva uma pessoa do karma da
    eterna luta do inferno das atualizações e permite-lhe alcançar o
    nirvana de Debian.

%

2.1.4. Básico do arquivos Debian

    Vamos olhar ao arquivo Debian a partir da perspectiva do
    utilizador do sistema.

    Dica
   
    A política oficial do arquivo Debian está definida em Manual de
    Políticas Debian, Capítulo 2 - O Arquivo Debian.

    Para o típico acesso HTTP, o arquivo está especificado no
    ficheiro "/etc/apt/sources.list" como o seguinte exemplo para o
    sistema stable = bullseye atual.

    deb http://deb.debian.org/debian/ bullseye main contrib non-free
    deb-src http://deb.debian.org/debian/ bullseye main contrib non-free
   
    deb http://security.debian.org/ bullseye/updates main contrib
    deb-src http://security.debian.org/ bullseye/updates main contrib

    Aqui uso o nome de código "bullseye" em vez do nome de suite
    "stable" para evitar surpresas quando a próxima stable for
    lançada.

    O significado de "/etc/apt/sources.list" é descrito em 
    sources.list(5) e os pontos chave são os seguintes:

      * A linha "deb" define os pacotes binários.

      * A linha "deb-src" define os pacotes fonte.

      * O 1º argumento é o URL raiz do arquivo Debian.
   
      * O 2º argumento é o nome da distribuição: seja o nome de suite
        ou o nome de código.

      * O 3º argumento e seguintes são a lista de nomes de área de
        arquivo válidos do arquivo Debian.

    As linhas "deb-src" pode ser omitidas (ou comentadas ao pôr um "#
    " no inicio da linha) se for apenas para o aptitude o qual não
    acede a meta-dados relacionados com a fonte. Isso acelera as
    atualizações dos meta-dados do arquivo. O URL pode ser "http://",
    "ftp://", "file://", ….

    Dica

    Se for usado "sid" no exemplo em cima em vez de "bullseye", a
    linha "deb: http://security.debian.org/ …" para atualizações de
    segurança em "/etc/apt/sources.list", não é necessária. Isto
    porque não há arquivo de atualizações de segurança para "sid"
    (unstable).

    Aqui está uma lista de URLs de sites de arquivo Debian e nomes
    das suites ou nomes de código utilizados no ficheiro de
    configuração.

    Tabela 2.2. Lista de sites de arquivos Debian

    +---------------------------------------------------------------+
    |  URL do arquivo   |nome da suite (nome de |     objetivo      |
    |                   |        código)        |                   |
    |-------------------+-----------------------+-------------------|
    |http://            |                       |lançamento         |
    |deb.debian.org/    |stable (bullseye)      |(bullseye) stable  |
    |debian/            |                       |                   |
    |-------------------+-----------------------+-------------------|
    |http://            |                       |lançamento         |
    |deb.debian.org/    |testing (bookworm)     |(bookworm) testing |
    |debian/            |                       |                   |
    |-------------------+-----------------------+-------------------|
    |http://            |                       |lançamento (sid)   |
    |deb.debian.org/    |unstable (sid)         |unstable           |
    |debian/            |                       |                   |
    |-------------------+-----------------------+-------------------|
    |http://            |                       |pré-lançamento     |
    |deb.debian.org/    |experimental           |experimental       |
    |debian/            |                       |(opcional, apenas  |
    |                   |                       |para programadores)|
    |-------------------+-----------------------+-------------------|
    |http://            |                       |atualizações para o|
    |deb.debian.org/    |stable-proposed-updates|próximo lançamento |
    |debian/            |                       |de ponto estável   |
    |                   |                       |(opcional)         |
    |-------------------+-----------------------+-------------------|
    |http://            |                       |atualizações de    |
    |security.debian.org|stable/updates         |segurança para o   |
    |/                  |                       |lançamento stable  |
    |                   |                       |(importante)       |
    |-------------------+-----------------------+-------------------|
    |http://            |                       |atualizações de    |
    |security.debian.org|testing/updates        |segurança para o   |
    |/                  |                       |lançamento testing |
    |                   |                       |(importante)       |
    |-------------------+-----------------------+-------------------|
    |                   |                       |atualizações       |
    |http://            |                       |compatíveis para   |
    |deb.debian.org/    |bullseye-updates       |filtro de spam,    |
    |debian/            |                       |clientes IM, etc.  |
    |                   |                       |para bullseye      |
    |-------------------+-----------------------+-------------------|
    |http://            |                       |pacotes backport   |
    |deb.debian.org/    |bullseye-backports     |mais recentes para |
    |debian/            |                       |bullseye (opcional)|
    +---------------------------------------------------------------+


    Cuidado

    Apenas o puro lançamento stable com as atualizações de segurança
    disponibilizam a melhor estabilidade. Correr o lançamento stable
    misturado com alguns pacotes dos lançamentos testing ou unstable
    é mais arriscado que correr o lançamento unstable puro devido a
    versões erradas de bibliotecas e etc. Se realmente precisa da
    versão mais recente de alguns programas sob o lançamento stable,
    por favor utilize pacotes do bullseye-updates e http://
    backports.debian.org (veja os serviços Secção 2.7.4,
    “atualizações e Backports”) Estes serviços têm de ser utilizados
    com cuidados extra.

    Cuidado

    Basicamente deve listar apenas uma das suites stable, testing, ou
    unstable na linha "deb". Se listar qualquer combinação das suites
    stable, testing e unstable na linha "deb", os programas do APT
    abrandam enquanto apenas o arquivo mais recente é efectivo. Faz
    sentido várias listagens quando o ficheiro "/etc/apt/preferences"
    é utilizado com objetivos claros (veja Secção 2.7.3, “Moldar a
    versão candidata”).

    Dica

    Para o sistema Debian com as suites stable e testing, é uma boa
    ideia incluir linhas com "http://security.debian.org/" em "/etc/
    apt/sources.list" para ativar as atualizações de segurança como
    no exemplo em cima.

    Nota

    Os bugs de segurança do arquivo stable são corrigidos pela equipa
    de segurança do Debian. Esta atividade tem sido bastante rigorosa
    e fidedigna. Os do arquivo testing poderão ser corrigidos pela
    equipa de segurança de Debian testing. Por várias razões, esta
    atividade não é tão rigorosa como a de stable e pode necessitar
    de aguardar pela migração de pacotes unstable com as correcções.
    Os pacotes do arquivo unstable são corrigidos pelo maintainer. Os
    pacotes unstable mantidos activamente estão geralmente em boa
    forma por conterem as correcções de segurança mais recentes desde
    a origem. Veja a FAQ de segurança Debian para saber como Debian
    lida com os bugs de segurança.

    Tabela 2.3. Lista de área de arquivo Debian

    +---------------------------------------------------------------+
    |  área  |quantidade de |   critério do componente do pacote    |
    |        |   pacotes    |                                       |
    |--------+--------------+---------------------------------------|
    |main    |61595         |em conformidade com DFSG e nenhuma     |
    |        |              |dependência a non-free                 |
    |--------+--------------+---------------------------------------|
    |contrib |349           |em conformidade com DFSG mas com       |
    |        |              |dependências a non-free                |
    |--------+--------------+---------------------------------------|
    |non-free|772           |não complacente com DFSG               |
    +---------------------------------------------------------------+


    Aqui a quantidade de pacotes em cima é para a arquitectura amd64.
    A área main disponibiliza o sistema Debian (veja Secção 2.1.5,
    “Debian é 100% software livre”).

    A organização do arquivo Debian pode ser melhor estudada ao
    apontar o seu navegador a cada URL de arquivo seguido de dists ou
    pool.

    A distribuição é referida de duas maneiras, a suite ou o
    nome-de-código. A palavra distribuição é usada alternativamente
    como o sinónimo de suite em muitas documentações. A relação entre
    a suite e o nome de código pode ser resumida ao seguinte.

    Tabela 2.4. A relação entre suite e nome de código

    +---------------------------------------------------------------+
    |     Tempo      | suite = stable |suite = testing |  suite =   |
    |                |                |                |  unstable  |
    |----------------+----------------+----------------+------------|
    |após o          |nome de código =|nome de código =|nome de     |
    |lançamento      |bullseye        |bookworm        |código = sid|
    |bullseye        |                |                |            |
    |----------------+----------------+----------------+------------|
    |após o          |nome de código =|nome de código =|nome de     |
    |lançamento      |bookworm        |trixie          |código = sid|
    |bookworm        |                |                |            |
    +---------------------------------------------------------------+


    A história dos nomes de código está descrita em Debian FAQ: 6.2.1
    Que outros nomes de código foram usados no passado?

    Na terminologia estrita do arquivo Debian, a palavra "secção" é
    utilizada especialmente para categorizar os pacotes pela área de
    aplicação. (Apesar da palavra "secção main" poder por vezes ser
    utilizada para descrever a área do arquivo Debian com o nome
    "main".)

    Cada vez que é feito um novo upload por um programador de Debian
    (DD) para o arquivo unstable (por processamento do incoming), é
    necessário que o DD assegure que os pacotes enviados sejam
    compatíveis com o conjunto de pacotes mais recente no arquivo
    unstable mais recente.

    Se o DD quebrar esta compatibilidade intencionalmente para uma
    atualização importante de biblioteca ou etc., geralmente existe
    um anúncio na lista de email debian-devel etc.

    Antes que um conjunto de pacotes seja movido pelo script de
    manutenção do arquivo Debian do arquivo unstable para o arquivo
    testing, o script de manutenção do arquivo não verifica apenas a
    maturidade (cerca de 10 dias de idade) e o estado dos relatórios
    de bug RC para os pacotes mas também tenta assegurar que sejam
    compatíveis com o conjunto de pacotes mais recente no arquivo
    testing. Este processo torna o arquivo testing muito atual e
    utilizável.

    Através do processo de congelamento gradual do arquivo liderado
    pela equipa de lançamento, o arquivo testing é amadurecido para o
    tornar completamente consistente e livre de bugs com algumas
    intervenções manuais. Então o novo lançamento stable é criado ao
    atribuir o nome de código do antigo arquivo testing ao novo
    arquivo stable e a criar um novo nome de código para o novo
    arquivo testing. O conteúdo inicial do novo arquivo testing é
    exatamente o mesmo que o arquivo stable recentemente lançado.

    Ambos os arquivos unstable e testing podem sofrer falhas
    temporárias devido a vários fatores:

      * Envio de pacotes danificados ao arquivo (maioritariamente
        para unstable)

      * Atraso de aceitação dos novos pacotes no arquivo
        (maioritariamente para unstable)
   
      * Problemas com o tempo de sincronização do arquivo (tanto para
        testing como unstable)

      * Intervenção manual no arquivo, tal como remoção de pacotes
        (mais para testing) etc.

    Se alguma vez decidir utilizar estes arquivos, deverá ser capaz
    de corrigir ou contornar este tipo de problemas.

    Cuidado

    Durante alguns meses após um novo lançamento de stable, a maioria
    dos utilizadores de ambientes de trabalho devem usar o arquivo
    stable com as atualizações de segurança dele mesmo que
    normalmente usem os arquivos unstable ou testing. Durante este
    período de transição, ambos arquivos unstable e testing não são
    bons para a maioria das pessoas. O seu sistema é difícil de
    manter em boas condições de funcionamento com o arquivo unstable
    porque sofre de vagas de grandes atualizações nos pacotes
    principais. O arquivo testing também não é útil porque contém
    praticamente o mesmo conteúdo que o arquivo stable mas sem o
    suporte de segurança dele
    (Anúncio-de-segurança-de-testing-Debian-2008-12). Após um mês ou
    mais, o arquivo unstable pode ser usado se for cuidadoso.

    Dica

    Quando se acompanha o arquivo testing, um problema causado por um
    pacote removido é geralmente contornado ao instalar o pacote
    correspondente do arquivo unstable que foi lançado para correcção
    de bug.

    Veja Manual de Políticas Debian para as definições do arquivo.

      * "Secções"

      * "Prioridades"
   
      * "Sistema base"

      * "Pacotes essenciais"

%

2.1.5. Debian é 100% software livre

    Debian é 100% software livre por causa do seguinte:

      * Por predefinição, Debian instala apenas software livre para
        respeitar as liberdades dos utilizadores.

      * Debian disponibiliza apenas software livre no main.
   
      * Debian recomenda correr apenas software livre do main.

      * Nenhum pacote no main depende ou recomenda pacotes do
        non-free ou do contrib.

    Algumas pessoas pensam se os 2 seguintes factos se contradizem ou
    não.

      * "Debian irá manter-se 100% livre". (Primeiro termo do Debian
        Social Contract)
   
      * Os servidores Debian irão alojar alguns pacotes non-free e
        contrib.

    Estes não se contradizem, devido ao seguinte.

      * O sistema Debian é 100% livre e os seus pacotes estão
        alojados em servidores Debian na área main.
   
      * Os pacotes fora do sistema Debian são alojado em servidores
        Debian nas áreas non-free e contrib.

    Isto é perfeitamente explicado nos termos 4º e 5º do Debian
    Social Contract:

      * As nossas prioridades são os nossos utilizadores e o software
        livre

          + Seremos guiados pelas necessidades dos nossos
            utilizadores e da comunidade de software livre. Iremos
            pôr o interesse deles no topo das nossas prioridades.
            Iremos suportar as necessidades dos nossos utilizadores
            para operação em muitos ambientes de computação
            distintos. Não nos oporemos a software não-livre que se
            destine a ser utilizado em sistemas Debian, nem
            tentaremos cobrar qualquer taxa a pessoas que criem ou
            utilizem tais trabalhos. Iremos permitir que terceiros
            criem distribuições a conter o sistema Debian com outros
            trabalhos, sem qualquer taxa para nós. Para apoio destes
            objetivos, iremos disponibilizar um sistema integrado de
            materiais de alta qualidade sem restrições legais que
            previnam tais utilizações do sistema.
   
      * Trabalhos que não coincidem com os nossos standards de
        software livre

          + Reconhecemos que alguns dos nossos utilizadores
            necessitam utilizar trabalhos que não estão de acordo com
            a Debian Free Software Guidelines. Criamos as áreas
            "contrib" e "non-free" no nosso arquivo para esses
            trabalhos. Os pacotes nessas áreas não fazem parte do
            sistema Debian, embora tenham sido configurados para
            serem utilizados com Debian. Encorajamos os fabricantes
            de CDs a ler as licenças dos pacotes nessas áreas e
            determinar se podem distribuir os pacotes nos seus CDs.
            Por isso, embora os trabalhos não-livres não sejam parte
            de Debian, suportamos a utilização deles e
            disponibilizamos infra-estrutura para os pacotes
            não-livres (tal como o nosso sistema de seguimento de
            bugs e listas de email).

    Os utilizadores devem estar cientes dos riscos da utilização de
    pacotes das áreas non-free e contrib:

      * falta de liberdade para tais pacotes de software

      * falta de suporte Debian em tais pacotes de software (Debian
        não pode suportar devidamente software sem ter acesso ao seu
        código-fonte.)

      * contaminação do seu sistema Debian 100% livre

    As Debian Free Software Guidelines são os standards de software
    livre para Debian. Debian interpreta "software" no âmbito mais
    amplo incluindo documentação, firmware, logo e dados artísticos
    no pacote. Isto torna os standards de software livre de Debian
    muito rigorosos.

    De modo a respeitar estes restritos standards de software livre
    para a main, Debian antes Mozilla sem marca de pacotes de
    software tais como o Firefox, Thunderbird e Seamonkey a remover o
    logótipo e alguns dados artísticos deles; e distribui-os como
    Iceweasel, Icedove e Iceape respectivamente. Esses pacotes
    restauraram os seus nomes originais com o lançamento de Debian
    Stretch (Debian 9) e esses problemas ficaram resolvidos.

    Tipicamente os pacotes da non-free e da contrib incluem pacotes
    distribuídos livremente dos seguintes tipos:

      * Pacotes de documentação sob a GNU Free Documentation License
        com secções invariantes tais como as do GCC e do Make. (a
        maioria encontra-se na secção non-free/doc.)

      * Pacotes de firmware a conter dados binários sem código-fonte
        tais como os listados em Secção 9.9.6, “Controladores de
        hardware e firmware” como não-livre. (a maioria encontra-se
        na secção non-free/kernel.)

      * Pacotes de fontes e jogos com restrições comerciais de
        utilização e/ou modificação de conteúdo.

    Por favor note que a quantidade de pacotes das non-free e contrib
    é menos de 2% dos pacotes da main. ativar o acesso às áreas
    non-free e contrib não turva a fonte dos pacotes. A utilização do
    ecrã interativo do aptitude(8) disponibiliza-lhe visibilidade e
    controlo total sobre que pacotes estão instalados e a partir de
    qual das áreas, para manter o seu sistema livre conforme desejar.

%

2.1.6. Dependências de pacote

    O sistema Debian oferece um conjunto consistente de pacotes
    binários através do mecanismo de declaração de dependências
    binárias dele com versões nos campos do ficheiro de controle.
    Aqui está uma definição deles um pouco simplificada:

      * "Depends"

          + Isto declara uma dependência absoluta e todos os pacotes
            listados neste campo têm de ser instalados ao mesmo tempo
            ou com antecedência.

      * "Pre-Depends"

          + Isto é como o Depends, excepto que requer a instalação
            completa de todos os pacotes listados com antecedência.

      * "Recommends"

          + Isto declara uma dependência forte mas não absoluta. A
            maioria dos utilizadores não iriam querer o pacote a
            menos que todos os pacotes listados neste campo estejam
            instalados.

      * "Suggests"

          + Isto declara uma dependência fraca. Muitos utilizadores
            deste pacote podem beneficiar ao instalar os pacotes
            listados neste campo mas podem ter as funções razoáveis
            sem eles.

      * "Enhances"

          + Isto declara uma dependência fraca como o Suggests mas
            funciona na direcção oposta.

      * "Breaks"

          + Isto declara uma incompatibilidade do pacote normalmente
            com alguma especificação de versão. Geralmente a
            resolução é atualizar todos os pacotes listados neste
            campo.

      * "Conflicts"

          + Isto declara uma incompatibilidade absoluta. Todos os
            pacotes listados neste campo têm de ser removidos para
            instalar este pacote.

      * "Replaces"

          + Isto é declarado quando os ficheiros instalados por este
            pacote substituem ficheiros nos pacotes listados.

      * "Provides"

          + Isto é declarado quando este pacote disponibiliza todos
            os ficheiros e funcionalidades dos pacotes listados.

    Nota

    Por favor note que definir "Provides", "Conflicts" e "Replaces"
    em simultâneo a um pacote virtual é a configuração sã. Isto
    assegura que apenas um pacote real que disponibilize este pacote
    virtual possa ser instalado de cada vez.

    A definição oficial incluindo dependências de fonte encontra-se
    em O Manual de Políticas: Capítulo 7 - Declarar relações entre
    pacotes.

%

2.1.7. O fluxo de eventos da gestão de pacotes

    Aqui está um resumo do fluxo de eventos simplificado da gestão de
    pacotes pelo APT.

      * Update ("apt update", "aptitude update" ou "apt-get update"):

         1. Obtém meta-dados do arquivo a partir do arquivo remoto

         2. Re-constrói e atualiza os meta-dados locais para
            utilização do APT

      * Upgrade ("apt upgrade" e "apt full-upgrade", ou "aptitude
        safe-upgrade" e "aptitude full-upgrade", ou "apt-get upgrade"
        e "apt-get dist-upgrade"):

         1. Escolhe a versão candidata que geralmente é a versão mais
            recente disponível para todos os pacotes instalados (veja
            Secção 2.7.3, “Moldar a versão candidata” para exceções)

         2. Resolve a dependência do pacote

         3. Obtém os pacotes binários selecionados do arquivo remoto
            se a versão candidata diferir da versão instalada

         4. Desempacota os pacotes binários obtidos

         5. Corre o script preinst

         6. Instala os ficheiros binários

         7. Corre o script postinst

      * Instalar ("apt install …", aptitude install …" ou "apt-get
        install …"):

         1. Escolhe os pacotes listados na linha de comandos

         2. Resolve a dependência do pacote

         3. Obtém os pacotes binários selecionados a partir do
            arquivo remoto

         4. Desempacota os pacotes binários obtidos

         5. Corre o script preinst

         6. Instala os ficheiros binários

         7. Corre o script postinst

      * Remover ("apt remove …", "aptitude remove …" ou "apt-get
        remove …"):

         1. Escolhe os pacotes listados na linha de comandos

         2. Resolve a dependência do pacote

         3. Corre o script prerm

         4. Remove os ficheiros instalados excepto os ficheiros de
            configuração

         5. Corre o script postrm

      * Purgar ("apt purge", "aptitude purge …" ou "apt-get purge
        …"):

         1. Escolhe os pacotes listados na linha de comandos

         2. Resolve a dependência do pacote

         3. Corre o script prerm

         4. Remove os ficheiros instalados incluindo os ficheiros de
            configuração

         5. Corre o script postrm

    Aqui, saltei intencionalmente detalhes técnicos por causa da
    visão geral.

%

2.1.8. Primeira resposta a problemas com a gestão de pacotes

    Deve ler a boa documentação oficial. O primeiro documento a ler é
    específico de Debian "/usr/share/doc/<package_name>/
    README.Debian". Também deve ser consultada outra documentação em
    "/usr/share/doc/<package_name>/". Se definir a shell como
    Secção 1.4.2, “Personalizar bash”, escreva o seguinte.

    $ cd <nome_do_pacote>
    $ pager README.Debian
    $ mc

    Pode necessitar instalar o pacote de documentação correspondente,
    com o sufixo "-doc" no nome, para informações mais detalhadas.

    Se estiver a ter problemas com um pacote específico,
    certifique-se que verifica primeiro o Sistema de acompanhamento
    de bugs Debian (BTS).

    Tabela 2.5. Lista de sites web chave para resolver problemas com
    um pacote específico

    +---------------------------------------------------------------+
    |            site web             |           comando           |
    |---------------------------------+-----------------------------|
    |Página inicial do Sistema de     |sensible-browser "http://    |
    |acompanhamento de bugs Debian    |bugs.debian.org/"            |
    |(BTS)                            |                             |
    |---------------------------------+-----------------------------|
    |O relatório de bug de um nome de |sensible-browser "http://    |
    |pacote conhecido                 |bugs.debian.org/             |
    |                                 |<nome_do_pacote>"            |
    |---------------------------------+-----------------------------|
    |O relatório de bug de uma        |sensible-browser "http://    |
    |quantidade de bugs conhecida     |bugs.debian.org/             |
    |                                 |<número_do_bug>"             |
    +---------------------------------------------------------------+


    Procure no Google com palavras de busca incluindo
    "site:debian.org", "site:wiki.debian.org",
    "site:lists.debian.org", etc.

    Quando criar um relatório de bug, por favor use o comando 
    reportbug(1).

%

2.2. Operações básicas de gestão de pacotes

    As operações de gestão de pacotes baseadas em repositório no
    sistema Debian podem ser executas por muitas ferramentas de
    gestão de pacotes baseadas no APT e disponíveis no sistema
    Debian. Aqui vamos explicar 3 ferramentas de gestão básica de
    pacotes: apt, apt-get / apt-cache e aptitude.

    Para as operações de gestão de pacotes que envolvam a instalação
    ou atualização de meta-dados do pacote, necessita de ter
    privilégios de root.

%

2.2.1. apt vs. apt-get / apt-cache contra o aptitude

    Apesar do aptitude ser uma ferramenta interactiva muito boa a
    qual o autor usa principalmente, deve ser advertido de alguns
    factos:

      * O comando aptitude não é recomendado para a atualização de
        sistema de lançamento-a-lançamento do sistema Debian stable
        após um novo lançamento.

          + O uso de "apt full-upgrade" ou "apt-get dist-upgrade" é
            recomendado para isso. Veja Bug #411280.

      * O comando aptitude por vezes sugere a remoção em massa de
        pacotes para a atualização do sistema no sistema Debian
        testing ou unstable.
   
          + Esta situação já assustou muitos administradores de
            sistemas. Não entre em pânico.

          + Isto parece ser causado principalmente pela torção de
            versões entre os pacotes que são dependências ou
            recomendações de um meta-pacote tal como o gnome-core.

          + Isto pode ser resolvido ao selecionar "Cancelar operações
            pendentes" no menu de comandos do aptitude, a terminar o
            aptitude e a usar "apt full-upgrade".

    Os comandos apt-get e apt-cache são as ferramentas de gestão de
    pacotes baseadas no APT mais básicas.

      * O apt-get e o apt-cache oferecem apenas a interface de linha
        de comandos.

      * O apt-get é mais apropriado para uma atualização maior ao
        sistema entre lançamentos, etc.

      * O apt-get oferece um resolvedor de dependências de pacotes 
        robusto.
   
      * apt-get é menos exigente em recursos de hardware. Consome
        menos memória e é mais rápido.

      * O apt-cache oferece uma busca baseada em expressões regulares
        standard no nome do pacote e na descrição.

      * O apt-get e o apt-cache podem gerir várias versões de pacotes
        a utilizar o /etc/apt/preferences mas é um pouco incómodo.

    O comando apt é uma interface de linha de comandos de alto nível
    para gestão de pacotes. É basicamente um invólucro dos apt-get,
    apt-cache e comandos semelhantes, originalmente destinada a ser
    uma interface de utilizador final e ativa por predefinição
    algumas opções melhor apropriadas para utilização interativa.

      * O apt disponibiliza uma barra de progresso amigável quando se
        instala pacotes a usar o apt install.
   
      * O apt irá remover por predefinição os pacotes .deb em cache
        após instalação com sucesso dos pacotes descarregados.

    Dica

    É recomendado aos utilizadores usarem o novo comando apt(8) para
    uso interativo e usarem os comandos apt-get(8) e apt-cache(8) em
    script de shell.

    O comando aptitude é a ferramenta de gestão de pacotes baseada no
    APT mais versátil.

      * O aptitude oferece a interface de utilizador de texto
        interactiva de ecrã completo.

      * O aptitude também oferece uma interface de utilizador de
        linha de comandos.

      * O aptitude é mais apropriado para a gestão de pacotes
        interactiva diária como inspecionar os pacotes instalados e
        procurar pacotes disponíveis.

      * O aptitude é mais exigente em recursos de hardware. Consome
        mais memória e é mais lento.

      * O aptitude oferece um busca baseada em expressões regulares 
        avançada em todos os meta-dados dos pacotes.

      * O aptitude pode gerir várias versões de pacotes sem utilizar
        o /etc/apt/preferences e é bastante intuitivo.

%

2.2.2. Operações básicas de gestão de pacotes com a linha de comandos

    Aqui estão algumas operações básicas de gestão de pacotes com a
    linha de comandos a usar apt(8), aptitude(8) e apt-get(8) /
    apt-cache(8).

    Tabela 2.6. Operações básicas de gestão de pacotes com a linha de
    comandos a utilizar apt(8), aptitude(8) e apt-get(8) /apt-cache
    (8)

    +---------------------------------------------------------------+
    | sintaxe do | sintaxe do | sintaxe do |                        |
    |    apt     |  aptitude  |  apt-get/  |       descrição        |
    |            |            | apt-cache  |                        |
    |------------+------------+------------+------------------------|
    |apt update  |aptitude    |apt-get     |atualiza os meta-dados  |
    |            |update      |update      |do arquivo de pacotes   |
    |------------+------------+------------+------------------------|
    |            |            |            |instala a versão        |
    |apt install |aptitude    |apt-get     |candidata do pacote     |
    |foo         |install foo |install foo |"foo" com as suas       |
    |            |            |            |dependências            |
    |------------+------------+------------+------------------------|
    |            |            |            |instala as versões      |
    |apt upgrade |aptitude    |apt-get     |candidatas dos pacotes  |
    |            |safe-upgrade|upgrade     |instalados sem remover  |
    |            |            |            |quaisquer outros pacotes|
    |------------+------------+------------+------------------------|
    |            |            |            |instala as versões      |
    |apt         |aptitude    |apt-get     |candidatas dos pacotes  |
    |full-upgrade|full-upgrade|dist-upgrade|instalados a remover    |
    |            |            |            |outros pacotes caso     |
    |            |            |            |necessário              |
    |------------+------------+------------+------------------------|
    |apt remove  |aptitude    |apt-get     |remove o pacote "foo" a |
    |foo         |remove foo  |remove foo  |deixar os seus ficheiros|
    |            |            |            |de configuração         |
    |------------+------------+------------+------------------------|
    |apt         |            |apt-get     |remove os pacotes       |
    |autoremove  |N/D         |autoremove  |auto-instalados que já  |
    |            |            |            |não sejam necessários   |
    |------------+------------+------------+------------------------|
    |apt purge   |aptitude    |apt-get     |purga o pacote "foo" com|
    |foo         |purge foo   |purge foo   |os seus ficheiros de    |
    |            |            |            |configuração            |
    |------------+------------+------------+------------------------|
    |            |            |            |limpa completamente o   |
    |apt clean   |aptitude    |apt-get     |repositório local de    |
    |            |clean       |clean       |ficheiros de pacotes    |
    |            |            |            |obtidos                 |
    |------------+------------+------------+------------------------|
    |            |            |            |limpa os pacotes        |
    |apt         |aptitude    |apt-get     |desatualizados do       |
    |autoclean   |autoclean   |autoclean   |repositório local dos   |
    |            |            |            |ficheiros de pacotes    |
    |            |            |            |recebidos               |
    |------------+------------+------------+------------------------|
    |            |aptitude    |apt-cache   |mostra informação       |
    |apt show foo|show foo    |show foo    |detalhada acerca do     |
    |            |            |            |pacote "foo"            |
    |------------+------------+------------+------------------------|
    |apt search  |aptitude    |apt-cache   |procura pacotes que     |
    |<regex>     |search      |search      |correspondem à          |
    |            |<regex>     |<regex>     |<expressão-regular>     |
    |------------+------------+------------+------------------------|
    |            |            |            |explica a razão porque o|
    |N/D         |aptitude why|N/D         |pacotes que correspondem|
    |            |<regex>     |            |à <expressão_regular>   |
    |            |            |            |devem ser instalados    |
    |------------+------------+------------+------------------------|
    |            |aptitude    |            |explica a razão porque o|
    |N/D         |why-not     |N/D         |pacotes que correspondem|
    |            |<regex>     |            |à <expressão_regular>   |
    |            |            |            |não podem ser instalados|
    |------------+------------+------------+------------------------|
    |            |aptitude    |apt-mark    |lista os pacotes        |
    |N/D         |search '~i! |showmanual  |instalados manualmente  |
    |            |~M'         |            |                        |
    +---------------------------------------------------------------+


    Nota

    Apesar do comando aptitude vir com ricas funcionalidades como o
    resolvedor avançado de pacotes dele, esta complexidade já causou
    (ou pode ainda causar) algumas regressões como os Bug #411123,
    Bug #514930 e Bug #570377. Em caso de dúvidas, por favor utilize
    os comandos apt, apt-get e apt-cache em vez do comando aptitude.

    Nota

    Como o apt / apt-get e o aptitude partilham o estado dos pacotes
    auto-instalados (veja Secção 2.5.5, “O estado dos pacote para o
    APT”) após o lenny, pode misturar estas ferramentas sem grandes
    problemas (veja Bug #594490).

    O "aptitude why <expressão_regular>" pode listar mais informação
    por "aptitude -v why <expressão_regular>". Informação semelhante
    pode ser obtida por apt rdepends <pacote>" ou "apt-cache rdepends
    <pacote>".

    Quando o comando aptitude é arrancado em modo de linha de
    comandos e enfrenta alguns problemas como conflitos de pacotes,
    pode mudar para modo interativo em ecrã total, ao pressionar a
    tecla "e", mais tarde na linha de comandos.

    Pode dar opções de comando logo após "aptitude".

    Tabela 2.7. Opções de comando notáveis para o aptitude(8)

    +---------------------------------------------------------------+
    |  opção de  |                    descrição                     |
    |  comando   |                                                  |
    |------------+--------------------------------------------------|
    |-s          |simula o resultado do comando                     |
    |------------+--------------------------------------------------|
    |-d          |faz apenas o download e não instala/atualiza      |
    |------------+--------------------------------------------------|
    |-D          |mostra breves explicações antes das instalações e |
    |            |remoções automáticas                              |
    +---------------------------------------------------------------+


    Para mais veja aptitude(8) e o "Manual de utilizador do aptitude"
    em "/usr/share/doc/aptitude/README".

    Dica

    O pacote dselect ainda está disponível e foi a ferramenta de
    gestão de pacotes interactiva de ecrã inteiro preferida nos
    lançamentos anteriores.

%

2.2.3. Uso interativo do aptitude

    Para gestão de pacotes interativa, arranque o aptitude em modo
    interativo a partir da linha de comandos da consola conforme o
    seguinte:

    $ sudo aptitude -u
    Password:

    Isto atualiza a cópia local da informação do arquivo e mostra a
    lista de pacotes em ecrã completo com menu. O aptitude coloca a
    configuração dele em "~/.aptitude/config".

    Dica

    Se desejar utilizar a configuração do root em vez da do
    utilizador, utilize "sudo -H aptitude …" em vez de "sudo aptitude
    …" na expressão acima.

    Dica

    O aptitude define automaticamente as acções pendentes como se
    fosse arrancado interativamente. Se não gostar disso, pode
    redefinir isto a partir do menu: "Acção" → "Cancelar acções
    pendentes".

%

2.2.4. Teclas de atalho do aptitude

    As combinações de teclas notáveis para explorar o estado dos
    pacotes e definir uma "ação planeada" neles neste modo de ecrã
    total são as seguintes:

    Tabela 2.8. Lista de teclas de atalho do aptitude

    +---------------------------------------------------------------+
    |        tecla        |             tecla de atalho             |
    |---------------------+-----------------------------------------|
    |F10 ou Ctrl-t        |menu                                     |
    |---------------------+-----------------------------------------|
    |?                    |mostra a ajuda para teclas (listagem mais|
    |                     |completa)                                |
    |---------------------+-----------------------------------------|
    |F10 → Ajuda → Manual |mostra o Manual do Utilizador            |
    |do Utilizador        |                                         |
    |---------------------+-----------------------------------------|
    |u                    |atualiza a informação de arquivo do      |
    |                     |pacote                                   |
    |---------------------+-----------------------------------------|
    |+                    |marca o pacote para atualização ou       |
    |                     |instalação                               |
    |---------------------+-----------------------------------------|
    |-                    |marca o pacote para remoção (manter os   |
    |                     |ficheiros de configuração)               |
    |---------------------+-----------------------------------------|
    |_                    |marca o pacote para purgar (remover      |
    |                     |ficheiros de configuração)               |
    |---------------------+-----------------------------------------|
    |=                    |coloca o pacote em retenção (hold)       |
    |---------------------+-----------------------------------------|
    |U                    |marca todos os pacotes com atualizações  |
    |                     |(funciona como full-upgrade)             |
    |---------------------+-----------------------------------------|
    |g                    |começa a descarregar e a instalar os     |
    |                     |pacotes selecionados                     |
    |---------------------+-----------------------------------------|
    |q                    |sai do ecrã atual e guarda as alterações |
    |---------------------+-----------------------------------------|
    |x                    |sai do ecrã atual e descarta as          |
    |                     |alterações                               |
    |---------------------+-----------------------------------------|
    |Enter                |ver informação acerca de um pacote       |
    |---------------------+-----------------------------------------|
    |C                    |ver o relatório de alterações de um      |
    |                     |pacote                                   |
    |---------------------+-----------------------------------------|
    |l                    |altera o limite dos pacotes mostrados    |
    |---------------------+-----------------------------------------|
    |/                    |procura pela primeira correspondência    |
    |---------------------+-----------------------------------------|
    |\                    |repetir a última pesquisa                |
    +---------------------------------------------------------------+


    A especificação de nome de ficheiro da linha de comandos ou do
    aviso de menu após pressionar "l" e "//" toma a expressão regular
    do aptitude conforme descrito em baixo. A expressão regular do
    aptitude pode corresponder explicitamente a um nome de pacote a
    utilizar uma string começada por "~n e seguida do nome do pacote.

    Dica

    Necessita pressionar "U", no interface visual, para ter todos os
    pacotes instalados atualizados para a versão candidata. Caso
    contrário, apenas os pacotes selecionados e certos pacotes com
    dependências deles, versionadas, são atualizados à versão
    candidata.

%

2.2.5. Vistas de pacote no aptitude

    No modo de ecrã completo interativo do aptitude(8), os pacotes na
    lista de pacotes são mostrados como no próximo exemplo.

    idA   libsmbclient                             -2220kB 3.0.25a-1  3.0.25a-2

    Aqui, esta linha significa desde a esquerda o seguinte:

      * A flag "estado atual" (a primeira letra)

      * A flag "acção planeada" (a segunda letra)

      * A flag "automático" ( a terceira letra)

      * O nome do Pacote

      * A alteração na utilização do espaço do disco atribuída a
        "acção planeada"

      * A versão atual do pacote

      * A versão candidata do pacote

    Dica
   
    A lista completa de flags é fornecida ao fundo do ecrã de Ajuda
    mostrada ao pressionar "?".

    A versão candidata é escolhida de acordo com as preferências
    locais atuais (veja apt_preferences(5) e Secção 2.7.3, “Moldar a
    versão candidata”).

    Estão disponíveis vários tipos de vistas de pacotes sob o menu
    "Vistas".

    Tabela 2.9. Lista de vistas para o aptitude

    +---------------------------------------------------------------+
    |    vista    |  estado  |          descrição da vista          |
    |-------------+----------+--------------------------------------|
    |Vista de     |          |veja Tabela 2.10, “A categorização das|
    |Pacote       |Bom       |vista de pacotes standard”            |
    |             |          |(predefinição)                        |
    |-------------+----------+--------------------------------------|
    |Recomendações|          |lista pacotes que são recomendados por|
    |de Auditoria |Bom       |alguns pacotes instalados mas ainda   |
    |             |          |não estão instalados                  |
    |-------------+----------+--------------------------------------|
    |Lista de     |Bom       |lista pacotes sem categorização (para |
    |Pacotes Lisa |          |utilizar com expressões regulares)    |
    |-------------+----------+--------------------------------------|
    |Explorador de|Muito     |lista pacotes categorizados de acordo |
    |Debtags      |utilizável|com as suas entradas debtags          |
    |-------------+----------+--------------------------------------|
    |Explorador   |          |lista pacotes categorizados de acordo |
    |por          |Obsoleto  |com a categoria deles (utilize o      |
    |Categorias   |          |Explorador de Debtags, em vez disto)  |
    +---------------------------------------------------------------+


    Nota
   
    Por favor ajude-nos a melhorar a etiquetagem de pacotes com
    debtags!

    A "Vista de Pacotes standard categoriza os pacotes de certo modo
    como o dselect com algumas funcionalidades extra.

    Tabela 2.10. A categorização das vista de pacotes standard

    +---------------------------------------------------------------+
    |      categoria      |           descrição da vista            |
    |---------------------+-----------------------------------------|
    |Pacotes atualizáveis |lista pacotes organizados como secção →  |
    |                     |área → pacote                            |
    |---------------------+-----------------------------------------|
    |Pacotes Novos        |, ,                                      |
    |---------------------+-----------------------------------------|
    |Pacotes Instalados   |, ,                                      |
    |---------------------+-----------------------------------------|
    |Pacotes Não          |, ,                                      |
    |Instalados           |                                         |
    |---------------------+-----------------------------------------|
    |Pacotes Obsoletos ou |, ,                                      |
    |Criados Localmente   |                                         |
    |---------------------+-----------------------------------------|
    |Pacotes Virtuais     |lista pacotes com a mesma função         |
    |---------------------+-----------------------------------------|
    |Tarefas              |lista pacotes com diferentes funções     |
    |                     |geralmente necessárias para uma tarefa   |
    +---------------------------------------------------------------+


    Dica
   
    A vista Tarefas pode ser usada para escolher pacotes para a sua
    tarefa.

%

2.2.6. Opções do método de pesquisa com o aptitude

    O aptitude oferece várias opções para procurar pacotes a utilizar
    a fórmula de expressões regulares dele.

      * Linha de comandos da shell:

          + "aptitude search '<aptitude_regex>'" para listar estado
            de instalação, nome do pacote e descrição curta dos
            pacotes correspondentes

          + "aptitude show '<package_name>'" para listar a descrição
            detalhada do pacote

      * modo de ecrã total interativo:
   
          + "l" para limitar a vista de pacotes aos pacotes
            correspondentes

          + "/" para procurar um pacote correspondente

          + "\" para procurar um pacote correspondente a voltar para
            trás

          + "n" para procurar o próximo

          + "N" para procurar o próximo (a andar para trás)

    Dica

    A cadeia para <nome_de_pacote> é tratada como a correspondência
    exata da cadeia para o nome do pacote a menos que seja iniciada
    explicitamente com "~" para ser uma fórmula de expressão regular.

%

2.2.7. A fórmula regex do aptitude

    A fórmula de expressão regular do aptitude é estendida tipo mutt 
    ERE (veja Secção 1.6.2, “Expressões regulares”) e o significado
    das extensões de regras de correspondência especial específicas
    do aptitude são as seguintes:

    Tabela 2.11. Lista da fórmula regex do aptitude

    +----------------------------------------------------------------------+
    |descrição da regra |                                                  |
    |de correspondência |           fórmula da expressão regular           |
    |      extensa      |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde com o  |~n<regex_name>                                    |
    |nome do pacote     |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde com a  |~d<regex_description>                             |
    |descrição          |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde com    |~t<regex_task>                                    |
    |nome da tarefa     |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde com    |~G<regex_debtag>                                  |
    |debtag             |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde com o  |~m<regex_maintainer>                              |
    |maintainer         |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde com    |~s<regex_section>                                 |
    |secção do pacote   |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde com    |~V<regex_version>                                 |
    |versão do pacote   |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde com    |~A{bullseye,bookworm,sid}                         |
    |arquivo            |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde com    |~O{debian,…}                                      |
    |origem             |                                                  |
    |-------------------+--------------------------------------------------|
    |prioridade da      |~p{extra,important,optional,required,standard}    |
    |correspondência    |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde com    |~E                                                |
    |pacotes essenciais |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde com    |~v                                                |
    |pacotes virtuais   |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde com    |~N                                                |
    |pacotes novos      |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde com    |~a                                                |
    |acções pendentes   |{install,upgrade,downgrade,remove,purge,hold,keep}|
    |-------------------+--------------------------------------------------|
    |corresponde com os |~i                                                |
    |pacotes instalados |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde com    |                                                  |
    |pacotes instalados |                                                  |
    |com marca A        |~M                                                |
    |(pacotes instalados|                                                  |
    |automaticamente)   |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde com    |                                                  |
    |pacotes instalados |                                                  |
    |sem a marca A      |~i!~M                                             |
    |(pacotes           |                                                  |
    |selecionados pelo  |                                                  |
    |administrador)     |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde com    |                                                  |
    |pacotes instalados |~U                                                |
    |e com atualizações |                                                  |
    |disponíveis        |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde com    |                                                  |
    |pacotes removidos  |~c                                                |
    |mas não purgados   |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde com    |                                                  |
    |pacotes removidos, |~g                                                |
    |purgados ou que    |                                                  |
    |podem-ser-removidos|                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde com    |                                                  |
    |pacotes que        |                                                  |
    |declaram           |~b                                                |
    |dependências       |                                                  |
    |quebradas          |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde com    |                                                  |
    |pacotes que        |                                                  |
    |declaram           |~B<type>                                          |
    |dependências       |                                                  |
    |quebradas de <type>|                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde a      |                                                  |
    |pacotes <pattern>  |                                                  |
    |que declaram       |~D[<type>:]<pattern>                              |
    |dependência de     |                                                  |
    |<type>             |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde a      |                                                  |
    |pacotes <pattern>  |                                                  |
    |que declaram       |~DB[<type>:]<pattern>                             |
    |dependência        |                                                  |
    |quebrada de <type> |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde a      |                                                  |
    |pacotes para os    |                                                  |
    |quais o pacote que |                                                  |
    |corresponde a      |~R[<type>:]<pattern>                              |
    |<pattern> declara o|                                                  |
    |<type> de          |                                                  |
    |dependência        |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde a      |                                                  |
    |pacotes para os    |                                                  |
    |quais o pacote que |                                                  |
    |corresponde a      |~RB[<type>:]<pattern>                             |
    |<pattern> declara o|                                                  |
    |<type> de          |                                                  |
    |dependência        |                                                  |
    |quebrada           |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde com    |                                                  |
    |pacotes com os     |                                                  |
    |quais alguns       |~R~i                                              |
    |pacotes instalados |                                                  |
    |dependem           |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde com    |                                                  |
    |pacotes com os     |                                                  |
    |quais nenhum outro |!~R~i                                             |
    |pacote instalado   |                                                  |
    |depende            |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde com    |                                                  |
    |pacotes com os     |                                                  |
    |quais alguns       |~R~i|~Rrecommends:~i                              |
    |pacotes instalados |                                                  |
    |dependem ou        |                                                  |
    |recomendam         |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde o      |                                                  |
    |pacote <pattern>   |~S filter <pattern>                               |
    |com a versão       |                                                  |
    |filtrada           |                                                  |
    |-------------------+--------------------------------------------------|
    |corresponde com    |                                                  |
    |todos os pacotes   |~T                                                |
    |(true)             |                                                  |
    |-------------------+--------------------------------------------------|
    |não corresponde com|                                                  |
    |nenhum pacote      |~F                                                |
    |(false)            |                                                  |
    +----------------------------------------------------------------------+


      * A parte da expressão regular é a mesma ERE que aquela
        utilizada nas típicas ferramentas de texto tipo-Unix que
        utilizam "^", ".*", "$" etc. como o egrep(1), awk(1) e perl
        (1).

      * A dependência <type> é uma de (dependências,
        pré-dependências, recomendações, sugestões, conflitos,
        substituições, fornecimentos), que específica o
        inter-relacionamento do pacote.

      * O <type> de dependência predefinida é "depends".

    Dica
   
    Quando <regex_pattern> for uma string nula, coloca "~T"
    imediatamente após o comando.

    Aqui estão alguns atalhos.

      * "~P<term>" == "~Dprovides:<term>"

      * "~C<term>" == "~Dconflicts:<term>"

      * "…~W term" == "(…|term)"

    Os utilizadores familiarizados com o mutt aprendem rápido, pois o
    mutt foi a inspiração para a sintaxe de expressão. Veja
    "PROCURAR, LIMITAR E EXPRESSÕES" no "Manual do Utilizador" "/usr/
    share/doc/aptitude/README".

    Nota

    Com a versão lenny do aptitude(8), a nova sintaxe de formato
    longo como a "?broken" pode ser utilizada para correspondência de
    expressões regulares no lugar da equivalente antiga dele de 
    formato curto "~b". Agora o caractere de espaço " " é considerado
    como um caractere terminante de expressão regular em adição ao
    caractere til "~". Veja o "Manual do Utilizador" para a nova
    sintaxe de formato longo.

%

2.2.8. Resolução de dependências do aptitude

    A seleção de um pacote no aptitude não puxa apenas os pacotes
    definidos na lista de "Dependências:" dele, mas também os
    definidos na lista "Recomendados:" se o menu "F10 → Opções →
    Preferências → Manuseamento de dependências" assim estiver
    definido. Estes pacotes auto-instalados são removidos
    automaticamente sob o aptitude se não forem mais necessários.

    A flag que controla o comportamento "auto install" co comando
    aptitude também pode ser manipulada a usar o comando apt-mark(8)
    do pacote apt.

%

2.2.9. Relatórios (logs) de atividade de pacotes

    Pode verificar o histórico de atividade de pacotes nos ficheiros
    log.

    Tabela 2.12. Os ficheiros log para atividades de pacotes

    +---------------------------------------------------------------+
    |   ficheiro   |                    conteúdo                    |
    |--------------+------------------------------------------------|
    |/var/log/     |Log da atividade de nível do dpkg para as       |
    |dpkg.log      |atividades de todos os pacotes                  |
    |--------------+------------------------------------------------|
    |/var/log/apt/ |Log da atividade genérica do APT                |
    |term.log      |                                                |
    |--------------+------------------------------------------------|
    |/var/log/     |Log da atividade de comandos do aptitude        |
    |aptitude      |                                                |
    +---------------------------------------------------------------+


    Na realidade, não é muito fácil obter rapidamente uma compreensão
    significativa a partir destes logs. Veja Secção 9.2.10, “Gravar
    alterações em ficheiros de configuração” para um modo mais fácil.

%

2.3. Exemplos de operações do aptitude

    Aqui estão alguns exemplos de operações do aptitude(8).

2.3.1. Listagem de pacotes com correspondência por expressão regular
nos nomes de pacotes

    O seguinte comando lista pacotes com regex a condizer com nomes
    de pacotes.

    $ aptitude search '~n(pam|nss).*ldap'
    p libnss-ldap - módulo NSS para usar LDAP como um serviço de nomes
    p libpam-ldap - Módulo de Autenticação Acoplável que permite interfaces do LDAP

    Isto dá muito jeito para encontrar o nome exato de um pacote.

%

2.3.2. Explorar com a correspondência de expressão regular

    a expressão regular "~dipv6" na vista "Nova Lista de Pacotes
    Simples" com o aviso "l", limita a vista aos pacotes com a
    descrição correspondente e permite-lhe explorar interativamente a
    informação deles.

%

2.3.3. Purgar pacotes removidos definitivamente

    Pode purgar todos os restantes ficheiros de configuração dos
    pacotes removidos.

    Verifique os resultados do seguinte comando.

    # aptitude search '~c'

    Se julgar que os pacotes listados podem ser purgados, execute o
    seguinte comando:

    # aptitude purge '~c'

    Pode fazer o mesmo no modo interativo para um controle mais
    preciso.

    Fornece a expressão regular "~c" na vista "Nova Vista de Pacotes"
    com a prompt "l". Isto limita a vista de pacotes apenas aos
    pacotes correspondentes à expressão regular, isto é, "removidos
    mas não purgados". Todos estes pacotes correspondentes a
    expressões regulares podem ser mostrados ao pressionar "[" nos
    cabeçalhos de nível de topo.

    Depois pressione "_" em cabeçalhos de nível de topo tal como
    "Pacotes Não Instalados". Apenas os pacotes correspondentes à
    expressão regular sob o cabeçalho são marcados para serem
    purgados com isto. Pode excluir alguns pacotes a serem purgados
    ao pressionar "=" interativamente para cada um deles.

    Esta técnica é muito útil e funciona com muitas outras teclas de
    comando.

%

2.3.4. Acertar o estado auto/manual de instalação

    Aqui está como acertar o estado auto/manual de instalação dos
    pacotes (após usar um instalador de pacotes sem ser o aptitude e
    etc.).

     1. Arranque o aptitude em modo interativo como root.

     2. Escreva "u", "U", "f" e "g" para atualizar a lista de pacotes
        e atualizar os pacotes.

     3. Escreva "l" para inserir o limite de visualização de pacotes
        aos "~i(~R~i|~Recomendados:~i)" e escreva "M" sobre "Pacotes
        Instalados" como auto-instalado.

     4. Escreva "l" para inserir o limite de visualização de pacotes
        como "~prequired|~pimportant|~pstandard|~E" e escreva "m"
        sobre "Pacotes Instalados" como instalados manualmente.

     5. Escreva "l" para inserir o limite de visualização de pacotes
        como "~i!~M" e remover pacotes não utilizados ao escrever "-"
        sobre cada um deles após expô-los ao escrever "[" sobre
        "Pacotes Instalados".
   
     6. Escreva "l" para inserir o limite de amostragem de pacotes
        como "~i" depois escreva "m" sobre "Tasks" para marcar esses
        pacotes como instalados manualmente.

     7. Termina o aptitude.

     8. Inicie "apt-get -s autoremove|less" como root para verificar
        os que não são usados.

     9. Reinicie o aptitude em modo interativo e marque os pacotes
        necessários como "m".

    10. Reinicie o "apt-get -s autoremove|less" como root para
        verificar que o REMOVED contém apenas os pacotes esperados.

    11. Arranque "apt-get autoremove|less" como root para
        auto-remover os pacotes não usados.

    A opção "m" sobre "Tasks" é uma opção para prevenir situações de
    remoção de pacotes em massa no futuro.

%

2.3.5. atualização total ao sistema

    Nota

    Quando mover para um novo lançamento etc, deverá considerar fazer
    uma instalação limpa do novo sistema mesmo a saber que Debian é
    atualizável como descrito em baixo. Isto dá-lhe a hipótese de
    remover os lixos coleccionados e expõe-lhe a melhor combinação do
    pacotes mais recentes. É claro que deverá fazer uma cópia de
    segurança do sistema para um lugar seguro (veja Secção 10.2,
    “Salvaguarda (backup) e recuperação”) antes de fazer isto.
    Recomendo fazer uma configuração de duplo arranque a usar
    partições diferentes para ter a transição mais suave.

    Pode executar a atualização geral do sistema para um lançamento
    mais recente ao alterar o conteúdo do ficheiro "/etc/apt/
    sources.list" a apontar a um lançamento novo e a executar o
    comando "apt update; apt dist-upgrade".

    Para atualizar de stable para testing ou unstable, substitui
    "bullseye" no exemplo "/etc/apt/sources.list" de Secção 2.1.4,
    “Básico do arquivos Debian” por "bookworm" ou "sid".

    Na realidade, pode enfrentar algumas complicações devido a
    problemas com a transição de alguns pacotes, na maioria devido a
    dependências desses pacotes. Quanto maior a diferença da
    atualização, maior a probabilidade de ter grandes problemas. Para
    a transição da stable antiga à nova stable após o lançamento
    dele, pode ler as novas Notas de Lançamento dele e seguir o
    procedimento exacto descrito lá para minimizar problemas.

    Quando decidir mover de stable para testing antes do lançamento
    formal dele, não existem Notas de Lançamento para o ajudar. A
    diferença entre stable e testing pode ter crescido bastante após
    o lançamento stable anterior e complicar a situação da
    atualização.

    Deve dar passos de precaução para a atualização total enquanto
    recolhe a informação mais recente da lista de mail e a usar senso
    comum.

     1. Leia as "Notas de Lançamento" anteriores.

     2. Faça cópia de segurança a todo o sistema (especialmente dados
        e informação de configuração).

     3. Tenha um meio de arranque à mão para o caso do gestor de
        arranque ficar danificado.

     4. Informe os utilizadores do sistema com bastante antecedência.

     5. Grave a atividade de atualização com o script(1).

     6. Para prevenir a remoção aplique "unmarkauto" aos pacotes
        necessários, p.e., "aptitude unmarkauto vim", .

     7. Minimize a quantidade de pacotes instalados para reduzir a
        hipótese de conflitos de pacotes, p.e., remova os pacotes da
        tarefas de ambiente de trabalho.

     8. Remova o ficheiro "/etc/apt/preferences" (desactiva o
        apt-pinning).

     9. Tente a atualização em passos inteligentes: oldstable →
        stable → testing → unstable.

    10. atualize o ficheiro "/etc/apt/sources.list" para apontar
        apenas ao novo arquivo e corra "aptitude update".

    11. Instale, opcionalmente, os novos pacotes de base primeiro,
        ex., "aptitude install perl".

    12. Corra o comando "apt-get -s dist-upgrade" para avaliar o
        impacto.

    13. Corra o comando "apt-get dist-upgrade" em último lugar.

    Cuidado
   
    Não é sensato saltar grandes lançamentos de Debian quando se
    atualiza entre lançamentos stable.

    Cuidado

    Nas "Notas de Lançamento" anteriores, GCC, Linux Kernel,
    initrd-tools, Glibc, Perl, a cadeia de ferramentas do APT, etc.
    necessitaram de alguma atenção especial para a atualização geral
    do sistema.

    Para atualizações diárias em unstable, veja Secção 2.4.3,
    “Salvaguardar para problemas de pacotes”.

2.4. Operações de gestão avançada de pacotes

%

2.4.1. Operações de gestão avançada de pacotes com linha de comandos

    Aqui está uma lista de outras operações de gestão de pacotes para
    as quais o aptitude é de demasiado alto nível ou faltam-lhe
    funcionalidades necessárias.

    Tabela 2.13. Lista de operações de gestão avançada de pacotes

    +---------------------------------------------------------------+
    |          comando           |              acção               |
    |----------------------------+----------------------------------|
    |COLUMNS=120 dpkg -l         |lista o estado de um pacote       |
    |<padrão_do_nome_de_pacote>  |instalado para o relatório de bug |
    |----------------------------+----------------------------------|
    |dpkg -L <nome_do_pacote>    |lista o conteúdo de um pacote     |
    |                            |instalado                         |
    |----------------------------+----------------------------------|
    |dpkg -L <nome_do_pacote> |  |lista os manuais para um pacote   |
    |egrep '/usr/share/man/man.* |instalado                         |
    |/.+'                        |                                  |
    |----------------------------+----------------------------------|
    |dpkg -S                     |lista os pacotes instalados que   |
    |<padrão_do_nome_de_ficheiro>|condizem com o nome de ficheiro   |
    |----------------------------+----------------------------------|
    |apt-file search             |lista pacotes no arquivo que      |
    |<padrão_do_nome_de_ficheiro>|condizem com o nome de ficheiro   |
    |----------------------------+----------------------------------|
    |apt-file list               |lista os conteúdos dos pacotes que|
    |<padrão_do_nome_de_pacote>  |correspondem no arquivo           |
    |----------------------------+----------------------------------|
    |dpkg-reconfigure            |reconfigura o pacote exacto       |
    |<nome_do_pacote>            |                                  |
    |----------------------------+----------------------------------|
    |dpkg-reconfigure -p=low     |reconfigura o pacote exacto com as|
    |<nome_do_pacote>            |questões mais detalhadas          |
    |----------------------------+----------------------------------|
    |configure-debian            |reconfigura pacotes a partir do   |
    |                            |menu de ecrã completo             |
    |----------------------------+----------------------------------|
    |dpkg --audit                |faz auditoria ao sistema por      |
    |                            |pacotes parcialmente instalados   |
    |----------------------------+----------------------------------|
    |dpkg --configure -a         |configura todos os pacotes        |
    |                            |parcialmente instalados           |
    |----------------------------+----------------------------------|
    |apt-cache policy            |mostra a versão disponível, a     |
    |<nome_do_pacote_binário>    |prioridade e informação de arquivo|
    |                            |de um pacote binário              |
    |----------------------------+----------------------------------|
    |apt-cache madison           |mostra a versão disponível e      |
    |<nome_do_pacote>            |informação de arquivo de um pacote|
    |----------------------------+----------------------------------|
    |apt-cache showsrc           |mostra informação do pacote de    |
    |<nome_do_pacote_binário>    |código-fonte de um pacote binário |
    |----------------------------+----------------------------------|
    |apt-get build-dep           |instala os pacotes necessários    |
    |<nome_do_pacote>            |para compilar pacote              |
    |----------------------------+----------------------------------|
    |aptitude build-dep          |instala os pacotes necessários    |
    |<nome_do_pacote>            |para compilar pacote              |
    |----------------------------+----------------------------------|
    |apt-get source              |descarrega código-fonte (do       |
    |<nome_do_pacote>            |arquivo standard)                 |
    |----------------------------+----------------------------------|
    |dget <URL para ficheiro dsc>|descarrega um pacote de           |
    |                            |código-fonte (de outro arquivo)   |
    |----------------------------+----------------------------------|
    |                            |constrói uma árvore de            |
    |dpkg-source -x              |código-fonte a partir de um       |
    |<nome_do_pacote>_<versão>-  |conjunto de pacotes de            |
    |<versão_debian>.dsc         |código-fonte ("*.orig.tar.gz" e   |
    |                            |"*.debian.tar.gz"/"*.diff.gz")    |
    |----------------------------+----------------------------------|
    |debuild binary              |compila pacote(s) a partir de uma |
    |                            |árvore fonte local                |
    |----------------------------+----------------------------------|
    |                            |compila um pacote de kernel a     |
    |make-kpkg imagem_de_kernel  |partir de uma árvore fonte de     |
    |                            |kernel                            |
    |----------------------------+----------------------------------|
    |make-kpkg --initrd          |compila um pacote de kernel a     |
    |imagem_de_kernel            |partir de uma árvore fonte de     |
    |                            |kernel com initramfs activa       |
    |----------------------------+----------------------------------|
    |dpkg -i <nome_pacote>_      |instalar um pacote local no       |
    |<versão>-<versão_debian>_   |sistema                           |
    |<arquitectura>.deb          |                                  |
    |----------------------------+----------------------------------|
    |apt install /path/to/       |instala um pacote local no        |
    |<package_filename>.deb      |sistema, entretanto tenta resolver|
    |                            |as dependências automaticamente   |
    |----------------------------+----------------------------------|
    |debi <nome_pacote>_<versão>-|instala pacote(s) locais no       |
    |<versão_debian>_            |sistema                           |
    |<arquitectura>.dsc          |                                  |
    |----------------------------+----------------------------------|
    |dpkg --get-selections '*' > |guarda a informação de estado de  |
    |seleção.txt                 |seleção a nível de pacotes do dpkg|
    |----------------------------+----------------------------------|
    |dpkg --set-selections       |define a informação de estado de  |
    |<seleção.txt                |seleção a nível de pacotes do dpkg|
    |----------------------------+----------------------------------|
    |                            |define o estado de seleção de     |
    |echo <nome-do-pacote> hold ||pacote ao nível do dpkg para hold |
    |dpkg --set-selections       |(equivalente a "aptitude hold     |
    |                            |<nome_do_pacote>")                |
    +---------------------------------------------------------------+


    Nota

    Para um pacote com a funcionalidade multi-arch, pode precisar de
    especificar o nome da arquitectura para alguns comandos. Por
    exemplo, use "dpkg -L libglib2.0-0:amd64" para listar o conteúdo
    do pacote libglib2.0-0 para a arquitectura amd64.

    Cuidado

    As ferramentas de pacotes de nível mais baixo como "dpkg -i …" e
    "debi …" deverão ser utilizadas com cuidado pelo administrador do
    sistema. Não tomam conta automaticamente das dependências de
    pacotes necessárias. As opções de linha de comandos do dpkg
    "--force-all" e semelhantes (veja dpkg(1)) destinam-se apenas a
    serem utilizadas por especialistas. Utiliza-las sem o
    conhecimento total dos seus efeitos pode danificar completamente
    o seu sistema.

    Por favor note o seguinte:

      * Toda a configuração do sistema e comandos de instalação
        necessitam ser executados pelo root.

      * A contrário do aptitude, que utiliza regex (veja
        Secção 1.6.2, “Expressões regulares”), os outros comandos de
        gestão de pacotes utilizam padrões como a shell glob (veja
        Secção 1.5.6, “Glob da shell”).

      * O apt-file(1), é disponibilizado pelo pacote apt-file, tem de
        correr previamente "apt-file update".

      * O configure-debian(8) disponibilizado pelo pacote
        configure-debian corre o dpkg-reconfigure(8) como seu
        backend.

      * O dpkg-reconfigure(8) corre scripts de pacote a utilizar o 
        debconf(1) como o backend dele.

      * Os comandos "apt-get build-dep", "apt-get source" e
        "apt-cache showsrc" necessitam de "deb-src" em "/etc/apt/
        sources.list".

      * Os dget(1), debuild(1) e debi(1) necessitam do pacote
        devscripts.

      * Veja o procedimento de (re)empacotamento a utilizar "apt-get
        source" em Secção 2.7.13, “Portar um pacote ao sistema
        stable”.

      * O comando make-kpkg necessita do pacote kernel-package (veja
        Secção 9.9, “O kernel”).

      * Para empacotamento em geral veja Secção 12.11, “Criar um
        pacote Debian”.

%

2.4.2. Verificação dos ficheiros pacotes instalados

    A instalação de debsums permite a verificação dos ficheiros dos
    pacotes instalados contra valores MD5sum do ficheiro "/var/lib/
    dpkg/info/*.md5sums" com debsums(1). Para saber como o MD5sum
    funciona veja Secção 10.3.5, “O valor de controlo MD5” .

    Nota

    Como a base de dados MD5sum pode ser adulterada por um intruso, o
    debsums(1) é uma ferramenta de segurança de utilização limitada.
    É bom apenas para verificar modificações locais pelo
    administrador ou danos devido a erros de media.

%

2.4.3. Salvaguardar para problemas de pacotes

    Muito utilizadores preferem seguir o lançamento unstable do
    sistema Debian pelas suas novas funcionalidades e pacotes. Isto
    torna o sistema permeável a a bugs críticos dos pacotes.

    A instalação do pacote apt-listbugs salvaguarda o seu sistema
    contra bugs críticos ao verificar automaticamente o Debian BTS
    por bugs críticos quando fizer atualizações com o sistema APT.

    A instalação do pacote apt-listchanges disponibiliza notícias
    importantes de "NEWS.Debian" ao atualizar com o sistema APT.

%

2.4.4. Procurar nos meta-dados do pacote

    Embora hoje em dia visitar o site Debian https://
    packages.debian.org/ facilite a busca nos meta-dados do pacote,
    vamos ver modos mais tradicionais.

    Os comandos grep-dctrl(1), grep-status(1) e grep-available(1)
    podem ser utilizados para procurar qualquer ficheiro que tenha o
    formato geral de um ficheiro de controle de pacote Debian.

    "dpkg -S <padrão_de_nome_de_ficheiro>" pode ser utilizado para
    procurar nomes de pacotes instalados pelo dpkgque contenham
    ficheiros com o nome coincidente. Mas isto não vê os ficheiros
    criados pelo script do responsável do pacote.

    Se necessitar de fazer uma busca mais elaborada nos meta-dados do
    dpkg, necessita executar o comando "grep -e
    padrão_de_expressão_regular *" no diretório "/var/lib/dpkg/info/
    ". Isto fá-lo procurar as palavras mencionadas nos scripts dos
    pacotes e nos textos de questões de instalação.

    Se desejar procurar, recursivamente, as dependências de pacotes,
    deverá utilizar o apt-rdepends(8).

%

2.5. Os interiores da gestão de pacotes Debian

    Vamos aprender como o sistema de gestão de pacotes Debian
    funciona internamente. Isto deverá ajudá-lo a criar a sua própria
    solução para alguns problemas com pacotes.

%

2.5.1. Meta dados do arquivo

    Os ficheiros de meta-dados para cada distribuição são armazenados
    sob "dist/<nome-de_código>" em cada site mirror Debian, p.e.,
    "http://deb.debian.org/debian/". A estrutura de arquivo dele pode
    ser explorada com um navegador web. Existem 6 tipos de meta-dados
    chave.

    Tabela 2.14. O conteúdo dos meta dados do arquivo Debian

    +---------------------------------------------------------------+
    |   ficheiro   |     localização     |         conteúdo         |
    |--------------+---------------------+--------------------------|
    |Release       |topo da distribuição |descrição do arquivo e    |
    |              |                     |informação de integridade |
    |--------------+---------------------+--------------------------|
    |              |                     |ficheiro de assinatura    |
    |Release.gpg   |topo da distribuição |para o ficheiro "Release" |
    |              |                     |assinado com a chave do   |
    |              |                     |arquivo                   |
    |--------------+---------------------+--------------------------|
    |              |                     |lista de todos os         |
    |Contents-     |topo da distribuição |ficheiros para todos os   |
    |<architecture>|                     |pacotes no arquivo        |
    |              |                     |pertinente                |
    |--------------+---------------------+--------------------------|
    |              |topo de cada         |descrição do arquivo      |
    |Release       |combinação de        |utilizada para a regra do |
    |              |distribuição/área/   |apt_preferences(5)        |
    |              |arquitectura         |                          |
    |--------------+---------------------+--------------------------|
    |              |topo de cada         |                          |
    |Packages      |combinação de        |debian/control concatenado|
    |              |distribuição/área/   |para pacotes binários     |
    |              |arquitectura-binário |                          |
    |--------------+---------------------+--------------------------|
    |              |topo de cada         |                          |
    |Sources       |combinação de        |debian/control concatenado|
    |              |distribuição/área/   |para pacotes fonte        |
    |              |fonte                |                          |
    +---------------------------------------------------------------+


    No arquivo recente, estes meta-dados são armazenados como
    ficheiros diferenciais e comprimidos para reduzir o tráfego de
    rede.

%

2.5.2. Ficheiro "Release" de nível de topo e autenticidade:

    Dica
   
    O ficheiro "Release" no nível de topo é usado para assinar o
    arquivo sob o sistema secure APT.

    Cada suite do arquivo Debian tem um ficheiro "Release" no nível
    de topo, p.e., "http://deb.debian.org/debian/dists/unstable/
    Release", como o seguinte:

    Origin: Debian
    Label: Debian
    Suite: unstable
    Codename: sid
    Date: Sat, 14 May 2011 08:20:50 UTC
    Valid-Until: Sat, 21 May 2011 08:20:50 UTC
    Architectures: alpha amd64 armel hppa hurd-i386 i386 ia64 kfreebsd-amd64 kfreebsd-i386 mips mipsel powerpc s390 sparc
    Components: main contrib non-free
    Description: Debian x.y Unstable - Not Released
    MD5Sum:
     bdc8fa4b3f5e4a715dd0d56d176fc789 18876880 Contents-alpha.gz
     9469a03c94b85e010d116aeeab9614c0 19441880 Contents-amd64.gz
     3d68e206d7faa3aded660dc0996054fe 19203165 Contents-armel.gz
    ...

    Nota

    Aqui, pode encontrar a minha lógica de utilizar "suite" e "nome
    de código" em Secção 2.1.4, “Básico do arquivos Debian”. A
    "distribuição" é usada quando se refere a ambos "suite" e "nome
    de código". Todos os nomes de "áreas" do arquivo oferecidos pelo
    arquivo são listados sob "Componentes".

    A integridade do ficheiro "Release" de nível de topo é verificada
    pela infraestrutura criptográfica chamada secure apt.

      * O ficheiro de assinatura criptográfica "Release.gpg" é criado
        a partir do ficheiro "Release" de nível de topo autenticado e
        da chave secreta do arquivo Debian.

      * A chave do arquivo Debian público pode ser semeada em "/etc/
        apt/trusted.gpg";

          + automaticamente ao instalar o chaveiro com o pacote
            base-files mais recente, ou

          + manualmente pela ferramenta gpg ou apt-key com a chave do
            arquivo público mais recente publicada em
            ftp-master.debian.org.

      * O sistema secure APT verifica a integridade do ficheiro
        "Release" de nível de topo descarregado criptograficamente
        por este ficheiro "Release.gpg" a pela chave de arquivo
        público Debian em "/etc/apt/trusted.gpg".

    A integridade de todos os ficheiros "Packages" e "Sources" é
    verificada a utilizar valores MD5sum do ficheiro "Release" de
    nível de topo. A integridade de todos os ficheiros de pacotes é
    verificada a utilizar valores MD5sum nos ficheiros "Packages" e
    "Sources" Veja debsums(1) e Secção 2.4.2, “Verificação dos
    ficheiros pacotes instalados”.

    Como a verificação de assinatura criptográfica é um processo
    muito mais intenso para a CPU do que o cálculo de valor MD5sum, a
    utilização de valores MD5sum para cada pacote enquanto se utiliza
    assinatura criptográfica para o ficheiro "Release" de nível de
    topo disponibiliza boa segurança com desempenho (veja
    Secção 10.3, “Infraestrutura da segurança de dados”).

%

2.5.3. Ficheiros "Release" do nível de arquivo

    Dica
   
    Os ficheiros "Release" do nível de arquivo são utilizados para a
    regra do apt_preferences(5).

    Existem ficheiros "Release" do nível de arquivo para todas as
    localizações do arquivo especificadas pela linha "deb" em "/etc/
    apt/sources.list", tais como "http://deb.debian.org/debian/dists/
    unstable/main/binary-amd64/Release" ou "http://deb.debian.org/
    debian/dists/sid/main/binary-amd64/Release" conforme a seguir:

    Archive: unstable
    Origin: Debian
    Label: Debian
    Component: main
    Architecture: amd64

    Cuidado

    Para a estrofe "Archive:" são utilizados os nomes de suite
    ("stable", "testing" e "unstable", …) no arquivo Debian enquanto
    que os nomes de código ("trusty", "xenial", "artful", …) são
    utilizados no arquivo Ubuntu.

    Para alguns arquivos, tais como experimental e
    bullseye-backports, que contêm pacotes que não devem ser
    instalados automaticamente, existe uma linha extra, p.e., "http:/
    /deb.debian.org/debian/dists/experimental/main/binary-amd64/
    Release" como a seguir.

    Archive: experimental
    Origin: Debian
    Label: Debian
    NotAutomatic: yes
    Component: main
    Architecture: amd64

    Por favor note que para arquivos normais sem "NotAutomatic: yes",
    o valor Pin-Priority predefinido é 500, enquanto que para
    arquivos especiais com "NotAutomatic: yes", o valor Pin-Priority
    predefinido é 1 (veja apt_preferences(5) e Secção 2.7.3, “Moldar
    a versão candidata”).

%

2.5.4. Obter os meta dados do pacote

    Quando as ferramentas do APT, como o aptitude, apt-get, synaptic,
    apt-file, auto-apt, … são utilizadas, precisamos de atualizar as
    cópias locais dos meta-dados que contêm a informação do arquivo
    Debian. Estas cópias locais têm os seguintes nomes de ficheiros
    correspondentes aos nomes de distribuição, área e arquitectura
    especificados em "/etc/apt/sources.list" (veja Secção 2.1.4,
    “Básico do arquivos Debian”).

      * "/var/lib/apt/lists/deb.debian.org_debian_dists_
        <distribuição>_Release"

      * "/var/lib/apt/lists/deb.debian.org_debian_dists_
        <distribuição>_Release.gpg"

      * "/var/lib/apt/lists/deb.debian.org_debian_dists_
        <distribuição>_<área>_binário-<arquitectura>_Packages"

      * "/var/lib/apt/lists/deb.debian.org_debian_dists_
        <distribuição>_<área>_fonte_Sources"

      * "/var/cache/apt/apt-file/deb.debian.org_debian_dists_
        <distribuição>_Contents-<arquitectura>.gz" (para o apt-file)

    Os primeiros 4 tipos de ficheiros são partilhados por todos os
    comandos APT pertinentes e atualizados a partir da linha de
    comandos pelo "apt-get update" ou "aptitude update". Os
    meta-dados "Packages" são atualizados se existir a linha "deb" em
    "/etc/apt/sources.list". Os meta dados "Sources" são atualizados
    se existir a linha "deb-src" em "/etc/apt/sources.list".

    Os meta-dados "Packages" e "Sources" contêm a estrofe "Filename:"
    que aponta à localização de ficheiro dos pacotes binários e de
    código-fonte. atualmente, estes pacotes estão localizados sob a
    árvore de diretórios "pool/" para a transição melhorada através
    dos lançamentos.

    As cópias locais dos meta-dados "Packages" podem ser pesquisadas
    interativamente com a ajuda do aptitude. O comando de procura
    especializada grep-dctrl(1) pode pesquisar as cópias locais dos
    meta-dados "Packages" e "Sources".

    A cópia local dos meta-dados "Contents-<arquitectura>" pode ser
    atualizada pelo "apt-file update" e a localização dele é
    diferente dos outros 4. Veja apt-file(1). (O auto-apt utiliza
    localização diferente para a cópia local de "Contents-
    <arquitectura>.gz" por predefinição.)

%

2.5.5. O estado dos pacote para o APT

    Além dos meta-dados obtidos remotamente, a ferramenta APT após o
    lenny armazena a informação de estado de instalação dela gerada
    localmente em "/var/lib/apt/extended_states" que é utilizada por
    todas as ferramentas do APT para seguirem todos os pacotes
    auto-instalados.

%

2.5.6. O estado de pacotes para o aptitude

    Além aos meta-dados obtidos remotamente, o aptitude armazena a
    sua informação de estado de instalação gerada localmente em "/var
    /lib/aptitude/pkgstates" que é usada apenas pelo próprio.

%

2.5.7. Copias locais dos pacotes obtidos

    Todos os pacotes obtidos remotamente através do mecanismo APT são
    armazenados em "/var/cache/apt/archives" até que sejam limpos.

    Esta politica de limpeza de ficheiros de cache para o aptitude
    pode ser definida em "Opções" → "Preferências" e pode ser forçada
    pelo seu menu "Limpar cache de pacotes" ou "Limpar ficheiros
    obsoletos" em "Acções".

%

2.5.8. Nomes de ficheiros de pacotes Debian

    Ficheiros de pacotes Debian têm estruturas de nomes particulares.

    Tabela 2.15. A estrutura de nomes dos pacotes Debian

    +---------------------------------------------------------------+
    |       tipo de pacote        |       estrutura de nomes        |
    |-----------------------------+---------------------------------|
    |                             |<nome_de_pacote>_                |
    |O pacote binário (a.k.a deb) |<versão_upstream>-<versão-debian>|
    |                             |_<arquitetura>.deb               |
    |-----------------------------+---------------------------------|
    |O pacote binário para        |<nome_de_pacote>_                |
    |debian-installer (a.k.a udeb)|<versão_upstream>-<versão-debian>|
    |                             |_<arquitetura>.udeb              |
    |-----------------------------+---------------------------------|
    |O pacote de código-fonte     |<nome_de_pacote>_                |
    |(código-fonte da origem)     |<versão_upstream>-               |
    |                             |<versão-debian>.orig.tar.gz      |
    |-----------------------------+---------------------------------|
    |O pacote de código-fonte 1.0 |<nome_de_pacote>_                |
    |(alterações do Debian)       |<versão_upstream>-               |
    |                             |<versão-debian>.diff.gz          |
    |-----------------------------+---------------------------------|
    |O pacote de código-fonte 3.0 |<nome_de_pacote>_                |
    |(quilt) (alterações do       |<versão_upstream>-               |
    |Debian)                      |<versão-debian>.debian.tar.gz    |
    |-----------------------------+---------------------------------|
    |O pacote de código-fonte     |<nome_do_pacote>_                |
    |(descrição)                  |<versão_upstream>-               |
    |                             |<versão-debian>.dsc              |
    +---------------------------------------------------------------+


    Dica
   
    Aqui apenas são descritos formatos de pacote fonte básicos. Veja
    mais em dpkg-source(1).

    Tabela 2.16. Os caracteres utilizáveis para cada componente nos
    nomes de pacotes Debian

    +------------------------------------------------------------+
    |componente do nome|caracteres utilizáveis (regex)|existência|
    |------------------+------------------------------+----------|
    |<nome-do-pacote>  |[a-z,A-Z,0-9,.,+,-]+          |necessário|
    |------------------+------------------------------+----------|
    |<epoch>:          |[0-9]+:                       |opcional  |
    |------------------+------------------------------+----------|
    |<versão-upstream> |[a-z,A-Z,0-9,.,+,-,:]+        |necessário|
    |------------------+------------------------------+----------|
    |<versão.debian>   |[a-z,A-Z,0-9,.,+,~]+          |opcional  |
    +------------------------------------------------------------+


    Nota
   
    Pode verificar a ordem da versão de pacotes com o dpkg(1), p.e.,
    "dpkg --compare-versions 7.0 gt 7.~pre1 ; echo $?" .

    Nota

    O debian-installer (d-i) utiliza udeb como a extensão de ficheiro
    para o pacote binário dele em vez do normal deb. Um pacote udeb é
    um pacote deb despido que remove alguns conteúdos não essenciais
    como a documentação para poupar espaço enquanto relaxa os
    requisitos de política do pacote. Ambos os pacotes deb e udeb
    partilham a mesma estrutura de pacote. O "u" significa micro.

%

2.5.9. O comando dpkg

    dpkg(1) é a ferramenta de mais baixo nível para a gestão de
    pacotes Debian. É muito poderosa e tem que ser utilizada com
    cuidado.

    Enquanto instala o pacote chamado "<nome_de_pacote>", o dpkg
    processa-o na seguinte ordem:

     1. Desempacota o ficheiro deb (equivalente a "ar -x")

     2. Executa "<nome_de_pacote>.preinst" a utilizar o debconf(1)
   
     3. Instala o conteúdo do pacote no sistema (equivalente a "tar
        -x")

     4. Executa "<nome_de_pacote>.postinst" a utilizar o debconf(1)

    O sistema debconf disponibiliza interacção standard com o
    utilizador com suporte de I18N e L10N (Capítulo 8, I18N e L10N).

    Tabela 2.17. Ficheiros notáveis criados pelo dpkg

    +---------------------------------------------------------------+
    |         ficheiro         |      descrição dos conteúdos       |
    |--------------------------+------------------------------------|
    |/var/lib/dpkg/info/       |lista de ficheiros de configuração. |
    |<nome_do_pacote>.conffiles|(modificável pelo utilizador)       |
    |--------------------------+------------------------------------|
    |/var/lib/dpkg/info/       |lista de ficheiros e diretórios     |
    |<nome_do_pacote>.list     |instalados pelo pacote              |
    |--------------------------+------------------------------------|
    |/var/lib/dpkg/info/       |lista de valores de hash MD5 para os|
    |<nome_do_pacote>.md5sums  |ficheiros instalados pelo pacote    |
    |--------------------------+------------------------------------|
    |/var/lib/dpkg/info/       |script de pacote para ser executado |
    |<nome_do_pacote>.preinst  |antes da instalação do pacote       |
    |--------------------------+------------------------------------|
    |/var/lib/dpkg/info/       |script de pacote para ser executado |
    |<nome_do_pacote>.postinst |após a instalação do pacote         |
    |--------------------------+------------------------------------|
    |/var/lib/dpkg/info/       |script de pacote para ser executado |
    |<nome_do_pacote>.prerm    |antes da remoção do pacote          |
    |--------------------------+------------------------------------|
    |/var/lib/dpkg/info/       |script de pacote para ser executado |
    |<nome_do_pacote>.postrm   |após a remoção do pacote            |
    |--------------------------+------------------------------------|
    |/var/lib/dpkg/info/       |script de pacote para o sistema     |
    |<nome_do_pacote>.config   |debconf                             |
    |--------------------------+------------------------------------|
    |/var/lib/dpkg/alternatives|a informação alternativa usada pelo |
    |/<nome_do_pacote>         |comando update-alternatives         |
    |--------------------------+------------------------------------|
    |/var/lib/dpkg/available   |a informação de disponibilidade para|
    |                          |todos os pacotes                    |
    |--------------------------+------------------------------------|
    |                          |a informação de diversões usadas    |
    |/var/lib/dpkg/diversions  |pelo dpkg(1) e definidas por        |
    |                          |dpkg-divert(8)                      |
    |--------------------------+------------------------------------|
    |                          |a informação de sobreposição de     |
    |/var/lib/dpkg/statoverride|estado usada pelo dpkg(1) e definida|
    |                          |por dpkg-statoverride(8)            |
    |--------------------------+------------------------------------|
    |/var/lib/dpkg/status      |a informação de estado para todos os|
    |                          |pacotes                             |
    |--------------------------+------------------------------------|
    |/var/lib/dpkg/status-old  |o backup de primeira geração do     |
    |                          |ficheiro "var/lib/dpkg/status"      |
    |--------------------------+------------------------------------|
    |                          |o backup de segunda geração e os    |
    |/var/backups/dpkg.status* |mais antigos do ficheiro "var/lib/  |
    |                          |dpkg/status"                        |
    +---------------------------------------------------------------+


    O ficheiro "status" também é utilizado por ferramentas como o 
    dpkg(1), o "dselect update" e o "apt-get -u dselect-upgrade".

    O comando especializado de busca grep-dctrl(1) pode procurar as
    cópias locais dos meta dados "status" e "available".

    Dica

    No ambiente do debian-installer, o comando udpkg é usado para
    abrir pacotes udeb. O comando udpkg é uma versão reduzida do
    comando dpkg.

%

2.5.10. O comando update-alternatives

    O sistema Debian tem um mecanismo para instalar programas de
    certa maneira sobrepostos de um modo pacífico a usar 
    update-alternatives(1). Por exemplo, pode fazer o comando vi
    selecionar o vim para executar enquanto instala ambos os pacotes
    vim e nvi.

    $ ls -l $(type -p vi)
    lrwxrwxrwx 1 root root 20 2007-03-24 19:05 /usr/bin/vi -> /etc/alternatives/vi
    $ sudo update-alternatives --display vi
    ...
    $ sudo update-alternatives --config vi
      Selection    Command
     ----------------------------------------------
          1        /usr/bin/vim
    *+    2        /usr/bin/nvi

    Enter para manter a predefinição[*], ou escreva o número da seleção: 1

    O sistema de alternativas do Debian mantêm a sua seleção como
    ligação simbólica em "/etc/alternatives/". O processo de seleção
    utiliza um ficheiro correspondente em "/var/lib/dpkg/alternatives
    /".

%

2.5.11. O comando dpkg-statoverride

    Stat overrides disponibilizados pelo comando dpkg-statoverride(8)
    são um modo de dizer ao dpkg(1) para usar um dono ou modo
    diferente para um ficheiro quando um pacote for instalado. Se for
    especificado "--update" e o ficheiro existir é imediatamente
    definido para o novo dono e modo.

    Cuidado

    A alteração directa do dono ou modo para um ficheiro cujo dono é
    o pacote a usar os comandos chmod ou chown pelo administrador do
    sistema é reiniciada pela próxima atualização do pacote.

    Nota

    Uso a palavra ficheiro aqui, mas na verdade pode ser qualquer
    objecto de sistema de ficheiros com que o dpkg lide, incluindo
    diretórios, aparelhos, etc.

%

2.5.12. O comando dpkg-divert

    As diversões de ficheiros disponibilizadas pelo comando 
    dpkg-divert(8) são um modo de forçar o dpkg(1) a não instalar um
    ficheiro na localização predefinida dele, mas para uma
    localização divergida. Os uso do dpkg-divert destina-se aos
    scripts do responsável do pacote. A utilização casual dele pelo
    administrador do sistema está descontinuada.

%

2.6. Recuperação de um sistema danificado

    Quando corre o sistema unstable, espera-se que o administrador
    saiba recuperar o sistema de situações de gestão de pacotes com
    conflitos.

    Cuidado
   
    Alguns métodos descritos aqui são acções de alto risco. Foi
    avisado!

%

2.6.1. Incompatibilidade com configurações antigas de utilizador

    Se um programa GUI de ambiente de trabalho ficou instável após
    uma atualização significante da versão original, deve suspeitar
    de interferências com os ficheiros locais de configuração antigos
    criados por ele. Se estiver estável sob uma nova conta de
    utilizador criada, esta hipótese está confirmada. (Isto é um bug
    de empacotamento e geralmente evitado pelo empacotador.)

    Para recuperar a estabilidade, deve mover os ficheiros de
    configuração locais correspondentes e reiniciar o programa GUI.
    Poderá ter que ler o conteúdo dos ficheiros de configuração
    antigos para mais tarde recuperar informação de configuração.
    (Não os apague muito depressa.)

%

2.6.2. Pacotes diferentes com ficheiros sobrepostos

    Os sistemas de gestão de pacotes a nível de arquivo, como o 
    aptitude(8) ou o apt-get(1), nem tentam instalar pacotes com
    ficheiros sobrepostos a utilizar as dependências do pacote. (veja
    Secção 2.1.6, “Dependências de pacote”).

    Erros do responsável do pacote ou de implantação inconsistente de
    mistura de fontes de arquivos (veja Secção 2.7.2, “Pacotes de
    fontes de arquivos misturados”) pelo administrador do sistema
    podem criar situações com dependências de pacotes definidas
    incorrectamente. Quando instala um pacote com ficheiros
    sobrepostos a usar o aptitude(8) ou o apt-get(1) sob tal
    situação, o dpkg(1) que desempacota o pacote certifica-se de
    retornar um erro ao programa que o chama sem sobrescrever os
    ficheiros existentes.

    Cuidado

    A utilização de pacotes de terceiros introduz riscos
    significantes ao sistema através dos scripts do programador do
    pacote que são executados com privilégios de root e podem fazer o
    que quiserem ao seu sistema. O comando dpkg(1) apenas protege
    contra a sobreposição de ficheiros ao desempacotar.

    Pode contornar tal problema de instalação ao remover primeiro o
    pacote ofensivo antigo, <pacote_antigo>.

    $ sudo dpkg -P <pacote-antigo>

%

2.6.3. Corrigir script problemático de pacote

    Quando um comando no script do pacote retorna erro por alguma
    razão e o script termina com erro, o sistema de gestão de pacotes
    aborta a acção dele e termina com pacotes parcialmente
    instalados. Quando um pacote contém bugs nos seus scripts de
    remoção, o pacote pode tornar-se impossível de remover e isso é
    bastante desagradável.

    Para o problema do script de pacote de "<nome_do_pacote>", deve
    observar os seguintes scripts do pacote:

      * "/var/lib/dpkg/info/<nome_do_pacote>.preinst"

      * "/var/lib/dpkg/info/<nome_do_pacote>.postinst"
   
      * "/var/lib/dpkg/info/<nome_do_pacote>.prerm"

      * "/var/lib/dpkg/info/<nome_do_pacote>.postrm"

    Editar o script do pacote ofensivo a partir de root a usar as
    seguintes técnicas:

      * desativar a linha ofensiva ao preceder um "#"
   
      * forçar um retorno com sucesso ao acrescentar a linha ofensiva
        com "|| true"

    Configurar todos os pacotes parcialmente instalados com o
    seguinte comando.

    # dpkg --configure -a

%

2.6.4. Recuperação com o comando dpkg

    Como o dpkg é uma ferramenta de pacotes de muito baixo nível,
    pode funcionar sob situações muito más como um sistema que não
    arranca sem ligação a rede. Vamos assumir que o pacote foo está
    danificado e precisa de ser substituído.

    Pode ainda encontrar cópias em cache de uma versão antiga livre
    de bugs do pacote foo no diretório de cache de pacotes: "/var/
    cache/apt/archives/". (se não, pode descarregá-lo do arquivo
    https://snapshot.debian.org/ ou copiá-lo da cache de pacotes de
    uma máquina funcional.)

    Se puder arrancar o sistema, pode instalá-lo com o seguinte
    comando.

    # dpkg -i /caminho/para/foo_<versão_antiga>_<arquitectura>.deb

    Dica

    Se os danos no sistema forem menores, pode em alternativa fazer
    um downgrade (regredir a versão) ao sistema completo como em
    Secção 2.7.10, “Downgrade de emergência” a usar o nível mais alto
    do sistema APT.

    Se o seu sistema não puder arrancar pelo disco rígido, precisa
    procurar outras maneiras de arrancá-lo.

     1. Arranque o sistema a usar o CD de instalação de Debian
        (debian-installer) em modo de recuperação.
   
     2. Monte o sistema danificado no disco rígido em "/target".

     3. Instale uma versão antiga do pacote foo com o seguinte.

    # dpkg --root /target -i /caminho/para/foo_<versão_antiga>_<arquitectura>.deb

    Este exemplo funciona mesmo se o comando dpkg no disco rígido
    estiver danificado.

    Dica

    Pode ser utilizado, de modo semelhante, para recuperar um sistema
    danificado qualquer sistema GNU/Linux arrancado de outro sistema
    no disco rígido, Live CD de GNU/Linux, por pen USB de arranque ou
    arranque pela rede.

    Se a tentativa de instalar um pacote deste modo falha devido a
    algumas violações de dependências e necessitar realmente de fazer
    isto como último recurso, pode sobrepor a dependência a utilizar
    a "--ignore-depends", "--force-depends" e outras opções do dpkg.
    Se o fizer, precisa de fazer um sério esforço para restaurar as
    dependências apropriadas mais tarde. Veja dpkg(8) para mais
    detalhes.

    Nota

    Se o seu sistema estiver seriamente danificado, deve fazer uma
    salvaguarda completa para um lugar seguro (veja Secção 10.2,
    “Salvaguarda (backup) e recuperação”) e deve fazer uma instalação
    limpa. Isto consome menos tempo e produz melhores resultados no
    fim.

%

2.6.5. Recuperar dados de seleção de pacotes

    Se por qualquer razão o "/var/lib/dpkg/status" ficar corrompido o
    sistema Debian perde os dados de seleção de pacotes e sofre
    severamente. Procure o ficheiro antigo "/var/lib/dpkg/status" em
    "/var/lib/dpkg/status-old" ou "/var/backups/dpkg.status.*".

    Manter "/var/backups/" numa partição separada pode ser uma boa
    ideia porque este diretório contém muitos dados importantes do
    sistema .

    Em caso de sérios danos recomendo fazer uma instalação limpa após
    fazer a salvaguarda do sistema. Mesmo que tudo em "/var/" esteja
    perdido, ainda pode recuperar alguma informação dos diretórios em
    "/usr/share/doc/" para guiar a sua nova instalação.

    Reinstalar o sistema mínimo (ambiente de trabalho).

    # mkdir -p /caminho/para/sistema/antigo

    Monte o sistema antigo em "/caminho/para/sistema/antigo/".

    # cd /caminho/para/sistema/antigo/usr/share/doc
    # ls -1 >~/ls1.txt
    # cd /usr/share/doc
    # ls -1 >>~/ls1.txt
    # cd
    # sort ls1.txt | uniq | less

    Então ser-lhe-ão apresentados nomes de pacotes para instalar.
    (Podem existir alguns nomes que não de pacotes como "texmf".)

2.7. Dicas para a gestão de pacotes

%

2.7.1. Como escolher os pacotes Debian

    Pode procurar os pacotes que satisfaçam as suas necessidades com
    o aptitude a partir da descrição do pacote ou a partir da lista
    "Tarefas".

    Quando encontrar mais de 2 pacotes semelhantes e não sabe qual
    deles instalar sem o esforço de "teste e erro", deve utilizar
    algum senso comum. Considero os seguintes pontos como boas
    indicações dos pacotes preferidos:

      * Essencial: sim > não

      * Area: main > contrib > non-free

      * Prioridade: required > important > standard > optional >
        extra

      * Tasks: pacotes listados em tarefas como "Ambiente de
        Trabalho"

      * Pacotes selecionados pela dependência de pacote (p.e.,
        python2.4 por python)

      * Popcon: mais alto na votação e número de instalações

      * Changelog: atualizações regulares feitas pelo responsável do
        pacote

      * BTS: Nenhum bug RC (nenhum crítico, nenhum grave e nenhum bug
        sério)

      * BTS: manutenção responsável dos relatórios de bugs

      * BTS: maior quantidade de bugs corrigidos recentemente

      * BTS: menor quantidade de bugs "não-lista-de-desejos"
        remanescentes

    O Debian, que é um projecto voluntário com modelo de
    desenvolvimento distribuído, o arquivo dele contém muitos pacotes
    com diferentes objetivos e qualidade. Tem de tomar as suas
    próprias decisões sobre o que fazer com eles.

%

2.7.2. Pacotes de fontes de arquivos misturados

    Cuidado

    Instalar pacotes de fontes misturadas de arquivos não é suportado
    pela distribuição oficial Debian excepto para combinações de
    arquivos oficialmente suportadas tais como a stable com security
    updates e bullseye-updates.

    Aqui está um exemplo de operações para incluir, uma vez, pacotes
    específicos com novas versões da origem encontrados em unstable
    enquanto se acompanha a testing.

     1. Altere o ficheiro "/etc/apt/sources.list" temporariamente
        para entrada única "unstable".

     2. Corra "aptitude update".

     3. Corra "aptitude install <nome-do-pacote>".

     4. Recupere o ficheiro "/etc/apt/sources.list" original para
        testing.

     5. Corra "aptitude update".

    Não cria o ficheiro "/etc/apt/preferences" nem precisa de se
    preocupar com o apt-pinning com esta abordagem manual. Mas é
    muito incómoda.

    Cuidado

    Quando utiliza fontes misturadas de arquivos, tem que assegurar
    por si próprio a compatibilidade dos pacotes pois Debian não o
    garante. Se existir incompatibilidade de pacotes, pode danificar
    o seu sistema. Tem que ser capaz de julgar estes requisitos
    técnicos. A utilização de fontes misturadas de arquivos
    aleatórios é uma operação completamente opcional e a utilização
    deles não é algo que o encoraje a utilizar.

    As regras gerais para instalar pacotes de arquivos diferentes são
    as seguintes.

      * Pacotes não-binários de ("Arquitecture: all") são mais seguro
        para instalar.

          + pacotes de documentação: sem requisitos especiais

          + pacotes de programa interpretador: tem de estar
            disponível interpretador compatível

      * Pacotes binários (não "Architecture: all") geralmente
        enfrentam muitos obstáculos e são inseguros para instalar.
   
          + compatibilidade de versão de biblioteca (incluindo a
            "libc")

          + compatibilidade de versão de programa utilitário
            relacionada

          + compatibilidade da ABI do Kernel

          + Compatibilidade ABI C++

          + …

    Nota

    De modo a tornar um pacote seguro para instalar, alguns pacotes
    de programas binários comerciais não-livres podem vir fornecidos
    com bibliotecas completamente ligadas estaticamente. Mesmo assim
    deve verificar problemas de compatibilidade da ABI e etc. com
    eles.

    Nota

    Excepto para evitar pacotes com problemas a curto prazo, instalar
    pacotes binários de arquivos não suportados oficialmente é
    geralmente uma má ideia. Isto é verdadeiro mesmo que utilize
    apt-pinning (veja Secção 2.7.3, “Moldar a versão candidata”).
    Deve considerar o chroot ou técnicas semelhantes (veja
    Secção 9.10, “Sistema virtualizado”) para correr programas de
    arquivos diferentes.

%

2.7.3. Moldar a versão candidata

    Sem o ficheiro "/etc/apt/preferences", o sistema APT escolhe a
    versão disponível mais recente com a versão candidata a utilizar
    a string de versão. Este é o estado normal e a utilização
    recomendada do sistema APT. Todas as combinações de arquivos
    oficialmente suportadas não necessitam do ficheiro "/etc/apt/
    preferences" porque alguns arquivos que não devem ser utilizados
    como fonte automática de atualizações são marcados como 
    NotAutomatic e são tratados de modo apropriado.

    Dica

    A regra de comparação da string de versão pode ser verificada
    com, p.e., "dpkg --compare-versions ver1.1 gt ver1.1~1; echo $?"
    (veja dpkg(1)).

    Quando instala regularmente pacotes de uma mistura de fontes de
    arquivos (veja Secção 2.7.2, “Pacotes de fontes de arquivos
    misturados”), pode automatizar estas operações complicadas ao
    criar o ficheiro "/etc/apt/preferences" com entradas apropriadas
    e a moldar a regra de seleção de pacotes para a versão candidata
    como descrito em apt_preferences(5). Isto chama-se apt-pinning.

    Atenção

    A utilização de apt-pinning por um utilizador novato é certamente
    pedir grandes problemas. Deve evitar utilizar o apt-pinning
    excepto quando necessitar absolutamente dele.

    Cuidado

    Quando utilizar apt-pinning, próprio tem que assegurar a
    compatibilidade dos pacotes pois Debian não o garante. O
    apt-pinning é uma operação completamente opcional e a utilização
    dele não é algo que encoraje a fazer.

    Cuidado

    Os ficheiros Release de nível de arquivo (veja Secção 2.5.3,
    “Ficheiros "Release" do nível de arquivo”) são utilizados para a
    regra do apt_preferences(5). Assim o apt-pinning funciona apenas
    com nome de "suite" para arquivos Debian normais e arquivos
    Debian de segurança. (Isto é diferente dos arquivos do Ubuntu.)
    Por exemplo, pode fazer "Pin: release a=unstable" mas não pode
    fazer "Pin: release a=sid" no ficheiro "/etc/apt/preferences".

    Cuidado

    Quando utilizar um arquivo não-Debian como parte de apt-pinning,
    deve verificar ao que ele se destina e também verificar a
    credibilidade dele. Por exemplo, Ubuntu e Debian não se destinam
    a ser misturados.

    Nota

    Mesmo que não crie o ficheiro "/etc/apt/preferences", pode fazer
    operações no sistema bastante complexas (veja Secção 2.6.4,
    “Recuperação com o comando dpkg” e Secção 2.7.2, “Pacotes de
    fontes de arquivos misturados”) sem o apt-pinning.

    Aqui está uma explicação simplificada da técnica de apt-pinning.

    O sistema APT escolhe o pacote de atualização com o Pin-Priority
    maior das fontes de pacotes disponíveis definidas no ficheiro "/
    etc/apt/sources.list" como o pacote de versão candidata. Se o
    Pin-Priority do pacote for maior que 1000, esta restrição de
    versão para atualização é abandonada para permitir a regressão
    (veja Secção 2.7.10, “Downgrade de emergência”).

    O valor Pin-Priority de cada pacote é definido por entradas
    "Pin-Priority" no ficheiro "/etc/apt/preferences" ou utiliza o
    valor predefinido dele.

    Tabela 2.18. Lista de valores notáveis de Pin-Priority para a
    técnica de apt-pinning.

    +---------------------------------------------------------------+
    |Pin-Priority|         efeitos do apt-pinning no pacote         |
    |------------+--------------------------------------------------|
    |1001        |instala o pacote mesmo que isto constitua uma     |
    |            |regressão na versão (downgrade) do pacote         |
    |------------+--------------------------------------------------|
    |990         |utilizado como predefinição para o arquivo de     |
    |            |lançamento de destino                             |
    |------------+--------------------------------------------------|
    |500         |utilizado por predefinição para o arquivo normal  |
    |------------+--------------------------------------------------|
    |100         |utilizado como predefinição para os arquivos      |
    |            |NotAutomatic e ButAutomaticUpgrades               |
    |------------+--------------------------------------------------|
    |100         |utilizado para o pacote instalado                 |
    |------------+--------------------------------------------------|
    |1           |utilizado como predefinição para o arquivo        |
    |            |NotAutomatic                                      |
    |------------+--------------------------------------------------|
    |-1          |nunca instala o pacote mesmo que este seja        |
    |            |recomendado                                       |
    +---------------------------------------------------------------+


    O arquivo do lançamento alvo pode ser definido por diferentes
    métodos.

      * ficheiro de configuração "/etc/apt/apt.conf" com a linha
        "APT::Default-Release "stable";"
   
      * opção de linha de comandos, p.e. "apt-get install -t testing
        algum-pacote"

    Os arquivos NotAutomatic e ButAutomaticUpgrades são definidos
    pelo servidor de arquivo que contêm no ficheiro Release dele do
    nível de arquivo (veja Secção 2.5.3, “Ficheiros "Release" do
    nível de arquivo”) ambos "NotAutomatic: yes" e
    "ButAutomaticUpgrades: yes". O arquivo NotAutomatic é definido
    pelo servidor de arquivo que contém no ficheiro Release de nível
    de arquivo dele apenas "NotAutomatic: yes".

    A situação de apt-pinning do <pacote> de várias fontes de
    arquivos é mostrada por "apt-cache policy <pacote>".

      * Uma linha começada com "Package pin:" lista a versão do
        pacote de pin se estiver definida a associação apenas com o
        <pacote> p.e., "Package pin: 0.190".

      * Não existe nenhuma linha com "Package pin:" se não estiver
        definida nenhuma associação apenas com <pacote>.

      * O valor Pin-Priority a associar ao <pacote> é listado no lado
        direito de todas as strings de versão, p.e., "0.181 700".

      * É listado "0" à direita de todas as strings de versão se
        nenhuma associação apenas com <pacote> for definida, ex.,
        "0.181 0".

      * Os valores Pin-Priority dos arquivos (definidos como
        "Package: *" no ficheiro "/etc/apt/preferences") são listados
        à esquerda dos caminhos dos arquivos, ex., "100 http://
        deb.debian.org/debian/ bullseye-backports/main Packages".

%

2.7.4. atualizações e Backports

    Existem os arquivos bullseye-updates e backports.debian.org que
    disponibilizam pacotes de atualização para stable (bullseye).

    De modo a utilizar estes arquivos, liste todos os arquivos
    necessários no ficheiro "/etc/apt/sources.list" como a seguir:

    deb http://deb.debian.org/debian/ bullseye main contrib non-free
    deb http://security.debian.org/ bullseye/updates main contrib
    deb http://deb.debian.org/debian/ bullseye-updates main contrib non-free
    deb http://deb.debian.org/debian/ bullseye-backports main contrib non-free

    Não há necessidade de definir valores específicos de Pin-Priority
    no ficheiro "/etc/apt/preferences". Quando os novos pacotes ficam
    disponíveis, a configuração predefinida disponibiliza as
    atualizações mais razoáveis (veja Secção 2.5.3, “Ficheiros
    "Release" do nível de arquivo”).

      * Todos os pacotes antigos instalados são atualizados para mais
        recentes a partir de bullseye-updates.
   
      * Apenas os pacotes antigos instalados manualmente a partir de
        bullseye-backports são atualizados para mais recentes a
        partir de bullseye-backports.

    Sempre que desejar instalar um pacote chamado "<nome-do-pacote>"
    com as suas dependências a partir do arquivo bullseye-backports
    manualmente, utilize o seguinte comando enquanto muda o
    lançamento alvo com a opção "-t".

    $ sudo apt-get install -t bullseye-backports <nome_do_pacote>

%

2.7.5. Bloquear pacotes instalados por "Recomendados"

    Se desejar não puxar determinados pacotes automaticamente através
    de "Recommends", tem de criar o ficheiro "/etc/apt/preferences" e
    listar explicitamente esses pacotes no topo conforme a seguir:

    Package: <package-1>
    Pin: version *
    Pin-Priority: -1
   
    Package: <package-2>
    Pin: version *
    Pin-Priority: -1

%

2.7.6. Acompanhar testing com alguns pacotes de unstable

    Aqui está um exemplo de técnica de apt-pinning para incluir
    pacotes específicos de versão original mais recente encontrados
    em unstable e atualizados regularmente enquanto de segue o
    testing. Liste todos os arquivos necessários no ficheiro "/etc/
    apt/sources.list" conforme a seguir:

    deb http://deb.debian.org/debian/ testing main contrib non-free
    deb http://deb.debian.org/debian/ unstable main contrib non-free
    deb http://security.debian.org/ testing/updates main contrib

    Configure o ficheiro "/etc/apt/preferences" como o seguinte:

    Package: *
    Pin: release a=unstable
    Pin-Priority: 100

    Quando desejar instalar um pacote chamado "<nome_do_pacote>" com
    as suas dependências a partir do arquivo unstable sob esta
    configuração, invoque o seguinte comando que muda o lançamento
    alvo com a opção "-t" (o Pin-Priority de unstable torna-se 990).

    $ sudo apt-get install -t unstable <nome-do-pacote>

    Com esta configuração, a execução usual de "apt-get upgrade" e
    "apt-get dist-upgrade" (ou "aptitude safe-upgrade" e "aptitude
    full-upgrade") atualiza os pacotes que foram instalados a partir
    do arquivo testing a usar o arquivo testing atual e os pacotes
    que foram instalados a partir do arquivo unstable a usar o
    arquivo unstable atual.

    Cuidado

    Tenha cuidado para não remover a entrada "testing" do ficheiro "/
    etc/apt/sources.list". Sem a entrada "testing" lá, o sistema APT
    atualiza os pacotes do novo arquivo unstable.

    Dica

    Geralmente edito o ficheiro "/etc/apt/sources.list" para comentar
    a entrada do arquivo "unstable" logo após a operação acima. Isto
    evita a lentidão do processo de atualização ao ter demasiadas
    entradas no ficheiro "/etc/apt/sources.list" embora isto impeça a
    atualização dos pacotes que foram instalados a partir do arquivo
    unstable a utilizar o arquivo unstable atual.

    Dica

    Se for utilizado "Pin-Priority: 1" em vez de "Pin-Priority: 100"
    no ficheiro "/etc/apt/preferences", os pacotes já instalados que
    têm o valor Pin-Priority de 100 não são atualizados pelo arquivo
    unstable mesmo se a entrada "testing" no ficheiro "/etc/apt/
    sources.list" seja removida.

    Se desejar acompanhar pacotes particulares em unstable
    automaticamente sem uma instalação inicial "-t unstable", tem de
    criar o ficheiro "/etc/apt/preferences" e listar explicitamente
    todos esses pacotes no topo conforme a seguir:

    Package: <package-1>
    Pin: release a=unstable
    Pin-Priority: 700
   
    Package: <package-2>
    Pin: release a=unstable
    Pin-Priority: 700

    Estes definem o valor Pin-Priority para cada pacote específico.
    Por exemplo, de modo a acompanhar a versão unstable mais recente
    deste "Debian Reference" em Português, deve ter as seguintes
    entradas no ficheiro "/etc/apt/preferences".

    Package: debian-reference-pt
    Pin: release a=unstable
    Pin-Priority: 700
   
    Package: debian-reference-common
    Pin: release a=unstable
    Pin-Priority: 700

    Dica

    Esta técnica de apt-pinning é válida mesmo se estiver a seguir o
    arquivo stable. Pela minha experiência e até agora, os pacotes de
    documentação sempre foram seguros de instalar a partir do arquivo
    unstable.

%

2.7.7. Acompanhar unstable com alguns pacotes de experimental

    Aqui está outro exemplo de técnica de apt-pinning para incluir
    pacotes de versão de origem mais recentes encontrados em
    experimental enquanto segue unstable. Lista todos os arquivos
    necessários no ficheiro "/etc/apt/sources.list" conforme o
    seguinte:

    deb http://deb.debian.org/debian/ unstable main contrib non-free
    deb http://deb.debian.org/debian/ experimental main contrib non-free
    deb http://security.debian.org/ testing/updates main contrib

    O valor Pin-Priority predefinido para o arquivo experimental é
    sempre 1 (<<100) porque é um arquivo NotAutomatic (veja
    Secção 2.5.3, “Ficheiros "Release" do nível de arquivo”). Não é
    necessário definir o valor Pin-Priority explicitamente no
    ficheiro "/etc/apt/preferences" apenas para usar o arquivo
    experimental a menos que deseje seguir pacotes particulares nele
    automaticamente para a próxima atualização.

%

2.7.8. Descarga e atualização automática de pacotes

    O pacote apt vem com um script de cron próprio "/etc/cron.daily/
    apt" para suportar a descarga automática de pacotes. Este script
    pode ser melhorado para executar a atualização automática de
    pacotes ao instalar o pacote unattended-upgrades. Esta pode ser
    personalizada por parâmetros em "/etc/apt/apt.conf.d/02backup" e
    "/etc/apt/apt.conf.d/50unattended-upgrades" conforme descrito em
    "/usr/share/doc/unattended-upgrades/README".

    O pacote unattended-upgrades destina-se principalmente às
    atualizações de segurança do sistema stable. Se o risco de
    danificar um sistema stable existente pelas atualizações
    automáticas for menor que ser danificado por um intruso que usa
    buracos de segurança que foram fechados por atualizações de
    segurança, deve considerar usar estas atualizações automáticas
    com parâmetros de configuração como os a seguir.

    APT::Periodic::Update-Package-Lists "1";
    APT::Periodic::Download-Upgradeable-Packages "1";
    APT::Periodic::Unattended-Upgrade "1";

    Se estiver a correr um sistema unstable, não vai utilizar as
    atualizações automáticas, pois um dia, com certeza, irão
    danificar o seu sistema. Mesmo para casos de unstable, pode ainda
    querer descarregar os pacotes com antecedência para poupar tempo
    na atualização interativa com parâmetros de configuração como os
    a seguir.

    APT::Periodic::Update-Package-Lists "1";
    APT::Periodic::Download-Upgradeable-Packages "1";
    APT::Periodic::Unattended-Upgrade "0";

%

2.7.9. Limitar a largura de banda de descarga para o APT

    Se desejar limitar a largura de banda para o APT a, por exemplo,
    800Kib/sec (=100kiB/sec), deve configurar o APT e o parâmetro de
    configuração dele conforme o seguinte.

    APT::Acquire::http::Dl-Limit "800";

%

2.7.10. Downgrade de emergência

    Cuidado

    O downgrade (regressão de versão) não é suportado oficialmente
    pelo sistema Debian por design. Deverá ser feito apenas como
    parte de um processo de recuperação de emergência. Apesar desta
    situação, é conhecido por funcionar bem em muitos incidentes.
    Para sistemas críticos, Deve fazer salvaguardas (backups) de
    todos os dados importantes após a operação de recuperação e
    reinstalar um sistema novo a partir da estaca zero.

    Pode ter sorte ao fazer o downgrade de uma arquivo recente para
    um arquivo mais antigo para recuperar de uma atualização ao
    sistema que o deixou danificado ao manipular a versão candidata
    (veja Secção 2.7.3, “Moldar a versão candidata”). Esta é uma
    alternativa preguiçosa às acções tediosas de muitos comandos
    "dpkg -i <pacote-danificado>_<versão-antiga>.deb" (veja
    Secção 2.6.4, “Recuperação com o comando dpkg”).

    Procure as linhas no ficheiro "/etc/apt/sources.list" que
    acompanham unstable como a seguir.

    deb http://deb.debian.org/debian/ sid main contrib non-free

    Substitua-as de modo a acompanharem testing.

    deb http://deb.debian.org/debian/ bookworm main contrib non-free

    Configure o ficheiro "/etc/apt/preferences" como o seguinte:

    Package: *
    Pin: release a=testing
    Pin-Priority: 1010

    Corra "apt-get update; apt-get dist-upgrade" para forçar a
    regressão dos pacotes no sistema.

    Remova este ficheiro especial "/etc/apt/preferences" após este
    downgrade de emergência.

    Dica

    É uma boa ideia remover (não purgar) o máximo de pacotes para
    minimizar problemas de dependências. Pode necessitar remover e
    instalar manualmente alguns pacotes para conseguir o downgrade do
    sistema. O kernel Linux, gestor de arranque, udev, PAM, APT, os
    pacotes relacionados com a rede e os seus ficheiros de
    configuração requerem atenção especial.

%

2.7.11. Quem fez o upload do pacote?

    Apesar do nome do responsável listado em "/var/lib/dpkg/
    available" e "/usr/share/doc/package_name/changelog" fornecer
    alguma informação sobre "quem está por detrás a atividade de
    empacotamento", quem faz o upload real do pacote é um tanto
    obscuro. O who-uploads(1) no pacote devscripts identifica quem
    foi o uploader real dos pacotes fonte Debian.

%

2.7.12. O pacote equivs

    Se vai compilar um programa a partir do código-fonte para
    substituir um pacote Debian, o melhor é torná-lo num pacote local
    realmente 'debianizado' (*.deb) e utilizar um arquivo privado.

    Se escolher compilar um programa de fonte e instalá-lo sob "/usr/
    local", pode necessitar de utilizar o equivs como último recurso
    para satisfazer as dependências em falta para o pacote.

    Pacote: equivs
    Prioridade: optional
    Secção: admin
    Descrição: Rodear dependências de pacotes Debian
     Este pacote fornece uma ferramenta para criar pacotes Debian triviais.
     Tipicamente estes pacotes contêm apenas informação de dependências, mas
     eles podem também incluir ficheiros instalados normais como outros pacotes.
     .
     Um uso para isto é para criar um meta-pacote, um pacote cujo único
     objetivo é declarar dependências e conflitos com outros pacotes para que
     estes sejam automaticamente instalados, atualizados ou removidos.
     .
     Outro uso é rodear a verificação de dependências ao deixar que o dpkg
     pense que um determinado nome e versão de pacote esteja instalado quando
     não o está, você pode contornar bugs em outras dependências de pacotes.
     (Por favor, mesmo assim continue a comunicar tais bugs.)

%

2.7.13. Portar um pacote ao sistema stable

    Para atualizações parciais do sistema stable, é desejável
    reconstruir um pacote dentro do ambiente dele a utilizar um
    pacote de código-fonte. Isto evita atualizações maciças de
    pacotes devido às suas dependências.

    Adicione as seguintes entradas ao "/etc/apt/sources.list" num
    sistema stable.

    deb-src http://deb.debian.org/debian unstable  main contrib non-free

    Instale os pacotes necessários para a compilação e descarregue o
    pacote de código-fonte conforme o seguinte:

    # apt-get update
    # apt-get dist-upgrade
    # apt-get install fakeroot devscripts build-essential
    # apt-get build-dep foo
    $ apt-get source foo
    $ cd foo*

    atualize alguns pacotes de correntes de ferramentas como o dpkg e
    o debhelper a partir de pacotes de backport se forem necessários
    para o "backporting".

    Execute o seguinte.

    $ dch -i

    Aumentar a versão do pacote, p.e. um com "+bp1" acrescentado em
    "debian/changelog"

    Compile os pacotes e instale-os para o sistema com o seguinte:

    $ debuild
    $ cd ..
    # debi foo*.changes

%

2.7.14. Servidor proxy para o APT

    Como pôr em mirror uma sub-secção inteira do arquivo Debian é um
    desperdício de espaço de disco e largura de banda de rede, a
    implantação se um servidor proxy local para o APT é desejável a
    ter em consideração se administrar muitos sistemas em LAN. O APT
    pode ser configurado para utilizar servidores proxy web genéricos
    (http) como o squid (veja Secção 6.10, “Outras aplicações de
    servidor de rede”) conforme descrito em apt.conf(5) e em "/usr/
    share/doc/apt/examples/configure-index.gz". A variável de
    ambiente $http_proxy" pode ser utilizada para sobrepor a
    definição de servidor proxy do ficheiro "/etc/apt/apt.conf".

    Existem ferramentas de proxy especiais para o arquivo Debian.
    Deve verificar o BTS antes de as utilizar.

    Tabela 2.19. Lista de ferramentas proxy especiais para arquivos
    Debian

    +---------------------------------------------------------------+
    |   pacote    |popcon|tamanho|            descrição             |
    |-------------+------+-------+----------------------------------|
    |             |V:0,  |       |servidor proxy de cache para      |
    |approx       |I:0   |6317   |ficheiros de arquivo Debian       |
    |             |      |       |(programa OCaml compilado)        |
    |-------------+------+-------+----------------------------------|
    |             |V:0,  |       |Proxy de cache para pacotes Debian|
    |apt-cacher   |I:0   |289    |e ficheiros de código-fonte       |
    |             |      |       |(programa Perl)                   |
    |-------------+------+-------+----------------------------------|
    |             |V:5,  |       |Proxy de cache para distribuição  |
    |apt-cacher-ng|I:5   |1488   |de pacotes de software (programa  |
    |             |      |       |C++ compilado)                    |
    +---------------------------------------------------------------+


    Cuidado

    Quando Debian reorganiza a estrutura do arquivo dele, estas
    ferramentas de proxy especializadas tendem a necessitar ser
    reescritas de pelo responsável do pacote e podem não estar
    funcionais durante algum tempo. Por outro lado, os servidores
    proxy web (http) genéricos são mais robustos e mais fáceis de
    acompanhar estas mudanças.

%

2.7.15. Pequeno arquivo de pacotes público

    Dica

    Definir um arquivo de pacotes manualmente é complicado. Existem
    várias ferramentas de gestão de repositórios disponíveis. Está
    disponível online uma lista compreensiva.

    Aqui está uma demonstração para criar manualmente um pequeno
    arquivo de pacotes público compatível com o secure APT (veja
    Secção 2.5.2, “Ficheiro "Release" de nível de topo e
    autenticidade:”). Vamos assumir algumas coisas:

      * nome da conta: "foo"

      * Nome da máquina: "www.example.com"

      * Pacotes necessários: apt-utils, gnupg, e outros pacotes

      * URL: "http://www.example.com/~foo/" ( → "/home/foo/
        public_html/index.html")

      * Arquitectura de pacotes: "amd64"

    Crie uma chave de arquivo APT de Foo no seu sistema servidor como
    o seguinte:

    $ ssh foo@www.example.com
    $ gpg --gen-key
    ...
    $ gpg -K
    ...
    sec   1024D/3A3CB5A6 2008-08-14
    uid                  Foo (ARCHIVE KEY) <foo@www.example.com>
    ssb   2048g/6856F4A7 2008-08-14
    $ gpg --export -a 3A3CB5A6 >foo.public.key

    Publique o ficheiro de chave de arquivo "foo.public.key" com o ID
    de chave "3A3CB5A6" para Foo

    Crie uma árvore de arquivo chamada "Origin: Foo" como o seguinte:

    $ umask 022
    $ mkdir -p ~/public_html/debian/pool/main
    $ mkdir -p ~/public_html/debian/dists/unstable/main/binary-amd64
    $ mkdir -p ~/public_html/debian/dists/unstable/main/source
    $ cd ~/public_html/debian
    $ cat > dists/unstable/main/binary-amd64/Release << EOF
    Archive: unstable
    Version: 4.0
    Component: main
    Origin: Foo
    Label: Foo
    Architecture: amd64
    EOF
    $ cat > dists/unstable/main/source/Release << EOF
    Archive: unstable
    Version: 4.0
    Component: main
    Origin: Foo
    Label: Foo
    Architecture: source
    EOF
    $ cat >aptftp.conf <<EOF
    APT::FTPArchive::Release {
      Origin "Foo";
      Label "Foo";
      Suite "unstable";
      Codename "sid";
      Architectures "amd64";
      Components "main";
      Description "Public archive for Foo";
    };
    EOF
    $ cat >aptgenerate.conf <<EOF
    Dir::ArchiveDir ".";
    Dir::CacheDir ".";
    TreeDefault::diretory "pool/";
    TreeDefault::Srcdiretory "pool/";
    Default::Packages::Extensions ".deb";
    Default::Packages::Compress ". gzip bzip2";
    Default::Sources::Compress "gzip bzip2";
    Default::Contents::Compress "gzip bzip2";

    Bindiretory "dists/unstable/main/binary-amd64" {
      Packages "dists/unstable/main/binary-amd64/Packages";
      Contents "dists/unstable/Contents-amd64";
      SrcPackages "dists/unstable/main/source/Sources";
    };

    Tree "dists/unstable" {
      Sections "main";
      Architectures "amd64 source";
    };
    EOF

    Pode automatizar atualizações repetitivas do conteúdo do arquivo
    APT no seu sistema servidor a configurar o dupload.

    Pôr todos os ficheiros de pacotes em "~foo/public_html/debian/
    pool/main/" ao executar "dupload -t foo changes_file" no cliente
    enquanto o "~/.dupload.conf" contém o seguinte:

    $cfg{'foo'} = {
      fqdn => "www.exemplo.com",
      method => "scpb",
      incoming => "/home/foo/public_html/debian/pool/main",
      # The dinstall on ftp-master sends emails itself
      dinstall_runs => 1,
    };
   
    $cfg{'foo'}{postupload}{'changes'} = "
      echo 'cd public_html/debian ;
      apt-ftparchive generate -c=aptftp.conf aptgenerate.conf;
      apt-ftparchive release -c=aptftp.conf dists/unstable >dists/unstable/Release ;
      rm -f dists/unstable/Release.gpg ;
      gpg -u 3A3CB5A6 -bao dists/unstable/Release.gpg dists/unstable/Release'|
      ssh foo@www.exemplo.com  2>/dev/null ;
      echo 'Arquivo pacote criado!'";

    O script hook postupload inicializado pelo dupload(1) cria
    ficheiros de arquivo atualizados para cada upload.

    Pode adicionar este pequeno arquivo público à linha de apt do
    sistema cliente com o seguinte:

    $ sudo bash
    # echo "deb http://www.example.com/~foo/debian/ unstable main" \
       >> /etc/apt/sources.list
    # apt-key add foo.public.key

    Dica
   
    Se o arquivo estiver localizado no sistema de ficheiros local,
    então pode utilizar antes "deb file:///home/foo/debian/ …".

%

2.7.16. Gravar e copiar a configuração do sistema

    Pode criar uma cópia local do estado de seleção de pacotes e
    debconf com o seguinte:

    # dpkg --get-selections '*' > selection.dpkg
    # debconf-get-selections    > selection.debconf

    Aqui, "*" faz com que "selection.dpkg" também inclua entradas de
    pacotes para "purgar".

    Pode transferir estes 2 ficheiros para outro computador e
    instalá-los lá com o seguinte.

    # dselect update
    # debconf-set-selections < minha_seleção.debconf
    # dpkg --set-selections  < minha_seleção.dpkg
    # apt-get -u dselect-upgrade    # ou dselect install

    Se está a pensar em gerir muitos servidores num cluster com
    praticamente a mesma configuração, deve considerar utilizar um
    pacote especializado como o fai para gerir o sistema completo.

%

2.7.17. Converter e instalar um pacote binário alienígena

    O alien(1) permite a conversão de pacotes binários
    disponibilizados em formatos de ficheiro rpm da Red Hat, slp da
    Stampede, tgz de Slackware e pkg de Solaris num pacote deb
    Debian.Se quiser utilizar um pacote de outra distribuição de
    Linux em vez daquele que tem instalado no seu sistema, pode
    utilizar o alien para convertê-lo a partir do seu formato de
    pacote preferido e instala-lo. O alien também suporta pacotes
    LSB.

    Atenção

    O alien(1) não deve ser utilizado para substituir pacotes
    essenciais do sistema, tais como os sysvinit, libc6,
    libpam-modules, etc. Na prática, o alien(1) deve ser apenas
    utilizado para pacotes non-free apenas-binários que sejam
    compatíveis com LSB ou ligados estaticamente. Para softwares
    livres, deve utilizar o pacote de código-fonte deles para
    compilar pacotes Debian reais.

%

2.7.18. Extrair um pacote sem o dpkg

    O conteúdo dos pacotes "dpkg*.deb" pode ser extraído sem utilizar
    o dpkg(1) em qualquer ambiente estilo Unix a utilizar os ar(1) e 
    tar(1) standard.

    # ar x /path/to/dpkg_<version>_<arch>.deb
    # ls
    total 24
    -rw-r--r-- 1 bozo bozo  1320 2007-05-07 00:11 control.tar.gz
    -rw-r--r-- 1 bozo bozo 12837 2007-05-07 00:11 data.tar.gz
    -rw-r--r-- 1 bozo bozo     4 2007-05-07 00:11 debian-binary
    # mkdir control
    # mkdir data
    # tar xvzf control.tar.gz -C control
    # tar xvzf data.tar.gz -C data

    Os outros conteúdos do pacote "*.deb" podem ser extraídos pelo
    comando dpkg-deb(1) obtido do pacote "dpkg*.deb" como em cima; ou
    a usar o standard ar(1) e o novo tar(1) do GNU com o suporte de
    descompressão xz(1) de modo semelhante como em cima.

    Também pode explorar o conteúdo de um pacote a utilizar o comando
    mc.

%

2.7.19. Mais leituras sobre a gestão de pacotes

    Pode aprender mais sobre a gestão de pacotes a partir das
    seguintes documentações.

      * Documentações principais sobre a gestão de pacotes:

          + aptitude(8), dpkg(1), tasksel(8), apt(8), apt-get(8), 
            apt-config(8), apt-key(8), sources.list(5), apt.conf(5),
            and apt_preferences(5);

          + "/usr/share/doc/apt-doc/guide.html/index.html" e "/usr/
            share/doc/apt-doc/offline.html/index.html" do pacote
            apt-doc; e

          + "/usr/share/doc/aptitude/html/en/index.html" do pacote
            aptitude-doc-en.

      * Documentações oficiais e detalhadas no arquivo Debian:

          + "Manual de Política Debian Capítulo 2 - O Arquivo
            Debian",

          + "Referência dos Programadores de Debian, Capítulo 4 -
            Recursos para Programadores de Debian 4.6 O Arquivo
            Debian" e

          + "A FAQ de Debian GNU/Linux, Capítulo 6 - Os arquivos FTP
            de Debian".

      * Tutorial para construir um pacote Debian para utilizadores de
        Debian:

          + "Guia dos Novos Maintainers de Debian" (descontinuado).

          + "Guia para Mantedores de Debian".

Capítulo 3. A inicialização do sistema

    É inteligente para si como o administrador do sistema ter uma
    ideia como o sistema Debian é arranca e é configurado. Apesar dos
    detalhes exactos estarem nos ficheiros de código-fonte dos
    pacotes instalados e nas suas documentações, é um pouco exagerado
    para a maioria de nós.

    Fiz o meu melhor para disponibilizar uma visão geral breve dos
    pontos chave do sistema Debian e a configuração dele para a sua
    referência, a basear-me em conhecimentos atuais e anteriores dos
    meus e de outros. Como o sistema Debian é um alvo em movimento, a
    situação sobre o sistema pode ter mudado. Antes da fazer
    quaisquer alterações ao sistema, deve consultar a documentação
    mais recente de cada pacote.

    Dica
   
    bootup(7) descreve o processo de arranque do sistema baseado no
    systemd . (Debian Recente)

    Dica
   
    boot(7) descreve o processo de arranque do sistema baseado em
    UNIX System V Release 4. (Debian Antiga)

%

3.1. Uma visão geral do processo de arranque

    O sistema do computador passa por várias fases de processos de
    arranque desde o ligar da energia até que oferece, ao utilizador,
    o sistema operativo (SO) totalmente funcional.

    Para simplicidade, limito a discussão à plataforma PC típico com
    a instalação por omissão.

    O processo típico de arranque é como um foguete de quatro etapas.
    Cada etapa do foguete entrega o controle do sistema à próxima
    etapa.

      * Secção 3.1.1, “Estágio 1: a BIOS”

      * Secção 3.1.2, “Estágio 2: o gestor de arranque”
   
      * Secção 3.1.3, “Estágio 3: o mini-sistema Debian”

      * Secção 3.1.4, “Estágio 4: o sistema Debian normal”

    É claro que, estes podem ser configurados de modo diferente. Por
    exemplo, se compilou o seu próprio kernel, pode estar a saltar o
    passo com o mini sistema Debian. Portanto por favor não assuma
    que é este o caso para o seu sistema até que o verifique por si
    próprio.

    Nota

    Para uma plataforma de PC não-legacy como o sistema SUN ou o
    Macintosh, a BIOS em ROM e o particionamento do disco podem ser
    bastante diferentes (Secção 9.5.2, “Configuração das partições do
    disco”). Por favor procure noutro lado a documentação específica
    da plataforma para tais casos.

%

3.1.1. Estágio 1: a BIOS

    A BIOS é o 1ª etapa do processo de arranque que é iniciado com o
    evento de ligar a energia. A BIOS que reside na read only memory
    (ROM) é executada a partir de um endereço de memória particular
    no qual o contador de programa da CPU é inicializado pelo evento
    de ligar a energia.

    Esta BIOS executa a inicialização básica do hardware (POST: power
    on self test) e entrega o controle do sistema ao próximo passo
    que disponibiliza. A BIOS é normalmente disponibilizada com o
    hardware.

    O ecrã de arranque da BIOS geralmente indica que tecla(s)
    pressionar para entrar no ecrã de configuração da BIOS para
    configurar o comportamento da BIOS. As teclas populares são F1,
    F2, F10, Esc, Ins e Del. Se o seu ecrã de arranque da BIOS está
    escondido por um vistoso ecrã gráfico, pode pressionar algumas
    teclas como a Esc para o desativar. Estas teclas dependem
    fortemente do hardware.

    A localização do hardware e prioridade do código iniciado pela
    BIOS pode ser selecionado no ecrã de configuração da BIOS.
    Tipicamente, os primeiros poucos sectores do primeiro aparelho
    selecionado encontrado (disco rígido, disquete, CD-ROM, ...) são
    carregados à memória e este código inicial é executado. Este
    código inicial pode ser um dos seguintes:

      * O código do gestor de arranque

      * O código de kernel do SO da idade da pedra como o FreeDOS

      * O código do kernel do SO de destino se ele couber neste
        pequeno espaço

    Tipicamente, o sistema é arrancado a partir da partição
    especificada das partições do disco rígido principal. Os
    primeiros 2 sectores do disco rígido em PCs legacy contêm o
    master boot record (MBR). A informação de partições do disco
    incluindo a seleção de arranque é gravada no final deste MBR. O
    código do primeiro gestor de arranque executado pela BIOS ocupa o
    resto deste MBR.

%

3.1.2. Estágio 2: o gestor de arranque

    O gestor de arranque é o 2º estágio do processo de arranque que é
    iniciado pela BIOS. Ele carrega a imagem de kernel do sistema e a
    imagem initrd na memória e passa-lhes o controle. Esta imagem
    initrd é a imagem do sistema de ficheiros raiz e o suporte dele
    depende do gestor de arranque utilizado.

    O sistema Debian normalmente usa o kernel Linux como kernel
    predefinido do sistema. A imagem initrd para o kernel Linux 2.6/
    3.x atual é tecnicamente a initramfs (sistema de ficheiros de RAM
    inicial). A imagem básica initrd é um arquivo comprimido cpio de
    ficheiros no sistema de ficheiros raiz. O kernel pode atualizar
    micro código muito cedo durante o arranque antes de carregar esta
    imagem básica initrd. Isto é facilitado pela combinação da imagem
    initrd que é uma gota de micro código binário em formato cpio não
    comprimido seguido pela imagem básica initrd.

    Dica

    Pode inspeccionar o conteúdo do ficheiro imagem initrd a utilizar
    lsinitramfs(8) e unmkinitramfs(8) do pacote initramfs-tools-core.
    Saiba mais em https://wiki.debian.org/initramfs.

    A instalação predefinida do sistema Debian coloca código da
    primeira etapa do gestor de arranque GRUB no MBR para a
    plataforma PC. Existem muitos gestores de arranque e opções de
    configuração disponíveis.

    Tabela 3.1. Lista de gestores de arranque

    +----------------------------------------------------------------+
    |              |      |       |         | gestor |               |
    |    pacote    |popcon|tamanho| initrd  |   de   |   descrição   |
    |              |      |       |         |arranque|               |
    |--------------+------+-------+---------+--------+---------------|
    |              |      |       |         |        |É              |
    |              |      |       |         |        |suficientemente|
    |              |      |       |         |        |inteligente    |
    |              |      |       |         |        |para           |
    |grub-legacy   |V:0,  |735    |Suportado|GRUB    |compreender    |
    |              |I:2   |       |         |Legacy  |partições de   |
    |              |      |       |         |        |disco e        |
    |              |      |       |         |        |sistemas de    |
    |              |      |       |         |        |ficheiros como |
    |              |      |       |         |        |vfat, ext3, ...|
    |--------------+------+-------+---------+--------+---------------|
    |              |      |       |         |        |É              |
    |              |      |       |         |        |suficientemente|
    |              |      |       |         |        |inteligente    |
    |              |      |       |         |        |para           |
    |              |V:28, |       |         |        |compreender    |
    |grub-pc       |I:774 |533    |Suportado|GRUB 2  |partições de   |
    |              |      |       |         |        |disco e        |
    |              |      |       |         |        |sistemas de    |
    |              |      |       |         |        |ficheiros como |
    |              |      |       |         |        |vfat, ext4, ...|
    |              |      |       |         |        |(predefinição) |
    |--------------+------+-------+---------+--------+---------------|
    |              |      |       |         |        |Isto são       |
    |              |      |       |         |        |imagens de     |
    |              |      |       |         |        |arranque de    |
    |grub-rescue-pc|V:0,  |6367   |Suportado|GRUB 2  |recuperação do |
    |              |I:1   |       |         |        |GRUB 2 (CD ou  |
    |              |      |       |         |        |disquete)      |
    |              |      |       |         |        |(Versão PC/    |
    |              |      |       |         |        |BIOS)          |
    |--------------+------+-------+---------+--------+---------------|
    |              |      |       |         |        |Isto baseia-se |
    |              |      |       |         |        |nas            |
    |              |V:0,  |       |         |        |localizações de|
    |lilo          |I:2   |697    |Suportado|Lilo    |sectores de    |
    |              |      |       |         |        |dados no disco |
    |              |      |       |         |        |rígido.        |
    |              |      |       |         |        |(Antigo)       |
    |--------------+------+-------+---------+--------+---------------|
    |              |      |       |         |        |Isto compreende|
    |              |      |       |         |        |o sistema de   |
    |syslinux      |V:4,  |343    |Suportado|Isolinux|ficheiros      |
    |              |I:48  |       |         |        |ISO9660. É     |
    |              |      |       |         |        |utilizado pelo |
    |              |      |       |         |        |CD de arranque.|
    |--------------+------+-------+---------+--------+---------------|
    |              |      |       |         |        |Isto compreende|
    |              |      |       |         |        |o sistema de   |
    |              |V:4,  |       |         |        |ficheiros MSDOS|
    |syslinux      |I:48  |343    |Suportado|Syslinux|(FAT). É       |
    |              |      |       |         |        |utilizado pela |
    |              |      |       |         |        |disquete de    |
    |              |      |       |         |        |arranque.      |
    |--------------+------+-------+---------+--------+---------------|
    |              |      |       |         |        |Novo sistema é |
    |              |V:0,  |       |         |        |iniciado a     |
    |loadlin       |I:1   |90     |Suportado|Loadlin |partir do      |
    |              |      |       |         |        |sistema FreeDOS|
    |              |      |       |         |        |/MSDOS.        |
    |--------------+------+-------+---------+--------+---------------|
    |              |      |       |         |        |Isto é software|
    |              |      |       |         |        |livre que      |
    |              |      |       |         |MBR por |substitui o MBR|
    |mbr           |V:0,  |50     |Não      |Neil    |do MSDOS.      |
    |              |I:7   |       |suportado|Turton  |Apenas         |
    |              |      |       |         |        |compreende     |
    |              |      |       |         |        |partições de   |
    |              |      |       |         |        |disco.         |
    +----------------------------------------------------------------+


    Atenção

    Não brinque com os gestores de arranque sem ter discos de
    arranque de recuperação (caneta USB, CD ou disquete) criados a
    partir de imagens do pacote grub-rescue-pc. Torna-o capaz de
    arrancar o seu sistema mesmo sem um gestor de arranque funcional
    no disco rígido.

    Para o GRUB Legacy, o ficheiro de configuração do menu está
    localizado em "/boot/grub/menu.lst". Por exemplo, tem entradas
    como a seguinte.

    title           Debian GNU/Linux
    root            (hd0,2)
    kernel          /vmlinuz root=/dev/hda3 ro
    initrd          /initrd.img

    Para o GRUB 2, o ficheiro de configuração do menu está localizado
    em "/boot/grub/grub.cfg". É gerado automaticamente pelo "/usr/
    sbin/update-grub" a utilizar modelos de "/etc/grub.d/*" e
    definições de "/etc/default/grub". Por exemplo, tem entradas como
    as a seguir:

    menuentry "Debian GNU/Linux" {
            set root=(hd0,3)
            linux /vmlinuz root=/dev/hda3
            initrd /initrd.img
    }

    Para estes exemplos, estes parâmetros do GRUB significam o
    seguinte.

    Tabela 3.2. O significado dos parâmetros do GRUB

    +---------------------------------------------------------------+
    |Parâmetro|                     significado                     |
    | do GRUB |                                                     |
    |---------+-----------------------------------------------------|
    |         |utiliza a 3ª partição no disco primário ao defini-la |
    |root     |como "(hd0,2)" no GRUB Legacy ou como "(hd0,3)" no   |
    |         |GRUB 2                                               |
    |---------+-----------------------------------------------------|
    |kernel   |utiliza o kernel localizado em "/vmlinuz" com        |
    |         |parâmetro de kernel: "root=/dev/hda3 ro"             |
    |---------+-----------------------------------------------------|
    |initrd   |utiliza a imagem initrd/initramfs localizada em "/   |
    |         |initrd.img"                                          |
    +---------------------------------------------------------------+


    Nota

    O valor do número de partição utilizado pelo programa GRUB legacy
    é menos um que o normal usado pelo kernel Linux e ferramentas
    utilitárias. O programa GRUB 2 corrige este problema.

    Dica

    Pode ser utilizado o UUID (veja Secção 9.5.3, “Aceder a partição
    a usar UUID”) para identificar um aparelho especial de bloco em
    vez do nome de ficheiro dele como "/dev/hda3", ex. "root=UUID=
    81b289d5-4341-4003-9602-e254a17ac232 ro".

    Dica

    Se for usado o GRUB, o parâmetro de arranque do kernel é definido
    em /boot/grub/grub.cfg. No sistema Debian, não se deve editar o /
    boot/grub/grub.cfg directamente. Deve editar o valor de
    GRUB_CMDLINE_LINUX_DEFAULT em /etc/default/grub e correr 
    update-grub(8) para atualizar o /boot/grub/grub.cfg.

    Dica
   
    Pode iniciar um gestor de arranque a partir de outro gestor de
    arranque a utilizar técnicas chamadas chain loading.

    Veja "info grub" e grub-install(8).

%

3.1.3. Estágio 3: o mini-sistema Debian

    O mini-sistema Debian é o 3º estágio do processo de arranque que
    é iniciado pelo gestor de arranque. Corre o kernel do sistema com
    o sistema de ficheiros raiz dele na memória. Este é um estágio
    preparatório opcional do processo de arranque.

    Nota

    O termo "mini-sistema Debian" é cunhado pelo autor para descrever
    este 3º estágio do processo de arranque para este documento. Este
    sistema é geralmente referido como o initrd ou sistema initramfs.
    É utilizado pelo Instalador de Debian um sistema semelhante em
    memória .

    O programa "/init" é executado como o primeiro programa neste
    sistema de ficheiros raiz em memória. É um programa que
    inicializa o kernel no espaço de utilizador e entrega o controle
    ao próximo estágio. Este mini-sistema Debian oferece
    flexibilidade ao processo de arranque tal como adicionar módulos
    de kernel antes do processo de arranque principal ou montar o
    sistema de ficheiros raiz como um encriptado.

      * O programa "/init" é um programa de script de shell se a
        initramfs for criada pelo initramfs-tools.

          + Pode interromper esta parte do processo de arranque para
            obter a shell de root ao fornecer "break=init" etc. ao
            parâmetro de arranque do kernel. Veja o script "/init"
            para mais condições de interrupção. Este ambiente shell é
            suficientemente sofisticado para fazer uma boa inspecção
            do hardware da sua máquina.
   
          + Os comandos disponíveis neste mini-sistema Debian são
            versões reduzidas e disponibilizados principalmente por
            uma ferramenta GNU chamada busybox(1).

      * O programa "/init" é um programa binário do systemd se a
        initramfs for criada pelo dracut.

          + Os comandos disponíveis neste mini-sistema Debian são
            versões reduzidas do ambiente systemd(1).

    Cuidado
   
    Precisa de utilizar a opção "-n" para o comando mount quando está
    no sistema de ficheiros raiz apenas de leitura.

%

3.1.4. Estágio 4: o sistema Debian normal

    O sistema Debian normal é o 4º estágio do processo de arranque
    que é iniciado pelo mini-sistema Debian. O kernel do sistema para
    o mini-sistema Debian continua a correr nesse ambiente. O sistema
    de ficheiros raiz é mudado daquele na memória para o que está no
    sistema de ficheiros do disco rígido real.

    O programa init é executado como o primeiro programa com PID=1
    para executar o processo de arranque principal de arrancar muitos
    programas. O caminho de ficheiro predefinido ao programa init é "
    /sbin/init" mas pode ser alterado pelo parâmetro de arranque do
    kernel como "init=/path/to/init_program".

    O programa de iniciação predefinido tem sido alterado:

      * Debian antes de squeeze a iniciação de estilo SysV simples.

      * Debian wheezy melhora a iniciação de estilo SysV ao ordenar a
        sequência de arranque com cabeçalho LSB e a arrancar scripts
        de arranque em paralelo.

      * Debian jessie muda o init predefinido dele ao systemd para a
        inicialização em paralelo e gerida por eventos.

    Dica
   
    O comando de iniciação atual do seu sistema pode ser verificado
    pelo comando "ps --pid 1 -f".

    Dica
   
    "/sbin/init" é uma ligação simbólica para "/lib/systemd/systemd"
    após Debian jessie.

    Tabela 3.3. Lista de utilitários de arranque para o sistema
    Debian

    +---------------------------------------------------------------+
    |      pacote       |popcon|tamanho|         descrição          |
    |-------------------+------+-------+----------------------------|
    |                   |V:810,|       |daemon de eventos baseado em|
    |systemd            |I:916 |15998  |init(8) para a concorrência |
    |                   |      |       |(alternativa a sysvinit)    |
    |-------------------+------+-------+----------------------------|
    |                   |V:802,|       |os manuais e ligações       |
    |systemd-sysv       |I:914 |138    |necessárias pelo systemd    |
    |                   |      |       |para substituir o sysvinit  |
    |-------------------+------+-------+----------------------------|
    |                   |V:1,  |       |unidades do systemd para    |
    |systemd-cron       |I:1   |143    |disponibilizar o daemon cron|
    |                   |      |       |e a funcionalidade anacron  |
    |-------------------+------+-------+----------------------------|
    |                   |V:675,|       |ferramentas de ajuda para   |
    |init-system-helpers|I:930 |131    |mudar entre sysvinit e      |
    |                   |      |       |systemd                     |
    |-------------------+------+-------+----------------------------|
    |initscripts        |V:91, |176    |scripts para inicializar e  |
    |                   |I:323 |       |desligar o sistema          |
    |-------------------+------+-------+----------------------------|
    |sysvinit-core      |V:7,  |276    |utilitários de init(8)      |
    |                   |I:9   |       |estilo System-V             |
    |-------------------+------+-------+----------------------------|
    |sysv-rc            |V:183,|81     |mecanismo de mudança de     |
    |                   |I:335 |       |runlevel estilo System-V    |
    |-------------------+------+-------+----------------------------|
    |                   |V:494,|       |utilitários estilo System-V |
    |sysvinit-utils     |I:999 |79     |(startpar(8), bootlogd(8),  |
    |                   |      |       |…)                          |
    |-------------------+------+-------+----------------------------|
    |                   |V:881,|       |Linux Standard Base         |
    |lsb-base           |I:999 |49     |funcionalidade de script de |
    |                   |      |       |init 3.2                    |
    |-------------------+------+-------+----------------------------|
    |                   |      |       |ferramenta para organizar a |
    |insserv            |V:210,|150    |sequência de arranque a usar|
    |                   |I:330 |       |dependências dos scripts    |
    |                   |      |       |init.d LSB                  |
    |-------------------+------+-------+----------------------------|
    |                   |      |       |ferramentas disponibilizadas|
    |uswsusp            |V:3,  |714    |pelo Linux para utilizar a  |
    |                   |I:8   |       |suspensão de software no    |
    |                   |      |       |espaço de utilizador        |
    |-------------------+------+-------+----------------------------|
    |                   |V:1,  |       |ferramenta kexec para       |
    |kexec-tools        |I:8   |278    |re-arranques kexec(8)       |
    |                   |      |       |(re-arranque a quente)      |
    |-------------------+------+-------+----------------------------|
    |systemd-bootchart  |V:0,  |128    |analisador de performance do|
    |                   |I:1   |       |processo de arranque        |
    |-------------------+------+-------+----------------------------|
    |bootchart2         |V:0,  |94     |analisador de performance do|
    |                   |I:0   |       |processo de arranque        |
    |-------------------+------+-------+----------------------------|
    |                   |V:0,  |       |analisador de performance do|
    |pybootchartgui     |I:0   |177    |processo de arranque        |
    |                   |      |       |(visualização)              |
    |-------------------+------+-------+----------------------------|
    |mingetty           |V:0,  |38     |getty(8) apenas de consola  |
    |                   |I:3   |       |                            |
    |-------------------+------+-------+----------------------------|
    |mgetty             |V:0,  |315    |substituto inteligente de   |
    |                   |I:1   |       |modem getty(8)              |
    +---------------------------------------------------------------+


    Dica
   
    Veja Debian wiki: BootProcessSpeedup para as dicas mais recentes
    em como acelerar o processo de arranque.

%

3.2. init do Systemd

    Esta secção descreve como o sistema é arrancado pelo programa 
    systemd(1) com PID=1 (i.e., processo init).

    O processo init do systemd espalha processos em paralelo com base
    nos ficheiros de configuração de unit (veja systemd.unit(5)) os
    quais são escritos em estilo declarativo em vez do estilo
    processual tipo SysV. Estes são carregados a partir de um
    conjunto de localizações (veja systemd-system.conf(5)) como a
    seguir:

      * "/lib/systemd/system": Ficheiros de configuração predefinidos
        do Sistema Operativo

      * "/etc/systemd/system": ficheiros de configuração do
        administrador do sistema que se sobrepõem aos ficheiros de
        configuração predefinidos do Sistema Operativo

      * "/run/systemd/system": ficheiros de configuração gerados em
        run-time que se sobrepõem aos ficheiros de configuração
        instalados

    As suas inter-dependências são especificadas pelas directivas
    "Wants=", "Requires=", "Before=", "After=", … (veja "MAPPING OF
    UNIT PROPERTIES TO THEIR INVERSES" em systemd.unit(5)). Os
    controlos de recursos estão também definidos (veja 
    systemd.resource-control(5)).

    O sufixo do ficheiro de configuração da unidade codifica os seus
    tipos como:

      * *.service descreve o processo controlado e supervisionado
        pelo systemd. Veja systemd.service(5).

      * *.device descreve o aparelho exposto em sysfs(5) como uma
        árvore de aparelhos do udev(7). Veja systemd.device(5).

      * *.mount descreve o ponto de montagem do sistema de ficheiros
        controlado e supervisionado pelo systemd. Veja systemd.mount
        (5).

      * *.automount Descreve o ponto de montagem automático do
        sistema de ficheiros controlado e supervisionado pelo
        systemd. Veja systemd.automount(5).

      * *.swap descreve o aparelho ou ficheiro de memória virtual
        (swap) controlado e supervisionado pelo systemd. Veja 
        systemd.swap(5).

      * *.path descreve o caminho monitorizado pelo systemd para
        activação baseada-no-caminho. Veja systemd.path(5).

      * *.socket descreve o socket controlado e supervisionado pelo
        systemd para activação baseada-em-socket. Veja systemd.socket
        (5).

      * *.timer descreve o temporizador controlado e supervisionado
        pelo systemd para activação baseada-em-temporização. Veja 
        systemd.timer(5).

      * *.slice gere recursos com cgroups(7). Veja systemd.slice(5).

      * *.scope é criado programaticamente a usar as interfaces de
        barramento do systemd para gerir um conjunto de processos do
        sistema. Veja systemd.scope(5).

      * *.target agrupa outros ficheiros de configuração de unit para
        criar o ponto de sincronização durante o arranque. Veja 
        systemd.target(5).

    Após o arranque do sistema (o, init), o processo systemd tenta
    arrancar o "/lib/systemd/system/default.target (que normalmente é
    uma ligaö#ao simbólica para "graphical.target"). Primeiro,
    algumas unidades alvo especiais (veja systemd.special(7)) tais
    como "local-fs.target", "swap.target" e "cryptsetup.target" são
    puxadas para montar os sistemas de ficheiros. Depois, outras
    unidades alvo são também puxadas pelas dependências da unidade
    alvo. Para mais detalhes. leia bootup(7).

    O systemd oferece funcionalidades de compatibilidade regressiva.
    Os scripts de arranque estilo SysV em "/etc/init.d/rc[0123456S].d
    /[KS]<name>" são ainda analisados e telinit(8) é traduzido em
    pedidos activação de unidade do systemd.

    Cuidado
   
    Os runlevel 2 a 4 emulados são todos direccionados por uma
    ligação simbólica ao mesmo "alvo de multi-utilizador".

%

3.2.1. O nome da máquina

    O kernel mantém o nome-de-máquina do sistema. A unidade do
    sistema arrancado por systemd-hostnamed.service define o nome de
    máquina do sistema durante o arranque ao nome armazenado em "/etc
    /hostname". Este ficheiro deve conter apenas o nome de máquina do
    sistema e não um nome de domínio totalmente qualificado.

    Para escrever o nome de máquina atual corra hostname(1) sem
    argumentos.

%

3.2.2. O sistema de ficheiros

    As opções de montagem de sistemas de ficheiros de discos normais
    e de rede são definidas em "/etc/fstab". Veja fstab(5) e
    Secção 9.5.7, “Optimização do sistema de ficheiros por opções de
    montagem”.

    A configuração do sistema de ficheiros encriptado é definida em "
    /etc/crypttab". Veja crypttab(5)

    A configuração do software RAID com mdadm(8) é definida em "/etc/
    mdadm/mdadm.conf". Veja mdadm.conf(5).

    Atenção

    Após montar todos os sistemas de ficheiros, os ficheiros
    temporários em "/tmp", "/var/lock" e "/var/run" são limpos para
    cada arranque.

%

3.2.3. Inicialização da interface de rede

    As interfaces de rede são tipicamente iniciadas em
    "networking.service" para a interface lo e
    "NetworkManager.service" para as outras interfaces em sistemas
    Debian modernos sob systemd.

    Veja Capítulo 5, Configuração de rede para saber como os
    configurar.

%

3.2.4. A mensagem do kernel

    As mensagens de erros do kernel mostradas na consola podem ser
    configuradas ao definir o nível de limiar dele.

    # dmesg -n3

    Tabela 3.4. Lista de níveis de erro do kernel

    +---------------------------------------------------------------+
    |valor de nível de|nome de nível de|        significado         |
    |      erro       |      erro      |                            |
    |-----------------+----------------+----------------------------|
    |0                |KERN_EMERG      |sistema está inutilizável   |
    |-----------------+----------------+----------------------------|
    |1                |KERN_ALERT      |acção tem de ser tomada     |
    |                 |                |imediatamente               |
    |-----------------+----------------+----------------------------|
    |2                |KERN_CRIT       |condições críticas          |
    |-----------------+----------------+----------------------------|
    |3                |KERN_ERR        |condições de erro           |
    |-----------------+----------------+----------------------------|
    |4                |KERN_WARNING    |condições de aviso          |
    |-----------------+----------------+----------------------------|
    |5                |KERN_NOTICE     |condição normal mas         |
    |                 |                |significante                |
    |-----------------+----------------+----------------------------|
    |6                |KERN_INFO       |informativa                 |
    |-----------------+----------------+----------------------------|
    |7                |KERN_DEBUG      |mensagens de nível de       |
    |                 |                |depuração                   |
    +---------------------------------------------------------------+


%

3.2.5. A mensagem do sistema

    Sob systemd, ambas mensagens de kernel e sistema são registadas
    pelo serviço journal systemd-journald.service (também conhecido
    por journald) seja em dados binários persistentes em "/var/log/
    journal" ou em dados binários voláteis em "/run/log/journal/".
    Estes dados de relatório binários são acedidos pelo comando 
    journalctl(1).

    Sob systemd, o utilitário de relatórios do sistema rsyslogd(8)
    muda o comportamento dele para ler os dados de relatório binários
    voláteis (em vez do predefinido pre-systemd "/dev/log") e para
    criar dados de relatório do sistema em ASCII tradicional
    permanente.

    A mensagem do sistema pode ser personalizada em "/etc/default/
    rsyslog" e "/etc/rsyslog.conf" quer para o ficheiro de registo
    quer para as mensagens no ecrã. Veja rsyslogd(8) e rsyslog.conf
    (5). Veja também Secção 9.2.2, “Analisador de relatório (Log)”.

%

3.2.6. Gestão do sistema sob systemd

    O systemd oferece não apenas um sistema de arranque mas também
    funcionalidades genéricas de gestão de sistema tais como
    relatórios de journal, gestão de login, gestão de horas, gestão
    de rede, etc...

    O systemd(1) é gerido por vários comandos:

      * o comando systemctl(1) controla o sistema systemd e o gestor
        de serviço (CLI),

      * o comandosystemsdm(1) controla o sistema systemd e o gestor
        de serviço (GUI),
   
      * O comando journalctl(1) consulta o journal do systemd,

      * o comando loginctl(1) controla o gestor de login do systemd e

      * o systemd-analyze(1) analisa a performance do arranque do
        sistema.

    Aqui está uma lista dos comandos típicos do systemd. Para os
    significados exactos, por favor leia os manuais relevantes.

    Tabela 3.5. Lista de trechos de comandos típicos de gestão do
    systemd

    +---------------------------------------------------------------+
    |            Operação            |  Tipo  |Fragmentos de comando|
    |--------------------------------+--------+---------------------|
    |GUI para gestão do serviço      |GUI     |"systemadm"          |
    |                                |        |(systemd-ui pacote)  |
    |--------------------------------+--------+---------------------|
    |Lista toda a configuração da    |Unidade |"systemctl list-units|
    |unidade alvo                    |        |--type=target"       |
    |--------------------------------+--------+---------------------|
    |Lista toda a configuração da    |Unidade |"systemctl list-units|
    |unidade de serviço              |        |--type=service"      |
    |--------------------------------+--------+---------------------|
    |Lista todos os tipos de         |Unidade |"systemctl list-units|
    |configuração da unidade         |        |--type=help"         |
    |--------------------------------+--------+---------------------|
    |Lista todas unidades de socket  |Unidade |"systemctl           |
    |em memória                      |        |list-sockets"        |
    |--------------------------------+--------+---------------------|
    |Lista todas as unidades de      |Unidade |"systemctl           |
    |temporizador em memória         |        |list-timers"         |
    |--------------------------------+--------+---------------------|
    |Iniciar o "$unit"               |Unidade |"systemctl start     |
    |                                |        |$unit"               |
    |--------------------------------+--------+---------------------|
    |Parar o "$unit"                 |Unidade |"systemctl stop      |
    |                                |        |$unit"               |
    |--------------------------------+--------+---------------------|
    |Recarregar configuração         |Unidade |"systemctl reload    |
    |específica do serviço           |        |$unit"               |
    |--------------------------------+--------+---------------------|
    |Parar e iniciar todo "$unit"    |Unidade |"systemctl restart   |
    |                                |        |$unit"               |
    |--------------------------------+--------+---------------------|
    |Iniciar o "$unit" e parar todos |Unidade |"systemctl isolate   |
    |os outros                       |        |$unit"               |
    |--------------------------------+--------+---------------------|
    |Mudar para "gráfico" (sistema   |Unidade |"systemctl isolate   |
    |GUI)                            |        |graphical"           |
    |--------------------------------+--------+---------------------|
    |Mudar para "multi-utilizador"   |Unidade |"systemctl isolate   |
    |(sistema CLI)                   |        |multi-user"          |
    |--------------------------------+--------+---------------------|
    |Mudar para "recuperação"        |        |"systemctl isolate   |
    |(sistema CLI de único           |Unidade |rescue"              |
    |utilizador)                     |        |                     |
    |--------------------------------+--------+---------------------|
    |Enviar sinal kill ao "$unit"    |Unidade |"systemctl kill      |
    |                                |        |$unit"               |
    |--------------------------------+--------+---------------------|
    |Verificar se o serviço "$unit"  |Unidade |"systemctl is-active |
    |está ativo                      |        |$unit"               |
    |--------------------------------+--------+---------------------|
    |Verificar se o serviço "$unit"  |Unidade |"systemctl is-failed |
    |falhou                          |        |$unit"               |
    |--------------------------------+--------+---------------------|
    |Verifica o estado de "$unit|$PID|Unidade |"systemctl status    |
    ||aparelho"                      |        |$unit|$PID|$device"  |
    |--------------------------------+--------+---------------------|
    |Mostra propriedades de 1"$unit| |Unidade |"systemctl show $unit|
    |$job"                           |        ||$job"               |
    |--------------------------------+--------+---------------------|
    |Reinicia um "$unit" falhado     |Unidade |"systemctl           |
    |                                |        |reset-failed $unit"  |
    |--------------------------------+--------+---------------------|
    |List dependências de todos os   |        |"systemctl           |
    |serviços unit                   |Unidade |list-dependencies    |
    |                                |        |--all"               |
    |--------------------------------+--------+---------------------|
    |Lista ficheiros unit instalados |Ficheiro|"systemctl           |
    |no sistema                      |unit    |list-unit-files"     |
    |--------------------------------+--------+---------------------|
    |Ativa "$unit" (adicionar ligação|Ficheiro|"systemctl enable    |
    |simbólica)                      |unit    |$unit"               |
    |--------------------------------+--------+---------------------|
    |Desactiva "$unit" (remove       |Ficheiro|"systemctl disable   |
    |ligação simbólica)              |unit    |$unit"               |
    |--------------------------------+--------+---------------------|
    |Desmascara "$unit" (remove      |Ficheiro|"systemctl unmask    |
    |ligação simbólica para "/dev/   |unit    |$unit"               |
    |null")                          |        |                     |
    |--------------------------------+--------+---------------------|
    |Mascara "$unit" (adicionar      |Ficheiro|"systemctl mask      |
    |ligação simbólica para "/dev/   |unit    |$unit"               |
    |null")                          |        |                     |
    |--------------------------------+--------+---------------------|
    |Obter definição de              |Ficheiro|"systemctl           |
    |alvo-predefinido                |unit    |get-default"         |
    |--------------------------------+--------+---------------------|
    |Define alvo-predefinido para    |Ficheiro|"systemctl           |
    |"graphical" (sistema GUI)       |unit    |set-default          |
    |                                |        |graphical"           |
    |--------------------------------+--------+---------------------|
    |Define alvo-predefinido para    |Ficheiro|"systemctl           |
    |"multi-user" (sistema CLI)      |unit    |set-default          |
    |                                |        |multi-user"          |
    |--------------------------------+--------+---------------------|
    |Mostra ambiente da função       |Ambiente|"systemctl           |
    |                                |        |show-environment"    |
    |--------------------------------+--------+---------------------|
    |Define "variável" de ambiente de|        |"systemctl           |
    |função para "valor"             |Ambiente|set-environment      |
    |                                |        |variável=valor"      |
    |--------------------------------+--------+---------------------|
    |Remove a definição da "variável"|        |"systemctl           |
    |de ambiente de função           |Ambiente|unset-environment    |
    |                                |        |variável"            |
    |--------------------------------+--------+---------------------|
    |Reinicia todos os ficheiros unit|Ciclo de|"systemctl           |
    |e os daemons                    |vida    |daemon-reload"       |
    |--------------------------------+--------+---------------------|
    |Desligar o sistema              |Sistema |"systemctl poweroff" |
    |--------------------------------+--------+---------------------|
    |Desligar e reiniciar o sistema  |Sistema |"systemctl reboot"   |
    |--------------------------------+--------+---------------------|
    |Suspender o sistema             |Sistema |"systemctl suspend"  |
    |--------------------------------+--------+---------------------|
    |Hibernar o sistema              |Sistema |"systemctl hibernate"|
    |--------------------------------+--------+---------------------|
    |Ver o log de trabalho do "$unit"|Journal |"journalctl -u $unit"|
    |--------------------------------+--------+---------------------|
    |Visualizar relatório de função  |Journal |"journalctl -u $unit |
    |de "$unit" (estilo "tail -f")   |        |-f"                  |
    |--------------------------------+--------+---------------------|
    |Mostra o tempo gasto em cada    |Analisar|"systemd-analyze     |
    |passo de inicialização          |        |time"                |
    |--------------------------------+--------+---------------------|
    |Lista de todas as unidades pelo |Analisar|"systemd-analyze     |
    |tempo de inicialização          |        |blame"               |
    |--------------------------------+--------+---------------------|
    |Carrega e detecta erros no      |Analisar|"systemd-analyze     |
    |ficheiro "$unit"                |        |verify $unit"        |
    |--------------------------------+--------+---------------------|
    |Segue os processos de arranque  |Cgroup  |"systemd-cgls"       |
    |pelo cgroups(7)                 |        |                     |
    |--------------------------------+--------+---------------------|
    |Segue os processos de arranque  |Cgroup  |"ps xawf -eo         |
    |pelo cgroups(7)                 |        |pid,user,cgroup,args"|
    |--------------------------------+--------+---------------------|
    |Segue os processos de arranque  |Cgroup  |Lê sysfs sob "/sys/fs|
    |pelo cgroups(7)                 |        |/cgroup/systemd/"    |
    +---------------------------------------------------------------+


    Aqui, "$unit" nos exemplos em cima pode ser um único nome de
    unidade (sufixos como .service e .target são opcionais) ou, em
    muitos casos, especificações de múltiplas unidades (a simbologia
    da shell "*", "?", "[]" a utilizar fnmatch(3) serão
    correspondidos aos nomes primários de todas as unidades
    presentemente em memória).

    Os comandos de alteração do estado do sistema nos exemplos em
    cima são tipicamente precedidos por "sudo" para obter os
    privilégios administrativos necessários.

    Os resultados de "systemctl status $unit|$PID|$aparelho" usam
    cores no ponto ("●") para sumarizar rapidamente o estado da
    unidade.

      * Ponto "●" branco indica estado "inativo" ou "desactivado".

      * Ponto "●" vermelho indica um estado de "falha" ou "erro".

      * Ponto "●" verde indica um estado "ativo", "a reiniciar" ou "a
        ativar".

%

3.2.7. Personalizar o systemd

    Com uma instalação predefinida, muitos serviços de rede (veja
    Capítulo 6, Aplicações de rede) são arrancados como processos
    daemon após network.target durante o arranque do sistema pelo
    systemd. O "sshd" não é excepção. Vamos mudar isto para arranque
    a-pedido do "sshd" como um exemplo de personalização.

    Primeiro, desativar a unidade de serviço instalada no sistema.

     $ sudo systemctl stop sshd.service
     $ sudo systemctl mask sshd.service

    O sistema de activação de socket a-pedido dos serviços clássicos
    de Unix acontecia através do super-servidor indetd. Sob o
    systemd, pode ser activado o equivalente ao adicionar ficheiros
    de configuração de unidade *.socket e *.service.

    sshd.socket para especificar um socket onde escutar

    [Unit]
    Description=SSH Socket for Per-Connection Servers

    [Socket]
    ListenStream=22
    Accept=yes

    [Install]
    WantedBy=sockets.target

    sshd@.service como o ficheiro de serviço correspondente do
    sshd.socket

    [Unit]
    Description=SSH Per-Connection Server
   
    [Service]
    ExecStart=-/usr/sbin/sshd -i
    StandardInput=socket

    Depois reinicie.

     $ sudo systemctl daemon-reload

%

3.3. O sistema udev

    Para o kernel Linux 2.6 e mais recentes, o sistema udev
    disponibiliza um mecanismo para a descoberta automática de
    hardware e inicialização (veja udev(7)). Após a descoberta de
    cada aparelho pelo kernel, o sistema udev arranca um processo de
    utilizador que usa informação a partir do sistema de ficheiros
    sysfs (veja Secção 1.2.12, “procfs e sysfs”), carrega os módulos
    de kernel necessários para o suportar a usar o programa modprobe
    (8) (veja Secção 3.3.1, “A inicialização de módulos do kernel”),
    e cria os nós correspondentes do aparelho.

    Dica

    Se "/lib/modules/<versão-de-kernel>/modules.dep" não foi gerado
    de modo apropriado pelo depmod(8) por alguma razão, os módulos
    podem não carregar como esperado pelo sistema udev. Execute
    "depmod -a" para o corrigir.

    Os nomes dos nós de aparelhos podem ser configurados pelos
    ficheiros de regras do udev em "/etc/udev/rules.d/". As regras
    predefinidas atuais tentem a criar nomes gerados dinamicamente a
    resultar em nomes de aparelhos não estáticos excepto para
    aparelhos de cd e de rede. Ao adicionar os seus ficheiros
    personalizados de modo semelhante ao que é feito pelos aparelhos
    de cd e rede, também pode gerar nomes estáticos para aparelhos
    para outros aparelhos como pens USB de memória. Veja "Escrever
    regras do udev" ou "/usr/share/doc/udev/writing_udev_rules/
    index.html".

    Como o sistema udev é de certa forma um alvo em movimento, deixo
    os detalhes para outras documentações e descrevo a informação
    mínima aqui.

    Dica

    Para regras de montagem em "/etc/fstab", os nós de aparelhos não
    precisam de ser os estáticos. Pode usar o UUID para montar os
    aparelhos em vez dos nomes de aparelho como "/dev/sda". Veja
    Secção 9.5.3, “Aceder a partição a usar UUID”.

%

3.3.1. A inicialização de módulos do kernel

    O programa modprobe(8) permite-nos configurar o kernel Linux em
    execução a partir do processo de utilizador ao adicionar e
    remover módulos do kernel. O sistema udev (veja Secção 3.3, “O
    sistema udev”) automatiza a invocação dele para ajudar na
    inicialização dos módulos de kernel.

    Existem módulos de não-hardware e módulos driver de hardware
    especial como os seguintes que precisam de ser pré-carregados ao
    listá-los no ficheiro "/etc/modules" (veja modules(5)).

      * módulos TUN/TAP que disponibilizam aparelhos de rede
        Point-to-Point virtuais (TUN) e aparelhos de rede Ethernet
        virtuais (TAP),

      * módulos netfilter que disponibilizam capacidades de firewall
        netfilter (iptables(8), Secção 5.10, “Infraestrutura
        netfilter”) e

      * módulos de driver watchdog timer.

    Os ficheiros de configuração para o programa modprobe(8) estão
    localizados sob o diretório "/etc/modprobes.d/" como explicado em
    modprobe.conf(5). (Se deseja evitar que alguns módulos do kernel
    sejam carregados automaticamente, considere metê-los em lista
    negra no ficheiro "/etc/modprobes.d/blacklist".)

    O ficheiro "/lib/modules/<version>/modules.dep" gerado pelo
    programa depmod(8) descreve as dependências dos módulos usados
    pelo programa modprobe(8).

    Nota

    Se tiver problemas com o carregamento de módulos durante o
    arranque ou com o modprobe(8), "depmod -a" pode resolver esses
    problemas ao reconstruir "modules.dep".

    O programa modinfo(8) mostra informação sobre um módulo do kernel
    Linux.

    O programa lsmod(8) formata lindamente o conteúdo de "/proc/
    modules" e mostra que módulos do kernel que estão atualmente
    carregados.

    Dica
   
    Pode identificar o hardware exacto no seu sistema. Veja
    Secção 9.4.3, “Identificação do hardware”.

    Dica

    Pode configurar o hardware durante o arranque para ativar as
    funcionalidades esperadas do hardware. Veja Secção 9.4.4,
    “Configuração do hardware”.

    Dica
   
    Pode provavelmente adicionar suporte para o seu aparelho especial
    ao recompilar o kernel. Veja Secção 9.9, “O kernel”.

Capítulo 4. Autenticação

    Quando uma pessoa (ou programa) requer acesso ao sistema, a
    autenticação confirma a identidade para ser de confiança.

    Atenção

    Erros de configuração do PAM podem trancá-lo fora do seu sistema.
    Terá de ter um CD de recuperação à mão ou arrancar por uma
    partição de arranque alternativa. Para recuperar, arranque o
    sistema com eles e corrija a partir daí.

    Atenção
   
    Este capítulo está a ficar ultrapassado porque é baseado em
    Debian 7.0 (Wheezy) lançado em 2013.

%

4.1. Autenticação normal de Unix

    A autenticação normal de Unix é disponibilizada pelo módulo 
    pam_unix(8) sob PAM (Pluggable Authentication Modules). Os seus 3
    ficheiros de configuração importantes, com entradas separadas por
    ":", são os seguintes.

    Tabela 4.1. 3 ficheiros de configuração importantes para pam_unix
    (8)

    +---------------------------------------------------------------+
    |ficheiro|permissão |utilizador|grupo |        descrição        |
    |--------+----------+----------+------+-------------------------|
    |/etc/   |-rw-r--r--|root      |root  |informação da conta do   |
    |passwd  |          |          |      |utilizador (filtrada)    |
    |--------+----------+----------+------+-------------------------|
    |/etc/   |-rw-r-----|root      |shadow|informação segura da     |
    |shadow  |          |          |      |conta do utilizador      |
    |--------+----------+----------+------+-------------------------|
    |/etc/   |-rw-r--r--|root      |root  |informação do grupo      |
    |group   |          |          |      |                         |
    +---------------------------------------------------------------+


    "/etc/passwd" contém o seguinte.

     ...
    utilizador1:x:1000:1000:Nome de Utilizador1,,,:/home/utilizador1:/bin/bash
    utilizador2:x:1001:1001:Nome de Utilizador2,,,:/home/utilizador2:/bin/bash
     ...

    Como explicado em passwd(5), cada entrada separada por ":" neste
    ficheiro significa o seguinte.

      * Nome de login

      * Entrada de especificação de palavra-passe

      * ID numérico do utilizador

      * ID numérico do grupo

      * Nome de utilizador ou campo de comentários

      * Directório home do utilizador

      * Interpretador de comandos opcional do utilizador

    A segunda entrada de "/etc/passwd" foi utilizada para a entrada
    de palavra-passe encriptada. Após a introdução de "/etc/shadow",
    esta entrada é utilizada para a entrada de especificação da
    palavra-passe.

    Tabela 4.2. A segunda entrada no conteúdo de "/etc/passwd"

    +---------------------------------------------------------+
    |conteúdo|                  significado                   |
    |--------+------------------------------------------------|
    |(vazio) |conta sem palavra-passe                         |
    |--------+------------------------------------------------|
    |x       |a palavra-passe encriptada está em "/etc/shadow"|
    |--------+------------------------------------------------|
    |*       |nenhum login para esta conta                    |
    |--------+------------------------------------------------|
    |!       |nenhum login para esta conta                    |
    +---------------------------------------------------------+


    "/etc/shadow" contém o seguinte.

     ...
    user1:$1$Xop0FYH9$IfxyQwBe9b8tiyIkt2P4F/:13262:0:99999:7:::
    user2:$1$vXGZLVbS$ElyErNf/agUDsm1DehJMS/:13261:0:99999:7:::
     ...

    Como explicado em shadow(5), cada entrada separada por ":" neste
    ficheiro significa o seguinte:

      * Nome de login

      * Palavra-passe encriptada (O "$1$" inicial indica o uso de
        encriptação MD5. O "*" indica nenhum login.)

      * Data da última alteração da palavra-passe, expressada a
        quantidade de dias desde 1 de Janeiro de 1970

      * Quantidade de dias que o utilizador terá que esperar antes de
        ser-lhe permitido alterar a palavra-passe outra vez

      * Quantidade de dias após os quais o utilizador terá que
        alterar a palavra passe dele

      * Quantidade de dias antes de uma palavra-passe expirar durante
        o qual o utilizador deve ser avisado

      * Quantidade de dias após uma palavra-passe ter expirador
        durante os quais a palavra-passe deve ainda ser aceite

      * Data de expiração de uma conta, expressada como a quantidade
        de dias desde 1 de Janeiro de 1970

      * …

    "/etc/group" contém o seguinte.

    grupo1:x:20:utilizador1,utilizador2

    Como explicado em grupo(5), cada entrada separada por ":" neste
    ficheiro significa o seguinte.

      * Nome do grupo

      * Palavra-passe encriptada (na realidade não utilizada)
   
      * ID numérico do grupo

      * lista de nomes de utilizadores, separada por ","

    Nota
   
    "/etc/gshadow" disponibiliza uma função semelhante à do "/etc/
    shadow" para "/etc/group" mas não é realmente usado.

    Nota

    A quantidade real de membros de um grupo de um utilizador pode
    ser adicionada dinamicamente se a linha "auth optional
    pam_group.so" for adicionada ao "/etc/pam.d/common-auth" e
    definida em "/etc/security/group.conf". Veja pam_group(8).

    Nota
   
    O pacote base-passwd contém uma lista autorizada do utilizador e
    do grupo: "/usr/share/doc/base-passwd/users-and-groups.html".

%

4.2. Gerir informação de conta e palavra-passe

    Aqui estão alguns comandos notáveis para gerir informação de
    conta.

    Tabela 4.3. Lista de comandos para gerir informação de conta

    +---------------------------------------------------------------+
    |      comando       |                  função                  |
    |--------------------+------------------------------------------|
    |getent passwd       |navegar na informação da conta de "       |
    |<nome_de_utilizador>|<nome_de_utilizador>"                     |
    |--------------------+------------------------------------------|
    |getent shadow       |explorar informação confidencial (shadow) |
    |<nome_de_utilizador>|da conta de "<nome_de_utilizador>         |
    |--------------------+------------------------------------------|
    |getent group        |navegar na informação do grupo de "       |
    |<nome_de_grupo>     |<nome_do_grupo>"                          |
    |--------------------+------------------------------------------|
    |passwd              |gerir a palavra-passe da conta            |
    |--------------------+------------------------------------------|
    |passwd -e           |definir palavra-passe para uma vez para a |
    |                    |activação da conta                        |
    |--------------------+------------------------------------------|
    |chage               |gerir a informação de envelhecimento da   |
    |                    |palavra-passe                             |
    +---------------------------------------------------------------+


    Pode necessitar de privilégios de root para algumas funções
    funcionarem. Veja crypt(3) pela encriptação de palavra-passe e
    dados.

    Nota

    Num sistema configurado com PAM e NSS como a máquina salsa de
    Debian, o conteúdo dos "/etc/passwd", "/etc/group" e "/etc/
    shadow" locais pode não ser utilizado activamente pelo sistema.
    Os comandos em cima são válidos mesmo sob tal ambiente.

%

4.3. Boa palavra-passe

    Quando criar uma conta durante a instalação do seu sistema ou com
    o comando passwd(1), deve escolher uma boa palavra-passe que
    consista pelo menos de 6 a 8 caracteres incluindo um ou mais
    caracteres de cada um dos seguintes conjuntos de acordo com 
    passwd(1).

      * Alfabéticos de minúsculas

      * Dígitos de 0 a 9

      * Marcas de pontuação

    Atenção

    Não escolha palavras adivinháveis como palavra-passe. O nome de
    conta, número de segurança social, número de telefone, endereço,
    data de nascimento, nomes de membros de família ou de animais,
    palavras do dicionário, sequências simples de caracteres como
    "12345" ou "qwerty", ... são todas más escolhas para a
    palavra-passe.

%

4.4. Criar palavra-passe encriptada

    Existem ferramentas independentes para gerar palavras passe
    encriptadas com sal.

    Tabela 4.4. Lista de ferramentas para gerar palavras-passe

    +---------------------------------------------------------------+
    |pacote |popcon|tamanho|comando |            função             |
    |-------+------+-------+--------+-------------------------------|
    |       |V:35, |       |        |frontend cheio de              |
    |whois  |I:393 |364    |mkpasswd|funcionalidades para a         |
    |       |      |       |        |biblioteca crypt(3)            |
    |-------+------+-------+--------+-------------------------------|
    |       |V:794,|       |openssl |computa hashes de              |
    |openssl|I:993 |1465   |passwd  |palavras-passe (OpenSSL).      |
    |       |      |       |        |passwd(1ssl)                   |
    +---------------------------------------------------------------+


%

4.5. PAM e NSS

    Os sistemas modernos tipo-Unix como o sistema Debian
    disponibilizam mecanismos PAM (Pluggable Authentication Modules)
    e NSS (Name Service Switch) para o administrador local configurar
    o sistema dele. O papel destes pode ser resumido ao seguinte.

      * O PAM oferece um mecanismo de autenticação flexível utilizado
        pelo software de aplicações e assim involve trocas de dados
        de palavra-passe.
   
      * O NSS oferece um mecanismo de serviço de nomes flexível que é
        utilizado frequentemente pela biblioteca C standard para
        obter o nome de utilizador e grupo para programas como o ls
        (1) e o id(1).

    Estes sistemas PAM e NSS necessitam ser configurados de modo
    consistente.

    Os pacotes notáveis dos sistemas PAM e NSS são os seguintes.

    Tabela 4.5. Lista de sistemas PAM e NSS notáveis

    +---------------------------------------------------------------+
    |      pacote       |popcon|tamanho|         descrição          |
    |-------------------+------+-------+----------------------------|
    |libpam-modules     |V:807,|1032   |Pluggable Authentication    |
    |                   |I:999 |       |Modules (serviço básico)    |
    |-------------------+------+-------+----------------------------|
    |                   |      |       |Pluggable Authentication    |
    |libpam-ldap        |I:12  |249    |Module que permite          |
    |                   |      |       |interfaces LDAP             |
    |-------------------+------+-------+----------------------------|
    |                   |      |       |Pluggable Authentication    |
    |libpam-cracklib    |I:16  |115    |Module para ativar suporte a|
    |                   |      |       |cracklib                    |
    |-------------------+------+-------+----------------------------|
    |                   |V:474,|       |Pluggable Authentication    |
    |libpam-systemd     |I:853 |573    |Module para registar sessões|
    |                   |      |       |de utilizador para o logind |
    |-------------------+------+-------+----------------------------|
    |                   |      |       |Pluggable Authentication    |
    |libpam-doc         |I:1   |1044   |Modules (documentação em    |
    |                   |      |       |html e texto)               |
    |-------------------+------+-------+----------------------------|
    |                   |      |       |GNU C Library: Bibliotecas  |
    |libc6              |V:935,|12771  |de partilha que também      |
    |                   |I:999 |       |disponibilizam o serviço    |
    |                   |      |       |"Name Service Switch"       |
    |-------------------+------+-------+----------------------------|
    |glibc-doc          |I:11  |3161   |Biblioteca GNU C: Manuais   |
    |                   |      |       |(Manpages)                  |
    |-------------------+------+-------+----------------------------|
    |                   |      |       |Biblioteca GNU C: Manual de |
    |glibc-doc-reference|I:5   |12740  |referência em info, pdf e   |
    |                   |      |       |html (não-livre)            |
    |-------------------+------+-------+----------------------------|
    |libnss-mdns        |I:526 |150    |Módulo NSS para resolução de|
    |                   |      |       |nomes Multicast DNS         |
    |-------------------+------+-------+----------------------------|
    |                   |      |       |Módulo NSS para utilizar o  |
    |libnss-ldap        |I:11  |265    |LDAP como um serviço        |
    |                   |      |       |nomeador                    |
    |-------------------+------+-------+----------------------------|
    |                   |      |       |Módulo NSS para usar o LDAP |
    |libnss-ldapd       |I:14  |153    |como um serviço nomeador    |
    |                   |      |       |(nova bifurcação de         |
    |                   |      |       |libnss-ldap)                |
    +---------------------------------------------------------------+


      * "O Guia do Administrador do Sistema Linux-PAM" em libpam-doc
        é essencial para aprender configuração do PAM.
   
      * A secção "System Databases e Name Service Switch" em
        glibc-doc-reference é essencial para aprender a configuração
        do NSS.

    Nota

    Pode ver uma lista mais extensa e atual pelo comando "aptitude
    search 'libpam-|libnss-'". O acrónimo NSS também pode significar
    "Network Security Service" o que é diferente de "Name Service
    Switch".

    Nota
   
    PAM é a maneira mais básica de inicializar variáveis de ambiente
    para cada programa com o valor predefinido de todo o sistema.

    Sob systemd, o pacote libpam-systemd é instalado para gerir os
    logins de utilizador ao registar as sessões de utilizador na
    hierarquia do grupo de control do systemd para logind. veja 
    systemd-logind(8), logind.conf(5),e pam_systemd(8).

%

4.5.1. Ficheiros de configuração acedidos pelo PAM e NSS

    Aqui estão alguns ficheiros de configuração notáveis acedidos
    pelo PAM e NSS.

    Tabela 4.6. Lista de ficheiros de configuração acedidos pelo PAM
    e NSS

    +---------------------------------------------------------------+
    |   ficheiro de    |                   função                   |
    |   configuração   |                                            |
    |------------------+--------------------------------------------|
    |/etc/pam.d/       |defina a configuração do PAM para o programa|
    |<nome_do_programa>|"<nome_do_programa>"; veja pam(7) e pam.d(5)|
    |------------------+--------------------------------------------|
    |/etc/nsswitch.conf|define a configuração NSS com a entrada para|
    |                  |cada serviço. Veja nsswitch.conf(5)         |
    |------------------+--------------------------------------------|
    |/etc/nologin      |limita o login de utilizador pelo módulo    |
    |                  |pam_nologin(8)                              |
    |------------------+--------------------------------------------|
    |/etc/securetty    |limita a tty ao acesso de root pelo módulo  |
    |                  |pam_securetty(8)                            |
    |------------------+--------------------------------------------|
    |/etc/security/    |define limites de acesso pelo módulo        |
    |access.conf       |pam_access(8)                               |
    |------------------+--------------------------------------------|
    |/etc/security/    |define a restrição baseada em grupo pelo    |
    |group.conf        |módulo pam_group(8)                         |
    |------------------+--------------------------------------------|
    |/etc/security/    |define as variáveis de ambiente pelo módulo |
    |pam_env.conf      |pam_env(8)                                  |
    |------------------+--------------------------------------------|
    |                  |define variáveis de ambiente adicionais pelo|
    |/etc/environment  |módulo pam_env(8) com o argumento "readenv= |
    |                  |1"                                          |
    |------------------+--------------------------------------------|
    |/etc/default/     |define o locale pelo módulo pam_env(8) com o|
    |locale            |argumento "readenv=1 envfile=/etc/default/  |
    |                  |locale" (Debian)                            |
    |------------------+--------------------------------------------|
    |/etc/security/    |define restrição de recursos (ulimit, core, |
    |limits.conf       |…) pelo módulo pam_linits(8)                |
    |------------------+--------------------------------------------|
    |/etc/security/    |define a retenção de tempo pelo módulo      |
    |time.conf         |pam_time(8)                                 |
    |------------------+--------------------------------------------|
    |/etc/systemd/     |define a configuração do gestor de login do |
    |logind.conf       |systemd (veja logind.conf(5) e              |
    |                  |systemd-logind.service(8))                  |
    +---------------------------------------------------------------+


    A limitação da seleção da palavra-passe é implementada pelos
    módulos do PAM, pam_unix(8) e pam_cracklib(8). Eles podem ser
    configurados com os argumentos deles.

    Dica
   
    Os módulos PAM utilizam o sufixo ".so" para os nomes de ficheiros
    deles.

%

4.5.2. O moderno sistema de gestão centralizado

    A moderna gestão de sistema centralizada pode ser implantada a
    utilizar o servidor centralizado Lightweight diretory Access
    Protocol (LDAP) para administrar muitos sistemas tipo-Unix e
    não-tipo-Unix na rede. A implementação de código aberto do
    Lightweight diretory Access Protocol é o Software OpenLDAP.

    O servidor LDAP disponibiliza para o sistema Debian a informação
    de conta através do uso de PAM e NSS com os pacotes libpam-ldap e
    libnss-ldap. São necessárias várias acções para ativar isto (não
    utilizei esta configuração e o seguinte é puramente informação
    secundária. Por favor leia isto neste contexto.).

      * Configura um servidor LDAP centralizado ao correr um programa
        como o daemon de LDAP autónomo slapd(8).

      * Altera os ficheiros de configuração do PAM no diretório "/etc
        /pam.d/" para utilizar "pam_ldap.so" em vez do predefinido
        "pam_unix.so".

          + Debian utiliza "/etc/pam_ldap.conf" como ficheiro de
            configuração para libpam-ldap e "/etc/pam_ldap.secret"
            como ficheiro para armazenar a palavra-passe do root.

      * Altera a configuração do NSS no ficheiro "/etc/nsswitch.conf"
        para usar "ldap" em vez da predefinição("compat" ou "file").
   
          + Debian utiliza o "/etc/libnss-ldap.conf" como o ficheiro
            de configuração para libnss-ldap.

      * Tem de fazer libpam-ldap para usar a ligação SSL (ou TLS)
        para a segurança da palavra-passe.

      * Pode fazer a libnss-ldap usar ligação SSL (ou TLS) para
        assegurar a integridade dos dados à custa de maior sobrecarga
        da rede LDAP.

      * Deve correr o nscd(8) localmente para pôr em cache quaisquer
        resultados de busca LDAP de modo a reduzir o tráfego de rede
        do LDAP.

    Veja as documentações em pam_ldap.conf(5) e "/usr/share/doc/
    libpam-doc/html/" oferecidas pelo pacote libpam-doc e "info libc
    'Name Service Switch'" oferecida pelo pacote glibc-doc.

    De modo semelhante, pode configurar sistemas centralizados
    alternativos com outros métodos.

      * Integração de utilizador e grupo com o sistema Windows.

          + Aceda a serviços de domínio Windows com os pacotes
            winbind e libpam_winbind.

          + Veja winbindd(8) e Integrar Redes MS Windows com Samba.
   
      * Integração de utilizador e grupo com o sistema antigo
        tipo-Unix.

          + Acesso NIS (originalmente chamado YP) ou NIS+ pelo pacote
            nis.

          + Veja o Linux NIS(YP)/NYS/NIS+ HOWTO.

%

4.5.3. "Porque o su do GNU não suporta o grupo wheel"

    Esta é a famosa frase no fundo da antiga página "info su" por
    Richard M. Stallman. Não se preocupe, o comando su atual em
    Debian utiliza PAM, portanto esse pode restringir a habilidade de
    utilizar su ao grupo root ao ativar a linha com "pam_wheel.so" em
    "/etc/pam.d/su".

%

4.5.4. Regras de palavra-passe rigorosas

    Instalar o pacote libpam-cracklib permite-lhe forçar regras de
    palavra-passe rigorosas, por exemplo, ao ter linhas activas em "/
    etc/pam.d/common-password" como a seguir.

    Para squeeze:

    password required pam_cracklib.so retry=3 minlen=9 difok=3
    password [success=1 default=ignore] pam_unix.so use_authtok nullok md5
    password requisite pam_deny.so
    password required pam_permit.so

%

4.6. Outros controles de acesso

    Nota
   
    Veja Secção 9.3.15, “Tecla Alt-SysRq” para restringir a
    funcionalidade do kernel chave de atenção segura (SAK).

%

4.6.1. sudo

    O sudo(8) é um programa desenhado para permitir a um
    administrador de sistema dar privilégios de root limitados a
    utilizadores e registar a atividade do root. O sudo necessita
    apenas da palavra-passe de um utilizador normal. Instale o pacote
    sudo e active-o ao definir opções em "/etc/sudoers". Veja um
    exemplo de configuração em "/usr/share/doc/sudo/examples/sudoers"
    e Secção 1.1.12, “Configuração do sudo”.

    A minha utilização do sudo para o sistema de único utilizador
    (veja Secção 1.1.12, “Configuração do sudo”) destina-se a
    proteger-me da minha própria estupidez. Pessoalmente, Considero
    utilizar o sudo uma melhor alternativa do que utilizar o sistema
    a partir da conta de root a toda a hora. Por exemplo, o seguinte
    muda o dono de "<algum_ficheiro>" para "<meu_nome>".

    $ sudo chown <meu_nome> <algum_ficheiro>

    Claro que se conhecer a palavra-passe de root (como os
    utilizadores de sistemas Debian auto-instalados conhecem),
    qualquer comando pode ser executado sob root a partir da conta de
    qualquer utilizador a usar "su -c".

%

4.6.2. PolicyKit

    PolicyKit é um componente do sistema operativo para controlar
    privilégios a nível global em sistemas operativos tipo-Unix.

    Aplicações GUI mais recentes não são desenhadas para correr como
    processos privilegiados. Estas falam com os processos
    privilegiados através de PolicyKit para executar operações
    administrativas.

    O PolicyKit limita tais operações a contas de utilizador
    pertencentes ao grupo sudo no sistema Debian.

    Veja polkit(8).

%

4.6.3. SELinux

    Security-Enhanced Linux (SELinux) é um mecanismo para apertar o
    modelo de privilégios mais do que o normal modelo de segurança
    tipo-Unix com as políticas de controle de acesso mandatário
    (MAC). O poder do root pode estar restringido sob algumas
    condições.

%

4.6.4. Restringir acesso a alguns serviços de servidor

    Para a segurança do sistema, é uma boa ideia desativar o máximo
    de programas de serviços possíveis. Isto torna-se crítico em
    servidores na rede. Ter servidores não utilizados, activados
    directamente como daemon ou via programa super-server, são
    considerados riscos de segurança.

    Muito programas, como o sshd(8), utilizam controlos de acesso
    baseados no PAM. Existem muitas maneiras de restringir o acesso a
    alguns serviços de servidor.

      * ficheiros de configuração: "/etc/default/<nome_do_programa>"

      * configuração de unidade de serviço para daemon

      * PAM (Pluggable Authentication Modules)

      * "/etc/inetd.conf" para super-server

      * "/etc/hosts.deny" e "/etc/hosts.allow" para wrapper de TCP, 
        tcpd(8)

      * "/etc/rpc.conf" para RPC da Sun

      * "/etc/at.allow" e "/etc/at.deny" para atd(8)

      * "/etc/cron.allow" e "/etc/cron.deny" para crontab(1)

      * Firewall de Rede da infraestrutura netfilter

    Veja Secção 3.2.6, “Gestão do sistema sob systemd”, Secção 4.5.1,
    “Ficheiros de configuração acedidos pelo PAM e NSS” e
    Secção 5.10, “Infraestrutura netfilter”.

    Dica
   
    os serviços Sun RPC necessitam estar ativos para NFS e outros
    programas baseados em RPC.

    Dica

    Se tem problemas com acesso remoto num sistema Debian recente,
    comente configurações ofensivas tais como "ALL: PARANOID" em "/
    etc/hosts.deny" se existirem. (Mas tem que ter cuidado com os
    riscos de segurança envolvidos com este tipo de acção.)

%

4.7. Segurança da autenticação

    Nota
   
    A informação aqui pode não ser suficiente para as suas
    necessidades de segurança, mas deverá ser um bom começo.

%

4.7.1. Palavra-passe segura na Internet

    Muitos serviços de transporte populares comunicam mensagens
    incluindo a a autenticação de palavra-passe em texto simples. É
    má ideia transmitir as palavras-passe em texto simples pela
    Internet onde podem ser interceptadas. Pode correr estes serviços
    sobre "Transport Layer Security" (TLS) ou o antecessor dele,
    "Secure Sockets Layer" (SSL) para assegurar toda a comunicação
    incluindo a palavra-passe pela encriptação.

    Tabela 4.7. Lista de serviços e portos inseguros e seguros

    +-----------------------------------------------------------+
    |nome do serviço inseguro|porto|nome do serviço seguro|porto|
    |------------------------+-----+----------------------+-----|
    |www (http)              |80   |https                 |443  |
    |------------------------+-----+----------------------+-----|
    |smtp (mail)             |25   |ssmtp (smtps)         |465  |
    |------------------------+-----+----------------------+-----|
    |ftp-data                |20   |ftps-data             |989  |
    |------------------------+-----+----------------------+-----|
    |ftp                     |21   |ftps                  |990  |
    |------------------------+-----+----------------------+-----|
    |telnet                  |23   |telnets               |992  |
    |------------------------+-----+----------------------+-----|
    |imap2                   |143  |imaps                 |993  |
    |------------------------+-----+----------------------+-----|
    |pop3                    |110  |pop3s                 |995  |
    |------------------------+-----+----------------------+-----|
    |ldap                    |389  |ldaps                 |636  |
    +-----------------------------------------------------------+


    A encriptação custa tempo de CPU. Como uma alternativa amiga para
    o CPU, pode manter a comunicação em texto simples enquanto segura
    apenas a palavra-passe com um protocolo de autenticação de
    segurança como o "Authenticated Post Office Protocol" (APOP) para
    POP e "Challenge-Response Authentication Mechanism MD5"
    (CRAM-MD5) para SMTP e IMAP. (Para enviar mensagens de mail pela
    Internet para o seu servidor de mail a partir do seu cliente de
    mail, recentemente é popular utilizar o porto 587 para submissão
    de novas mensagens em vez do tradicional porto 25 do SMTP para
    evitar o bloqueio do porto 25 pelo provedor de Internet enquanto
    se autentica com CRAM-MD5.)

%

4.7.2. Shell Segura

    O programa Secure Shell (SSH) disponibiliza comunicações
    encriptadas e seguras entre duas máquinas sem confiança sobre uma
    rede insegura com a autenticação de segurança. Consiste no
    cliente OpenSSH, ssh(1) e no daemon OpenSSH, sshd(8). Este SSH
    pode ser utilizado como túnel de segurança para protocolos de
    comunicação inseguros como o POP e X pela Internet com a
    funcionalidade de reencaminhamento de portos.

    O cliente tenta autenticar-se a si próprio a utilizar
    autenticação baseada na máquina, autenticação de chave pública,
    autenticação por resposta a desafio, ou autenticação por
    palavra-passe. O uso de autenticação de chave pública activa o
    login remoto sem-palavra-passe. Veja Secção 6.9, “O servidor de
    acesso remoto e utilitários (SSH)”.

%

4.7.3. Medidas de segurança extra para a Internet

    Mesmo quando correr serviços seguros como o Secure Shell (SSH) e
    servidores de Protocolo de túnel ponto-para-ponto (PPTP), ainda
    existe hipótese de invasões que utilizam ataques de força bruta à
    palavra-passe, etc. a partir da Internet. A utilização de
    politicas de firewall (veja Secção 5.10, “Infraestrutura
    netfilter”) juntamente com as seguinte ferramentas de segurança
    podem melhorar a situação de segurança.

    Tabela 4.8. Lista de ferramentas para disponibilizar medidas de
    segurança extra

    +---------------------------------------------------------------+
    |   pacote    |popcon|tamanho|            descrição             |
    |-------------+------+-------+----------------------------------|
    |knockd       |V:0,  |102    |pequeno daemon port-knock knockd  |
    |             |I:3   |       |(1) e cliente konck(1)            |
    |-------------+------+-------+----------------------------------|
    |fail2ban     |V:112,|2092   |banir IPs que causam vários erros |
    |             |I:123 |       |de autenticação                   |
    |-------------+------+-------+----------------------------------|
    |libpam-shield|V:0,  |115    |bloquear atacantes remotos que    |
    |             |I:0   |       |tentam adivinhar a palavra-passe  |
    +---------------------------------------------------------------+


%

4.7.4. Tornar a palavra-passe do root segura

    Para prevenir que pessoas acedam à sua máquina com privilégios de
    root, precisa de tomar as seguintes acções.

      * Prevenir acesso físico ao disco rígido

      * Bloquear a BIOS e prevenir o arranque a partir de suportes
        amovíveis

      * Definir palavra-passe para sessão interactiva do GRUB

      * Bloquear o menu do GRUB de ser editado

    Com acesso físico ao disco rígido, redefinir a palavra-passe é
    relativamente fácil com os seguintes passos.

     1. Mover o disco rígido para um PC com uma BIOS com arranque a
        partir de CD.

     2. Arrancar o sistema com um suporte de recuperação (disco de
        arranque Debian, CD Knoppix, CD GRUB, ...).

     3. Montar a partição raiz com acesso de leitura/escrita.

     4. Editar "/etc/passwd" na partição raiz e esvaziar a segunda
        entrada para a conta root.

    Se tiver acesso de edição à entrada do menu do GRUB (veja
    Secção 3.1.2, “Estágio 2: o gestor de arranque”) grub-rescue-pc
    no momento do arranque, é ainda mais fácil com os seguintes
    passos.

     1. Arrancar o sistema com o parâmetro de kernel alterado para
        algo como "root=/dev/hda6 rw init=/bin/sh".

     2. Editar "/etc/passwd" e tornar a segunda entrada para a conta
        root vazia.

     3. Reiniciar o sistema.

    A shell de root do sistema está agora acessível sem
    palavra-passe.

    Nota

    Após alguém ter acesso à shell de root, pode aceder a tudo no
    sistema e reiniciar quaisquer palavras-passe no sistema. Mais
    ainda, pode comprometer a palavra-passe para todas as contas de
    utilizadores a usar ferramentas de crack de palavra-passe por
    força bruta como os pacotes john e crack (veja Secção 9.4.11,
    “Segurança do sistema e verificação de integridade”). Esta
    palavra-passe descoberta pode levar a comprometer outros
    sistemas.

    A única solução de software razoável para evitar estas
    preocupações é usar uma partição raiz encriptada por software (ou
    uma partição "/etc" a utilizar dm-crypt e initramfs (veja
    Secção 9.8, “Dicas de encriptação de dados”). Assim, vai
    necessitar sempre de palavra-passe para arrancar o sistema.

Capítulo 5. Configuração de rede

    Dica
   
    Para um guia geral de rede em GNU/Linux, leia o Guia de
    Administradores de Rede de Linux.

    Dica
   
    Para um guia moderno específico Debian sobre rede, veja O Livro
    de Mão do Administrador Debian — Configurar a Rede.

    Atenção

    Em vez de usar a interface tradicional com esquema de nomes
    ("eth0", "eth1", "wlan0", …), o novo systemd usa "Nomes de
    Interface de Rede Previsíveis" tais como "enp0s25".

    Atenção
   
    Este capítulo está a ficar ultrapassado porque é baseado em
    Debian 7.0 (Wheezy) lançado em 2013.

    Dica

    Apesar deste documento ainda utilizar o antigo ifconfig(8) com
    IPv4 para os seus exemplos de configuração de rede, Debian está a
    mudar para ip(8) com IPv4+IPv6 no lançamento wheezy. Patches para
    este documento são bem-vindos.

    Dica
   
    Sob systemd, pode ser usado o networkd para gerir as redes. Veja 
    systemd-networkd(8).

%

5.1. A infra-estrutura de rede básica

    Vamos rever a infra-estrutura básica de rede do sistema Debian
    moderno.

    Tabela 5.1. Lista de ferramentas de configuração de rede

    +-----------------------------------------------------------------------+
    |       pacotes       |popcon|tamanho|      tipo       |   descrição    |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |ferramenta      |
    |                     |      |       |                 |standard para   |
    |ifupdown             |V:587,|217    |config::ifupdown |ativar e        |
    |                     |I:991 |       |                 |desativar a rede|
    |                     |      |       |                 |(especifico de  |
    |                     |      |       |                 |Debian)         |
    |---------------------+------+-------+-----------------+----------------|
    |                     |V:3,  |       |                 |gerir a rede com|
    |ifplugd              |I:18  |217    |, ,              |fios            |
    |                     |      |       |                 |automaticamente |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |script de testes|
    |                     |V:0,  |       |                 |de rede para    |
    |ifupdown-extra       |I:1   |106    |, ,              |melhorar o      |
    |                     |      |       |                 |pacote          |
    |                     |      |       |                 |"ifupdown"      |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |define métricas |
    |ifmetric             |V:0,  |37     |, ,              |de rota para uma|
    |                     |I:1   |       |                 |interface de    |
    |                     |      |       |                 |rede            |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |script de       |
    |                     |      |       |                 |mapeamento para |
    |                     |      |       |                 |melhorar o      |
    |guessnet             |V:0,  |422    |, ,              |pacote          |
    |                     |I:0   |       |                 |"ifupdown" via  |
    |                     |      |       |                 |ficheiro "/etc/ |
    |                     |      |       |                 |network/        |
    |                     |      |       |                 |interfaces"     |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |scripts de      |
    |                     |V:0,  |       |                 |mapeamento para |
    |ifscheme             |I:0   |59     |, ,              |melhorar o      |
    |                     |      |       |                 |pacote          |
    |                     |      |       |                 |"ifupdown"      |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |NetworkManager  |
    |network-manager      |V:358,|14957  |config::NM       |(daemon): gere a|
    |                     |I:440 |       |                 |rede            |
    |                     |      |       |                 |automaticamente |
    |---------------------+------+-------+-----------------+----------------|
    |                     |V:132,|       |                 |NetworkManager  |
    |network-manager-gnome|I:372 |5540   |, ,              |(frontend do    |
    |                     |      |       |                 |GNOME)          |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |gestor de rede  |
    |wicd                 |I:24  |36(*)  |config::wicd     |com fios e sem  |
    |                     |      |       |                 |fios            |
    |                     |      |       |                 |(meta-pacote)   |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |gestor de rede  |
    |                     |V:0,  |       |                 |com fios e sem  |
    |wicd-cli             |I:1   |60(*)  |, ,              |fios (cliente de|
    |                     |      |       |                 |linha de        |
    |                     |      |       |                 |comandos)       |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |gestor de rede  |
    |wicd-curses          |V:0,  |176(*) |, ,              |com fios e sem  |
    |                     |I:3   |       |                 |fios (cliente   |
    |                     |      |       |                 |Curses)         |
    |---------------------+------+-------+-----------------+----------------|
    |                     |V:19, |       |                 |gestor de rede  |
    |wicd-daemon          |I:26  |992(*) |, ,              |com fios e sem  |
    |                     |      |       |                 |fios (daemon)   |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |gestor de rede  |
    |wicd-gtk             |V:15, |576(*) |, ,              |com fios e sem  |
    |                     |I:25  |       |                 |fios (cliente   |
    |                     |      |       |                 |GTK+)           |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |ferramentas     |
    |                     |V:300,|       |                 |administrativas |
    |iptables             |I:993 |2520   |config::Netfilter|para filtragem  |
    |                     |      |       |                 |de pacotes e NAT|
    |                     |      |       |                 |(Netfilter)     |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |iproute2, IPv6 e|
    |                     |      |       |                 |outras          |
    |iproute2             |V:672,|2867   |config::iproute2 |configurações   |
    |                     |I:926 |       |                 |avançadas de    |
    |                     |      |       |                 |rede: ip(8), tc |
    |                     |      |       |                 |(8), etc        |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |renomear        |
    |                     |      |       |                 |interfaces de   |
    |ifrename             |V:0,  |125    |, ,              |rede baseado em |
    |                     |I:3   |       |                 |vários critérios|
    |                     |      |       |                 |de estatística: |
    |                     |      |       |                 |ifrename(8)     |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |mostra ou altera|
    |ethtool              |V:102,|597    |, ,              |as definições de|
    |                     |I:261 |       |                 |um aparelho     |
    |                     |      |       |                 |Ethernet        |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |teste de        |
    |                     |      |       |                 |acessibilidade  |
    |                     |      |       |                 |de rede de uma  |
    |iputils-ping         |V:234,|113    |test::iproute2   |máquina remota  |
    |                     |I:997 |       |                 |pelo            |
    |                     |      |       |                 |nome-de-máquina |
    |                     |      |       |                 |ou endereço IP  |
    |                     |      |       |                 |(iproute2)      |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |teste de        |
    |                     |      |       |                 |acessibilidade  |
    |                     |V:8,  |       |                 |de rede de uma  |
    |iputils-arping       |I:127 |55     |, ,              |máquina remota  |
    |                     |      |       |                 |especificado    |
    |                     |      |       |                 |pelo endereço   |
    |                     |      |       |                 |ARP             |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |rastreia o      |
    |iputils-tracepath    |V:4,  |72     |, ,              |caminho de rede |
    |                     |I:60  |       |                 |até uma máquina |
    |                     |      |       |                 |remota          |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |conjunto de     |
    |                     |      |       |                 |ferramentas de  |
    |                     |V:234,|       |                 |rede NET-3      |
    |net-tools            |I:634 |991    |config::net-tools|(net-tools,     |
    |                     |      |       |                 |configuração de |
    |                     |      |       |                 |rede IPv4):     |
    |                     |      |       |                 |ifconfig(8) etc.|
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |teste de        |
    |                     |      |       |                 |acessibilidade  |
    |                     |      |       |                 |de rede de uma  |
    |inetutils-ping       |V:0,  |359    |test::net-tools  |máquina remota  |
    |                     |I:1   |       |                 |pelo            |
    |                     |      |       |                 |nome-de-máquina |
    |                     |      |       |                 |ou endereço IP  |
    |                     |      |       |                 |(legacy, GNU)   |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |teste de        |
    |                     |      |       |                 |acessibilidade  |
    |                     |V:2,  |       |                 |de rede de uma  |
    |arping               |I:29  |77     |, ,              |máquina remota  |
    |                     |      |       |                 |especificado    |
    |                     |      |       |                 |pelo endereço   |
    |                     |      |       |                 |ARP (legacy)    |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |rastreia o      |
    |                     |V:63, |       |                 |caminho de rede |
    |traceroute           |I:936 |159    |, ,              |até uma máquina |
    |                     |      |       |                 |remota (legacy, |
    |                     |      |       |                 |consola)        |
    |---------------------+------+-------+-----------------+----------------|
    |isc-dhcp-client      |V:231,|686    |config::low-level|Cliente DHCP    |
    |                     |I:979 |       |                 |                |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |suporte de      |
    |wpasupplicant        |V:332,|3436   |, ,              |cliente para WPA|
    |                     |I:507 |       |                 |e WPA2 (IEEE    |
    |                     |      |       |                 |802.11i)        |
    |---------------------+------+-------+-----------------+----------------|
    |                     |V:0,  |       |                 |Cliente GUI Qt  |
    |wpagui               |I:2   |781    |, ,              |para o          |
    |                     |      |       |                 |wpa_supplicant  |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |ferramentas para|
    |                     |V:188,|       |                 |manipular       |
    |wireless-tools       |I:254 |297    |, ,              |Extensões       |
    |                     |      |       |                 |Wireless do     |
    |                     |      |       |                 |Linux           |
    |---------------------+------+-------+-----------------+----------------|
    |ppp                  |V:206,|1054   |, ,              |ligação PPP/    |
    |                     |I:474 |       |                 |PPPoE com chat  |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |ajudante de     |
    |pppoeconf            |V:0,  |192    |config::helper   |configuração    |
    |                     |I:8   |       |                 |para ligação    |
    |                     |      |       |                 |PPPoE           |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |ajudante de     |
    |pppconfig            |V:1,  |801    |, ,              |configuração    |
    |                     |I:2   |       |                 |para ligação PPP|
    |                     |      |       |                 |com chat        |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |ajudante de     |
    |wvdial               |V:0,  |249    |, ,              |configuração    |
    |                     |I:5   |       |                 |para ligação PPP|
    |                     |      |       |                 |com wvdial e ppp|
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |rastreia o      |
    |mtr-tiny             |V:6,  |161    |test::low-level  |caminho de rede |
    |                     |I:54  |       |                 |até uma máquina |
    |                     |      |       |                 |remota (curses) |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |rastreia o      |
    |                     |V:4,  |       |                 |caminho de rede |
    |mtr                  |I:43  |214    |, ,              |até uma máquina |
    |                     |      |       |                 |remota (curses e|
    |                     |      |       |                 |GTK+)           |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |ferramentas para|
    |gnome-nettool        |V:2,  |2105   |, ,              |operações comuns|
    |                     |I:45  |       |                 |de informação de|
    |                     |      |       |                 |rede (GNOME)    |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |mapeamento de   |
    |nmap                 |V:31, |4452   |, ,              |rede / sondagem |
    |                     |I:253 |       |                 |de portos (Nmap,|
    |                     |      |       |                 |consola)        |
    |---------------------+------+-------+-----------------+----------------|
    |                     |V:2,  |       |                 |mapeamento de   |
    |zenmap               |I:9   |2939   |, ,              |rede / sondagem |
    |                     |      |       |                 |de portos (GTK+)|
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |analisador de   |
    |tcpdump              |V:19, |1329   |, ,              |tráfego de rede |
    |                     |I:204 |       |                 |(Tcpdump,       |
    |                     |      |       |                 |consola)        |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |analisador de   |
    |wireshark            |I:55  |64     |, ,              |tráfego de rede |
    |                     |      |       |                 |(Wireshark,     |
    |                     |      |       |                 |GTK+)           |
    |---------------------+------+-------+-----------------+----------------|
    |                     |V:3,  |       |                 |analisador de   |
    |tshark               |I:34  |407    |, ,              |tráfego de rede |
    |                     |      |       |                 |(consola)       |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |produz um       |
    |                     |V:0,  |       |                 |sumário das     |
    |tcptrace             |I:3   |401    |, ,              |ligações a      |
    |                     |      |       |                 |partir da saída |
    |                     |      |       |                 |do tcpdump      |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |sistema flexível|
    |snort                |V:0,  |2206   |, ,              |de detecção de  |
    |                     |I:1   |       |                 |intrusos na rede|
    |                     |      |       |                 |(Snort)         |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |mostra a        |
    |ntopng               |V:1,  |969    |, ,              |utilização da   |
    |                     |I:2   |       |                 |rede num        |
    |                     |      |       |                 |navegador web   |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |clientes de rede|
    |                     |      |       |                 |disponibilizados|
    |dnsutils             |V:64, |256    |, ,              |com BIND:       |
    |                     |I:517 |       |                 |nslookup(8),    |
    |                     |      |       |                 |nsupdate(8), dig|
    |                     |      |       |                 |(8)             |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |verifica        |
    |                     |      |       |                 |informação de   |
    |dlint                |V:0,  |53     |, ,              |zona DNS a usar |
    |                     |I:7   |       |                 |pesquisas do    |
    |                     |      |       |                 |servidor de     |
    |                     |      |       |                 |nomes           |
    |---------------------+------+-------+-----------------+----------------|
    |                     |      |       |                 |rastreia uma    |
    |dnstracer            |V:0,  |61     |, ,              |cadeia de       |
    |                     |I:2   |       |                 |servidores DNS  |
    |                     |      |       |                 |até à fonte     |
    +-----------------------------------------------------------------------+


%

5.1.1. A resolução de nome de máquina

    A resolução de nome de máquina também é suportada atualmente pelo
    mecanismo NSS (Name Service Switch). O fluxo desta resolução é o
    seguinte.

     1. O ficheiro "/etc/nsswitch.conf" com "hosts: files dns" dicta
        a ordem de resolução do nome de máquina. (Isto substitui a
        funcionalidade antiga de "order" em "/etc/host.conf".)

     2. O método files é invocado primeiro. Se o nome de máquina for
        encontrado no ficheiro "/etc/hosts", devolve um endereço
        válido e termina. (O ficheiro "/etc/host.conf" contém "multi
        on".)

     3. O método dns é invocado. Se o nome de máquina é encontrado
        pela consulta ao Internet Domain Name System (DNS)
        identificado pelo ficheiro "/etc/resolv.conf", devolve-le um
        endereço válido e termina.

    Por exemplo, "/etc/hosts" parece-se com o seguinte.

    127.0.0.1 localhost
    127.0.1.1 <host_name>

    # As linhas seguintes são desejáveis para máquinas capazes de IPv6
    ::1     ip6-localhost ip6-loopback
    fe00::0 ip6-localnet
    ff00::0 ip6-mcastprefix
    ff02::1 ip6-allnodes
    ff02::2 ip6-allrouters
    ff02::3 ip6-allhosts

    Cada linha começa por um endereço IP e é seguida pelo hostname
    associado.

    O endereço IP 127.0.1.1 na segunda linha deste exemplo pode não
    ser encontrada nalguns outros sistemas tipo-Unix. O Instalador
    Debian cria esta entrada para um sistema sem um endereço IP
    permanente como contenção para algum software (p.e., GNOME)
    conforme é documentado no bug #719621.

    O <host_name> coincide com o nome da máquina definido em "/etc/
    hostname".

    Para um sistema com um endereço IP permanente, esse endereço IP
    permanente deve ser utilizado aqui em vez do 127.0.1.1.

    Para um sistema com um endereço IP permanente e um nome de
    domínio totalmente qualificado (FQDN) disponibilizado pelo
    Sistema de Nomes de Domínio (DNS), o <nome_máquina> e
    <nome_domínio> canónicos devem ser utilizados em vez de apenas
    <nome_máquina>.

    O "/etc/resolv.conf" é um ficheiro estático se o pacote
    resolvconf não estiver instalado. Se instalado, é uma ligação
    simbólica. De qualquer modo, contém informação que inicializa as
    rotinas de resolução de nomes. Se o DNS existir no IP=
    "192.168.11.1", contém o seguinte.

    nameserver 192.168.11.1

    O pacote resolvconf faz deste "/etc/resolv.conf" uma ligação
    simbólica e gere o conteúdo dele automaticamente pelos scripts
    hook.

    Para o PC estação de trabalho do ambiente LAN adhoc típico, o
    nome de máquina pode ser resolvido via Multicast DNS (mDNS,
    Zeroconf) adicionalmente aos métodos filese dns básicos.

      * Avahi disponibiliza uma infraestrutura para Multicast DNS
        Service Discovery em Debian.

      * É o equivalente de Apple Bonjour / Apple Rendezvous.

      * O pacote de plugin libnss-mdns disponibiliza resolução de
        nomes de máquinas via mDNS para a funcionalidade Name Service
        Switch (NSS) do GNU da Biblioteca C do GNU (glibc).
   
      * O ficheiro "/etc/nsswitch.conf" deve ter uma estrofe como
        "hosts: files mdns4_minimal [NOTFOUND=return] dns mdns4".

      * Os nomes de máquinas com o domínio de pseudo nível de topo
        (TLD) ".local" estão resolvidos.

      * O endereço multicast link-local mDNS IPv4 "224.0.0.251" ou o
        equivalente dele em IPv6 "FF02::FB" são usados para fazer
        pesquisas DNS para nomes que terminem com ".local".

    A resolução de nome de máquina através do depreciado NETBios
    sobre TCP/IP utilizada em antigos sistemas Windows pode ser
    disponibilizada ao instalar o pacote winbind. O ficheiro "/etc/
    nsswitch.conf" deverá ter um bloco como "hosts: files
    mdns4_minimal [NOTFOUND=return] dns mdns4 wins" para ativar esta
    funcionalidade. (Os sistemas modernos de Windows normalmente
    utilizam o método dns para a resolução dos nomes de máquinas.)

    Nota

    A expansão Top-Level Domains genéricos (gTLD) no Domain Name
    System está em desenvolvimento. Tenha cuidado com a colisão de
    nomes quando escolher um nome de domínio usado apenas dentro da
    LAN.

%

5.1.2. O nome da interface de rede

    O nome da interface de rede, p.e. eth0, é atribuído a cada
    hardware no kernel Linux conforme é encontrado, através do
    mecanismo de configuração do espaço de utilizador, udev (veja
    Secção 3.3, “O sistema udev”). O nome da interface de rede é
    referido como interface física em ifup(8) e interfaces(5).

    De modo a assegurar que cada interface de rede seja chamado de
    modo persistente em cada arranque do sistema a utilizar o MAC
    address e etc., existe um ficheiro de regras "/etc/udev/rules.d/
    70-persistent-net.rules". Este ficheiro é gerado automaticamente
    pelo programa "/lib/udev/write_net_rules", provavelmente
    executado pelo ficheiro de regras
    persistent-net-generator.rules". Pode modificá-lo para alterar as
    regras de nomeação.

    Cuidado

    Quando editar o ficheiro de regras "/etc/udev/rules.d/
    70-persistent-net.rules", tem de manter cada regra numa única
    linha e o MAC address em minúsculas. Por exemplo, se encontrar
    "FireWire device" e "PCI device" neste ficheiro, provavelmente
    vai nomear o "PCI device" como eth0 e configura-lo como a
    interface de rede principal.

%

5.1.3. A gama de endereços de rede para a LAN

    Vamos nos lembrar das gamas de endereços do IPv4 de 32 bits em
    cada classe reservada para utilização em redes de área local
    (LANs) pelo rfc1918. É garantido que estes endereços não estejam
    em conflito com quaisquer endereços na Internet.

    Tabela 5.2. Lista de gamas de endereços de rede

    +---------------------------------------------------------------+
    |Classe|endereços de rede| máscara de  |  máscara de  |  # de   |
    |      |                 |    rede     |  rede /bits  |sub-redes|
    |------+-----------------+-------------+--------------+---------|
    |A     |10.x.x.x         |255.0.0.0    |/8            |1        |
    |------+-----------------+-------------+--------------+---------|
    |B     |172.16.x.x —     |255.255.0.0  |/16           |16       |
    |      |172.31.x.x       |             |              |         |
    |------+-----------------+-------------+--------------+---------|
    |C     |192.168.0.x —    |255.255.255.0|/24           |256      |
    |      |192.168.255.x    |             |              |         |
    +---------------------------------------------------------------+


    Nota

    Se for atribuído um destes endereços a uma máquina, então essa
    máquina não poderá aceder à Internet directamente mas terá de
    aceder através de uma gateway que age como um proxy para serviços
    individuais ou então fará Network Address Translation(NAT). O
    router de banda larga geralmente executa NAT para o ambiente LAN
    do consumidor.

%

5.1.4. O suporte a aparelhos de rede

    Apesar da maioria dos aparelhos de hardware serem suportados pelo
    sistema Debian, existem alguns aparelhos de rede que necessitam
    de firmware não-livre DFSG para os suportar. Por favor veja
    Secção 9.9.6, “Controladores de hardware e firmware”.

%

5.2. A configuração moderna de rede para desktop

    As interfaces de rede são tipicamente iniciadas em
    "networking.service" para a interface lo e
    "NetworkManager.service" para as outras interfaces em sistemas
    Debian modernos sob systemd.

    Debian squeeze e mais recentes podem gerir a ligação de rede
    através de software daemon de gestão como o NetworkManager (NM)
    (network-manager e pacotes associados) ou Wicd (wicd e pacotes
    associados).

      * Vêm com as suas próprias GUIs e programas de linha de
        comandos como as suas interfaces de utilizador.

      * Vêm com os daemons próprios como os backends deles.

      * Permitem uma ligação fácil do seu sistema à Internet.

      * Permitem gestão fácil de configuração de redes com e sem
        fios.

      * Permitem-nos configurar a rede independentemente do pacote
        legacy ifupdown.

    Nota

    Não utilize estas ferramentas de configuração de rede automáticas
    em servidores. Estas são destinadas principalmente para os
    utilizadores móveis em portáteis.

    Estas ferramentas modernas de configuração de rede necessitam ser
    correctamente configuradas para evitar entrarem em conflito com o
    pacote legacy ifupdown e o ficheiro de configuração dele "/etc/
    network/interfaces".

    Nota

    Algumas funcionalidades destas ferramentas automáticas de
    configuração de rede podem sofrer regressões. Não são tão
    robustas como o pacote legacy ifupdown. Consulte BTS do
    network-manager e BTS do wicd para os problemas e as limitações
    atuais.

%

5.2.1. Ferramentas GUI de configuração de rede

    Documentação oficial para NM e Wicd em Debian são
    disponibilizadas em "/usr/share/doc/network-manager/
    README.Debian" e "/usr/share/doc/wicd/README.Debian",
    respectivamente.

    Essencialmente, a configuração de rede para desktop é feita como
    a seguir.

     1. Tornar o utilizador de ambiente de trabalho, p.e. foo,
        pertencente ao grupo "netdev" com o seguinte (Em alternativa,
        em ambientes de trabalho modernos como o GNOME e o KDE,
        faça-o automaticamente através de D-bus).

        $ sudo adduser foo netdev

     2. Mantenha a configuração de "/etc/network/interfaces" tão
        simples como o seguinte.
   
        auto lo
        iface lo inet loopback

     3. Reiniciar NM ou Wicd com o seguinte.

        $ sudo /etc/init.d/network-manager restart

        $ sudo /etc/init.d/wicd restart

     4. Configure a sua rede através da GUI.

    Nota

    Apenas as interfaces que não estão listadas em "/etc/network/
    interfaces" são geridas pelo NM ou Wicd para evitar conflitos com
    o ifupdown.

    Dica

    Se desejar estender as capacidades de configuração de rede do NM,
    por favor procure módulos plug-in apropriados e pacotes
    suplementares como os network-manager-openconnect,
    network-manager-openvpn-gnome, network-manager-pptp-gnome,
    mobile-broadband-provider-info, gnome-bluetooth, etc. O mesmo
    vale para o Wicd.

    Cuidado

    Estas ferramentas automáticas de configuração de rede podem não
    ser compatíveis com as configurações esotéricas do legado
    ifupdown em "/etc/network/interfaces" como aquelas em Secção 5.6,
    “A configuração básica de rede com ifupdown (legacy)” e
    Secção 5.7, “A configuração de rede avançada com ifupdown
    (antigo)”. Consulte BTS do network-manager e BTS do wicd para os
    problemas e limitações atuais.

%

5.3. A moderna configuração de rede sem GUI

    Sob systemd, a rede pode ser configurada em /etc/systemd/network
    /. Veja systemd-resolved(8), resolved.conf(5) e systemd-networkd
    (8).

    Isto permite a configuração moderna de rede sem GUI.

    Uma configuração de cliente DHCP pode ser definida ao criar /etc/
    systemd/network/dhcp.network". Ex.:

    [Match]
    Name=en*
   
    [Network]
    DHCP=yes

    Uma configuração de rede estática pode ser definida ao criar "/
    etc/systemd/network/static.network". Ex.:

    [Match]
    Name=en*
   
    [Network]
    Address=192.168.0.15/24
    Gateway=192.168.0.1

%

5.4. A ligação e antiga configuração de rede

    Quando o método descrito em Secção 5.2, “A configuração moderna
    de rede para desktop” não satisfizer as suas necessidades, deve
    utilizar a ligação de rede e método antigo de configuração que
    combina muitas ferramentas mais simples.

    A antiga ligação de rede é específica para cada método (veja
    Secção 5.5, “O método de ligação de rede (antigo)”).

    Existem 2 tipos de programas para a configuração de rede de baixo
    nível em Linux (veja Secção 5.8.1, “Comandos iproute2”).

      * Os programas antigos net-tools (ifconfig(8), …) são do
        sistema de rede Linux NET-3. A maioria estão agora obsoletos.
   
      * Os novos programs Linux iproute2 (ip(8), …) são o sistema de
        rede atual do Linux.

    Apesar destes programas de rede de baixo nível serem poderosos,
    não são tão práticos de utilizar. Por isso foram criados sistema
    de configuração de rede de alto nível.

    O pacote ifupdown é o standard de facto para tais sistemas de
    configuração de rede de alto nível em Debian. Permite-lhe ativar
    a rede simplesmente ao fazer, p. e., "ifup eth0". O ficheiro de
    configuração dele é o ficheiro "/etc/network/interfaces" e o
    conteúdo típico é o seguinte:

    auto lo
    iface lo inet loopback
   
    auto eth0
    iface eth0 inet dhcp

    O pacote resolvconf foi criado como suplemento ao sistema
    ifupdown para suportar uma fácil configuração da resolução de
    endereços de rede ao automatizar a rescrita do ficheiro de
    configuração do resolvedor "/etc/resolv.conf". Agora, a maioria
    dos pacotes de configuração de rede em Debian estão modificados
    para utilizar o pacote resolvconf (veja "/usr/share/doc/
    resolvconf/README.Debian").

    Scripts de ajuda do pacote ifupdown tais como ifplugd, guessnet,
    ifscheme, etc. são criados para automatizar a configuração
    dinâmica do ambiente de rede para os PCs móveis assim como numa
    rede com fios. Estes são relativamente difíceis de usar mas
    funcionam bem com o sistema ifupdown existente.

    Estes estão explicados em detalhe com exemplos (veja Secção 5.6,
    “A configuração básica de rede com ifupdown (legacy)” e
    Secção 5.7, “A configuração de rede avançada com ifupdown
    (antigo)”).

%

5.5. O método de ligação de rede (antigo)

    Cuidado

    O método de teste de ligação descrito nesta secção destina-se a
    propósitos de teste. Não se destina a ser utilizado directamente
    para as ligações do dia-a-dia de rede. É avisado para utilizá-lo
    via NM, Wicd, ou do pacote ifupdown (veja Secção 5.2, “A
    configuração moderna de rede para desktop” e Secção 5.6, “A
    configuração básica de rede com ifupdown (legacy)”).

    O método de ligação de rede típico e caminho de ligação para um
    PC pode ser resumido ao seguinte:

    Tabela 5.3. Lista de métodos de ligação de rede e caminhos de
    ligação

    +---------------------------------------------------------------+
    |    PC     |método de |           caminho de ligação           |
    |           | ligação  |                                        |
    |-----------+----------+----------------------------------------|
    |Porta série|PPP       |⇔ modem ⇔ POTS ⇔ ponto de acesso dial-up|
    |(ppp0)     |          |⇔ ISP                                   |
    |-----------+----------+----------------------------------------|
    |Porta      |PPPoE/DHCP|⇔ BB-modem ⇔ serviço BB ⇔ ponto de      |
    |Ethernet   |/Estático |acesso BB ⇔ ISP                         |
    |(eth0)     |          |                                        |
    |-----------+----------+----------------------------------------|
    |Porta      |DHCP/     |⇔ LAN ⇔ router BB com with tradução de  |
    |Ethernet   |Estático  |endereços de rede (NAT) (⇔ BB-modem …)  |
    |(eth0)     |          |                                        |
    +---------------------------------------------------------------+


    Aqui está um sumário dos scripts de configuração para cada método
    de ligação.

    Tabela 5.4. Lista de configurações de ligação de rede

    +---------------------------------------------------------------+
    |  método de  |       configuração       |  pacote(s) backend   |
    |   ligação   |                          |                      |
    |-------------+--------------------------+----------------------|
    |PPP          |pppconfig para criar chat |pppconfig, ppp        |
    |             |determinista              |                      |
    |-------------+--------------------------+----------------------|
    |PPP          |wvdialconf para criar chat|ppp, wvdial           |
    |(alternativa)|heurístico                |                      |
    |-------------+--------------------------+----------------------|
    |PPPoE        |pppoeconf para criar chat |pppoeconf, ppp        |
    |             |determinista              |                      |
    |-------------+--------------------------+----------------------|
    |DHCP         |descrito em "/etc/dhcp/   |isc-dhcp-client       |
    |             |dhclient.conf"            |                      |
    |-------------+--------------------------+----------------------|
    |IP estático  |descrito em "/etc/network/|iproute ou net-tools  |
    |(IPv4)       |interfaces"               |(obsoleto)            |
    |-------------+--------------------------+----------------------|
    |IP estático  |descrito em "/etc/network/|iproute               |
    |(IPv6)       |interfaces"               |                      |
    +---------------------------------------------------------------+


    A ligação de rede anónima significa o seguinte.

    Tabela 5.5. Lista de ligações de rede anónimas

    +---------------------------------------------------------------+
    |acrónimo|                     significado                      |
    |--------+------------------------------------------------------|
    |POTS    |serviço de antigo telefone simples                    |
    |--------+------------------------------------------------------|
    |BB      |banda larga                                           |
    |--------+------------------------------------------------------|
    |serviço |ex. a linha de subscrição digital (DSL), a TV por     |
    |BB      |cabo, ou a fibra até aos casas (FTTP)                 |
    |--------+------------------------------------------------------|
    |modem BB|ex. o modem DSL, o modem de cabo, ou o terminal de    |
    |        |rede óptica (ONT)                                     |
    |--------+------------------------------------------------------|
    |LAN     |rede de área local                                    |
    |--------+------------------------------------------------------|
    |WAN     |rede de área alargada                                 |
    |--------+------------------------------------------------------|
    |DHCP    |protocolo de configuração dinâmico de máquina         |
    |--------+------------------------------------------------------|
    |PPP     |protocolo ponto-para-ponto                            |
    |--------+------------------------------------------------------|
    |PPPoE   |protocolo ponto-para-ponto sobre Ethernet             |
    |--------+------------------------------------------------------|
    |ISP     |Provedor de serviço de Internet                       |
    +---------------------------------------------------------------+


    Nota

    Os serviços de ligação WAN via TV por cabo são normalmente
    servidos por DHCP ou PPPoE. Os de ADSL e FTTP são geralmente
    servidos por PPPoE. Tem de consultar o seu ISP para os requisitos
    de configuração exactos para a ligação WAN.

    Nota

    Quando é utilizado um router de banda larga para criar um
    ambiente LAN caseiro, os PCs na LAN são ligados à WAN através do
    router com tradução de endereços de rede (NAT). Para tais casos,
    as interfaces de rede dos PCs na LAN são servidas por DHCP ou IP
    estático a partir do router. O router tem de ser configurado para
    ligar à WAN a seguir as instruções do seu ISP.

%

5.5.1. A ligação DHCP com Ethernet

    A típica rede moderna de casa ou de pequena empresa, isto é, LAN,
    está ligada à WAN (Internet) por um router de banda larga de
    classe de consumidor. A LAN por detrás deste router é servida
    geralmente pelo servidor de protocolo de configuração dinâmica de
    máquinas (DHCP) que corre no router.

    Instale apenas o pacote isc-dhcp-client para a Ethernet servida
    pelo protocolo de configuração dinâmica de máquinas (DHCP).

    Veja dhclient.conf(5).

%

5.5.2. A ligação de IP estático com a Ethernet

    Não é necessária nenhuma acção especial para a Ethernet servida
    por IP estático.

%

5.5.3. A ligação PPP com o pppconfig

    O script de configuração pppconfig configura a ligação PPP
    interativamente ao selecionar o seguinte.

      * O número de telefone

      * O nome de utilizador do ISP

      * A palavra-passe do ISP
   
      * A velocidade da porta

      * A porta de comunicação do modem

      * O método de autenticação

    Tabela 5.6. Lista de ficheiros de configuração para a ligação PPP
    com pppconfig

    +---------------------------------------------------------------+
    |    ficheiro    |                    função                    |
    |----------------+----------------------------------------------|
    |/etc/ppp/peers/ |O ficheiro de configuração gerado pelo        |
    |<nome_do_isp>   |pppconfig para um pppd específico para        |
    |                |<nome_de_isp>                                 |
    |----------------+----------------------------------------------|
    |/etc/chatscripts|O ficheiro de configuração gerado pelo        |
    |/<nome_do_isp>  |pppconfig para chat especifico com            |
    |                |<nome_de_isp>                                 |
    |----------------+----------------------------------------------|
    |/etc/ppp/options|O parâmetro de execução geral para o pppd     |
    |----------------+----------------------------------------------|
    |/etc/ppp/       |Dados de autenticação para PAP (risco de      |
    |pap-secret      |segurança)                                    |
    |----------------+----------------------------------------------|
    |/etc/ppp/       |Dados de autenticação para CHAP (mais seguro) |
    |chap-secret     |                                              |
    +---------------------------------------------------------------+


    Cuidado
   
    O valor "<nome_do_isp>" do "provedor" é assumido se os comandos
    pon e poff forem invocados sem argumentos.

    Pode testar a configuração a usar ferramentas de configuração de
    baixo nível como as seguintes.

    $ sudo pon <nome_do_isp>
    ...
    $ sudo poff <nome_do_isp>

    Veja "/usr/share/doc/ppp/README.Debian.gz".

%

5.5.4. A ligação PPP alternativa com o wvdialconf

    Uma aproximação diferente a utilizar pppd(8) é corrê-lo a partir
    do wvdial(1) que vem no pacote wvdial. Em vez do pppd correr o 
    chat(8) para marcar e negociar a ligação, o wvdial faz a marcação
    e a negociação inicial e depois arranca o pppd para fazer o
    resto.

    O script de configuração wvdialconf configura a ligação PPP
    interativamente ao selecionar apenas o seguinte:

      * O número de telefone

      * O nome de utilizador do ISP

      * A palavra-passe do ISP

    wvdial tem sucesso a criar a ligação na maioria dos casos e
    mantém automaticamente uma lista de dados de autenticação.

    Tabela 5.7. Lista de ficheiros de configuração para a ligação PPP
    com wvdialconf

    +---------------------------------------------------------------+
    |  ficheiro  |                      função                      |
    |------------+--------------------------------------------------|
    |/etc/ppp/   |O ficheiro de configuração gerado pelo wvdialconf |
    |peers/wvdial|para o pppd, específico para wvdial               |
    |------------+--------------------------------------------------|
    |/etc/       |O ficheiro de configuração gerado pelo wvdialconf |
    |wvdial.conf |                                                  |
    |------------+--------------------------------------------------|
    |/etc/ppp/   |O parâmetro de execução geral para o pppd         |
    |options     |                                                  |
    |------------+--------------------------------------------------|
    |/etc/ppp/   |Dados de autenticação para PAP (risco de          |
    |pap-secret  |segurança)                                        |
    |------------+--------------------------------------------------|
    |/etc/ppp/   |Dados de autenticação para CHAP (mais seguro)     |
    |chap-secret |                                                  |
    +---------------------------------------------------------------+


    Pode testar a configuração a usar ferramentas de configuração de
    baixo nível como as seguintes.

    $ sudo wvdial
    ...
    $ sudo killall wvdial

    Veja wvdial(1) e wvdial.conf(5).

%

5.5.5. A ligação PPPoE com o pppoeconf

    Quando o seu ISP o serve com ligação por PPPoE e decide ligar o
    seu PC diretamente à WAN, a rede do seu PC tem de ser configurada
    com PPPoE. PPPoE significa PPP over Ethernet. O script de
    configuração pppoeconf configura a ligação PPPoE interativamente.

    Os ficheiros de configuração são os seguintes:

    Tabela 5.8. Lista de ficheiros de configuração para a ligação
    PPPoE com pppoeconf

    +---------------------------------------------------------------+
    |   ficheiro    |                    função                     |
    |---------------+-----------------------------------------------|
    |/etc/ppp/peers/|O ficheiro de configuração gerado pelo         |
    |dsl-provider   |pppoeconf para o pppd, específico para pppoe   |
    |---------------+-----------------------------------------------|
    |/etc/ppp/      |O parâmetro de execução geral para o pppd      |
    |options        |                                               |
    |---------------+-----------------------------------------------|
    |/etc/ppp/      |Dados de autenticação para PAP (risco de       |
    |pap-secret     |segurança)                                     |
    |---------------+-----------------------------------------------|
    |/etc/ppp/      |Dados de autenticação para CHAP (mais seguro)  |
    |chap-secret    |                                               |
    +---------------------------------------------------------------+


    Pode testar a configuração a usar ferramentas de configuração de
    baixo nível como as seguintes.

    $ sudo /sbin/ifconfig eth0 up
    $ sudo pon dsl-provider
    ...
    $ sudo poff dsl-provider
    $ sudo /sbin/ifconfig eth0 down

    Veja "/usr/share/doc/pppoeconf/README.Debian".

%

5.6. A configuração básica de rede com ifupdown (legacy)

    A configuração tradicional de rede TCP/IP no sistema Debian
    utiliza o pacote ifupdown como uma ferramenta de alto nível.
    Existem 2 casos típicos:

      * Para sistemas de IP dinâmico, como os PCs portáteis,
        configure a rede TCP/IP com o pacote resolvconf para
        permitir-lhe mudar facilmente a sua configuração de rede
        (veja Secção 5.6.4, “A interface de rede servida por DHCP”).
   
      * Para sistemas de IP estático como os servidores, deve
        configurar a rede TCP/IP sem o pacote resolvconf e manter o
        seu sistema simples (veja Secção 5.6.5, “A interface de rede
        com IP estático”).

    Estes métodos de configuração tradicionais são muito úteis se
    desejar definir configurações avançadas; encontre detalhes no
    seguinte.

    O pacote ifupdown disponibiliza uma estrutura standard para a
    configuração de rede de alto nível no sistema Debian. Nesta
    secção, aprendemos a configuração básica de rede com o ifupdown
    com uma introdução simplificada e muitos exemplos típicos.

%

5.6.1. A sintaxe simplificada de comando

    O pacote ifupdown contém dois comandos: ifup(8) e ifdown(8). Eles
    oferecem configuração de rede de alto nível ditada pelo ficheiro
    de configuração "/etc/network/interfaces".

    Tabela 5.9. Lista de comandos de configuração de rede básicos com
    ifupdown

    +---------------------------------------------------------------+
    |comando|                         acção                         |
    |-------+-------------------------------------------------------|
    |ifup   |ativa a interface de rede eth0 com a configuração eth0 |
    |eth0   |se existir "iface eth0"                                |
    |-------+-------------------------------------------------------|
    |ifdown |desativa a interface de rede eth0 com a configuração   |
    |eth0   |eth0 se existir "iface eth0"                           |
    +---------------------------------------------------------------+


    Atenção

    Não utilize as ferramentas de configuração de baixo nível tais
    como os comandos ifconfig(8) e ip(8) para configurar uma
    interface em estado ativo.

    Nota
   
    Não existe nenhum comando ifupdown.

%

5.6.2. A sintaxe básica de "/etc/network/interfaces"

    A sintaxe chave de "/etc/network/interfaces" como explicada em 
    interfaces(5) pode ser resumida ao seguinte.

    Tabela 5.10. Lista de estrofes em "/etc/network/interfaces"

    +---------------------------------------------------------------+
    |         estrofe          |            significado             |
    |--------------------------+------------------------------------|
    |                          |inicia a interface                  |
    |"auto <nome_da_interface>"|<nome_da_interface> no arranque do  |
    |                          |sistema                             |
    |--------------------------+------------------------------------|
    |"allow-auto               |, ,                                 |
    |<nome_de_interface>"      |                                    |
    |--------------------------+------------------------------------|
    |                          |inicia a interface                  |
    |"allow-hotplug            |<nome_de_interface> quando o kernel |
    |<nome_de_interface>"      |detecta um evento hotplug da        |
    |                          |interface                           |
    |--------------------------+------------------------------------|
    |Linhas começadas por      |definem a configuração de rede      |
    |"iface                    |<nome_de_configuração>              |
    |<nome_de_configuração> …" |                                    |
    |--------------------------+------------------------------------|
    |Linhas iniciadas por      |define valor de mapeamento de       |
    |"mapping                  |<nome_de_configuração> para o       |
    |<nome_da_interface_global>|<nome_de_interface> correspondente  |
    |"                         |                                    |
    |--------------------------+------------------------------------|
    |A linha começada com um   |ignorar como comentários (os        |
    |cardinal "#"              |comentários no fim da linha não são |
    |                          |suportados)                         |
    |--------------------------+------------------------------------|
    |Uma linha terminada com   |estende a configuração à próxima    |
    |uma barra inversa "\"     |linha                               |
    +---------------------------------------------------------------+


    As linhas começadas por iface têm a seguinte sintaxe:

    iface <nome_de_configuração> <familia_de_endereços> <nome_do_método>
     <opção1> <valor1>
     <opção2> <valor2>
     ...

    Para a configuração básica, mapping não é utilizado e utiliza o
    nome da interface de rede como o nome da configuração de rede
    (Veja Secção 5.7.5, “A estrofe de mapeamento”).

    Atenção
   
    Não defina duplicados da estrofe "iface" para uma interface de
    rede em "/etc/network/interfaces".

%

5.6.3. A interface de rede loopback

    A seguinte entrada de configuração no ficheiro "/etc/network/
    interfaces" activa a interface de rede loopback lo durante o
    arranque do sistema (via estrofe auto).

    auto lo
    iface lo inet loopback

    Isto está sempre presente no ficheiro "/etc/network/interfaces".

%

5.6.4. A interface de rede servida por DHCP

    Após preparar o sistema com Secção 5.5.1, “A ligação DHCP com
    Ethernet”, a interface de rede servida por DHCP é configurada ao
    criar a entrada de configuração no ficheiro "/etc/network/
    interfaces" como o seguinte:

    allow-hotplug eth0
    iface eth0 inet dhcp

    Quando o kernel Linux detecta a interface física eth0, a estrofe 
    allow-hotplug faz com que ifup active a interface e a estrofe 
    iface faz com que ifup utilize DHCP para configurar a interface.

%

5.6.5. A interface de rede com IP estático

    A interface de rede servida por IP estático é configurada ao
    criar a entrada de configuração no ficheiro "/etc/network/
    interfaces" como a seguir:

    allow-hotplug eth0
    iface eth0 inet static
     address 192.168.11.100
     netmask 255.255.255.0
     gateway 192.168.11.1
     dns-domain exemplo.com
     dns-nameservers 192.168.11.1

    Quando o kernel Linux detecta a interface física eth0, a estrofe 
    allow-hotplug faz com que ifup active a interface e a estrofe 
    iface faz com que ifup use IP estático para configurar a
    interface.

    Aqui, assumi o seguinte:

      * Alcance de endereços IP da rede LAN: 192.168.11.0 -
        192.168.11.255

      * Endereço IP da gateway: 192.168.11.1

      * Endereço IP do PC: 192.168.11.100

      * O pacote resolvconf: instalado

      * O nome de domínio: "exemplo.com"

      * Endereço IP do servidor DNS: 192.168.11.1

    Quando o pacote resolvconf não estiver instalado, a configuração
    relacionada com DNS precisa ser feita manualmente ao editar o
    ficheiro "/etc/resolv.conf" como a seguir:

    nameserver 192.168.11.1
    domain exemplo.com

    Cuidado

    Os endereços IP utilizados no exemplo acima não se destinam a ser
    copiados literalmente. Tem de ajustar os números do IP à
    configuração da sua rede atual.

%

5.6.6. O básico da interface de rede sem fios

    A LAN sem fios (WLAN em resumo) disponibiliza a ligação sem fios
    mais rápida através da difusão espectral de bandas de rádio não
    licenciadas baseada no conjunto de standards chamado IEEE 802.11.

    As interfaces de WLAN são quase iguais às interfaces Ethernet
    normais mas necessitam que lhes seja disponibilizado um ID de
    rede e dados de chave de encriptação quando são inicializadas. As
    suas ferramentas de rede de alto nível são exatamente as mesmas
    das interfaces Ethernet com a excepção que os nomes das
    interfaces são um pouco diferentes como eth1, wlan0, ath0, wifi0,
    … a depender das drivers de kernel usadas.

    Dica

    O aparelho wmaster0 é o aparelho mestre o qual é um aparelho
    interno usado apenas por SoftMAC com a nova API mac80211 do
    Linux.

    Aqui estão algumas palavras chave para se lembrar para a WLAN.

    Tabela 5.11. Lista de siglas para WLAN

    +---------------------------------------------------------------+
    |acrónimo|  palavra   |               significado               |
    |        |  completa  |                                         |
    |--------+------------+-----------------------------------------|
    |NWID    |ID de rede  |ID de rede a 16 bit usado por redes      |
    |        |            |pre-802.11 WaveLAN (muito descontinuado) |
    |--------+------------+-----------------------------------------|
    |        |(Extenso)   |nome de rede dos Pontos de Acesso        |
    |(E)SSID |Service Set |Wireless (APs) interligados para formar  |
    |        |Identifier  |uma LAN 802.11 wireless integrada, ID de |
    |        |            |Domínio                                  |
    |--------+------------+-----------------------------------------|
    |WEP,    |Wired       |standard de encriptação wireless 64-bit  |
    |(WEP2)  |Equivalent  |(128-bit) de 1ª geração com chave de 40  |
    |        |Privacy     |bits (descontinuado)                     |
    |--------+------------+-----------------------------------------|
    |        |Wi-Fi       |standard de encriptação wireless de 2ª   |
    |WPA     |Protected   |geração (maioria dos 802.11i), compatível|
    |        |Access      |com WEP                                  |
    |--------+------------+-----------------------------------------|
    |        |Wi-Fi       |standard de encriptação wireless de 3ª   |
    |WPA2    |Protected   |geração (todos 802.11i), não compatível  |
    |        |Access 2    |com WEP                                  |
    +---------------------------------------------------------------+


    A escolha atual do protocolo é normalmente limitada pelo router
    wireless que possui.

%

5.6.7. A interface LAN wireless com WPA/WPA2

    Tem de instalar o pacote wpasupplicant para suportar a WLAN com o
    novo WPA/WPA2.

    No caso de IP servido por DHCP em ligação WLAN, a entrada no
    ficheiro "/etc/network/interfaces" deverá ser conforme a
    seguinte:

    allow-hotplug ath0
    iface ath0 inet dhcp
     wpa-ssid homezone
     # hexadecimal psk is encoded from a plaintext passphrase
     wpa-psk 000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f

    Veja "/usr/share/doc/wpasupplicant/README.modes.gz".

%

5.6.8. A interface LAN wireless com WEP

    Tem de instalar o pacote wireless-tools para suportar a WLAN com
    o antigo WEP. (O seu router pode ainda usar esta infraestrutura
    insegura, mas é melhor do que nada.)

    Cuidado
   
    Por favor note que o seu tráfego de rede por WLAN com WEP pode
    ser interceptado por outros.

    No caso de IP servido por DHCP em ligação WLAN, a entrada no
    ficheiro "/etc/network/interfaces" deverá ser conforme a
    seguinte:

    allow-hotplug eth0
    iface eth0 inet dhcp
     wireless-essid Home
     wireless-key1 0123-4567-89ab-cdef
     wireless-key2 12345678
     wireless-key3 s:password
     wireless-defaultkey 2
     wireless-keymode open

    Veja "/usr/share/doc/wireless-tools/README.Debian".

%

5.6.9. A ligação PPP

    Tem de configurar a ligação PPP primeiro como descrito antes
    (veja Secção 5.5.3, “A ligação PPP com o pppconfig”). Depois,
    adicione a entrada no ficheiro "/etc/network/interfaces" para o
    aparelho PPP principal ppp0 como a seguir.

    iface ppp0 inet ppp
     provider <nome_do_isp>

%

5.6.10. A ligação PPP alternativa

    Necessita primeiro de configurar a ligação PPP alternativa com o
    wvdial como descrito antes (veja Secção 5.5.4, “A ligação PPP
    alternativa com o wvdialconf”). Depois, adicione a entrada no
    ficheiro "/etc/network/interfaces" para o aparelho PPP principal
    ppp0 como a seguir.

    iface ppp0 inet wvdial

%

5.6.11. A ligação PPPoE

    Para um PC ligado directamente à WAN servido por PPPoE, precisa
    de configurar o sistema com a ligação PPPoE como descrito antes
    (veja Secção 5.5.5, “A ligação PPPoE com o pppoeconf”). Depois,
    adicione a entrada no ficheiro "/etc/network/interfaces" para o
    aparelho PPPoE principal eth0 como a seguir.

    allow-hotplug eth0
    iface eth0 inet manual
     pre-up /sbin/ifconfig eth0 up
     up ifup ppp0=dsl
     down ifdown ppp0=dsl
     post-down /sbin/ifconfig eth0 down
    # O seguinte é usado apenas internamente
    iface dsl inet ppp
     provider dsl-provider

%

5.6.12. O estado de configuração de rede do ifupdown

    O ficheiro "/etc/network/run/ifstate" armazena os estados de
    configuração de rede desejados para todas as interfaces de rede
    atualmente activas e geridas pelo pacote ifupdown. Infelizmente,
    mesmo que o sistema ifupdown falhe ao ativar uma interface como
    desejado, o ficheiro "/etc/network/run/ifstate" lista-a como
    activa.

    A menos que o resultado do comando ifconfig(8) para uma interface
    não tenha uma linha como o exemplo seguinte, não pode ser usada
    como parte de uma rede IPV4.

      inet addr:192.168.11.2  Bcast:192.168.11.255  Mask:255.255.255.0

    Nota
   
    Para o aparelho Ethernet ligado a PPPoE, ao resultado do comando 
    ifconfig(8) falta uma linha que se parece com o exemplo em cima.

%

5.6.13. A reconfiguração de rede básica

    Quando tentar reconfigurar a interface, p.e., eth0, tem que
    primeiro desactivá-la com o comando "sudo ifdown eth0". Isto
    remove a entrada de eth0 do ficheiro "/etc/network/run/ifstate".
    (Isto pode resultar nalguma mensagem de erro se a eth0 não
    estiver activa ou tiver sido mal configurada anteriormente. Até
    agora, parece ser seguro fazê-lo à estação de trabalho simples de
    um utilizador em qualquer altura.)

    Agora é livre de rescrever o conteúdo de "/etc/network/
    interfaces" como necessitar para reconfigurar a interface de rede
    eth0.

    Depois pode reativar eth0 com o comando "sudo ifup eth0".

    Dica
   
    Pode (re)inicializar a interface de rede com um simples "sudo
    ifdown eth0;sudo ifup eth0".

%

5.6.14. O pacote ifupdown-extra

    O pacote ifupdown-extra disponibiliza fáceis testes de ligação de
    rede para utilizar com o pacote ifupdown.

      * O comando network-test(1) pode ser usado a partir da shell.
   
      * Os scripts automáticos são corridos para cada execução do
        comando ifup.

    O comando network-test poupa-lhe a trabalheira de executar
    comandos de baixo nível para analisar o problema de rede.

    Os scripts automáticos estão instalados em "/etc/network/*/" e
    executam o seguinte.

      * Verificar a ligação de cabo de rede

      * Verificar o uso duplicado de endereço IP

      * Configura rotas estáticas do sistema baseadas na definição "/
        etc/network/routes"

      * Verificar se a gateway de rede está ao alcance

      * Grava os resultados no ficheiro "/var/log/syslog"

    Este registo do syslog é bastante útil para a administração de
    problemas de rede no sistema remoto.

    Dica

    O comportamento automático do pacote ifupdown-extra é
    configurável com o "/etc/default/network-test". Algumas destas
    verificações automáticas abrandam o arranque do sistema um pouco
    porque demora algum tempo a escutar por respostas de ARP.

%

5.7. A configuração de rede avançada com ifupdown (antigo)

    A funcionalidade do pacote ifupdown pode ser melhorada para além
    do que foi descrito em Secção 5.6, “A configuração básica de rede
    com ifupdown (legacy)” com conhecimentos avançados.

    As funcionalidades descritas aqui são completamente opcionais.
    Estou a ser preguiçoso e minimalista, raramente me incomodo a
    utilizar isto.

    Cuidado

    Se não conseguir configurar a ligação de rede com a informação de
    Secção 5.6, “A configuração básica de rede com ifupdown (legacy)”
    , irá agravar a situação ao utilizar a informação em baixo.

%

5.7.1. O pacote ifplugd

    O pacote ifplugd é uma antiga ferramenta de configuração
    automática de rede que apenas pode gerir ligações Ethernet. Isto
    resolve situações de ligar/desligar cabos Ethernet para portáteis
    e etc. Se tiver o NetworkManager ou o Wicd (veja Secção 5.2, “A
    configuração moderna de rede para desktop”) instalado, não
    precisa deste pacote.

    Este pacote corre um daemon e substitui as funcionalidades auto
    ou allow-hotplug (veja Tabela 5.10, “Lista de estrofes em "/etc/
    network/interfaces"”) e inicia as interfaces após a ligação à
    rede deles.

    Aqui está como utilizar o pacote ifplugd para a porta Ethernet
    interna, ex. eth0.

     1. Remova a estrofe em "/etc/network/interfaces": "auto eth0" ou
        "allow-hotplug eth0".

     2. Mantenha a estrofe em "/etc/network/interfaces": "iface eth0
        inet …" e "mapping …".
   
     3. instale o pacote ifplugd.

     4. Corra "sudo dpkg-reconfigure ifplugd".

     5. Ponha eth0 como a "interface estática para ser correspondida
        pelo ifplugd".

    Agora, a configuração de rede funciona como deseja.

      * Após o ligar da máquina ou após a descoberta do hardware, a
        interface não é activada por si própria.

          + Processo de arranque rápido sem o longo tempo limite do
            DHCP.

          + Nenhuma interface activada de modo esquisito sem um
            endereço IPv4 apropriado (veja Secção 5.6.12, “O estado
            de configuração de rede do ifupdown”).

      * Após encontrar o cabo Ethernet, a interface é activada.

      * Após algum tempo depois de desligar o cabo Ethernet, a
        interface é desactivada automaticamente.

      * Após ligar outro cabo Ethernet, a interface é activada sob o
        novo ambiente de rede.

    Dica

    Os argumentos para o comando ifplugd(8) podem definir o
    comportamento dele tal como o atraso para reconfigurar
    interfaces.

%

5.7.2. O pacote ifmetric

    O pacote ifmetric permite-nos manipular métricas de rotas à
    posteriori mesmo para DHCP.

    O seguinte configura a interface eth0 para ser preferida sobre a
    interface wlan0.

     1. Instale o pacote ifmetric.

     2. Adicione uma linha de opção com "metric 0" logo por baixo da
        linha "iface eth0 inet dhcp" em "/etc/network/interfaces".

     3. Adicione uma linha de opção com "metric 1" logo por baixo da
        linha "iface wlan0 inet dhcp" em "/etc/network/interfaces".

    O 0 (zero) métrico significa que a rota de prioridade mais alta e
    é a predefinida. O valor métrico mais alto significa rotas de
    prioridade mais baixa. O endereço IP da interface activa com o
    valor métrico mais baixo torna-se o originário. Veja ifmetric(8).

%

5.7.3. A interface virtual

    Uma única interface Ethernet física pode ser configurada como
    múltiplas interfaces virtuais com endereços IP diferentes.
    Normalmente o objetivo é ligar uma interface a diferentes
    sub-redes de IP. Por exemplo, hospedagem web virtual baseada em
    endereço IP por uma única interface de rede é uma das tais
    aplicações.

    Por exemplo, vamos supor o seguinte.

      * Uma única interface Ethernet na sua máquina está ligada a um
        hub de Ethernet (não ao router de banda larga).

      * O hub Ethernet esta ligado a ambos; Internet e rede LAN.

      * A rede LAN usa a sub-rede 192.168.0.x/24.

      * O seu host usa o endereço IP servido por DHCP com a interface
        física eth0 para a Internet.

      * A sua máquina usa 192.168.0.1 com a interface virtual eth0:0
        para a LAN.

    As seguintes estrofes em "/etc/network/interfaces" configuram a
    sua rede.

    iface eth0 inet dhcp
     metric 0
    iface eth0:0 inet static
     address 192.168.0.1
     netmask 255.255.255.0
     network 192.168.0.0
     metric 1

    Cuidado

    Apesar deste exemplo de configuração com network address
    translation (NAT) que usa netfilter/iptables (veja Secção 5.10,
    “Infraestrutura netfilter”) poder disponibilizar um router barato
    para a LAN com apenas uma interface única, não existem
    capacidades reais de firewall com tal configuração. Deve utilizar
    2 interfaces físicas com NAT tornar a rede local segura a partir
    da Internet.

%

5.7.4. A sintaxe de comando avançada

    O pacote ifupdown oferece configuração de rede avançada a
    utilizar o nome de configuração de rede e o nome de interface de
    rede. Utilizo uma terminologia ligeiramente diferente da usada em
    ifup(8) e interfaces(5).

    Tabela 5.12. Lista de terminologia para aparelhos de rede

    +---------------------------------------------------------------+
    |terminologia|  a minha   | exemplos no texto a  |  descrição   |
    | do manual  |terminologia|        seguir        |              |
    |------------+------------+----------------------+--------------|
    |            |            |                      |nome dado pelo|
    |nome da     |nome da     |lo, eth0,             |kernel do     |
    |interface   |interface de|<nome_da_interface>   |Linux (a usar |
    |física      |rede        |                      |o mecanismo   |
    |            |            |                      |udev)         |
    |------------+------------+----------------------+--------------|
    |            |            |                      |testemunho de |
    |nome da     |nome da     |config1, config2,     |nome a seguir |
    |interface   |configuração|<nome_da_configuração>|iface no "/etc|
    |lógica      |de rede     |                      |/network/     |
    |            |            |                      |interfaces"   |
    +---------------------------------------------------------------+


    Os comandos de configuração de rede básicos em Secção 5.6.1, “A
    sintaxe simplificada de comando” necessitam que o testemunho de
    nome da configuração de rede da estrofe iface corresponda ao nome
    da interface de rede em "/etc/network/interfaces".

    Os comandos de configuração de rede avançados activam a separação
    do nome da configuração de rede e o nome da interface de rede em
    "/etc/network/interfaces" como a seguir.

    Tabela 5.13. Lista de comandos avançados de configuração de rede
    com ifupdown

    +---------------------------------------------------------------+
    |  comando  |                       acção                       |
    |-----------+---------------------------------------------------|
    |ifup eth0= |torna activa a interface de rede eth0 com a        |
    |config1    |configuração config1                               |
    |-----------+---------------------------------------------------|
    |ifdown eth0|torna inactiva a interface de rede eth0 com a      |
    |=config1   |configuração config1                               |
    |-----------+---------------------------------------------------|
    |ifup eth0  |torna activa a interface de rede eth0 com a        |
    |           |configuração selcionada pela estrofe mapping       |
    |-----------+---------------------------------------------------|
    |ifdown eth0|torna inactiva a interface de rede eth0 com a      |
    |           |configuração selcionada pela estrofe mapping       |
    +---------------------------------------------------------------+


%

5.7.5. A estrofe de mapeamento

    Saltamos a explicação da estrofe mapping no "/etc/network/
    interfaces" em Secção 5.6.2, “A sintaxe básica de "/etc/network/
    interfaces"” para evitar complicações. Esta estrofe tem a
    seguinte sintaxe:

    mapping <glob_de_nome_de_interface>
     script <nome_de_script>
     map <script_de_entrada1>
     map <script_de_entrada2>
     map ...

    Isto disponibiliza funcionalidades avançadas ao ficheiro "/etc/
    network/interfaces" ao automatizar a escolha da configuração com
    o script de mapeamento especificado por <nome_do_script>.

    Vamos seguir a execução do seguinte.

    $ sudo ifup eth0

    Quando o "<glob_de_nome_de_interface>" corresponde a "eth0", esta
    execução leva à execução do seguinte comando para configurar
    automaticamente eth0.

    $ sudo ifup eth0=$(echo -e '<script_entrada1> \n <script_entrada2> \n ...' | <nome_do_script> eth0)

    Aqui, as linhas de entrada do script com "map" são opcionais e
    podem ser repetidas.

    Nota
   
    O glob para a estrofe mapping funciona como o glob de nome de
    ficheiro em shell (veja Secção 1.5.6, “Glob da shell”).

%

5.7.6. A configuração manual da rede comutável

    Aqui está como mudar manualmente entre várias configurações de
    rede sem reescrever o ficheiro "/etc/network/interfaces" como em
    Secção 5.6.13, “A reconfiguração de rede básica”.

    Para todas as configurações de rede que necessite aceder, crie
    uma estrofe separada no ficheiro "/etc/network/interfaces"
    conforme o seguinte:

    auto lo
    iface lo inet loopback

    iface config1 inet dhcp

    iface config2 inet static
     address 192.168.11.100
     netmask 255.255.255.0
     gateway 192.168.11.1
     dns-domain example.com
     dns-nameservers 192.168.11.1
   
    iface pppoe inet manual
     pre-up /sbin/ifconfig eth0 up
     up ifup ppp0=dsl
     down ifdown ppp0=dsl
     post-down /sbin/ifconfig eth0 down

    # O seguinte é usado apenas internamente
    iface dsl inet ppp
     provider dsl-provider

    iface pots inet ppp
     provider provider

    Por favor note que o nome de configuração de rede o qual é o
    testemunho após iface não usa o testemunho para o nome da
    interface de rede. Também, não existe nenhuma estrofe auto nem
    estrofe allow-hotplug para iniciar a interface de rede eth0
    automaticamente após eventos.

    Agora está pronto para comutar a configuração de rede.

    Vamos levar o seu PC para uma LAN servida por DHCP. Ativa a 
    interface de rede (a interface física) eth0 ao atribuir-lhe o
    nome de configuração de rede (o nome lógico da interface) config1
    com o seguinte.

    $ sudo ifup eth0=config1
    Password:
    ...

    A interface eth0 está activa, configurada por DHCP e ligada a
    LAN.

    $ sudo ifdown eth0=config1
    ...

    A interface eth0 está inactiva e desligada da LAN.

    Vamos levar o seu PC a uma LAN servida por IP estático. Ativa a 
    interface de rede eth0 ao atribuir-lhe o nome de configuração de
    rede config2 com o seguinte.

    $ sudo ifup eth0=config2
    ...

    A interface eth0 está activa, configurada com IP estático e
    ligada à LAN. Os parâmetros adicionais dados como dns-*
    configuram o conteúdo de "/etc/resolv.conf". Este "/etc/
    resolv.conf" é melhor is better gerido se o pacote resolvconf
    estiver instalado.

    $ sudo ifdown eth0=config2
    ...

    A interface eth0 está inactiva e desligada da LAN, outra vez.

    Vamos levar o seu PC para uma porta em modem-BB ligado ao serviço
    servido de PPPoE. Ativa a interface de rede eth0 ao atribuir-lhe
    o nome de configuração de rede pppoe com o seguinte.

    $ sudo ifup eth0=pppoe
    ...

    A interface eth0 está activa, configurada com ligação PPPoE
    directamente ao ISP.

    $ sudo ifdown eth0=pppoe
    ...

    A interface eth0 está inactiva e desligada, outra vez.

    Vamos levar o seu PC para uma localização sem LAN ou modem BB mas
    com POTS e modem. Ativa a interface de rede ppp0 ao atribuir-lhe
    o nome de configuração de rede pots com o seguinte.

    $ sudo ifup ppp0=pots
    ...

    A interface ppp0 está activa e ligada à Internet com PPP.

    $ sudo ifdown ppp0=pots
    ...

    A interface ppp0 está inactiva e desligada da Internet.

    Deve verificar o ficheiro "/etc/network/run/ifstate" para o
    estado atual da configuração de rede do sistema ifupdown.

    Atenção
   
    Talvez necessite ajustar os números no final de eth*, ppp*, etc.
    se possuir várias interfaces de rede.

%

5.7.7. Usar scripts com o sistema ifupdown

    O sistema ifupdown corre automaticamente scripts instalados em "/
    etc/network/*/" enquanto exporta variáveis de ambiente aos
    scripts.

    Tabela 5.14. Lista de variáveis de ambiente passadas pelo sistema
    ifupdown

    +---------------------------------------------------------------+
    |variável de |                  valor passado                   |
    |  ambiente  |                                                  |
    |------------+--------------------------------------------------|
    |"$IFACE"    |nome físico (nome da interface) da interface a ser|
    |            |processada                                        |
    |------------+--------------------------------------------------|
    |"$LOGICAL"  |nome lógico (nome da configuração) da interface a |
    |            |ser processada                                    |
    |------------+--------------------------------------------------|
    |"$ADDRFAM"  |<família_de_endereços> da interface               |
    |------------+--------------------------------------------------|
    |"$METHOD"   |<nome_de_método> da interface (ex., "static")     |
    |------------+--------------------------------------------------|
    |"$MODE"     |"start" se corrido a partir de ifup, "stop" se    |
    |            |corrido a partir de ifdown                        |
    |------------+--------------------------------------------------|
    |            |como para "$MODE", mas com granularidade mais     |
    |"$PHASE"    |fina, a distinguir as fases pre-up, post-up,      |
    |            |pre-down e post-down                              |
    |------------+--------------------------------------------------|
    |"$VERBOSITY"|indica se "--verbose" foi usado, regulado para 1  |
    |            |se sim, 0 se não                                  |
    |------------+--------------------------------------------------|
    |"$PATH"     |caminho de busca de comando: "/usr/local/sbin:/usr|
    |            |/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"         |
    |------------+--------------------------------------------------|
    |"$IF_       |valor para a opção correspondente sob a estrofe   |
    |<OPTION>"   |iface                                             |
    +---------------------------------------------------------------+


    Aqui, cada variável de ambiente, "$IF_<OPTION>", é criada a
    partir do nome da opção correspondente tal como <opção1> e
    <opção2> ao preceder com "$IF_", a converter para maiúsculas, a
    substituir hífenes por underscores e a descartar os caracteres
    não-alfanuméricos.

    Dica

    Veja Secção 5.6.2, “A sintaxe básica de "/etc/network/
    interfaces"” para <família_de_endereços>, <nome_de_método>,
    <opção1> e <opção2>.

    O pacote ifupdown-extra (veja Secção 5.6.14, “O pacote
    ifupdown-extra”) utiliza estas variáveis de ambiente para
    estender a funcionalidade do pacote ifupdown. O pacote ifmetric
    (veja Secção 5.7.2, “O pacote ifmetric”) instala o script "/etc/
    network/if-up.d/ifmetric" o qual define a métrica via variável
    "$IF_METRIC". O pacote guessnet (veja Secção 5.7.8, “Mapear com
    guessnet”), que disponibiliza um estrutura simples e poderosa
    para a seleção automática da configuração de rede através do
    mecanismo de mapeamento, também as utiliza.

    Nota

    Para exemplos mais específicos de scripts personalizados de
    configuração de rede que utilizam estas variáveis de ambiente,
    deve consultar os scripts de exemplo em "/usr/share/doc/ifupdown/
    examples/*" e os scripts utilizados nos pacotes ifscheme e
    ifupdown-scripts-zg2. Estes scripts adicionais têm algumas
    sobreposições de funcionalidades com os pacotes básicos
    ifupdown-extra e guessnet. Se instalar estes scripts adicionais,
    deve personalizar estes scripts para evitar interferências.

%

5.7.8. Mapear com guessnet

    Em vez de escolher manualmente a configuração conforme descrito
    em Secção 5.7.6, “A configuração manual da rede comutável”, pode
    utilizar o mecanismo de mapeamento descrito em Secção 5.7.5, “A
    estrofe de mapeamento” para selecionar automaticamente a
    configuração de rede com scripts personalizados.

    O comando guessnet-ifupdown(8) disponibilizado pelo pacote
    guessnet foi desenhado para ser usado como um script de
    mapeamento e disponibiliza uma estrutura poderosa para melhorar o
    sistema ifupdown.

      * Liste as condições de teste como o valor para as opções do 
        guessnet para cada configuração de rede sob a estrofe iface.
   
      * O mapeamento escolhe a iface com o primeiro resultado
        não-ERRO como a configuração de rede.

    Esta utilização dupla do ficheiro "/etc/network/interfaces" pelo
    script de mapeamento, guessnet-ifupdown e a infraestrutura
    original de configuração de rede, ifupdown, não causa impactos
    negativos porque as opções do guessnet apenas exportam variáveis
    de ambiente extras para scripts executados pelo sistema ifupdown.
    Veja detalhes em guessnet-ifupdown(8).

    Nota

    Quando são necessárias múltiplas linhas de opção guessnet em "/
    etc/network/interfaces", use linhas de opção começadas com 
    guessnet1, guessnet2 e assim em diante, porque o pacote ifupdown
    não permite que as strings de inicio das linhas de opção sejam
    repetidas.

5.8. A configuração de rede de baixo nível

%

5.8.1. Comandos iproute2

    Os comandos Iproute2 oferecem capacidades completas de
    configuração de rede de baixo nível. Aqui está uma tabela de
    traduções dos comandos net-tools obsoletos para os novos comandos
    iproute2 etc.

    Tabela 5.15. Tabela de tradução dos comandos obsoletos net-tools
    para os novos comandos iproute2

    +---------------------------------------------------------------+
    |  ferramentas de  |   novo    |                                |
    |  rede obsoletas  | iproute2  |          manipulação           |
    |                  |   etc.    |                                |
    |------------------+-----------+--------------------------------|
    |ifconfig(8)       |ip addr    |endereço de protoco (IP ou IPv6)|
    |                  |           |num aparelho                    |
    |------------------+-----------+--------------------------------|
    |route(8)          |ip route   |entrada na tabela de rotas      |
    |------------------+-----------+--------------------------------|
    |arp(8)            |ip neigh   |entrada na cache ARP ou NDISC   |
    |------------------+-----------+--------------------------------|
    |ipmaddr           |ip maddr   |endereço multicast              |
    |------------------+-----------+--------------------------------|
    |iptunnel          |ip tunnel  |túnel sobre IP                  |
    |------------------+-----------+--------------------------------|
    |nameif(8)         |ifrename(8)|nomeia as interfaces de rede    |
    |                  |           |baseadas no endereço MAC        |
    |------------------+-----------+--------------------------------|
    |mii-tool(8)       |ethtool(8) |Definições de aparelho Ethernet |
    +---------------------------------------------------------------+


    Veja ip(8) e Manual do Conjunto de Utilitários IPROUTE2.

%

5.8.2. Operações de rede seguras de baixo nível

    Pode usar comandos de rede de baixo nível como a seguir em
    segurança pois eles não mudam a configuração de rede.

    Tabela 5.16. Lista de comandos de rede de baixo nível

    +---------------------------------------------------------------+
    |       comando       |                descrição                |
    |---------------------+-----------------------------------------|
    |ifconfig             |mostra o estado de ligação e endereço das|
    |                     |interfaces ativas                        |
    |---------------------+-----------------------------------------|
    |ip addr show         |mostra o estado de ligação e endereço das|
    |                     |interfaces ativas                        |
    |---------------------+-----------------------------------------|
    |route -n             |mostra toda a tabela de rotas em         |
    |                     |endereços numéricos                      |
    |---------------------+-----------------------------------------|
    |ip route show        |mostra toda a tabela de rotas em         |
    |                     |endereços numéricos                      |
    |---------------------+-----------------------------------------|
    |arp                  |mostra o conteúdo atual das tabelas de   |
    |                     |cache ARP                                |
    |---------------------+-----------------------------------------|
    |ip neigh             |mostra o conteúdo atual das tabelas de   |
    |                     |cache ARP                                |
    |---------------------+-----------------------------------------|
    |plog                 |mostra o log do daemon ppp               |
    |---------------------+-----------------------------------------|
    |ping yahoo.com       |verifica a ligação de Internet para      |
    |                     |"yahoo.com"                              |
    |---------------------+-----------------------------------------|
    |whois yahoo.com      |verifica quem registou "yahoo.com" na    |
    |                     |base de dados de domínios                |
    |---------------------+-----------------------------------------|
    |traceroute yahoo.com |rastreia a ligação Internet até          |
    |                     |"yahoo.com"                              |
    |---------------------+-----------------------------------------|
    |tracepath yahoo.com  |rastreia a ligação Internet até          |
    |                     |"yahoo.com"                              |
    |---------------------+-----------------------------------------|
    |mtr yahoo.com        |rastreia a ligação Internet até          |
    |                     |"yahoo.com" (repetidamente)              |
    |---------------------+-----------------------------------------|
    |dig                  |verifica os registos DNS de "exemplo.com"|
    |[@servidor-dns.com]  |pelo "servidor-dns.com" para um registo  |
    |exemplo.com [{a|mx|  |"a", "mx", ou "any"                      |
    |any}]                |                                         |
    |---------------------+-----------------------------------------|
    |iptables -L -n       |verifica o filtro de pacotes             |
    |---------------------+-----------------------------------------|
    |netstat -a           |procura todos os portos abertos          |
    |---------------------+-----------------------------------------|
    |netstat -l --inet    |procura portos a escutar                 |
    |---------------------+-----------------------------------------|
    |netstat -ln --tcp    |procura portos TCP a escutar (numérico)  |
    |---------------------+-----------------------------------------|
    |dlint exemplo.com    |verifica a informação da zona DNS de     |
    |                     |"exemplo.com"                            |
    +---------------------------------------------------------------+


    Dica

    Algumas destas ferramentas de configuração de baixo nível residem
    em "/sbin/". Pode necessitar de escrever o caminho do comando
    completo tal como "/sbin/ifconfig" ou adicionar "/sbin" à lista
    "$PATH" no seu "~/.bashrc".

%

5.9. Optimização da rede

    A optimização de rede genérica está para além do objetivo desta
    documentação. Apenas toco em assuntos pertinentes às ligações de
    grau de consumidor.

    Tabela 5.17. Lista de ferramentas de optimização de rede

    +---------------------------------------------------------------+
    | pacotes |popcon|tamanho|              descrição               |
    |---------+------+-------+--------------------------------------|
    |         |V:7,  |       |mostra informação da utilização de    |
    |iftop    |I:115 |97     |largura de banda numa interface de    |
    |         |      |       |rede                                  |
    |---------+------+-------+--------------------------------------|
    |iperf    |V:4,  |263    |ferramenta de medição da largura de   |
    |         |I:55  |       |banda do Protocolo Internet           |
    |---------+------+-------+--------------------------------------|
    |ifstat   |V:0,  |60     |InterFace STATistics Monitoring       |
    |         |I:8   |       |                                      |
    |---------+------+-------+--------------------------------------|
    |bmon     |V:1,  |146    |monitor de largura de banda portável e|
    |         |I:17  |       |estimador de taxas                    |
    |---------+------+-------+--------------------------------------|
    |         |V:0,  |       |script que mede rapidamente a         |
    |ethstatus|I:5   |40     |transferência efectiva de um aparelho |
    |         |      |       |de rede                               |
    |---------+------+-------+--------------------------------------|
    |bing     |V:0,  |80     |testador de largura de banda empírica |
    |         |I:1   |       |estocástica                           |
    |---------+------+-------+--------------------------------------|
    |bwm-ng   |V:2,  |90     |monitor de largura de banda pequeno e |
    |         |I:17  |       |simples baseado em consola            |
    |---------+------+-------+--------------------------------------|
    |ethstats |V:0,  |23     |monitor de estatísticas de Ethernet   |
    |         |I:0   |       |baseado em consola                    |
    |---------+------+-------+--------------------------------------|
    |ipfm     |V:0,  |78     |ferramenta de análise de largura de   |
    |         |I:0   |       |banda                                 |
    +---------------------------------------------------------------+


%

5.9.1. Encontrar o MTU óptimo

    O valor Maximum Transmission Unit (MTU) pode ser determinado
    experimentalmente com ping(8) com a opção "-M do" a qual envia
    pacotes ICMP com tamanho de dados inicial de 1500 (com offset de
    28 bytes para o cabeçalho IP+ICMP) e encontra o tamanho maior sem
    fragmentação IP.

    Por exemplo, tente o seguinte:

    $ ping -c 1 -s $((1500-28)) -M do www.debian.org
    PING www.debian.org (194.109.137.218) 1472(1500) bytes of data.
    From 192.168.11.2 icmp_seq=1 Frag needed and DF set (mtu = 1454)

    --- www.debian.org ping statistics ---
    0 packets transmitted, 0 received, +1 errors

    Tente 1454 em vez de 1500

    Observe ping(8) com sucesso com 1454.

    Este processo é a descoberta do Caminho MTU (PMTU) (RFC1191) e o
    comando tracepath(8) pode automatizar isto.

    Dica

    O exemplo acima com valor PMTU de 1454 é para o meu provedor de
    FTTP anterior o qual utilizava Modo de Transferência Assíncrona
    (ATM) com a coluna vertebral da rede dele e servia os seus
    clientes com PPPoE. O valor de PMTU real depende do seu ambiente,
    p.e. 1500 para o meu provedor de FTTP novo.

    Tabela 5.18. Regras básicas para o valor MTU óptimo

    +---------------------------------------------------------------+
    |  ambiente de rede   |     MTU     |         racional          |
    |---------------------+-------------+---------------------------|
    |Ligação Dial-up (IP: |576          |standard                   |
    |PPP)                 |             |                           |
    |---------------------+-------------+---------------------------|
    |Ligação Ethernet (IP:|1500         |standard e predefinido     |
    |DHCP ou fixo)        |             |                           |
    |---------------------+-------------+---------------------------|
    |Ligação Ethernet (IP:|1492 (=      |2 bytes para o cabeçalho de|
    |PPPoE)               |1500-8)      |PPP e 6 bytes para o       |
    |                     |             |cabeçalho de PPPoE         |
    |---------------------+-------------+---------------------------|
    |Ligação Ethernet     |             |especulação do autor: 18   |
    |(espinha dorsal do   |1462 (=      |bytes para cabeçalho de    |
    |ISP: ATM, IP: DHCP ou|48*31-18-8)  |Ethernet, 8 bytes para     |
    |fixo)                |             |trailer de SAR             |
    |---------------------+-------------+---------------------------|
    |Ligação Ethernet     |1454 (=      |veja "Configuração de MTU  |
    |(espinha dorsal do   |48*31-8-18-8)|Óptima para Ligações PPPoE |
    |ISP: ATM, IP: PPPoE) |             |ADSL" para o racional      |
    +---------------------------------------------------------------+


    Adicionalmente a estas regras básicas, deve saber o seguinte:

      * Qualquer utilização de métodos de túnel (VPN etc.) pode
        reduzir o MTU óptimo pelo excesso que adicionam.

      * O valor MTU não deve exceder o valor PMTU determinado
        experimentalmente.

      * O maior valor MTU é geralmente melhor quando são conhecidas
        outras limitações.

%

5.9.2. Definir o MTU

    Aqui estão exemplos para definir o valor MTU da predefinição 1500
    aos 1454.

    Para o DHCP (veja Secção 5.6.4, “A interface de rede servida por
    DHCP”), pode substituir as linhas de estrofe iface pertinentes em
    "/etc/network/interfaces" com o seguinte.

    iface eth0 inet dhcp
     pre-up /sbin/ifconfig $IFACE mtu 1454

    Para IP estático (veja Secção 5.6.5, “A interface de rede com IP
    estático”), pode substituir as linhas pertinentes de iface em "/
    etc/network/interfaces" com o seguinte.

    iface eth0 inet static
     address 192.168.11.100
     netmask 255.255.255.0
     gateway 192.168.11.1
     mtu 1454
     dns-domain exemplo.com
     dns-nameservers 192.168.11.1

    Para o PPPoE direto (veja Secção 5.5.5, “A ligação PPPoE com o
    pppoeconf”), pode substituir a linha "mtu" pertinente no "/etc/
    ppp/peers/dsl-provider" com o seguinte.

    mtu 1454

    O tamanho de segmento máximo (MSS) é usado como uma alternativa
    ao tamanho do pacote. As relações entre MSS e MTU são as
    seguintes.

      * MSS = MTU - 40 para IPv4
   
      * MSS = MTU - 60 para IPv6

    Nota

    A optimização baseada no iptables(8) (veja Secção 5.10,
    “Infraestrutura netfilter”) pode apertar o tamanho do pacote pelo
    MSS e é útil para o router. Veja "TCPMSS" em iptables(8).

%

5.9.3. Optimização WAN TCP

    Para a WAN moderna de alta largura de banda e alta latência, a
    performance do TCP pode ser maximizada a ajustar os parâmetros de
    tamanho de buffer TCP conforme descrito em "Guia de Afinações de
    TCP" e em "Afinações do TCP". Até agora, os ajustes predefinidos
    atuais de Debian servem bem mesmo para a minha LAN ligada pelo
    serviço FTTP rápido de 1G bps.

%

5.10. Infraestrutura netfilter

    Netfilter disponibiliza uma infra-estrutura para firewall de
    estado e tradução de endereços de rede (NAT) com módulos do
    kernel Linux (veja Secção 3.3.1, “A inicialização de módulos do
    kernel”).

    Tabela 5.19. Lista de ferramentas de firewall

    +---------------------------------------------------------------+
    |    pacotes    |popcon|tamanho|           descrição            |
    |---------------+------+-------+--------------------------------|
    |               |V:300,|       |ferramentas de administração    |
    |iptables       |I:993 |2520   |para netfilter (iptables(8) para|
    |               |      |       |IPv4, ip6tables(8) para IPv6)   |
    |---------------+------+-------+--------------------------------|
    |               |V:0,  |       |ferramentas de administração    |
    |arptables      |I:2   |96     |para netfilter (arptables(8)    |
    |               |      |       |para ARP)                       |
    |---------------+------+-------+--------------------------------|
    |               |V:15, |       |ferramentas de administração    |
    |ebtables       |I:39  |265    |para netfilter (ebtables(8) para|
    |               |      |       |criação de pontes Ethernet)     |
    |---------------+------+-------+--------------------------------|
    |               |V:0,  |       |monitoriza continuamente o      |
    |iptstate       |I:3   |116    |estado do netfilter (semelhante |
    |               |      |       |ao top(1))                      |
    |---------------+------+-------+--------------------------------|
    |shorewall-init |V:0,  |68     |Inicialização de Shoreline      |
    |               |I:0   |       |Firewall                        |
    |---------------+------+-------+--------------------------------|
    |               |V:5,  |       |Shoreline Firewall, gerador de  |
    |shorewall      |I:13  |2458   |ficheiro de configuração        |
    |               |      |       |netfilter                       |
    |---------------+------+-------+--------------------------------|
    |               |V:0,  |       |Shoreline Firewall, gerador de  |
    |shorewall-lite |I:0   |65     |ficheiro de configuração (versão|
    |               |      |       |leve) netfilter                 |
    |---------------+------+-------+--------------------------------|
    |               |V:1,  |       |Shoreline Firewall, gerador de  |
    |shorewall6     |I:2   |779    |ficheiro de configuração (versão|
    |               |      |       |IPv6) netfilter                 |
    |---------------+------+-------+--------------------------------|
    |               |V:0,  |       |Shoreline Firewall, gerador de  |
    |shorewall6-lite|I:0   |64     |ficheiro de configuração (IPv6, |
    |               |      |       |versão light) netfilter         |
    +---------------------------------------------------------------+


    O principal programa de utilizador para o netfilter é o iptables
    (8). Pode configurar manualmente e interativamente o netfilter a
    partir da shell, gravar o estado dele com iptables-save(8) e
    restaurá-lo via script init com iptables-restore(8) após o
    reiniciar do sistema.

    Scripts de ajuda de configuração como o shorewall facilitam este
    processo.

    Veja documentação em http://www.netfilter.org/documentation/ (ou
    em "/usr/share/doc/iptables/html/").

      * Manual de Conceitos de Rede em Linux

      * Manual do Packet Filtering em Linux 2.4

      * Como Fazer NAT em Linux 2.4

    Dica

    Apesar destes terem sido escritos para o Linux 2.4, ambos
    comandos iptables(8) e função de kernel netfilter aplicam-se às
    séries 2.6 e 3.x do kernel Linux.

Capítulo 6. Aplicações de rede

    Após estabelecer a ligação de rede (veja Capítulo 5, Configuração
    de rede), pode executar varias aplicações de rede.

    Dica

    Para um guia moderno específico Debian para a infraestrutura de
    rede, leia O Livro de Mão do Administrador Debian —
    Infrastructure de Rede.

    Dica

    Se ativar a "Verificação de 2 Passos" com alguns ISP, precisa de
    obter uma palavra-passe de aplicação para aceder aos serviços POP
    e SMTP do seu programa. Pode precisar de aprovar o seu IP de
    máquina com antecedência.

%

6.1. Navegadores web

    Existem muitos pacotes de navegadores web para aceder a conteúdos
    remotos com Hypertext Transfer Protocol (HTTP).

    Tabela 6.1. Lista de exploradores web

    +---------------------------------------------------------------+
    |     pacote     |popcon|tamanho|  tipo  |     descrição do     |
    |                |      |       |        |    explorador web    |
    |----------------+------+-------+--------+----------------------|
    |chromium        |V:51, |180040 |X       |Chromium, (browser    |
    |                |I:141 |       |        |open-source da Google)|
    |----------------+------+-------+--------+----------------------|
    |                |      |       |        |Firefox, (navegador de|
    |                |V:13, |       |        |código aberto da      |
    |firefox         |I:20  |205631 |, ,     |Mozilla, apenas       |
    |                |      |       |        |disponível no Debian  |
    |                |      |       |        |Unstable)             |
    |----------------+------+-------+--------+----------------------|
    |                |V:217,|       |        |Firefox ESR,          |
    |firefox-esr     |I:437 |198436 |, ,     |(Lançamento de Suporte|
    |                |      |       |        |Estendido do Firefox) |
    |----------------+------+-------+--------+----------------------|
    |epiphany-browser|V:4,  |3730   |, ,     |GNOME, HIG compliant, |
    |                |I:24  |       |        |Epiphany              |
    |----------------+------+-------+--------+----------------------|
    |konqueror       |V:18, |20763  |, ,     |KDE, Konqueror        |
    |                |I:100 |       |        |                      |
    |----------------+------+-------+--------+----------------------|
    |dillo           |V:1,  |1536   |, ,     |Dillo, (navegador     |
    |                |I:7   |       |        |leve, baseado em FLTK)|
    |----------------+------+-------+--------+----------------------|
    |w3m             |V:31, |2289   |texto   |w3m                   |
    |                |I:284 |       |        |                      |
    |----------------+------+-------+--------+----------------------|
    |lynx            |V:13, |1948   |, ,     |Lynx                  |
    |                |I:98  |       |        |                      |
    |----------------+------+-------+--------+----------------------|
    |elinks          |V:6,  |1767   |, ,     |ELinks                |
    |                |I:28  |       |        |                      |
    |----------------+------+-------+--------+----------------------|
    |links           |V:6,  |2249   |, ,     |Ligações (apenas      |
    |                |I:39  |       |        |texto)                |
    |----------------+------+-------+--------+----------------------|
    |links2          |V:1,  |5417   |gráficos|Ligações (gráficos de |
    |                |I:15  |       |        |consola sem X)        |
    +---------------------------------------------------------------+


%

6.1.1. Configuração do explorador

    Poderá ser capaz de utilizar as seguintes strings especiais de
    URL para alguns navegadores para confirmar as suas definições.

      * "about:"

      * "about:config"

      * "about:plugins"

    Debian oferece muitos pacotes livres com plugins de navegador na
    área de arquivo main, os quais podem lidar não apenas com Java
    (plataforma de software) e Flash mas também com ficheiros MPEG,
    MPEG2, MPEG4, DivX, Windows Media Video (.wmv), QuickTime (.mov),
    MP3 (.mp3), Ogg/Vorbis, DVDs, VCDs, etc. Debian também oferece
    programas de ajuda para instalar pacotes não-livres de plugins de
    navegador nas áreas de arquivo contrib ou non-free.

    Tabela 6.2. Lista de pacotes de plugins de navegadores

    +-------------------------------------------------------------------------+
    |                pacote                |popcon|tamanho| área  | descrição |
    |--------------------------------------+------+-------+-------+-----------|
    |                                      |      |       |       |Pepper     |
    |                                      |      |       |       |Flash      |
    |pepperflashplugin-nonfree             |V:1,  |29     |contrib|Player -   |
    |                                      |I:21  |       |       |complemento|
    |                                      |      |       |       |de         |
    |                                      |      |       |       |navegadores|
    |--------------------------------------+------+-------+-------+-----------|
    |                                      |      |       |       |Adaptador  |
    |                                      |      |       |       |de         |
    |                                      |      |       |       |complemento|
    |browser-plugin-freshplayer-pepperflash|I:9   |1135   |contrib|PPAPI      |
    |                                      |      |       |       |NPAPI-host |
    |                                      |      |       |       |para       |
    |                                      |      |       |       |pepperflash|
    +-------------------------------------------------------------------------+


    Dica

    Apesar do uso dos pacotes Debian em cima ser mais fácil, os
    plugins do navegador podem ainda ser adicionados manualmente ao
    instalar os "*.so" nos diretórios de plugins (ex. "/usr/lib/
    iceweasel/plugins/") e a reiniciar os navegadores.

    Alguns sites web recusam a ligação de acordo com a string
    user-agent do seu navegador. Pode contornar esta situação ao
    enganar a string user-agent. Por exemplo, pode fazê-lo ao
    adicionar a seguinte linha em ficheiros de configuração do
    utilizador como o "~/.gnome2/epiphany/mozilla/epiphany/user.js"
    ou "~/.mozilla/firefox/*.default/user.js".

    user_pref{"general.useragent.override","Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0)"};

    Alternativamente, pode adicionar ou reiniciar esta variável ao
    escrever "about:config" no URL e clicar com o botão direito no
    conteúdo mostrado.

    Cuidado
   
    Uma string user-agent enganada pode causar maus efeitos
    colaterais com Java.

%

6.2. O sistema de correio electrónico (mail)

    Cuidado

    Se estiver a configurar um servidor de mail para trocar mail
    directamente com a Internet, deverá fazer melhor do que ler esta
    documentação elementar.

    O sistema de mail invoca muitos programas servidores e muitos
    programas clientes a correr um várias máquinas. Relativamente às
    funcionalidades, existem 3 tipos de programas agentes de mail:

      * O agente de transporte de correio (MTA, veja Secção 6.3,
        “Agente de transporte de mail (MTA)”) é um programa para
        transferir mails entre máquinas diferentes.

      * O agente de entrega de correio (MDA, veja Secção 6.6, “Agente
        de entrega de mail (MDA) com filtro”) é um programa para
        entregar as mensagens às caixas de correio dos utilizadores
        dentro de uma máquina.

      * O agente de utilizador der correio (MUA, também conhecido
        como cliente de email, veja Secção 6.4, “Agente utilizador de
        mail (MUA)”) é um programa para gerar mensagens a para aceder
        a mensagens entregues.

    Nota

    Os exemplos seguintes de configuração são válidos apenas para a
    estação de trabalho móvel típica em ligações de consumidor de
    Internet.

%

6.2.1. Noções básicas de mail

    Uma mensagem de email consiste em três componentes, o envelope da
    mensagem, o cabeçalho da mensagem e o corpo da mensagem.

    A informação "To" e "From" no envelope da mensagem é utilizada
    pelo SMTP para entregar o email. (A informação de "From" no
    envelope da mensagem também é chamada de endereço bounce, From_,
    etc.).

    A informação "To" e "From" no cabeçalho da mensagem é mostrada
    pelo cliente de email. (Embora seja vulgar que sejam os mesmo do
    envelope da mensagem nem sempre é o caso.)

    O cliente de email) (MUA) necessita interpretar os cabeçalhos da
    mensagem e dados do corpo a utilizar Multipurpose Internet Mail
    Extensions (MIME) para lidar com o tipo de dados e codificação do
    conteúdo.

%

6.2.2. Bases dos serviços de mail modernos

    De modo a minimizar a exposição aos problemas do spam (correio
    não desejado nem solicitado), muitos ISPs que disponibilizam as
    ligações à Internet dos consumidores, estão a implementar
    contra-medidas.

      * O serviço smarthost para os clientes deles enviarem mensagens
        utiliza o porto submissão de mensagem (587) especificado no
        rfc4409 com a palavra-passe (serviço SMTP AUTH) especificada
        no rfc4954.

      * As ligações SMTP no porto 25 a partir das suas máquinas de
        rede internas (excepto o servidor de saída de mail do próprio
        ISP) para a Internet estão bloqueadas.

      * As ligações SMTP pelo porto 25 ao servidor de mail do ISP a
        partir de algumas máquinas de redes externas suspeitas estão
        bloqueadas. (As ligações a partir de máquinas na gama de
        endereços IP dinâmicos usados pelo dial-up e outras ligações
        de consumidores de Internet são as primeiras a serem
        bloqueadas.)

      * Técnicas Anti-spam tais como DomainKeys Identified Mail
        (DKIM), Sender_Policy_Framework (SPF) e Domain-based Message
        Authentication, Reporting and Conformance (DMARC) são muito
        usadas para a filtragem de email.

      * O serviço DomainKeys Identified Mail pode ser disponibilizado
        para o email que envia através do smarthost.

      * O smarthost pode re-escrever o endereço de email fonte para a
        sua conta de mail no smarthost.

    Quando configurar o seu sistema de mail ou resolver problemas de
    entrega de mail, deve considerar estas novas limitações.

    Cuidado

    Não é realista correr um servidor SMTP numa rede de ligação
    doméstica para enviar mail directamente para a máquina remota de
    forma confiável.

    Cuidado

    Não é realista para a confiança da máquina remota, esperar que um
    único smarthost envie mails com um endereço de mail fonte não
    relacionado.

    Cuidado

    Um mail pode ser rejeitado em silêncio por qualquer máquina na
    rota ao destino. Tornar o seu mail com a aparência mais autêntica
    possível é a única forma de enviar um mail para a confiança da
    máquina remota.

    À luz destas situações e limitações hostis da Internet, alguns
    ISPs de mail de Internet independentes tais como o Yahoo.com e
    Gmail.com oferecem o serviço de mail seguro que pode ser acedido
    a partir de qualquer lugar na Internet a usar o Transport Layer
    Security (TLS) e o antecessor dele, Secure Sockets Layer (SSL).

      * O serviço smarthost no porto 465 com o protocolo depreciado
        SMTP sobre SSL (SMTPS).

      * O serviço de smarthost no porto 587 com STARTTLS.

      * O mail de chegada está acessível no porto 995 TLS/POP3 com
        POP3.

    Para simplificar, assumo que o smarthost está localizado em
    "smtp.nomemaquina.dom", necessita de Autenticação SMTP e utiliza
    o porto para submissão de mensagens (587) com STARTTLS no texto
    seguinte.

%

6.2.3. A estratégia de configuração de mail para estação de trabalho

    A configuração de mail mais simples é aquela onde o mail é
    enviado para o smarthost do ISP e recebido do servidor POP3 do
    ISP pelo próprio MUA (veja Secção 6.4, “Agente utilizador de mail
    (MUA)”). Este tipo de configuração é popular com MUA baseado em
    GUIs cheios de funcionalidades como o icedove(1), evolution(1),
    etc. Se necessitar filtrar o mail pelos tipos dele, usa a função
    de filtragem do MUA. Para este caso, o MTA local (veja
    Secção 6.3, “Agente de transporte de mail (MTA)”) precisa apenas
    de fazer entregas locais (quando o remetente e o destinatário
    estão na mesma máquina.

    Por favor note que o sistema Debian é um sistema
    multi-utilizador. Mesmo que seja o único utilizador, existem
    muitos programas que correm como root e eles podem enviar-lhe um
    mail.

    A configuração de mail alternativa é onde o mail é enviado via
    MTA local para o smarthost do ISP e recebido do POP3 do ISP
    através de um obtentor de mail (veja Secção 6.5, “O adquiridor de
    mail remoto e utilitário de reencaminhamento”) para a mailbox
    local. Se necessitar filtrar o mail pelos seus tipos, utilize o
    MDA com filtro (veja Secção 6.6, “Agente de entrega de mail (MDA)
    com filtro”) para filtrar o mail em caixas separadas. Este tipo
    de configuração é popular com MUAs baseadas em consola simples
    como mutt(1), mew(1), etc., apesar de ser possível com qualquer
    MUA (veja Secção 6.4, “Agente utilizador de mail (MUA)”). Para
    este caso, o MTA local (veja Secção 6.3, “Agente de transporte de
    mail (MTA)”) precisa de fazer a entrega ao smarthost e a entrega
    local. Como as estações de trabalho móveis não têm um FQDN
    válido, terá de configurar o MTA local para esconder e enganar o
    nome de mail local real no mail de saída para evitar erros de
    entrega de mail (veja Secção 6.3.3, “A configuração do endereço
    de mail”).

    Dica

    Poderá desejar configurar o MUA/MDA para utilizar Maildir para
    armazenar as mensagens de email algures sob o seu diretório
    pessoal.

%

6.3. Agente de transporte de mail (MTA)

    Para uma estação de trabalho normal, a escolha popular para
    Agente de Transporte de Mail (MTA) é ou o pacote exim4-* ou o
    postfix. A escolha é a sua.

    Tabela 6.3. Lista de pacotes básicos relacionados com agente de
    transporte de mail para estação de trabalho

    +---------------------------------------------------------------+
    |      pacote      |popcon|tamanho|          descrição          |
    |------------------+------+-------+-----------------------------|
    |                  |V:342,|       |Agente de transporte de mail |
    |exim4-daemon-light|I:367 |1493   |Exim4 (MTA: predefinido em   |
    |                  |      |       |Debian)                      |
    |------------------+------+-------+-----------------------------|
    |exim4-base        |V:349,|1704   |Documentação do Exim4 (texto)|
    |                  |I:377 |       |e ficheiros comuns           |
    |------------------+------+-------+-----------------------------|
    |exim4-doc-html    |I:1   |3662   |Documentação do Exim4 (html) |
    |------------------+------+-------+-----------------------------|
    |exim4-doc-info    |I:1   |624    |Documentação do Exim4 (info) |
    |------------------+------+-------+-----------------------------|
    |postfix           |V:145,|4182   |Agente de transporte de mail |
    |                  |I:160 |       |Postfix (MTA: alternativo)   |
    |------------------+------+-------+-----------------------------|
    |postfix-doc       |I:9   |4444   |Documentação do Postfix      |
    |                  |      |       |(html+texto)                 |
    |------------------+------+-------+-----------------------------|
    |                  |V:5,  |       |Implementação Cyrus SASL API |
    |sasl2-bin         |I:19  |428    |(postfix suplementar para    |
    |                  |      |       |SMTP AUTH)                   |
    |------------------+------+-------+-----------------------------|
    |cyrus-sasl2-doc   |I:1   |575    |Cyrus SASL - documentação    |
    +---------------------------------------------------------------+


    Apesar da contagem de votos do popcon do exim4-* parecer ser
    várias vezes mais popular que a do postfix, isto não quer dizer
    que o postfix não seja popular entre os programadores de Debian.
    O sistema de servidor Debian utiliza ambos, exim4 e postfix. A
    análise dos cabeçalhos de mail dos envios para a lista de mail
    dos programadores proeminentes de Debian também indica que ambos
    os MTAs são populares.

    Os pacotes exim4-* são conhecidos por terem um pequeno consumo de
    memória e serem muito flexíveis na configuração deles. O pacote
    postfix é conhecido por ser compacto, rápido, simples e seguro.
    Ambos vêm com ampla documentação e são bons em qualidade e
    licença.

    Existem muitas escolhas para pacotes de agente de transporte de
    mail (MTA) com capacidades e objetivos diferentes no arquivo
    Debian.

    Tabela 6.4. Lista de escolhas para pacotes de agente de
    transporte de mail (MTA) no arquivo Debian

    +---------------------------------------------------------------+
    |      pacote      |popcon|tamanho|    capacidade e focagem     |
    |------------------+------+-------+-----------------------------|
    |exim4-daemon-light|V:342,|1493   |completo                     |
    |                  |I:367 |       |                             |
    |------------------+------+-------+-----------------------------|
    |postfix           |V:145,|4182   |completo (segurança)         |
    |                  |I:160 |       |                             |
    |------------------+------+-------+-----------------------------|
    |exim4-daemon-heavy|V:7,  |1643   |completo (flexibilidade)     |
    |                  |I:8   |       |                             |
    |------------------+------+-------+-----------------------------|
    |sendmail-bin      |V:14, |1854   |completo (apenas se já       |
    |                  |I:15  |       |conhece)                     |
    |------------------+------+-------+-----------------------------|
    |nullmailer        |V:7,  |479    |reduzido, nenhum mail local  |
    |                  |I:10  |       |                             |
    |------------------+------+-------+-----------------------------|
    |ssmtp             |V:8,  |2      |reduzido, nenhum mail local  |
    |                  |I:11  |       |                             |
    |------------------+------+-------+-----------------------------|
    |courier-mta       |V:0,  |2416   |muito completo (interface    |
    |                  |I:0   |       |web, etc.)                   |
    |------------------+------+-------+-----------------------------|
    |masqmail          |V:0,  |337    |leve                         |
    |                  |I:0   |       |                             |
    |------------------+------+-------+-----------------------------|
    |esmtp             |V:0,  |128    |leve                         |
    |                  |I:0   |       |                             |
    |------------------+------+-------+-----------------------------|
    |                  |V:0,  |       |leve (extensão de            |
    |esmtp-run         |I:0   |32     |compatibilidade do sendmail  |
    |                  |      |       |para esmtp)                  |
    |------------------+------+-------+-----------------------------|
    |msmtp             |V:5,  |547    |leve                         |
    |                  |I:10  |       |                             |
    |------------------+------+-------+-----------------------------|
    |                  |V:3,  |       |leve (extensão de            |
    |msmtp-mta         |I:4   |86     |compatibilidade do sendmail  |
    |                  |      |       |para msmtp)                  |
    +---------------------------------------------------------------+


%

6.3.1. A configuração do exim4

    Cuidado

    Configurar o exim4 para enviar o mail de Internet via múltiplos
    smarthosts correspondentes para múltiplos endereços de email
    fonte não é trivial. Por favor defina o exim4 apenas para um
    único endereço de email para os programas do sistema tais como o
    popcon e o cron e defina o msmtp para múltiplos endereços de
    email fonte para os programas do utilizador como o mutt.

    Para mail de Internet através de smarthost, (re)configura o
    pacote exim4-* conforme o seguinte:

    $ sudo /etc/init.d/exim4 stop
    $ sudo dpkg-reconfigure exim4-config

    Escolha "mail enviado por smarthost; recebido via SMTP ou
    fetchmail" para "Configuração geral do tipo de mail".

    Defina "nome de mail do sistema:" para a predefinição dele como o
    FQDN (veja Secção 5.1.1, “A resolução de nome de máquina”).

    Defina "Endereço IP onde escutar ligações SMTP recebidas:" à
    predefinição dele como "127.0.0.1 ; ::1".

    Desconfigure o conteúdo de "Outros destinos para o qual o mail é
    aceite:".

    Desconfigure o conteúdo de "Máquinas para retransmitir mail
    para:".

    Defina "Endereço IP ou nome de máquina do smarthost de envio:"
    para "smtp.nome-de-máquina.domínio:587".

    Escolha "<Não>" para "Esconder o nome de mail local para o mail
    enviado?". (Em vez disso, use "/etc/email-addresses" como em
    Secção 6.3.3, “A configuração do endereço de mail”.)

    Responda a "Mínimizar a quantidade de consultas DNS
    (Chamar-a-Pedido)?" como uma das seguintes.

      * "Não" se o sistema estiver ligado à Internet enquanto
        arranca.
   
      * "Sim" se o sistema não está ligado à Internet enquanto
        arranca.

    Defina o "Método de entrega para mail local:" para "formato mbox
    em /var/mail".

    Seleccione "<Sim>" para "Dividir configuração em pequenos
    ficheiros?:".

    Crie entradas de palavra-passe para o smarthost ao editar "/etc/
    exim4/passwd.client".

    $ sudo vim /etc/exim4/passwd.client
     ...
    $ cat /etc/exim4/passwd.client
    ^smtp.*\.nome_de_máquina\.domínio:nome_do_usador@nome_da_máquina.domínio:palavra-passe

    Inicie o exim4 com o seguinte.

    $ sudo /etc/init.d/exim4 start

    o nome de máquina em "/etc/exim4/passwd.client" não deve ser o
    alias. Verifique o nome real da máquina com o seguinte.

    $ host smtp.hostname.dom
    smtp.hostname.dom é um alias para smtp99.hostname.dom.
    smtp99.hostname.dom possui o endereço 123.234.123.89

    Utilizo expressões regulares em "/etc/exim4/passwd.client" para
    contornar o problema do alias. Provavelmente o SMTP AUTH funciona
    mesmo que o ISP mova a máquina apontada pelo alias.

    Pode atualizar manualmente a configuração do exim4 com o
    seguinte:

      * atualizar os ficheiros de configuração do "exim4" em "/etc/
        exim4/".

          + criar "/etc/exim4/exim4.conf.localmacros" para definir
            MACROs e editar "/etc/exim4/exim4.conf.template".
            (configuração não-dividida)

          + criar novos ficheiros ou editar ficheiros existentes nos
            sub-diretórios "/etc/exim4/exim4.conf.d". (configuração
            dividida)

      * Correr "invoke-rc.d exim4 reload".

    Por favor leia o guia oficial em "/usr/share/doc/exim4-base/
    README.Debian.gz" e update-exim4.conf(8).

    Cuidado

    O arranque do exim4 demora muito tempo se foi escolhido "Não"
    (valor predefinido) na pergunta debconf de "Manter a quantidade
    de consultas DNS no mínimo (Chamar-a-pedido)?" e o sistema não
    estiver ligado à Internet durante o arranque.

    Atenção
   
    É inseguro utilizar palavras-passe em texto simples sem
    encriptação mesmo que o seu ISP o permita.

    Dica

    Embora seja recomendado a utilização de SMTP com STARTTLS no
    porto 587, alguns ISPs ainda utilizam o depreciado SMTPS (SSL no
    porto 465). O exim4 após a versão 4.77 suporta o protocolo
    depreciado SMTPS quer para cliente quer para servidor.

    Dica

    Se está à procura de um MTA leve que respeite "/etc/aliases" para
    o seu PC portátil, deve considerar configurar o exim4(8) com
    "QUEUERUNNER='queueonly'", "QUEUERUNNER='nodaemon'", etc. em "/
    etc/default/exim4".

%

6.3.2. A configuração do postfix com SASL

    Para o mail de Internet através de smarthost, deve primeiro ler a
    documentação do postfix e páginas chave do manual.

    Tabela 6.5. Lista dos manuais importantes do postfix

    +------------------------------------------------------------+
    |  comando   |                    função                     |
    |------------+-----------------------------------------------|
    |postfix(1)  |Programa de controlo do postfix                |
    |------------+-----------------------------------------------|
    |postconf(1) |Utilitário de configuração do postfix          |
    |------------+-----------------------------------------------|
    |postconf(5) |Parâmetros de configuração do postfix          |
    |------------+-----------------------------------------------|
    |postmap(1)  |Manutenção da tabela de buscas do Postfix      |
    |------------+-----------------------------------------------|
    |postalias(1)|Manutenção da base de dados de alias do Postfix|
    +------------------------------------------------------------+


    (Re)configurar os pacotes postfix e sasl2-bin como a seguir.

    $ sudo /etc/init.d/postfix stop
    $ sudo dpkg-reconfigure postfix

    Escolha "Internet com smarthost".

    Defina "SMTP relay host (em branco para nenhum):" para "
    [smtp.hostname.dom]:587" e configure-o como o seguinte.

    $ sudo postconf -e 'smtp_sender_dependent_authentication = yes'
    $ sudo postconf -e 'smtp_sasl_auth_enable = yes'
    $ sudo postconf -e 'smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd'
    $ sudo postconf -e 'smtp_sasl_type = cyrus'
    $ sudo vim /etc/postfix/sasl_passwd

    Crie entradas de palavra-passe para o smarthost.

    $ cat /etc/postfix/sasl_passwd
    [smtp.hostname.dom]:587     nome_utilizador:palavra_passe
    $ sudo postmap hush:/etc/postfix/sasl_passwd

    Arranque o postfix com o seguinte.

    $ sudo /etc/init.d/postfix start

    Aqui o uso de "[" e "]" no diálogo do dpkg-reconfigure e "/etc/
    postfix/sasl_passwd" assegura que não se verifica o registo MX
    mas usa directamente o nome de máquina exacto especificado. Veja
    "ativar autenticação SASL no cliente SMTP do Postfix" em "/usr/
    share/doc/postfix/html/SASL_README.html".

%

6.3.3. A configuração do endereço de mail

    Existem alguns ficheiros de configuração de endereços de mail
    para transporte, entrega e agentes de utilizador de mail.

    Tabela 6.6. Lista de ficheiros de configuração relacionados com
    endereços de mail

    +---------------------------------------------------------------+
    |   ficheiro    |    função     |           aplicação           |
    |---------------+---------------+-------------------------------|
    |               |nome de máquina|                               |
    |/etc/mailname  |predefinido    |Específico de Debian, mailname |
    |               |para mail      |(5)                            |
    |               |(saída)        |                               |
    |---------------+---------------+-------------------------------|
    |/etc/          |nome de máquina|ficheiros_de_configuração-exim4|
    |email-addresses|para enganar o |(5) específicos do exim(8)     |
    |               |mail de saída  |                               |
    |---------------+---------------+-------------------------------|
    |/etc/postfix/  |nome de máquina|específico do postfix(1),      |
    |generic        |para enganar o |activado após a execução do    |
    |               |mail de saída  |comando postmap(1).            |
    |---------------+---------------+-------------------------------|
    |               |alias de nome  |geral, activado após a execução|
    |/etc/aliases   |de conta para  |do comando newaliases(1).      |
    |               |mail recebido  |                               |
    +---------------------------------------------------------------+


    O mailname no ficheiro "/etc/mailname" é normalmente um nome de
    domínio totalmente qualificado (FQDN) que resolve para um dos
    endereços IP do anfitrião. Para a estação de trabalho móvel que
    não tem um nome de máquina com endereço IP resolvível, regule
    este mailname para o valor de "hostname -f". (Esta é uma escolha
    segura e funciona para ambos exim4-* e postfix.)

    Dica

    O conteúdo de "/etc/mailname" é utilizado por muitos programas
    não-MTA para o comportamento predefinido dele. Para o mutt,
    defina as variáveis "hostname" e "from" no ficheiro ~/muttrc para
    sobrepor o valor mailname. Para programas no pacote devscripts,
    como o bts(1) e dch(1), exporte as variáveis de ambiente
    "$DEBFULLNAME" e "$DEBEMAIL" para o sobrepor.

    Dica

    O pacote popularity-contest normalmente envia mail a partir da
    conta de root com FQDN. Tem de definir MAILFROM em /etc/
    popularity-contest.conf como descrito no ficheiro /usr/share/
    popularity-contest/default.conf. Caso contrário, o seu mail será
    rejeitado pelo servidor SMTP do smarthost. Apesar de isto ser um
    tédio, esta aproximação é mais segura do que reescrever o
    endereço fonte para todos os mails do root pelo MTA e deve ser
    usado para outros daemons e scripts do cron.

    Ao definir o mailname para "hostname -f", o spoofing do endereço
    de mail da fonte via MTA pode ser realizado com o seguinte.

      * ficheiro "/etc/email-addresses" para exim4(8) conforme é
        explicado em exim4-config_files(5)
   
      * ficheiro "/etc/postfix/generic" para postfix(1) conforme é
        explicado em generic(5)

    Para o postfix, os seguintes passos adicionais são necessários:

    # postmap hash:/etc/postfix/generic
    # postconf -e 'smtp_generic_maps = hash:/etc/postfix/generic'
    # postfix reload

    Pode testar a configuração do endereço de email a usar o
    seguinte:

      * exim(8) com as opções -brw, -bf, -bF, -bV, …
   
      * postmap(1) com a opção -q.

    Dica

    O exim vem com vários programas utilitários como o exiqgrep(8) e 
    exipick(8). Veja "dpkg -L exim4-base|grep man8/" para os comandos
    disponíveis.

%

6.3.4. Operações MTA básicas

    Existem várias operações MTA básicas. Algumas podem ser
    executadas através do interface de compatibilidade do sendmail(1)
    .

    Tabela 6.7. Lista de operações MTA básicas

    +---------------------------------------------------------------+
    | comando  | comando postfix  |            descrição            |
    |   exim   |                  |                                 |
    |----------+------------------+---------------------------------|
    |sendmail  |sendmail          |lê mails da entrada standard e   |
    |          |                  |prepara a entrega (-bm)          |
    |----------+------------------+---------------------------------|
    |          |                  |lista a lista de espera de mail  |
    |mailq     |mailq             |com estado e ID de lista de      |
    |          |                  |espera (-bp)                     |
    |----------+------------------+---------------------------------|
    |newaliases|newaliases        |inicializa a base de dados e     |
    |          |                  |alias (-I)                       |
    |----------+------------------+---------------------------------|
    |exim4 -q  |postqueue -f      |enxagua mails em espera (-q)     |
    |----------+------------------+---------------------------------|
    |          |postsuper -r ALL  |                                 |
    |exim4 -qf |deferred;         |enxagua todos mails              |
    |          |postqueue -f      |                                 |
    |----------+------------------+---------------------------------|
    |exim4 -qff|postsuper -r ALL; |enxagua até mails congelados     |
    |          |postqueue -f      |                                 |
    |----------+------------------+---------------------------------|
    |exim4 -Mg |postsuper -h      |congela uma mensagem pelo seu ID |
    |queue_id  |queue_id          |de lista de espera               |
    |----------+------------------+---------------------------------|
    |exim4 -Mrm|postsuper -d      |remove uma mensagem pelo seu ID  |
    |queue_id  |queue_id          |de lista de espera               |
    |----------+------------------+---------------------------------|
    |N/D       |postsuper -d ALL  |remove todas as mensagens        |
    +---------------------------------------------------------------+


    Dica
   
    Poderá ser uma boa ideia enxaguar todos os mails por um script em
    "/etc/ppp/ip-up.d/*".

%

6.4. Agente utilizador de mail (MUA)

    Se subscrever uma lista de mail relacionada com Debian, poderá
    ser boa ideia usar um MUA como o mutt e o mew que são normas de
    facto para o participante e para se saber comportar como se
    espera.

    Tabela 6.8. Lista de agentes utilizador de mail (MUA)

    +---------------------------------------------------------------+
    |  pacote   |popcon|tamanho|                tipo                |
    |-----------+------+-------+------------------------------------|
    |evolution  |V:31, |475    |Programa de GUI X (GNOME3, conjunto |
    |           |I:229 |       |groupware)                          |
    |-----------+------+-------+------------------------------------|
    |thunderbird|V:57, |165180 |Programa de GUI X (GNOME2, sem marca|
    |           |I:138 |       |Mozilla Thunderbird)                |
    |-----------+------+-------+------------------------------------|
    |kmail      |V:34, |18011  |Programa de GUI X (KDE)             |
    |           |I:88  |       |                                    |
    |-----------+------+-------+------------------------------------|
    |mutt       |V:37, |7056   |programa de terminal de caracteres  |
    |           |I:313 |       |provavelmente usado com o vim       |
    |-----------+------+-------+------------------------------------|
    |mew        |V:0,  |2325   |programa de terminal de caracteres  |
    |           |I:0   |       |sob (x)emacs                        |
    +---------------------------------------------------------------+


%

6.4.1. MUA básico — Mutt

    Personalize "~/.muttrc" como a seguir para usar o mutt como
    agente de utilizador de mail (MUA) em combinação com o vim.

    #
    # User configuration file to override /etc/Muttrc
    #
    # spoof source mail address
    set use_from
    set hostname=example.dom
    set from="Name Surname <username@example.dom>"
    set signature="~/.signature"

    # vim: "gq" to reformat quotes
    set editor="vim -c 'set tw=72 et ft=mail'"

    # "mutt" goes to Inbox, while "mutt -y" lists mailboxes
    set mbox_type=Maildir           # use qmail Maildir format for creating mbox
    set mbox=~/Mail                 # keep all mail boxes in $HOME/Mail/
    set spoolfile=+Inbox            # mail delivered to $HOME/Mail/Inbox
    set record=+Outbox              # save fcc mail to $HOME/Mail/Outbox
    set postponed=+Postponed        # keep postponed in $HOME/Mail/postponed
    set move=no                     # do not move Inbox items to mbox
    set quit=ask-yes                # do not quit by "q" only
    set delete=yes                  # always delete w/o asking while exiting
    set fcc_clear                   # store fcc as non encrypted

    # Mailboxes in Maildir (automatic update)
    mailboxes `cd ~/Mail; /bin/ls -1|sed -e 's/^/+/' | tr "\n" " "`
    unmailboxes Maillog *.ev-summary

    ## Default
    #set index_format="%4C %Z %{%b %d} %-15.15L (%4l) %s"
    ## Thread index with senders (collapse)
    set index_format="%4C %Z %{%b %d} %-15.15n %?M?(#%03M)&(%4l)? %s"

    ## Default
    #set folder_format="%2C %t %N %F %2l %-8.8u %-8.8g %8s %d %f"
    ## just folder names
    set folder_format="%2C %t %N %f"

    Adicione o seguinte ao "/etc/mailcap" or "~/.mailcap" para
    mostrar mail em HTML e anexos do MS Word 'inline'.

    text/html; lynx -force_html %s; needsterminal;
    application/msword; /usr/bin/antiword '%s'; copiousoutput; description="Microsoft Word Text"; nametemplate=%s.doc

    Dica

    O Mutt pode ser usado como o cliente IMAP e o conversor de
    formato de mailbox. Pode etiquetar as mensagens com "t", "T",
    etc. Estas mensagens etiquetadas podem ser copiadas com ";C"
    entre diferentes mailboxes e apagadas com ";d" numa acção única.

%

6.4.2. MUA avançado — Mutt + msmtp

    Mutt pode ser configurado para usar endereços de email de
    múltiplas fontes com múltiplos smarthosts correspondentes a usar
    msmtp.

    Dica

    Msmtp é um emulador de envio de mail que permite ser instalado
    juntamente com outro emulador de envio de mail que disponibilize
    o comando /usr/sbin/sendmail. Assim pode deixar o seu mail de
    sistema ser exim4 ou postfix.

    Vamos pensar em suportar 3 endereços de email como um exemplo:

      * "Meu Nome1 <minhaconta1@gmail.com>"

      * "Meu Nome2 <minhaconta2@gmail.com>"

      * "Meu Nome3 <minhaconta3@example.org>"

    Aqui está um exemplo de personalização do ~/.muttrc com suporte a
    3 smarthosts para 3 diferentes endereços de email fonte.

    set use_from
    set from="My Name3 <myaccount3@example.org>"
    set reverse_name
    alternates myaccount1@gmail\.com|myaccount1@gmail\.com|myaccount3@example\.org

    # ...

    # MACRO
    macro compose "1" "<edit-from>^UMy Name1 \<myaccount1@gmail.com\>\n"
    macro compose "2" "<edit-from>^UMy Name2 \<myaccount2@gmail.com\>\n"
    macro compose "3" "<edit-from>^UMy Name3 \<myaccount3@example.org\>\n"

    send2-hook '~f myaccount1@gmail.com' "set sendmail = '/usr/bin/msmtp --read-envelope-from'"
    send2-hook '~f myaccount2@gmail.com' "set sendmail = '/usr/bin/msmtp --read-envelope-from'"
    send2-hook '~f myaccount3@example.org' "set sendmail = '/usr/bin/msmtp --read-envelope-from'"

    # ...

    Vamos instalar o msmtp-gnome e definir ~/.msmtprc como a seguir:

    defaults
    logfile ~/.msmtp.log
    domain myhostname.example.org
    tls on
    tls_starttls on
    tls_certcheck on
    tls_trust_file /etc/ssl/certs/ca-certificates.crt
    auth on
    port 587
    auto_from

    account myaccount1@gmail.com
    host smtp.gmail.com
    from  myaccount1@gmail.com
    user  myaccount1@gmail.com

    account myaccount2@gmail.com
    host smtp.gmail.com
    from  myaccount2@gmail.com
    user  myaccount2@gmail.com

    account myaccount3@example.org
    host mail.example.org
    from  myaccount3@example.org
    user  myaccount3@example.org

    account default : myaccount3@example.org

    Depois, adicione os dados da palavra-passe ao chaveiro do Gnome.
    Por exemplo:

     $ secret-tool store --label=msmtp \
         host smtp.gmail.com \
         service smtp \
         user myaccount1@gmail.com
     ...

    Dica

    Se não desejar usar o chaveiro do Gnome, em vez deste pode
    instalar o pacote msmtp e adicionar uma entrada tal como password
    secret123" a cada conta em ~/.msmtprc. Veja documentação do memtp
    para mais detalhes.

%

6.5. O adquiridor de mail remoto e utilitário de reencaminhamento

    Em vez de correr um MUA para aceder remotamente a mails e os
    processar manualmente, pode automatizar tal processo para ter
    todos os mails entregues na máquina local. O recuperador de mail
    remoto e utilitário de reencaminhamento é a ferramenta para si.

    Apesar do fetchmail(1) ter sido o standard de facto para
    adquiridor de mail remoto em GNU/Linux, o autor agora gosta do 
    getmail(1). Sedeseja rejeitar mail antes de o descarregar para
    poupar largura de banda, o mailfilter ou o mpop podem ser úteis.
    Independentemente de quais utilitários de adquirir mails sejam
    usados, é uma boa ideia configurar o sistema para entregar os
    mails adquiridos a um MDA, como o maildrop, via pipe.

    Tabela 6.9. Lista de adquiridores de mail remoto e utilitários de
    reencaminhamento

    +---------------------------------------------------------------+
    |  pacote  |popcon|tamanho|              descrição              |
    |----------+------+-------+-------------------------------------|
    |fetchmail |V:5,  |814    |adquiridor de mail (POP3, APOP, IMAP)|
    |          |I:17  |       |(antigo)                             |
    |----------+------+-------+-------------------------------------|
    |          |V:1,  |       |adquiridor de mail (POP3, IMAP4 e    |
    |getmail   |I:6   |30     |SDPS) (simples, seguro e de          |
    |          |      |       |confiança)                           |
    |----------+------+-------+-------------------------------------|
    |          |V:0,  |       |adquiridor de mail (POP3) com        |
    |mailfilter|I:0   |291    |capacidade de filtragem por          |
    |          |      |       |expressões regulares                 |
    |----------+------+-------+-------------------------------------|
    |mpop      |V:0,  |400    |adquiridor de mail (POP3) e MDA com  |
    |          |I:0   |       |capacidade de filtragem              |
    +---------------------------------------------------------------+


%

6.5.1. configuração do getmail

    A configuração do getmail(1) está descrita em documentação do
    getmail.Aqui estão as minhas definições para aceder a múltiplas
    contas POP3 como utilizador.

    Crie "/usr/local/bin/getmails" como o seguinte.

    #!/bin/sh
    set -e
    if [ -f $HOME/.getmail/running ]; then
      echo "getmail já está a correr ... (se não, remova $HOME/.getmail/running)" >&2
      pgrep -l "getmai[l]"
      exit 1
    else
      echo "getmail não está a correr ... " >&2
    fi
    if [ -f $HOME/.getmail/stop ]; then
      echo "não correr o getmail ... (se não, remova $HOME/.getmail/stop)" >&2
      exit
    fi
    if [ "x$1" = "x-l" ]; then
      exit
    fi
    rcfiles="/usr/bin/getmail"
    for file in $HOME/.getmail/config/* ; do
      rcfiles="$rcfiles --rcfile $file"
    done
    date -u > $HOME/.getmail/running
    eval "$rcfiles $@"
    rm $HOME/.getmail/running

    Configure-o como o seguinte.

    $ sudo chmod 755 /usr/local/bin/getmails
    $ mkdir -m 0700 $HOME/.getmail
    $ mkdir -m 0700 $HOME/.getmail/config
    $ mkdir -m 0700 $HOME/.getmail/log

    Crie ficheiros de configuração "$HOME/.getmail/config/pop3_name"
    para cada conta POP3 como o seguinte.

    [retriever]
    type = SimplePOP3SSLRetriever
    server = pop.exemplo.com
    username =  nome_pop3@exemplo.com
    password = <sua-palavra-passe>

    [destination]
    type = MDA_external
    path = /usr/bin/maildrop
    unixfrom = True

    [options]
    verbose = 0
    delete = True
    delivered_to = False
    message_log = ~/.getmail/log/pop3_name.log

    Configure-o como o seguinte.

    $ chmod 0600 $HOME/.getmail/config/*

    Agenda o "/usr/local/bin/getmails" para correr a cada 15 minutos
    com o cron(8) ao executar "sudo crontab -e -u
    <nome_de_utilizador>" e a adicionar o seguinte à entrada cron do
    utilizador.

    5,20,35,50 * * * * /usr/local/bin/getmails --quiet

    Dica

    Os problemas do acesso POP3 podem não vir do getmail. Alguns
    serviços populares POP3 livres podem estar a violar o protocolo
    POP3 e o filtro de SPAM deles pode não ser perfeito. Por exemplo,
    pode estar a apagar as mensagens logo após receber o comando RETR
    antes de receber o comando DELE e pode pôr mensagens em
    quarentena na caixa do Spam. Deve minimizar os danos ao
    configura-los para arquivar as mensagens acedidas e não as
    apagar. Veja também "Algum mail não foi descarregado".

%

6.5.2. configuração do fetchmail

    A configuração do fetchmail(1) é definida por "/etc/default/
    fetchmail", "/etc/fetchmailrc" e "$HOME/.fetchmailrc". Veja o
    exemplo dele em "/usr/share/doc/fetchmail/examples/
    fetchmailrc.example".

%

6.6. Agente de entrega de mail (MDA) com filtro

    A maioria dos programas MTA, como o postfix e exim4, funcionam
    como MDA (mail delivery agent). São MDAs especializados com
    capacidades de filtragem.

    Apesar do procmail(1) ter sido o standard de facto para MDA com
    filtro em GNU/Linux, o autor agora gosta do maildrop(1). Seja
    quais os utilitários de filtragem usados, é uma boa ideia
    configurar o sistema para entregar os mails filtrados a uma
    Maildir de estilo qmail.

    Tabela 6.10. Lista de MDA com filtro

    +---------------------------------------------------------------+
    | pacote  | popcon  |tamanho|             descrição             |
    |---------+---------+-------+-----------------------------------|
    |procmail |V:40,    |300    |MDA com filtro (antigo)            |
    |         |I:277    |       |                                   |
    |---------+---------+-------+-----------------------------------|
    |mailagent|V:0, I:5 |1356   |MDA com filtro Perl                |
    |---------+---------+-------+-----------------------------------|
    |maildrop |V:0, I:2 |1141   |MDA com linguagem de filtragem     |
    |         |         |       |estruturada                        |
    +---------------------------------------------------------------+


%

6.6.1. configuração do maildrop

    A configuração do maildrop(1) está descrita em documentação do
    maildropfilter. Aqui está um exemplo de configuração para "$HOME
    /.mailfilter".

    # Local configuration
    MAILROOT="$HOME/Mail"
    # set this to /etc/mailname contents
    MAILHOST="example.dom"
    logfile $HOME/.maildroplog

    # rules are made to override the earlier value by the later one.

    # mailing list mails ?
    if (     /^Precedence:.*list/:h || /^Precedence:.*bulk/:h )
    {
        # rules for mailing list mails
        # default mailbox for mails from mailing list
        MAILBOX="Inbox-list"
        # default mailbox for mails from debian.org
        if ( /^(Sender|Resent-From|Resent-Sender): .*debian.org/:h )
        {
            MAILBOX="service.debian.org"
        }
        # default mailbox for mails from bugs.debian.org (BTS)
        if ( /^(Sender|Resent-From|Resent-sender): .*@bugs.debian.org/:h )
        {
            MAILBOX="bugs.debian.org"
        }
        # mailbox for each properly maintained mailing list with "List-Id: foo" or "List-Id: ...<foo.bar>"
        if ( /^List-Id: ([^<]*<)?([^<>]*)>?/:h )
        {
            MAILBOX="$MATCH2"
        }
    }
    else
    {
        # rules for non-mailing list mails
        # default incoming box
        MAILBOX="Inbox-unusual"
        # local mails
        if ( /Envelope-to: .*@$MAILHOST/:h )
        {
            MAILBOX="Inbox-local"
        }
        # html mails (99% spams)
        if ( /DOCTYPE html/:b ||\
             /^Content-Type: text\/html/ )
        {
            MAILBOX="Inbox-html"
        }
        # blacklist rule for spams
        if ( /^X-Advertisement/:h ||\
             /^Subject:.*BUSINESS PROPOSAL/:h ||\
             /^Subject:.*URGENT.*ASISSTANCE/:h ||\
             /^Subject: *I NEED YOUR ASSISTANCE/:h )
        {
            MAILBOX="Inbox-trash"
        }
        # whitelist rule for normal mails
        if ( /^From: .*@debian.org/:h ||\
             /^(Sender|Resent-From|Resent-Sender): .*debian.org/:h ||\
             /^Subject: .*(debian|bug|PATCH)/:h )
        {
            MAILBOX="Inbox"
        }
        # whiltelist rule for BTS related mails
        if ( /^Subject: .*Bug#.*/:h ||\
             /^(To|Cc): .*@bugs.debian.org/:h )
        {
            MAILBOX="bugs.debian.org"
        }
        # whitelist rule for getmails cron mails
        if ( /^Subject: Cron .*getmails/:h )
        {
            MAILBOX="Inbox-getmails"
        }
    }

    # check existance of $MAILBOX
    `test -d $MAILROOT/$MAILBOX`
    if ( $RETURNCODE == 1 )
    {
        # create maildir mailbox for $MAILBOX
        `maildirmake $MAILROOT/$MAILBOX`
    }
    # deliver to maildir $MAILBOX
    to "$MAILROOT/$MAILBOX/"
    exit

    Atenção

    Ao contrário do procmail, o maildrop não cria automaticamente os
    diretórios maildir em falta. Tem de os criar manualmente com
    antecedência a usar o maildirmake(1) como no exemplo "$HOME
    /.mailfilter".

%

6.6.2. configuração do procmail

    Aqui está uma configuração semelhante com "$HOME/.procmailrc"
    para procmail(1).

    MAILDIR=$HOME/Maildir
    DEFAULT=$MAILDIR/Inbox/
    LOGFILE=$MAILDIR/Maillog
    # sem dúvida mails com mau aspeto: despeja-os no lixo e termina
    :0
    * 1^0 ^X-Advertisement
    * 1^0 ^Subject:.*BUSINESS PROPOSAL
    * 1^0 ^Subject:.*URGENT.*ASISSTANCE
    * 1^0 ^Subject: *I NEED YOUR ASSISTANCE
    X-trash/

    # Entrega de mensagens da lista de mail
    :0
    * 1^0 ^Precedence:.*list
    * 1^0 ^Precedence:.*bulk
    * 1^0 ^List-
    * 1^0 ^X-Distribution:.*bulk
    {
    :0
    * 1^0 ^Return-path:.*debian-devel-admin@debian.or.jp
    jp-debian-devel/

    :0
    * ^Resent-Sender.*debian-user-request@lists.debian.org
    debian-user/

    :0
    * ^Resent-Sender.*debian-devel-request@lists.debian.org
    debian-devel/

    :0
    * ^Resent-Sender.*debian-announce-request@lists.debian.org
    debian-announce

    :0
    mailing-list/
    }

    :0
    Inbox/

%

6.6.3. Re-entregar o conteúdo da mbox

    Precisa de entregar manualmente os mails às caixas de correio
    organizadas no seu diretório home a partir de "/var/mail/
    <nome_de_utilizador>" se o seu diretório home ficar cheio e o 
    procmail(1) falhar. Após regular o espaço do disco no diretório
    home, corra o seguinte.

    # /etc/init.d/${MAILDAEMON} stop
    # formail -s procmail </var/mail/<nome_de_utilizador>
    # /etc/init.d/${MAILDAEMON} start

%

6.7. Servidor POP3/IMAP4

    Se vai executar um servidor privado numa LAN, deve considerar
    correr um servidor POP3 / IMAP4 para entregar mail aos clientes
    da LAN.

    Tabela 6.11. Lista de Servidores POP3/IMAP4

    +---------------------------------------------------------------+
    |   pacote   |popcon|tamanho|tipo|          descrição           |
    |------------+------+-------+----+------------------------------|
    |            |V:2,  |       |    |Servidor de mail courier -    |
    |courier-pop |I:2   |308    |POP3|Servidor POP3 (apenas formato |
    |            |      |       |    |maildir)                      |
    |------------+------+-------+----+------------------------------|
    |cyrus-pop3d |V:0,  |160    |POP3|Sistema de mail cyrus (suporte|
    |            |I:0   |       |    |de POP3)                      |
    |------------+------+-------+----+------------------------------|
    |            |V:3,  |       |    |Servidor de mail courier -    |
    |courier-imap|I:4   |589    |IMAP|Servidor IMAP (apenas formato |
    |            |      |       |    |maildir)                      |
    |------------+------+-------+----+------------------------------|
    |cyrus-imapd |V:1,  |484    |IMAP|Sistema de mail cyrus (suporte|
    |            |I:1   |       |    |de IMAP)                      |
    +---------------------------------------------------------------+


%

6.8. O servidor de impressão e utilitários

    In the old Unix-like system, the BSD Line printer daemon (lpd)
    was the standard and the standard print out format of the classic
    free software was PostScript (PS). Some filter system was used
    along with Ghostscript to enable printing to the non-PostScript
    printer. See Secção 11.4.1, “Ghostscript”.

    In the modern Debian system, the Common UNIX Printing System
    (CUPS) is the de facto standard and the standard print out format
    of the modern free software is Portable Document Format (PDF).

    The CUPS uses Internet Printing Protocol (IPP). The IPP is now
    supported by other OSs such as Windows XP and Mac OS X and has
    became new cross-platform de facto standard for remote printing
    with bi-directional communication capability.

    Graças à funcionalidade de auto-conversão dependente do formato
    de ficheiro do sistema CUPS, simplesmente fornecer quaisquer
    dados ao comando lpr deverá gerar a saída de impressão esperada.
    (No CUPS, o lpr pode ser activado ao instalar o pacote cups-bsd.)

    O sistema Debian tem alguns pacotes notáveis para os servidores e
    utilitários de impressão.

    Tabela 6.12. Lista de servidores de impressoras e utilitários

    +---------------------------------------------------------------+
    |         pacote          |popcon|tamanho|  porto   | descrição |
    |-------------------------+------+-------+----------+-----------|
    |                         |      |       |          |BSD lpr/lpd|
    |lpr                      |V:3,  |362    |impressora|(daemon de |
    |                         |I:4   |       |(515)     |impressora |
    |                         |      |       |          |de linha)  |
    |-------------------------+------+-------+----------+-----------|
    |lprng                    |V:1,  |3064   |, ,       |, ,        |
    |                         |I:1   |       |          |(Avançado) |
    |-------------------------+------+-------+----------+-----------|
    |                         |      |       |          |Servidor   |
    |cups                     |V:140,|1141   |IPP (631) |CUPS de    |
    |                         |I:395 |       |          |Impressão  |
    |                         |      |       |          |em Internet|
    |-------------------------+------+-------+----------+-----------|
    |                         |      |       |          |Comandos de|
    |                         |      |       |          |impressão  |
    |                         |      |       |          |do System V|
    |                         |      |       |          |para o     |
    |                         |      |       |          |CUPS: lp(1)|
    |                         |V:56, |       |          |, lpstat(1)|
    |cups-client              |I:454 |493    |, ,       |, lpoptions|
    |                         |      |       |          |(1), cancel|
    |                         |      |       |          |(1), lpmove|
    |                         |      |       |          |(8), lpinfo|
    |                         |      |       |          |(8),       |
    |                         |      |       |          |lpadmin(8),|
    |                         |      |       |          |…          |
    |-------------------------+------+-------+----------+-----------|
    |                         |      |       |          |comandos de|
    |                         |      |       |          |impressão  |
    |                         |V:36, |       |          |BSD para o |
    |cups-bsd                 |I:385 |122    |, ,       |CUPS: lpr  |
    |                         |      |       |          |(1), lpq(1)|
    |                         |      |       |          |, lprm(1), |
    |                         |      |       |          |lpc(8)     |
    |-------------------------+------+-------+----------+-----------|
    |                         |V:100,|       |Não       |Drivers de |
    |printer-driver-gutenprint|I:372 |937    |aplicável |impressoras|
    |                         |      |       |          |para o CUPS|
    +---------------------------------------------------------------+


    Dica
   
    Pode configurar o sistema CUPS ao apontar o seu explorador web
    para "http://localhost:631/" .

%

6.9. O servidor de acesso remoto e utilitários (SSH)

    O Secure SHell (SSH) é o modo seguro de efectuar ligações na
    Internet. Uma versão livre do SSH chamada OpenSSH está disponível
    nos pacotes openssh-client e openssh-server em Debian.

    Tabela 6.13. Lista de servidores de acesso remoto e utilitários

    +-----------------------------------------------------------------------+
    |        pacote        |popcon|tamanho|      ferramenta      |descrição |
    |----------------------+------+-------+----------------------+----------|
    |                      |V:803,|       |                      |Cliente de|
    |openssh-client        |I:996 |4298   |ssh(1)                |shell     |
    |                      |      |       |                      |segura    |
    |----------------------+------+-------+----------------------+----------|
    |                      |V:690,|       |                      |Servidor  |
    |openssh-server        |I:834 |1567   |sshd(8)               |de shell  |
    |                      |      |       |                      |segura    |
    |----------------------+------+-------+----------------------+----------|
    |                      |      |       |                      |pede ao   |
    |                      |      |       |                      |utilizador|
    |ssh-askpass-fullscreen|V:0,  |42     |ssh-askpass-fullscreen|uma frase |
    |                      |I:0   |       |(1)                   |passe para|
    |                      |      |       |                      |ssh-add   |
    |                      |      |       |                      |(GNOME2)  |
    |----------------------+------+-------+----------------------+----------|
    |                      |      |       |                      |pede ao   |
    |                      |      |       |                      |utilizador|
    |ssh-askpass           |V:3,  |106    |ssh-askpass(1)        |uma frase |
    |                      |I:34  |       |                      |passe para|
    |                      |      |       |                      |ssh-add (X|
    |                      |      |       |                      |simples)  |
    +-----------------------------------------------------------------------+


    Cuidado
   
    Veja Secção 4.7.3, “Medidas de segurança extra para a Internet”
    se o seu SSH for acessível a partir da Internet.

    Dica

    Por favor use o programa screen(1) para ativar a sobrevivência do
    processo de shell remota à interrupção da ligação (veja
    Secção 9.1, “O programa screen”).

%

6.9.1. Bases do SSH

    Atenção
   
    o "/etc/ssh/sshd_not_to_be_run" não pode estar presente se
    desejar correr o servidor OpenSSH.

    SSH tem dois protocolos de autenticação.

    Tabela 6.14. Lista de protocolos e métodos de autenticação do SSH

    +---------------------------------------------------------------+
    |Protocolo|           Método SSH            |     descrição     |
    |   SSH   |                                 |                   |
    |---------+---------------------------------+-------------------|
    |         |                                 |autenticação de    |
    |SSH-1    |"RSAAuthentication"              |utilizador baseada |
    |         |                                 |em chave de        |
    |         |                                 |identificação RSA  |
    |---------+---------------------------------+-------------------|
    |         |                                 |autenticação       |
    |         |                                 |baseada em         |
    |, ,      |"RhostsAuthentication"           |".rhosts"          |
    |         |                                 |(insegura,         |
    |         |                                 |desactivada)       |
    |---------+---------------------------------+-------------------|
    |         |                                 |autenticação de    |
    |         |                                 |máquina baseada em |
    |, ,      |"RhostsRSAAuthentication"        |".rhosts" combinada|
    |         |                                 |com chave de       |
    |         |                                 |máquina RSA        |
    |         |                                 |(desactivada)      |
    |---------+---------------------------------+-------------------|
    |         |                                 |autenticação       |
    |, ,      |"ChallengeResponseAuthentication"|challenge-response |
    |         |                                 |RSA                |
    |---------+---------------------------------+-------------------|
    |         |                                 |autenticação       |
    |, ,      |"PasswordAuthentication"         |baseada em         |
    |         |                                 |palavra-passe      |
    |---------+---------------------------------+-------------------|
    |         |                                 |autenticação do    |
    |SSH-2    |"PubkeyAuthentication"           |utilizador baseada |
    |         |                                 |em chave pública   |
    |---------+---------------------------------+-------------------|
    |         |                                 |autenticação de    |
    |         |                                 |máquina baseada em |
    |         |                                 |"~/.rhosts" ou "/  |
    |         |                                 |etc/hosts.equiv"   |
    |, ,      |"HostbasedAuthentication"        |combinada com chave|
    |         |                                 |pública de         |
    |         |                                 |autenticação da    |
    |         |                                 |máquina cliente    |
    |         |                                 |(desactivada)      |
    |---------+---------------------------------+-------------------|
    |, ,      |"ChallengeResponseAuthentication"|autenticação       |
    |         |                                 |challenge-response |
    |---------+---------------------------------+-------------------|
    |         |                                 |autenticação       |
    |, ,      |"PasswordAuthentication"         |baseada em         |
    |         |                                 |palavra-passe      |
    +---------------------------------------------------------------+


    Cuidado
   
    Tenha cuidado com estas diferenças se não estiver a usar um
    sistema Debian.

    Veja "/usr/share/doc/ssh/README.Debian.gz", ssh(1), sshd(8), 
    ssh-agent(1) e ssh-keygen(1) para detalhes.

    Os ficheiros de configuração chave são os seguintes.

    Tabela 6.15. Lista de ficheiros de configuração do SSH

    +---------------------------------------------------------------+
    |  ficheiro de  |     descrição do ficheiro de configuração     |
    | configuração  |                                               |
    |---------------+-----------------------------------------------|
    |/etc/ssh/      |Predefinições do cliente SSH, veja ssh_config  |
    |ssh_config     |(5)                                            |
    |---------------+-----------------------------------------------|
    |/etc/ssh/      |Predefinições do servidor SSH, veja sshd_config|
    |sshd_config    |(5)                                            |
    |---------------+-----------------------------------------------|
    |~/.ssh/        |chaves SSH públicas predefinidas que os        |
    |authorized_keys|clientes usam para ligar a esta conta neste    |
    |               |servidor SSH                                   |
    |---------------+-----------------------------------------------|
    |~/.ssh/identity|chave SSH-1 RSA secreta do utilizador          |
    |---------------+-----------------------------------------------|
    |~/.ssh/id_rsa  |chave SSH-2 RSA secreta do utilizador          |
    |---------------+-----------------------------------------------|
    |~/.ssh/id_dsa  |chave SSH-2 DSA secreta do utilizador          |
    +---------------------------------------------------------------+


    Dica
   
    Veja ssh-keygen(1), ssh-add(1) e ssh-agent(1) para como usar
    chaves SSH secretas e públicas.

    Dica
   
    Certifique-se de verificar as configurações ao testar a ligação.
    Em caso de problemas, use "ssh -v".

    Dica
   
    Pode mudar a frase-passe para encriptar chaves SSH secretas
    locais mais tarde com "ssh-keygen -p".

    Dica

    Pode adicionar opções às entradas em "~/.ssh/authorized_keys"
    para limitar máquinas e correr comandos específicos. Veja sshd(8)
    para mais detalhes.

    O seguinte inicia uma ligação ssh(1) a partir de um cliente.

    Tabela 6.16. Lista de exemplos de arranque do cliente SSH

    +---------------------------------------------------------------+
    |                comando                |       descrição       |
    |---------------------------------------+-----------------------|
    |ssh                                    |ligar com modo         |
    |nome_utilizador@máquina.domínio.externo|predefinido            |
    |---------------------------------------+-----------------------|
    |ssh -v                                 |ligar com modo         |
    |nome_utilizador@máquina.domínio.externo|predefinido com        |
    |                                       |mensagens de depuração |
    |---------------------------------------+-----------------------|
    |ssh -1                                 |força a ligação com SSH|
    |nome_utilizador@máquina.domínio.externo|versão 1               |
    |---------------------------------------+-----------------------|
    |ssh -1 -o RSAAuthentication=no -l      |força o uso de         |
    |nome_utilizador máquina.domínio.externo|palavra-passe com SSH  |
    |                                       |versão 1               |
    |---------------------------------------+-----------------------|
    |ssh -o PreferredAuthentications=       |força o uso de         |
    |password -l nome_utilizador            |palavra-passe com SSH  |
    |máquina.domínio.externo                |versão 2               |
    +---------------------------------------------------------------+


    Se usar o mesmo nome de utilizador nas máquinas local e remota,
    pode eliminar a escrita de "username@". Mesmo que use um nome de
    utilizador diferente nas máquinas local e remota, pode eliminá-lo
    a usar "~/.ssh/config". Para o serviço Debian Salsa com nome de
    conta "foo-guest", regula o "~/.ssh/config" para conter o
    seguinte.

    Host salsa.debian.org people.debian.org
        User foo-guest

    Para o utilizador as funções do ssh(1) são uma telnet(1) mais
    inteligente e segura. Ao contrário do comando telnet, o comando
    ssh não pára no caractere de escape do telnet (predefinição
    inicial CTRL-]).

%

6.9.2. Reencaminhamento de portos para SMTP/POP3 em túnel

    Para estabelecer um pipe para ligação ao porto 25 do servidor
    remoto a partir do porto 4025 da máquina local, e para a porta
    110 do servidor remoto a partir do porto 4110 da máquina local
    através de ssh, execute na máquina local como a seguir.

    # ssh -q -L 4025:remote-server:25 4110:remote-server:110 username@remote-server

    Este é um modo seguro de fazer ligações a servidores SMTP/POP3
    pela Internet. Configure a entrada "AllowTcpForwarding" para
    "yes" em "/etc/ssh/sshd_config" na máquina remota.

%

6.9.3. Ligar sem palavras-passe remotas

    Pode-se evitar ter que se lembrar as palavras passe para sistemas
    remotos ao usar "RSAAuthentication" (protocolo SSH-1) ou
    "PubkeyAuthentication" (protocolo SSH-2).

    No sistema remoto, configure as respectivas entradas,
    "RSAAuthentication yes" ou "PubkeyAuthentication yes", em "/etc/
    ssh/sshd_config".

    Crie chaves de autenticação localmente e instale a chave pública
    no sistema remoto como o seguinte.

      * "RSAAuthentication": chave RSA para SSH-1 (descontinuado
        porque foi substituído.)

    $ ssh-keygen
    $ cat .ssh/identity.pub | ssh utilizador1@remoto "cat - >>.ssh/authorized_keys"

      * "PubkeyAuthentication": chave RSA para SSH-2

    $ ssh-keygen -t rsa
    $ cat .ssh/id_rsa.pub | ssh utilizador1@remoto "cat - >>.ssh/authorized_keys"

      * "PubkeyAuthentication": chave DSA para SSH-2 (descontinuado
        porque é lento.)

    $ ssh-keygen -t dsa
    $ cat .ssh/id_dsa.pub | ssh utilizador1@remoto "cat - >>.ssh/authorized_keys"

    Dica

    O uso de chave DSA para SSH-2 está descontinuado porque a chave é
    pequena e é lento. Não existem mais razões para se contornar a
    patente RSA a usar DSA porque já expirou. DSA significa Digital
    Signature Algorithm e é lento. Veja também DSA-1571-1.

    Nota

    Para que "HostbasedAuthentication" funcione em SSH-2, tem de
    ajustar as definições de "HostbasedAuthentication" para "yes" em
    ambos "/etc/ssh/sshd_config" na máquina servidor e "/etc/ssh/
    ssh_config" ou "~/.ssh/config" na máquina cliente.

%

6.9.4. Lidar com clientes SSH alienígenas

    Existem alguns clientes SSH livres disponíveis para outras
    plataformas.

    Tabela 6.17. Lista de clientes SSH para outras plataformas

    +---------------------------------------------------------------+
    |   ambiente   |             programa de SSH livre              |
    |--------------+------------------------------------------------|
    |Windows       |puTTY (http://www.chiark.greenend.org.uk/       |
    |              |~sgtatham/putty/) (GPL)                         |
    |--------------+------------------------------------------------|
    |Windows       |SSH em cygwin (http://www.cygwin.com/) (GPL)    |
    |(cygwin)      |                                                |
    |--------------+------------------------------------------------|
    |Macintosh     |macSSH (http://www.macssh.com/) (GPL)           |
    |Clássico      |                                                |
    |--------------+------------------------------------------------|
    |Mac OS X      |OpenSSH; use ssh na aplicação de Terminal (GPL) |
    +---------------------------------------------------------------+


%

6.9.5. Configurar o ssh-agent

    É mais seguro proteger as suas chaves secretas de autenticação
    SSH com uma frase-passe. Se nenhuma frase-passe foi definida, use
    "ssh-keygen -p" para a definir.

    Ponha a sua chave SSH pública (ex. "~/.ssh/id_rsa.pub") em "~
    /.ssh/authorized_keys" numa máquina remota a usar uma ligação à
    máquina remota baseada em palavra-passe como descrito em cima.

    $ ssh-agent bash
    $ ssh-add ~/.ssh/id_rsa
    Insira frase-passe para /home/<nome_de_utilizador>/.ssh/id_rsa:
    Identidade adicionada: /home/<nome_de_utilizador>/.ssh/id_rsa (/home/<nome_de_utilizador>/.ssh/id_rsa)

    Nenhuma palavra-passe necessária desde aqui até ao próximo
    comando.

    $ scp foo <nome_utilizador>@máquina.remota:foo

    Carregue em ^D (CTRL-D) para terminar a sessão do ssh-agent.

    Para o servidor X, o script de arranque normal de Debian executa
    o ssh-agent como o processo pai. Portanto apenas precisa de
    executar o ssh-add uma vez. Para mais, leia ssh-agent(1) e 
    ssh-add(1).

%

6.9.6. Como desligar o sistema remoto em SSH

    Precisa de proteger o processo ao fazer "shutdown -h now" (veja
    Secção 1.1.8, “Como desligar o sistema”) a partir da terminação
    do SSH a usar o comando at(1) (veja Secção 9.3.13, “Agendar
    tarefas uma vez”) com o seguinte.

    # echo "shutdown -h now" | at now

    Correr "shutdown -h now" numa sessão do screen(1) (veja
    Secção 9.1, “O programa screen”) é outro modo de fazer o mesmo.

%

6.9.7. Depurar problemas no SSH

    Se estiver com problemas, verifique as permissões dos ficheiros
    de configuração e corra o ssh com a opção "-v".

    Use a opção "-p" se for o root e esteja a ter problemas com a
    firewall; isto evita o uso dos portos de servidor 1 -- 1023.

    Se as ligações ssh a um site remoto subitamente deixarem de
    funcionar, pode ser o resultado de reparações pelo administrador
    do sistema, mais provável uma alteração na "chave_da_máquina"
    durante a manutenção do sistema. Após certificar-se que é este o
    caso e ninguém está a tentar falsificar a máquina remota com
    algum hack inteligente, pode-se recuperar a ligação ao remover a
    entrada "host_key" de "~/.ssh/known_hosts" na máquina local.

%

6.10. Outras aplicações de servidor de rede

    Aqui estão outras aplicações de servidor de rede.

    Tabela 6.18. Lista de outras aplicações de servidor de rede

    +---------------------------------------------------------------+
    |     pacote      |popcon|tamanho|protocolo|     descrição      |
    |-----------------+------+-------+---------+--------------------|
    |telnetd          |V:1,  |115    |TELNET   |Servidor TELNET     |
    |                 |I:3   |       |         |                    |
    |-----------------+------+-------+---------+--------------------|
    |telnetd-ssl      |V:0,  |170    |, ,      |. . (suporte a SSL) |
    |                 |I:0   |       |         |                    |
    |-----------------+------+-------+---------+--------------------|
    |nfs-kernel-server|V:38, |342    |NFS      |Partilha de         |
    |                 |I:79  |       |         |ficheiros do Unix   |
    |-----------------+------+-------+---------+--------------------|
    |                 |      |       |         |Partilha de         |
    |samba            |V:102,|16629  |SMB      |ficheiros e         |
    |                 |I:159 |       |         |impressoras do      |
    |                 |      |       |         |Windows             |
    |-----------------+------+-------+---------+--------------------|
    |                 |      |       |         |Partilha de         |
    |netatalk         |V:2,  |2077   |ATP      |ficheiros e         |
    |                 |I:3   |       |         |impressoras do Apple|
    |                 |      |       |         |/Mac (AppleTalk)    |
    |-----------------+------+-------+---------+--------------------|
    |proftpd-basic    |V:24, |488    |FTP      |Download de         |
    |                 |I:32  |       |         |ficheiros geral     |
    |-----------------+------+-------+---------+--------------------|
    |apache2          |V:246,|610    |HTTP     |Servidor web geral  |
    |                 |I:315 |       |         |                    |
    |-----------------+------+-------+---------+--------------------|
    |squid            |V:13, |8385   |, ,      |servidor proxy web  |
    |                 |I:15  |       |         |geral               |
    |-----------------+------+-------+---------+--------------------|
    |squid3           |V:4,  |240    |, ,      |, ,                 |
    |                 |I:10  |       |         |                    |
    |-----------------+------+-------+---------+--------------------|
    |bind9            |V:52, |1063   |DNS      |Endereço IP para    |
    |                 |I:65  |       |         |outras máquinas     |
    |-----------------+------+-------+---------+--------------------|
    |isc-dhcp-server  |V:18, |1471   |DHCP     |Endereço IP do      |
    |                 |I:54  |       |         |próprio cliente     |
    +---------------------------------------------------------------+


    Common Internet File System Protocol (CIFS) é o mesmo protocolo
    que Server Message Block (SMB) e é bastante usado pelo Microsoft
    Windows.

    Dica
   
    Veja Secção 4.5.2, “O moderno sistema de gestão centralizado”
    para integração de sistemas servidor.

    Dica

    A resolução do nome de máquinas é normalmente disponibilizada
    pelo servidor de DNS. Para o endereço IP atribuído dinamicamente
    à máquina por DHCP, pode ser definido DNS Dinâmico para a
    resolução do nome de máquina a utilizar o bind9 e o
    isc-dhcp-server conforme é descrito na página DDNS no wiki
    Debian.

    Dica

    O uso de servidor proxy como o squid é muito mais eficiente para
    poupar largura de banda que o uso de servidor mirror local com o
    conteúdo completo do arquivo Debian.

%

6.11. Outros clientes de aplicação de rede

    Aqui estão outros clientes de aplicação de rede.

    Tabela 6.19. Lista de clientes de aplicação de rede

    +---------------------------------------------------------------+
    |    pacote     |popcon|tamanho|protocolo|      descrição       |
    |---------------+------+-------+---------+----------------------|
    |netcat         |I:41  |16     |TCP/IP   |Canivete suíço do TCP/|
    |               |      |       |         |IP                    |
    |---------------+------+-------+---------+----------------------|
    |               |      |       |         |Binário Secure Socket |
    |               |V:794,|       |         |Layer (SSL) e         |
    |openssl        |I:993 |1465   |SSL      |ferramentas           |
    |               |      |       |         |criptográficas        |
    |               |      |       |         |relacionadas          |
    |---------------+------+-------+---------+----------------------|
    |stunnel4       |V:5,  |507    |, ,      |Wrapper SSL universal |
    |               |I:17  |       |         |                      |
    |---------------+------+-------+---------+----------------------|
    |telnet         |V:65, |163    |TELNET   |Cliente TELNET        |
    |               |I:904 |       |         |                      |
    |---------------+------+-------+---------+----------------------|
    |telnet-ssl     |V:0,  |210    |, ,      |. . (suporte a SSL)   |
    |               |I:3   |       |         |                      |
    |---------------+------+-------+---------+----------------------|
    |nfs-common     |V:181,|768    |NFS      |Partilha de ficheiros |
    |               |I:343 |       |         |do Unix               |
    |---------------+------+-------+---------+----------------------|
    |               |      |       |         |Cliente de partilha de|
    |smbclient      |V:16, |2016   |SMB      |ficheiros e           |
    |               |I:174 |       |         |impressoras do MS     |
    |               |      |       |         |Windows               |
    |---------------+------+-------+---------+----------------------|
    |               |      |       |         |Comandos de montar e  |
    |cifs-utils     |V:32, |299    |, ,      |desmontar para        |
    |               |I:123 |       |         |ficheiros remotos do  |
    |               |      |       |         |MS Windows            |
    |---------------+------+-------+---------+----------------------|
    |ftp            |V:18, |137    |FTP      |Cliente FTP           |
    |               |I:282 |       |         |                      |
    |---------------+------+-------+---------+----------------------|
    |lftp           |V:6,  |2255   |, ,      |, ,                   |
    |               |I:39  |       |         |                      |
    |---------------+------+-------+---------+----------------------|
    |ncftp          |V:3,  |1339   |, ,      |Cliente FTP de écran  |
    |               |I:22  |       |         |completo              |
    |---------------+------+-------+---------+----------------------|
    |wget           |V:288,|3477   |HTTP e   |downloader de web     |
    |               |I:988 |       |FTP      |                      |
    |---------------+------+-------+---------+----------------------|
    |curl           |V:151,|426    |, ,      |, ,                   |
    |               |I:548 |       |         |                      |
    |---------------+------+-------+---------+----------------------|
    |axel           |V:0,  |216    |, ,      |acelerador de         |
    |               |I:4   |       |         |downloads             |
    |---------------+------+-------+---------+----------------------|
    |               |      |       |         |acelerador de         |
    |aria2          |V:2,  |1854   |, ,      |downloads com suporte |
    |               |I:19  |       |         |de BitTorrent e       |
    |               |      |       |         |Metalink              |
    |---------------+------+-------+---------+----------------------|
    |bind9-host     |V:382,|365    |DNS      |host(1) do bind9,     |
    |               |I:948 |       |         |"Prioridade: standard"|
    |---------------+------+-------+---------+----------------------|
    |dnsutils       |V:64, |256    |, ,      |dig(1) do bind,       |
    |               |I:517 |       |         |"Prioridade: standard"|
    |---------------+------+-------+---------+----------------------|
    |isc-dhcp-client|V:231,|686    |DHCP     |obter endereço IP     |
    |               |I:979 |       |         |                      |
    |---------------+------+-------+---------+----------------------|
    |ldap-utils     |V:14, |718    |LDAP     |obter dados de um     |
    |               |I:75  |       |         |servidor LDAP         |
    +---------------------------------------------------------------+


%

6.12. Os diagnósticos dos daemons do sistema

    O programa telnet activa ligação manual aos daemons do sistema e
    aos seus diagnósticos.

    Para testar o serviço POP3 simples, tente o seguinte:

    $ telnet mail.ispname.net pop3

    Para testar o serviço POP3 com TLS/SSL ativo de alguns ISPs,
    precisa do cliente telnet com TLS/SSL ativo pelos pacotes
    telnet-ssl or openssl.

    $ telnet -z ssl pop.gmail.com 995

    $ openssl s_client -connect pop.gmail.com:995

    Os seguintes RFCs disponibilizam o conhecimento necessário para
    cada daemon de sistema.

    Tabela 6.20. Lista de RFCs populares

    +--------------------------------------------------------------+
    |       RFC       |                 descrição                  |
    |-----------------+--------------------------------------------|
    |rfc1939 e rfc2449|serviço POP3                                |
    |-----------------+--------------------------------------------|
    |rfc3501          |serviço IMAP4                               |
    |-----------------+--------------------------------------------|
    |rfc2821 (rfc821) |serviço SMTP                                |
    |-----------------+--------------------------------------------|
    |rfc2822 (rfc822) |Formato de ficheiro de mail                 |
    |-----------------+--------------------------------------------|
    |rfc2045          |Multipurpose Internet Mail Extensions (MIME)|
    |-----------------+--------------------------------------------|
    |rfc819           |serviço DNS                                 |
    |-----------------+--------------------------------------------|
    |rfc2616          |serviço HTTP                                |
    |-----------------+--------------------------------------------|
    |rfc2396          |definição URI                               |
    +--------------------------------------------------------------+


    A utilização de portos é descrita em "/etc/services".

Capítulo 7. O Sistema X Window

    Atenção
   
    Este capítulo está a ficar ultrapassado porque é baseado em
    Debian 7.0 (Wheezy) lançado em 2013.

    O Sistema X Window no sistema Debian é baseado na fonte do X.Org.

%

7.1. Pacotes chave

    Existem alguns (meta)pacotes disponibilizados para facilitar a
    instalação.

    Tabela 7.1. Lista de (meta)pacotes chave para o X Window

    +---------------------------------------------------------------+
    |   (meta)pacote   |popcon|tamanho|          descrição          |
    |------------------+------+-------+-----------------------------|
    |                  |      |       |bibliotecas do X, um servidor|
    |xorg              |I:457 |52     |X, um conjunto de fontes e um|
    |                  |      |       |grupo de clientes X básicos e|
    |                  |      |       |utilitários (meta-pacote)    |
    |------------------+------+-------+-----------------------------|
    |xserver-xorg      |V:66, |238    |conjunto completo do servidor|
    |                  |I:492 |       |X e a configuração dele      |
    |------------------+------+-------+-----------------------------|
    |xbase-clients     |I:26  |46     |colecção variada de clientes |
    |                  |      |       |X (meta-pacote)              |
    |------------------+------+-------+-----------------------------|
    |                  |V:372,|       |infraestrutura do sistema de |
    |x11-common        |I:755 |308    |ficheiros para o Sistema X   |
    |                  |      |       |Window                       |
    |------------------+------+-------+-----------------------------|
    |xorg-docs         |I:6   |2036   |documentação variada para a  |
    |                  |      |       |suite de software X.Org      |
    |------------------+------+-------+-----------------------------|
    |                  |V:54, |       |gera um menu Debian a partir |
    |menu              |I:197 |1509   |de todas as aplicações com   |
    |                  |      |       |item de menu                 |
    |------------------+------+-------+-----------------------------|
    |                  |V:31, |       |converte a estrutura do menu |
    |menu-xdg          |I:109 |27     |Debian para a estrutura de   |
    |                  |      |       |menu xdg do freedesktop.org  |
    |------------------+------+-------+-----------------------------|
    |                  |      |       |utilitários para integrar o  |
    |xdg-utils         |V:229,|327    |ambiente de trabalho         |
    |                  |I:521 |       |disponibilizado pelo         |
    |                  |      |       |freedesktop.org              |
    |------------------+------+-------+-----------------------------|
    |task-gnome-desktop|I:175 |9      |ambiente de trabalho GNOME   |
    |                  |      |       |standard (meta-pacote)       |
    |------------------+------+-------+-----------------------------|
    |task-kde-desktop  |I:66  |6      |núcleo do ambiente de        |
    |                  |      |       |trabalho KDE (meta-pacote)   |
    |------------------+------+-------+-----------------------------|
    |task-xfce-desktop |I:106 |9      |Xfce ambiente de trabalho    |
    |                  |      |       |leve (meta-pacote)           |
    |------------------+------+-------+-----------------------------|
    |task-lxde-desktop |I:35  |9      |LXDE ambiente de trabalho    |
    |                  |      |       |leve (meta-pacote)           |
    |------------------+------+-------+-----------------------------|
    |                  |      |       |Fluxbox: pacote para um      |
    |fluxbox           |V:2,  |3860   |gestor de janelas X altamente|
    |                  |I:9   |       |configurável e de baixos     |
    |                  |      |       |recursos                     |
    +---------------------------------------------------------------+


    Para as bases do X, veja X(7) e o manual do utilizador LDP
    XWindow.

%

7.2. Definir o ambiente de trabalho

    Um ambiente de trabalho é geralmente uma combinação de um gestor
    de janelas X, um gestor de ficheiros e um conjunto de programas
    utilitários compatíveis.

    Pode configurar um ambiente de trabalho completo como o GNOME,
    KDE, Xfce, ou LXDE, a partir do aptitude sob o menu de tarefas.

    Dica

    O menu de tarefas pode estar fora de sincronismo com o estado de
    transição de pacotes mais recente sob os ambientes Debian
    unstable/testing. Em tal situação, precisa de des-selecionar
    alguns (meta)pacotes listados sob o menu tarefas do aptitude(8)
    para evitar conflitos de pacotes. Quando des-selecionar (meta)
    pacotes, tem de selecionar manualmente certos pacotes que
    disponibilizam as suas dependências para evitar que eles sejam
    apagados automaticamente.

    Alternativamente pode configurar um ambiente simples manualmente
    apenas com um gestor de janelas X como o Fluxbox.

    Veja Window Managers for X para o guia do gestor do X window e do
    ambiente de trabalho.

%

7.2.1. Menu Debian

    O sistema de menu Debian disponibiliza uma interface geral para
    ambos programas orientados a texto e X com o update-menus(1) do
    pacote menu. Cada pacote instala os seus dados de menu no
    diretório "/usr/share/menu/". Veja "/usr/share/menu/README".

%

7.2.2. Menu Freedesktop.org

    Cada pacote que é compatível com o sistema de menu do
    Freedesktop.org instala os seus dados de menu disponibilizados
    por "*.desktop" sob "/usr/share/applications/". Os ambientes de
    trabalho modernos que são compatíveis com o standard
    Freedesktop.org usam estes dados para gerar o menu deles a usar o
    pacote xdg-utils. Veja "/usr/share/doc/xdg-utils/README".

%

7.2.3. Menu Debian a partir do menu Freedesktop.org

    De modo a aceder ao menu Debian tradicional a partir de gestores
    de janelas compatíveis com o menu Freedesktop.org como GNOME e
    KDE, precisa instalar o pacote menu-xdg.

%

7.3. A relação servidor/cliente

    O X Window System é activado como uma combinação de programas
    servidor e cliente. Aqui o significado das palavras servidor e 
    cliente com respeito às palavras local e remoto requer atenção.

    Tabela 7.2. Lista de terminologia de servidor/cliente

    +---------------------------------------------------------------+
    |   tipo   |                     descrição                      |
    |----------+----------------------------------------------------|
    |Servidor X|um programa que corre numa máquina local ligado ao  |
    |          |ecrã e aparelhos de entrada do utilizador.          |
    |----------+----------------------------------------------------|
    |cliente X |um programa que corre numa máquina remota que       |
    |          |processa dados e fala com o servidor X.             |
    |----------+----------------------------------------------------|
    |aplicação |um programa que corre numa máquina remota que       |
    |servidor  |processa dados e fala com as aplicações dos         |
    |          |clientes.                                           |
    |----------+----------------------------------------------------|
    |aplicação |um programa que corre numa máquina local ligado ao  |
    |cliente   |ecrã e aparelhos de entrada do utilizador.          |
    +---------------------------------------------------------------+


    Os servidores X modernos têm a Extensão de Memória Partilhada MIT
    e comunicam com os seus clientes X locais a usar a memória
    partilhada local. Isto faz uma passagem directa à rede
    transparente de canal de comunicação inter-processos do Xlib e
    ganha performance para grandes imagens.

%

7.4. O servidor X

    Veja xorg(1) para informação do servidor X.

%

7.4.1. A (re)configuração do servidor X

    O seguinte (re)configura um servidor X.

    # dpkg-reconfigure --priority=low x11-common

    Nota

    Os kernels recentes de Linux têm suporte a bons gráficos e bons
    aparelhos de entrada com DRM, KMS e udev. O servidor X foi
    rescrito para os usar. Então o "/etc/X11/xorg.conf" geralmente
    não está presente no seu sistema. Estes parâmetros são
    configurados pelo kernel. Veja "fb/modedb.txt" na documentação do
    kernel Linux.

    Para os monitores CRT de alta resolução, é uma boa ideia de
    regular a taxa de refrescamento ao mais alto que o monitor
    suporte (85 Hz é muito bom, 75 Hz é bom) para reduzir a
    cintilação. Para o monitor de LCD, a taxa de refrescamento
    standard mais lenta (60Hz) é geralmente boa devido à sua resposta
    lenta.

    Nota
   
    Tenha cuidado para não usar uma taxa de refrescamento muito alta
    que possa causar falha fatal do hardware do seu monitor.

%

7.4.2. Os métodos de ligação do servidor X

    Existem várias maneiras de fazer um "servidor X" (lado do monitor
    ) aceitar ligações de um "cliente X" (lado da aplicação).

    Tabela 7.3. Lista de métodos de ligação ao servidor X

    +---------------------------------------------------------------------------+
    |    pacote    |popcon|tamanho|utilizador|encriptação|  método   |   uso    |
    |              |      |       |          |           |           |pertinente|
    |--------------+------+-------+----------+-----------+-----------+----------|
    |xbase-clients |I:26  |46     |não       |não        |comando    |obsoleto  |
    |              |      |       |verificado|           |xhost      |          |
    |--------------+------+-------+----------+-----------+-----------+----------|
    |              |      |       |          |           |comando    |ligação   |
    |xbase-clients |I:26  |46     |verificado|não        |xauth      |local via |
    |              |      |       |          |           |           |pipe      |
    |--------------+------+-------+----------+-----------+-----------+----------|
    |              |V:803,|       |          |           |comando ssh|ligação de|
    |openssh-client|I:996 |4298   |verificado|sim        |-X         |rede      |
    |              |      |       |          |           |           |remota    |
    |--------------+------+-------+----------+-----------+-----------+----------|
    |              |V:165,|       |          |nenhum     |gestor de  |ligação   |
    |gdm3          |I:229 |5101   |verificado|(XDMCP)    |display do |local via |
    |              |      |       |          |           |GNOME      |pipe      |
    |--------------+------+-------+----------+-----------+-----------+----------|
    |              |V:53, |       |          |nenhum     |gestor de  |ligação   |
    |sddm          |I:95  |1742   |verificado|(XDMCP)    |display do |local via |
    |              |      |       |          |           |KDE        |pipe      |
    |--------------+------+-------+----------+-----------+-----------+----------|
    |              |V:3,  |       |          |nenhum     |gestor de  |ligação   |
    |xdm           |I:6   |686    |verificado|(XDMCP)    |display do |local via |
    |              |      |       |          |           |X          |pipe      |
    |--------------+------+-------+----------+-----------+-----------+----------|
    |              |V:31, |       |          |nenhum     |gestor de  |ligação   |
    |wdm           |I:284 |2289   |verificado|(XDMCP)    |display do |local via |
    |              |      |       |          |           |WindowMaker|pipe      |
    |--------------+------+-------+----------+-----------+-----------+----------|
    |              |      |       |          |           |           |ligação de|
    |              |V:0,  |       |          |           |gestor de  |rede SSH  |
    |ldm           |I:0   |436    |verificado|sim        |display do |remota    |
    |              |      |       |          |           |LTSP       |(cliente  |
    |              |      |       |          |           |           |ténue)    |
    +---------------------------------------------------------------------------+


    Atenção

    Não use ligação TCP/IP remota sobre redes inseguras para ligação
    X a menos que tenha uma boa razão como o uso de encriptação. Uma
    ligação socket TCP/IP remota sem encriptação é inclinada a 
    ataques de escuta e está desactivada por predefinição no sistema
    Debian. Use "ssh -X".

    Atenção
   
    Também não use ligação XDMCP sobre rede insegura. Envia os dados
    via UDP/IP sem encriptação e é inclinado a ataques de escuta.

    Dica
   
    LTSP significa Linux Terminal Server Project.

%

7.5. Iniciar o X Window System

    O X Window System é geralmente iniciado como uma sessão X a qual
    é a combinação de um servidor X e clientes X ligados. Para o
    sistema de ambiente de trabalho normal, ambos são executados numa
    estação de trabalho.

    A sessão X é iniciada por um dos seguintes.

      * comando startx iniciado a partir da linha de comandos
   
      * Um dos programas daemon de gestor de ecrã X *dm arrancado
        pelo systemd na dependência de "graphical.target".

    Dica

    O script de arranque para os daemons de gestão de ecrã verifica o
    conteúdo do ficheiro "/etc/X11/default-display-manager" mesmo
    antes de executar os próprios. Isto assegura que se tem apenas um
    programa daemon de gestor de ecrã X activado.

    Dica
   
    Veja Secção 8.4.5, “O locale específico apenas sob X Window” para
    as variáveis de ambiente iniciais do gestor de écran X.

    Essencialmente, todos estes programas executam o script "/etc/X11
    /Xsession". Então o script "/etc/X11/Xsession" executa run-parts
    (8) como acção para executar os scripts no diretório "/etc/X11/
    Xsession.d/". Isto é essencialmente uma execução do primeiro
    programa o qual é encontrado na seguinte ordem pelo comando
    embutido exec.

     1. O script especificado como o argumento de /etc/X11/Xsession"
        pelo gestor de display X, se estiver definido.

     2. O script "~/.xsession" ou "~/.Xsession", se estiver definido.

     3. O comando "/usr/bin/x-session-manager", se estiver definido.

     4. O comando "/usr/bin/x-window-manager". se estiver definido.

     5. O comando "/usr/bin/x-terminal-emulator", se estiver
        definido.

    Este processo é afectado pelo conteúdo de "/etc/X11/
    Xsession.options". Os programas exactos para os quais estes
    comandos "/usr/bin/x-*" apontam são determinados pelo sistema de
    alternativas Debian e modificados pelo "update-alternatives
    --config x-session-manager", etc.

    Veja Xsession(5) para detalhes.

%

7.5.1. Iniciar uma sessão X com o gdm3

    O gdm3(1) permite-lhe selecionar o tipo de sessão (ou ambiente de
    trabalho: Secção 7.2, “Definir o ambiente de trabalho”) e
    linguagem (ou locale: Secção 8.4, “O locale”) da sessão X do menu
    dele. Mantêm o valor predefinido selcionado em "~/.dmrc" como a
    seguir.

    [Desktop]
    Session=default
    Language=pt_PT.UTF-8

%

7.5.2. Personalizar a sessão X (método clássico)

    Num sistema onde "/etc/X11/Xsession.options" contém uma linha
    "allow-user-xsession" sem o caractere "#" a preceder, qualquer
    utilizador que defina "~/.xsession" ou "~/.Xsession" é capaz de
    personalizar a acção de "/etc/X11/Xsession" ao sobrepor
    completamente o código do sistema. O último comando no ficheiro
    "~/.xsession" deve usar a forma de "exec some-window/
    session-manager" para iniciar os seus gestores de X window/sessão
    favoritos.

    Se esta característica for usada, é ignorada a seleção do gestor
    de ecrã (ou login) (DM), gestor de sessão ou gestor de janelas
    (WM) feita pelo utilitário do sistema.

%

7.5.3. Personalizar a sessão X (método novo)

    Aqui estão alguns métodos de personalizar a sessão X sem sobrepor
    completamente o código do sistema como em cima.

      * O gestor de écran gdm3 pode selecionar uma sessão específica
        e defini-la como o argumento de "/etc/X11/Xsession".

          + Os ficheiros "/etc/profile", "~/.profile", "/etc/
            xprofile" e "~/.xprofile" são executados como a ser parte
            do processo de arranque do gdm3.

      * O ficheiro "~/.xsessionrc" é executado como parte do processo
        de arranque. (independente do ambiente de trabalho)

          + "#allow-user-xsession" em "/etc/X11/Xsession.options" não
            restringe a execução do ficheiro "~/.xsessionrc".

      * O ficheiro "~/.gnomerc" é executado como parte do processo de
        arranque. (apenas ambiente GNOME)

    A seleção do gestor de ecrã (ou login) (DM), gestor de sessão ou
    gestor de janelas (WM) feita pelo utilitário do sistema é
    respeitada.

    Estes ficheiros de configuração não deve ter "exec …" nem "exit"
    no conteúdo deles.

%

7.5.4. Ligar um cliente X remoto via SSH

    A utilização de "ssh -X" activa uma ligação segura de um servidor
    X local a um servidor de aplicações remoto.

    Defina as entradas "X11Forwarding" para "yes" em "/etc/ssh/
    sshd_config" da máquina remota, se deseja evitar a opção "-X" da
    linha de comando.

    Arrancar o servidor X na máquina local.

    Abrir um xterm na máquina local.

    Correr o ssh(1) para estabelecer ligação com um site remoto com o
    seguinte.

    nome_local @ localhost $ ssh -q -X nome_de_login@domínio.máquina_remota
    Palavra-passe:

    Executar um comando de aplicação X, ex. "gimp", no site remoto
    com o seguinte.

    nome_de_login @ máquina_remota $ gimp &

    Este método pode mostrar o resultado de um cliente X remoto como
    se ele estivesse ligado localmente através de um socket de
    domínio UNIX local.

%

7.5.5. Terminal X seguro via Internet

    Terminal X seguro via Internet, o qual mostra um ambiente de
    trabalho X completo a correr remotamente, pode ser conseguido
    facilmente a usar um pacote especializado como o ldm. A sua
    máquina local torna-se num cliente magro seguro para um servidor
    de aplicações remoto ligado via SSH.

%

7.6. Fontes (tipos de letra) para o X Window

    O Fontconfig 2.0 foi criado para disponibilizar uma biblioteca
    independente da distribuição para configurar e personalizar o
    acesso a tipos de letra em 2002. Debian após squeeze usa
    Fontconfig 2.0 para a configuração de fontes dele.

    Os suportes de font no X Window System podem ser resumidos como a
    seguir.

      * Sistema de suporte a font de tamanho de servidor X Legacy

          + O sistema de font do núcleo original do X11 disponibiliza
            compatibilidade para trás para aplicações cliente X de
            versões mais antigas.

          + As fontes de núcleo original X11 estão instaladas no
            servidor X.

      * Sistema de suporte a font de tamanho de cliente X moderno

          + O sistema X moderno suporta todas as fontes listadas
            abaixo (Secção 7.6.1, “Fontes (tipos de letra) básicas”,
            Secção 7.6.2, “Fontes (tipos de letra) adicionais” e
            Secção 7.6.3, “fonts CJK”) com funcionalidades avançadas
            como o anti-aliasing.
   
          + O Xft 2.0 liga aplicações X modernas como as do GNOME,
            KDE e LibreOffice com a biblioteca FreeType 2.0.

          + FreeType 2.0 disponibiliza uma biblioteca de rasterização
            de fontes.

          + Fontconfig disponibiliza resolução da especificação de
            fonte para Xft 2.0. Veja fonts.conf(5) para a
            configuração dele.

          + Todas as aplicações X modernas que usam Xft 2.0 podem
            falar com o servidor X moderno a usar a Extensão X
            Rendering.

          + A Extensão X Rendering move o acesso a tipos de letra e a
            geração de imagens de glifos do servidor X para o cliente
            X.

    Tabela 7.4. Tabela de pacotes para suportar fontes do sistema X
    Window

    +---------------------------------------------------------------+
    |     pacote      |popcon|tamanho|          descrição           |
    |-----------------+------+-------+------------------------------|
    |xfonts-utils     |V:66, |415    |Programas utilitários de      |
    |                 |I:542 |       |fontes do Sistema X Window    |
    |-----------------+------+-------+------------------------------|
    |                 |      |       |Xft, uma biblioteca que liga  |
    |libxft2          |V:143,|122    |aplicações X com a biblioteca |
    |                 |I:662 |       |de rasterização de fontes     |
    |                 |      |       |FreeType                      |
    |-----------------+------+-------+------------------------------|
    |libfreetype6     |V:426,|896    |FreeType biblioteca de        |
    |                 |I:994 |       |rasterização de fontes 2.0    |
    |-----------------+------+-------+------------------------------|
    |                 |      |       |Fontconfig, uma biblioteca de |
    |fontconfig       |V:354,|583    |configuração de fontes        |
    |                 |I:776 |       |genérica -- binários de       |
    |                 |      |       |suporte                       |
    |-----------------+------+-------+------------------------------|
    |                 |      |       |Fontconfig, uma biblioteca    |
    |fontconfig-config|V:367,|442    |genérica de configuração de   |
    |                 |I:871 |       |fontes -- dados de            |
    |                 |      |       |configuração                  |
    +---------------------------------------------------------------+


    Pode verificar informação de configuração de fontes pelo
    seguinte.

      * "xset q" para caminho das fontes do núcleo do X11

      * "fc-match" para a fonte predefinida do fontconfig

      * "fc-list" para fontes disponíveis do fontconfig

    Dica

    "O Pinguim e o Unicode" é uma boa visão geral do X Window System
    moderno. Outra documentação em http://unifont.org/ deverá
    disponibilizar boas informações sobre tipos de letra Unicode,
    software capaz de Unicode, internacionalização e problemas da
    utilização de Unicode em sistemas operativos free/libre/open
    source (FLOSS).

%

7.6.1. Fontes (tipos de letra) básicas

    Existem 2 tipos principais de fontes de computador.

      * Fontes bitmap (boas para rasterização de baixa resolução)
   
      * Fontes contorno/stroke (boas para rasterização de alta
        resolução)

    Enquanto o dimensionar de fontes de mapas de bits causa imagem
    distorcida, o dimensionar de fontes de contorno/curso produz
    imagem suave.

    As fontes de mapa de bits no sistema Debian são geralmente
    disponibilizadas por ficheiros de fontes bitmap pcf do X11
    comprimidos com a sua extensão de ficheiro ".pcf.gz".

    As fontes de contorno no sistema Debian são disponibilizadas pelo
    seguinte.

      * Ficheiros de font Type 1 PostScript a ter a extensão de
        ficheiro deles ".pfb" (ficheiro de fonte binário) e ".afm"
        (ficheiro de fonte métrica).

      * Ficheiros font TrueType (ou OpenType) geralmente têm a
        extensão de ficheiro ".ttf".

    Dica
   
    OpenType é destinado a substituir ambas TrueType e PostScript
    Type 1.

    Tabela 7.5. Tabela de fontes PostScript Type 1 correspondentes

    +-----------------------------------------------------------------------+
    |pacote font|popcon|tamanho|   font   |  font  |    font     | fonte da |
    |           |      |       |sans-serif| serif  |  monospace  |   font   |
    |-----------+------+-------+----------+--------+-------------+----------|
    |PostScript |N/D   |N/D    |Helvetica |Times   |Courier      |Adobe     |
    |-----------+------+-------+----------+--------+-------------+----------|
    |           |      |       |          |Nimbus  |             |URW       |
    |gsfonts    |I:599 |4439   |Nimbus    |Roman   |Nimbus Mono L|(tamanho  |
    |           |      |       |Sans L    |No9 L   |             |compatível|
    |           |      |       |          |        |             |com Adobe)|
    |-----------+------+-------+----------+--------+-------------+----------|
    |           |      |       |          |        |             |Suporte a |
    |           |      |       |Nimbus    |Nimbus  |             |fonte X   |
    |gsfonts-x11|I:82  |95     |Sans L    |Roman   |Nimbus Mono L|com fonts |
    |           |      |       |          |No9 L   |             |PostScript|
    |           |      |       |          |        |             |Type 1.   |
    |-----------+------+-------+----------+--------+-------------+----------|
    |           |      |       |          |        |             |URW       |
    |           |      |       |Free      |Free    |             |extenso   |
    |t1-cyrillic|I:19  |4878   |Helvetian |Times   |Free Courier |(tamanho  |
    |           |      |       |          |        |             |compatível|
    |           |      |       |          |        |             |com Adobe)|
    |-----------+------+-------+----------+--------+-------------+----------|
    |           |      |       |          |        |             |fontes    |
    |           |      |       |          |        |             |PostScript|
    |           |      |       |          |        |             |e OpenType|
    |           |V:13, |       |          |        |             |escaláveis|
    |lmodern    |I:113 |33270  |LMSans*   |LMRoman*|LMTypewriter*|baseadas  |
    |           |      |       |          |        |             |em        |
    |           |      |       |          |        |             |Computer  |
    |           |      |       |          |        |             |Modern (do|
    |           |      |       |          |        |             |TeX)      |
    +-----------------------------------------------------------------------+


    Tabela 7.6. Tabela de fontes correspondentes a TrueType

    +------------------------------------------------------------------------------------------+
    |       pacote font       |popcon|tamanho|   font   |font serif|   font   | fonte da font  |
    |                         |      |       |sans-serif|          |monospace |                |
    |-------------------------+------+-------+----------+----------+----------+----------------|
    |                         |      |       |          |          |          |Microsoft       |
    |                         |      |       |          |          |          |(tamanho        |
    |ttf-mscorefonts-installer|V:1,  |92     |Arial     |Times New |Courier   |compatível com  |
    |                         |I:64  |       |          |Roman     |New       |Adobe) (Isto    |
    |                         |      |       |          |          |          |instala dados   |
    |                         |      |       |          |          |          |não-livres)     |
    |-------------------------+------+-------+----------+----------+----------+----------------|
    |                         |      |       |          |          |          |Liberation Fonts|
    |fonts-liberation         |I:469 |2093   |Liberation|Liberation|Liberation|project (tamanho|
    |                         |      |       |Sans      |Serif     |Mono      |compatível com  |
    |                         |      |       |          |          |          |Microsoft)      |
    |-------------------------+------+-------+----------+----------+----------+----------------|
    |                         |      |       |          |          |          |GNU freefont    |
    |fonts-freefont-ttf       |V:50, |6656   |FreeSans  |FreeSerif |FreeMono  |((tamanho       |
    |                         |I:276 |       |          |          |          |compatível com  |
    |                         |      |       |          |          |          |Microsoft)      |
    |-------------------------+------+-------+----------+----------+----------+----------------|
    |                         |      |       |          |          |          |DejaVu,         |
    |fonts-dejavu             |I:478 |39     |DejaVu    |DejaVu    |DejaVu    |Bitstream Vera  |
    |                         |      |       |Sans      |Serif     |Sans Mono |com cobertura   |
    |                         |      |       |          |          |          |Unicode         |
    |-------------------------+------+-------+----------+----------+----------+----------------|
    |                         |      |       |          |          |          |DejaVu,         |
    |                         |      |       |          |          |          |Bitstream Vera  |
    |                         |      |       |          |          |          |com cobertura   |
    |                         |V:220,|       |DejaVu    |DejaVu    |DejaVu    |Unicode (sans,  |
    |fonts-dejavu-core        |I:809 |2954   |Sans      |Serif     |Sans Mono |sans-negrito,   |
    |                         |      |       |          |          |          |serif.          |
    |                         |      |       |          |          |          |serif-negrito,  |
    |                         |      |       |          |          |          |mono,           |
    |                         |      |       |          |          |          |mono-negrito)   |
    |-------------------------+------+-------+----------+----------+----------+----------------|
    |                         |      |       |          |          |          |DejaVu,         |
    |                         |      |       |          |          |          |Bitstream Vera  |
    |                         |      |       |          |          |          |com cobertura   |
    |                         |      |       |          |          |          |Unicode         |
    |fonts-dejavu-extra       |I:516 |7493   |N/D       |N/D       |N/D       |(oblíquo,       |
    |                         |      |       |          |          |          |itálico,        |
    |                         |      |       |          |          |          |negrito-oblíquo,|
    |                         |      |       |          |          |          |negrito-itálico,|
    |                         |      |       |          |          |          |condensado)     |
    |-------------------------+------+-------+----------+----------+----------+----------------|
    |                         |      |       |          |          |          |GNU Unifont, com|
    |                         |      |       |          |          |          |todo o código de|
    |                         |      |       |          |          |          |caracteres      |
    |ttf-unifont              |I:21  |21     |N/D       |N/D       |unifont   |imprimíveis em  |
    |                         |      |       |          |          |          |Unicode 5.1     |
    |                         |      |       |          |          |          |Basic           |
    |                         |      |       |          |          |          |Multilingual    |
    |                         |      |       |          |          |          |Plane (BMP)     |
    +------------------------------------------------------------------------------------------+


    Dica
   
    as fontes DejaVu são baseadas e um superconjunto da fontes
    Bitstream Vera.

%

7.6.2. Fontes (tipos de letra) adicionais

    O aptitude(8) ajuda-o a encontrar fontes adicionais facilmente.

      * A lista de pacotes curta sob "Tarefas" → "Localização"

      * A lista de pacotes lisa filtrada de dados de fontes com regex
        em debtag: "~Gmade-of::data:font"

      * A lista de pacotes lisa filtrada de pacotes de fontes BDF
        (bitmap) com regex no nome do pacote: "~nxfonts-"

      * A lista de pacotes lisa filtrada de pacotes de fontes
        TrueType (contorno) com regex no nome do pacote: "~nttf-|
        ~nfonts-"

    Como as fonts Free são por vezes limitadas, instalar ou partilhar
    algumas fontes de TrueType comerciais é uma opção para os
    utilizadores de Debian. De modo a tornar este processo fácil para
    o utilizador, foram criados alguns pacotes de conveniência.

      * mathematica-fonts
   
      * fonts-mscorefonts-installer

    Irá ter uma boa seleção de fonts TrueType às custas de contaminar
    o seu sistema Livre com fontes não-Livres.

%

7.6.3. fonts CJK

    Aqui estão alguns pontos chave que focam em fonts de caracteres
    CJK.

    Tabela 7.7. Tabela de palavras-chave usadas em nomes de fontes
    CJK para indicar os tipos de fonts

    +----------------------------------------------------------------+
    | tipo de  |  nome de font   |  nome de font   |  nome de font   |
    |   font   |    Japonesa     |     Chinesa     |     Coreana     |
    |----------+-----------------+-----------------+-----------------|
    |sans-serif|gótico, ゴチック |hei, gótico      |dodum, gulim,    |
    |          |                 |                 |gótico           |
    |----------+-----------------+-----------------+-----------------|
    |serif     |mincho, 明朝     |song, ming       |batang           |
    +----------------------------------------------------------------+


    O nome de font como "VL PGothic" com o "P" é um font proporcional
    a qual corresponde à largura fixa da fonte "VL Gothic".

    Por exemplo, a tabela de código Shift_JIS compreende 7070
    caracteres. Eles podem ser agrupados como o seguinte.

      * caracteres de um byte JIS X 0201 (191 caracteres, a.k.a.
        caracteres de meia-largura)
   
      * caracteres de duplo byte JIS X 0208 (6879 caracteres, a.k.a.
        caracteres de largura-completa)

    Os caracteres de duplo-byte ocupam o dobro da largura nos
    terminais de consola que usam fonts CJK de largura fixa. De modo
    a lidar com esta situação, pode ser implantado o Hanzi Bitmap
    Font (HBF) File com extensão de ficheiro ".hbf" para fonts que
    contêm caracteres de único-byte e duplo-byte.

    De modo a poupar espaço para ficheiros de tipos de letra
    TrueType, pode ser usado o ficheiro de colecção de tipos de letra
    TrueType com a extensão de ficheiro ".ttc".

    De modo a cobrir o código complicado do espaço dos caracteres, é
    usada uma font Type 1 PostScript com chave CID com ficheiros CMap
    que arrancam eles próprios com "%!PS-Adobe-3.0 Resource-CMap".
    Isto é raramente usado para o ecrã X normal mas é usado para
    renderização de PDF, etc. (veja Secção 7.7.2, “aplicações
    utilitárias do X”).

    Dica

    Os múltiplos glifos são esperados para alguns pontos de código do
    Unicode devido à unificação do Han. Um dos mais chatos são
    "U+3001 IDEOGRAPHIC COMMA" e "U+3002 IDEOGRAPHIC FULL STOP" nos
    quais as posições dos caracteres diferem entre países CJK.
    Configurar a prioridade das fonts centrais Japonesas sobre as
    Chinesas usado o "~/.fonts.conf" deverá trazer alguma paz aos
    Japoneses.

7.7. Aplicações do X

%

7.7.1. Aplicações de escritório do X

    Aqui está uma lista de aplicações de escritório básicas (LO é o
    LibreOffice).

    Tabela 7.8. lista de aplicações X de escritório básicas

    +---------------------------------------------------------------+
    |      pacote       |popcon| tamanho |tipo |     descrição      |
    |                   |      |do pacote|     |                    |
    |-------------------+------+---------+-----+--------------------|
    |libreoffice-writer |V:188,|39333    |LO   |processador de texto|
    |                   |I:441 |         |     |                    |
    |-------------------+------+---------+-----+--------------------|
    |libreoffice-calc   |V:188,|32973    |LO   |folha de cálculo    |
    |                   |I:436 |         |     |                    |
    |-------------------+------+---------+-----+--------------------|
    |libreoffice-impress|V:176,|9934     |LO   |apresentação        |
    |                   |I:433 |         |     |                    |
    |-------------------+------+---------+-----+--------------------|
    |libreoffice-base   |V:145,|7473     |LO   |gestão de base de   |
    |                   |I:325 |         |     |dados               |
    |-------------------+------+---------+-----+--------------------|
    |libreoffice-draw   |V:177,|14600    |LO   |editor de gráficos  |
    |                   |I:434 |         |     |vectoriais (desenho)|
    |-------------------+------+---------+-----+--------------------|
    |libreoffice-math   |V:174,|1963     |LO   |editor de fórmulas/ |
    |                   |I:437 |         |     |equações matemáticas|
    |-------------------+------+---------+-----+--------------------|
    |abiword            |V:1,  |5141     |GNOME|processador de texto|
    |                   |I:12  |         |     |                    |
    |-------------------+------+---------+-----+--------------------|
    |gnumeric           |V:6,  |9933     |GNOME|folha de cálculo    |
    |                   |I:21  |         |     |                    |
    |-------------------+------+---------+-----+--------------------|
    |gimp               |V:68, |22313    |GTK  |editor de gráficos  |
    |                   |I:341 |         |     |bitmap (pintura)    |
    |-------------------+------+---------+-----+--------------------|
    |inkscape           |V:55, |84823    |GNOME|editor de gráficos  |
    |                   |I:209 |         |     |vectoriais (desenho)|
    |-------------------+------+---------+-----+--------------------|
    |                   |V:5,  |         |     |editor de           |
    |dia                |I:31  |3727     |GTK  |fluxogramas e       |
    |                   |      |         |     |diagramas           |
    |-------------------+------+---------+-----+--------------------|
    |planner            |V:0,  |1146     |GNOME|gestão de projectos |
    |                   |I:5   |         |     |                    |
    |-------------------+------+---------+-----+--------------------|
    |calligrawords      |V:0,  |5717     |KDE  |processador de texto|
    |                   |I:7   |         |     |                    |
    |-------------------+------+---------+-----+--------------------|
    |calligrasheets     |V:0,  |10890    |KDE  |folha de cálculo    |
    |                   |I:6   |         |     |                    |
    |-------------------+------+---------+-----+--------------------|
    |calligrastage      |V:0,  |5102     |KDE  |apresentação        |
    |                   |I:5   |         |     |                    |
    |-------------------+------+---------+-----+--------------------|
    |calligraplan       |V:0,  |15342    |KDE  |gestão de projectos |
    |                   |I:2   |         |     |                    |
    |-------------------+------+---------+-----+--------------------|
    |kexi               |V:0,  |7576     |KDE  |gestão de base de   |
    |                   |I:2   |         |     |dados               |
    |-------------------+------+---------+-----+--------------------|
    |karbon             |V:0,  |3473     |KDE  |editor de gráficos  |
    |                   |I:7   |         |     |vectoriais (desenho)|
    +---------------------------------------------------------------+


%

7.7.2. aplicações utilitárias do X

    Aqui está uma lista de aplicações utilitárias básicas que me
    chamaram a atenção.

    Tabela 7.9. Lista de aplicações X utilitárias básicas

    +---------------------------------------------------------------+
    | pacote  |popcon| tamanho |tipo |          descrição           |
    |         |      |do pacote|     |                              |
    |---------+------+---------+-----+------------------------------|
    |evince   |V:116,|954      |GNOME|visualizador de documentos    |
    |         |I:329 |         |     |(pdf)                         |
    |---------+------+---------+-----+------------------------------|
    |okular   |V:46, |14646    |KDE  |visualizador de documentos    |
    |         |I:118 |         |     |(pdf)                         |
    |---------+------+---------+-----+------------------------------|
    |calibre  |V:9,  |54876    |KDE  |conversor de e-books e gestor |
    |         |I:36  |         |     |de biblioteca                 |
    |---------+------+---------+-----+------------------------------|
    |fbreader |V:2,  |3074     |GTK  |leitor de e-book              |
    |         |I:15  |         |     |                              |
    |---------+------+---------+-----+------------------------------|
    |evolution|V:31, |475      |GNOME|Gestor de Informações Pessoais|
    |         |I:229 |         |     |(groupware e email)           |
    |---------+------+---------+-----+------------------------------|
    |kontact  |V:1,  |2152     |KDE  |Gestor de Informações Pessoais|
    |         |I:16  |         |     |(groupware e email)           |
    |---------+------+---------+-----+------------------------------|
    |         |V:2,  |         |     |editor de disposição de       |
    |scribus  |I:23  |30375    |KDE  |páginas do ambiente de        |
    |         |      |         |     |trabalho                      |
    |---------+------+---------+-----+------------------------------|
    |glabels  |V:0,  |1326     |GNOME|editor de etiquetas           |
    |         |I:4   |         |     |                              |
    |---------+------+---------+-----+------------------------------|
    |gnucash  |V:3,  |32304    |GNOME|contas pessoais               |
    |         |I:12  |         |     |                              |
    |---------+------+---------+-----+------------------------------|
    |homebank |V:0,  |1044     |GTK  |contas pessoais               |
    |         |I:3   |         |     |                              |
    |---------+------+---------+-----+------------------------------|
    |kmymoney |V:0,  |12036    |KDE  |contas pessoais               |
    |         |I:2   |         |     |                              |
    |---------+------+---------+-----+------------------------------|
    |shotwell |V:19, |6451     |GTK  |organizador de fotos digitais |
    |         |I:223 |         |     |                              |
    |---------+------+---------+-----+------------------------------|
    |xsane    |V:17, |2346     |GTK  |frontend para digitalizador   |
    |         |I:173 |         |     |(scanner)                     |
    +---------------------------------------------------------------+


    Cuidado

    O pacote poppler-data (anteriormente não-livre), veja
    Secção 11.4.1, “Ghostscript”) precisa de ser instalado para o
    evince e okular para mostrar documentos PDF CJK a usar dados Cmap
    (Secção 7.6.3, “fonts CJK”).

    Nota

    Instalar softwares como o scribus (KDE) no ambiente de trabalho
    GNOME é aceitável porque a funcionalidade correspondente não está
    disponível no ambiente GNOME. Mas instalar demasiados pacotes com
    funcionalidades duplicadas desorganiza o seu menu.

7.8. As trivialidades do X

%

7.8.1. Área de transferência (Clipboard)

    A seleção X a usar rato de 3 botões é a característica nativa de
    área de transferência do X (veja Secção 1.4.4, “Operações do rato
    ao estilo Unix”).

    Dica
   
    Shift-Insert pode funcionar como equivalente ao clique do botão
    do meio do rato.

    Tabela 7.10. Lista de programas de seleção X básicos

    +---------------------------------------------------------------+
    |pacote|popcon |tamanho do |tipo|           descrição           |
    |      |       |  pacote   |    |                               |
    |------+-------+-----------+----+-------------------------------|
    |xsel  |V:10,  |59         |X   |interfaces de linha de comandos|
    |      |I:44   |           |    |para selecções X               |
    |------+-------+-----------+----+-------------------------------|
    |xclip |V:9,   |64         |X   |interfaces de linha de comandos|
    |      |I:49   |           |    |para selecções X               |
    +---------------------------------------------------------------+


    Os Desktop Environments modernos (GNOME, KDE, …) oferecem
    diferentes sistemas de área de transferência para o cortar,
    copiar e colar a usar o botão esquerdo do rato e teclas (CTRL-X,
    CRTL-C e CTRL-V).

%

7.8.2. Mapas de teclas e mapas de botões do apontador (rato) no X

    O xmodmap(1) é um utilitário para modificar mapas de teclas e
    mapas dos botões do rato no X Window System. Para obter o 
    código-da-tecla, corra xev(1) no X e carregue nas teclas. Para
    obter significado de keysym, veja na definição de MACRO no
    ficheiro "/usr/include/X11/keysymdef.h" (pacote
    x11proto-core-dev). Todas as declarações "#define" neste ficheiro
    são nomeadas com "XK_" pre-pendente a nomes keysym.

%

7.8.3. Clientes X Clássicos

    Programas cliente X mais tradicionais, como o xterm(1), podem ser
    arrancados com um conjunto de opções de linha de comandos
    standard para especificar a geometria, o tipo de letra e o ecrã.

    Eles também usam a base de dados de recursos do X para configurar
    a aparência deles. As predefinições gerais do sistema dos
    recursos do X são armazenadas em "/etc/X11/Xresources/*" e as
    predefinições de aplicação delas são armazenadas em "/etc/X11/
    app-defaults/*". Use estas definições como pontos de partida.

    O ficheiro "~/.Xresources" é usado para armazenar especificações
    de recursos do utilizador. Este ficheiro é unido automaticamente
    aos recursos predefinidos do X após o login. Para fazer
    alterações nestas definições e as tornar efectivas imediatamente,
    una-as à base de dados a usar o seguinte comando.

    $ xrdb -merge ~/.Xresources

    Veja x(7) e xrdb(1).

%

7.8.4. O emulador de terminal X - xterm

    Saiba tudo sobre o xterm(1) em http://dickey.his.com/xterm/
    xterm.faq.html.

%

7.8.5. Correr clientes X como root

    Atenção

    Nunca inicie o gestor de sessão/ecrã X sob a conta root ao
    escrever root num gestor de ecrã como o gdm3 porque isso é
    considerado inseguro, mesmo quando planeia executar atividades
    administrativas. A arquitectura inteira do X é considerada
    insegura para ser executada como root. Deve sempre usar o nível
    de privilégios mais baixo possível, como uma conta de utilizador
    normal.

    Maneiras fáceis de correr um cliente X particular, ex. "foo" como
    root é usar sudo(8) etc. como o seguinte.

    $ sudo foo &

    $ sudo -s
    # foo &

    $ ssh -X root@localhost
    # foo &

    Cuidado
   
    O uso de ssh(1) só para este objetivo como em cima é um
    desperdício de recursos.

    De modo que o cliente X se ligue ao servidor X, por favor note o
    seguinte.

      * Os valores das variáveis de ambiente "$XAUTHORITY" e
        "$DISPLAY" dos utilizadores antigos têm de ser copiados aos
        utilizadores mais recentes.

      * O ficheiro apontado pelo valor da variável de ambiente
        "$XAUTHORITY" tem de ser legível pelo novo utilizador.

Capítulo 8. I18N e L10N

    O Multilingualization (M17N) ou Suporte de Linguagem Nativa para
    um software de aplicação é feito em 2 passos.

      * Internationalization (I18N): Para fazer com que o software
        lide potencialmente com múltiplos locales.
   
      * Localization (L10N): Tornar o software útil num locale
        específico.

    Dica

    Existem 17, 18, ou 10 letras entre "m" e "n", "i" e "n", ou "l" e
    "n" em 'multilingualization', 'internationalization' e
    'localization' os quais correspondem a M17N, I18N e L10N.

    O software moderno como o GNOME e o KDE está multi-lingualizado.
    Eles são internacionalizados ao fazê-los lidar com dados UTF-8 e
    localizados ao disponibilizar as suas mensagens traduzidas
    através da infraestrutura gettext(1). As mensagens traduzidas
    podem ser disponibilizadas em pacotes de localização separados.
    Podem ser selecionados simplesmente ao definir variáveis de
    ambiente pertinentes ao locale apropriado.

    A representação mais simples dos dados de texto é o ASCII o qual
    é suficiente para Inglês e usa menos de 127 caracteres
    (representados em 7 bits). De modo a suportar muitos mais
    caracteres para o suporte in internacional, foram inventados
    muitos sistemas de codificação de caracteres. O sistema mais
    moderno e sensível é o UTF-8 o qual pode lidar com praticamente
    todos os caracteres conhecidos dos humanos (veja Secção 8.4.1,
    “Bases de codificação”).

    Veja Introdução ao i18n para mais detalhes.

    O suporte a hardware internacional é activado com dados de
    configuração de hardware localizados.

    Atenção
   
    Este capítulo está a ficar ultrapassado porque é baseado em
    Debian 7.0 (Wheezy) lançado em 2013.

%

8.1. A entrada do teclado

    O sistema Debian pode ser configurado para funcionar com muitas
    disposições internacionais de teclado a usar os pacotes
    keyboard-configuration e console-setup.

    # dpkg-reconfigure keyboard-configuration
    # dpkg-reconfigure console-setup

    Isto configura o teclado para a consola Linux e o X Window
    atualiza os parâmetros de configuração em "/etc/default/keyboard"
    e "/etc/default/console-setup". Isto também configura o tipo de
    letra (font) da consola Linux.

    Muitos caracteres não-ASCII incluindo caracteres acentuados
    usados por muitas linguagens Europeias podem ficar disponíveis
    com tecla morta, tecla AltGr e tecla compose.

    Para as linguagens Asiáticas, precisa de um suporte de método de
    entrada mais complicado como o IBus discutido em seguida.

%

8.1.1. O suporte a método de entrada com IBus

    Entrada multilingue para a aplicação é processada como:

    Teclado                               Aplicação
       |                                        ^
       |                                        |
       +-> kernel Linux -> Método de entrada -> Gtk, Qt, ou X

    A configuração de entrada multilingue para o sistema Debian está
    simplificada ao usar a família de pacotes IBus com o pacote
    im-config. A lista de pacotes IBus é a seguinte.

    Tabela 8.1. Lista de suportes a método de entrada com IBus

    +---------------------------------------------------------------+
    |    pacote     |popcon |tamanho|       locale suportado        |
    |---------------+-------+-------+-------------------------------|
    |ibus           |V:70,  |1581   |estrutura de método de entrada |
    |               |I:87   |       |que usa dbus                   |
    |---------------+-------+-------+-------------------------------|
    |ibus-mozc      |V:1,   |999    |Japonês                        |
    |               |I:2    |       |                               |
    |---------------+-------+-------+-------------------------------|
    |ibus-anthy     |V:0,   |8723   |, ,                            |
    |               |I:1    |       |                               |
    |---------------+-------+-------+-------------------------------|
    |ibus-kkc       |V:0,   |214    |, ,                            |
    |               |I:0    |       |                               |
    |---------------+-------+-------+-------------------------------|
    |ibus-skk       |V:0,   |244    |, ,                            |
    |               |I:0    |       |                               |
    |---------------+-------+-------+-------------------------------|
    |ibus-pinyin    |V:0,   |1434   |Chinês (para zh_CN)            |
    |               |I:1    |       |                               |
    |---------------+-------+-------+-------------------------------|
    |ibus-chewing   |V:0,   |415    |, , (para zh_TW)               |
    |               |I:0    |       |                               |
    |---------------+-------+-------+-------------------------------|
    |ibus-hangul    |V:0,   |288    |Coreano                        |
    |               |I:1    |       |                               |
    |---------------+-------+-------+-------------------------------|
    |ibus-table     |V:0,   |1801   |motor de tabela para IBus      |
    |               |I:1    |       |                               |
    |---------------+-------+-------+-------------------------------|
    |ibus-table-thai|I:0    |47     |Thai                           |
    |---------------+-------+-------+-------------------------------|
    |ibus-unikey    |V:0,   |318    |Vietnamita                     |
    |               |I:0    |       |                               |
    |---------------+-------+-------+-------------------------------|
    |ibus-m17n      |V:0,   |187    |Multilingue: Indiano, Árabe e  |
    |               |I:1    |       |outros                         |
    +---------------------------------------------------------------+


    O método kinput2 e outros métodos de entrada Asiáticos clássicos
    dependentes do locale ainda existem mas não são recomendados para
    o ambiente X UTF-8 moderno. As cadeias de ferramentas SCIM e uim
    são uma aproximação um tanto antiga ao método de entrada
    internacional para o ambiente X UTF-8 moderno.

%

8.1.2. Um exemplo para Japonês

    Acho muito útil o método de entrada de Japonês arrancado sob
    ambiente Inglês "en_US.UTF-8"). Aqui está como fiz isto com o
    IBus para GNOME3:

     1. Instale o pacote de ferramenta de entrada de Japonês
        ibus-anthy com os seus pacotes recomendados como o im-config.

     2. Execute "im-config" a partir da shell de utilizador e
        seleccione "ibus" como método de entrada.

     3. Seleccione "Definições" → "Teclado" → "Fontes de Entrada" →
        clique em "+" em "Fontes de Entrada" → "Japonês" → "Japonês
        (anthy)" e clique "Adicionar".

     4. Seleccione "Japonês" e clique "Adicionar" para suportar a
        disposição Japonesa de teclado sem conversão de caracteres.
        (Pode escolher quantas fontes de entrada desejar.)

     5. Voltar a fazer login na conta do utilizador.

     6. Verificar definição por "im-config".

     7. Configure a fonte de entrada ao clicar com o botão direito no
        ícone da barra de ferramentas da GUI.

     8. Alterne entre as fontes de entrada instaladas com
        SUPER-ESPAÇO. (SUPER é normalmente a Tecla Windows.)

    Por favor note o seguinte:

      * O im-config(8) comporta-se de modo diferente se o comando for
        executado pelo root ou não.

      * im-config(8) activa o melhor método de entrada do sistema e é
        predefinido sem qualquer acção do utilizador.

      * A entrada no menu GUI para im-config(8) está desactivada por
        predefinição para evitar a desordem.

%

8.1.3. desativar o método de entrada

    Se você desejar dar entradas sem ser através do XIM (mecanismo
    usado pelo X), regule o valor de "$XMODIFIERS" para "none" quando
    arranca um programa. Este pode ser o caso se você usar a
    infraestrutura de entrada de Japonês egg em emacs(1), enquanto
    desactiva ibus. A partir da shell, execute como a seguir.

    $ XMODIFIERS=none emacs

    De modo a ajustar o comando executado pelo menu Debian, ponha
    configuração personalizada em "/etc/menu/" a seguir o método
    descrito em "/usr/share/doc/menu/html".

%

8.2. O ecrã de resultados

    A consola do Linux apenas pode mostrar caracteres limitados.
    (Precisa usar programas de terminal especiais como o jfbterm(1)
    para mostrar linguagens não-Europeias numa consola não-X.)

    O X Window pode mostrar quaisquer caracteres em UTF-8 desde que a
    font necessária exista. (A codificação dos dados da font original
    fica ao cuidado do Sistema X Window e é transparente para o
    utilizador.)

%

8.3. Caracteres Asiáticos de Leste de Altura Ambígua

    Em localizações ao leste da Asia, o desenhar de caixa, os
    caracteres Gregos e Cirílicos podem aparecer mais largos que o
    desejado e causarem o desalinhamento da saída do terminal (veja
    Unicode Standard Annex #11).

    Pode contornar este problema:

      * gnome-terminal: Editar → Preferências → Perfis → Editar →
        Compatibilidade → Caracteres de Largura Ambígua → Estreitar

      * ncurses: Define ambiente export NCURSES_NO_UTF8_ACS=0.

%

8.4. O locale

    O seguinte foca-se no locale para aplicações que correm sob
    ambiente X Window iniciado a partir do gdm3(1).

%

8.4.1. Bases de codificação

    A variável de ambiente "LANG=xx_YY.ZZZZ" define o locale ao
    código de linguagem "xx", código de país "yy" e codificação
    "ZZZZ" (veja Secção 1.5.2, “A variável "$LANG"”).

    O sistema Debian atual normalmente define o locale como "LANG=
    xx_YY.UTF-8". Isto usa a codificação UTF-8 com o conjunto de
    caracteres Unicode. Este sistema de codificação UTF-8 é um
    sistema de código multibyte e usa pontos de código
    inteligentemente. Os dados ASCII, que consistem apenas em códigos
    com alcance de 7 bits, são sempre dados UTF-8 válidos a consistir
    apenas com 1 byte por caractere.

    O sistema Debian anterior costumava definir o locale como "LANG=
    C" ou "LANG=xx_YY" (sem ".UTF-8").

      * O conjunto de caracteres ASCII é usado para "LANG=C" ou "LANG
        =POSIX".
   
      * O sistema de codificação tradicional em Unix é usado para
        "LANG=xx_YY".

    O sistema de codificação tradicional atual usado para "LANG=
    xx_YY" pode ser identificado ao verificar "/usr/share/i18n/
    SUPPORTED". Por exemplo, "en_US" usa codificação "ISO-8859-1" e
    "fr_FR@euro" usa codificação "ISO-8859-15".

    Dica
   
    Para o significado dos valores de codificação, veja Tabela 11.2,
    “Lista de valores de codificação e a utilização deles”.

%

8.4.2. Fundamentos para o locale UTF-8

    O conjunto de caracteres Unicode pode representar praticamente
    todos os caracteres conhecidos dos humanos com um alcance de
    códigos de 0 até 10FFFF em hexadecimal. O armazenamento dele
    requer pelo menos 21 bits.

    O sistema de codificação de texto UTF-8 encaixa pontos de código
    Unicode num fluxo de dados de 8 bits sensível compatível com o
    sistema de processamento de dados ASCII. UTF significa Unicode
    Transformation Format.

    Recomendo usar o locale UTF-8 para o seu ambiente de trabalho,
    ex. "LANG=en_US.UTF-8". A primeira parte do locale determina as
    mensagens apresentadas pelas aplicações. Por exemplo, o gedit(1)
    (editor de texto para o ambiente GNOME) sob o locale "LANG=
    fr_FR.UTF-8" pode mostrar e editar dados de texto em caracteres
    Chineses enquanto apresenta os menus em Francês, desde que as
    fonts e métodos de entrada necessários estejam instalados.

    Também recomendo definir o locale a usar a variável de ambiente
    "$LANG". Não vejo grande benefício ao definir uma combinação
    complicada de variáveis "LC_*" (veja locale(1)) sob locale UTF-8.

    Mesmo o Inglês simples pode conter caracteres não-ASCII, ex. as
    marcas de citação esquerda e direita ligeiramente curvas não
    estão disponíveis em ASCII.

    “texto com dupla citação” não é "ASCII com citação dupla"
    ‘texto com citação singular’ não é 'ASCII com citação singular'

    Quando os dados de texto simples em ASCII são convertidos para
    UTF-8, fica exatamente com o mesmo conteúdo e tamanho que o
    original em ASCII. Portanto não se perde nada ao implantar o
    locale UTF-8.

    Alguns programas consomem mais memória após suportarem I18N. Isto
    é porque estão codificados para usar UTF-32(UCS4) internamente
    para suportar Unicode para optimização de velocidade e consomem 4
    bytes por cada caractere ASCII independentemente do locale
    selcionado. Mais uma vez, não perde nada ao implantar o locale
    UTF-8.

    Os sistema de codificação não-UTF-8 antigos específicos de marcas
    tentem a ter diferenças menores mas aborrecidas em alguns
    caracteres como os gráficos para muitos países. A implantação do
    sistema UTF-8 pelos Sistemas Operativos modernos praticamente
    resolveu estes problemas de conflitos de codificação.

%

8.4.3. A reconfiguração do locale

    De modo ao sistema aceder a um determinado locale, os dados do
    locale têm de ser compilados a partir da base de dados de
    locales. (O sistema Debian não vem com todos os locales
    disponíveis pré-compilados a menos que instale o pacote
    locales-all.) A lista completa dos locales suportados disponíveis
    para compilação está disponível em "/usr/share/i18n/SUPPORTED".
    Isto lista todos os nomes de locale apropriadamente. O seguinte
    lista todos os locales UTF-8 disponíveis já compilados no formato
    binário.

    $ locale -a | grep utf8

    A execução do comando seguinte reconfigura o pacote locales.

    # dpkg-reconfigure locales

    Este processo involve 3 passos.

     1. atualizar a lista de locales disponíveis

     2. Compilá-los num formato binário
   
     3. Definir o locale predefinido de todo o sistema em "/etc/
        default/locale" para usar com o PAM (veja Secção 4.5, “PAM e
        NSS”)

    A lista dos locale disponíveis deve incluir "en_US.UTF-8" e todas
    as linguagens de interesse com "UTF-8".

    O locale predefinido recomendado é "en_US.UTF-8" para Inglês dos
    Estados Unidos. Para outras linguagens, por favor certifique-se
    de escolher um locale com "UTF-8". Qualquer uma destas definições
    consegue lidar com quaisquer caracteres internacionais.

    Nota
   
    Apesar da definição de locale para "C" usar mensagens em Inglês
    dos Estados Unidos, apenas lida com caracteres ASCII.

%

8.4.4. O valor da variável de ambiente "$LANG"

    O valor da variável de ambiente "$LANG" é definido e alterado por
    muitas aplicações.

      * Definido inicialmente pelo mecanismo de login(1) PAM para os
        programas de consola local do Linux

      * Definido inicialmente pelo mecanismo PAM do gestor de ecrã
        para todos os programas do X

      * Definido inicialmente pelo mecanismo PAM do ssh(1) para os
        programas de consola remota
   
      * Alterado por algum gestor de ecrã como o gdm3(1) para todos
        os programas do X

      * Alterado pelo código de arranque da sessão X via "~
        /.xsessionrc" para todos os programas do X

      * Alterado pelo código de arranque da shell, ex. "~/.bashrc",
        para todos os programas de consola

    Dica
   
    É uma boa ideia instalar um locale predefinido para todo o
    sistema como "en_US.UTF-8" para o máximo de compatibilidade.

%

8.4.5. O locale específico apenas sob X Window

    Pode escolher um locale específico apenas sob X Window não
    relacionado com o seu locale predefinido de todo o sistema a usar
    personalização do PAM (veja xref linkend="_pam_and_nss"/>) como a
    seguir.

    Este ambiente deverá disponibilizar-lhe a melhor experiência de
    ambiente de trabalho com estabilidade. Tem acesso ao terminal de
    caracteres funcional com mensagens legíveis mesmo quando o
    Sistema X Window não está a funcionar. Isto torna-se essencial
    para linguagens que usam caracteres não-romanos como o Chinês,
    Japonês e Coreano.

    Nota

    Pode existir outra maneira disponível como o melhoramento do
    pacote de gestão de sessão X, mas por favor leia o seguinte como
    o método genérico e básico de definir o locale. Para o gdm3(1),
    sei que pode selecionar da sessão X através do menu dele.

    A seguinte linha define a localização do ficheiro do ambiente de
    linguagem no ficheiro do configuração do PAM, como o "/etc/pam.d/
    gdm3.

    auth    required        pam_env.so read_env=1 envfile=/etc/default/locale

    Mude isto ao seguinte.

    auth    required        pam_env.so read_env=1 envfile=/etc/default/locale-x

    Para Japonês, crie um ficheiro "/etc/default/locale-x" com
    permissões "-rw-r--r-- 1 root root" a conter o seguinte.

    LANG="ja_JP.UTF-8"

    Mantenha o ficheiro "/etc/default/locale" predefinido para outros
    programas com o seguinte.

    LANG="en_US.UTF-8"

    Esta é a técnica mais genérica para personalizar o locale e faz
    com que o diálogo de seleção de menu do próprio gdm3(1) fique
    localizado (traduzido).

    Alternativamente para este caso, pode simplesmente alterar o
    locale a usar o ficheiro "~/.xsessionrc".

%

8.4.6. Codificação de nomes de ficheiros

    Para troca de dados entre plataformas (veja Secção 10.1.7,
    “Aparelho de armazenamento amovível”), pode precisar de montar
    algum sistema de ficheiros com codificações particulares. por
    exemplo, o mount(8) para sistema de ficheiros vfat assume CP437
    se usado sem opção. Precisa de fornecer uma opção explícita de
    montagem para usar UTF-8 ou CP932 para os nomes dos ficheiros.

    Nota

    Quando se monta automaticamente uma caneta de memória USB sob
    ambientes de trabalho modernos como o GNOME, pode fornecer tal
    opção de montagem ao clicar com o botão direito no ícone no
    ambiente de trabalho, clique no separador "Drive", clique para
    expandir "Definições" e insira "utf8" nas "Opções de montagem:".
    Não próxima vez que esta caneta de memória for montada, está
    activa a montagem com UTF-8.

    Nota

    Se está a atualizar o sistema ou a mover os discos de um sistema
    antigo não-UTF-8, os nomes de ficheiros com caracteres não-ASCII
    podem ser codificados com as codificações históricas e obsoletas
    como a ISO-8859-1 ou eucJP. por favor procure a ajuda de
    ferramentas de conversão de texto para convertê-los para UTF-8.
    Veja Secção 11.1, “Ferramentas de conversão de dados em texto”.

    O Samba usa Unicode para os clientes mais recentes (Windows NT,
    200x, XP) mas usa CP850 para os clientes mais antigos (DOS e
    Windows 9x/Me) por predefinição. Esta predefinição para os
    clientes mais antigos pode ser alterada a usar "dos charset" no
    ficheiro "/etc/samba/smb.conf" por exemplo para CP932 para
    Japonês.

%

8.4.7. Mensagens localizadas e documentação traduzida

    Existem traduções para muitas das mensagens de texto e documentos
    que são mostrados no sistema Debian, tais como as mensagens de
    erro, as saídas normais dos programas, os menus e os manuais. A
    cadeia de ferramentas de comandos gettext(1) do GNU é usada como
    a ferramenta backend para a maioria das atividades de tradução.

    Sob "Tarefas" → "Localização" o aptitude(8) disponibiliza uma
    lista extensa de pacotes binários úteis que adicionam mensagens
    localizadas às aplicações e fornecem documentação traduzida.

    Por exemplo, pode obter as mensagens localizadas para os manuais
    ao instalar o pacote manpages-<LANG>. Para ler o manual em
    linguagem Italiana para o <nome_do_programa> a partir de "/usr/
    share/man/it/", execute o seguinte.

    LANG=it_IT.UTF-8 man <nome_do_programa>

%

8.4.8. Efeitos do locale

    A ordem de ordenação do caracteres com o sort(1) é afectada pela
    escolha de linguagem do locale. Os locales Espanhol e Inglês
    ordenam de forma diferente.

    O formato de data do ls(1) é afectado pelo locale. Os formatos de
    data de "LANG=C ls -l" e "LANG=en_US.UTF-8" são diferentes (veja
    Secção 9.2.5, “Amostragem personalizada de hora e data”).

    As pontuações numéricas são diferentes para os locales. Por
    exemplo, em locale Inglês, mil ponto um é mostrado como "1,000.1"
    enquanto em locale Alemão é mostrado como 1.000,1". Pode ver esta
    diferença num programa de folha de cálculo.

Capítulo 9. Dicas do sistema

    Aqui, descrevo dicas básicas para configurar e gerir sistemas, a
    maioria a partir da consola.

%

9.1. O programa screen

    O screen(1) é uma ferramenta muito útil para se aceder a sites
    remotos via ligações não confiáveis e intermitentes porque
    suporta interrupções nas ligações de rede.

    Tabela 9.1. Lista de programas para suportar ligações à rede
    interrompidas

    +---------------------------------------------------------------+
    |pacote|popcon |tamanho|               descrição                |
    |------+-------+-------+----------------------------------------|
    |screen|V:127, |1013   |terminal multiplexador com emulação de  |
    |      |I:281  |       |terminal VT100/ANSI                     |
    |------+-------+-------+----------------------------------------|
    |tmux  |V:34,  |830    |multiplexador alternativo de terminal   |
    |      |I:136  |       |(Use "Control-B" em vez disto)          |
    +---------------------------------------------------------------+


%

9.1.1. O cenário de utilização para o screen(1)

    O screen(1) não apenas permite que uma janela terminal funcione
    com múltiplos processos, mas também permite que os processos de
    shell remota sobrevivam a ligações interrompidas. Aqui está um
    cenário típico de utilização do screen(1).

     1. Faz login numa máquina remota.

     2. Arranca o screen numa consola única.

     3. Executa múltiplos programas na janela criada do screen com ^A
        c ("Ctrl-A" seguido de "c").

     4. Muda entre as múltiplas janelas do screen com ^A n ("Ctrl-A"
        seguido de "n").

     5. Subitamente precisa de abandonar o seu terminal, mas não quer
        perder o seu trabalho ativo a manter a ligação.

     6. Pode separar a sessão do screen por quaisquer métodos.
   
          + Desligar a sua ligação de rede à bruta

          + Escrever ^A d ("Ctrl-A" seguido de "d") e manualmente
            terminar a sessão da ligação remota

          + Escrever ^A DD ("Ctrl-A" seguido de "DD") para separar o
            screen e terminar a sua sessão

     7. Faz login de novo à mesma máquina remota (mesmo a partir de
        um terminal diferente).

     8. Inicia o screen como "screen -r".

     9. O screen magicamente reagrupa todas as janelas screen
        anteriores com todos os programas a funcionar activamente.

    Dica

    Pode poupar despesas de ligação com o screen em ligações de rede
    medidas 'a metro' como as dial-up, porque pode deixar um processo
    ativo enquanto desligado e depois lhe re-ligar-se mais tarde
    quando ligar de novo.

%

9.1.2. ligações de teclas para o comando screen

    Numa sessão do screen, todas as entradas do teclado são enviadas
    à sua janela atual excepto as teclas de comandos. Todas as teclas
    de comando do screen são inseridas ao escrever ^A ("Control-A")
    mais uma única tecla [mais quaisquer parâmetros]. Aqui estão
    alguns importantes para fazer lembrar.

    Tabela 9.2. Lista de ligações de teclas para o screen

    +---------------------------------------------------------------+
    |  tecla de   |                   significado                   |
    |   atalho    |                                                 |
    |-------------+-------------------------------------------------|
    |^A ?         |mostra um écran de ajuda (mostra as teclas de    |
    |             |atalho)                                          |
    |-------------+-------------------------------------------------|
    |^A c         |cria uma nova janela e muda para lá              |
    |-------------+-------------------------------------------------|
    |^A n         |vai à janela seguinte                            |
    |-------------+-------------------------------------------------|
    |^A p         |vai à janela anterior                            |
    |-------------+-------------------------------------------------|
    |^A 0         |vaia à janela número 0                           |
    |-------------+-------------------------------------------------|
    |^A 1         |vai à janela número 1                            |
    |-------------+-------------------------------------------------|
    |^A w         |mostra uma lista de janelas                      |
    |-------------+-------------------------------------------------|
    |^A a         |envia Ctrl-A à janela atual como entrada do      |
    |             |teclado                                          |
    |-------------+-------------------------------------------------|
    |^A h         |escreve uma cópia física da janela atual para um |
    |             |ficheiro                                         |
    |-------------+-------------------------------------------------|
    |^A H         |inicia/termina o registo da janela atual para um |
    |             |ficheiro                                         |
    |-------------+-------------------------------------------------|
    |^A ^X        |bloqueia o terminal (protegido por palavra-passe)|
    |-------------+-------------------------------------------------|
    |^A d         |separa a sessão do ecrã do terminal              |
    |-------------+-------------------------------------------------|
    |^A DD        |separa a sessão do ecrã e termina a sessão       |
    +---------------------------------------------------------------+


    Veja screen(1) para detalhes.

9.2. Gravação de dados e apresentação

%

9.2.1. O daemon de log

    Muitos programas registam as suas atividades sob o diretório "/
    var/log/".

      * O daemon de log do sistema: rsyslogd(8)

    Veja Secção 3.2.5, “A mensagem do sistema” e Secção 3.2.4, “A
    mensagem do kernel”.

%

9.2.2. Analisador de relatório (Log)

    Aqui estão analisadores de relatórios notáveis
    ("~Gsecurity::log-analyzer" no aptitude(8)).

    Tabela 9.3. Lista de analisadores de log do sistema

    +---------------------------------------------------------------+
    |    pacote    |popcon|tamanho|            descrição            |
    |--------------+------+-------+---------------------------------|
    |logwatch      |V:16, |2265   |analisador de log com saída      |
    |              |I:18  |       |bonita escrito em Perl           |
    |--------------+------+-------+---------------------------------|
    |fail2ban      |V:112,|2092   |banir IPs que causam vários erros|
    |              |I:123 |       |de autenticação                  |
    |--------------+------+-------+---------------------------------|
    |analog        |V:4,  |3534   |analisador de log do servidor web|
    |              |I:109 |       |                                 |
    |--------------+------+-------+---------------------------------|
    |              |V:9,  |       |analisador de logs de servidor   |
    |awstats       |I:15  |6910   |web poderoso e cheio de          |
    |              |      |       |funcionalidades                  |
    |--------------+------+-------+---------------------------------|
    |sarg          |V:3,  |843    |gerador de relatórios de análises|
    |              |I:3   |       |do squid                         |
    |--------------+------+-------+---------------------------------|
    |pflogsumm     |V:1,  |111    |resumidor de entradas do         |
    |              |I:4   |       |relatório do Postfix             |
    |--------------+------+-------+---------------------------------|
    |syslog-summary|V:0,  |30     |resume o conteúdo do um ficheiro |
    |              |I:2   |       |de log do syslog                 |
    |--------------+------+-------+---------------------------------|
    |fwlogwatch    |V:0,  |479    |analisador de log da firewall    |
    |              |I:0   |       |                                 |
    |--------------+------+-------+---------------------------------|
    |squidview     |V:0,  |189    |monitoriza e analisa ficheiros   |
    |              |I:1   |       |access.log do squid              |
    |--------------+------+-------+---------------------------------|
    |              |      |       |visualizador de ficheiros de     |
    |swatch        |V:0,  |101    |registo com correspondência de   |
    |              |I:0   |       |expressões regulares, destaque e |
    |              |      |       |hooks                            |
    |--------------+------+-------+---------------------------------|
    |              |V:0,  |       |Mutilador de Expressões Regulares|
    |crm114        |I:0   |1119   |Controlável e Filtro de Spam     |
    |              |      |       |(CRM114)                         |
    |--------------+------+-------+---------------------------------|
    |icmpinfo      |V:0,  |44     |interpretar mensagens ICMP       |
    |              |I:0   |       |                                 |
    +---------------------------------------------------------------+


    Nota

    CRM114 disponibiliza uma infraestrutura de linguagem para
    escrever filtros fuzzy com a biblioteca de expressões regulares
    TRE. O uso popular dela é o filtro de spam de mail, mas pode ser
    usado como um analisador de registos.

%

9.2.3. Gravar as atividades da shell de modo limpo

    O uso simples de script(1) (veja Secção 1.4.9, “Gravar as
    atividades da shell”) para gravar a atividade da shell produz um
    ficheiro com caracteres de controle. Isto pode ser evitado ao
    usar o col(1) como o seguinte.

    $ script
    Script iniciado, ficheiro é typescript

    Faça o que tem a fazer ... e carregue em Ctrl-D para terminar o
    script.

    $ col -bx <typescript >ficheiro_limpo
    $ vim ficheiro_limpo

    Se não tem o script (por exemplo, durante o processo de arranque
    no initramfs), então use antes o seguinte.

    $ sh -i 2>&1 | tee typescript

    Dica

    Alguns emuladores de terminal x como o gnome-terminal podem
    gravar. Pode desejar estender o buffer de linhas para ter
    deslocamento para trás.

    Dica

    Pode usar o screen(1) com "^A H" (veja Secção 9.1.2, “ligações de
    teclas para o comando screen”) para executar a gravação da
    consola.

    Dica

    Pode usar o emacs(1) com "M-x shell", "M-x eshell", ou "M-x term"
    para executar gravação da consola. Pode usar mais tarde "C-x C-w"
    para escrever o buffer num ficheiro.

%

9.2.4. Amostragem personalizada de dados em texto

    Apesar de ferramentas paginadoras com o more(1) e less(1) (veja
    Secção 1.4.5, “O pager”) e ferramentas personalizadas para
    destaque e formatação (veja Secção 11.1.8, “Destacar e formatar
    dados de texto simples”) poderem mostrar dados de texto muito
    bem, os editores de objetivos gerais (veja Secção 1.4.6, “O
    editor de texto”) são mais versáteis e personalizáveis.

    Dica
   
    Para o vim(1) e o aliás de modo paginador dele view(1), ":set
    hls" ativa pesquisas destacadas.

%

9.2.5. Amostragem personalizada de hora e data

    O formato de amostragem predefinido da hora e data pelo comando
    "ls -l" depende do locale (veja Secção 1.2.6, “Marcas temporais
    (Timestamps)” para o valor). A variável "$LANG" é referida
    primeiro e pode ser sobreposta pela variável "$LC_TIME".

    O formato mostrado predefinido atual para cada locale depende da
    versão da biblioteca C standard (o pacote libc6) usada. Isto é,
    lançamentos diferentes de Debian tiveram diferentes
    predefinições.

    Se deseja realmente personalizar este formato de amostragem da
    hora e data para além do locale, deve definir o valor de estilo
    de hora com o argumento "--time-style" ou com o valor
    "$TIME_STYLE" (veja ls(1), date(1), "info coreutils 'ls
    invocation'").

    Tabela 9.4. Mostrar exemplos de hora e data para o comando "ls
    -l" para wheezy

    +---------------------------------------------------------------+
    |valor do estilo de | localização |    mostra a hora e data     |
    |       hora        |             |                             |
    |-------------------+-------------+-----------------------------|
    |iso                |qualquer     |01-19 00:15                  |
    |-------------------+-------------+-----------------------------|
    |long-iso           |qualquer     |2009-01-19 00:15             |
    |-------------------+-------------+-----------------------------|
    |full-iso           |qualquer     |2009-01-19 00:15:16.000000000|
    |                   |             |+0900                        |
    |-------------------+-------------+-----------------------------|
    |locale             |C            |Jan 19 00:15                 |
    |-------------------+-------------+-----------------------------|
    |locale             |en_US.UTF-8  |Jan 19 00:15                 |
    |-------------------+-------------+-----------------------------|
    |locale             |es_ES.UTF-8  |ene 19 00:15                 |
    |-------------------+-------------+-----------------------------|
    |+%d.%m.%y %H:%M    |qualquer     |19.01.09 00:15               |
    |-------------------+-------------+-----------------------------|
    |+%d.%b.%y %H:%M    |C ou         |19.Jan.09 00:15              |
    |                   |en_US.UTF-8  |                             |
    |-------------------+-------------+-----------------------------|
    |+%d.%b.%y %H:%M    |es_ES.UTF-8  |19.ene.09 00:15              |
    +---------------------------------------------------------------+


    Dica

    Pode eliminar a escrita de opções longas na linha de comandos a
    usar nomes alternativos de comandos, ex. "alias ls='ls
    --time-style= +%d.%m.%y\ %H:%M'" (veja Secção 1.5.9, “Comando
    alias”).

    Dica
   
    ISO 8601 é seguido por estes formatos iso.

%

9.2.6. Echo de shell colorido

    A escrita da shell nos terminais mais modernos pode ser colorida
    a usar código de escape de ANSI (veja "/usr/share/doc/xterm/
    ctlseqs.txt.gz").

    Por exemplo, tente o seguinte:

    $ RED=$(printf "\x1b[31m")
    $ NORMAL=$(printf "\x1b[0m")
    $ REVERSE=$(printf "\x1b[7m")
    $ echo "${RED}RED-TEXT${NORMAL} ${REVERSE}REVERSE-TEXT${NORMAL}"

%

9.2.7. Comandos coloridos

    Comandos coloridos são úteis para inspeccionar os seus resultados
    no ambiente interativo. Incluí o seguinte no meu "~/.bashrc".

    if [ "$TERM" != "dumb" ]; then
        eval "`dircolors -b`"
        alias ls='ls --color=always'
        alias ll='ls --color=always -l'
        alias la='ls --color=always -A'
        alias less='less -R'
        alias ls='ls --color=always'
        alias grep='grep --color=always'
        alias egrep='egrep --color=always'
        alias fgrep='fgrep --color=always'
        alias zgrep='zgrep --color=always'
    else
        alias ll='ls -l'
        alias la='ls -A'
    fi

    O uso de alias limita os efeitos coloridos da utilização
    interactiva do comando. Tem vantagem sobre exportar a variável de
    ambiente "export GREP_OPTIONS='--color=auto'" porque a cor pode
    ser vista sob programas paginadores como o less(1). Se deseja
    suprimir a cor quando canaliza (pipe) para outros programas, use
    antes "--color=auto" no exemplo em cima para "~/.bashrc".

    Dica
   
    Pode desligar estes nomes alternativos coloridos no ambiente
    interativo ao invocar a shell com "TERM=dumb bash".

%

9.2.8. Recordar as atividades do editor para repetições complexas

    Pode recordar as atividades do editor para repetições complexas.

    Para o Vim, como a seguir.

      * "qa": inicia a gravação de caracteres teclados no registo
        nomeado "a".

      * ... atividades do editor

      * "q": termina a gravação de caracteres escritos.

      * "@a": executa o conteúdo do registo "a".

    Para Emacs, como a seguir.

      * "C-x (": começa a definir uma macro de teclado.

      * ... atividades do editor
   
      * "C-x )": termina de definir uma macro de teclado.

      * "C-x e": executa uma macro de teclado.

%

9.2.9. Gravar a imagem gráfica de uma aplicação X

    Existem algumas maneiras de gravar a imagem gráfica de uma
    aplicação X, a incluir um ecrã xterm.

    Tabela 9.5. Lista de ferramentas gráficas de manipulação de
    imagens

    +-------------------------------------------+
    |   pacote    |  popcon   |tamanho| comando |
    |-------------+-----------+-------+---------|
    |xbase-clients|I:26       |46     |xwd(1)   |
    |-------------+-----------+-------+---------|
    |gimp         |V:68, I:341|22313  |Menu GUI |
    |-------------+-----------+-------+---------|
    |imagemagick  |I:400      |218    |import(1)|
    |-------------+-----------+-------+---------|
    |scrot        |V:8, I:80  |70     |scrot(1) |
    +-------------------------------------------+


%

9.2.10. Gravar alterações em ficheiros de configuração

    Existem ferramentas especializadas para gravar alterações em
    ficheiros de configuração com a ajuda do sistema DVCS.

    Tabela 9.6. Lista de pacotes para gravar histórico de
    configuração em VCS

    +---------------------------------------------------------------+
    |  pacote   |popcon|tamanho|             descrição              |
    |-----------+------+-------+------------------------------------|
    |           |      |       |armazenar ficheiros de configuração |
    |etckeeper  |V:27, |162    |e os seus meta-dados com Git        |
    |           |I:32  |       |(predefinido), Mercurial, ou Bazaar |
    |           |      |       |(novo)                              |
    |-----------+------+-------+------------------------------------|
    |changetrack|V:0,  |71     |armazenar ficheiros de configuração |
    |           |I:0   |       |com RCS (antigo)                    |
    +---------------------------------------------------------------+


    Recomendo usar o pacote etckeeper com o git(1) o qual põe o "/
    etc" inteiro sob controle de VCS. O guia de instalação e tutorial
    dele encontram-se em "/usr/share/doc/etckeeper/README.gz".

    Essencialmente , executar "sudo etckeeper init" inicializa o
    repositório git para "/etc" tal como o processo explicado em
    Secção 10.6.5, “Git para gravar o histórico de configuração” mas
    com scripts hook especiais para configurações mais cuidadosas.

    Conforme muda a sua configuração, pode usar o git(1) normalmente
    para gravá-la. Ele também grava as alterações automaticamente de
    todas as vezes que executa comandos de gestão de pacote.

    Dica

    Pode explorar o histórico de alterações de "/etc" ao executar
    "sudo GIT_DIR=/etc/.git gitk" com visão clara para novos pacotes
    instalados, pacotes removidos e alterações da versão de pacotes.

%

9.3. Monitorizar, controlar e iniciar as atividades de programas

    As atividades de programas podem ser monitorizadas e controladas
    a usar ferramentas especiais.

    Tabela 9.7. Lista de ferramentas para monitorizar e controlar as
    atividades de programas

    +---------------------------------------------------------------+
    | pacote  |popcon|tamanho|              descrição               |
    |---------+------+-------+--------------------------------------|
    |coreutils|V:891,|17478  |nice(1): correr um programa com       |
    |         |I:999 |       |prioridade de agendamento modificada  |
    |---------+------+-------+--------------------------------------|
    |bsdutils |V:673,|393    |renice(1): modifica a prioridade de   |
    |         |I:999 |       |agendamento de um processo em execução|
    |---------+------+-------+--------------------------------------|
    |         |V:739,|       |"/proc" utilitários de sistema de     |
    |procps   |I:999 |792    |ficheiros: ps(1), top(1), kill(1) ,   |
    |         |      |       |watch(1), …                           |
    |---------+------+-------+--------------------------------------|
    |         |V:427,|       |"/proc" utilitários de sistema de     |
    |psmisc   |I:845 |679    |ficheiros: killall(1), fuser(1),      |
    |         |      |       |peekfd(1), pstree(1)                  |
    |---------+------+-------+--------------------------------------|
    |         |V:15, |       |time(1): corre um programa para       |
    |time     |I:279 |82     |reportar as utilizações de recursos do|
    |         |      |       |sistema no que respeita a tempo       |
    |---------+------+-------+--------------------------------------|
    |         |V:161,|       |sar(1), iostat(1), mpstat(1), …:      |
    |sysstat  |I:183 |1918   |ferramentas de performance do sistema |
    |         |      |       |para Linux                            |
    |---------+------+-------+--------------------------------------|
    |isag     |V:0,  |116    |Interactive System Activity Grapher   |
    |         |I:3   |       |para sysstat                          |
    |---------+------+-------+--------------------------------------|
    |         |V:391,|       |lsof(8): lista os ficheiro abertos por|
    |lsof     |I:946 |451    |um processo em execução a usar a opção|
    |         |      |       |"-p"                                  |
    |---------+------+-------+--------------------------------------|
    |strace   |V:16, |2367   |strace(1): rastreia chamadas e sinais |
    |         |I:153 |       |do sistema                            |
    |---------+------+-------+--------------------------------------|
    |ltrace   |V:1,  |363    |ltrace(1): rastreia chamadas de       |
    |         |I:21  |       |bibliotecas                           |
    |---------+------+-------+--------------------------------------|
    |xtrace   |V:0,  |353    |xtrace(1): rastreia a comunicação     |
    |         |I:0   |       |entre cliente X11 e servidor          |
    |---------+------+-------+--------------------------------------|
    |powertop |V:9,  |662    |powertop(1): informação sobre a       |
    |         |I:217 |       |utilização do sistema de energia      |
    |---------+------+-------+--------------------------------------|
    |         |V:805,|       |corre processos de acordo com uma     |
    |cron     |I:997 |263    |agenda nos bastidores a partir do     |
    |         |      |       |daemon cron(8)                        |
    |---------+------+-------+--------------------------------------|
    |         |V:409,|       |agenda de comandos tipo cron para     |
    |anacron  |I:482 |99     |sistemas que não funcionam 24 horas   |
    |         |      |       |por dia                               |
    |---------+------+-------+--------------------------------------|
    |         |V:162,|       |at(1) ou batch(1): executam um        |
    |at       |I:310 |161    |trabalho a uma hora especificada ou   |
    |         |      |       |abaixo de um certo nível de carga     |
    +---------------------------------------------------------------+


    Dica

    Os pacotes procps disponibilizam as bases de monitorizar,
    controlar e iniciar atividades de programas. Deve aprendê-las
    todas.

%

9.3.1. Temporizar um processo

    Mostrar o tempo usado pelo processo invocado pelo comando.

    # time qualquer_comando >/dev/null
    real    0m0.035s       # tempo no relógio (tempo real)
    user    0m0.000s       # tempo em modo de utilizador
    sys     0m0.020s       # tempo em modo de kernel

%

9.3.2. A prioridade de agendamento

    Um valor nice é usado para controlar a prioridade de agendamento
    para o processo.

    Tabela 9.8. Lista de valores nice para a prioridade de
    agendamento

    +---------------------------------------------------------------+
    |  o valor  |             prioridade de agendamento             |
    |   nice    |                                                   |
    |-----------+---------------------------------------------------|
    |19         |processo de prioridade menor (nice)                |
    |-----------+---------------------------------------------------|
    |0          |processo de prioridade muito alta para o utilizador|
    |-----------+---------------------------------------------------|
    |-20        |processo de prioridade muito alta para o root      |
    |           |(não-nice)                                         |
    +---------------------------------------------------------------+


    # nice  -19 top                                      # muito bom
    # nice --20 wodim -v -eject speed=2 dev=0,0 disk.img # muito rápido

    Por vezes um valor nice extremo faz mais danos que benefícios ao
    sistema. Use este comando com cuidado.

%

9.3.3. O comando ps

    O comando ps(1) num sistema Debian suporta ambas funcionalidades
    do BSD e SystemV e ajuda-o a identificar estaticamente a
    atividade do processo.

    Tabela 9.9. Lista dos estilos do comando ps

    +-----------------------------------------+
    | estilo |comando típico| funcionalidade  |
    |--------+--------------+-----------------|
    |BSD     |ps aux        |mostrar %CPU %MEM|
    |--------+--------------+-----------------|
    |System V|ps -efH       |mostra PPID      |
    +-----------------------------------------+


    Para o processo filho zombie (defunto), pode matá-lo pelo ID do
    processo pai identificado no campo "PPID".

    O comando pstree(1) mostra uma árvore de processos.

%

9.3.4. O comando top

    O top(1) no sistema Debian tem funcionalidades ricas e ajuda-o a
    identificar dinamicamente que processo está a actuar de modo
    esquisito.

    É um programa interativo de ecrã total. Pode obter a ajuda de
    utilização dele ao pressionar a tecla "h" e terminá-lo ao
    pressionar a tecla "q".

%

9.3.5. Listar ficheiros abertos por um processo

    Pode listar todos os ficheiros abertos por um processo com o ID
    do processo (PID), ex. 1, com o seguinte.

    $ sudo lsof -p 1

    PID=1 é geralmente o programa de init.

%

9.3.6. Rastear as atividades de programas

    Pode rastrear a atividade do programa com o strace(1), ltrace(1),
    ou xtrace(1) para chamadas de sistema e sinais, chamadas de
    bibliotecas, ou comunicação entre cliente e servidor do X11.

    Pode rastrear as chamadas do sistema do comando ls como a seguir.

    $ sudo strace ls

%

9.3.7. Identificação de um processo a usar ficheiros ou sockets

    Também pode identificar processos que usam ficheiros pelo fuser
    (1), ex. para "/var/log/mail.log" com o seguinte.

    $ sudo fuser -v /var/log/mail.log
                         USER        PID ACCESS COMMAND
    /var/log/mail.log:   root       2946 F.... rsyslogd

    Vê que o ficheiro "/var/log/mail.log" está aberto para escrita
    pelo comando rsyslogd(8).

    Também pode identificar processos que usam sockets pelo fuser(1),
    ex. para "smtp/tcp" com o seguinte.

    $ sudo fuser -v smtp/tcp
                         USER        PID ACCESS COMMAND
    smtp/tcp:            Debian-exim   3379 F.... exim4

    Agora sabe que o seu sistema executa o exim4(8) para lidar com as
    ligações TCP para a porta SMTP (25).

%

9.3.8. Repetir um comando com um intervalo constante

    O watch(1) executa um programa repetidamente num intervalo
    constante enquanto mostra os seus resultados em ecrã completo.

    $ watch w

    Isto mostra quem tem sessão iniciada (logged) no sistema e é
    atualizado a cada 2 segundos.

%

9.3.9. Repetir um ciclo de comandos sobre ficheiros

    Existem várias maneiras de repetir um ciclo de comandos sobre
    ficheiros que correspondem a alguma condição, ex. que
    correspondem ao modelo glob "*.ext".

      * Método for-loop da shell (veja Secção 12.1.4, “Ciclos (loops)
        da shell”):

    for x in *.ext; do if [ -f "$x"]; then command "$x" ; fi; done

      * combinação do find(1) e do xargs(1):

    find . -type f -maxdepth 1 -name '*.ext' -print0 | xargs -0 -n 1 command

      * find(1) com a opção "-exec" com um comando:

    find . -type f -maxdepth 1 -name '*.ext' -exec command '{}' \;

      * find(1) com a opção "-exec" com um script de shell curto:

    find . -type f -maxdepth 1 -name '*.ext' -exec sh -c "command '{}' && echo 'sucesso'" \;

    Os exemplos em cima foram escritos para assegurar o lidar
    apropriado dos nomes de ficheiros esquisitos como os que contêm
    espaços. Veja Secção 10.1.5, “Idiomas para a seleção de
    ficheiros” para utilizações mais avançadas do find(1).

%

9.3.10. Arrancar um programa a partir da GUI

    Para a interface de linha de comandos (CLI), é executado o
    primeiro programa com o nome correspondente encontrado nos
    diretórios especificados na variável de ambiente $PATH. Veja
    Secção 1.5.3, “A variável "$PATH"”.

    Para a interface gráfica de utilizador ((GUI) em conformidade com
    os standards do freedesktop.org, os ficheiros *.desktop no
    diretório /usr/share/applications/ fornecem os atributos
    necessários para se mostrar o menu GUI de cada programa. Veja
    Secção 7.2.2, “Menu Freedesktop.org”.

    Por exemplo, os atributos do ficheiro chromium.desktop para o
    "Navegador Web Chromium" tais como "Nome" para o nome do
    programa, "Exec" para o caminho de execução do programa e
    argumentos, "Icon" para o ícone usado, etc. (veja Desktop Entry
    Specification) como a seguir:

    [Desktop Entry]
    Version=1.0
    Name=Chromium Web Browser
    GenericName=Web Browser
    Comment=Access the Internet
    Comment[fr]=Explorer le Web
    Exec=/usr/bin/chromium %U
    Terminal=false
    X-MultipleArgs=false
    Type=Application
    Icon=chromium
    Categories=Network;WebBrowser;
    MimeType=text/html;text/xml;application/xhtml_xml;x-scheme-handler/http;x-scheme-handler/https;
    StartupWMClass=Chromium
    StartupNotify=true

    Esta é uma descrição muito simplificada. Os ficheiros *.desktop
    são examinados como a seguir:

    O ambiente de trabalho define as variáveis de ambiente
    $XDG_DATA_HOME e $XDG_DATA_DIR. Por exemplo, sob o GNOME 3:

      * $XDG_DATA_HOME é desconfigurada. (É usado o valor predefinido
        de $HOME/.local/share.)
   
      * $XDG_DATA_DIRS é definida para /usr/share/gnome:/usr/local/
        share/:/usr/share/.

    Para que os diretórios base (veja Especificação de Diretório Base
    XDG) e os diretórios applications sejam como a seguir:

      * $HOME/.local/share/ → $HOME/.local/share/applications/

      * /usr/share/gnome/ → /usr/share/gnome/applications/
   
      * /usr/local/share/ → /usr/local/share/applications/

      * /usr/share/ → /usr/share/applications/

    Os ficheiros *.desktop são examinados nestes diretórios
    applications por esta ordem.

    Dica

    Pode ser criada uma entrada personalizada no menu da GUI ao
    adicionar um ficheiro *.desktop no diretório $HOME/.local/share/
    applications/.

    Dica

    Se modo semelhante, se um ficheiro *.desktop for criado no
    diretório autostart sob esses diretórios base, o programa
    especificado no ficheiro *.desktop é executado automaticamente
    quando o ambiente de trabalho é iniciado. Veja Especificação de
    Arranque Automático de Aplicações do Ambiente de Trabalho.

    Dica

    De modo semelhante, se um ficheiro *.desktop for criado no
    diretório $HOME/Desktop e o ambiente de trabalho estiver
    configurado para suportar funcionalidade de lançamento por ícones
    do ambiente de trabalho, o programa especificado nele é executado
    ao se clicar no ícone. Por favor note que o nome real do
    diretório $HOME/Desktop é dependente da localização. Veja 
    xdg-user-dirs-update(1).

%

9.3.11. Personalizar o programa a ser iniciado

    Alguns programas iniciam outros programas automaticamente. Aqui
    estão alguns pontos de controle para personalizar este processo.

      * Menu de configuração da aplicação:

          + Ambiente GNOME3: "Definições" → "Sistema" → "Detalhes" →
            "Aplicações Predefinidas"

          + Ambiente KDE: "K" → "Centro de Controle" → "Componentes
            do KDE" → "selcionar Componente"

          + Navegador Iceweasel: "Editar" → "Preferências" →
            "Aplicações"

          + mc(1): "/etc/mc/mc.ext"

      * Variáveis de ambiente como a "$BROWSER", "$EDITOR", "$VISUAL"
        e "$PAGER" (veja eviron(7))

      * O sistema update-alternatives(1) para programas como o
        "editor", "view", "x-www-browser", "gnome-www-browser" e
        "www-browser" (veja Secção 1.4.7, “Definir um editor de texto
        predefinido”)

      * os conteúdos dos ficheiros "~/.mailcap" e "/etc/mailcap" com
        a associação do tipo MIME com o programa (veja mailcap(5))

      * Os conteúdos dos ficheiros "~/.mime.types" e "/etc/
        mime.types" que associam a extensão do nome do ficheiro com o
        tipo MIME (veja run-mailcap(1))

    Dica
   
    update-mime(8) atualiza o ficheiro "/etc/mailcap" a usar o
    ficheiro "/etc/mailcap.order" (veja mailcap.order(5)).

    Dica

    O pacote debianutils disponibiliza sensible-browser(1), 
    sensible-editor(1) e sensible-pager(1) que fazem decisões
    sensíveis sobre qual editor, paginador e explorador web chamar,
    respectivamente. Recomendo-lhe a leitura destes scripts de shell.

    Dica

    De modo a correr uma aplicação de consola como o mutt sob o X
    como a sua aplicação preferida, deve criar uma aplicação X como a
    seguir e definir "/usr/local/bin/mutt-term" como a sua aplicação
    preferida a ser iniciada como descrito.

    # cat /usr/local/bin/mutt-term <<EOF
    #!/bin/sh
    gnome-terminal -e "mutt \$@"
    EOF
    chmod 755 /usr/local/bin/mutt-term

%

9.3.12. Matar um processo

    Use kill(1) para matar (ou enviar um sinal para) um processo pelo
    ID do processo.

    Use killall(1) ou pkill(1) para fazer o mesmo pelo nome do
    comando do processo ou outro atributo.

    Tabela 9.10. Lista dos sinais frequentemente usados para o
    comando kill

    +---------------------------------------------+
    |valor do sinal|nome do sinal|     função     |
    |--------------+-------------+----------------|
    |1             |HUP          |reiniciar daemon|
    |--------------+-------------+----------------|
    |15            |TERM         |morte normal    |
    |--------------+-------------+----------------|
    |9             |KILL         |morte forçada   |
    +---------------------------------------------+


%

9.3.13. Agendar tarefas uma vez

    Corra o comando at(1) para agendar uma tarefa de uma-vez com o
    seguinte.

    $ echo 'command -args'| at 3:40 monday

%

9.3.14. Agendar tarefas regularmente

    Use cron(8) para agendar tarefas regularmente. Veja crontab(1) e 
    crontab(5).

    Pode agendar a execução de processos como um utilizador normal,
    ex. foo ao criar um ficheiro crontab(5) como "/var/spool/cron/
    crontabs/foo" com o comando "crontab -e".

    Aqui está um exemplo de um ficheiro crontab(5).

    # use /bin/sh to run commands, no matter what /etc/passwd says
    SHELL=/bin/sh
    # mail any output to paul, no matter whose crontab this is
    MAILTO=paul
    # Min Hour DayOfMonth Month DayOfWeek command (Day... are OR'ed)
    # run at 00:05, every day
    5  0  *  * *   $HOME/bin/daily.job >> $HOME/tmp/out 2>&1
    # run at 14:15 on the first of every month -- output mailed to paul
    15 14 1  * *   $HOME/bin/monthly
    # run at 22:00 on weekdays(1-5), annoy Joe. % for newline, last % for cc:
    0 22 *   * 1-5 mail -s "It's 10pm" joe%Joe,%%Where are your kids?%.%%
    23 */2 1 2 *   echo "run 23 minutes after 0am, 2am, 4am ..., on Feb 1"
    5  4 *   * sun echo "run at 04:05 every Sunday"
    # run at 03:40 on the first Monday of each month
    40 3 1-7 * *   [ "$(date +%a)" == "Mon" ] && command -args

    Dica

    Para o sistema que não corre continuamente, instale o pacote
    anacron para agendar comandos periódicos a intervalos
    especificados o mais próximo que os tempos de ligação de máquina
    permitem. Veja anacron(8) e anacrontab(5).

    Dica

    Para scripts agendados de manutenção do sistema, pode executá-los
    periodicamente a partir da conta root ao pôr tais scripts em "/
    etc/cron.hourly/", "/etc/cron.daily/", "/etc/cron.weekly/", ou "/
    etc/cron.monthly/". Os tempos de execução destes scripts podem
    ser personalizados pelo "/etc/crontab" e "/etc/anacrontab".

%

9.3.15. Tecla Alt-SysRq

    A segurança contra falhas do sistema é disponibiliza pela opção
    de compilação do kernel "Magic SysRq key" (tecla SAK) a qual é
    agora a predefinição para o kernel Debian. Pressionar Alt-SysRq
    seguido de uma das seguintes teclas faz a magia de recuperar o
    controle do sistema.

    Tabela 9.11. Lista de teclas de comando SAK

    +---------------------------------------------------------------+
    |tecla que segue|              descrição da acção               |
    |  a Alt-SysRq  |                                               |
    |---------------+-----------------------------------------------|
    |r              |restaurar o teclado a partir de modo raw após  |
    |               |crash do X                                     |
    |---------------+-----------------------------------------------|
    |0              |mudar o nível de log da consola para 0 para    |
    |               |reduzir as mensagens de erro                   |
    |---------------+-----------------------------------------------|
    |k              |kill (mata) todos os processos da consola      |
    |               |virtual atual                                  |
    |---------------+-----------------------------------------------|
    |e              |enviar um SIGTERM a todos os processos, excepto|
    |               |para init(8)                                   |
    |---------------+-----------------------------------------------|
    |i              |enviar um SIGKILL a todos os processos, excepto|
    |               |para init(8)                                   |
    |---------------+-----------------------------------------------|
    |s              |sincroniza todos os sistemas de ficheiros      |
    |               |montados para evitar corrupção de dados        |
    |---------------+-----------------------------------------------|
    |u              |remontar todos os sistemas de ficheiros        |
    |               |montados em modo de apenas-leitura (umount)    |
    |---------------+-----------------------------------------------|
    |b              |reboot (reiniciar) o sistema sem sincronização |
    |               |ou desmontagem                                 |
    +---------------------------------------------------------------+


    Dica
   
    Leia os manuais de signal(7), kill(1) e sync(1) para compreender
    a descrição em cima.

    A combinação de "Alt-SysRq s", "Alt-SysRq u" e "Alt-SysRq r" é
    boa para sair de situações realmente más e ganhar acesso
    utilizável ao teclado sem parar o sistema.

    Veja "/usr/share/doc/linux-doc-3.*/Documentation/sysrq.txt.gz".

    Cuidado

    A funcionalidade Alt-SysRq pode ser considerada um risco de
    segurança ao permitir que os utilizadores tenham acesso a funções
    com privilégios de root. Pôr "echo 0 >/proc/sys/kernel/sysrq" em
    "/etc/rc.local" ou "kernel.sysrq = 0" em "/etc/sysctl.conf"
    desactiva a funcionalidade Alt-SysRq.

    Dica

    A partir de um terminal SSH etc., pode usar a funcionalidade
    Alt-SysRq ao escrever para o "/proc/sysrq-trigger". Por exemplo,
    "echo s > /proc/sysrq-trigger; echo u > /proc/sysrq-trigger" a
    partir do aviso da shell de root ssincroniza e umounts (desmonta)
    todos os sistemas de ficheiros montados.

9.4. Dicas de manutenção do sistema

%

9.4.1. Quem está no sistema?

    Pode verificar quem está no sistema com o seguinte.

      * who(1) mostra quem tem sessão iniciada.

      * w(1) mostra quem tem sessão iniciada e o que estão a fazer.

      * last(1) mostra a listagem do último utilizador a iniciar
        sessão.

      * lastb(1 )mostra a listagem dos últimos utilizadores a
        falharem o inicio de sessão.

    Dica
   
    "/var/run/utmp" e "/var/log/wtmp" detém tal informação do
    utilizador. Veja login(1) e utmp(5).

%

9.4.2. Avisar todos

    Pode mandar uma mensagem para todos os que têm sessão iniciada no
    sistema com wall(1) com o seguinte.

    $ echo "Vamos desligar dentro de 1 hora" | wall

%

9.4.3. Identificação do hardware

    Para os aparelhos tipo PCI (AGP, PCI-Express, CardBus,
    ExpressCard, etc.), o lspci(8) (provavelmente com a opção "-nn")
    é um bom inicio para a identificação do hardware.

    Alternativamente, pode identificar o hardware ao ler os conteúdos
    de "/proc/bus/pci/devices" ou explorar a árvore de diretórios sob
    "/sys/bus/pci" (veja Secção 1.2.12, “procfs e sysfs”).

    Tabela 9.12. Lista de ferramenta de identificação de hardware

    +---------------------------------------------------------------+
    |  pacote   |popcon |tamanho|             descrição             |
    |-----------+-------+-------+-----------------------------------|
    |pciutils   |V:195, |196    |Utilitários PCI do Linux: lspci(8) |
    |           |I:992  |       |                                   |
    |-----------+-------+-------+-----------------------------------|
    |usbutils   |V:84,  |324    |Utilitários USB do Linux: lsusb(8) |
    |           |I:862  |       |                                   |
    |-----------+-------+-------+-----------------------------------|
    |pcmciautils|V:13,  |97     |Utilitários PCMCIA par Linux:      |
    |           |I:21   |       |pccardctl(8)                       |
    |-----------+-------+-------+-----------------------------------|
    |scsitools  |V:0,   |390    |colecção de ferramentas para gestão|
    |           |I:3    |       |de hardware SCSI: lsscsi(8)        |
    |-----------+-------+-------+-----------------------------------|
    |procinfo   |V:0,   |135    |informação do sistema obtida de "/ |
    |           |I:13   |       |proc": lsdev(8)                    |
    |-----------+-------+-------+-----------------------------------|
    |lshw       |V:12,  |842    |informação acerca da configuração  |
    |           |I:94   |       |do hardware: lshw(1)               |
    |-----------+-------+-------+-----------------------------------|
    |discover   |V:41,  |90     |sistema de identificação de        |
    |           |I:947  |       |hardware: discover(8)              |
    +---------------------------------------------------------------+


%

9.4.4. Configuração do hardware

    Apesar da maioria da configuração de hardware nos sistemas de
    ambiente de trabalho GUI modernos como o GNOME e KDE poder ser
    gerida através de acompanhamento por ferramentas de configuração
    com GUI, é uma boa ideia conhecer alguns métodos básicos de o
    configurar.

    Tabela 9.13. Lista de ferramentas de configuração do hardware

    +---------------------------------------------------------------+
    |     pacote      |popcon|tamanho|          descrição           |
    |-----------------+------+-------+------------------------------|
    |                 |V:137,|       |tipo de letra da consola Linux|
    |console-setup    |I:959 |411    |e utilitários da tabela de    |
    |                 |      |       |teclas                        |
    |-----------------+------+-------+------------------------------|
    |x11-xserver-utils|V:282,|511    |Utilitários do servidor X:    |
    |                 |I:534 |       |xset(1), xmodmap(1)           |
    |-----------------+------+-------+------------------------------|
    |                 |      |       |daemon para gerir eventos     |
    |acpid            |V:145,|176    |entregues pelo Advanced       |
    |                 |I:318 |       |Configuration and Power       |
    |                 |      |       |Interface (ACPI)              |
    |-----------------+------+-------+------------------------------|
    |acpi             |V:17, |45     |utilitário para mostrar       |
    |                 |I:302 |       |informação em aparelhos ACPI  |
    |-----------------+------+-------+------------------------------|
    |                 |V:0,  |       |daemon para pôr um portátil em|
    |sleepd           |I:0   |86     |modo de adormecimento durante |
    |                 |      |       |a inatividade                 |
    |-----------------+------+-------+------------------------------|
    |                 |V:408,|       |optimização do acesso ao disco|
    |hdparm           |I:718 |256    |rígido (veja Secção 9.5.9,    |
    |                 |      |       |“Optimização do disco rígido”)|
    |-----------------+------+-------+------------------------------|
    |                 |V:134,|       |controlar e monitorizar       |
    |smartmontools    |I:197 |2117   |sistemas de armazenamento a   |
    |                 |      |       |usar S.M.A.R.T.               |
    |-----------------+------+-------+------------------------------|
    |setserial        |V:5,  |117    |colecção de ferramentas para  |
    |                 |I:9   |       |gestão de portas série        |
    |-----------------+------+-------+------------------------------|
    |memtest86+       |V:1,  |2391   |colecção de ferramentas para  |
    |                 |I:29  |       |gestão de hardware de memória |
    |-----------------+------+-------+------------------------------|
    |scsitools        |V:0,  |390    |colecção de ferramentas para  |
    |                 |I:3   |       |gestão de hardware SCSI       |
    |-----------------+------+-------+------------------------------|
    |setcd            |V:0,  |35     |optimização de acesso a drives|
    |                 |I:1   |       |de discos compactos           |
    |-----------------+------+-------+------------------------------|
    |big-cursor       |I:1   |27     |cursores de rato maiores para |
    |                 |      |       |o X                           |
    +---------------------------------------------------------------+


    Aqui, o ACPI é uma estrutura mais recente para o sistema de
    gestão de energia que o APM.

    Dica
   
    O escalar de frequências da CPU em sistemas modernos é governado
    por módulos do kernel como o acpi_cpufreq.

%

9.4.5. Hora do sistema e do hardware

    O seguinte define a hora do sistema e hardware para MM/DD hh:mm,
    AAAA.

    # date MMDDhhmmAAAA
    # hwclock --utc --systohc
    # hwclock --show

    A horas são mostradas normalmente na hora local no sistema Debian
    mas o hardware e a hora do sistema geralmente usam UTC(GMT).

    Se a hora do hardware (BIOS) estiver definida para UTC, mude a
    definição para "UTC=yes" em "/etc/default/rcS".

    O seguinte reconfigura a zona horária usada pelo sistema Debian.

    # dpkg-reconfigure tzdata

    Se desejar atualizar a hora do sistema através da rede, considere
    usar o serviço NTP como pacotes como os ntp, ntpdate e chrony.

    Dica
   
    Sob systemd, use systemd-timesyncd para a sincronização da hora
    com a rede. Veja systemd-timesyncd(8).

    Veja o seguinte.

      * Como Gerir a Data e Hora com Precisão

      * NTP Public Services Project

      * O pacote ntp-doc

    Dica
   
    O ntptrace(8) no pacote ntp pode rastrear uma cadeia de
    servidores NTP até à sua fonte principal.

%

9.4.6. A configuração do terminal

    Existem vários componentes para configurar a consola de
    caracteres e as funcionalidades do sistema ncurses(3).

      * O ficheiro "/etc/terminfo/*/*" (terminfo(5))

      * A variável de ambiente "$TERM" (term(7))

      * setterm(1), stty(1), tic(1) e toe(1)

    Se a entrada terminfo para o xterm não funcionar com um xterm não
    Debian, mude o seu tipo e terminal, "$TERM", de "xterm" para uma
    das versões de funcionalidades limitadas como o "xterm-r6" quando
    iniciar sessão num sistema Debian remotamente. Veja "/usr/share/
    doc/libncurses5/FAQ" para mais. O "dumb" é o denominador comum
    mais baixo para "$TERM".

%

9.4.7. A infraestrutura de som

    As drivers para placas de som para o Linux atual são
    disponibilizadas pelo Advanced Linux Sound Architecture (ALSA).
    ALSA disponibiliza um modo de emulação para o anterior Open Sound
    System (OSS) para compatibilidade.

    Dica
   
    Use "cat /dev/urandom > /dev/audio" ou speaker-test(1) para
    testar os altifalantes (^C para parar).

    Dica

    Se não conseguir obter som, os seus altifalantes podem estar
    ligados a uma saída silenciada (mute). Os sistemas de som
    modernos têm muitas saídas. O alsamixer(1) no pacote alsa-utils é
    útil para configurar as definições de volume e mute.

    As aplicações de software podem ser configuradas para não só
    aceder directamente a aparelhos de som, mas também para
    aceder-les através de alguns sistemas servidores de som
    normalizados.

    Tabela 9.14. Lista de pacotes de som

    +---------------------------------------------------------------+
    |     pacote      |popcon|tamanho|          descrição           |
    |-----------------+------+-------+------------------------------|
    |alsa-utils       |V:341,|2283   |utilitários para configurar e |
    |                 |I:476 |       |utilizar ALSA                 |
    |-----------------+------+-------+------------------------------|
    |                 |V:2,  |       |compatibilidade de OSS sob    |
    |oss-compat       |I:29  |20     |ALSA para prevenir erros de "/|
    |                 |      |       |dev/dsp não encontrado"       |
    |-----------------+------+-------+------------------------------|
    |jackd            |V:4,  |9      |servidor (baixa latência) JACK|
    |                 |I:27  |       |Audio Connection Kit. (JACK)  |
    |-----------------+------+-------+------------------------------|
    |                 |V:1,  |       |biblioteca (baixa latência)   |
    |libjack0         |I:13  |338    |JACK Audio Connection Kit.    |
    |                 |      |       |(JACK)                        |
    |-----------------+------+-------+------------------------------|
    |nas              |V:0,  |243    |servidor Network Audio System |
    |                 |I:0   |       |(NAS)                         |
    |-----------------+------+-------+------------------------------|
    |libaudio2        |V:60, |165    |biblioteca Network Audio      |
    |                 |I:488 |       |System (NAS)                  |
    |-----------------+------+-------+------------------------------|
    |pulseaudio       |V:350,|6398   |servidor PulseAudio,          |
    |                 |I:471 |       |substituto para o ESD         |
    |-----------------+------+-------+------------------------------|
    |libpulse0        |V:289,|969    |biblioteca cliente PulseAudio,|
    |                 |I:604 |       |substituto para o ESD         |
    |-----------------+------+-------+------------------------------|
    |libgstreamer1.0-0|V:372,|5280   |GStreamer: motor de som do    |
    |                 |I:574 |       |GNOME                         |
    |-----------------+------+-------+------------------------------|
    |libphonon4       |I:121 |680    |Phonon: motor de som do KDE   |
    +---------------------------------------------------------------+


    Existe normalmente um motor de som comum para cada ambiente de
    trabalho popular. Cada motor de som usado pela aplicação pode
    escolher ligar a diferentes servidores de som.

%

9.4.8. desativar o protector de ecrã (screensaver)

    Para desativar o protector de ecrã, utilize os seguintes
    comandos.

    Tabela 9.15. Lista de comandos para desativar o protector de ecrã

    +---------------------------------------------------------------+
    |                ambiente                 |       comando       |
    |-----------------------------------------+---------------------|
    |A consola do Linux                       |setterm -powersave   |
    |                                         |off                  |
    |-----------------------------------------+---------------------|
    |O X Window (desativar o protector de     |xset s off           |
    |ecrã)                                    |                     |
    |-----------------------------------------+---------------------|
    |O X Window (desativar o dpms)            |xset -dpms           |
    |-----------------------------------------+---------------------|
    |O X Window (GUI de configuração do       |xscreensaver-command |
    |protector de ecrã)                       |-prefs               |
    +---------------------------------------------------------------+


%

9.4.9. desativar os sons de beep

    Pode-se sempre desligar o altifalante do PC para desativar os
    apitos. Remover o módulo de kernel pcspkr faz isso por si.

    O seguinte previne o programa readline(3) usado pelo bash(1) de
    apitar quando encontra um caractere de alerta (ASCII=7).

    $ echo "set bell-style none">> ~/.inputrc

%

9.4.10. Utilização da memória

    Existem 2 recursos disponíveis para obter o estado da utilização
    de memória.

      * A mensagem de arranque do kernel em "/var/log/dmesg" contém o
        tamanho total exacto da memória disponível.
   
      * free(1) e top(1) mostram informação sobre os recursos de
        memória no sistema em execução.

    Aqui está um exemplo.

    # grep '\] Memory' /var/log/dmesg
    [    0.004000] Memory: 990528k/1016784k available (1975k kernel code, 25868k reserved, 931k data, 296k init)
    $ free -k
                 total       used       free     shared    buffers     cached
    Mem:        997184     976928      20256          0     129592     171932
    -/+ buffers/cache:     675404     321780
    Swap:      4545576          4    4545572

    Pode estar a pensar "o dmesg fala-me em 990 MB livres e o free -k
    diz 320 MB livres. Faltam mais de 600 MB ...".

    Não se preocupe com o grande tamanho de "used" e o pequeno
    tamanho de "free" na linha "Mem:", mas leia a que está sob elas
    (675404 e 321780 no exemplo em cima) e relaxe.

    Para o meu MacBook com 1GB=1048576k de DRAM (o sistema de vídeo
    rouba alguma), vejo o seguinte.

    Tabela 9.16. Lista dos tamanhos de memória reportados

    +---------------------------------------------------------+
    |      relatório       |             tamanho              |
    |----------------------+----------------------------------|
    |Tamanho total no dmesg|1016784k = 1GB - 31792k           |
    |----------------------+----------------------------------|
    |Livre no dmesg        |990528k                           |
    |----------------------+----------------------------------|
    |Total sob a shell     |997184k                           |
    |----------------------+----------------------------------|
    |Livre sob a shell     |20256k (mas efectivamente 321780k)|
    +---------------------------------------------------------+


%

9.4.11. Segurança do sistema e verificação de integridade

    Uma manutenção pobre do sistema pode expor o seu sistema à
    exploração externa.

    Para segurança do sistema e verificação de integridade, deve
    começar com o seguinte.

      * O pacote debsums, veja debsums(1) e Secção 2.5.2, “Ficheiro
        "Release" de nível de topo e autenticidade:”.

      * O pacote chkrootkit, veja chkrootkit(1).
   
      * A família de pacotes clamav, veja clamscan(1) e freshclam(1).

      * FAQ de Segurança Debian.

      * Manual de Segurança Debian.

    Tabela 9.17. Lista de ferramentas para segurança do sistema e
    verificação de integridade

    +---------------------------------------------------------------+
    |  pacote  |popcon|tamanho|              descrição              |
    |----------+------+-------+-------------------------------------|
    |          |V:8,  |       |daemon para enviar as anomalias nos  |
    |logcheck  |I:10  |102    |ficheiros de log do sistema ao       |
    |          |      |       |administrador por mail               |
    |----------+------+-------+-------------------------------------|
    |          |V:5,  |       |utilitário para verificar os pacotes |
    |debsums   |I:42  |107    |instalados contra chaves de          |
    |          |      |       |verificação MD5                      |
    |----------+------+-------+-------------------------------------|
    |chkrootkit|V:5,  |970    |detector de rootkit                  |
    |          |I:24  |       |                                     |
    |----------+------+-------+-------------------------------------|
    |clamav    |V:13, |774    |utilitário de anti-vírus para Unix - |
    |          |I:58  |       |interface de linha de comandos       |
    |----------+------+-------+-------------------------------------|
    |tiger     |V:2,  |7822   |relatar vulnerabilidades de segurança|
    |          |I:3   |       |do sistema                           |
    |----------+------+-------+-------------------------------------|
    |tripwire  |V:2,  |11521  |verificador de integridade de        |
    |          |I:3   |       |ficheiros e diretórios               |
    |----------+------+-------+-------------------------------------|
    |john      |V:2,  |452    |ferramenta activa de crack de        |
    |          |I:12  |       |palavras-passe                       |
    |----------+------+-------+-------------------------------------|
    |aide      |V:1,  |2063   |Ambiente de Detecção de Intrusão     |
    |          |I:2   |       |Avançado - binário estático          |
    |----------+------+-------+-------------------------------------|
    |integrit  |V:0,  |329    |programa de verificação de           |
    |          |I:0   |       |integridade de ficheiros             |
    |----------+------+-------+-------------------------------------|
    |crack     |V:0,  |149    |programa de adivinhação de           |
    |          |I:1   |       |palavra-passe                        |
    +---------------------------------------------------------------+


    Aqui está um script simples para verificar as típicas permissões
    de ficheiros escritas incorrectamente.

    # find / -perm 777 -a \! -type s -a \! -type l -a \! \( -type d -a -perm 1777 \)

    Cuidado

    Como o pacote debsums usa sumários de verificação MD5 armazenados
    localmente, não pode ser de total confiança como ferramenta de
    auditoria à segurança do sistema contra ataques maliciosos.

%

9.5. Dicas de armazenamento de dados

    Arrancar o seu sistema com live CDs de Linux ou CDs de instalação
    de debian em modo de recuperação torna fácil para si reconfigurar
    o armazenamento de dados no seu aparelho de arranque.

%

9.5.1. Utilização do espaço em disco

    A utilização do espaço em disco pode ser avaliada por programas
    disponibilizados pelos pacotes mount, coreutils e xdu:

      * mount(8) reporta todos os sistemas de ficheiros montados (=
        discos).

      * df(1) reporta a utilização do espaço em disco para o sistema
        de ficheiros.

      * du(1) reporta a utilização do espaço em disco para a árvore
        do diretório.

    Dica

    Pode alimentar a saída de du(8) a xdu(1x) para produzir a
    apresentação gráfica dele e interactiva com "du -k . |xdu", "sudo
    du -k -x / |xdu", etc.

%

9.5.2. Configuração das partições do disco

    Para configuração de partições de disco, apesar do fdisk(8) ser
    considerado o standard, o parted(8) merece alguma atenção. "Dados
    de particionamento do disco", "Tabela de partições", "Mapa de
    partições" e "Etiqueta do disco" são todos sinónimos.

    A maioria dos PCs usa o esquema clássico do Master Boot Record
    (MBR) para manter os dados de partições do disco no primeiro
    sector, isto é, LBA sector 0 (512 bytes).

    Nota

    Alguns PCs novos com Extensible Firmware Interface (EFI),
    incluindo os Macs baseados em Intel, usam o esquema GUID
    Partition Table (GPT) para manter os dados de partições do disco
    não no primeiro sector.

    Apesar do fdisk(8) ter sido o standard como ferramenta de
    particionamento de disco, o parted(8) está a substituí-lo.

    Tabela 9.18. Lista de pacotes de gestão de partições do disco

    +---------------------------------------------------------------+
    |  pacote  |popcon|tamanho|   GPT   |         descrição         |
    |----------+------+-------+---------+---------------------------|
    |          |V:891,|       |Não      |vários utilitários de      |
    |util-linux|I:999 |4598   |suportado|sistema incluindo fdisk(8) |
    |          |      |       |         |e cfdisk(8)                |
    |----------+------+-------+---------+---------------------------|
    |          |V:363,|       |         |GNU Parted programa de     |
    |parted    |I:561 |304    |Suportado|redimensionamento de       |
    |          |      |       |         |partições do disco         |
    |----------+------+-------+---------+---------------------------|
    |gparted   |V:19, |2046   |Suportado|Editor de partições do     |
    |          |I:132 |       |         |GNOME baseado na libparted |
    |----------+------+-------+---------+---------------------------|
    |gdisk     |V:278,|852    |Suportado|editor de partições para o |
    |          |I:513 |       |         |disco GPT                  |
    |----------+------+-------+---------+---------------------------|
    |          |V:16, |       |         |programa para criar        |
    |kpartx    |I:29  |87     |Suportado|mapeamentos de aparelho    |
    |          |      |       |         |para partições             |
    +---------------------------------------------------------------+


    Cuidado

    Apesar do parted(8) afirmar também criar e redimensionar sistemas
    de ficheiros, é mais seguro fazer tais coisas a usar ferramentas
    especializadas e com melhor manutenção como as ferramentas mkfs
    (8) (mkfs.msdos(8), mkfs.ext2(8), mkfs.ext3(8), mkfs.ext4(8), …)
    e resize2fs(8).

    Nota

    De modo a mudar entre GPT e MBR, precisa de apagar os primeiros
    blocos de conteúdo do disco directamente (veja Secção 9.7.6,
    “Limpar conteúdo de ficheiro”) e usar "parted /dev/sdx mklabel
    gpt" ou "parted /dev/sdx mklabel msdos" para o definir. Por favor
    note que "msdos" é usado aqui para o MBR.

%

9.5.3. Aceder a partição a usar UUID

    Apesar da reconfiguração da sua partição ou ordem de activação de
    medias de armazenamento amovíveis poder apresentar nomes
    diferentes para as partições, pode aceder-lhes de modo
    consistente. Isto é também útil se tem múltiplos discos e a sua
    BIOS não lhes fornecer nomes de aparelho consistentes.

      * mount(8) com a opção "-U" pode montar um aparelho de bloco a
        usar o UUID, em vez de usar o nome de ficheiro dele tal como
        "/dev/sda3".
   
      * "/etc/fstab" (veja fstab(5)) pode usar UUID.

      * Os gestores de arranque (Secção 3.1.2, “Estágio 2: o gestor
        de arranque”) também podem usar UUID.

    Dica
   
    Pode testar o UUID de um aparelho especial de bloco com blkid(8).

    Dica

    Nós de aparelhos de aparelhos como medias de armazenamento
    amovíveis podem ser tornados estáticos ao usar regras do udev,
    caso necessário. Veja Secção 3.3, “O sistema udev”.

%

9.5.4. LVM2

    LVM2 é um gestor de volumes lógicos para o kernel Linux. Com o
    LVM2, podem ser criadas partições de disco em volumes lógicos em
    vez de discos rijos físicos.

    O LVM requer o seguinte.

      * suporte a device-mapper no kernel Linux (predefinido para os
        kernels Debian)

      * a biblioteca de suporte a device-mapper no espaço de
        utilizador (pacote (libdevmapper*)

      * as ferramentas LVM2 do espaço de utilizador (pacote lvm2)

    Por favor comece a aprender LVM2 a partir dos seguintes manuais.

      * lvm(8): Bases do mecanismo LVM2 (lista de todos os comandos
        LVM2)

      * lvm.conf(5): Ficheiro de configuração para LVM2
   
      * lvs(8): Reporta informação acerca de volumes lógicos

      * vgs(8): Reporta informação acerca de grupos de volumes

      * pvs(8): Reporta informação acerca de volumes físicos

%

9.5.5. Configuração do sistema de ficheiros

    Para o sistema de ficheiro ext4, o pacote e2fsprogs disponibiliza
    o seguinte.

      * mkfs.ext4(8) para criar um novo sistema de ficheiros ext4

      * fsck.ext4(8) para verificar e reparar um sistema de ficheiros
        ext4 existente

      * tune2fs(8) para configurar o super-bloco do sistema de
        ficheiros ext4

      * debugfs(8) para depurar um sistema de ficheiros ext4
        interativamente. (Era o comando undel para recuperar
        ficheiros apagados.)

    Os comandos mkfs(8) e fsck(8) são disponibilizados pelo pacote
    e2fsprogs como frontends para vários programas dependentes do
    sistema de ficheiros (mkfs.fstype e fsck.fstype). Para o sistema
    de ficheiros ext4 existem os mkfs.ext4(8) e o fsck.ext4(8) (estão
    ligados simbolicamente ao mke2fs(8) and e2fsck(8)).

    Estão disponíveis comandos semelhantes para cada sistema de
    ficheiros suportado pelo Linux.

    Tabela 9.19. Lista de pacotes de gestão de sistemas de ficheiros

    +---------------------------------------------------------------+
    |   pacote    |popcon|tamanho|            descrição             |
    |-------------+------+-------+----------------------------------|
    |e2fsprogs    |V:576,|1449   |utilitários para os sistemas de   |
    |             |I:999 |       |ficheiros ext2/ext3/ext4          |
    |-------------+------+-------+----------------------------------|
    |reiserfsprogs|V:11, |1132   |utilitários para o sistema de     |
    |             |I:29  |       |ficheiros Reiserfs                |
    |-------------+------+-------+----------------------------------|
    |             |V:128,|       |utilitários para o sistema de     |
    |dosfstools   |I:524 |235    |ficheiros FAT. (Microsoft: MS-DOS,|
    |             |      |       |Windows)                          |
    |-------------+------+-------+----------------------------------|
    |xfsprogs     |V:21, |3191   |utilitários para o sistema de     |
    |             |I:98  |       |ficheiros XFS. (SGI: IRIX)        |
    |-------------+------+-------+----------------------------------|
    |             |V:186,|       |utilitários para o sistema de     |
    |ntfs-3g      |I:512 |1479   |ficheiros NTFS. (Microsoft:       |
    |             |      |       |Windows NT, …)                    |
    |-------------+------+-------+----------------------------------|
    |jfsutils     |V:1,  |1577   |utilitários para o sistema de     |
    |             |I:12  |       |ficheiros JFS. (IBM: AIX, OS/2)   |
    |-------------+------+-------+----------------------------------|
    |reiser4progs |V:0,  |1373   |utilitários para o sistema de     |
    |             |I:4   |       |ficheiros Reiser4                 |
    |-------------+------+-------+----------------------------------|
    |             |V:0,  |       |utilitários para os sistemas de   |
    |hfsprogs     |I:8   |356    |ficheiros HFS e HFS Plus. (Apple: |
    |             |      |       |Mac OS)                           |
    |-------------+------+-------+----------------------------------|
    |btrfs-progs  |V:38, |4027   |utilitários para o sistema de     |
    |             |I:64  |       |ficheiros btrfs                   |
    |-------------+------+-------+----------------------------------|
    |zerofree     |V:3,  |25     |programa para zerar blocos livres |
    |             |I:94  |       |de sistemas de ficheiros ext2/3/4 |
    +---------------------------------------------------------------+


    Dica

    O sistema de ficheiros Ext4 é o sistema de ficheiros predefinido
    para o sistema Linux e a utilização é fortemente recomendada a
    menos que tenha razões especificas para não o fazer.

    Dica

    O sistema de ficheiros Btrfs está disponível no kernel Linux 3.2
    (Debian wheezy). É esperado que seja o próximo sistema de
    ficheiros predefinido após o sistema de ficheiros ext4.

    Atenção

    Não deve utilizar o sistema de ficheiros Btrfs para os seus dados
    críticos antes de este obter a funcionalidade de fsck(8) do
    kernel ao vivo e suporte de gestores de arranque.

    Dica

    Algumas ferramentas permitem acesso a sistemas de ficheiros sem
    suporte do kernel do Linux (veja Secção 9.7.2, “Manipular
    ficheiros sem montar o disco”).

%

9.5.6. Criação do sistema de ficheiros e verificação de integridade

    O comando mkfs(8) cria o sistema de ficheiros num sistema Linux.
    O comando fsck(8) disponibiliza a verificação de integridade e
    reparação do sistema de ficheiros num sistema Linux.

    Debian agora, por predefinição, não faz fsck periódicos após a
    criação do sistema de ficheiros.

    Cuidado
   
    Geralmente não é seguro correr o fsck em sistemas de ficheiros
    montados.

    Dica

    Pode executar o comando fsck(8) com segurança em todos os
    sistemas de ficheiros incluindo o sistema raiz durante o arranque
    da máquina ao definir "enable_periodic_fsck" em "/etc/
    mke2fs.conf" e a contagem máxima de montagens para 0 a usar
    "tune2fs -c0 /dev/<partition_name>". Veja mke2fs.conf(5) e 
    tune2fs(8).

    Dica
   
    Verifique os ficheiros em "/var/log/fsck/" pelos resultados do
    comando fsck(8) executado do script de arranque.

%

9.5.7. Optimização do sistema de ficheiros por opções de montagem

    A configuração estática básica dos sistemas de ficheiros é dada
    por "/etc/fstab". Por exemplo,

    # <file system> <mount point>   <type>  <options>       <dump>  <pass>
    proc            /proc           proc    defaults        0       0
    UUID=709cbe4c-80c1-56db-8ab1-dbce3146d2f7 / ext4 noatime,errors=remount-ro 0 1
    UUID=817bae6b-45d2-5aca-4d2a-1267ab46ac23 none swap sw  0       0
    /dev/scd0       /media/cdrom0   udf,iso9660 user,noauto 0       0

    Dica

    O UUID (veja Secção 9.5.3, “Aceder a partição a usar UUID”) pode
    ser utilizado para identificar um aparelho de bloco em vez de
    nomes vulgares de aparelhos de bloco, tal como "/dev/sda1", "/dev
    /sda2",…

    A performance e características de um sistema de ficheiros pode
    ser optimizada pelas opções de montagem usadas (veja fstab(5) e 
    mount(8)). As mais notáveis são as seguintes.

      * A opção "defaults" implica opções predefinidas:
        "rw,suid,dev,exec,auto,nouser,async". (geral)

      * A opção "noatime" ou "relatime" é muito eficaz para acelerar
        o acesso de leitura. (geral)

      * A opção "user" permite que um utilizador normal monte o
        sistema de ficheiros. Esta opção implica a combinação com a
        opção "noexec,nosuid,nodev". (geralmente, usada para CDs ou
        aparelhos de armazenamento usb)

      * A combinação de opções "noexec,nodev,nosuid" é usada para
        melhorar a segurança. (geral)

      * A opção "noauto" limita a montagem apenas por operação
        explícita. (geral)

      * A opção "data=journal" para ext3fs pode melhorar a
        integridade dos dados contra falhas de energia com alguma
        perda na velocidade de gravação.

    Dica

    Precisa de disponibilizar o parâmetro de boot do kernel (veja
    Secção 3.1.2, “Estágio 2: o gestor de arranque”), ex. "rootflags=
    data=journal" para implantar um modo de journal não predefinido
    para o sistema de ficheiros raiz. Para lenny, o modo de journal
    predefinido é "rootflags=data=ordered". Para squeeze, é
    "rootflags=data=writeback".

%

9.5.8. Optimização do sistema de ficheiros através do superblock

    As características de um sistema de ficheiros podem ser
    optimizadas via o super-bloco dele a usar o comando tune2fs(8).

      * A execução de "sudo tune2fs -l /dev/hda1" mostra o conteúdo
        do super-bloco do sistema de ficheiros em "/dev/hda1".

      * A execução de "sudo tune2fs -c 50 /dev/hda1" muda a
        frequência das verificações do sistema de ficheiros (execução
        do fsck durante o arranque) para cada 50 arranques em "/dev/
        hda1".

      * A execução de "sudo tune2fs -j /dev/hda1" adiciona capacidade
        de journal ao sistema de ficheiros, isto é, conversão de ext2
        para ext3 em "/dev/hda1". (Faça isto no sistema de ficheiros
        desmontado.)

      * A execução de "sudo tune2fs -O extents,uninit_bg,dir_index /
        dev/hda1 && fsck -pf /dev/hda1" converte-o de ext3 para ext4
        em "/dev/hda1". (Faça isto no sistema de ficheiros
        desmontado.)

    Dica

    Apesar do nome dele, o tune2fs(8) não funciona apenas no sistema
    de ficheiros ext2, mas também nos sistemas de ficheiros ext3 e
    ext4.

%

9.5.9. Optimização do disco rígido

    Atenção

    Por favor verifique o seu hardware e leia o manual do hdparam(8)
    antes de brincar com a configuração do disco rígido porque isto
    pode ser bastante perigoso para a integridade dos dados.

    Pode testar a velocidade de acesso ao disco de um disco rígido,
    p.e. "/dev/hda", por "hdparm -tT /dev/hda". Para algum disco
    rígido ligado com (E)IDE, pode acelerá-lo com "hdparm -q -c3 -d1
    -u1 -m16 /dev/hda" ao ativar o suporte a "(E)IDE 32-bit I/O", a
    ativar a flag "using_dma", a definir a flag "interrupt-unmask" e
    a definir o "multiple 16 sector I/O" (perigoso!).

    Pode testar a funcionalidade de cache de escrita de um disco
    rígido, por exemplo "/dev/sda", com "hdparm -W /dev/sda". Pode
    desativar a funcionalidade de cache de escrita dele com "hdparm
    -W 0 /dev/sda".

    Pode ser capaz de ler CDROMs muito pressionados em drives de
    CDROM modernas de alta velocidade ao abrandá-la com "setcd -x 2".

%

9.5.10. Optimização de disco de estado sólido (SSD)

    O desempenho e desgaste do disco de estado sólido (SSD) podem ser
    optimizados como a seguir.

      * Utilize o kernel Linux mais recente. (>= 3.2)

      * Reduz as escritas em disco para acessos de leitura ao disco.

          + Defina a opção de mount "noatime" ou "relatime" em /etc/
            fstab.

      * ativar o comando TRIM.

          + Defina a opção "discard", do mount, em /etc/fstab para os
            sistemas de ficheiros ext4, partição swap, Btrfs, etc.
            Veja fstab(5).

          + Para LVM defina a opção "discard em /etc/lvm/lvm.conf.
            Veja lvm.conf(5).
   
          + Para dm-crypt veja a opção "discard" em /etc/crypttab.
            Veja crypttab(5).

      * ativar o esquema de alocação de espaço em disco optimizado
        para SSD.

          + Para Btrfs defina a opção "ssd", de mount, em /etc/fstab.

      * Para computadores portáteis fazer o sistema esvaziar os dados
        para o disco a cada 10 minutos.

          + Defina a opção, de mount,"commit=600" em /etc/fstab. Veja
            fstab(5).

          + Faça o pm-utils utilizar o laptop-mode mesmo quando
            ligado à corrente. Veja Debian BTS #659260.

    Atenção

    Alterar o intervalo de esvaziamento dos normais 5 segundos para
    10 minutos torna os seus dados vulneráveis a falhas de
    alimentação.

%

9.5.11. Usar SMART para prever falhas no disco rígido

    Pode monitorizar e registar em log o seu disco rígido que é
    compatível com SMART com o daemon smartd(8).

     1. ativar a função SMART na BIOS.

     2. Instalar o pacote smartmontools.

     3. Identificar os seus discos rígidos ao listá-los com df(1).

          + Vamos assumir uma drive de disco rígido a ser
            monitorizada como "/dev/hda".

     4. Verifique o resultado de "smartctl -a /dev/hda" para ver se a
        funcionalidade SMART está atualmente ligada.

          + Se não, active-o com "smartctl -s on -a /dev/hda".

     5. Active o daemon smartd(8) ao correr o seguinte.

          + retire a marca de comentário na linha "start_smartd=yes"
            no ficheiro "/etc/default/smartmontools".

          + reinicie o daemon smartd(8) com "sudo /etc/init.d/
            smartmontools restart".

    Dica
   
    O daemon smartd(8) pode ser personalizado com o ficheiro /etc/
    smartd.conf incluindo em como ser notificado dos avisos.

9.5.12. Especifique o diretório de armazenamento temporário através
de $TMPDIR

    As aplicações criam ficheiros temporários normalmente sob o
    diretório de armazenamento temporário "/tmp". Se "/tmp" não
    disponibilizar espaço suficiente, pode especificar um diretório
    de espaço temporário, a programas bem-comportados, através da
    variável $TMPDIR.

%

9.5.13. Expandir o espaço de armazenamento utilizável via LVM

    Para partições criadas em Logical Volume Manager (LVM)
    (funcionalidade do Linux) durante a instalação, elas podem ser
    redimensionadas facilmente ao concatenar extensões nelas ou ao
    truncar extensões delas sobre múltiplos aparelhos de
    armazenamento sem grandes reconfigurações do sistema.

9.5.14. Expandir o espaço de armazenamento utilizável ao montar outra
partição

    Se tiver uma partição vazia (ex. "/dev/sdx"), pode formatá-la com
    mkfs.ext4(1) e mount(8) para um diretório onde precise de mais
    espaço. (necessita copiar os conteúdos originais.)

    $ sudo mv work-dir old-dir
    $ sudo mkfs.ext4 /dev/sdx
    $ sudo mount -t ext4 /dev/sdx work-dir
    $ sudo cp -a old-dir/* work-dir
    $ sudo rm -rf old-dir

    Dica

    Pode em alternativa montar um ficheiro de imagem de disco vazio
    (veja Secção 9.6.5, “Criar um ficheiro de imagem de disco vazio”)
    como um aparelho de loop (veja Secção 9.6.3, “Montar o ficheiro
    de imagem de disco”). A utilização real do disco cresce com os
    dados reais armazenados.

9.5.15. Expandir o espaço de armazenamento utilizável ao fazer
bind-mount para outro diretório

    Se tiver um diretório vazio (p.e. "/caminho/para/
    diretório-vazio") com espaço utilizável noutra partição, pode
    fazer mount(8) ao mesmo com a opção "--bind para um diretório
    (p.e., "diretório-de-trabalho") onde necessite de mais espaço.

    $ sudo mount --bind /caminho/para/diretório-vazio diretório-de-trabalho

9.5.16. Expansão do espaço de armazenamento utilizável ao fazer
overlay-mounting para outro diretório

    Se tem espaço utilizável noutra partição (ex. "/path/to/empty") e
    "/path/to/work"), pode criar um diretório nela e empilhá-lo no
    diretório antigo (ex, "/path/to/old") onde precisa de espaço a
    usar o OverlayFS para Linux kernel 3.18 ou mais recente (Debian
    Stretch 9.0 ou posterior).

    $ sudo mount -t overlay overlay \
      -olowerdir=/path/to/old-dir,upperdir=/path/to/empty,workdir=/path/to/work

    Aqui, "/path/to/empty" e "/path/to/work" devem estar na partição
    com Escrita-Leitura activa a escrever em "/path/to/old".

9.5.17. Expandir o espaço de armazenamento utilizável a usar ligações
simbólicas

    Cuidado

    Este é um método descontinuado. Alguns programas podem não
    funcionar bem com uma "ligação simbólica a um diretório". Em vez
    disso, use as opções de "montagem" descritas em cima.

    Se tem um diretório vazio (ex. "/caminho/para/diretório-vazio")
    noutra partição com espaço utilizável, pode criar uma ligação
    simbólica ao diretório com o ln(8).

    $ sudo mv work-dir old-dir
    $ sudo mkdir -p /path/to/emp-dir
    $ sudo ln -sf /path/to/emp-dir work-dir
    $ sudo cp -a old-dir/* work-dir
    $ sudo rm -rf old-dir

    Atenção

    Não utilize uma "ligação simbólica para um diretório" para
    diretórios geridos pelo sistema, tais como o "/opt". Tal ligação
    simbólica poderá ser sobrescrita quando o sistema for atualizado.

%

9.6. A imagem de disco

    Aqui discutimos manipulações da imagem do disco.

%

9.6.1. Criar o ficheiro de imagem de disco

    O ficheiro de imagem de disco, "disco.img", de um aparelho não
    montado, ex., a segunda drive SCSI ou serial ATA "/dev/sdb", pode
    ser feito a usar o cp(1) ou o dd(1) com o seguinte.

    # cp /dev/sdb disco.img
    # dd if=/dev/sdb of=disco.img

    O master boot record (MBR) da imagem de disco dos PC's
    tradicionais (veja Secção 9.5.2, “Configuração das partições do
    disco”) que reside no primeiro sector no disco IDE primário pode
    ser feito a usar o dd(1) com o seguinte.

    # dd if=/dev/hda of=mbr.img bs=512 count=1
    # dd if=/dev/hda of=mbr-nopart.img bs=446 count=1
    # dd if=/dev/hda of=mbr-part.img skip=446 bs=1 count=66

      * "mbr.img": O MBR com a tabela de partições

      * "mbr-nopart.img": O MBR sem a tabela de partições

      * "mbr-part.img": A tabela de partições apenas do MBR

    Se tem um aparelho SCSI ou serial ATA como disco de arranque,
    substitua "/dev/hda" por "/dev/sda".

    Se está a criar uma imagem de uma partição de disco do disco
    original, substitua "/dev/hda" por "/dev/hda1" etc.

%

9.6.2. Escrever directamente no disco

    O ficheiro de imagem de disco "disk.img" pode ser escrito para um
    aparelho desmontado, ex. a segunda drive SCSI "/dev/sdb" como
    tamanho correspondente, com o seguinte.

    # dd if=disk.img of=/dev/sdb

    Se modo semelhante, o ficheiro de imagem de partição de disco,
    "partition.img" pode ser escrito para uma partição desmontada,
    ex., a primeira partição do segundo disco SCSI "/dev/sdb1" com
    tamanho correspondente, com o seguinte.

    # dd if=partition.img of=/dev/sdb1

%

9.6.3. Montar o ficheiro de imagem de disco

    A imagem de disco "partition.img" que contém uma partição única
    pode ser montada e desmontada ao usar o aparelho loop como a
    seguir.

    # losetup -v -f partition.img
    Loop device is /dev/loop0
    # mkdir -p /mnt/loop0
    # mount -t auto /dev/loop0 /mnt/loop0
    ...hack...hack...hack
    # umount /dev/loop0
    # losetup -d /dev/loop0

    Isto pode ser simplificado como a seguir.

    # mkdir -p /mnt/loop0
    # mount -t auto -o loop partition.img /mnt/loop0
    ...hack...hack...hack
    # umount partition.img

    Cada partição da imagem de disco "disk.img" que contém múltiplas
    partições pode ser montada a usar o aparelho loop. Como o
    aparelho loop não gere partições por predefinição, temos que o
    redefinir como a seguir.

    # modinfo -p loop # verify kernel capability
    max_part:Maximum number of partitions per loop device
    max_loop:Maximum number of loop devices
    # losetup -a # verify nothing using the loop device
    # rmmod loop
    # modprobe loop max_part=16

    Agora, o aparelho loop pode lidar com 16 partições (máximo).

    # losetup -v -f disk.img
    Loop device is /dev/loop0
    # fdisk -l /dev/loop0

    Disk /dev/loop0: 5368 MB, 5368709120 bytes
    255 heads, 63 sectors/track, 652 cylinders
    Units = cylinders of 16065 * 512 = 8225280 bytes
    Disk identifier: 0x452b6464

          Device Boot      Start         End      Blocks   Id  System
    /dev/loop0p1               1         600     4819468+  83  Linux
    /dev/loop0p2             601         652      417690   83  Linux
    # mkdir -p /mnt/loop0p1
    # mount -t ext4 /dev/loop0p1 /mnt/loop0p1
    # mkdir -p /mnt/loop0p2
    # mount -t ext4 /dev/loop0p2 /mnt/loop0p2
    ...hack...hack...hack
    # umount /dev/loop0p1
    # umount /dev/loop0p2
    # losetup -d /dev/loop0

    Alternativamente, podem-se fazer efeitos semelhantes ao usar os
    aparelhos device mapper criados pelo kpartx(8) do pacote kpartx
    como a seguir.

    # kpartx -a -v disk.img
    ...
    # mkdir -p /mnt/loop0p2
    # mount -t ext4 /dev/mapper/loop0p2 /mnt/loop0p2
    ...
    ...hack...hack...hack
    # umount /dev/mapper/loop0p2
    ...
    # kpartx -d /mnt/loop0

    Nota

    Também pode montar uma única partição de tal imagem de disco com
    o aparelho loop a usar um offset para saltar o MBR etc. Mas isto
    é mais inclinado a erros.

%

9.6.4. Limpar um ficheiro de imagem de disco

    Um ficheiro de imagem de disco, "disk.img" pode ser limpo de
    todos os ficheiros removidos numa imagem limpa "new.img" com o
    seguinte.

    # mkdir old; mkdir new
    # mount -t auto -o loop disk.img old
    # dd bs=1 count=0 if=/dev/zero of=new.img seek=5G
    # mount -t auto -o loop new.img new
    # cd old
    # cp -a --sparse=always ./ ../new/
    # cd ..
    # umount new.img
    # umount disk.img

    Se o "disk.img" está em ext2, ext3 ou ext4, você também pode usar
    o zerofree(8) do pacote zerofree como a seguir.

    # losetup -f -v disk.img
    Loop device is /dev/loop3
    # zerofree /dev/loop3
    # cp --sparse=always disco.img novo.img

%

9.6.5. Criar um ficheiro de imagem de disco vazio

    A imagem de disco vazia "disk.img" que pode crescer até aos 5GiB
    pode ser feita a usar o dd(1) como a seguir.

    $ dd bs=1 count=0 if=/dev/zero of=disk.img seek=5G

    Pode criar um sistema de ficheiros ext4 nesta imagem de disco
    "disk.img" a usar o aparelho loop como a seguir.

    # losetup -f -v disk.img
    Loop device is /dev/loop1
    # mkfs.ext4 /dev/loop1
    ...hack...hack...hack
    # losetup -d /dev/loop1
    $ du  --apparent-size -h disk.img
    5.0G  disk.img
    $ du -h disk.img
    83M disk.img

    Para "disk.img", o tamanho de ficheiro dele é 5.0 Gb e a
    utilização real do disco dele é apenas 83 Mb. Esta discrepância é
    possível porque o ext4 pode manter o ficheiro sparse.

    Dica
   
    A utilização de disco real do ficheiro sparse cresce com os dados
    que são escritos nele.

    A usar uma operação semelhante em aparelhos criados pelo aparelho
    loop ou o mapeador de aparelhos como Secção 9.6.3, “Montar o
    ficheiro de imagem de disco”, pode particionar esta imagem de
    disco "disk.img" a usar o parted(8) ou o fdisk(8) e pode criar um
    sistema de ficheiros nela a usar mkfs.ext4(8), mkswap(8), etc.

%

9.6.6. Criar o ficheiro de imagem ISO9660

    O ficheiro de imagem ISO9660, "cd.iso", a partir da árvore de
    diretórios fonte em "source_diretory" pode ser feito a usar o 
    genisoimage(1) disponibilizado pelo cdrkit com o seguinte.

    #  genisoimage -r -J -T -V volume_id -o cd.iso diretório_fonte

    De modo semelhante, o ficheiro de imagem ISO9660 de arranque,
    "cdboot.iso", pode ser feito a partir do instalador-debian como
    árvore de diretórios em "source_diretory" com o seguinte.

    #  genisoimage -r -o cdboot.iso -V volume_id \
       -b isolinux/isolinux.bin -c isolinux/boot.cat \
       -no-emul-boot -boot-load-size 4 -boot-info-table diretório_fonte

    Aqui é usado para arranque o boot loader Isolinux (veja
    Secção 3.1.2, “Estágio 2: o gestor de arranque”).

    Pode calcular o valor md5sum e fazer a imagem ISO9660
    directamente a partir do aparelho CD-ROM como a seguir.

    $ isoinfo -d -i /dev/cdrom
    CD-ROM is in ISO 9660 format
    ...
    Logical block size is: 2048
    Volume size is: 23150592
    ...
    # dd if=/dev/cdrom bs=2048 count=23150592 conv=notrunc,noerror | md5sum
    # dd if=/dev/cdrom bs=2048 count=23150592 conv=notrunc,noerror > cd.iso

    Atenção

    Tem de ter o cuidado de evitar o bug de leitura antecipada do
    sistema de ficheiros ISO9660 do Linux como em cima para obter o
    resultado correcto.

%

9.6.7. Escrever directamente ao CD/DVD-R/RW

    Dica
   
    Um DVD é apenas um CD grande para o wodim(1) disponibilizado pelo
    cdrkit.

    Pode procurar um aparelho utilizável com o seguinte.

    # wodim --devices

    Então o CD-R vazio é inserido na drive de CD e o ficheiro de
    imagem ISO9660, "cd.iso" é escrito neste aparelho, ex. "/dev/
    hda", a usar o wodim(1) com o seguinte.

    # wodim -v -eject dev=/dev/hda cd.iso

    Se for usado um CD-RW em vez de um CD-R, faça antes o seguinte.

    # wodim -v -eject blank=fast dev=/dev/hda cd.iso

    Dica

    Se o seu ambiente montar CDs automaticamente, desmonte-o com
    "sudo umount /dev/hda" a partir da consola antes de usar o wodim
    (1).

%

9.6.8. Montar o ficheiro de imagem ISO9660

    Se "cd.iso" conter uma imagem ISO9660, então o seguinte monta-o
    manualmente em "/cdrom".

    # mount -t iso9660 -o ro,loop cd.iso /cdrom

    Dica

    Os sistemas de ambiente de trabalho modernos podem montar medias
    amovíveis, tais como um CD formatado em ISO9660, automaticamente
    (veja Secção 10.1.7, “Aparelho de armazenamento amovível”).

%

9.7. Os dados binários

    Aqui, discutimos manipulação directa de dados binários em meios
    de armazenamento.

%

9.7.1. Ver e editar dados binários

    o método de visualização mais básico de dados binários é usar o
    comando "od -t x1".

    Tabela 9.20. Lista de pacote para ver e editar dados binários

    +---------------------------------------------------------------+
    |    pacote     |popcon|tamanho|           descrição            |
    |---------------+------+-------+--------------------------------|
    |               |V:891,|       |pacote básico que tem od(1) para|
    |coreutils      |I:999 |17478  |despejar ficheiros (HEX, ASCII, |
    |               |      |       |OCTAL, …)                       |
    |---------------+------+-------+--------------------------------|
    |               |V:60, |       |pacote utilitário que tem hd(1) |
    |bsdmainutils   |I:996 |26     |para despejar ficheiros (HEX,   |
    |               |      |       |ASCII, OCTAL, …)                |
    |---------------+------+-------+--------------------------------|
    |hexedit        |V:1,  |72     |editor binário e visualizador   |
    |               |I:12  |       |(HEX, ASCII)                    |
    |---------------+------+-------+--------------------------------|
    |bless          |V:0,  |1028   |editor hexadecimal cheiro de    |
    |               |I:4   |       |funcionalidades (GNOME)         |
    |---------------+------+-------+--------------------------------|
    |okteta         |V:1,  |1508   |editor hexadecimal cheiro de    |
    |               |I:15  |       |funcionalidades (KDE4)          |
    |---------------+------+-------+--------------------------------|
    |ncurses-hexedit|V:0,  |132    |editor binário e visualizador   |
    |               |I:2   |       |(HEX, ASCII, EBCDIC)            |
    |---------------+------+-------+--------------------------------|
    |beav           |V:0,  |133    |editor binário e visualizador   |
    |               |I:0   |       |(HEX, ASCII, EBCDIC, OCTAL, …)  |
    +---------------------------------------------------------------+


    Dica

    HEX é usado como um acrónimo para o formato hexadecimal com radix
    16. OCTAL é para formato octal com radix 8. ASCII é para American
    Standard Code for Information Interchange, isto é, código de
    texto Inglês normal. EBCDIC é para Extended Binary Coded Decimal
    Interchange Code usado em sistemas operativos com infraestrutura
    da IBM.

%

9.7.2. Manipular ficheiros sem montar o disco

    Existem ferramentas para ler e escrever ficheiros sem montar o
    disco.

    Tabela 9.21. Lista de pacotes para ler e escrever ficheiros sem
    montar o disco

    +---------------------------------------------------------------+
    | pacote |popcon|tamanho|               descrição               |
    |--------+------+-------+---------------------------------------|
    |mtools  |V:10, |389    |utilitários para sistemas de ficheiros |
    |        |I:83  |       |MSDOS sem os montar                    |
    |--------+------+-------+---------------------------------------|
    |hfsutils|V:0,  |1884   |utilitários para sistemas de ficheiros |
    |        |I:7   |       |HFS e HFS+ sem os montar               |
    +---------------------------------------------------------------+


%

9.7.3. Redundância de dados

    Os sistemas RAID por software oferecidos pelo kernel Linux
    oferecem redundância de dados ao nível do sistema de ficheiros do
    kernel, para se conseguir altos níveis de fiabilidade de
    armazenamento.

    Também existem ferramentas para adicionar redundância a ficheiros
    ao nível de programa aplicação, para se conseguir altos níveis de
    fiabilidade de armazenamento.

    Tabela 9.22. Lista de ferramentas para adicionar redundância de
    dados a ficheiros

    +---------------------------------------------------------------+
    |  pacote  |popcon|tamanho|              descrição              |
    |----------+------+-------+-------------------------------------|
    |par2      |V:4,  |271    |Parity Archive Volume Set, para      |
    |          |I:15  |       |verificação e reparação de ficheiros |
    |----------+------+-------+-------------------------------------|
    |          |V:0,  |       |protecção de dados contra percas/    |
    |dvdisaster|I:2   |1741   |riscos/envelhecimento para medias CD/|
    |          |      |       |DVD                                  |
    |----------+------+-------+-------------------------------------|
    |          |V:0,  |       |ferramenta de backup que usa câmaras |
    |dvbackup  |I:0   |413    |de filmar MiniDV (a disponibilizar   |
    |          |      |       |rsbep(1))                            |
    |----------+------+-------+-------------------------------------|
    |vdmfec    |V:0,  |97     |recuperar blocos perdidos a usar o   |
    |          |I:0   |       |Forward Error Correction             |
    +---------------------------------------------------------------+


%

9.7.4. Recuperação de ficheiros e dados e análise forense

    Existem ferramentas para recuperação de ficheiros e dados e
    análise forense.

    Tabela 9.23. Lista de pacotes para recuperação de ficheiros e
    dados e análise forense

    +---------------------------------------------------------------+
    |   pacote    |popcon|tamanho|            descrição             |
    |-------------+------+-------+----------------------------------|
    |testdisk     |V:3,  |1426   |utilitários para sondagem de      |
    |             |I:38  |       |partições e recuperação de discos |
    |-------------+------+-------+----------------------------------|
    |             |V:0,  |       |utilitário para recuperar         |
    |magicrescue  |I:3   |259    |ficheiros ao procurar por bytes   |
    |             |      |       |mágicos                           |
    |-------------+------+-------+----------------------------------|
    |scalpel      |V:0,  |87     |frugal, entalhador de ficheiros de|
    |             |I:4   |       |alta performance                  |
    |-------------+------+-------+----------------------------------|
    |myrescue     |V:0,  |83     |recuperar dados de discos rígidos |
    |             |I:3   |       |danificados                       |
    |-------------+------+-------+----------------------------------|
    |             |V:1,  |       |utilitários para recuperar        |
    |extundelete  |I:11  |148    |ficheiros apagados no sistema de  |
    |             |      |       |ficheiros ext3/4                  |
    |-------------+------+-------+----------------------------------|
    |             |V:0,  |       |utilitários para recuperar        |
    |ext4magic    |I:4   |233    |ficheiros apagados no sistema de  |
    |             |      |       |ficheiros ext3/4                  |
    |-------------+------+-------+----------------------------------|
    |             |V:0,  |       |ferramenta para ajudar a recuperar|
    |ext3grep     |I:3   |281    |ficheiros apagados no sistema de  |
    |             |      |       |ficheiros ext3                    |
    |-------------+------+-------+----------------------------------|
    |scrounge-ntfs|V:0,  |50     |programa de recuperação de dados  |
    |             |I:3   |       |para sistemas de ficheiros NTFS   |
    |-------------+------+-------+----------------------------------|
    |gzrt         |V:0,  |33     |conjunto de ferramentas de        |
    |             |I:0   |       |recuperação gzip                  |
    |-------------+------+-------+----------------------------------|
    |sleuthkit    |V:2,  |1511   |ferramentas para análise forense. |
    |             |I:24  |       |(Sleuthkit)                       |
    |-------------+------+-------+----------------------------------|
    |autopsy      |V:0,  |1027   |interface gráfica para o SleuthKit|
    |             |I:2   |       |                                  |
    |-------------+------+-------+----------------------------------|
    |foremost     |V:0,  |104    |aplicação forense para recuperar  |
    |             |I:7   |       |dados                             |
    |-------------+------+-------+----------------------------------|
    |guymager     |V:0,  |1030   |ferramenta de imagem forense      |
    |             |I:1   |       |baseada em Qt                     |
    |-------------+------+-------+----------------------------------|
    |dcfldd       |V:0,  |106    |versão melhorada do dd para       |
    |             |I:5   |       |forenses e segurança              |
    +---------------------------------------------------------------+


    Dica

    Pode recuperar ficheiros apagados no sistema de ficheiros ext2 a
    usar os comandos list_deleted_inodes e undel de debugfs(8) no
    pacote e2fsprogs.

%

9.7.5. Dividir um ficheiro grande em ficheiros pequenos

    Quando os dados são muito grandes para fazer backup num ficheiro
    único, pode fazer backup ao conteúdo dele após dividi-lo em
    fatias de, por exemplo, 2000Mb e mais tarde fundir essas fatias
    de volta para o ficheiro original.

    $ split -b 2000m ficheiro_grande
    $ cat x* >ficheiro_grande

    Cuidado
   
    Por favor certifique-se que não tem nenhuns ficheiros que começam
    com "x" para evitar crashes com nomes.

%

9.7.6. Limpar conteúdo de ficheiro

    De modo a limpar o conteúdo de um ficheiro como um ficheiro log,
    não use o rm(1) para apagar o ficheiro e depois crie um ficheiro
    vazio, porque o ficheiro pode ainda estar a ser acedido no
    intervalo entre comandos. O seguinte é o modo seguro de limpar o
    conteúdo do ficheiro.

    $ :>ficheiro_a_ser_limpo

%

9.7.7. Ficheiros dummy

    Os seguintes comandos criam ficheiros dummy ou vazios.

    $ dd if=/dev/zero    of=5kb.file bs=1k count=5
    $ dd if=/dev/urandom of=7mb.file bs=1M count=7
    $ touch zero.file
    $ : > alwayszero.file

    Deve encontrar os seguintes ficheiros.

      * "5kb.file" é 5KB de zeros.

      * "7mb.file" são 7MB de dados aleatórios.

      * "zero.file" pode ser um ficheiro de 0 bytes. Se existir, o
        mtime dele é atualizado enquanto o conteúdo e tamanho dele
        são mantidos.

      * "alwayszero.file" é sempre um ficheiro de 0 bytes. Se
        existir, o mtime dele é atualizado e o conteúdo dele é
        reposto.

%

9.7.8. apagar um disco rígido inteiro

    Existem várias maneiras de apagar completamente os dados de um
    aparelho inteiro tipo disco rígido, ex., pen de memória USB em "/
    dev/sda".

    Cuidado

    Primeiro verifique a localização da sua pen de memória USB com o 
    mount(8) antes de executar os comandos aqui. O aparelho apontado
    por "/dev/sda" pode ser um disco rígido SCSI ou SATA onde pode
    residir todo o seu sistema.

    Apagar todo o conteúdo do disco ao repor os dados a 0 com o
    seguinte.

    # dd if=/dev/zero of=/dev/sda

    Apagar tudo ao sobrescrever com dados aleatórios como a seguir.

    # dd if=/dev/urandom of=/dev/sda

    Apagar tudo muito eficientemente ao sobrescrever com dados
    aleatórios como a seguir.

    # shred -v -n 1 /dev/sda

    Como o dd(1) está disponível a partir da shell de muitos CDs de
    arranque de Linux como o CD de instalação de Debian, pode apagar
    completamente o seu sistema instalado no disco rígido, por
    exemplo, "/dev/hda", "/dev/sda", etc., ao correr um comando de
    limpeza a partir de tal media de arranque.

%

9.7.9. Apagar uma área não utilizada do disco rígido

    A área não utilizada de um disco rígido (ou duma pen USB ), por
    exemplo "/dev/sdb1" pode ainda conter os próprios dados apagados
    pois eles são apenas 'desligados' do sistema de ficheiros. Estes
    podem ser limpos ao sobrescrever a área onde estão.

    # mount -t auto /dev/sdb1 /mnt/foo
    # cd /mnt/foo
    # dd if=/dev/zero of=junk
    dd: writing to `junk': No space left on device
    ...
    # sync
    # umount /dev/sdb1

    Atenção

    Normalmente isto é suficientemente bom para a sua pen de memória
    USB. Mas não é perfeito. A maioria das partes dos nomes de
    ficheiros apagados e os atributos deles podem ficar escondidos e
    permanecerem no sistema de ficheiros.

%

9.7.10. Recuperar ficheiros apagados mas ainda abertos

    Mesmo que tenha acidentalmente apagado um ficheiro, desde que
    esse ficheiro esteja ainda a ser usado por alguma aplicação (em
    modo de leitura ou escrita), é possível recuperar tal ficheiro.

    Por exemplo, tente o seguinte:

    $ echo foo > bar
    $ less bar
    $ ps aux | grep ' less[ ]'
    bozo    4775  0.0  0.0  92200   884 pts/8    S+   00:18   0:00 less bar
    $ rm bar
    $ ls -l /proc/4775/fd | grep bar
    lr-x------ 1 bozo bozo 64 2008-05-09 00:19 4 -> /home/bozo/bar (apagado)
    $ cat /proc/4775/fd/4 >bar
    $ ls -l
    -rw-r--r-- 1 bozo bozo 4 2008-05-09 00:25 bar
    $ cat bar
    foo

    Execute em outro terminal (quando tem o pacote lsof instalado) o
    seguinte.

    $ ls -li bar
    2228329 -rw-r--r-- 1 bozo bozo 4 2008-05-11 11:02 bar
    $ lsof |grep bar|grep less
    less 4775 bozo 4r REG 8,3 4 2228329 /home/bozo/bar
    $ rm bar
    $ lsof |grep bar|grep less
    less 4775 bozo 4r REG 8,3 4 2228329 /home/bozo/bar (apagado)
    $ cat /proc/4775/fd/4 >bar
    $ ls -li bar
    2228302 -rw-r--r-- 1 bozo bozo 4 2008-05-11 11:05 bar
    $ cat bar
    foo

%

9.7.11. Procurar todas as ligações rígidas

    Os ficheiros com ligações rígidas podem ser identificados com "ls
    -li".

    $ ls -li
    total 0
    2738405 -rw-r--r-- 1 root root 0 2008-09-15 20:21 bar
    2738404 -rw-r--r-- 2 root root 0 2008-09-15 20:21 baz
    2738404 -rw-r--r-- 2 root root 0 2008-09-15 20:21 foo

    Ambos "baz" e "foo" têm contagens de ligações de "2" (>1) a
    mostrar que têm ligaçõesrígidas. Os números de inode deles são
    comuns "2738404". Isto significa que são o mesmo ficheiro em
    ligação rígida. Se não encontrar todos os ficheiros em ligação
    rígida por acaso, pode procurá-los pelo inode, ex., "2738404" com
    o seguinte.

    # find /caminho/para/ponto/de/montagem -xdev -inum 2738404

%

9.7.12. Consumo invisível do espaço do disco

    Todos os ficheiros apagadas mas abertos consomem espaço no disco
    apesar de não estarem visíveis ao du(1) normal. Eles podem ser
    listados com o tamanho deles com o seguinte.

    # lsof -s -X / |grep deleted

%

9.8. Dicas de encriptação de dados

    Com acesso físico ao seu PC, qualquer um pode facilmente ganhar
    privilégios de root e aceder a todos os ficheiros no seu PC (veja
    Secção 4.7.4, “Tornar a palavra-passe do root segura”). Isto
    significa que o sistema de palavra passe no login não pode
    proteger os seus dados privados e sensíveis contra um possível
    roubo do seu PC. Tem que implementar uma tecnologia de
    encriptação de dados para o fazer. Apesar do GNU privacy guard
    (veja Secção 10.3, “Infraestrutura da segurança de dados”) poder
    encriptar ficheiro,consome alguns esforços do utilizador.

    dm-crypt e eCryptfs facilitam a encriptação de dados automática
    nativamente através de módulos do kernel Linux com o mínimo de
    esforço do utilizador.

    Tabela 9.24. Lista de utilitários de encriptação de dados

    +---------------------------------------------------------------+
    |    pacote    |popcon|tamanho|            descrição            |
    |--------------+------+-------+---------------------------------|
    |              |V:29, |       |utilitários para aparelhos de    |
    |cryptsetup    |I:78  |402    |bloco encriptados (dm-crypt /    |
    |              |      |       |LUKS)                            |
    |--------------+------+-------+---------------------------------|
    |              |      |       |utilitários para aparelhos de    |
    |              |V:4,  |       |bloco encriptados (dm-crypt /    |
    |cryptmount    |I:5   |228    |LUKS) com focagem na montagem/   |
    |              |      |       |desmontagem por utilizadores     |
    |              |      |       |normais                          |
    |--------------+------+-------+---------------------------------|
    |              |V:3,  |       |utilitários para sistemas de     |
    |ecryptfs-utils|I:5   |460    |ficheiros em pilha encriptados   |
    |              |      |       |(eCryptfs)                       |
    +---------------------------------------------------------------+


    Dm-crypt é um sistema de ficheiros criptográfico que usa
    mapeador-de-aparelho. O mapeador-de-aparelho mapeia um aparelho
    de bloco para outro.

    eCryptfs é outro sistema de ficheiros criptográfico que usa
    sistema de ficheiros em pilha. Os sistemas de ficheiros em pilha
    empilham-se a si próprios no topo de um diretório existente de um
    sistema de ficheiros montado.

    Cuidado
   
    A encriptação de dados custa tempo da CPU e etc. Por favor pese
    os seus benefícios e custos.

    Nota

    O sistema Debian inteiro pode ser instalado num disco encriptado
    pelo instalador debian (lenny ou mais recente) a usar dm-crypt/
    LUKS e initramfs.

    Dica

    Veja Secção 10.3, “Infraestrutura da segurança de dados” para
    utilitário de encriptação do espaço de utilizador: GNU Privacy
    Guard.

%

9.8.1. Encriptação de discos amovíveis com dm-crypt/LUKS

    Pode encriptar o conteúdo de aparelhos de massa amovíveis, por
    exemplo, uma pen USB em "/dev/sdx", a usar dm-crypt/LUKS.
    Simplesmente formate-a como a seguir.

    # badblocks -c 1024 -s -w -t random -v /dev/sdx
    # fdisk /dev/sdx
    ... "n" "p" "1" "return" "return" "w"
    # cryptsetup luksFormat /dev/sdx1
    ...
    # cryptsetup open --type luks /dev/sdx1 sdx1
    ...
    # ls -l /dev/mapper/
    total 0
    crw-rw---- 1 root root  10, 60 2008-10-04 18:44 control
    brw-rw---- 1 root disk 254,  0 2008-10-04 23:55 sdx1
    # mkfs.vfat /dev/mapper/sdx1
    ...
    # cryptsetup luksClose sdx1

    Depois, pode ser montada tal como uma normal em "/media/
    <etiqueta_do_disco>", à excepção de pedir a palavra-passe (veja
    Secção 10.1.7, “Aparelho de armazenamento amovível”) sob
    ambientes de trabalho modernos como o GNOME a usar gnome-mount(1)
    . A diferença é que todos os dados escritos nela são encriptados.
    Alternativamente pode formatar o meio num sistema de ficheiros
    diferente, por exemplo, ext4 com "mkfs.ext4 /dev/mapper/sdx1".

    Nota

    Se é realmente paranóico pela segurança dos dados, pode precisar
    de sobrescrever várias vezes (o comando "badblocks" no exemplo em
    cima). No entanto esta operação irá consumir muito tempo.

%

9.8.2. Partição swap encriptada com dm-crypt

    Vamos assumir que o seu "/etc/fstab" original contém o seguinte.

    /dev/sda7 swap sw 0 0

    Pode ativar a encriptação da partição swap a usar o dm-crypt com
    o seguinte.

    # aptitude install cryptsetup
    # swapoff -a
    # echo "cswap /dev/sda7 /dev/urandom swap" >> /etc/crypttab
    # perl -i -p -e "s/\/dev\/sda7/\/dev\/mapper\/cswap/" /etc/fstab
    # /etc/init.d/cryptdisks restart
     ...
    # swapon -a

%

9.8.3. Montar discos encriptados com dm-crypt/LUKS

    Uma partição de disco criada com dm-crypt/LUKS em "/dev/sdc5"
    pode ser montada em /mnt" como a seguir:

    $ sudo cryptsetup open /dev/sdc5 ninja --type luks
    Enter passphrase for /dev/sdc5: ****
    $ sudo lvm
    lvm> lvscan
      inactive          '/dev/ninja-vg/root' [13.52 GiB] inherit
      inactive          '/dev/ninja-vg/swap_1' [640.00 MiB] inherit
      ACTIVE            '/dev/goofy/root' [180.00 GiB] inherit
      ACTIVE            '/dev/goofy/swap' [9.70 GiB] inherit
    lvm> lvchange -a y /dev/ninja-vg/root
    lvm> exit
      Exiting.
    $ sudo mount /dev/ninja-vg/root /mnt

%

9.8.4. Encriptar ficheiros automaticamente com eCryptfs

    Pode encriptar ficheiros escritos sob "~/Private/"
    automaticamente a usar eCryptfs e o pacote ecryptfs-utils.

      * Execute ecryptfs-setup-private(1) e configure "~/Private/"
        pelos seguintes avisos.

      * Active "~/Private/" ao executar ecryptfs-mount-private(1).

      * Move ficheiros de dados sensitivos para "~/Private/" e cria
        as ligações simbólicas necessárias.

          + Candidatos: "~/.fetchmailrc", "~/.ssh/identity", "~/.ssh/
            id_rsa", "~/.ssh/id_dsa" e outros ficheiros com "go-rwx"

      * Mova diretórios de dados sensíveis para um sub-diretório em
        "~/Private/" e crie as ligações simbólicas necessários.

          + Candidatos: "~/.gnupg" e outros diretórios com "go-rwx"

      * Crie uma ligação simbólica de "~/Desktop/Private/" para "~/
        Private/" para facilitar as operações do ambiente de
        trabalho.

      * Desactive "~/Private/" ao executar ecryptfs-umount-private(1)
        .

      * Active "~/Private/" ao emitir "ecryptfs-mount-private" quando
        necessitar de dados encriptados.

    Dica

    Como o eCryptfs apenas encripta de modo selectivo os ficheiros
    sensíveis, o custo dele para o sistema é muito menor do que usar
    o dm-crypt no aparelho de raiz inteiro ou "/home". Não precisa de
    nenhuns esforços de alocação de armazenamento no disco especial
    mas não podem manter em confidencial todos os meta-dados do
    sistema de ficheiros.

%

9.8.5. Montar eCryptfs automaticamente

    Se usar a sua palavra-passe do login para embrulhar as chaves de
    encriptação, pode automatizar a montagem do eCryptfs via PAM
    (Pluggable Authentication Modules).

    Insira a seguinte linha mesmo antes de "pam_permit.so" em "/etc/
    pam.d/common-auth".

    auth required pam_ecryptfs.so unwrap

    Insira a seguinte linha mesmo na última linha em "/etc/pam.d/
    common-session".

    session optional pam_ecryptfs.so unwrap

    Insira a seguinte linha na primeira linha activa em "/etc/pam.d/
    common-password".

    password required pam_ecryptfs.so

    Isto é bastante conveniente.

    Atenção
   
    Erros de configuração do PAM podem bloqueá-lo fora do seu próprio
    sistema. Veja Capítulo 4, Autenticação.

    Cuidado

    Se usar a sua palavra-passe de login para embrulhar chaves de
    encriptação, os seus dados encriptados são tão seguros como a sua
    palavra-passe de login de utilizador (veja Secção 4.3, “Boa
    palavra-passe”). A menos que seja cuidadoso a configurar uma
    palavra-passe forte, os seus dados estão em risco quando alguém
    corre software de crackar palavras-passe após roubar o seu
    portátil (veja Secção 4.7.4, “Tornar a palavra-passe do root
    segura”).

%

9.9. O kernel

    Debian distribui o kernel Linux organizado em módulos como
    pacotes para as arquitecturas suportadas.

%

9.9.1. Kernel Linux 2.6/3.x

    Existem algumas funcionalidades notáveis no kernel Linux 2.6/3.x
    comparado ao 2.4.

      * Os aparelhos são criados pelo sistema udev (veja Secção 3.3,
        “O sistema udev”).

      * Os acessos de leitura/escrita a aparelhos CD/DVD IDE não usam
        o módulo ide-scsi.

      * As funções de filtragem de pacotes de rede usam módulos
        iptables do kernel.

    O impacto de versões de Linux 2.6.39 a Linux 3.0 não é acerca de
    grandes alterações tecnológicas mas acerca do 20º aniversário.

%

9.9.2. Parâmetros do kernel

    Muitas funcionalidades do Linux são configuráveis via parâmetros
    de kernel como a seguir.

      * Parâmetros de kernel iniciados pelo gestor de arranque (veja
        Secção 3.1.2, “Estágio 2: o gestor de arranque”)

      * Parâmetros de kernel alterados pelo sysctl(8) durante a
        execução para os acessíveis via sysfs (veja Secção 1.2.12,
        “procfs e sysfs”)

      * Parâmetros de módulos definidos por argumentos do modprobe(8)
        quando um módulo é activado (veja Secção 9.6.3, “Montar o
        ficheiro de imagem de disco”)

    Veja "kernel-parameters.txt(.gz)" e outros documentos
    relacionados na documentação do kernel Linux ("/usr/share/doc/
    linux-doc-3.*/Documentation/filesystems/*") disponibilizados pelo
    pacote linux-doc-3.*.

%

9.9.3. Cabeçalhos do kernel

    A maioria dos programas normais não precisa dos cabeçalhos do
    kernel e na verdade podem bloquear se os usar directamente para
    compilação. Eles devem ser compilados contra os cabeçalhos em "/
    usr/include/linux" e "/usr/include/asm" disponibilizado pelo
    pacote libc6-dev (criado a partir do pacote fonte glibc) no
    sistema Debian.

    Nota

    Para compilar alguns programas específicos do kernel como módulos
    de kernel a partir de fonte externa e o daemon de auto-montagem
    (amd), tem de incluir o caminho para os cabeçalhos de kernel
    correspondentes, ex. "-I/usr/src/versão-de-linux/include/", à sua
    linha de comandos.O module-assistant(8) (ou a forma abreviada
    dele m-a) ajuda os utilizadores a construir e instalar pacotes de
    módulos facilmente para um ou mais kernels personalizados.

%

9.9.4. Compilar o kernel e módulos relacionados

    O Debian tem método próprio dele para compilar o kernel e os
    módulos relacionados.

    Tabela 9.25. Lista de pacotes chave a serem instalados para a
    recompilação do kernel no sistema Debian

    +---------------------------------------------------------------+
    |    pacote     |popcon|tamanho|           descrição            |
    |---------------+------+-------+--------------------------------|
    |               |      |       |pacotes essenciais para         |
    |build-essential|I:499 |20     |construir pacotes Debian: make, |
    |               |      |       |gcc, …                          |
    |---------------+------+-------+--------------------------------|
    |bzip2          |V:157,|122    |utilitários de compressão e     |
    |               |I:970 |       |descompressão para ficheiros bz2|
    |---------------+------+-------+--------------------------------|
    |libncurses5-dev|I:116 |6      |bibliotecas de programadores e  |
    |               |      |       |documentos para ncurses         |
    |---------------+------+-------+--------------------------------|
    |               |V:305,|       |git: sistema de controle de     |
    |git            |I:478 |35040  |versão distribuído usado pelo   |
    |               |      |       |kernel Linux                    |
    |---------------+------+-------+--------------------------------|
    |               |V:35, |       |disponibiliza um ambiente de    |
    |fakeroot       |I:521 |228    |falso-root para construção de   |
    |               |      |       |pacotes como não-root           |
    |---------------+------+-------+--------------------------------|
    |initramfs-tools|V:371,|112    |ferramenta para construir uma   |
    |               |I:989 |       |initramfs (específico de Debian)|
    |---------------+------+-------+--------------------------------|
    |dkms           |V:70, |294    |suporte de módulos de kernel    |
    |               |I:219 |       |dinâmicos (DKMS) (genérico)     |
    |---------------+------+-------+--------------------------------|
    |               |V:9,  |       |scripts de ajuda para um        |
    |devscripts     |I:57  |2623   |responsável de pacote Debian    |
    |               |      |       |(específico de Debian)          |
    +---------------------------------------------------------------+


    Se usa initrd em Secção 3.1.2, “Estágio 2: o gestor de arranque”,
    certifique-se de ler a informação relacionada em initramfs-tools
    (8), update-initramfs(8), mkinitramfs(8) e initramfs.conf(5).

    Atenção

    Não ponha ligações simbólicas aos diretórios na árvore fonte (ex.
    "/usr/src/linux*") a partir de "/usr/include/linux" e "/usr/
    include/asm" quando compilar a fonte do kernel Linux. (Alguns
    documentos antigos sugerem isto.)

    Nota

    Quando compilar o kernel Linux mais recente no sistema Debian
    stable, pode ser necessário o uso das ferramentas backport mais
    recentes do Debian unstable.

    Nota

    O suporte dinâmico a módulos do kernel (DKMS) é uma nova
    infraestrutura independente da distribuição desenhada para
    permitir que módulos de kernel individuais sejam atualizados sem
    se alterar todo o kernel. Isto é usado para a manutenção de
    módulos de fora-da-árvore. Isto também facilita a reconstrução de
    módulos quando se atualiza os kernels.

9.9.5. Compilar código-fonte do kernel: a recomendação da equipa do
kernel de Debian

    Para compilar pacotes binários de kernels personalizados a partir
    do código-fonte original, deve utilizar o alvo disponibilizado
    por "deb-pkg".

    $ sudo apt-get build-dep linux
    $ cd /usr/src
    $ wget http://www.kernel.org/pub/linux/kernel/v3.11/linux-<version>.tar.bz2
    $ tar -xjvf linux-<version>.tar.bz2
    $ cd linux-<version>
    $ cp /boot/config-<version> .config
    $ make menuconfig
     ...
    $ make deb-pkg

    Dica

    O pacote linux-source-<version> disponibiliza o código-fonte do
    kernel Linux com os patches Debian como "/usr/src/linux-
    <version>.tar.bz2".

    Para construir pacotes binários específicos a partir do pacote de
    código-fonte do kernel Debian, deve utilizar os alvos
    "binary-arch_<architecture>_<featureset>_<flavour>"em "debian/
    rules.gen".

    $ sudo apt-get build-dep linux
    $ apt-get source linux
    $ cd linux-3.*
    $ fakeroot make -f debian/rules.gen binary-arch_i386_none_686

    Veja mais informação:

      * Wiki Debian: KernelFAQ

      * Wiki Debian: DebianKernel

      * Debian Linux Kernel Handbook: https://
        kernel-handbook.debian.net

%

9.9.6. Controladores de hardware e firmware

    O controlador de hardware é o código que corre no sistema alvo. A
    maioria dos controladores de hardware estão agora disponíveis
    como software livre e estão incluídos nos pacotes normais de
    kernel Debian na área main.

      * Controlador de GPU

          + Controlador de GPU Intel (main)

          + Controlador de GPU AMD/ATI (main)

          + Controlador de GPU NVIDIA (main nouveau e em non-free
            controladores binários, sem código fonte, suportados pelo
            fabricante.)

      * controlador de Softmodem

          + os pacotes martian-modem e sl-modem-dkms (non-free)

    O firmware é o código ou dados carregados no aparelho (e.g. CPU
    microcode, código de renderização na GPU, ou dados FPGA / CPLD,
    ...). Alguns pacotes de firmware estão disponíveis como software
    livre, mas muitos pacotes de firmware não estão disponíveis como
    software livre já que são compostos por dados binários sem
    código-fonte.

      * firmware-linux-free (main)

      * firmware-linux-nonfree (non-free)

      * firmware-linux-* (non-free)
   
      * firmware (non-free)

      * intel-microcode (non-free)

      * amd64-microcode (non-free)

    Por favor note que os pacotes non-free e contrib não fazem parte
    do sistema Debian. A configuração de acesso para ativar ou
    desativar as áreas non-free e contrib é descrita em Secção 2.1.4,
    “Básico do arquivos Debian”. Deve estar ciente dos contras
    associados à utilização de pacotes non-free e contrib, conforme é
    descrito em Secção 2.1.5, “Debian é 100% software livre”.

%

9.10. Sistema virtualizado

    O uso de sistema virtualizado permite-nos correr várias
    instâncias do sistema simultâneamente num único hardware.

    Dica
   
    Veja http://wiki.debian.org/SystemVirtualization.

%

9.10.1. Ferramentas de virtualização

    Existem vários pacotes relacionados com sistemas de virtualização
    e emulação em Debian para além do simples chroot. Alguns pacotes
    também o ajudam a configurar tais sistemas.

    Tabela 9.26. Lista de ferramentas de virtualização

    +---------------------------------------------------------------+
    |    pacote     |popcon|tamanho|           descrição            |
    |---------------+------+-------+--------------------------------|
    |               |V:7,  |       |ferramenta especializada para   |
    |schroot        |I:10  |2708   |executar pacotes binários Debian|
    |               |      |       |em chroot                       |
    |---------------+------+-------+--------------------------------|
    |               |V:1,  |       |ferramenta para construir       |
    |sbuild         |I:4   |286    |pacotes binários Debian a partir|
    |               |      |       |de fontes Debian                |
    |---------------+------+-------+--------------------------------|
    |pbuilder       |V:2,  |966    |construtor de pacotes pessoais  |
    |               |I:16  |       |para pacotes Debian             |
    |---------------+------+-------+--------------------------------|
    |debootstrap    |V:6,  |298    |bootstrap um sistema Debian     |
    |               |I:63  |       |básico (escrito em sh)          |
    |---------------+------+-------+--------------------------------|
    |cdebootstrap   |V:0,  |116    |bootstrap um sistema Debian     |
    |               |I:3   |       |(escrito em C)                  |
    |---------------+------+-------+--------------------------------|
    |               |      |       |Virtual Machine Manager:        |
    |virt-manager   |V:10, |2298   |aplicação de ambiente de        |
    |               |I:42  |       |trabalho para gerir máquinas    |
    |               |      |       |virtuais                        |
    |---------------+------+-------+--------------------------------|
    |libvirt-clients|V:43, |1167   |programas para a biblioteca     |
    |               |I:62  |       |libvirt                         |
    |---------------+------+-------+--------------------------------|
    |bochs          |V:0,  |7194   |Bochs: emulador PC IA-32        |
    |               |I:1   |       |                                |
    |---------------+------+-------+--------------------------------|
    |qemu           |I:34  |94     |QEMU: emulador de processador   |
    |               |      |       |genérico rápido                 |
    |---------------+------+-------+--------------------------------|
    |qemu-system    |I:21  |95     |QEMU: binários de emulação de   |
    |               |      |       |sistema completo                |
    |---------------+------+-------+--------------------------------|
    |qemu-user      |V:0,  |89671  |QEMU: binários de emulação em   |
    |               |I:13  |       |modo de utilizador              |
    |---------------+------+-------+--------------------------------|
    |qemu-utils     |V:11, |6083   |QEMU: utilitários               |
    |               |I:107 |       |                                |
    |---------------+------+-------+--------------------------------|
    |               |V:10, |       |KVM: virtualização completa em  |
    |qemu-kvm       |I:61  |107    |hardware x86 com virtualização  |
    |               |      |       |assistida por hardware          |
    |---------------+------+-------+--------------------------------|
    |               |V:12, |       |VirtualBox: solução de          |
    |virtualbox     |I:16  |106495 |virtualização x86 em i386 e     |
    |               |      |       |amd64                           |
    |---------------+------+-------+--------------------------------|
    |xen-tools      |V:0,  |727    |ferramentas para gerir o        |
    |               |I:4   |       |servidor virtual XEN do debian  |
    |---------------+------+-------+--------------------------------|
    |wine           |V:19, |192    |Wine: Windows API Implementation|
    |               |I:82  |       |(suite standard)                |
    |---------------+------+-------+--------------------------------|
    |               |V:2,  |       |DOSBox: emulador x86 com        |
    |dosbox         |I:18  |2742   |gráficos Tandy/Herc/CGA/EGA/VGA/|
    |               |      |       |SVGA, som e DOS                 |
    |---------------+------+-------+--------------------------------|
    |dosemu         |V:0,  |4891   |DOSEMU: O Emulador de DOS do    |
    |               |I:2   |       |Linux                           |
    |---------------+------+-------+--------------------------------|
    |               |V:0,  |       |OpenVZ solução de virtualização |
    |vzctl          |I:1   |1112   |de servidor - ferramentas de    |
    |               |      |       |controle                        |
    |---------------+------+-------+--------------------------------|
    |               |V:0,  |       |OpenVZ solução de virtualização |
    |vzquota        |I:1   |236    |de servidor - ferramentas de    |
    |               |      |       |quotas                          |
    |---------------+------+-------+--------------------------------|
    |lxc            |V:10, |18761  |Ferramentas de utilizador para  |
    |               |I:15  |       |Linux containers                |
    +---------------------------------------------------------------+


    Veja o artigo da Wikipedia Comparação de plataformas de máquinas
    virtuais para uma comparação detalhada das diferentes soluções de
    plataformas de virtualização.

%

9.10.2. Fluxo de trabalho da virtualização

    Nota
   
    Algumas funcionalidades descritas aqui apenas estão disponíveis
    em squeeze ou mais recente.

    Nota
   
    Os kernels predefinidos de Debian suportam KVM desde lenny.

    O fluxo e trabalho típico para virtualização envolve vários
    passos.

      * Criar um sistema de ficheiros vazio (uma árvore de ficheiros
        ou uma imagem de disco).

          + A árvore de ficheiros pode ser criada por "mkdir -p /path
            /to/chroot".

          + A imagem de disco crua pode ser criada com o dd(1) (veja
            Secção 9.6.1, “Criar o ficheiro de imagem de disco” e
            Secção 9.6.5, “Criar um ficheiro de imagem de disco
            vazio”).

          + qemu-img(1) pode ser usado para criar e converter
            ficheiros de imagem de disco suportados pelo QEMU.

          + Os formatos de ficheiro cru e VMDK podem ser usados como
            formatos comuns entre ferramentas de virtualização.

      * Montar a imagem de disco com mount(8) no sistema de ficheiros
        (opcional).

          + Para o ficheiro de imagem de disco cru, monte-o como
            aparelho loop ou aparelho do device mapper (veja
            Secção 9.6.3, “Montar o ficheiro de imagem de disco”).

          + Para imagens de disco suportadas pelo QEMU, monte-as como
            aparelhos de bloco de rede (veja Secção 9.10.3, “Montar o
            ficheiro de imagem de disco virtual”).

      * Povoar o sistema de ficheiros alvo com os dados de sistema
        necessários.

          + O uso de programas como o debootstrap e o cdebootstrap
            ajudam com este processo (veja Secção 9.10.4, “Sistema
            chroot”).

          + Use instaladores de SOs sob o emulador de sistema
            completo.

      * Correr um programa sob um ambiente virtualizado.

          + chroot disponibiliza um ambiente virtualizado básico
            suficiente para compilar programas, correr aplicações de
            consola e correr daemons nele.

          + QEMU oferece emulação de CPU de várias plataformas.

          + QEMU com KVM oferece emulação de sistema completo pela
            virtualização assistida a hardware.

          + VirtualBox oferece emulação de sistema completo em i386
            ou amd64 com ou sem a virtualização assistida a hardware.

%

9.10.3. Montar o ficheiro de imagem de disco virtual

    Para o ficheiro de imagem de disco raw, veja Secção 9.6, “A
    imagem de disco”.

    Para outros ficheiros de imagem de disco virtual, pode usar o
    qemu-nbd para exportá-los pelo protocolo aparelho de bloco de
    rede e montá-los a usar o módulo de kernel nbd.

    O qemu-nbd(8) suporta os formatos de disco suportados pelo QEMU:
    O QEMU suporta os seguintes formatos de discos: raw, qcow2, qcow,
    vmdk, vdi, bochs, cow (modo-de-utilizador de Linux de
    copiar-ao-escrever), parallels, dmg, cloop, vpc, vvfat (VFAT
    virtual) e aparelho_máquina.

    O aparelho de bloco em rede pode suportar partições do mesmo modo
    que o aparelho de loop (veja Secção 9.6.3, “Montar o ficheiro de
    imagem de disco”). Pode montar a primeira partição de "disk.img"
    como a seguir.

    # modprobe nbd max_part=16
    # qemu-nbd -v -c /dev/nbd0 disk.img
    ...
    # mkdir /mnt/part1
    # mount /dev/nbd0p1 /mnt/part1

    Dica
   
    Pode exportar apenas a primeira partição de "disk.img" a usar a
    opção "-P 1" para qemu-nbd(8).

%

9.10.4. Sistema chroot

    chroot(8) oferece a maneira mais básica de correr diferentes
    instâncias do ambiente GNU/Linux num único sistema em simultâneo
    sem reiniciar.

    Cuidado
   
    Os exemplos em baixo assumem que ambos os sistemas pai e chroot
    partilham a mesma arquitectura de CPU.

    Pode aprender a como configurar e usar chroot(8) ao correr o
    programa pbuilder(8) sob script(1) como a seguir.

    $ sudo mkdir /sid-root
    $ sudo pbuilder --create --no-targz --debug --buildplace /sid-root

    Vê como debootstrap(8) ou cdebootstrap(1) povoam dados do sistema
    para ambiente sid sob "/sid-root".

    Dica

    Estes debootstrap(8) ou cdebootstrap(1) são usados para instalar
    Debian pelo instalador Debian Installer. Estes também podem ser
    usados para instalar Debian num sistema sem usar um disco de
    instalação de Debian, mas em vez disso, a partir de outra
    distribuição de GNU/Linux.

    $ sudo pbuilder --login --no-targz  --debug --buildplace /sid-root

    Pode ver como uma shell de sistema a correr sob ambiente sid é
    criada como o seguinte.

     1. Copiar configuração local ("/etc/hosts", "/etc/hostname", "/
        etc/resolv.conf")

     2. Montar o sistema de ficheiros "/proc"
   
     3. Montar o sistema de ficheiros "/dev/pts"

     4. Criar "/usr/sbin/policy-rc.d" o qual sempre existe com 101

     5. Corra "chroot /sid-root bin/bash -c 'exec -a -bash bin/bash'"

    Nota

    Alguns programas sob chroot podem requerer acesso a mais
    ficheiros do sistema pai para funcionarem do que o pbuilder
    disponibiliza. Por exemplo, "/sys", "/etc/passwd", "/etc/group",
    "/var/run/utmp", "/var/log/wtmp", etc. podem precisar de ser
    montados em união ou copiados.

    Nota

    O ficheiro "/usr/sbin/policy-rc.d" previne que programas daemon
    arranquem automaticamente no sistema Debian. Veja "/usr/share/doc
    /sysv-rc/README.policy-rc.d.gz".

    Dica

    O objetivo original do pacote especializado chroot, pbuilder é
    construir um sistema chroot system e construir um pacote dentro
    do chroot. É um sistema ideal para usar para verificar se as
    dependências de compilação de um pacote estão correctas e para
    certificar que dependências de compilação erradas e
    desnecessárias não existem no pacote resultante.

    Dica
   
    De modo semelhante, o pacote schroot pode dar-lhe uma ideia de
    correr um sistema chroot i386 sob um sistema pai amd64.

%

9.10.5. Sistemas de vários ambientes de trabalho

    Recomendo usar o QEMU ou o VirtualBox num sistema Debian stable
    para correr vários sistemas de ambiente de trabalho em segurança
    a usar virtualização. Isto permite-lhe correr aplicações de
    ambiente de trabalho do Debian unstable e testing sem os riscos
    usuais associados a elas.

    Como o QEMU puro é muito lento, é recomendado acelerá-lo com KVM
    quando o sistema da máquina o suporta.

    A imagem de disco virtual "virtdisk.qcow2" que contem um sistema
    Debian para o QEMU pode ser criada a usar o instalador de debian
    em pequenos CDs como a seguir.

    $ wget http://cdimage.debian.org/debian-cd/5.0.3/amd64/iso-cd/debian-503-amd64-netinst.iso
    $ qemu-img create -f qcow2 virtdisk.qcow2 5G
    $ qemu -hda virtdisk.qcow2 -cdrom debian-503-amd64-netinst.iso -boot d -m 256
    ...

    Veja mais dicas em Debian wiki: QEMU.

    O VirtualBox vem com ferramentas GUI Qt e é bastante intuitivo.
    As suas ferramentas GUI e de linha de comandos estão explicadas
    em Manual do Utilizador do VirtualBox e Manual do Utilizador do
    VirtualBox (PDF).

    Dica

    Correr outras distribuições de GNU/Linux como o Ubuntu e o Fedora
    sob virtualização é um bom modo de aprender dicas de
    configuração. Também outros SOs proprietários podem correr muito
    bem sob esta virtualização do GNU/Linux.

Capítulo 10. Gestão de dados

    São descritas ferramentas e dicas para gerir dados binários e de
    texto no sistema Debian.

%

10.1. Partilhar, copiar e arquivar

    Atenção

    O acesso de escrita descoordenado a aparelhos acedidos
    activamente e a ficheiros a partir de múltiplos processos não
    deve ser feito para evitar a condição de competição. Devem ser
    usados mecanismos de bloqueio de ficheiro que usem o flock(1)
    para o evitar.

    A segurança dos dados e a partilha controlada dele têm vários
    aspectos.

      * A criação de um arquivo de dados

      * O acesso a armazenamento remoto

      * A duplicação

      * O acompanhar do histórico de modificação

      * A facilitação da partilha de dados

      * A prevenção de acessos não autorizados a ficheiros

      * A detecção de modificação não autorizada de ficheiros

    Estas podem ser realizadas a usar a combinação de algumas
    ferramentas.

      * Ferramentas de arquivo e compressão

      * Ferramentas de cópia de sincronização

      * Sistemas de ficheiros de rede

      * Media de armazenamento amovível
   
      * A shell segura

      * O sistema de autenticação

      * Ferramentas de sistema de controle de versão

      * Ferramentas de hash e encriptação criptográfica

%

10.1.1. Ferramentas de arquivo e compressão

    Aqui está um sumário das ferramentas de arquivo e compressão
    disponíveis no sistema Debian.

    Tabela 10.1. Lista de ferramentas de arquivo e compressão

    +---------------------------------------------------------------+
    |  pacote  |popcon|tamanho|extensão|comando|     comentário     |
    |----------+------+-------+--------+-------+--------------------|
    |          |V:905,|       |        |       |o arquivador        |
    |tar       |I:999 |3098   |.tar    |tar(1) |standard (de facto  |
    |          |      |       |        |       |standard)           |
    |----------+------+-------+--------+-------+--------------------|
    |          |V:412,|       |        |       |arquivador estilo   |
    |cpio      |I:998 |1136   |.cpio   |cpio(1)|Unix System V, usar |
    |          |      |       |        |       |com o find(1)       |
    |----------+------+-------+--------+-------+--------------------|
    |          |      |       |        |       |arquivador para a   |
    |binutils  |V:164,|97     |.ar     |ar(1)  |criação de          |
    |          |I:678 |       |        |       |bibliotecas         |
    |          |      |       |        |       |estáticas           |
    |----------+------+-------+--------+-------+--------------------|
    |fastjar   |V:2,  |183    |.jar    |fastjar|arquivador para Java|
    |          |I:29  |       |        |(1)    |(estilo zip)        |
    |----------+------+-------+--------+-------+--------------------|
    |          |      |       |        |       |novo arquivador     |
    |pax       |V:13, |170    |.pax    |pax(1) |standard do POSIX,  |
    |          |I:26  |       |        |       |um compromisso entre|
    |          |      |       |        |       |tar e cpio          |
    |----------+------+-------+--------+-------+--------------------|
    |          |V:883,|       |        |gzip(1)|LZ77 utilitário de  |
    |gzip      |I:999 |245    |.gz     |, zcat |compressão do GNU (o|
    |          |      |       |        |(1), … |standard de facto)  |
    |----------+------+-------+--------+-------+--------------------|
    |          |      |       |        |       |Compressão de       |
    |          |      |       |        |       |organização de      |
    |          |      |       |        |       |blocos de           |
    |          |      |       |        |bzip2  |Burrows-Wheeler     |
    |bzip2     |V:157,|122    |.bz2    |(1),   |utilitário com um   |
    |          |I:970 |       |        |bzcat  |rácio de compressão |
    |          |      |       |        |(1), … |mais alto que o gzip|
    |          |      |       |        |       |(1) (mais lento que |
    |          |      |       |        |       |o gzip com sintaxe  |
    |          |      |       |        |       |semelhante)         |
    |----------+------+-------+--------+-------+--------------------|
    |          |      |       |        |       |LZMA utilitário de  |
    |          |V:2,  |       |        |       |compressão com rácio|
    |lzma      |I:29  |149    |.lzma   |lzma(1)|de compressão mais  |
    |          |      |       |        |       |alto que o gzip(1)  |
    |          |      |       |        |       |(descontinuado)     |
    |----------+------+-------+--------+-------+--------------------|
    |          |      |       |        |       |XZ utilitário de    |
    |          |      |       |        |       |compressão com rácio|
    |          |      |       |        |       |de compressão mais  |
    |          |      |       |        |xz(1), |alto que o bzip2(1) |
    |xz-utils  |V:454,|612    |.xz     |xzdec  |(mais lento que o   |
    |          |I:977 |       |        |(1), … |gzip mas mais rápido|
    |          |      |       |        |       |que o bzip2;        |
    |          |      |       |        |       |substituto para o   |
    |          |      |       |        |       |utilitário de       |
    |          |      |       |        |       |compressão LZMA)    |
    |----------+------+-------+--------+-------+--------------------|
    |          |      |       |        |7zr(1),|7-Zip arquivador de |
    |p7zip     |V:89, |987    |.7z     |p7zip  |ficheiros com alta  |
    |          |I:464 |       |        |(1)    |taxa de compressão  |
    |          |      |       |        |       |(compressão LZMA)   |
    |----------+------+-------+--------+-------+--------------------|
    |          |      |       |        |       |7-Zip arquivador de |
    |          |V:113,|       |        |7z(1), |ficheiros com rácio |
    |p7zip-full|I:486 |4664   |.7z     |7za(1) |de compressão alto  |
    |          |      |       |        |       |(LZMA compressão e  |
    |          |      |       |        |       |outros)             |
    |----------+------+-------+--------+-------+--------------------|
    |          |      |       |        |       |LZO utilitário de   |
    |          |      |       |        |       |compressão com mais |
    |          |      |       |        |       |alta compressão e   |
    |          |V:9,  |       |        |       |mais rápida         |
    |lzop      |I:76  |164    |.lzo    |lzop(1)|descompressão que o |
    |          |      |       |        |       |gzip(1) (rácio de   |
    |          |      |       |        |       |compressão mais     |
    |          |      |       |        |       |baixo que o gzip com|
    |          |      |       |        |       |sintaxe semelhante) |
    |----------+------+-------+--------+-------+--------------------|
    |          |V:51, |       |        |       |InfoZIP: ferramenta |
    |zip       |I:432 |608    |.zip    |zip(1) |de compressão e     |
    |          |      |       |        |       |arquivo do DOS      |
    |----------+------+-------+--------+-------+--------------------|
    |          |      |       |        |       |InfoZIP: ferramenta |
    |unzip     |V:154,|566    |.zip    |unzip  |de descompressão e  |
    |          |I:798 |       |        |(1)    |de de-arquivar do   |
    |          |      |       |        |       |DOS                 |
    +---------------------------------------------------------------+


    Atenção
   
    Não defina a variável "$TAPE" a menos que saiba com o que
    esperar. Altera o comportamento do tar(1).

    Nota
   
    O arquivo tar(1) gzipado usa a extensão de ficheiro ".tgz" ou
    ".tar.gz".

    Nota
   
    O arquivo tar(1) comprimido em xz usa a extensão de ficheiro
    ".txz" ou ".tar.xz".

    Nota
   
    Método de compressão popular em ferramentas FOSS tal como o tar
    (1) têm se movido como a seguir: gzip → bzip2 → xz

    Nota
   
    cp(1), scp(1) e tar(1) podem ter algumas limitações para
    ficheiros especiais. cpio(1) é o mais versátil.

    Nota

    O cpio(1) é desenhado para ser utilizado com o find(1) e outros
    comandos e apropriado para criar scripts de backup pois a parte
    de seleção de ficheiros do script pode ser testada
    independentemente.

    Nota
   
    A estrutura interna dos ficheiros de dados do Libreoffice são
    ficheiros ".jar" que também podem ser abertos pelo unzip.

    Nota

    A ferramenta de arquivo que é "de-facto" multi-plataforma é o
    zip. Use-o como "zip -rX" para obter o máximo de compatibilidade.
    Use também a opção "-s", se o tamanho máximo de ficheiro for
    importante.

%

10.1.2. Ferramentas de cópia de sincronização

    Aqui está um sumário de ferramentas de cópia simples e
    salvaguarda disponíveis no sistema Debian.

    Tabela 10.2. Lista de ferramentas de cópia e sincronização

    +---------------------------------------------------------------+
    |    pacote    |popcon|tamanho|ferramenta|        função        |
    |--------------+------+-------+----------+----------------------|
    |              |      |       |          |copia localmente      |
    |coreutils     |V:891,|17478  |GNU cp    |ficheiros e diretórios|
    |              |I:999 |       |          |("-a" para ser        |
    |              |      |       |          |recursivo)            |
    |--------------+------+-------+----------+----------------------|
    |              |      |       |          |copia remotamente     |
    |openssh-client|V:803,|4298   |scp       |ficheiros e diretórios|
    |              |I:996 |       |          |(cliente, "-r" para   |
    |              |      |       |          |ser recursivo)        |
    |--------------+------+-------+----------+----------------------|
    |              |V:690,|       |          |copia ficheiros e     |
    |openssh-server|I:834 |1567   |sshd      |diretórios remotamente|
    |              |      |       |          |(servidor remoto)     |
    |--------------+------+-------+----------+----------------------|
    |rsync         |V:281,|677    |-         |sincronização remota a|
    |              |I:560 |       |          |salvaguarda de 1 via  |
    |--------------+------+-------+----------+----------------------|
    |unison        |V:4,  |14     |-         |sincronização remota a|
    |              |I:17  |       |          |salvaguarda de 2 vias |
    +---------------------------------------------------------------+


    Copiar ficheiros com o rsync(8) oferece funcionalidades mais
    ricas que os outros.

      * algoritmo de transferência delta que envia apenas as
        diferenças entre os ficheiros da fonte e os ficheiros
        existentes no destino

      * algoritmo de verificação rápida (predefinido) que procura
        ficheiros que alteraram no tamanho ou hora da última
        modificação

      * opções "--exclude" e "--exclude-from" semelhantes ao tar(1)

      * sintaxe de "uma barra final no diretório fonte" que evita a
        criação de um nível de diretório adicional no destino.

    Dica

    A execução do script bkup mencionado em Secção 10.2.3, “Um script
    de cópia para a salvaguarda de dados” com a opção "-gl" sob cron
    (8) deverá disponibilizar uma funcionalidade muito semelhante
    como o dumpfs do Plan9 para o arquivo de dados estático.

    Dica

    Ferramentas de sistema de controlo de versão (VCS) em
    Tabela 10.11, “lista de ferramentas de sistemas de controle de
    versão” podem funcionar como a copia de multi-modos e ferramentas
    de sincronização.

%

10.1.3. Idiomas para o arquivo

    Aqui estão várias maneiras de arquivar e "desarquivar" o conteúdo
    completo do diretório "./source" a usar diferentes ferramentas.

    GNU tar(1):

    $ tar -cvJf archive.tar.xz ./source
    $ tar -xvJf archive.tar.xz

    Alternativamente, pelo seguinte.

    $ find ./source -xdev -print0 | tar -cvJf archive.tar.xz --null -F -

    cpio(1):

    $ find ./source -xdev -print0 | cpio -ov --null > archive.cpio; xz archive.cpio
    $ zcat archive.cpio.xz | cpio -i

%

10.1.4. Idiomas para a cópia

    Aqui estão algumas maneiras de copiar o conteúdo inteiro do
    diretório "./source" a usar diferentes ferramentas.

      * Cópia local: diretório "./source" → diretório "/dest"
   
      * Cópia remota: diretório "./source" em máquina local →
        diretório "/dest" na máquina "utilizador@máquina.domínio"

    rsync(8):

    # cd ./source; rsync -aHAXSv . /dest
    # cd ./source; rsync -aHAXSv . user@host.dom:/dest

    Pode alternativamente usar a sintaxe de "uma barra à direita no
    diretório fonte".

    # rsync -aHAXSv ./source/ /dest
    # rsync -aHAXSv ./source/ user@host.dom:/dest

    Alternativamente, pelo seguinte.

    # cd ./source; find . -print0 | rsync -aHAXSv0 --files-from=- . /dest
    # cd ./source; find . -print0 | rsync -aHAXSv0 --files-from=- . user@host.dom:/dest

    cp(1) de GNU e scp(1) de openSSH:

    # cd ./source; cp -a . /dest
    # cd ./source; scp -pr . utilizador@máquina.domínio:/dest

    GNU tar(1):

    # (cd ./source && tar cf - . ) | (cd /dest && tar xvfp - )
    # (cd ./source && tar cf - . ) | ssh utilizador@máquina.domínio '(cd /dest && tar xvfp - )'

    cpio(1):

    # cd ./source; find . -print0 | cpio -pvdm --null --sparse /dest

    Pode substituir "." por "foo" para todos os exemplos que
    contenham "." para copiar ficheiros do diretório "./source/foo"
    ao diretório "/dest/foo".

    Pode substituir "." pelo caminho absoluto "/caminho/para/fonte/
    foo" para todos os exemplos que contenham "." para abandonar "cd
    ./source;". Estes copiam ficheiros para localizações diferentes a
    depender das ferramentas utilizadas conforme a seguir.

      * "/dest/foo": rsync(8), cp(1) do GNU e scp(1)
   
      * "/dest/path/to/source/foo": GNU tar(1) e cpio(1)

    Dica
   
    rsync(8) e cp(1) do GNU têm a opção "-u" para saltar ficheiros
    que são mais recentes no receptor.

%

10.1.5. Idiomas para a seleção de ficheiros

    O find(1) é usado para selecionar ficheiros para o arquivo e
    copiar comandos (veja Secção 10.1.3, “Idiomas para o arquivo” e
    Secção 10.1.4, “Idiomas para a cópia”) ou para xargs(1) (veja
    Secção 9.3.9, “Repetir um ciclo de comandos sobre ficheiros”).
    Isto pode ser melhorado ao usar os seus argumentos de comando.

    A sintaxe básica de find(1) pode ser sumariada no seguinte.

      * Os seus argumentos condicionais são avaliados da esquerda à
        direita.

      * Esta avaliação pára assim que o resultado dele é determinado.

      * O "OU lógico" (especificado por "-o" entre condicionais) tem
        precedência mais baixa que o "E lógico" (especificado por
        "-a" ou nada entre condicionais).

      * O "NÃO lógico" (especificado por "!" antes duma condicional)
        tem precedência mas alta que o "E lógico".

      * "-prune" retorna sempre o VERDADEIRO lógico e, se for um
        diretório, a busca de ficheiro é parada para além deste
        ponto.

      * "-name" corresponde à base do nome de ficheiro com glob de
        shell (veja Secção 1.5.6, “Glob da shell”) mas também
        corresponde ao "." inicial dele com meta-caracteres como o
        "*" e o "?". (Nova funcionalidade do POSIX)

      * "-regex" corresponde ao caminho completo com estilo emacs BRE
        (veja Secção 1.6.2, “Expressões regulares”) como
        predefinição.

      * "-size" corresponde ao ficheiro baseado no tamanho do
        ficheiro (valor precedido de "+" para maior, precedido de "-"
        para menor)

      * "-newer" corresponde ao ficheiro mais recente que aquele
        especificado no argumento dele.

      * "-print0" retorna sempre o TRUE lógico e escreve o nome de
        ficheiro completo (terminado em nulo) na saída standard.

    O find(1) é usado geralmente com um estilo idiomático como a
    seguir.

    # find /caminho/para \
        -xdev -regextype posix-extended \
        -type f -regex ".*\.cpio|.*~" -prune -o \
        -type d -regex ".*/\.git" -prune -o \
        -type f -size +99M -prune -o \
        -type f -newer /caminho/para/timestamp -print0

    Isto significa fazer as seguintes acções.

     1. Procurar todos os ficheiros que começam por "/caminho/para"

     2. Limitar globalmente a busca para dentro do sistema de
        ficheiros inicial e usa ERE (ao inves veja Secção 1.6.2,
        “Expressões regulares”)

     3. Excluir da busca os ficheiros que correspondem à expressão
        regular ".*\.cpio" ou ".*~" ao parar o processamento
   
     4. Excluir da busca os diretórios que correspondem à expressão
        regular ".*/\.git" ao parar o processamento

     5. Exclui da busca os ficheiros maiores que 99 Mb (unidades de
        1048576 bytes) ao parar o processamento

     6. Escrever os nomes de ficheiros que satisfazem as condições de
        busca em cima e são mais recentes que "/caminho/para/
        timestamp"

    Por favor note a utilização idiomática de "-prune -o" para
    excluir ficheiros no exemplo em cima.

    Nota

    Para um sistema não-Debian tipo Unix, algumas opções podem não
    ser suportadas pelo find(1). Em tal caso, por favor considere
    ajustar os métodos de correspondência e substitua "-print0" por
    "-print". Poderá ter que ajustar também os comandos relacionados.

%

10.1.6. Meio de arquivo

    Quando escolher o meio de armazenamento de dados de computador
    para arquivar dados importantes, deverá ter cuidado com as suas
    limitações. Para os pequenos backups de dados pessoais uso CD-Rs
    e DVD-Rs de uma boa marca e guardo-os num ambiente fresco, à
    sombra, seco e limpo. (O meio de cassete de fita magnética parece
    ser popular para uso profissional.)

    Nota

    A segurança de resistência ao fogo destina-se a documentos de
    papel. A maioria dos meios de armazenamento de dados de
    computador têm menos tolerância à temperatura que o papel.
    Geralmente Confio em múltiplas cópias de segurança encriptadas em
    múltiplas localizações seguras.

    A duração de vida optimista de meios de arquivo vista na net (a
    maioria é informação do fabricante).

      * + de 100 anos : Papel livre de ácidos com tinta

      * 100 anos : Armazenamento óptico (CD/DVD, CD/DVD-R)
   
      * 30 anos : Armazenamento magnético (fita, disquete)

      * 20 anos : Armazenamento óptico de mudança de fase (CD-RW)

    Estes não contam com falhas mecânicas devido a manuseamento e
    etc.

    Ciclos de escrita optimistas dos meios de arquivo vistos na net
    (a maioria é informação do fabricante).

      * + de 250,000 ciclos : Disco rígido

      * + de 10,000 ciclos : Memória Flash
   
      * 1,000 ciclos : CD/DVD-RW

      * 1 ciclo : CD/DVD-R, papel

    Cuidado

    As figuras de vida de armazenamento e ciclos de escrita mostradas
    aqui não devem ser usadas para decisões em qualquer armazenamento
    de dados crítico. Por favor consulte a informação específica do
    produto disponibilizada pelo fabricante.

    Dica

    Como os CD/DVD-R e o papel têm apenas 1 ciclo de escrita, eles
    previnem perdas de dados acidentais ao sobrescrever. Isto é uma
    vantagem!

    Dica

    Se precisa de um backup rápido e frequente de grandes quantidades
    de dados, um disco rígido numa máquina remota ligada por uma
    ligação de rede rápida, pode ser a única opção realista.

%

10.1.7. Aparelho de armazenamento amovível

    Aparelhos de armazenamento amovível podem ser qualquer um dos
    seguintes.

      * Pen USB

      * Disco Rígido

      * Leitor de disco óptico

      * Câmara digital

      * Leitor digital de música

    Podem ser ligados por qualquer um dos seguintes:

      * USB

      * IEEE 1394 / FireWire

      * PC Card

    Os ambientes de trabalho modernos tais como o GNOME e KDE podem
    montar automaticamente estes aparelhos amovíveis sem uma entrada
    correspondente no "/etc/fstab".

      * O pacote udisks disponibiliza um daemon e utilitários
        associados para (des)montar esses aparelhos.
   
      * D-bus cria eventos para iniciar processos automáticos.

      * PolicyKit disponibiliza os privilégios necessários.

    Dica
   
    Os aparelhos auto-montados podem ter a opção de montagem "uhelper
    =" que é utilizada por umount(8).

    Dica

    A auto-montagem em ambientes de trabalho modernos apenas acontece
    quando esses aparelhos amovíveis não estão listados em "/etc/
    fstab".

    O ponto de montagem num ambiente de trabalho moderno é escolhido
    como "/media/<disk_label>", o qual pode ser personalizado
    conforme o seguinte:

      * mlabel(1) para o sistema de ficheiros FAT

      * genisoimage(1) com a opção "-V" para o sistema de ficheiros
        ISO9660

      * tune2fs(1) com a opção "-L" para sistemas de ficheiros ext2/
        ext3/ext4

    Dica

    A escolha de codificação pode necessitar de ser disponibilizada
    como opção de montagem (veja Secção 8.4.6, “Codificação de nomes
    de ficheiros”).

    Dica

    A utilização do menu da GUI para desmontar um sistema de
    ficheiros pode remover o nó de aparelho dele gerado dinamicamente
    tal como "/dev/sdc". Se desejar manter o nó de aparelho dele,
    desmonte-o com o comando umount(8) na linha de comandos da shell.

%

10.1.8. Escolha de sistema de ficheiros para partilhar dados

    Quando partilha dados com outros sistemas via aparelhos de
    armazenamento amovível, deve formatá-lo num sistema de ficheiros
    comum que seja suportado pelos dois sistemas. Aqui está uma lista
    de escolhas de sistemas de ficheiros.

    Tabela 10.3. Lista de hipóteses de sistemas de ficheiros para
    aparelhos de armazenamento amovíveis com cenários de utilização
    típica

    +---------------------------------------------------------------+
    |sistema de|     descrição do cenário de utilização típico      |
    |ficheiros |                                                    |
    |----------+----------------------------------------------------|
    |FAT12     |partilha de dados em várias plataformas em disquetes|
    |          |(<32MiB)                                            |
    |----------+----------------------------------------------------|
    |FAT16     |partilha de dados em várias plataformas em aparelhos|
    |          |como pequenos discos rígidos (<2GiB)                |
    |----------+----------------------------------------------------|
    |          |partilha de dados em várias plataformas em aparelhos|
    |FAT32     |como grandes discos rígidos (<8TiB, suportado por   |
    |          |mais recente que MS Windows95 OSR2)                 |
    |----------+----------------------------------------------------|
    |          |partilha de dados em várias plataformas em aparelhos|
    |NTFS      |como grandes discos rígidos (suportado nativamente  |
    |          |no MS Windows NT e versões posteriores e suportado  |
    |          |pelo NTFS-3G via FUSE em Linux)                     |
    |----------+----------------------------------------------------|
    |ISO9660   |partilha de dados estáticos em várias plataformas em|
    |          |CD-R e DVD+/-R                                      |
    |----------+----------------------------------------------------|
    |UDF       |escrita de dados incremental em CD-R e DVD+/-R      |
    |          |(novo)                                              |
    |----------+----------------------------------------------------|
    |sistema de|armazenamento de dados em ficheiros unix eficiente  |
    |ficheiros |em espaço em disquetes                              |
    |MINIX     |                                                    |
    |----------+----------------------------------------------------|
    |sistema de|partilha de dados em aparelhos tipo disco rígido com|
    |ficheiros |sistemas Linux mais antigos                         |
    |ext2      |                                                    |
    |----------+----------------------------------------------------|
    |sistema de|partilha de dados em aparelhos tipo disco rígido com|
    |ficheiros |sistemas Linux mais antigos                         |
    |ext3      |                                                    |
    |----------+----------------------------------------------------|
    |sistema de|partilha de dados em aparelhos de tipo disco rígido |
    |ficheiros |com sistemas Linux atuais                           |
    |ext4      |                                                    |
    +---------------------------------------------------------------+


    Dica

    Veja Secção 9.8.1, “Encriptação de discos amovíveis com dm-crypt/
    LUKS” para partilha de dados em várias plataformas a usar
    encriptação ao nível do aparelho.

    O sistema de ficheiros FAT é suportado pela maioria dos sistemas
    operativos modernos e é bastante útil para objetivos de trocas de
    dados via aparelhos tipo disco rígido.

    Quando formatar aparelhos tipo disco rígido amovíveis para
    partilha de dados em multi-plataformas com o sistema de ficheiros
    FAT, as seguintes deverão ser escolhas seguras.

      * Particioná-los com o fdisk(8), cfdisk(8) ou parted(8) (veja
        Secção 9.5.2, “Configuração das partições do disco”) numa
        única partição primária e marcá-la como a seguir.

          + Tipo "6" para FAT16 para médias inferiores a 2GB.

          + Tipo "c" para FAT32 (LBA) para médias maiores.
   
      * Formatar a partição primária com o mkfs.vfat(8) com o
        seguinte.

          + Apenas o nome de aparelho dele, ex. "/dev/sda1" para
            FAT16

          + A opção explícita e o nome de aparelho dela, ex. "-F 32 /
            dev/sda1" para FAT32

    Quando se usa sistemas de ficheiros FAT ou ISO9660 para partilhar
    dados, as considerações de segurança deverão ser as seguintes.

      * Arquivar ficheiros para um ficheiro de arquivo primeiro a
        utilizar o tar(1), ou cpio(1) para reter o nome longo do
        ficheiro, a ligação simbólica, as permissões originais de
        ficheiro Unix e a informação do dono.

      * Dividir o ficheiro de arquivo em fatias com menos de 2 GiB
        com o comando split(1) para o proteger contra limites de
        tamanho de ficheiro.

      * Encriptar o ficheiro de arquivo para segurar o conteúdo dele
        contra acesso não autorizado.

    Nota

    Para o sistema de ficheiros FAT pelo seu desenho, o tamanho
    máximo de ficheiro é (2^32 - 1) bytes = (4GiB - 1 byte). Para
    algumas aplicações do antigo SO de 32 bits, o tamanho máximo de
    ficheiro é mais pequeno (2^31 - 1) bytes = (2GiB - 1 byte). O
    Debian não sofre do segundo problema.

    Nota

    A própria Microsoft não recomenda o uso de FAT para discos ou
    partições maiores que 200 MB. A Microsoft destaca as suas
    deficiências como a ser a utilização ineficiente do espaço do
    disco na "Visão geral dos sistemas de ficheiros FAT, HPFS e NTFS"
    dele. Claro que devemos normalmente usar o sistema de ficheiros
    ext4 para Linux.

    Dica
   
    Para mais sistemas de ficheiros e acesso a sistemas de ficheiros,
    por favor leia "HOWTO dos Sistemas de Ficheiros".

%

10.1.9. Partilhar dados via a rede

    Quando se partilha dados com outro sistema via rede, deve usar
    serviços comuns. Aqui estão algumas dicas.

    Tabela 10.4. Lista de serviços de rede para escolher com o
    cenário de utilização típico

    +---------------------------------------------------------------+
    |   serviço de rede   |descrição do cenário de utilização típico|
    |---------------------+-----------------------------------------|
    |SMB/CIFS sistema de  |partilha ficheiros via "Rede Microsoft   |
    |ficheiros montado em |Windows", veja smb.conf(5) e O HOWTO     |
    |rede com o Samba     |Oficial do Samba 3.x.x e Guia de         |
    |                     |Referência ou o pacote samba-doc         |
    |---------------------+-----------------------------------------|
    |NFS sistema de       |                                         |
    |ficheiros montado em |partilhar ficheiros via "Rede Unix/      |
    |rede com o kernel do |Linux", veja exports(5) e Linux NFS-HOWTO|
    |Linux                |                                         |
    |---------------------+-----------------------------------------|
    |serviço HTTP         |a partilhar ficheiros entre o servidor/  |
    |                     |cliente web                              |
    |---------------------+-----------------------------------------|
    |                     |partilhar ficheiros entre o servidor/    |
    |serviço HTTPS        |cliente web com Secure Sockets Layer     |
    |                     |encriptado (SSL) ou Transport Layer      |
    |                     |Security (TLS)                           |
    |---------------------+-----------------------------------------|
    |serviço FTP          |a partilhar ficheiros entre o servidor/  |
    |                     |cliente FTP                              |
    +---------------------------------------------------------------+


    Apesar de estes sistemas de ficheiros montados sobre rede e
    métodos de transferência de ficheiros em rede serem bastante
    convenientes para partilhar dados, estes podem ser inseguros. A
    ligação de rede deles tem de ser segurada com o seguinte.

      * Encriptar com SSL/TLS

      * Ligue-o em túnel via SSH
   
      * Ligue-o em túnel via VPN

      * Limitar por detrás da firewall segura

    Veja também Secção 6.10, “Outras aplicações de servidor de rede”
    e Secção 6.11, “Outros clientes de aplicação de rede”.

%

10.2. Salvaguarda (backup) e recuperação

    Todos sabemos que os computadores avariam ou que erros humanos
    causam danos no sistema e nos dados. As operações de salvaguarda
    e recuperação são a parte essencial sucesso do administrador de
    sistemas. Todos os modos de falha possíveis irão atingi-lo um
    dia.

    Dica

    Mantenha o seu sistema de backup simples e faça backups
    periódicos. Ter cópias de segurança dos dados é mais importante
    do que quão bom é tecnicamente o seu método de backup.

    Existem 3 factores chave que determinam a política atual de
    salvaguarda e recuperação.

     1. Saber o que salvaguardar e recuperar.

          + Ficheiros de dados criados directamente por si: dados em
            "~/"

          + Ficheiros de dados criados por aplicações usadas por si:
            dados em "/var/" (excepto "/var/cache/", "/var/run/" e "/
            var/tmp/")

          + Ficheiros de configuração do sistema: dados em "/etc/"

          + Softwares locais: dados em "/usr/local/" ou "/opt/"

          + Informação da instalação do sistema: um memo em texto
            simples em passos chave (partição, ...)

          + Conjunto de dados de prova: confirmado com antecedência
            por operações de recuperação experimentais
   
     2. Saber como salvaguardar e recuperar.

          + Armazenamento de dados seguro: protecção contra reescrita
            e falha do sistema

          + Salvaguarda frequente: salvaguarda agendada

          + Backup redundante: usar mirror de dados

          + Processo à prova de tolos: backup fácil de comando único

     3. Avaliar os riscos e custos envolvidos.

          + O valor dos dados quando perdidos

          + Recursos necessários para o backup: humano, hardware,
            software,…

          + Modo de falha e a possibilidade dele

    Nota

    Não faça salvaguarda aos conteúdos dos pseudo-sistemas de
    ficheiros encontrados em /proc, /sys, /tmp e /run (veja
    Secção 1.2.12, “procfs e sysfs” e Secção 1.2.13, “tmpfs”). A
    menos que saiba exatamente o que está a fazer, eles são enormes
    quantidades de dados desnecessários.

    Para o armazenamento seguro de dados, os dados devem estar pelo
    menos em partições de disco diferentes de preferência em discos e
    máquinas diferentes para sobreviverem à corrupção do sistema de
    ficheiros. Os dados importantes ficam melhor armazenados em
    medias onde só se escreve uma vez, como os CD/DVD-R para prevenir
    serem sobrescritos por acidente. (veja Secção 9.7, “Os dados
    binários” para como escrever na media de armazenamento a partir
    da linha de comandos shell. O ambiente gráfico de trabalho GNOME
    dá-lhe acesso fácil via menu: "Acessórios→Criador de CD/DVD".)

    Nota

    Pode desejar parar alguns daemons de aplicação como o MTA (veja
    Secção 6.3, “Agente de transporte de mail (MTA)”) enquanto faz
    cópias de segurança (backups) dos dados.

    Nota

    Deve ter cuidados extra com o backup e restauro de ficheiros de
    dados relacionados com identidade como os "/etc/ssh/
    ssh_host_dsa_key", "/etc/ssh/ssh_host_rsa_key", "~/.gnupg/*", "~
    /.ssh/*", "/etc/passwd", "/etc/shadow", "/etc/fetchmailrc",
    "popularity-contest.conf", "/etc/ppp/pap-secrets" e "/etc/exim4/
    passwd.client". Alguns destes dados não podem ser regenerados ao
    inserir a mesma string de entrada ao sistema.

    Nota

    Se executa uma tarefa cron como um processo de utilizador, tem de
    restaurar os ficheiros no diretório "/var/spool/cron/crontabs" e
    reiniciar o cron(8). Veja Secção 9.3.14, “Agendar tarefas
    regularmente” para cron(8) e crontab(1).

%

10.2.1. Suites de utilitários de backup

    Aqui está uma lista selcionada de suites de utilitários de backup
    notáveis disponíveis no sistema Debian.

    Tabela 10.5. Lista de suites utilitárias de salvaguarda

    +---------------------------------------------------------------+
    |    pacote    |popcon|tamanho|            descrição            |
    |--------------+------+-------+---------------------------------|
    |              |V:1,  |       |4.4 BSD dump(8) e restore(8) para|
    |dump          |I:6   |352    |sistemas de ficheiros ext2/ext3/ |
    |              |      |       |ext4                             |
    |--------------+------+-------+---------------------------------|
    |              |V:0,  |       |dump e restore com xfsdump(8) e  |
    |xfsdump       |I:9   |854    |xfsrestore(8) para sistema de    |
    |              |      |       |ficheiros XFS em GNU/Linux e IRIX|
    |--------------+------+-------+---------------------------------|
    |backupninja   |V:4,  |355    |sistema de meta-backup leve e    |
    |              |I:5   |       |extensível                       |
    |--------------+------+-------+---------------------------------|
    |              |V:10, |       |Bacula: salvaguarda, recuperação |
    |bacula-common |I:15  |2158   |e verificação em rede - ficheiros|
    |              |      |       |de suporte comum                 |
    |--------------+------+-------+---------------------------------|
    |              |      |       |Bacula: salvaguarda, recuperação |
    |bacula-client |I:3   |183    |e verificação em rede -          |
    |              |      |       |meta-pacote cliente              |
    |--------------+------+-------+---------------------------------|
    |              |V:1,  |       |Bacula: salvaguarda, recuperação |
    |bacula-console|I:5   |107    |e verificação em rede - consola  |
    |              |      |       |de texto                         |
    |--------------+------+-------+---------------------------------|
    |              |      |       |Bacula: salvaguarda, recuperação |
    |bacula-server |I:1   |183    |e verificação em rede -          |
    |              |      |       |meta-pacote servidor             |
    |--------------+------+-------+---------------------------------|
    |              |V:0,  |       |Amanda: Advanced Maryland        |
    |amanda-common |I:2   |10031  |Automatic Network Disk Archiver  |
    |              |      |       |(Bibliotecas)                    |
    |--------------+------+-------+---------------------------------|
    |              |V:0,  |       |Amanda: Advanced Maryland        |
    |amanda-client |I:2   |1089   |Automatic Network Disk Archiver  |
    |              |      |       |(Cliente)                        |
    |--------------+------+-------+---------------------------------|
    |              |V:0,  |       |Amanda: Advanced Maryland        |
    |amanda-server |I:0   |1076   |Automatic Network Disk Archiver  |
    |              |      |       |(Servidor)                       |
    |--------------+------+-------+---------------------------------|
    |backup-manager|V:1,  |572    |ferramenta de salvaguarda de     |
    |              |I:2   |       |linha de comandos                |
    |--------------+------+-------+---------------------------------|
    |              |      |       |ferramenta de baixa manutenção   |
    |backup2l      |V:0,  |114    |para salvaguarda/restauro para   |
    |              |I:1   |       |medias montáveis (baseado em     |
    |              |      |       |disco)                           |
    |--------------+------+-------+---------------------------------|
    |              |      |       |BackupPC é um sistema de grau    |
    |backuppc      |V:3,  |3182   |empresarial de alta performance  |
    |              |I:3   |       |para fazer salvaguardas a PCs    |
    |              |      |       |(baseado em disco)               |
    |--------------+------+-------+---------------------------------|
    |duplicity     |V:7,  |1761   |salvaguarda incremental (remoto) |
    |              |I:15  |       |                                 |
    |--------------+------+-------+---------------------------------|
    |flexbackup    |V:0,  |243    |salvaguarda incremental (remoto) |
    |              |I:0   |       |                                 |
    |--------------+------+-------+---------------------------------|
    |rdiff-backup  |V:7,  |733    |salvaguarda incremental (remoto) |
    |              |I:15  |       |                                 |
    |--------------+------+-------+---------------------------------|
    |restic        |V:1,  |20595  |salvaguarda incremental (remoto) |
    |              |I:3   |       |                                 |
    |--------------+------+-------+---------------------------------|
    |rsnapshot     |V:5,  |462    |salvaguarda incremental (remoto) |
    |              |I:11  |       |                                 |
    |--------------+------+-------+---------------------------------|
    |slbackup      |V:0,  |151    |salvaguarda incremental (remoto) |
    |              |I:0   |       |                                 |
    +---------------------------------------------------------------+


    As ferramentas de salvaguarda têm os seus objetivos
    especializados.

      * Mondo Rescue é um sistema de backup para facilitar o restauro
        de um sistema completo rapidamente a partir de CD/DVD, etc de
        backup, sem se passar por todo o processo normal de
        instalação do sistema.

      * Cópias de segurança regulares dos dados do utilizador podem
        ser realizados por um script simples (Secção 10.2.2, “Um
        script de exemplo para salvaguarda ao sistema”) e cron(1).

      * Bacula, Amanda e BackupPC são suites utilitárias de
        salvaguarda cheias de funcionalidades que se destinam a
        salvaguardas regulares em rede.

    Ferramentas básicas descritas em Secção 10.1.1, “Ferramentas de
    arquivo e compressão” e Secção 10.1.2, “Ferramentas de cópia de
    sincronização” podem ser usadas facilitar o backup do sistema via
    scripts personalizados. Tal script pode ser melhorado com o
    seguinte.

      * O pacote restic permite salvaguardas incrementais (remotas).

      * O pacote rdiff-backup permite salvaguardas incrementais
        (remotas).

      * O pacote dump ajuda a arquivar e restaurar o sistema de
        ficheiros completo de modo incremental e eficiente.

    Dica
   
    Veja os ficheiros em "/usr/share/doc/dump/" e "está o dump mesmo
    obsoleto?" para aprender acerca do pacote dump.

%

10.2.2. Um script de exemplo para salvaguarda ao sistema

    Para um sistema de ambiente de trabalho Debian pessoal que corre
    a suite unstable, Apenas preciso de proteger os dados pessoais e
    críticos. Reinstalo o sistema uma vez por ano de qualquer
    maneira. Assim não vejo razão para fazer backup ao sistema
    completo ou para instalar um utilitário de backup cheio de
    funcionalidades.

    Uso um script simples para fazer um arquivo salvaguarda e
    gravá-lo em CD/DVD a usar uma GUI. Aqui está um script exemplo
    para tal.

    #!/bin/sh -e
    # Copyright (C) 2007-2008 Osamu Aoki <osamu@debian.org>, Public Domain
    BUUID=1000; USER=osamu # UID and name of a user who accesses backup files
    BUDIR="/var/backups"
    XDIR0=".+/Mail|.+/Desktop"
    XDIR1=".+/\.thumbnails|.+/\.?Trash|.+/\.?[cC]ache|.+/\.gvfs|.+/sessions"
    XDIR2=".+/CVS|.+/\.git|.+/\.svn|.+/Downloads|.+/Archive|.+/Checkout|.+/tmp"
    XSFX=".+\.iso|.+\.tgz|.+\.tar\.gz|.+\.tar\.bz2|.+\.cpio|.+\.tmp|.+\.swp|.+~"
    SIZE="+99M"
    DATE=$(date --utc +"%Y%m%d-%H%M")
    [ -d "$BUDIR" ] || mkdir -p "BUDIR"
    umask 077
    dpkg --get-selections \* > /var/lib/dpkg/dpkg-selections.list
    debconf-get-selections > /var/cache/debconf/debconf-selections

    {
    find /etc /usr/local /opt /var/lib/dpkg/dpkg-selections.list \
         /var/cache/debconf/debconf-selections -xdev -print0
    find /home/$USER /root -xdev -regextype posix-extended \
      -type d -regex "$XDIR0|$XDIR1" -prune -o -type f -regex "$XSFX" -prune -o \
      -type f -size  "$SIZE" -prune -o -print0
    find /home/$USER/Mail/Inbox /home/$USER/Mail/Outbox -print0
    find /home/$USER/Desktop  -xdev -regextype posix-extended \
      -type d -regex "$XDIR2" -prune -o -type f -regex "$XSFX" -prune -o \
      -type f -size  "$SIZE" -prune -o -print0
    } | cpio -ov --null -O $BUDIR/BU$DATE.cpio
    chown $BUUID $BUDIR/BU$DATE.cpio
    touch $BUDIR/backup.stamp

    Este é suposto ser um script de exemplo executado pelo root.

    Espero que altere e execute isto conforme o seguinte.

      * Edite este script para cobrir todos os seus dados importantes
        (veja Secção 10.1.5, “Idiomas para a seleção de ficheiros” e
        Secção 10.2, “Salvaguarda (backup) e recuperação”).

      * Substitua "find … -print0" por "find … -newer $BUDIR/
        backup.stamp -print0" para fazer uma salvaguarda incremental.

      * Transfira os ficheiros de backup para a máquina remota a usar
        scp(1) ou rsync(1) ou grave-os em CD/DVD para segurança extra
        dos dados. (Uso a GUI do ambiente GNOME para gravar CD/DVD.
        Veja See Secção 12.1.8, “Exemplo de script de shell com
        zenity” para redundância extra.)

    Mantenha a coisa simples!

    Dica

    Pode recuperar dados configuração debconf com
    "debconf-set-selections debconf-selections" e dados de seleção do
    dpkg com "dpkg --set-selection <dpkg-selections.list".

%

10.2.3. Um script de cópia para a salvaguarda de dados

    Para o conjunto de dados sob uma árvore de diretórios, a cópia
    com "cp -a" disponibiliza um backup normal.

    Para o conjunto de grandes dados estáticos não sobrescritos sob
    uma árvore de diretórios como aquela sob o diretório "/var/cache/
    apt/packages/", as ligações rígidas com "cp -al" disponibilizam
    uma alternativa ao backup normal com uso eficiente do espaço do
    disco.

    Aqui está um script de cópia, que Chamei de bkup, para o backup
    de dados. O script copia todos os ficheiro (não-VCS) sob o
    diretório atual para o diretório datado no diretório pai ou numa
    máquina remota.

    #!/bin/sh -e
    # Copyright (C) 2007-2008 Osamu Aoki <osamu@debian.org>, Public Domain
    fdot(){ find . -type d \( -iname ".?*" -o -iname "CVS" \) -prune -o -print0;}
    fall(){ find . -print0;}
    mkdircd(){ mkdir -p "$1";chmod 700 "$1";cd "$1">/dev/null;}
    FIND="fdot";OPT="-a";MODE="CPIOP";HOST="localhost";EXTP="$(hostname -f)"
    BKUP="$(basename $(pwd)).bkup";TIME="$(date  +%Y%m%d-%H%M%S)";BU="$BKUP/$TIME"
    while getopts gcCsStrlLaAxe:h:T f; do case $f in
    g)  MODE="GNUCP";; # cp (GNU)
    c)  MODE="CPIOP";; # cpio -p
    C)  MODE="CPIOI";; # cpio -i
    s)  MODE="CPIOSSH";; # cpio/ssh
    t)  MODE="TARSSH";; # tar/ssh
    r)  MODE="RSYNCSSH";; # rsync/ssh
    l)  OPT="-alv";; # ligação rígida (GNU cp)
    L)  OPT="-av";;  # copy (GNU cp)
    a)  FIND="fall";; # find all
    A)  FIND="fdot";; # find non CVS/ .???/
    x)  set -x;; # trace
    e)  EXTP="${OPTARG}";; # hostname -f
    h)  HOST="${OPTARG}";; # user@remotehost.example.com
    T)  MODE="TEST";; # test find mode
    \?) echo "use -x for trace."
    esac; done
    shift $(expr $OPTIND - 1)
    if [ $# -gt 0 ]; then
      for x in $@; do cp $OPT $x $x.$TIME; done
    elif [ $MODE = GNUCP ]; then
      mkdir -p "../$BU";chmod 700 "../$BU";cp $OPT . "../$BU/"
    elif [ $MODE = CPIOP ]; then
      mkdir -p "../$BU";chmod 700 "../$BU"
      $FIND|cpio --null --sparse -pvd ../$BU
    elif [ $MODE = CPIOI ]; then
      $FIND|cpio -ov --null | ( mkdircd "../$BU"&&cpio -i )
    elif [ $MODE = CPIOSSH ]; then
      $FIND|cpio -ov --null|ssh -C $HOST "( mkdircd \"$EXTP/$BU\"&&cpio -i )"
    elif [ $MODE = TARSSH ]; then
      (tar cvf - . )|ssh -C $HOST "( mkdircd \"$EXTP/$BU\"&& tar xvfp - )"
    elif [ $MODE = RSYNCSSH ]; then
      rsync -aHAXSv ./ "${HOST}:${EXTP}-${BKUP}-${TIME}"
    else
      echo "Any other idea to backup?"
      $FIND |xargs -0 -n 1 echo
    fi

    Isto é suposto ser exemplos de comandos. Por favor, leia o script
    e edite-o à sua necessidade antes de o usar.

    Dica

    Tenho este bkup no meu diretório "/usr/local/bin/". Chamo este
    comando bkup sem nenhuma opção no diretório de trabalho sempre
    que preciso duma imagem de backup temporária.

    Dica

    Para fazer um histórico de imagens de uma árvore de ficheiros
    fonte ou duma árvore de ficheiros de configuração, é mais fácil e
    eficiente em espaço usar o git(7) (veja Secção 10.6.5, “Git para
    gravar o histórico de configuração”).

%

10.3. Infraestrutura da segurança de dados

    A infraestrutura de segurança dos dados é disponibilizada pela
    combinação de uma ferramenta de encriptação de dados, ferramenta
    de resumo de mensagens e ferramenta de assinaturas.

    Tabela 10.6. Lista de ferramentas de infraestrutura da segurança
    de dados

    +---------------------------------------------------------------+
    |    pacote    |popcon|tamanho| comando  |      descrição       |
    |--------------+------+-------+----------+----------------------|
    |              |      |       |          |GNU Privacy Guard -   |
    |gnupg         |V:531,|787    |gpg(1)    |ferramenta de         |
    |              |I:950 |       |          |encriptação e         |
    |              |      |       |          |assinatura OpenPGP    |
    |--------------+------+-------+----------+----------------------|
    |              |      |       |          |GNU Privacy Guard -   |
    |gpgv          |V:880,|859    |gpgv(1)   |ferramenta de         |
    |              |I:999 |       |          |verificação de        |
    |              |      |       |          |assinaturas           |
    |--------------+------+-------+----------+----------------------|
    |              |      |       |          |extrai apenas a       |
    |paperkey      |V:1,  |58     |paperkey  |informação secreta de |
    |              |I:13  |       |(1)       |chaves secretas       |
    |              |      |       |          |OpenPGP               |
    |--------------+------+-------+----------+----------------------|
    |              |      |       |          |utilitários para      |
    |              |V:29, |       |cryptsetup|encriptação de        |
    |cryptsetup    |I:78  |402    |(8), …    |aparelhos de bloco do |
    |              |      |       |          |dm-crypto que suportam|
    |              |      |       |          |LUKS                  |
    |--------------+------+-------+----------+----------------------|
    |              |      |       |          |utilitários para      |
    |ecryptfs-utils|V:3,  |460    |ecryptfs  |encriptação de        |
    |              |I:5   |       |(7), …    |sistemas de ficheiros |
    |              |      |       |          |empilhados do ecryptfs|
    |--------------+------+-------+----------+----------------------|
    |coreutils     |V:891,|17478  |md5sum(1) |computa e verifica o  |
    |              |I:999 |       |          |resumo da mensagem MD5|
    |--------------+------+-------+----------+----------------------|
    |              |V:891,|       |          |computa e verifica o  |
    |coreutils     |I:999 |17478  |sha1sum(1)|resumo da mensagem    |
    |              |      |       |          |SHA1                  |
    |--------------+------+-------+----------+----------------------|
    |              |V:794,|       |openssl   |computa o resumo da   |
    |openssl       |I:993 |1465   |(1ssl)    |mensagem com "openssl |
    |              |      |       |          |dgst" (OpenSSL)       |
    +---------------------------------------------------------------+


    Veja Secção 9.8, “Dicas de encriptação de dados” em dm-crypto e
    ecryptfs os quais implementam infraestruturas de encriptação de
    dados automática via módulos do kernel Linux.

%

10.3.1. Gestão de chaves para GnuPG

    Aqui estão comandos do GNU Privacy Guard para gestão de chaves
    básica.

    Tabela 10.7. Lista de comandos do GNU Privacy Guard para gestão
    de chaves

    +---------------------------------------------------------------+
    |        comando         |              descrição               |
    |------------------------+--------------------------------------|
    |gpg --gen-key           |gerar uma chave nova                  |
    |------------------------+--------------------------------------|
    |gpg --gen-revoke        |gera chave de revogação para          |
    |meu_ID_utilizador       |meu_ID_utilizador                     |
    |------------------------+--------------------------------------|
    |gpg --edit-key          |edita chave interativamente, "help"   |
    |ID_utilizador           |para ajuda                            |
    |------------------------+--------------------------------------|
    |gpg -o ficheiro --export|exporta todas as chaves para ficheiro |
    |------------------------+--------------------------------------|
    |gpg --import ficheiro   |importa todas as chaves de ficheiro   |
    |------------------------+--------------------------------------|
    |gpg --send-keys         |envia chave de ID_utilizador para     |
    |ID_utilizador           |servidor de chaves                    |
    |------------------------+--------------------------------------|
    |gpg --recv-keys         |recupera chave de ID_utilizador do    |
    |ID_utilizador           |servidor de chaves                    |
    |------------------------+--------------------------------------|
    |gpg --list-keys         |lista chaves de ID_utilizador         |
    |ID_utilizador           |                                      |
    |------------------------+--------------------------------------|
    |gpg --list-sigs         |lista assinaturas de ID_utilizador    |
    |ID_utilizador           |                                      |
    |------------------------+--------------------------------------|
    |gpg --check-sigs        |verifica assinaturas de ID_utilizador |
    |ID_utilizador           |                                      |
    |------------------------+--------------------------------------|
    |gpg --fingerprint       |verifica a impressão digital de       |
    |ID_utilizador           |ID_utilizador                         |
    |------------------------+--------------------------------------|
    |gpg --refresh-keys      |atualiza o chaveiro local             |
    +---------------------------------------------------------------+


    Aqui está o significado do código de confiança.

    Tabela 10.8. Lista do significado do código de confiança

    +---------------------------------------------------------------+
    |código|                 descrição de confiança                 |
    |------+--------------------------------------------------------|
    |-     |nenhuma confiança de dono atribuída / ainda não         |
    |      |calculado                                               |
    |------+--------------------------------------------------------|
    |e     |falha no cálculo da confiança                           |
    |------+--------------------------------------------------------|
    |q     |não existe informação suficiente para o cálculo         |
    |------+--------------------------------------------------------|
    |n     |nunca confiar nesta chave                               |
    |------+--------------------------------------------------------|
    |m     |marginalmente confiável                                 |
    |------+--------------------------------------------------------|
    |f     |totalmente confiável                                    |
    |------+--------------------------------------------------------|
    |u     |de confiança absoluta                                   |
    +---------------------------------------------------------------+


    O seguinte envia a minha chave "1DD8D791" para o popular servidor
    de chaves "hkp://keys.gnupg.net".

    $ gpg --keyserver hkp://keys.gnupg.net --send-keys 1DD8D791

    Um bom servidor de chaves predefinido configurado em "~/.gnupg/
    gpg.conf" (ou na antiga localização "~/.gnupg/options") contém o
    seguinte.

    keyserver hkp://keys.gnupg.net

    O seguinte obtém chaves desconhecidas do servidor de chaves.

    $ gpg --list-sigs --with-colons | grep '^sig.*\[User ID not found\]' |\
      cut -d ':' -f 5| sort | uniq | xargs gpg --recv-keys

    Existiu um bug no OpenPGP Public Key Server (versão anterior a
    0.9.6) que corrompeu as chaves com mais de 2 sub-chaves. O novo
    pacote gnupg (>1.2.1-2) consegue lidar com estas chaves
    corrompidas. Veja gpg(1) sob a opção "--repair-pks-subkey-bug".

%

10.3.2. Usa GnuPG em ficheiros

    Aqui estão exemplos para usar comandos do GNU Privacy Guard em
    ficheiros.

    Tabela 10.9. Lista de comandos do GNU Privacy Guard em ficheiros

    +---------------------------------------------------------------+
    |        comando        |               descrição               |
    |-----------------------+---------------------------------------|
    |gpg -a -s ficheiro     |assina ficheiro em ficheiro.asc        |
    |                       |blindado de ASCII                      |
    |-----------------------+---------------------------------------|
    |gpg --armor --sign     |, ,                                    |
    |ficheiro               |                                       |
    |-----------------------+---------------------------------------|
    |gpg --clearsign        |mensagem com assinatura clara          |
    |ficheiro               |                                       |
    |-----------------------+---------------------------------------|
    |gpg --clearsign file|  |envia por mail uma mensagem com        |
    |mail foo@example.org   |assinatura clara para foo@example.org  |
    |-----------------------+---------------------------------------|
    |gpg --clearsign        |                                       |
    |--not-dash-escaped     |ficheiro patch com assinatura clara    |
    |patchfile              |                                       |
    |-----------------------+---------------------------------------|
    |gpg --verify ficheiro  |verifica ficheiro com assinatura clara |
    |-----------------------+---------------------------------------|
    |gpg -o ficheiro.sig -b |cria assinatura separada               |
    |ficheiro               |                                       |
    |-----------------------+---------------------------------------|
    |gpg -o ficheiro.sig    |, ,                                    |
    |--detach-sig ficheiro  |                                       |
    |-----------------------+---------------------------------------|
    |gpg --verify           |verifica ficheiro com file.sig         |
    |ficheiro.sig ficheiro  |                                       |
    |-----------------------+---------------------------------------|
    |gpg -o crypt_file.gpg  |encriptação de chave pública destinada |
    |-r nome -e ficheiro    |a nome a partir de ficheiro para       |
    |                       |crypt_file.gpg binário                 |
    |-----------------------+---------------------------------------|
    |gpg -o crypt_file.gpg  |                                       |
    |--recipient nome       |, ,                                    |
    |--encrypt ficheiro     |                                       |
    |-----------------------+---------------------------------------|
    |gpg -o crypt_file.asc  |encriptação de chave pública destinada |
    |-a -r nome -e ficheiro |a nome a partir de ficheiro para       |
    |                       |crypt_file.asc blindado de ASCII       |
    |-----------------------+---------------------------------------|
    |gpg -o crypt_file.gpg  |encriptação simétrica a partir de      |
    |-c ficheiro            |ficheiro para crypt_file.gpg           |
    |-----------------------+---------------------------------------|
    |gpg -o crypt_file.gpg  |, ,                                    |
    |--symmetric ficheiro   |                                       |
    |-----------------------+---------------------------------------|
    |gpg -o crypt_file.asc  |encriptação simétrica destinada a nome |
    |-a -c ficheiro         |a partir de ficheiro para              |
    |                       |crypt_file.asc blindado de ASCII       |
    |-----------------------+---------------------------------------|
    |gpg -o ficheiro -d     |desencriptação                         |
    |crypt_file.gpg -r nome |                                       |
    |-----------------------+---------------------------------------|
    |gpg -o ficheiro        |                                       |
    |--decrypt              |, ,                                    |
    |crypt_file.gpg         |                                       |
    +---------------------------------------------------------------+


%

10.3.3. Usar GnuPG com o Mutt

    Adicione o seguinte a "~/.muttrc" para impedir o GnuPG lento de
    arrancar automaticamente, enquanto permite que seja usado ao
    escrever "S" no menu de índice.

    macro index S ":toggle pgp_verify_sig\n"
    set pgp_verify_sig=no

%

10.3.4. Usar GnuPG com o Vim

    O plugin do gnupg permite-lhe correr o GnuPG transparentemente
    para ficheiros com extensão ".gpg", ".asc" e ".ppg".

    # aptitude install vim-scripts vim-addon-manager
    $ vim-addons install gnupg

%

10.3.5. O valor de controlo MD5

    O md5sum(1) disponibiliza um utilitário para fazer um ficheiro de
    sumário a usar o método em rfc1321 e verificar cada ficheiro com
    ele.

    $ md5sum foo bar >baz.md5
    $ cat baz.md5
    d3b07384d113edec49eaa6238ad5ff00  foo
    c157a79031e1c40f85931829bc5fc552  bar
    $ md5sum -c baz.md5
    foo: OK
    bar: OK

    Nota

    O cálculo do sumário MD5 é menos intensivo para a CPU que o da
    assinatura criptográfica do GNU Privacy Guard (GnuPG).
    Normalmente, apenas o ficheiro de digestão do nível de topo é
    assinado criptograficamente para assegurar a integridade dos
    dados.

%

10.4. Ferramentas de fusão de código fonte

    Existem muitas ferramentas de fusão para código fonte. Os
    seguinte comandos chamaram a minha atenção.

    Tabela 10.10. Lista de ferramentas de fusão de código fonte

    +---------------------------------------------------------------+
    |  pacote  |popcon|tamanho|  comando  |        descrição        |
    |----------+------+-------+-----------+-------------------------|
    |diffutils |V:871,|1598   |diff(1)    |compara ficheiros linha a|
    |          |I:991 |       |           |linha                    |
    |----------+------+-------+-----------+-------------------------|
    |diffutils |V:871,|1598   |diff3(1)   |compara e junta três     |
    |          |I:991 |       |           |ficheiros linha a linha  |
    |----------+------+-------+-----------+-------------------------|
    |vim       |V:106,|3231   |vimdiff(1) |compara dois ficheiros   |
    |          |I:398 |       |           |lado a lado no vim       |
    |----------+------+-------+-----------+-------------------------|
    |patch     |V:99, |248    |patch(1)   |aplica ficheiro diff a um|
    |          |I:725 |       |           |original                 |
    |----------+------+-------+-----------+-------------------------|
    |dpatch    |V:0,  |191    |dpatch(1)  |gere séries de patches   |
    |          |I:11  |       |           |para pacote Debian       |
    |----------+------+-------+-----------+-------------------------|
    |          |V:16, |       |           |produz um histograma de  |
    |diffstat  |I:154 |73     |diffstat(1)|alterações feitas pelo   |
    |          |      |       |           |diff                     |
    |----------+------+-------+-----------+-------------------------|
    |          |V:18, |       |combinediff|cria uma patch cumulativa|
    |patchutils|I:150 |232    |(1)        |de duas patches          |
    |          |      |       |           |incrementais             |
    |----------+------+-------+-----------+-------------------------|
    |patchutils|V:18, |232    |dehtmldiff |extrai um diff de uma    |
    |          |I:150 |       |(1)        |página HTML              |
    |----------+------+-------+-----------+-------------------------|
    |patchutils|V:18, |232    |filterdiff |extrai ou executa diffs  |
    |          |I:150 |       |(1)        |de um ficheiro diff      |
    |----------+------+-------+-----------+-------------------------|
    |          |V:18, |       |fixcvsdiff |corrige ficheiros diff   |
    |patchutils|I:150 |232    |(1)        |criados pelo CVS que o   |
    |          |      |       |           |patch(1) interpreta mal  |
    |----------+------+-------+-----------+-------------------------|
    |patchutils|V:18, |232    |flipdiff(1)|troca a ordem de duas    |
    |          |I:150 |       |           |patches                  |
    |----------+------+-------+-----------+-------------------------|
    |          |      |       |           |mostra que ficheiros são |
    |patchutils|V:18, |232    |grepdiff(1)|modificados por uma patch|
    |          |I:150 |       |           |que corresponde a um     |
    |          |      |       |           |regex                    |
    |----------+------+-------+-----------+-------------------------|
    |          |V:18, |       |interdiff  |mostra as diferenças     |
    |patchutils|I:150 |232    |(1)        |entre dois ficheiros diff|
    |          |      |       |           |unificados               |
    |----------+------+-------+-----------+-------------------------|
    |          |V:18, |       |           |mostra quais ficheiros   |
    |patchutils|I:150 |232    |lsdiff(1)  |são modificados por uma  |
    |          |      |       |           |patch                    |
    |----------+------+-------+-----------+-------------------------|
    |          |V:18, |       |recountdiff|recalcula contagens e    |
    |patchutils|I:150 |232    |(1)        |offsets em diffs de      |
    |          |      |       |           |contexto unificado       |
    |----------+------+-------+-----------+-------------------------|
    |          |V:18, |       |           |corrige os offsets e as  |
    |patchutils|I:150 |232    |rediff(1)  |contagens de um diff     |
    |          |      |       |           |editado manualmente      |
    |----------+------+-------+-----------+-------------------------|
    |patchutils|V:18, |232    |splitdiff  |separa patches           |
    |          |I:150 |       |(1)        |incrementais             |
    |----------+------+-------+-----------+-------------------------|
    |          |      |       |           |desembaralha patches     |
    |patchutils|V:18, |232    |unwrapdiff |cujas linhas foram       |
    |          |I:150 |       |(1)        |alteradas para arrumação |
    |          |      |       |           |de palavras              |
    |----------+------+-------+-----------+-------------------------|
    |wiggle    |V:0,  |174    |wiggle(1)  |aplica patches rejeitadas|
    |          |I:0   |       |           |                         |
    |----------+------+-------+-----------+-------------------------|
    |quilt     |V:3,  |788    |quilt(1)   |gere séries de patches   |
    |          |I:33  |       |           |                         |
    |----------+------+-------+-----------+-------------------------|
    |meld      |V:14, |2972   |meld(1)    |compara e funde ficheiros|
    |          |I:39  |       |           |(GTK)                    |
    |----------+------+-------+-----------+-------------------------|
    |          |V:0,  |       |           |mostra diferenças e funde|
    |dirdiff   |I:2   |166    |dirdiff(1) |alterações entre árvores |
    |          |      |       |           |de diretórios            |
    |----------+------+-------+-----------+-------------------------|
    |          |V:0,  |       |           |compara dois ficheiros   |
    |docdiff   |I:0   |555    |docdiff(1) |palavra a palavra /      |
    |          |      |       |           |caractere a caractere    |
    |----------+------+-------+-----------+-------------------------|
    |          |V:0,  |       |           |ferramenta de fusão de 2 |
    |imediff   |I:0   |157    |imediff(1) |ou 3 vias interactiva de |
    |          |      |       |           |écran completo           |
    |----------+------+-------+-----------+-------------------------|
    |makepatch |V:0,  |102    |makepatch  |gera ficheiros de patch  |
    |          |I:0   |       |(1)        |extensos                 |
    |----------+------+-------+-----------+-------------------------|
    |makepatch |V:0,  |102    |applypatch |aplica ficheiros de patch|
    |          |I:0   |       |(1)        |extensos                 |
    |----------+------+-------+-----------+-------------------------|
    |          |V:9,  |       |           |mostra diferenças de     |
    |wdiff     |I:72  |644    |wdiff(1)   |palavras entre ficheiros |
    |          |      |       |           |de texto                 |
    +---------------------------------------------------------------+


%

10.4.1. Extrair as diferenças para ficheiros fonte

    Os seguintes procedimentos extraem as diferenças entre dois
    ficheiros de fonte e cria os ficheiros diff unificados
    "file.patch0" ou "file.patch1" a depender da localização do
    ficheiro.

    $ diff -u ficheiro.antigo ficheiro.novo > ficheiro.patch0
    $ diff -u antigo/ficheiro novo/ficheiro > ficheiro.patch1

%

10.4.2. Fundir atualizações para ficheiros de fonte

    O ficheiro diff (alternativamente chamado ficheiro patch) é usado
    para enviar uma atualização de um programa. A parte receptora
    aplica esta atualização a outro ficheiro com o seguinte.

    $ patch -p0 ficheiro < ficheiro.patch0
    $ patch -p1 ficheiro < ficheiro.patch1

%

10.4.3. atualizar via fusão-de-3-vias

    Se tiver três versões de um código fonte, pode executar uma
    fusão-de-3-vias efectiva a usar o diff3(1) com o seguinte.

    $ diff3 -m meu.ficheiro ficheiro.antigo teu.ficheiro > ficheiro

%

10.5. Sistemas de controle de versão

    Aqui está um sumário dos sistemas de controle de versão (VCS) no
    sistema Debian.

    Nota
   
    Se é novato nos sistemas VCS, deverá começar a aprender com o Git
    , o qual está a crescer rapidamente na popularidade.

    Tabela 10.11. lista de ferramentas de sistemas de controle de
    versão

    +----------------------------------------------------------------+
    |  pacote  |popcon|tamanho|ferramenta| Tipo VCS  |  comentário   |
    |----------+------+-------+----------+-----------+---------------|
    |          |V:0,  |       |          |           |clone do SCCS  |
    |cssc      |I:2   |2044   |CSSC      |local      |do Unix        |
    |          |      |       |          |           |(descontinuado)|
    |----------+------+-------+----------+-----------+---------------|
    |rcs       |V:3,  |562    |RCS       |local      |"SCCS do Unix  |
    |          |I:19  |       |          |           |bem feito"     |
    |----------+------+-------+----------+-----------+---------------|
    |          |V:5,  |       |          |           |VCS remoto     |
    |cvs       |I:41  |4609   |CVS       |remoto     |standard       |
    |          |      |       |          |           |anterior       |
    |----------+------+-------+----------+-----------+---------------|
    |          |      |       |          |           |"CVS bem       |
    |          |V:20, |       |          |           |feito", o novo |
    |subversion|I:109 |4858   |Subversion|remoto     |VCS remoto     |
    |          |      |       |          |           |standard "de   |
    |          |      |       |          |           |facto"         |
    |----------+------+-------+----------+-----------+---------------|
    |          |      |       |          |           |DVCS rápido em |
    |git       |V:305,|35040  |Git       |distribuído|C (usado pelo  |
    |          |I:478 |       |          |           |kernel Linux e |
    |          |      |       |          |           |outros)        |
    |----------+------+-------+----------+-----------+---------------|
    |mercurial |V:8,  |1053   |Mercurial |distribuído|DVCS em Python |
    |          |I:48  |       |          |           |e algum C      |
    |----------+------+-------+----------+-----------+---------------|
    |          |      |       |          |           |DVCS           |
    |          |      |       |          |           |influenciado   |
    |bzr       |V:2,  |28     |Bazaar    |distribuído|por tla escrito|
    |          |I:16  |       |          |           |em Python      |
    |          |      |       |          |           |(usado pelo    |
    |          |      |       |          |           |Ubuntu)        |
    |----------+------+-------+----------+-----------+---------------|
    |          |      |       |          |           |DVCS com       |
    |darcs     |V:0,  |23159  |Darcs     |distribuído|álgebra        |
    |          |I:7   |       |          |           |inteligente de |
    |          |      |       |          |           |patches (lento)|
    |----------+------+-------+----------+-----------+---------------|
    |          |      |       |          |           |DVCS           |
    |tla       |V:0,  |1011   |GNU arch  |distribuído|principalmente |
    |          |I:2   |       |          |           |por Tom Lord   |
    |          |      |       |          |           |(Histórico)    |
    |----------+------+-------+----------+-----------+---------------|
    |monotone  |V:0,  |5815   |Monotone  |distribuído|DVCS em C++    |
    |          |I:0   |       |          |           |               |
    |----------+------+-------+----------+-----------+---------------|
    |          |      |       |          |           |ecrã GUI de    |
    |          |      |       |          |           |árvores de     |
    |tkcvs     |V:0,  |1498   |CVS, …    |remoto     |repositório VCS|
    |          |I:1   |       |          |           |(CVS,          |
    |          |      |       |          |           |Subversion,    |
    |          |      |       |          |           |RCS)           |
    |----------+------+-------+----------+-----------+---------------|
    |          |      |       |          |           |ecrã GUI de    |
    |gitk      |V:6,  |1723   |Git       |distribuído|árvores de     |
    |          |I:42  |       |          |           |repositório VCS|
    |          |      |       |          |           |(Git)          |
    +----------------------------------------------------------------+


    O VCS é por vezes conhecido como um sistema de controle de
    revisão (RCS), ou gestão de configuração de software (SCM).

    O VCS distribuído como o Git é a ferramenta escolhida nos dias de
    hoje. O CVS e Subversion podem ainda ser úteis para juntar
    algumas atividades de programas de código aberto existentes.

    O Debian disponibiliza serviços Git livres via Serviço Debian
    Salsa.. A sua documentação encontra-se em https://wiki.debian.org
    /Salsa .

    Cuidado
   
    Debian encerrou os antigos serviços alioth e os dados de serviço
    do antigo alioth estão disponíveis em alioth-archive em tarballs.

    Existem algumas bases para criar um arquivo VCS de acesso
    partilhado.

      * Use "umask 002" (veja Secção 1.2.4, “Controlo de permissões
        para ficheiros acabados de criar: umask”)

      * Tornar todos os ficheiros do arquivo VCS pertencentes a um
        grupo pertinente
   
      * ativar a definição de ID de grupo em todos os diretórios do
        arquivo VCS (esquema de criação de ficheiros do tipo BSD,
        veja Secção 1.2.3, “Permissões do sistema de ficheiros”)

      * Fazer o utilizador que partilha o arquivo VCS pertencer ao
        grupo

%

10.5.1. Comparação dos comandos VCS

    Aqui está uma comparação muito simplificada dos comandos VCS
    nativos para disponibilizar a ideia geral. A sequência de
    comandos típica pode requerer opções e argumentos.

    Tabela 10.12. Comparação dos comandos VCS nativos

    +---------------------------------------------------------------+
    |     Git      | CVS  |Subversion|            função            |
    |--------------+------+----------+------------------------------|
    |git init      |cvs   |svn create|cria o repositório (local)    |
    |              |init  |          |                              |
    |--------------+------+----------+------------------------------|
    |-             |cvs   |-         |login ao repositório remoto   |
    |              |login |          |                              |
    |--------------+------+----------+------------------------------|
    |              |      |          |faz check out ao repositório  |
    |git clone     |cvs co|svn co    |remoto como a árvore de       |
    |              |      |          |trabalho                      |
    |--------------+------+----------+------------------------------|
    |git pull      |cvs up|svn up    |atualiza a árvore de trabalho |
    |              |      |          |ao fundir o repositório remoto|
    |--------------+------+----------+------------------------------|
    |git add .     |cvs   |svn add   |adiciona ficheiro(s) na árvore|
    |              |add   |          |de trabalho do VCS            |
    |--------------+------+----------+------------------------------|
    |git rm        |cvs rm|svn rm    |remove ficheiro(s) na árvore  |
    |              |      |          |de trabalho do VCS            |
    |--------------+------+----------+------------------------------|
    |-             |cvs ci|svn ci    |comete alterações ao          |
    |              |      |          |repositório remoto            |
    |--------------+------+----------+------------------------------|
    |git commit -a |-     |-         |comete alterações ao          |
    |              |      |          |repositório local             |
    |--------------+------+----------+------------------------------|
    |git push      |-     |-         |atualiza o repositório remoto |
    |              |      |          |pelo repositório local        |
    |--------------+------+----------+------------------------------|
    |git status    |cvs   |svn status|mostra o estado da árvore de  |
    |              |status|          |trabalho do VCS               |
    |--------------+------+----------+------------------------------|
    |git diff      |cvs   |svn diff  |diff <repositório_referência> |
    |              |diff  |          |<árvore_de_trabalho>          |
    |--------------+------+----------+------------------------------|
    |git repack -a |-     |-         |re-empacota o repositório     |
    |-d; git prune |      |          |local num único pacote        |
    |--------------+------+----------+------------------------------|
    |gitk          |tkcvs |tkcvs     |ecrã GUI de árvore de         |
    |              |      |          |repositório VCS               |
    +---------------------------------------------------------------+


    Cuidado
   
    Invocar um sub-comando git directamente como "git-xyz" a partir
    da linha de comandos foi descontinuado desde o inicio de 2006.

    Dica

    Se existir um ficheiro executável git-foo no caminho especificado
    por $PATH, inserir "git foo" sem hífen na linha de comandos
    invoca este git-foo. Isto é uma característica do comando git.

    Dica

    Ferramentas GUI como o tkcvs(1) e gitk(1) ajudam-no realmente com
    o acompanhamento do histórico de revisão dos ficheiros. A
    interface web disponibiliza por muitos arquivos públicos para
    exploração dos seus repositórios é também muito útil.

    Dica

    O git pode trabalhar directamente com diferentes repositórios CVS
    como aqueles disponibilizados pelo CVS e Subversion e
    disponibiliza o repositório local para alterações locais com os
    pacotes git-cvs e git-svn. Veja git para utilizadores de CVS e
    Secção 10.6.4, “Git para o repositório Subversion”.

    Dica
   
    Git tem comandos que não têm equivalentes em CVS e Subversion:
    "fetch", "rebase", "cherry-pick", …

%

10.6. Git

    O Git pode fazer tudo para a gestão de código fonte tanto local
    como remoto. Isto significa que pode gravar as alterações no
    código fonte sem precisar de ligação de rede ao repositório
    remoto.

%

10.6.1. Configuração do cliente Git

    Pode desejar definir várias configurações globais em "~
    /.gitconfig" como o seu nome e endereço de mail usado pelo Git
    com o seguinte.

    $ git config --global user.name "Nome Apelido"
    $ git config --global user.email seu-nome@exemplo.com

    Se está muito acostumado aos comandos do CVS ou Subversion, pode
    desejar definir nomes alternativos a vários comandos com o
    seguinte.

    $ git config --global alias.ci "commit -a"
    $ git config --global alias.co checkout

    Pode verificar a sua configuração global com o seguinte.

    $ git config --global --list

%

10.6.2. Referências do Git

    Veja o seguinte.

      * manual: git(1) (/usr/share/doc/git-doc/git.html)

      * Manual do Utilizador do Git (/usr/share/doc/git-doc/
        user-manual.html)

      * Um tutorial de introdução ao git (/usr/share/doc/git-doc/
        gittutorial.html)

      * Um tutorial de introdução ao git: parte dois (/usr/share/doc/
        git-doc/gittutorial-2.html)

      * GIT do Dia-a-Dia com cerca de 20 comandos (/usr/share/doc/
        git-doc/everyday.html)

      * git para utilizadores do CVS (/usr/share/doc/git-doc/
        gitcvs-migration.html)

          + Isto também descreve como configurar um servidor tipo CVS
            e extrair dados antigos do CVS ao Git.

      * Outros recursos do git disponíveis na web

          + Git - Curso Relâmpago de SVN

          + Magia do Git (/usr/share/doc/gitmagic/html/index.html)

    Os comandos git-gui(1) e gitk(1) tornam a utilização do Git muito
    fácil.

    Atenção

    Não use a string de etiqueta (tag) com espaços nela, mesmo que
    algumas ferramentas como o gitk(1) o permitam. Pode estrangular
    outros comandos do git.

%

10.6.3. Comandos do Git

    Mesmo que o seu repositório de origem use um VCS diferente, pode
    ser uma boa ideia usar o git(1) para atividade local porque pode
    gerir a sua cópia local da árvore fonte sem a ligação de rede ao
    repositório de origem. Aqui estão alguns pacotes e comandos
    usados com o git(1).

    Tabela 10.13. Lista de pacotes e comandos relacionados com o git

    +------------------------------------------------------------------+
    |     pacote     |popcon|tamanho|      comando      |  descrição   |
    |----------------+------+-------+-------------------+--------------|
    |                |      |       |                   |documentação  |
    |git-doc         |I:15  |11762  |N/D                |oficial para o|
    |                |      |       |                   |Git           |
    |----------------+------+-------+-------------------+--------------|
    |                |      |       |                   |"Magia do     |
    |                |      |       |                   |Git", guia    |
    |gitmagic        |I:1   |721    |N/D                |fácil de      |
    |                |      |       |                   |compreender   |
    |                |      |       |                   |para o Git    |
    |----------------+------+-------+-------------------+--------------|
    |                |      |       |                   |Git, o sistema|
    |                |      |       |                   |de controlo de|
    |git             |V:305,|35040  |git(7)             |revisão       |
    |                |I:478 |       |                   |distribuído,  |
    |                |      |       |                   |rápido e      |
    |                |      |       |                   |escalável     |
    |----------------+------+-------+-------------------+--------------|
    |                |      |       |                   |explorador GUI|
    |                |V:6,  |       |                   |de            |
    |gitk            |I:42  |1723   |gitk(1)            |repositórios  |
    |                |      |       |                   |Git com       |
    |                |      |       |                   |histórico     |
    |----------------+------+-------+-------------------+--------------|
    |                |V:2,  |       |                   |GUI para Git  |
    |git-gui         |I:24  |2317   |git-gui(1)         |(Nenhum       |
    |                |      |       |                   |histórico)    |
    |----------------+------+-------+-------------------+--------------|
    |                |      |       |                   |importa os    |
    |git-svn         |V:1,  |1144   |git-svnimport(1)   |dados de      |
    |                |I:22  |       |                   |Subversion    |
    |                |      |       |                   |para Git      |
    |----------------+------+-------+-------------------+--------------|
    |                |      |       |                   |disponibiliza |
    |                |      |       |                   |operação      |
    |git-svn         |V:1,  |1144   |git-svn(1)         |bi-direccional|
    |                |I:22  |       |                   |entre         |
    |                |      |       |                   |Subversion e  |
    |                |      |       |                   |Git           |
    |----------------+------+-------+-------------------+--------------|
    |                |V:0,  |       |                   |importa os    |
    |git-cvs         |I:10  |1279   |git-cvsimport(1)   |dados de CVS  |
    |                |      |       |                   |para Git      |
    |----------------+------+-------+-------------------+--------------|
    |                |      |       |                   |exporta uma   |
    |                |V:0,  |       |git-cvsexportcommit|submissão para|
    |git-cvs         |I:10  |1279   |(1)                |um checkout do|
    |                |      |       |                   |CVS a partir  |
    |                |      |       |                   |do Git        |
    |----------------+------+-------+-------------------+--------------|
    |                |V:0,  |       |                   |emulador de   |
    |git-cvs         |I:10  |1279   |git-cvsserver(1)   |servidor CVS  |
    |                |      |       |                   |para o Git    |
    |----------------+------+-------+-------------------+--------------|
    |                |      |       |                   |envia uma     |
    |                |V:0,  |       |                   |colecção de   |
    |git-email       |I:11  |966    |git-send-email(1)  |patches como  |
    |                |      |       |                   |email a partir|
    |                |      |       |                   |do Git        |
    |----------------+------+-------+-------------------+--------------|
    |                |V:0,  |       |                   |quilt no topo |
    |stgit           |I:0   |603    |stg(1)             |do git        |
    |                |      |       |                   |(Python)      |
    |----------------+------+-------+-------------------+--------------|
    |                |      |       |                   |automatiza o  |
    |git-buildpackage|V:2,  |4193   |git-buildpackage(1)|empacotamento |
    |                |I:12  |       |                   |Debian com o  |
    |                |      |       |                   |Git           |
    |----------------+------+-------+-------------------+--------------|
    |                |V:0,  |       |                   |quilt no topo |
    |guilt           |I:0   |146    |guilt(7)           |do git (SH/AWK|
    |                |      |       |                   |/SED/…)       |
    +------------------------------------------------------------------+


    Dica

    Com o git(1), trabalha num branch local com muitas submissões e
    usa algo como "git rebase -i master" para reorganizar o histórico
    de alterações mais tarde. Isto permite-lhe fazer um histórico de
    alterações limpo. Veja git-rebase(1) e git-cherry-pick(1).

    Dica

    Quando deseja recuar para um diretório de trabalho limpo sem
    perder o estado atual do diretório de trabalho, pode usar o "git
    stash". Veja git-stash(1).

%

10.6.4. Git para o repositório Subversion

    Pode fazer check out a um repositório Subversion em "svn+ssh://
    svn.example.org/project/module/trunk" para um repositório Git
    local em "./dest" e submeter de volta ao repositório Subversion.
    Ex.:

    $ git svn clone -s -rHEAD svn+ssh://svn.example.org/project dest
    $ cd dest
    ... faz as alterações
    $ git commit -a
    ... continua a trabalhar localmente com o git
    $ git svn dcommit

    Dica
   
    O uso de "-rHEAD" permite-nos evitar clonar os conteúdos
    históricos inteiros do repositório Subversion.

%

10.6.5. Git para gravar o histórico de configuração

    Pode gravar manualmente o histórico cronológico da configuração a
    usar ferramentas do Git. Aqui está um exemplo simples para
    praticar a gravar os conteúdos de "/etc/apt/".

    $ cd /etc/apt/
    $ sudo git init
    $ sudo chmod 700 .git
    $ sudo git add .
    $ sudo git commit -a

    Cometer configuração com descrição.

    Fazer modificações nos ficheiros de configuração.

    $ cd /etc/apt/
    $ sudo git commit -a

    Cometer a configuração com descrição e continuar com a sua vida.

    $ cd /etc/apt/
    $ sudo gitk --all

    Tem o histórico de configuração completo consigo.

    Nota

    O sudo(8) é necessário para trabalhar com quaisquer permissões de
    ficheiros de dados de configuração. Para os dados de configuração
    do utilizador, pode descartar o sudo.

    Nota

    O comando "chmod 700 .git" no exemplo em cima é necessário para
    proteger os dados do arquivo contra acesso de leitura não
    autorizado.

    Dica

    Para uma solução mais completa para gravação do histórico de
    configuração, por favor procure o pacote etckeeper:
    Secção 9.2.10, “Gravar alterações em ficheiros de configuração”.

%

10.7. CVS

    O CVS é um sistema de controle de versão antigo anterior a
    Subversion e Git.

    Cuidado
   
    Muitos URLs encontrados nos exemplos em baixo para CVS já não
    existem mais.

    Veja o seguinte.

      * cvs(1)

      * "/usr/share/doc/cvs/html-cvsclient"

      * "/usr/share/doc/cvs/html-info"

      * "/usr/share/doc/cvsbook"

      * "info cvs"

%

10.7.1. Configuração de repositório CVS

    A seguinte configuração permite submissões para o repositório CVS
    apenas por um membro do grupo "src" e administração do CVS apenas
    por um membro do grupo "staff", assim a reduzir as hipóteses de
    dar um tiro em si próprio.

    # cd /var/lib; umask 002; mkdir cvs
    # export CVSROOT=/srv/cvs/project
    # cd $CVSROOT
    # chown root:src .
    # chmod 2775 .
    # cvs -d $CVSROOT init
    # cd CVSROOT
    # chown -R root:staff .
    # chmod 2775 .
    # touch val-tags
    # chmod 664 history val-tags
    # chown root:src history val-tags

    Dica

    Pode restringir a criação de novo projecto ao alterar o dono do
    diretório "$CVSROOT" para "root:staff" e as suas permissões para
    "3775".

%

10.7.2. Acesso local ao CVS

    O repositório CVS predefinido é apontado por "$CVSROOT". O
    seguinte define "$CVSROOT" para o acesso local.

    $ export CVSROOT=/srv/cvs/project

%

10.7.3. Acesso remoto ao CVS com pserver

    Muitos servidores CVS públicos disponibilizam-lhe acesso remoto
    apenas de leitura com o nome de conta "anonymous" pelo serviço
    pserver. Por exemplo, os conteúdos do site web de Debian eram
    mantidos pelo projecto webwml via CVS no serviço alioth de
    Debian. O seguinte configurava "$CVSROOT" para o acesso remoto a
    este antigo repositório CVS.

    $ export CVSROOT=:pserver:anonymous@anonscm.debian.org:/cvs/webwml
    $ cvs login

    Nota

    Como o pserver é inclinado a ataques de escutas e inseguro, o
    acesso de escrita geralmente é desactivado pelos administradores
    do servidor.

%

10.7.4. Acesso remoto ao CVS com ssh

    O seguinte configurava "$CVS_RSH" e "$CVSROOT" para o acesso
    remoto ao antigo repositório CVS pelo projecto webwml com SSH.

    $ export CVS_RSH=ssh
    $ export CVSROOT=:ext:account@cvs.alioth.debian.org:/cvs/webwml

    Também pode usar autenticação de chave pública para SSH o que
    elimina o pedido remoto de palavra-passe.

%

10.7.5. Importar uma nova fonte ao CVS

    Crie uma nova localização de árvore fonte local em "~/caminho/
    para/module1" com o seguinte.

    $ mkdir -p ~/caminho/para/module1; cd ~/caminho/para/module1

    Povoa uma nova árvore fonte local sob "~/caminho/para/module1"
    como ficheiros.

    Importe-o ao CVS com os seguintes parâmetros.

      * Module name: "module1"

      * Vendor tag: "Main-branch" (etiqueta para o branch completo)

      * Release tag: "Release-initial" (etiqueta para um lançamento
        específico)

    $ cd ~/caminho/para/module1
    $ cvs import -m "Start module1" module1 Main-branch Release-initial
    $ rm -Rf . # opcional

%

10.7.6. Permissões de ficheiros no repositório CVS

    O CVS não sobrescreve o ficheiro do repositório atual mas
    substitui-o por outros. Assim, a permissão de escrita no
    diretório do repositório é crítica. Para cada novo módulo para
    "module1" no repositório em "/srv/cvs/project", corra o seguinte
    para assegurar esta condição se necessário.

    # cd /srv/cvs/project
    # chown -R root:src module1
    # chmod -R ug+rwX   module1
    # chmod    2775     module1

%

10.7.7. Fluxo de trabalho do CVS

    Aqui está um exemplo de um fluxo de trabalho típico a usar CVS.

    Verifique todos os módulos disponíveis do projecto CVS apontados
    por "$CVSROOT" com o seguinte.

    $ cvs rls
    CVSROOT
    module1
    module2
    ...

    Faça o checkout a "module1" ao seu diretório predefinido "./
    module1" com o seguinte.

    $ cd ~/caminho/para
    $ cvs co module1
    $ cd module1

    Faça as alterações necessárias ao conteúdo.

    Verifique alterações ao fazer "diff -u [repositório] [local]"
    equivalente ao seguinte.

    $ cvs diff -u

    Descobre que danificou o ficheiro "ficheiro-a-desfazer"
    severamente mas os outros ficheiros estão bem.

    Sobrescreva o ficheiro "ficheiro-a-desfazer" com uma cópia limpa
    do CVS com o seguinte.

    $ cvs up -C ficheiro-a-desfazer

    Grava a árvore de fonte local atualizada no CVS com o seguinte.

    $ cvs ci -m "Descreve alteração"

    Crie e adicione o ficheiro "ficheiro-a-adicionar" ao CVS com o
    seguinte.

    $ vi ficheiro-a-adicionar
    $ cvs add ficheiro-a-adicionar
    $ cvs ci -m "ficheiro-a-adicionar adicionado"

    Funda a versão mais recente do CVS com o seguinte.

    $ cvs up -d

    Procure por linhas que comecem com "C filename" as quais indicam
    alterações em conflito.

    Procura código não modificado em ".#nome-ficheiro.versão".

    Procura por "<<<<<<<" e ">>>>>>>" em ficheiros por alterações em
    conflito.

    Edite os ficheiros para corrigir os conflitos como necessário.

    Adicione uma etiqueta de lançamento "Release-1" com o seguinte.

    $ cvs ci -m "última submissão para Release-1"
    $ cvs tag Release-1

    Continuar a editar.

    Remova a etiqueta de lançamento "Release-1" com o seguinte.

    $ cvs tag -d Release-1

    Verifique as alterações no CVS com o seguinte.

    $ cvs ci -m "última submissão real para Release-1"

    Re-adicione a etiqueta de lançamento "Release-1" ao CABEÇALHO CVS
    atualizado de main com o seguinte.

    $ cvs tag Release-1

    Crie um branch com uma etiqueta autocolante de branch
    "Release-initial-bugfixes" a partir da versão original apontada
    pela etiqueta "Release-initial" e faça o check out ao diretório
    "~/path/to/old" com o seguinte.

    $ cvs rtag -b -r Release-initial Release-initial-bugfixes module1
    $ cd ~/path/to
    $ cvs co -r Release-initial-bugfixes -d old module1
    $ cd old

    Dica

    Use "-D 2005-12-20" (formato de data ISO 8601) em vez de "-r
    Release-initial" para especificar uma data particular como o
    ponto do branch.

    Trabalhe nesta árvore de fonte local a ter a etiqueta autocolante
    "Release-initial-bugfixes" a qual é baseada na versão original.

    Trabalhe neste branch por si … até que alguém se junte a este
    branch "Release-initial-bugfixes".

    Sincronize com ficheiros modificados por outros neste branch
    enquanto cria novos diretórios se necessário com o seguinte.

    $ cvs up -d

    Edite os ficheiros para corrigir os conflitos como necessário.

    Verifique as alterações no CVS com o seguinte.

    $ cvs ci -m "check feito para este branch"

    atualize a árvore local pelo CABEÇALHO do main enquanto remove a
    etiqueta autocolante ("-A") e sem a extensão de palavra chave
    ("-kk") com o seguinte.

    $ cvs up -d -kk -A

    atualize a árvore local (conteúdo = CABEÇALHO de main) ao fundir
    do branch "Release-initial-bugfixes" e sem a expansão palavra
    chave com o seguinte.

    $ cvs up -d -kk -j Release-initial-bugfixes

    Corrigir conflitos com o editor.

    Verifique as alterações no CVS com o seguinte.

    $ cvs ci -m "Juntei Release-initial-bugfixes"

    Criar arquivo com o seguinte.

    $ cd ..
    $ mv old old-module1-bugfixes
    $ tar -cvzf old-module1-bugfixes.tar.gz old-module1-bugfixes
    $ rm -rf old-module1-bugfixes

    Dica
   
    O comando "cvs up" pode receber a opção "-d" para criar novos
    diretórios e a opção "-P" para suprimir os diretórios vazios.

    Dica
   
    Pode fazer checkout apenas a um sub diretório de "module1" ao
    fornecer o nome dele como "cvs co module1/subdir".

    Tabela 10.14. Opções notáveis para comandos CVS (use como
    primeiro argumento(s) para o cvs(1))

    +---------------------------------------------------------------+
    |opção|                       significado                       |
    |-----+---------------------------------------------------------|
    |-n   |simulação, nenhum efeito                                 |
    |-----+---------------------------------------------------------|
    |-t   |mostra mensagens que mostram os passos da atividade do   |
    |     |cvs                                                      |
    +---------------------------------------------------------------+


%

10.7.8. Ficheiros mais recentes do CVS

    Para obter os ficheiros mais recentes do CVS, use "tomorrow" com
    o seguinte.

    $ cvs ex -D tomorrow nome-do-módulo

%

10.7.9. Administração do CVS

    Adicione o alias de módulo "mx" a um projecto de CVS (servidor
    local) com o seguinte.

    $ export CVSROOT=/srv/cvs/project
    $ cvs co CVSROOT/modules
    $ cd CVSROOT
    $ echo "mx -a module1" >>modules
    $ cvs ci -m "Agora mx é um alias para module1"
    $ cvs release -d .

    Agora pode fazer check out ao "module1" (alias: "mx") do CVS ao
    diretório "new" com o seguinte.

    $ cvs co -d new mx
    $ cd new

    Nota
   
    De modo a executar o procedimento em cima, precisa ter as
    permissões de ficheiro apropriadas.

%

10.7.10. Bit de execução para verificação do CVS

    Quando faz checkout a ficheiros de CVS, o bit de permissão de
    execução deles é retido.

    Sempre que veja problemas com a permissão de execução num
    ficheiro a que fez check out, ex. "nome-de-ficheiro", mude as
    suas permissões no repositório CVS correspondente com o seguinte
    para a corrigir.

    # chmod ugo-x nome-de-ficheiro

%

10.8. Subversion

    Subversion é um sistema de controle de versão antigo anterior ao
    Git mas posterior ao CVS. Falta-lhe as funcionalidades de
    marcação e ramificação encontradas no CVS e no Git.

    Precisa instalar os pacotes subversion, libapache2-mod-svn e
    subversion-tools para configurar um servidor Subversion.

%

10.8.1. Configuração do repositório Subversion

    atualmente, o pacote subversion não configura um repositório,
    então é preciso configurar um manualmente. Uma possível
    localização para um repositório é em "/srv/svn/project".

    Crie um diretório com o seguinte.

    # mkdir -p        /srv/svn/project

    Crie a base de dados do repositório com o seguinte.

    # svnadmin create /srv/svn/project

%

10.8.2. Acesso ao Subversion via servidor Apache2

    Se apenas aceder ao repositório Subversion via servidor Apache2,
    apenas precisa de ativar a escrita no repositório pelo servidor
    WWW com o seguinte.

    # chown -R www-data:www-data /srv/svn/project

    Adicione (ou descomente) o seguinte em "/etc/apache2/
    mods-available/dav_svn.conf" para permitir o acesso ao
    repositório via autenticação do utilizador.

    <Location /project>
      DAV svn
      SVNPath /srv/svn/project
      AuthType Basic
      AuthName "Subversion repository"
      AuthUserFile /etc/subversion/passwd
    <LimitExcept GET PROPFIND OPTIONS REPORT>
        Require valid-user
    </LimitExcept>
    </Location>

    Crie um ficheiro de autenticação de utilizador com o comando com
    o seguinte.

    # htpasswd2 -c /etc/subversion/passwd algum_nome_de_utilizador

    Reiniciar o Apache2.

    O seu novo repositório Subversion está acessível no URL "http://
    localhost/project" e "http://exemplo.com/project" a partir de svn
    (1) (a assumir que o URL do servidor web é "http://exemplo.com/
    ").

%

10.8.3. Acesso local ao Subversion pelo grupo

    O seguinte configura um repositório Subversion para acesso local
    pelo grupo, ex. project.

    # chmod  2775     /srv/svn/project
    # chown -R root:src /srv/svn/project
    # chmod -R ug+rwX   /srv/svn/project

    O seu novo repositório Subversion está acessível ao grupo no URL
    "file:///localhost/srv/svn/project" ou "file:///srv/svn/project"
    a partir de svn(1) para os utilizadores locais que pertençam ao
    grupo project. Tem de correr comandos, como o svn, svnserve,
    svnlook e svnadmin sob "umask 002" para assegurar o acesso do
    grupo.

%

10.8.4. Acesso remoto ao Subversion via SSH

    Um repositório Subversion acessível por grupo está no URL
    "example.com:/srv/svn/project" para SSH, pode aceder-lhe a partir
    de svn(1) no URL "svn+ssh://example.com:/srv/svn/project".

%

10.8.5. Estrutura de diretórios do Subversion

    Muitos projectos usam árvores de diretórios semelhantes à
    seguinte para o Subversion para compensar a falta de branches e
    tags.

      ----- module1
        |   |-- branches
        |   |-- tags
        |   |   |-- release-1.0
        |   |   `-- release-2.0
        |   |
        |   `-- trunk
        |       |-- file1
        |       |-- file2
        |       `-- file3
        |
        `-- module2

    Dica

    Tem de usar o comando "svn copy …" para marcar os branches e as
    etiquetas. Isto assegura que o Subversion grave um histórico de
    modificações dos ficheiros de modo apropriado e poupe espaço de
    armazenamento.

%

10.8.6. importar uma nova fonte ao Subversion

    Crie uma nova localização de árvore fonte local em "~/caminho/
    para/module1" com o seguinte.

    $ mkdir -p ~/caminho/para/module1; cd ~/caminho/para/module1

    Povoa uma nova árvore fonte local sob "~/caminho/para/module1"
    como ficheiros.

    Importe-o para Subversion com os seguintes parâmetros.

      * Module name: "module1"

      * Subversion site URL: "file:///srv/svn/project"
   
      * Subversion diretory: "module1/trunk"

      * Subversion tag: "module1/tags/Release-initial"

    $ cd ~/path/to/module1
    $ svn import file:///srv/svn/project/module1/trunk -m "Start module1"
    $ svn cp file:///srv/svn/project/module1/trunk file:///srv/svn/project/module1/tags/Release-initial

    Alternativamente, pelo seguinte.

    $ svn import ~/path/to/module1 file:///srv/svn/project/module1/trunk -m "Start module1"
    $ svn cp file:///srv/svn/project/module1/trunk file:///srv/svn/project/module1/tags/Release-initial

    Dica
   
    Pode substituir URLs como o "file:///…" por qualquer outro
    formato de URL como o "http://…" e "svn+ssh://…".

%

10.8.7. Fluxo de trabalho do Subversion

    Aqui está um exemplo do fluxo de trabalho típico a usar o
    Subversion com o cliente dele nativo.

    Dica

    Os comandos de cliente oferecidos pelo pacote git-svn podem
    oferecer um fluxo de trabalho alternativo do Subversion a usar o
    comando git. Veja Secção 10.6.4, “Git para o repositório
    Subversion”.

    Verifique todos os módulos disponíveis do projecto do Subversion
    apontado pelo URL "file:///srv/svn/project" com o seguinte.

    $ svn list file:///srv/svn/project
    module1
    module2
    ...

    Faz checkout a "module1/trunk" para um diretório "module1" com o
    seguinte.

    $ cd ~/caminho/para
    $ svn co file:///srv/svn/project/module1/trunk module1
    $ cd module1

    Faça as alterações necessárias ao conteúdo.

    Verifique alterações ao fazer "diff -u [repositório] [local]"
    equivalente ao seguinte.

    $ svn diff

    Descobre que danificou o ficheiro "ficheiro-a-desfazer"
    severamente mas os outros ficheiros estão bem.

    Sobrescreve "ficheiro_a_desfazer" com a cópia limpa do Subversion
    com o seguinte.

    $ svn revert ficheiro_a_desfazer

    Grave a árvore de fonte local atualizada para o Subversion com o
    seguinte.

    $ svn ci -m "Descreve alteração"

    Crie e adicione o ficheiro "ficheiro_a_adicionar" ao Subversion
    com o seguinte.

    $ vi ficheiro_a_adicionar
    $ svn add ficheiro_a_adicionar
    $ svn ci -m "Adicionado ficheiro_a_adicionar"

    Junta a versão mais recente do Subversion com o seguinte.

    $ svn up

    Procure por linhas que comecem com "C filename" as quais indicam
    alterações em conflito.

    Procura por código não modificado em, ex., "filename.r6",
    "filename.r9" e "filename.mine".

    Procura por "<<<<<<<" e ">>>>>>>" em ficheiros por alterações em
    conflito.

    Edite os ficheiros para corrigir os conflitos como necessário.

    Adicione uma etiqueta de lançamento "Release-1" com o seguinte.

    $ svn ci -m "última submissão para Release-1"
    $ svn cp file:///srv/svn/project/module1/trunk file:///srv/svn/project/module1/tags/Release-1

    Continuar a editar.

    Remova a etiqueta de lançamento "Release-1" com o seguinte.

    $ svn rm file:///srv/svn/project/module1/tags/Release-1

    Verifique as alterações ao Subversion com o seguinte.

    $ svn ci -m "última submissão real para Release-1"

    Re-adicione a etiqueta de lançamento "Release-1" a partir de do
    CABEÇALHO do trunk Subversion atualizado com o seguinte.

    $ svn cp file:///srv/svn/project/module1/trunk file:///srv/svn/project/module1/tags/Release-1

    Crie um branch com o caminho "module1/branches/
    Release-initial-bugfixes" a partir da versão original apontada
    pelo caminho "module1/tags/Release-initial" e faça-lhe um check
    out ao diretório "~/path/to/old" com o seguinte.

    $ svn cp file:///srv/svn/project/module1/tags/Release-initial file:///srv/svn/project/module1/branches/Release-initial-bugfixes
    $ cd ~/path/to
    $ svn co file:///srv/svn/project/module1/branches/Release-initial-bugfixes old
    $ cd old

    Dica

    Use "module1/trunk@{2005-12-20}" (formato de data ISO 8601) em
    vez de "module1/tags/Release-initial" para especificar uma data
    particular como o ponto do branch.

    Trabalhe nesta árvore de fonte local que aponta ao branch
    "Release-initial-bugfixes" o qual é baseado na versão original.

    Trabalhe neste branch por si … até que alguém se junte a este
    branch "Release-initial-bugfixes".

    Sincronize com ficheiros modificados por outros neste branch com
    o seguinte.

    $ svn up

    Edite os ficheiros para corrigir os conflitos como necessário.

    Verifique as alterações ao Subversion com o seguinte.

    $ svn ci -m "check feito para este branch"

    atualize a árvore local com o CABEÇALHO do trunk com o seguinte.

    $ svn switch file:///srv/svn/project/module1/trunk

    Atualize a árvore local (conteúdo = CABEÇALHO do trunk) ao fundir
    a partir do branch "Release-initial-bugfixes" com o seguinte.

    $ svn merge file:///srv/svn/project/module1/branches/Release-initial-bugfixes

    Corrigir conflitos com o editor.

    Verifique as alterações ao Subversion com o seguinte.

    $ svn ci -m "merged Release-initial-bugfixes"

    Criar arquivo com o seguinte.

    $ cd ..
    $ mv old old-module1-bugfixes
    $ tar -cvzf old-module1-bugfixes.tar.gz old-module1-bugfixes
    $ rm -rf old-module1-bugfixes

    Dica
   
    Pode substituir URLs como o "file:///…" por qualquer outro
    formato de URL como o "http://…" e "svn+ssh://…".

    Dica

    Pode fazer checkout apenas a um subdiretório do "module1" ao
    fornecer o nome dele como "svn co file:///srv/svn/project/module1
    /trunk/subdir module1/subdir", etc.

    Tabela 10.15. Opções notáveis para os comandos do Subversion (use
    como primeiro argumento) para o svn(1))

    +---------------------------------------------------------+
    |  opção  |                  significado                  |
    |---------+-----------------------------------------------|
    |--dry-run|simulação, nenhum efeito                       |
    |---------+-----------------------------------------------|
    |-v       |mostra mensagens detalhadas da atividade do svn|
    +---------------------------------------------------------+


Capítulo 11. Conversão de dados

    São descritas ferramentas e dicas para converter formatos de
    dados no sistema Debian.

    As ferramentas baseadas em standards são muitos boas mas o
    suporte para formatos proprietários de dados é limitado.

%

11.1. Ferramentas de conversão de dados em texto

    Os seguintes pacotes para a conversão de dados de texto
    saltaram-me à vista.

    Tabela 11.1. Lista de ferramentas de conversão de dados em texto

    +---------------------------------------------------------------+
    | pacote |popcon|tamanho|  palavra  |         descrição         |
    |        |      |       |   chave   |                           |
    |--------+------+-------+-----------+---------------------------|
    |        |V:935,|       |conjunto e |converter codificação de   |
    |libc6   |I:999 |12771  |caracteres |texto entre locales por    |
    |        |      |       |(charset)  |iconv(1) (fundamental)     |
    |--------+------+-------+-----------+---------------------------|
    |        |      |       |           |conversor de codificação de|
    |        |V:3,  |       |           |texto entre locales        |
    |recode  |I:25  |603    |charset+eol|(versátil, com mais nomes  |
    |        |      |       |           |alternativos (alias) e     |
    |        |      |       |           |funcionalidades)           |
    |--------+------+-------+-----------+---------------------------|
    |        |V:1,  |       |conjunto e |conversor de codificação de|
    |konwert |I:54  |134    |caracteres |texto entre locales        |
    |        |      |       |(charset)  |(imaginativo)              |
    |--------+------+-------+-----------+---------------------------|
    |        |V:0,  |       |conjunto e |tradutor de conjunto de    |
    |nkf     |I:11  |358    |caracteres |caracteres para Japonês    |
    |        |      |       |(charset)  |                           |
    |--------+------+-------+-----------+---------------------------|
    |        |V:0,  |       |conjunto e |tradutor de conjunto de    |
    |tcs     |I:0   |518    |caracteres |caracteres                 |
    |        |      |       |(charset)  |                           |
    |--------+------+-------+-----------+---------------------------|
    |        |V:0,  |       |conjunto e |substitui letras acentuadas|
    |unaccent|I:0   |29     |caracteres |pelo seu equivalente não   |
    |        |      |       |(charset)  |acentuado                  |
    |--------+------+-------+-----------+---------------------------|
    |        |V:1,  |       |           |conversor de formato de    |
    |tofrodos|I:25  |55     |eol        |texto entre DOS e Unix: de |
    |        |      |       |           |dos(1) e para dos(1)       |
    |--------+------+-------+-----------+---------------------------|
    |        |      |       |           |conversor de formato de    |
    |macutils|V:0,  |298    |eol        |texto entre Macintosh e    |
    |        |I:1   |       |           |Unix: de mac(1) e para mac |
    |        |      |       |           |(1)                        |
    +---------------------------------------------------------------+


%

11.1.1. Converter um ficheiro de texto com o iconv

    Dica

    iconv(1) é disponibilizado como parte do pacote libc6 e está
    sempre disponível em praticamente todos os sistemas tipo Unix
    para converter a codificação de caracteres.

    Pode converter a codificação de um ficheiro de texto com o iconv
    (1) com o seguinte.

    $ iconv -f codificação1 -t codificação2 entrada.txt >saída.txt

    Os valores de codificação são sensíveis a maiúsculas/minúsculas e
    ignoram "-" e "_" para correspondência. As codificações
    suportadas podem ser verificadas pelo comando "iconv -l".

    Tabela 11.2. Lista de valores de codificação e a utilização deles

    +---------------------------------------------------------------+
    | valor de  |                    utilização                     |
    |codificação|                                                   |
    |-----------+---------------------------------------------------|
    |ASCII      |American Standard Code for Information Interchange,|
    |           |código de 7 bits sem caracteres acentuados         |
    |-----------+---------------------------------------------------|
    |UTF-8      |standard multilingue atual para todos os sistemas  |
    |           |operativos modernos                                |
    |-----------+---------------------------------------------------|
    |ISO-8859-1 |antigo standard para linguagens da Europa          |
    |           |ocidental, ASCII + caracteres acentuados           |
    |-----------+---------------------------------------------------|
    |ISO-8859-2 |antigo standard para linguagens da Europa oriental,|
    |           |ASCII + caracteres acentuados                      |
    |-----------+---------------------------------------------------|
    |ISO-8859-15|antigo standard para linguagens da Europa          |
    |           |ocidental, o ISO-8859-1 com o símbolo do euro      |
    |-----------+---------------------------------------------------|
    |           |página de código 850, caracteres DOS da Microsoft  |
    |CP850      |com gráficos para linguagens da Europa ocidental,  |
    |           |variante ISO-8859-1                                |
    |-----------+---------------------------------------------------|
    |CP932      |página de código 932, variante Shift-JIS do estilo |
    |           |Microsoft Windows para Japonês                     |
    |-----------+---------------------------------------------------|
    |           |página de código 936, variantes GB2312, GBK ou     |
    |CP936      |GB18030 do estilo Microsoft Windows para Chinês    |
    |           |Simplificado                                       |
    |-----------+---------------------------------------------------|
    |           |página de código 949, variante EUC-KR ou or Unified|
    |CP949      |Hangul Code de estilo Microsoft Windows para       |
    |           |Coreano                                            |
    |-----------+---------------------------------------------------|
    |CP950      |página de código 950, variante Big5 de estilo      |
    |           |Microsoft Windows para Chinês Tradicional          |
    |-----------+---------------------------------------------------|
    |CP1251     |página de código 1251, codificação estilo Microsoft|
    |           |Windows para o alfabeto Cirílico                   |
    |-----------+---------------------------------------------------|
    |           |página de código 1252, variante ISO-8859-15 de     |
    |CP1252     |estilo Microsoft Windows para linguagens de Europeu|
    |           |ocidental                                          |
    |-----------+---------------------------------------------------|
    |KOI8-R     |antigo standard Russo de UNIX para o alfabeto      |
    |           |Cirílico                                           |
    |-----------+---------------------------------------------------|
    |ISO-2022-JP|codificação standard para email Japonês que usar   |
    |           |apenas códigos de 7 bits                           |
    |-----------+---------------------------------------------------|
    |eucJP      |antigo standard Unix de Japonês de código de 8 bits|
    |           |e completamente diferente do Shift-JIS             |
    |-----------+---------------------------------------------------|
    |Shift-JIS  |JIS X 0208 Appendix 1 standard para Japonês (veja  |
    |           |CP932)                                             |
    +---------------------------------------------------------------+


    Nota

    Algumas codificações são apenas suportadas para conversão de
    dados e não são usados como valores do locale (Secção 8.4.1,
    “Bases de codificação”).

    Para os conjuntos de caracteres que cabem num byte único como os
    conjuntos de caracteres ASCII e ISO-8859, a codificação de
    caracteres significa quase o mesmo que o conjunto de caracteres.

    Para conjuntos de caracteres com muitos caracteres como o JIS X
    0213 para Japonês ou Universal Character Set (UCS, Unicode,
    ISO-10646-1) para praticamente todas as linguagens, existem
    muitos esquemas de codificação para os pôr na sequência dos dados
    do byte.

      * EUC e ISO/IEC 2022 (também conhecido como JIS X 0202) para
        Japonês

      * UTF-8, UTF-16/UCS-2 e UTF-32/UCS-4 para Unicode

    Para estes, existem diferenciações claras entre o conjunto de
    caracteres e a codificação de caracteres.

    A página de código é usada como o sinónimo para as tabelas de
    codificação de caracteres para alguns específicos de marcas.

    Nota

    Por favor note que a maioria dos sistemas de codificação
    partilham o mesmo código com o ASCII para caracteres de 7 bits.
    Mas há algumas exceções. Se está a converter programas C antigos
    Japoneses e dados de URLs a partir do casualmente chamado formato
    de codificação shift-JIS no formato UTF-8, use "CP932" como o
    nome de codificação em vez de "shift-JIS" para obter os
    resultados esperados: 0x5C → "\" e 0x7E → "~". Caso contrário,
    estes são convertidos para caracteres errados.

    Dica

    O recode(1) também pode ser usado e oferece mais do que as
    funcionalidades combinadas do iconv(1), fromdos(1), todos(1), 
    frommac(1) e tomac(1). Para mais, veja "info recode".

%

11.1.2. Verifica ficheiro se é UTF-8 com o iconv

    Pode verificar se um ficheiro de texto está codificado em UTF-8
    com o iconv(1) com o seguinte.

    $ iconv -f utf8 -t utf8 input.txt >/dev/null || echo "non-UTF-8 found"

    Dica
   
    Use a opção "--verbose" no exemplo em cima para encontrar o
    primeiro caractere não-UTF-8.

%

11.1.3. Converter os nomes dos ficheiros com o iconv

    Aqui está um script de exemplo para converter a codificação dos
    nomes de ficheiros daqueles criados sob sistemas operativos
    antigos para os modernos de UTF-8 num único diretório.

    #!/bin/sh
    ENCDN=iso-8859-1
    for x in *;
     do
     mv "$x" "$(echo "$x" | iconv -f $ENCDN -t utf-8)"
    done

    A variável "$ENCDN" especifica a codificação original usada para
    nomes de ficheiros sob SOs mais antigos em Tabela 11.2, “Lista de
    valores de codificação e a utilização deles”.

    Para um caso mais complicado, por favor monte um sistema de
    ficheiros (ex. uma partição de uma unidade de disco) que contenha
    tais nomes de ficheiros com a codificação apropriada como opção
    do mount(8) (veja Secção 8.4.6, “Codificação de nomes de
    ficheiros”) e copie o conteúdo dele inteiro para outro sistema de
    ficheiros montado como UTF-8 com o comando "cp -a".

%

11.1.4. conversão EOL

    O formato de ficheiro de texto, especificamente o código de fim
    de linha (EOL), é dependente da plataforma.

    Tabela 11.3. Lista de estilos EOL para diferentes plataformas

    +----------------------------------------------------------+
    |    plataforma    |código EOL|controle|decimal|hexadecimal|
    |------------------+----------+--------+-------+-----------|
    |Debian (unix)     |LF        |^J      |10     |0A         |
    |------------------+----------+--------+-------+-----------|
    |MSDOS e Windows   |CR-LF     |^M^J    |13 10  |0D 0A      |
    |------------------+----------+--------+-------+-----------|
    |Macintosh da Apple|CR        |^M      |13     |0D         |
    +----------------------------------------------------------+


    Os programas de conversão de formato EOL, fromdos(1), todos(1), 
    frommac(1), e tomac(1), são muito úteis. O recode(1) também é
    útil.

    Nota

    Alguns dados no sistema Debian, como os dados da página wiki para
    o pacote python-moinmoin, usam o estilo MSDOS (CR-LF) como o
    código de EOL. Então a regra em cima é apenas uma regra geral.

    Nota
   
    A maioria dos editores (ex. vim, emacs, gedit, …) podem lidar com
    ficheiros em estilo EOL de MSDOS transparentemente.

    Dica

    O uso de "sed -e '/\r$/!s/$/\r/'" em vez de todos(1) é melhor
    quando pretende unificar o estilo de EOL para o estilo do MSDOS a
    partir da mistura de estilos de MSDOS e Unix. (ex. após fundir 2
    ficheiros de estilo MSDOS com o diff3(1).) Isto porque o todos
    adiciona CR a todas as linhas.

%

11.1.5. Conversão de TAB

    Existem alguns programas populares especializados para converter
    os códigos de tab.

    Tabela 11.4. Lista de comandos de conversão de TAB dos pacotes
    bsdmainutils e coreutils

    +------------------------------------------------------+
    |            função             |bsdmainutils|coreutils|
    |-------------------------------+------------+---------|
    |expande tab para espaços       |"col -x"    |expand   |
    |-------------------------------+------------+---------|
    |contrai tab a partir de espaços|"col -h"    |unexpand |
    +------------------------------------------------------+


    indent(1) do pacote indent reformata completamente os espaços em
    branco no programa C.

    Os programas editores como o vim e o emacs também podem ser
    usados para conversão de TAB. Por exemplo com o vim, pode
    expandir a TAB com a sequência de comandos ":set expandtab" e
    ":%retab". Pode reverter isto com a sequência de comandos ":set
    noexpandtab" e ":%retab!".

%

11.1.6. Editores com auto-conversão

    Os editores modernos inteligentes como o programa vim são
    bastante inteligentes e lidam bem com quaisquer sistemas de
    codificação e quaisquer formatos de ficheiro. Deve usar estes
    editores sob o locale UTF-8 numa consola com capacidades de UTF-8
    para melhor compatibilidade.

    Um antigo ficheiro de texto Unix em Europeu ocidental,
    "u-file.txt", armazenado com a codificação latin1 (iso-8859-1)
    pode ser editado com o vim com o seguinte.

    $ vim u-file.txt

    Isto é possível porque o mecanismo de auto detecção da
    codificação do ficheiro no vim assume primeiro a codificação
    UTF-8 e, se falhar, assume que é latin1.

    Um antigo ficheiro de texto Unix em Polaco, "pu-file.txt",
    armazenado com a codificação latin2 (iso-8859-2) pode ser editado
    com o vim com o seguinte.

    $ vim '+e ++enc=latin2 pu-file.txt'

    Um antigo ficheiro de texto unix em Japonês, "ju-file.txt",
    armazenado com a codificação eucJP pode ser editado com o vim com
    o seguinte.

    $ vim '+e ++enc=eucJP ju-file.txt'

    Um antigo ficheiro de texto do MS Windows em Japonês,
    "jw-file.txt", armazenado na chamada codificação shift-JIS (mais
    precisamente: CP932) pode ser editado com o vim com o seguinte.

    $ vim '+e ++enc=CP932 ++ff=dos jw-file.txt'

    Quando um ficheiro é aberto com as opções "++enc" e "++ff", o
    ":w" na linha de comandos do Vim guarda-o no formato original e
    sobrescreve o ficheiro original. Também pode especificar o
    formato de gravação e o nome do ficheiro na linha de comandos do
    Vim, ex., ":w ++enc=utf8 new.txt".

    Por favor consulte o mbyte.txt "suporte a texto multi-byte" na
    ajuda on-line do vim e Tabela 11.2, “Lista de valores de
    codificação e a utilização deles” para os valores de locale
    usados com "++enc".

    A família de programas emacs pode executar as funções
    equivalentes.

%

11.1.7. Extracção de texto simples

    O seguinte lê uma página web para um ficheiro de texto. Isto é
    muito útil quando se copia as configurações da Web ou se aplica
    ferramentas de texto básicas do Unix como o grep(1) numa página
    web.

    $ w3m -dump http://www.remote-site.com/help-info.html >ficheiro_de_texto

    De modo semelhante, pode extrair dados de texto simples a partir
    de outros formatos a usar o seguinte.

    Tabela 11.5. Lista de ferramentas para extracção de dados de
    texto simples

    +---------------------------------------------------------------+
    | pacote  |popcon|tamanho| palavra chave  |       função        |
    |---------+------+-------+----------------+---------------------|
    |         |V:31, |       |                |Conversor de HTML    |
    |w3m      |I:284 |2289   |html→texto      |para texto com o     |
    |         |      |       |                |comando "w3m -dump"  |
    |---------+------+-------+----------------+---------------------|
    |         |V:3,  |       |                |Conversor de HTML    |
    |html2text|I:33  |274    |html→texto      |para texto avançado  |
    |         |      |       |                |(ISO 8859-1)         |
    |---------+------+-------+----------------+---------------------|
    |         |V:13, |       |                |Conversor de HTML    |
    |lynx     |I:98  |1948   |html→texto      |para texto com o     |
    |         |      |       |                |comando "lynx -dump" |
    |---------+------+-------+----------------+---------------------|
    |         |      |       |                |Conversor de HTML    |
    |elinks   |V:6,  |1767   |html→texto      |para texto com o     |
    |         |I:28  |       |                |comando "elinks      |
    |         |      |       |                |-dump"               |
    |---------+------+-------+----------------+---------------------|
    |         |V:6,  |       |                |Conversor de HTML    |
    |links    |I:39  |2249   |html→texto      |para texto com o     |
    |         |      |       |                |comando "links -dump"|
    |---------+------+-------+----------------+---------------------|
    |         |      |       |                |Conversor de HTML    |
    |links2   |V:1,  |5417   |html→texto      |para texto com o     |
    |         |I:15  |       |                |comando "links2      |
    |         |      |       |                |-dump"               |
    |---------+------+-------+----------------+---------------------|
    |         |V:2,  |       |                |converte ficheiros do|
    |antiword |I:10  |589    |MSWord→texto,ps |MSWord para texto    |
    |         |      |       |                |simples ou ps        |
    |---------+------+-------+----------------+---------------------|
    |         |V:27, |       |                |converte ficheiros do|
    |catdoc   |I:127 |675    |MSWord→texto,TeX|MSWord para texto    |
    |         |      |       |                |simples ou TeX       |
    |---------+------+-------+----------------+---------------------|
    |         |V:1,  |       |                |extrai texto de      |
    |pstotext |I:3   |126    |ps/pdf→texto    |ficheiros PostScript |
    |         |      |       |                |e PDF                |
    |---------+------+-------+----------------+---------------------|
    |         |V:0,  |       |                |remove as etiquetas  |
    |unhtml   |I:0   |43     |html→texto      |de marcas de um      |
    |         |      |       |                |ficheiro HTML        |
    |---------+------+-------+----------------+---------------------|
    |         |V:1,  |       |                |conversor de texto do|
    |odt2txt  |I:7   |60     |odt→texto       |OpenDocument para    |
    |         |      |       |                |texto                |
    +---------------------------------------------------------------+


%

11.1.8. Destacar e formatar dados de texto simples

    Pode destacar e formatar dados de texto simples com o seguinte.

    Tabela 11.6. Lista de ferramentas para destacar dados em texto
    simples

    +---------------------------------------------------------------+
    |     pacote     |popcon|tamanho|palavra chave |   descrição    |
    |----------------+------+-------+--------------+----------------|
    |                |      |       |              |MACRO do Vim    |
    |                |      |       |              |para converter  |
    |                |V:19, |       |              |código fonte em |
    |vim-runtime     |I:435 |31723  |destaque      |HTML com        |
    |                |      |       |              |":source        |
    |                |      |       |              |$VIMRUNTIME/    |
    |                |      |       |              |syntax/html.vim"|
    |----------------+------+-------+--------------+----------------|
    |                |      |       |              |conversor de    |
    |cxref           |V:0,  |1193   |c→html        |programa C para |
    |                |I:0   |       |              |latex e HTML    |
    |                |      |       |              |(linguagem C)   |
    |----------------+------+-------+--------------+----------------|
    |                |      |       |              |converte muitos |
    |src2tex         |V:0,  |622    |destaque      |códigos fonte   |
    |                |I:0   |       |              |para TeX        |
    |                |      |       |              |(linguagem C)   |
    |----------------+------+-------+--------------+----------------|
    |                |      |       |              |converte muitos |
    |                |      |       |              |códigos fonte   |
    |                |      |       |              |para HTML,      |
    |                |      |       |              |XHTML, LaTeX,   |
    |source-highlight|V:0,  |1992   |destaque      |Texinfo,        |
    |                |I:7   |       |              |sequências de   |
    |                |      |       |              |escape do cores |
    |                |      |       |              |ANSI e ficheiros|
    |                |      |       |              |do DocBook com  |
    |                |      |       |              |destaques (C++) |
    |----------------+------+-------+--------------+----------------|
    |                |      |       |              |converte muitos |
    |                |      |       |              |códigos fonte   |
    |                |      |       |              |para HTML,      |
    |highlight       |V:1,  |1083   |destaque      |XHTML, RTF,     |
    |                |I:12  |       |              |LaTeX, TeX ou   |
    |                |      |       |              |ficheiros XSL-FO|
    |                |      |       |              |com destaques   |
    |                |      |       |              |(C++)           |
    |----------------+------+-------+--------------+----------------|
    |                |V:0,  |       |              |colorizador     |
    |grc             |I:3   |190    |texto→cor     |genérico para   |
    |                |      |       |              |tudo (Python)   |
    |----------------+------+-------+--------------+----------------|
    |                |V:0,  |       |              |conversor de    |
    |txt2html        |I:3   |259    |texto→html    |texto para HTML |
    |                |      |       |              |(Perl)          |
    |----------------+------+-------+--------------+----------------|
    |                |      |       |              |formatador de   |
    |                |V:0,  |       |              |documentos de   |
    |markdown        |I:8   |57     |texto→html    |texto markdown  |
    |                |      |       |              |para (X)HTML    |
    |                |      |       |              |(Perl)          |
    |----------------+------+-------+--------------+----------------|
    |                |      |       |              |formatador de   |
    |                |      |       |              |documentos de   |
    |asciidoc        |I:13  |81     |texto→qualquer|texto AsciiDoc  |
    |                |      |       |              |para XML/HTML   |
    |                |      |       |              |(Python)        |
    |----------------+------+-------+--------------+----------------|
    |                |V:8,  |       |              |conversor geral |
    |pandoc          |I:47  |151714 |texto→qualquer|de markup       |
    |                |      |       |              |(Haskell)       |
    |----------------+------+-------+--------------+----------------|
    |                |      |       |              |Formatador de   |
    |                |      |       |              |documento de    |
    |python-docutils |V:12, |1771   |texto→qualquer|Texto           |
    |                |I:133 |       |              |Re-Estruturado  |
    |                |      |       |              |para XML        |
    |                |      |       |              |(Python)        |
    |----------------+------+-------+--------------+----------------|
    |                |      |       |              |conversão de    |
    |                |      |       |              |documentos de   |
    |                |      |       |              |texto para HTML,|
    |txt2tags        |V:0,  |342    |texto→qualquer|SGML, LaTeX, man|
    |                |I:1   |       |              |page, MoinMoin, |
    |                |      |       |              |Magic Point e   |
    |                |      |       |              |PageMaker       |
    |                |      |       |              |(Python)        |
    |----------------+------+-------+--------------+----------------|
    |                |      |       |              |documento       |
    |                |      |       |              |universal -     |
    |udo             |V:0,  |583    |texto→qualquer|utilitário de   |
    |                |I:0   |       |              |processamento de|
    |                |      |       |              |texto (linguagem|
    |                |      |       |              |C)              |
    |----------------+------+-------+--------------+----------------|
    |                |      |       |              |conversor de    |
    |                |      |       |              |documentos de   |
    |stx2any         |V:0,  |264    |texto→qualquer|texto simples   |
    |                |I:0   |       |              |estruturado para|
    |                |      |       |              |outros formatos |
    |                |      |       |              |(m4)            |
    |----------------+------+-------+--------------+----------------|
    |                |      |       |              |conversor de    |
    |                |      |       |              |documentos de   |
    |rest2web        |V:0,  |527    |texto→html    |Texto           |
    |                |I:0   |       |              |Re-Estruturado  |
    |                |      |       |              |para html       |
    |                |      |       |              |(Python)        |
    |----------------+------+-------+--------------+----------------|
    |                |      |       |              |sistema de      |
    |                |V:0,  |       |              |preparação de   |
    |aft             |I:0   |235    |texto→qualquer|documentos de   |
    |                |      |       |              |"formato livre" |
    |                |      |       |              |(Perl)          |
    |----------------+------+-------+--------------+----------------|
    |                |      |       |              |linguagem de    |
    |                |V:0,  |       |              |pré-documento e |
    |yodl            |I:0   |610    |texto→qualquer|ferramentas para|
    |                |      |       |              |a processar     |
    |                |      |       |              |(linguagem C)   |
    |----------------+------+-------+--------------+----------------|
    |                |V:0,  |       |              |analisador de   |
    |sdf             |I:0   |1445   |texto→qualquer|documentos      |
    |                |      |       |              |simples (Perl)  |
    |----------------+------+-------+--------------+----------------|
    |                |      |       |              |infraestrutura  |
    |                |V:0,  |       |              |de estruturação |
    |sisu            |I:0   |5344   |texto→qualquer|de documentos,  |
    |                |      |       |              |publicação e    |
    |                |      |       |              |busca (Ruby)    |
    +---------------------------------------------------------------+


%

11.2. Dados XML

    A The Extensible Markup Language (XML) é uma linguagem de
    marcação para documentos que contêm informação estruturada.

    Veja informação de introdução em XML.COM.

      * "O que é XML?"

      * "O que é XSLT?"
   
      * "O que é XSL-FO?"

      * "O que é XLink?"

%

11.2.1. Dicas básicas para XML

    O texto em XML parece-se com HTML. Permite-nos gerir múltiplos
    formatos de saída de um documento. Um sistema XML fácil é o
    pacote docbook-xsl, o qual é usado aqui.

    Cada ficheiro XML começa com a declaração XML standard como o
    seguinte.

    <?xml version="1.0" encoding="UTF-8"?>

    A sintaxe básica para um elemento XML é marcado como a seguir.

    <nome atributo="valor">conteúdo</nome>

    O elemento XML com conteúdo vazio é marcado no seguinte formato
    curto.

    <nome atributo="valor"/>

    O "atributo="valor"" nos exemplos em cima é opcional.

    A secção de comentários em XML está marcada como a seguir.

    <!-- comment -->

    Em vez de adicionar marcações, o XML requer conversão menor ao
    conteúdo a usar entidades predefinidas para os seguintes
    caracteres.

    Tabela 11.7. Lista de entidades predefinidas para XML

    +--------------------------------------------------+
    |entidade predefinida|caractere a ser convertido em|
    |--------------------+-----------------------------|
    |&quot;              |" : cotação                  |
    |--------------------+-----------------------------|
    |&apos;              |' : apóstrofo                |
    |--------------------+-----------------------------|
    |&lt;                |< : menor-que                |
    |--------------------+-----------------------------|
    |&gt;                |> : maior-que                |
    |--------------------+-----------------------------|
    |&amp;               |& : ampersand                |
    +--------------------------------------------------+


    Cuidado
   
    "<" ou "&" não podem ser usados em atributos ou elementos.

    Nota

    Quando são usadas entidades definidas pelo utilizador de estilos
    SGML, ex. "&some-tag:", a primeira definição ganha sobre as
    outras. A definição de entidade é expressa em "<!ENTITY
    alguma-etiqueta "valor da entidade">".

    Nota

    Desde que as marcações de XML sejam feitas de modo consistente
    com um certo conjunto de nomes de etiquetas (em vez de alguns
    dados como conteúdo ou valor de atributo), a conversão para outro
    XML é uma tarefa trivial a usar Extensible Stylesheet Language
    Transformations (XSLT).

%

11.2.2. Processamento de XML

    Existem muitas ferramentas disponíveis para processar ficheiros
    XML como o Extensible Stylesheet Language (XSL).

    Basicamente, após criar um ficheiro XML bem formado, pode
    convertê-lo para qualquer formato a usar o Extensible Stylesheet
    Language Transformations (XSLT).

    A Extensible Stylesheet Language for Formatting Objects (XSL-FO)
    é suposto ser a solução para a formatação. O pacote fop é novo no
    arquivo main de Debian devido à sua dependência da linguagem de
    programação Java. Por isso o código LaTeX é normalmente gerado a
    partir de XML a utilizar XSLT e o sistema LaTeX é utilizado para
    criar ficheiros imprimíveis tais como DVI, PostScript e PDF.

    Tabela 11.8. Lista de ferramentas XML

    +---------------------------------------------------------------+
    |  pacote   |popcon|tamanho|palavra|         descrição          |
    |           |      |       | chave |                            |
    |-----------+------+-------+-------+----------------------------|
    |           |V:15, |       |       |definição de tipo de        |
    |docbook-xml|I:280 |2133   |xml    |documento XML (DTD) para    |
    |           |      |       |       |DocBook                     |
    |-----------+------+-------+-------+----------------------------|
    |           |V:15, |       |       |processador de linha de     |
    |xsltproc   |I:104 |160    |xslt   |comandos XSLT (XML→ XML,    |
    |           |      |       |       |HTML, texto simples, etc.)  |
    |-----------+------+-------+-------+----------------------------|
    |           |      |       |       |folhas de estilo XSL para   |
    |docbook-xsl|V:13, |14870  |xml/   |processar XML do DocBook    |
    |           |I:165 |       |xslt   |para vários formatos de     |
    |           |      |       |       |saída com XSLT              |
    |-----------+------+-------+-------+----------------------------|
    |xmlto      |V:1,  |130    |xml/   |conversor de                |
    |           |I:23  |       |xslt   |XML-para-qualquer com XSLT  |
    |-----------+------+-------+-------+----------------------------|
    |dbtoepub   |V:0,  |37     |xml/   |conversor de XML DocBook    |
    |           |I:0   |       |xslt   |para .epub                  |
    |-----------+------+-------+-------+----------------------------|
    |           |V:3,  |       |xml/   |converte ficheiros do       |
    |dblatex    |I:16  |4643   |xslt   |Docbook para documentos DVI,|
    |           |      |       |       |PostScript, PDF com o XSLT  |
    |-----------+------+-------+-------+----------------------------|
    |fop        |V:1,  |291    |xml/   |converter ficheiros Docbook |
    |           |I:24  |       |xsl-fo |XML para PDF                |
    +---------------------------------------------------------------+


    Como o XML é um sub-conjunto da Standard Generalized Markup
    Language (SGML), pode ser processado pelas ferramentas extensivas
    disponíveis para SGML, como o Document Style Semantics and
    Specification Language (DSSSL).

    Tabela 11.9. Lista de ferramentas DSSSL

    +---------------------------------------------------------------+
    |   pacote    |popcon|tamanho|palavra|        descrição         |
    |             |      |       | chave |                          |
    |-------------+------+-------+-------+--------------------------|
    |             |V:2,  |       |       |ISO/IEC 10179:1996        |
    |openjade     |I:38  |1019   |dsssl  |processador DSSSL standard|
    |             |      |       |       |(mais recente)            |
    |-------------+------+-------+-------+--------------------------|
    |             |      |       |       |folhas de estilo DSSSL    |
    |             |V:1,  |       |xml/   |para processar XML do     |
    |docbook-dsssl|I:23  |2604   |dsssl  |DocBook para vários       |
    |             |      |       |       |formatos de saída com     |
    |             |      |       |       |DSSSL                     |
    |-------------+------+-------+-------+--------------------------|
    |             |      |       |       |utilitários para ficheiros|
    |             |      |       |       |do DocBook incluindo a    |
    |docbook-utils|V:0,  |281    |xml/   |conversão para outros     |
    |             |I:16  |       |dsssl  |formatos (HTML, RTF, PS,  |
    |             |      |       |       |man, PDF) com comandos    |
    |             |      |       |       |docbook2* com DSSSL       |
    |-------------+------+-------+-------+--------------------------|
    |             |V:0,  |       |SGML/  |conversor de SGML e XML   |
    |sgml2x       |I:0   |90     |dsssl  |que usa folhas de estilo  |
    |             |      |       |       |DSSSL                     |
    +---------------------------------------------------------------+


    Dica
   
    O yelp do GNOME por vezes é jeitoso para ler ficheiros XML do
    DocBook directamente pois ele renderiza directamente no X.

%

11.2.3. A extracção de dados de XML

    Pode extrair dados de HTML ou XML a partir de outros formatos a
    usar os seguintes.

    Tabela 11.10. Lista de ferramentas de extracção de dados de XML

    +---------------------------------------------------------------+
    | pacote  |popcon|tamanho|   palavra chave    |    descrição    |
    |---------+------+-------+--------------------+-----------------|
    |         |      |       |                    |conversor de     |
    |         |V:0,  |       |                    |documentos       |
    |wv       |I:7   |717    |MSWord→qualquer     |Microsoft Word   |
    |         |      |       |                    |para HTML, LaTeX,|
    |         |      |       |                    |etc.             |
    |---------+------+-------+--------------------+-----------------|
    |texi2html|V:0,  |1833   |texi→html           |conversor de     |
    |         |I:8   |       |                    |Texinfo para HTML|
    |---------+------+-------+--------------------+-----------------|
    |         |      |       |                    |conversor de     |
    |man2html |V:0,  |138    |manpage→html        |manual (manpage) |
    |         |I:2   |       |                    |para HTML        |
    |         |      |       |                    |(suporte a CGI)  |
    |---------+------+-------+--------------------+-----------------|
    |         |V:0,  |       |                    |conversor de     |
    |unrtf    |I:4   |148    |rtf→html            |documentos de RTF|
    |         |      |       |                    |para HTML, etc   |
    |---------+------+-------+--------------------+-----------------|
    |         |V:1,  |       |                    |conversor de info|
    |info2www |I:3   |76     |info→html           |do GNU para HTML |
    |         |      |       |                    |(suporte a CGI)  |
    |---------+------+-------+--------------------+-----------------|
    |         |      |       |                    |conversor de     |
    |         |V:0,  |       |                    |documentos SXW do|
    |ooo2dbk  |I:0   |217    |sxw→xml             |OpenOffice.org   |
    |         |      |       |                    |para documentos  |
    |         |      |       |                    |XML do DocBook   |
    |---------+------+-------+--------------------+-----------------|
    |         |      |       |                    |Ficheiros do     |
    |         |V:0,  |       |                    |WordPerfect 5.0 e|
    |wp2x     |I:0   |202    |WordPerfect→qualquer|5.1 para TeX,    |
    |         |      |       |                    |LaTeX, troff, GML|
    |         |      |       |                    |e HTML           |
    |---------+------+-------+--------------------+-----------------|
    |         |V:0,  |       |                    |conversor de     |
    |doclifter|I:0   |451    |troff→xml           |troff para       |
    |         |      |       |                    |DocBook XML      |
    +---------------------------------------------------------------+


    Para ficheiros HTML não-XML, pode convertê-los para XHTML o que é
    uma instância de XML bem formado. O XHTML pode ser processado por
    ferramentas de XML.

    Tabela 11.11. Lista de ferramentas de impressão bonita de XML

    +---------------------------------------------------------------+
    |   pacote    |popcon|tamanho|palavra chave |     descrição     |
    |-------------+------+-------+--------------+-------------------|
    |             |      |       |              |ferramenta de XML  |
    |             |      |       |              |de linha de        |
    |             |      |       |              |comandos com       |
    |libxml2-utils|V:22, |182    |xml↔html↔xhtml|xmllint(1)         |
    |             |I:246 |       |              |(verificação de    |
    |             |      |       |              |sintaxe,           |
    |             |      |       |              |reformatação, lint,|
    |             |      |       |              |…)                 |
    |-------------+------+-------+--------------+-------------------|
    |             |V:2,  |       |              |Verificador e      |
    |tidy         |I:14  |84     |xml↔html↔xhtml|reformatador de    |
    |             |      |       |              |sintaxe HTML       |
    +---------------------------------------------------------------+


    Após o XML apropriado ser gerado, pode usar a tecnologia XSLT
    para extrair dados baseados no contexto de marcações e etc.

%

11.3. Formatação de texto

    O programa troff do Unix desenvolvido originalmente pela AT&T
    pode ser usado para formatação de texto simples. É geralmente
    usado para criar as páginas de manual (manpages).

    O TeX criado por Donald Knuth é uma ferramenta de formatação de
    texto muito poderosa e é o standard de facto. O LaTeX
    originalmente escrito por Leslie Lamport permite um acesso de
    alto nível ao poder do TeX.

    Tabela 11.12. Lista de ferramentas de formatação de texto

    +---------------------------------------------------------------+
    |pacote |popcon|tamanho|palavra|           descrição            |
    |       |      |       | chave |                                |
    |-------+------+-------+-------+--------------------------------|
    |       |V:3,  |       |       |sistema TeX para formatação de  |
    |texlive|I:50  |71     |(La)TeX|texto, pre-visualização e       |
    |       |      |       |       |impressão                       |
    |-------+------+-------+-------+--------------------------------|
    |groff  |V:3,  |11838  |troff  |O sistema de formato de texto   |
    |       |I:64  |       |       |troff do GNU                    |
    +---------------------------------------------------------------+


%

11.3.1. formatação de texto roff

    Tradicionalmente, o roff é o sistema de processamento de texto
    principal do Unix. Veja roff(7), groff(7), groff(1), grotty(1), 
    troff(1), groff_mdoc(7), groff_man(7), groff_ms(7), groff_me(7), 
    groff_mm(7) e "info groff".

    Pode ler ou imprimir um bom tutorial e referência à macro "-me"
    em "/usr/share/doc/groff/" ao instalar o pacote groff.

    Dica

    "groff -Tascii -me -" produz resultados em texto simples com
    código de escape ANSI. Se deseja obter resultados tipo manpage
    com muitos "^H" e "_", então use "GROFF_NO_SGR=1 groff -Tascii
    -me -".

    Dica
   
    Para remover "^H" e "_" de um ficheiro de texto gerado pelo
    groff, filtre-o com "col -b -x".

%

11.3.2. TeX/LaTeX

    A distribuição de software TeX Live oferece um sistema TeX
    completo. O meta-pacote texlive disponibiliza uma seleção decente
    dos pacotes TeX Live que deverão ser suficientes para as tarefas
    mais comuns.

    Existem muitas referências disponíveis para TeX e LaTeX.

      * O HOWTO do The teTeX: O Guia Local de Linux-teTeX

      * tex(1)

      * latex(1)

      * texdoc(1)

      * texdoctk(1)

      * "The TeXbook", por Donald E. Knuth, (Addison-Wesley)

      * "LaTeX - A Document Preparation System", por Leslie Lamport,
        (Addison-Wesley)

      * "The LaTeX Companion", por Goossens, Mittelbach, Samarin,
        (Addison-Wesley)

    Este é o ambiente de formatação de texto mais poderoso. Muitos
    processadores SGML usam isto como processador de texto em
    backend. O Lyx disponibilizado pelo pacote lyx e o GNU TeXmacs
    disponibilizado pelo pacote texmacs oferecem um bom ambiente de
    edição OQVEOQT para o LaTeX enquanto muitos usam o Emacs e o Vim
    como a sua escolha para editor de código fonte.

    Existem muitos recursos online disponíveis.

      * O Guia TEX Live - TEX Live 2007 ("/usr/share/doc/
        texlive-doc-base/english/texlive-en/live.html") (pacote
        texlive-doc-base package)

      * Um Guia Simples para o Latex/Lyx

      * Processamento de Texto a Usar o LaTeX

      * Guia do Utilizador Local para o teTeX/LaTeX

    Quando os documentos ficam maiores, por vezes o TeX pode causar
    erros. tem de aumentar o tamanho do pool em "/etc/texmf/
    texmf.cnf" (ou mais apropriadamente editar o "/etc/texmf/texmf.d/
    95NonPath" e correr update-texmf(8)) para corrigir isto.

    Nota

    A fonte TeX de "The TeXbook" está disponível em http://
    tug.ctan.org/tex-archive/systems/knuth/dist/tex/texbook.tex. Este
    ficheiro contém a maioria das macros necessárias. Ouvi que pode
    processar este documento com o tex(1) após comentar as linhas 7 a
    10 e a adicionar "\input manmac \proofmodefalse". É fortemente
    recomendado comprar este livro (e todos os outros livros de
    Donald E. Knuth) em vez de usar a versão online mas a fonte é um
    grande exemplo de entrada em TeX!

%

11.3.3. Impressão bonita de um manual

    Consegue uma impressão bonita dum manual em PostScript com um dos
    seguintes comandos.

    $ man -Tps qualquer_manual | lpr

%

11.3.4. Criar um manual

    Apesar de escrever um manual (manpage) no formato troff simples
    ser possível, existem alguns programas que ajudam a criá-lo.

    Tabela 11.13. Lista de pacotes para ajudar a criar o manual
    (manpage)

    +---------------------------------------------------------------+
    |    pacote    |popcon|tamanho|palavra chave|     descrição     |
    |--------------+------+-------+-------------+-------------------|
    |              |V:0,  |       |             |conversor de       |
    |docbook-to-man|I:13  |191    |SGML→manpage |DocBook SGML para  |
    |              |      |       |             |macros roff man    |
    |--------------+------+-------+-------------+-------------------|
    |              |V:0,  |       |             |geração automática |
    |help2man      |I:10  |498    |texto→manpage|de manual a partir |
    |              |      |       |             |do --help          |
    |--------------+------+-------+-------------+-------------------|
    |              |V:0,  |       |             |conversor de info  |
    |info2man      |I:0   |134    |info→manpage |do GNU para POD ou |
    |              |      |       |             |páginas man        |
    |--------------+------+-------+-------------+-------------------|
    |              |      |       |             |converte texto     |
    |txt2man       |V:0,  |114    |texto→manpage|ASCII simples para |
    |              |I:1   |       |             |o formato de página|
    |              |      |       |             |man                |
    +---------------------------------------------------------------+


%

11.4. Dados imprimíveis

    Os dados imprimíveis são expressos no formato PostScript no
    sistema Debian. O Common Unix Printing System (CUPS) usa o
    Ghostscript como o programa backend de rasterização dele para as
    impressoras não-PostScript.

%

11.4.1. Ghostscript

    O núcleo da manipulação de dados imprimíveis é o interpretador
    PostScript (PS) Ghostscript o qual gera imagem em rasterização.

    O Ghostscript original mais recente da Artifex foi re-licenciado
    de AFPL para GPL e fundiu todas as alterações da versão ESP mais
    recente como as relacionadas com o CUPS no lançamento 8.60 como
    um lançamento unificado.

    Tabela 11.14. Lista de interpretadores PostScript Ghostscript

    +---------------------------------------------------------------+
    |     pacote     |popcon|tamanho|           descrição           |
    |----------------+------+-------+-------------------------------|
    |ghostscript     |V:252,|231    |O interpretador de PostScript/ |
    |                |I:598 |       |PDF Ghostscript GPL            |
    |----------------+------+-------+-------------------------------|
    |                |V:15, |       |Interpretador de PostScript/PDF|
    |ghostscript-x   |I:65  |223    |Ghostscript GPL - suporte a    |
    |                |      |       |ecrã X                         |
    |----------------+------+-------+-------------------------------|
    |                |      |       |Biblioteca de renderização de  |
    |libpoppler95    |I:3   |4172   |PDF que é um fork do           |
    |                |      |       |visualizador de PDF xpdf       |
    |----------------+------+-------+-------------------------------|
    |                |V:217,|       |Biblioteca de renderização de  |
    |libpoppler-glib8|I:481 |449    |PDF (biblioteca de partilha    |
    |                |      |       |baseada em GLib)               |
    |----------------+------+-------+-------------------------------|
    |                |V:111,|       |CMaps para suporte à biblioteca|
    |poppler-data    |I:637 |13090  |de renderização de PDF (para   |
    |                |      |       |CJK: Adobe-*)                  |
    +---------------------------------------------------------------+


    Dica
   
    "gs -h" pode mostrar a configuração do Ghostscript.

%

11.4.2. Juntar dois ficheiros PS ou PDF

    Pode unir dois ficheiros PostScript (PS) ou Portable Document
    Format (PDF) a usar o gs(1) do Ghostscript.

    $ gs -q -dNOPAUSE -dBATCH -sDEVICE=pswrite -sOutputFile=bla.ps -f foo1.ps foo2.ps
    $ gs -q -dNOPAUSE -dBATCH -sDEVICE=pdfwrite -sOutputFile=bla.pdf -f foo1.pdf foo2.pdf

    Nota

    O PDF, que é um formato de dados imprimíveis amplamente usado em
    várias plataformas, é essencialmente o formato PS comprimido com
    algumas funcionalidades e extensões adicionais.

    Dica

    Para a linha de comandos, o psmerge(1) e outros comandos do
    pacote psutils são úteis para manipular documentos em PostScript.
    O pdftk(1) do pacote pdftk também é útil para manipular
    documentos em PDF.

%

11.4.3. Utilitários de dados imprimíveis

    Os seguintes pacotes para utilitários de dados imprimíveis
    chamaram a minha atenção.

    Tabela 11.15. Lista de utilitários de dados imprimíveis

    +---------------------------------------------------------------+
    |   pacote    |popcon|tamanho|palavra chave|     descrição      |
    |-------------+------+-------+-------------+--------------------|
    |             |      |       |             |Utilitários de PDF: |
    |poppler-utils|V:241,|689    |pdf→ps,text,…|pdftops, pdfinfo,   |
    |             |I:434 |       |             |pdfimages,          |
    |             |      |       |             |pdftotext, pdffonts |
    |-------------+------+-------+-------------+--------------------|
    |             |      |       |             |Ferramentas de      |
    |psutils      |V:6,  |219    |ps→ps        |conversão de        |
    |             |I:105 |       |             |documentos          |
    |             |      |       |             |PostScript          |
    |-------------+------+-------+-------------+--------------------|
    |             |V:0,  |       |             |criar grandes       |
    |poster       |I:5   |58     |ps→ps        |posters de páginas  |
    |             |      |       |             |PostScript          |
    |-------------+------+-------+-------------+--------------------|
    |             |      |       |             |converter texto     |
    |enscript     |V:1,  |2132   |text→ps,     |ASCII para          |
    |             |I:20  |       |html, rtf    |PostScript, HTML,   |
    |             |      |       |             |RTF ou Pretty-Print |
    |-------------+------+-------+-------------+--------------------|
    |             |      |       |             |Conversor de        |
    |a2ps         |V:1,  |3651   |text→ps      |'Qualquer coisa para|
    |             |I:15  |       |             |PostScript' e       |
    |             |      |       |             |pretty-printer      |
    |-------------+------+-------+-------------+--------------------|
    |             |      |       |             |Ferramenta de       |
    |pdftk        |I:51  |28     |pdf→pdf      |conversão de        |
    |             |      |       |             |documentos PDF:     |
    |             |      |       |             |pdftk               |
    |-------------+------+-------+-------------+--------------------|
    |html2ps      |V:0,  |249    |html→ps      |conversor de HTML   |
    |             |I:3   |       |             |para PostScript     |
    |-------------+------+-------+-------------+--------------------|
    |gnuhtml2latex|V:0,  |27     |html→latex   |conversor de html   |
    |             |I:1   |       |             |para latex          |
    |-------------+------+-------+-------------+--------------------|
    |             |      |       |             |conversor de        |
    |             |V:0,  |       |             |documentos LaTeX    |
    |latex2rtf    |I:6   |480    |latex→rtf    |para RTF que podem  |
    |             |      |       |             |ser lidos pelo MS   |
    |             |      |       |             |Word                |
    |-------------+------+-------+-------------+--------------------|
    |             |      |       |             |conversor de        |
    |ps2eps       |V:3,  |98     |ps→eps       |PostScript para EPS |
    |             |I:68  |       |             |(PostScript         |
    |             |      |       |             |Encapsulado)        |
    |-------------+------+-------+-------------+--------------------|
    |             |      |       |             |Conversor de texto  |
    |e2ps         |V:0,  |109    |text→ps      |para PostScript com |
    |             |I:0   |       |             |suporte a           |
    |             |      |       |             |codificação Japonesa|
    |-------------+------+-------+-------------+--------------------|
    |impose+      |V:0,  |119    |ps→ps        |Utilitários do      |
    |             |I:0   |       |             |PostScript          |
    |-------------+------+-------+-------------+--------------------|
    |             |      |       |             |impressão bonita de |
    |             |      |       |             |muitos códigos fonte|
    |             |V:0,  |       |             |(C, C++, Java,      |
    |trueprint    |I:0   |146    |text→ps      |Pascal, Perl, Pike, |
    |             |      |       |             |Sh e Verilog) para  |
    |             |      |       |             |PostScript.         |
    |             |      |       |             |(linguagem C)       |
    |-------------+------+-------+-------------+--------------------|
    |             |      |       |             |conversor de PDF    |
    |pdf2svg      |V:0,  |30     |ps→svg       |para formato        |
    |             |I:4   |       |             |Gráficos vectoriais |
    |             |      |       |             |escaláveis          |
    |-------------+------+-------+-------------+--------------------|
    |             |V:0,  |       |             |conversor de PDF    |
    |pdftoipe     |I:0   |71     |ps→ipe       |para formato XML de |
    |             |      |       |             |IPE                 |
    +---------------------------------------------------------------+


%

11.4.4. Imprimir com o CUPS

    Ambos comandos lp(1) e lpr(1) oferecidos pelo Common Unix
    Printing System (CUPS) disponibilizam opções para impressão
    personalizada dos dados a imprimir.

    Pode imprimir 3 cópias coligidas de um ficheiro a usar um dos
    seguintes comandos.

    $ lp -n 3 -o Collate=True nome_do_ficheiro

    $ lpr -#3 -o Collate=True nome_do_ficheiro

    Pode personalizar ainda mais as operações da impressora ao usar
    opções da impressão como "-o number-up=2", "-o page-set=even",
    "-o page-set=odd", "-o scaling=200", "-o natural-scaling=200",
    etc., documentadas em Impressão em Linha de Comandos e Opções.

%

11.5. A conversão de dados de mail

    Os seguintes pacotes para conversão de dados de mail chamaram a
    minha atenção.

    Tabela 11.16. Lista de pacotes para ajudar na conversão de dados
    de mail

    +---------------------------------------------------------------+
    | pacote  |popcon|tamanho|palavra|          descrição           |
    |         |      |       | chave |                              |
    |---------+------+-------+-------+------------------------------|
    |sharutils|V:4,  |1421   |mail   |shar(1), unshar(1), uuencode  |
    |         |I:55  |       |       |(1), uudecode(1)              |
    |---------+------+-------+-------+------------------------------|
    |         |V:1,  |       |       |codificação e descodificação  |
    |mpack    |I:18  |106    |MIME   |de mensagens MIME: mpack(1) e |
    |         |      |       |       |munpack(1)                    |
    |---------+------+-------+-------+------------------------------|
    |         |      |       |       |descompactar anexos MIME do   |
    |tnef     |V:1,  |110    |ms-tnef|tipo "application/ms-tnef" o  |
    |         |I:10  |       |       |qual é um formato apenas da   |
    |         |      |       |       |Microsoft                     |
    |---------+------+-------+-------+------------------------------|
    |         |      |       |       |codificador e descodificador  |
    |uudeview |V:0,  |109    |mail   |dos seguintes formatos:       |
    |         |I:5   |       |       |uuencode, xxencode, BASE64,   |
    |         |      |       |       |quoted printable e BinHex     |
    +---------------------------------------------------------------+


    Dica

    O servidor de Internet Message Access Protocol versão 4 (IMAP4)
    (veja Secção 6.7, “Servidor POP3/IMAP4”) pode ser usado para
    mover mails de sistemas de mail proprietários se o software
    cliente de mail puder ser configurado para usar também o servidor
    IMAP4.

%

11.5.1. Noções básicas de dados de mail

    Os dados (SMTP) de mail devem ser limitados séries de dados de 7
    bits. Portanto os dados binários e os dados de texto a 8 bits são
    codificados em formato de 7 bits com o Multipurpose Internet Mail
    Extensions (MIME) e a seleção do conjunto de caracteres (veja
    Secção 8.4.1, “Bases de codificação”).

    O formato de armazenamento de mail standard é mbox de acordo com
    RFC2822 (RFC822 atualizado). Veja mbox(5) (disponibilizado pelo
    pacote mutt).

    Para as linguagens Europeias, "Content-Transfer-Encoding:
    quoted-printable" com o junto de caracteres ISO-8859-1 é
    geralmente usado para mail porque não existem muitos caracteres
    de 8 bits. Se o texto Europeu estiver codificado em UTF-8, é
    provável que seja usado o "Content-Transfer-Encoding:
    quoted-printable" pois é maioritariamente dados de 7 bits.

    Para Japonês, tradicionalmente usa-se "Content-Type: text/plain;
    charset=ISO-2022-JP" para o mail para manter o texto em 7 bits.
    Mas os sistemas mais antigos da Microsoft podem enviar dados de
    mail em Shift-JIS sem a declaração apropriada. Se o testo Japonês
    for codificado em UTF-8, é provável que se use Base64 pois contém
    muitos dados de 8 bits. A situação de outras linguagens Asiáticas
    é semelhante.

    Nota

    Se os seus dados de mail não-Unix são acessíveis por um software
    cliente não-Debian o qual pode falar com o servidor IMAP4, pode
    ser capaz de movê-los para fora ao executar o seu próprio
    servidor IMAP4 (veja Secção 6.7, “Servidor POP3/IMAP4”).

    Nota

    Se usa outros formatos de armazenamento de mail, movê-los para o
    formato mbox é um bom primeiro passo. Um programa cliente
    versátil como o mutt(1) pode dar jeito para isto.

    Pode dividir os conteúdos da mailbox para cada mensagem a usar o 
    procmail(1) e o formail(1).

    Cada mensagem de mail pode ser desempacotada a usar o munpack(1)
    do pacote mpack (ou outras ferramentas especializadas) para obter
    os conteúdos codificados em MIME.

%

11.6. Ferramentas de dados gráficos

    Os seguintes pacotes para conversão de dados gráficos, edição e
    ferramentas de organização chamaram a minha atenção.

    Tabela 11.17. Lista de ferramentas de dados gráficos

    +---------------------------------------------------------------------------+
    |         pacote         |popcon|tamanho|  palavra chave  |    descrição    |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |V:68, |       |                 |GNU Image        |
    |gimp                    |I:341 |22313  |imagem(bitmap)   |Manipulation     |
    |                        |      |       |                 |Program          |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |      |       |                 |programas de     |
    |imagemagick             |I:400 |218    |imagem(bitmap)   |manipulação de   |
    |                        |      |       |                 |imagens          |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |      |       |                 |programas de     |
    |graphicsmagick          |V:3,  |5224   |imagem(bitmap)   |manipulação de   |
    |                        |I:17  |       |                 |imagens (fork do |
    |                        |      |       |                 |imagemagick)     |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |      |       |                 |Frontend X11     |
    |                        |V:17, |       |                 |baseado em GTK+  |
    |xsane                   |I:173 |2346   |imagem(bitmap)   |para o SANE      |
    |                        |      |       |                 |(Scanner Access  |
    |                        |      |       |                 |Now Easy)        |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |V:32, |       |                 |ferramentas de   |
    |netpbm                  |I:409 |4302   |imagem(bitmap)   |conversão de     |
    |                        |      |       |                 |gráficos         |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |      |       |                 |converte ícones e|
    |                        |V:21, |       |                 |cursores do MS   |
    |icoutils                |I:127 |221    |png↔ico(bitmap)  |Windows de e para|
    |                        |      |       |                 |formatos PNG     |
    |                        |      |       |                 |(favicon.ico)    |
    |------------------------+------+-------+-----------------+-----------------|
    |scribus                 |V:2,  |30375  |ps/pdf/SVG/…     |editor de DTP do |
    |                        |I:23  |       |                 |Scribus          |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |      |       |                 |suite de         |
    |libreoffice-draw        |V:177,|14600  |imagem(vector)   |escritório do    |
    |                        |I:434 |       |                 |LibreOffice -    |
    |                        |      |       |                 |desenho          |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |V:55, |       |                 |editor de SVG    |
    |inkscape                |I:209 |84823  |imagem(vector)   |(Scalable Vector |
    |                        |      |       |                 |Graphics)        |
    |------------------------+------+-------+-----------------+-----------------|
    |dia                     |V:5,  |3727   |imagem(vector)   |editor de        |
    |                        |I:31  |       |                 |diagramas (Gtk)  |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |      |       |                 |Habilidade para  |
    |xfig                    |V:2,  |1793   |imagem(vector)   |Geração          |
    |                        |I:15  |       |                 |interactiva de   |
    |                        |      |       |                 |figuras sob X11  |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |      |       |                 |conversor de     |
    |                        |      |       |                 |ficheiro         |
    |pstoedit                |V:4,  |988    |ps/pdf→imagem    |PostScript e PDF |
    |                        |I:98  |       |(vector)         |para gráficos    |
    |                        |      |       |                 |vectoriais       |
    |                        |      |       |                 |editáveis (SVG)  |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |      |       |                 |ferramentas de   |
    |                        |      |       |                 |conversão de     |
    |libwmf-bin              |V:10, |113    |Windows/imagem   |meta-ficheiros do|
    |                        |I:211 |       |(vector)         |Windows (dados de|
    |                        |      |       |                 |gráficos         |
    |                        |      |       |                 |vectoriais)      |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |      |       |                 |converte         |
    |                        |V:0,  |       |                 |ficheiros XFig ao|
    |fig2sxd                 |I:0   |149    |fig→sxd(vector)  |formato do       |
    |                        |      |       |                 |OpenOffice.org   |
    |                        |      |       |                 |Draw             |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |      |       |                 |ferramenta de    |
    |                        |V:2,  |       |                 |pós-processamento|
    |unpaper                 |I:19  |460    |imagem→imagem    |para páginas     |
    |                        |      |       |                 |digitalizadas em |
    |                        |      |       |                 |scanner para OCR |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |      |       |                 |software livre de|
    |tesseract-ocr           |V:8,  |1500   |imagem→texto     |OCR baseado no   |
    |                        |I:37  |       |                 |motor de OCR     |
    |                        |      |       |                 |comercial da HP  |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |      |       |                 |Dados de motor   |
    |                        |V:7,  |       |                 |OCR: ficheiros de|
    |tesseract-ocr-eng       |I:37  |4032   |imagem→texto     |linguagem        |
    |                        |      |       |                 |tesseract-ocr    |
    |                        |      |       |                 |para texto Inglês|
    |------------------------+------+-------+-----------------+-----------------|
    |gocr                    |V:1,  |531    |imagem→texto     |software de OCR  |
    |                        |I:13  |       |                 |livre            |
    |------------------------+------+-------+-----------------+-----------------|
    |ocrad                   |V:0,  |303    |imagem→texto     |software de OCR  |
    |                        |I:5   |       |                 |livre            |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |      |       |                 |Programa de      |
    |eog                     |V:71, |10189  |imagem(Exif)     |visualização de  |
    |                        |I:264 |       |                 |gráficos Olho do |
    |                        |      |       |                 |GNOME            |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |V:5,  |       |                 |visualizador e   |
    |gthumb                  |I:22  |5475   |imagem(Exif)     |navegador de     |
    |                        |      |       |                 |imagens (GNOME)  |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |V:6,  |       |                 |Visualizador de  |
    |geeqie                  |I:21  |14643  |imagem(Exif)     |imagens que usa  |
    |                        |      |       |                 |GTK+             |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |V:19, |       |                 |organizador de   |
    |shotwell                |I:223 |6451   |imagem(Exif)     |fotos digitais   |
    |                        |      |       |                 |(GNOME)          |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |      |       |                 |Aplicação para   |
    |gtkam                   |V:0,  |1154   |imagem(Exif)     |recolher media de|
    |                        |I:6   |       |                 |câmaras digitais |
    |                        |      |       |                 |(GTK+)           |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |      |       |                 |cliente de linha |
    |gphoto2                 |V:1,  |955    |imagem(Exif)     |de comandos de   |
    |                        |I:12  |       |                 |camera digital   |
    |                        |      |       |                 |gphoto2          |
    |------------------------+------+-------+-----------------+-----------------|
    |gwenview                |V:28, |10570  |imagem(Exif)     |visualizador de  |
    |                        |I:97  |       |                 |imagens (KDE)    |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |      |       |                 |Suporte para     |
    |kamera                  |I:97  |798    |imagem(Exif)     |cameras digitais |
    |                        |      |       |                 |para aplicações  |
    |                        |      |       |                 |do KDE           |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |V:2,  |       |                 |aplicação de     |
    |digikam                 |I:13  |2646   |imagem(Exif)     |gestão de fotos  |
    |                        |      |       |                 |digitais para KDE|
    |------------------------+------+-------+-----------------+-----------------|
    |                        |      |       |                 |ferramenta de    |
    |exiv2                   |V:3,  |321    |imagem(Exif)     |manipulação de   |
    |                        |I:44  |       |                 |meta-dados EXIF/ |
    |                        |      |       |                 |IPTC             |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |V:1,  |       |                 |transformar      |
    |exiftran                |I:21  |70     |imagem(Exif)     |imagens jpeg de  |
    |                        |      |       |                 |câmaras digitais |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |      |       |                 |manipula a parte |
    |                        |      |       |                 |de não-imagem de |
    |jhead                   |V:1,  |109    |imagem(Exif)     |ficheiros JPEG   |
    |                        |I:11  |       |                 |compatíveis com  |
    |                        |      |       |                 |Exif (fotos de   |
    |                        |      |       |                 |câmaras digitais)|
    |------------------------+------+-------+-----------------+-----------------|
    |                        |      |       |                 |utilitário de    |
    |                        |      |       |                 |linha de comandos|
    |exif                    |V:1,  |339    |imagem(Exif)     |para mostrar     |
    |                        |I:12  |       |                 |informação EXIF  |
    |                        |      |       |                 |nos ficheiros    |
    |                        |      |       |                 |JPEG             |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |      |       |                 |utilitário para  |
    |                        |V:0,  |       |                 |ler etiquetas    |
    |exiftags                |I:5   |292    |imagem(Exif)     |Exif de ficheiros|
    |                        |      |       |                 |JPEG de câmaras  |
    |                        |      |       |                 |digitais         |
    |------------------------+------+-------+-----------------+-----------------|
    |exifprobe               |V:0,  |499    |imagem(Exif)     |ler meta-dados de|
    |                        |I:4   |       |                 |imagens digitais |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |V:2,  |       |                 |descodifica      |
    |dcraw                   |I:19  |535    |imagem(Raw)→ppm  |imagens cruas de |
    |                        |      |       |                 |câmaras digitais |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |      |       |                 |encontra imagens |
    |findimagedupes          |V:0,  |79     |image→fingerprint|visualmente      |
    |                        |I:1   |       |                 |semelhantes ou   |
    |                        |      |       |                 |duplicadas       |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |      |       |                 |junta imagens    |
    |ale                     |V:0,  |839    |imagem→imagem    |para aumentar a  |
    |                        |I:0   |       |                 |fidelidade ou    |
    |                        |      |       |                 |criar mosaicos   |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |V:0,  |       |                 |gera galerias    |
    |imageindex              |I:2   |145    |imagem(Exif)→html|HTML estáticas a |
    |                        |      |       |                 |partir de imagens|
    |------------------------+------+-------+-----------------+-----------------|
    |                        |V:0,  |       |                 |ferramenta de    |
    |outguess                |I:2   |261    |jpeg,png         |Esteganografia   |
    |                        |      |       |                 |universal        |
    |------------------------+------+-------+-----------------+-----------------|
    |librecad                |V:4,  |8205   |DXF              |editor de dados  |
    |                        |I:18  |       |                 |CAD (KDE)        |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |V:4,  |       |blend, TIFF,     |editor de        |
    |blender                 |I:38  |79166  |VRML, …          |conteúdos 3D para|
    |                        |      |       |                 |animação e etc   |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |V:0,  |       |                 |editor de modelos|
    |mm3d                    |I:0   |3778   |ms3d, obj, dxf, …|3D baseado em    |
    |                        |      |       |                 |OpenGL           |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |      |       |                 |meta pacote para |
    |open-font-design-toolkit|I:0   |10     |ttf, ps, …       |desenho de font  |
    |                        |      |       |                 |aberta           |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |      |       |                 |editor de tipo de|
    |fontforge               |V:0,  |4191   |ttf, ps, …       |letra para fonts |
    |                        |I:8   |       |                 |PS, TrueType e   |
    |                        |      |       |                 |OpenType         |
    |------------------------+------+-------+-----------------+-----------------|
    |                        |      |       |                 |programa para    |
    |                        |V:0,  |       |                 |ajustes e        |
    |xgridfit                |I:0   |806    |ttf              |alinhamento em   |
    |                        |      |       |                 |grelha de tipos  |
    |                        |      |       |                 |de letra TrueType|
    +---------------------------------------------------------------------------+


    Dica

    Procure mais ferramentas de imagem com a expressão regular
    "~Gworks-with::image" no aptitude(8) (veja Secção 2.2.6, “Opções
    do método de pesquisa com o aptitude”).

    Apesar dos programas com GUI como o gimp(1) serem muito
    poderosos, as ferramentas de linha de comandos como o imagemagick
    (1) são bastante úteis para automatizar a manipulação de imagens
    via scripts.

    O formato de facto de ficheiros de imagem das câmeras digitais é
    o Exchangeable Image File Format (EXIF) o qual é o formato de
    ficheiros de imagem JPEG com etiquetas de meta-dados adicionais.
    Pode conter informações como a data, hora e definições da camera.

    A patente de compressão de dados sem perdas de Lempel-Ziv-Welch
    (LZW) expirou. Os utilitários de Graphics Interchange Format
    (GIF) que usam o método de compressão LZW estão agora livremente
    disponíveis no sistema Debian.

    Dica

    Qualquer camera digital ou scanner com meio de gravação amovível
    funciona em Linux através de leitores de armazenamento USB desde
    que sigam as Regras de Desenho para Sistemas de Ficheiros de
    Câmeras e usem o sistema de ficheiros FAT. Veja Secção 10.1.7,
    “Aparelho de armazenamento amovível”.

%

11.7. Conversão de dados variados

    Existem muitos outros programas para converter dados. Os pacotes
    seguintes chamaram a minha atenção a usar a expressão regular
    "~Guse::converting" no aptitude(8) (veja Secção 2.2.6, “Opções do
    método de pesquisa com o aptitude”).

    Tabela 11.18. Lista de ferramentas de conversão de dados variados

    +---------------------------------------------------------------+
    | pacote  |popcon|tamanho|palavra chave|       descrição        |
    |---------+------+-------+-------------+------------------------|
    |         |V:2,  |       |             |conversor para pacotes  |
    |alien    |I:34  |161    |rpm/tgz→deb  |alienígenas num pacote  |
    |         |      |       |             |Debian                  |
    |---------+------+-------+-------------+------------------------|
    |         |      |       |             |conversor de "Electric  |
    |         |      |       |             |Book" (popular no Japão)|
    |freepwing|V:0,  |421    |EB→EPWING    |para um formato JIS X   |
    |         |I:0   |       |             |4081 único (um          |
    |         |      |       |             |subconjunto de EPWING   |
    |         |      |       |             |V1)                     |
    |---------+------+-------+-------------+------------------------|
    |calibre  |V:9,  |54876  |qualquer→EPUB|conversor de e-books e  |
    |         |I:36  |       |             |gestor de biblioteca    |
    +---------------------------------------------------------------+


    Também pode extrair dados do formato RPM com o seguinte.

    $ rpm2cpio file.src.rpm | cpio --extract

Capítulo 12. Programação

    Disponibilizo algumas dicas para as pessoas aprenderem
    programação no sistema Debian o suficiente para rastrear o código
    fonte do pacote. Aqui estão pacotes notáveis e pacotes de
    documentação correspondentes para programação.

    Tabela 12.1. Lista de pacotes para ajudar a programar

    +---------------------------------------------------------------+
    |    pacote     |popcon|tamanho|          documentação          |
    |---------------+------+-------+--------------------------------|
    |autoconf       |V:41, |1846   |"info autoconf" disponibilizado |
    |               |I:282 |       |por autoconf-doc                |
    |---------------+------+-------+--------------------------------|
    |automake       |V:42, |1830   |"info automake" disponibilizado |
    |               |I:279 |       |por automake1.10-doc            |
    |---------------+------+-------+--------------------------------|
    |bash           |V:791,|6469   |"info bash" disponibilizado por |
    |               |I:999 |       |bash-doc                        |
    |---------------+------+-------+--------------------------------|
    |bison          |V:9,  |2815   |"info bison" disponibilizado por|
    |               |I:103 |       |bison-doc                       |
    |---------------+------+-------+--------------------------------|
    |cpp            |V:319,|42     |"info cpp" disponibilizado por  |
    |               |I:770 |       |cpp-doc                         |
    |---------------+------+-------+--------------------------------|
    |ddd            |V:0,  |4184   |"info ddd" disponibilizado por  |
    |               |I:10  |       |ddd-doc                         |
    |---------------+------+-------+--------------------------------|
    |exuberant-ctags|V:5,  |341    |exuberant-ctags(1)              |
    |               |I:37  |       |                                |
    |---------------+------+-------+--------------------------------|
    |flex           |V:9,  |1279   |"info flex" disponibilizado por |
    |               |I:93  |       |flex-doc                        |
    |---------------+------+-------+--------------------------------|
    |gawk           |V:368,|2558   |"info gawk" disponibilizado por |
    |               |I:454 |       |gawk-doc                        |
    |---------------+------+-------+--------------------------------|
    |gcc            |V:165,|45     |"info gcc" disponibilizado por  |
    |               |I:604 |       |gcc-doc                         |
    |---------------+------+-------+--------------------------------|
    |gdb            |V:13, |9789   |"info gdb" disponibilizado por  |
    |               |I:114 |       |gdb-doc                         |
    |---------------+------+-------+--------------------------------|
    |gettext        |V:48, |5843   |"info gettext" disponibilizado  |
    |               |I:312 |       |por gettext-doc                 |
    |---------------+------+-------+--------------------------------|
    |gfortran       |V:11, |16     |"info gfortran" disponibilizado |
    |               |I:98  |       |por gfortran-doc (Fortran 95)   |
    |---------------+------+-------+--------------------------------|
    |fpc            |I:3   |121    |fpc(1) e html por fp-docs       |
    |               |      |       |(Pascal)                        |
    |---------------+------+-------+--------------------------------|
    |glade          |V:0,  |1730   |ajuda disponibilizada via menu  |
    |               |I:8   |       |(UI Builder)                    |
    |---------------+------+-------+--------------------------------|
    |libc6          |V:935,|12771  |"info libc" disponibilizado por |
    |               |I:999 |       |glibc-doc e glibc-doc-reference |
    |---------------+------+-------+--------------------------------|
    |make           |V:157,|1592   |"info make" disponibilizado por |
    |               |I:609 |       |make-doc                        |
    |---------------+------+-------+--------------------------------|
    |xutils-dev     |V:1,  |1466   |imake(1), xmkmf(1), etc.        |
    |               |I:12  |       |                                |
    |---------------+------+-------+--------------------------------|
    |mawk           |V:372,|242    |mawk(1)                         |
    |               |I:997 |       |                                |
    |---------------+------+-------+--------------------------------|
    |               |V:610,|       |perl(1) e páginas html          |
    |perl           |I:992 |705    |disponibilizadas por perl-doc e |
    |               |      |       |perl-doc-html                   |
    |---------------+------+-------+--------------------------------|
    |python         |V:293,|68     |python(1) e páginas html        |
    |               |I:923 |       |disponibilizadas por python-doc |
    |---------------+------+-------+--------------------------------|
    |tcl            |V:31, |22     |tcl(3) e manuais detalhados     |
    |               |I:414 |       |disponibilizados pelo tcl-doc   |
    |---------------+------+-------+--------------------------------|
    |tk             |V:30, |22     |tk(3) e manuais detalhados      |
    |               |I:406 |       |disponibilizados pelo tk-doc    |
    |---------------+------+-------+--------------------------------|
    |               |V:137,|       |ruby(1) e a referência          |
    |ruby           |I:318 |35     |interactiva disponibilizada pelo|
    |               |      |       |ri                              |
    |---------------+------+-------+--------------------------------|
    |vim            |V:106,|3231   |help(F1) menu disponibilizado   |
    |               |I:398 |       |por vim-doc                     |
    |---------------+------+-------+--------------------------------|
    |susv2          |I:0   |16     |buscar "The Single UNIX         |
    |               |      |       |Specifications v2"              |
    |---------------+------+-------+--------------------------------|
    |susv3          |I:0   |16     |buscar "The Single UNIX         |
    |               |      |       |Specifications v3"              |
    +---------------------------------------------------------------+


    Estão disponíveis referências online ao escrever "man nome" após
    instalar os pacotes manpages e manpages-dev. As referências
    online ás ferramentas GNU está disponíveis ao escrever "info
    nome_do_programa" após instalar os pacotes de documentação
    pertinentes. Poderá ter de incluir os arquivos contrib e non-free
    adicionalmente ao arquivo main pois algumas documentações GFDL
    não são consideradas compatíveis com DFSG.

    Atenção
   
    Não use "test" como o nome de um ficheiro de teste executável.
    "test" é um comando embutido na shell.

    Cuidado

    Deve instalar os programas compilados directamente a partir da
    fonte em "/usr/local" ou "/opt" para evitar colisões com os
    programas do sistema.

    Dica

    Os Exemplos de código da criação de "Song 99 Bottles of Beer"
    devem dar-lhe uma boa ideia de praticamente todas as linguagens
    de programação.

%

12.1. O script de shell

    O script de shell é um ficheiro de texto com o bit de execução
    definido e contém os comandos no seguinte formato.

    #!/bin/sh
     ... linhas de comando

    A primeira linha especifica o interpretador shell que lê e
    executa o conteúdo deste ficheiro.

    Ler scripts de shell é a melhor maneira de compreender como um
    sistema tipo Unix funciona. Aqui, Dou alguns apontamentos e
    lembranças para programação de shell. Veja "Erros de Shell"
    (http://www.greenend.org.uk/rjk/2001/04/shell.html) para aprender
    a partir de erros.

    Ao contrário do modo interativo de shell (veja Secção 1.5, “O
    comando simples da shell” e Secção 1.6, “Processamento de texto
    estilo Unix”), os scripts de shell usam frequentemente
    parâmetros, condicionais e ciclos.

%

12.1.1. Compatibilidade da shell do POSIX

    Muitos scripts de sistema podem ser interpretados por qualquer
    uma das shells POSIX (veja Tabela 1.13, “Lista de programas da
    shell”). A shell predefinida do sistema é "/bin/sh" o qual é uma
    ligação simbólica para o programa real.

      * bash(1) para lenny ou mais antigo
   
      * dash(1) para squeeze ou mais recente

    Evite escrever um script de shell com bashisms ou zshisms para
    fazê-loportável entre todas as shells do POSIX. Pode verificar
    isto a usar o checkbashisms(1).

    Tabela 12.2. Lista dos 'bashisms' típicos

    +---------------------------------------------------------------+
    |          Bom: POSIX           |       Evitar: 'bashism'       |
    |-------------------------------+-------------------------------|
    |if [ "$foo" = "$bar" ] ; then …|if [ "$foo" == "$bar" ] ; then |
    |                               |…                              |
    |-------------------------------+-------------------------------|
    |diff -u file.c.orig file.c     |diff -u file.c{.orig,}         |
    |-------------------------------+-------------------------------|
    |mkdir /foobar /foobaz          |mkdir /foo{bar,baz}            |
    |-------------------------------+-------------------------------|
    |funcname() { … }               |function funcname() { … }      |
    |-------------------------------+-------------------------------|
    |formato octal: "\377"          |formato hexadecimal: "\xff"    |
    +---------------------------------------------------------------+


    O comando "echo" tem de ser usado com os seguintes cuidados
    porque a implementação dele difere entre o integrado na shell e
    os comandos externos.

      * Evite usar quaisquer opções de comando excepto "-n".
   
      * Evite usar sequências de escape na cadeia porque o
        manuseamento dele varia.

    Nota
   
    Apesar da opção "-n" não ser realmente sintaxe POSIX, geralmente
    é aceite.

    Dica
   
    Use o comando "printf" em vez do comando "echo" se precisar de
    embeber sequências de escape na string de saída.

%

12.1.2. Parâmetros da shell

    Parâmetros de shell especiais são frequentemente usados no script
    shell.

    Tabela 12.3. Lista de parâmetros da shell

    +---------------------------------------------------------------+
    |  parâmetro da   |                    valor                    |
    |      shell      |                                             |
    |-----------------+---------------------------------------------|
    |$0               |nome da shell ou script de shell             |
    |-----------------+---------------------------------------------|
    |$1               |primeiro(1) argumento shell                  |
    |-----------------+---------------------------------------------|
    |$9               |nono(9) argumento shell                      |
    |-----------------+---------------------------------------------|
    |$#               |quantidade de parâmetros de posição          |
    |-----------------+---------------------------------------------|
    |"$*"             |"$1 $2 $3 $4 … "                             |
    |-----------------+---------------------------------------------|
    |"$@"             |"$1" "$2" "$3" "$4" …                        |
    |-----------------+---------------------------------------------|
    |$?               |estado de saída do comando mais recente      |
    |-----------------+---------------------------------------------|
    |$$               |PID deste script shell                       |
    |-----------------+---------------------------------------------|
    |$!               |PID da tarefa de fundo iniciada mais         |
    |                 |recentemente                                 |
    +---------------------------------------------------------------+


    As expansões de parâmetro básicas a lembrar são as seguintes.

    Tabela 12.4. Lista de expansões de parâmetros de shell

    +---------------------------------------------------------------+
    |    formato da     |  valor se var  | valor se var não estiver |
    |   expressão do    |estiver definido|         definido         |
    |     parâmetro     |                |                          |
    |-------------------+----------------+--------------------------|
    |${var:-string}     |"$var"          |"string"                  |
    |-------------------+----------------+--------------------------|
    |${var:+string}     |"string"        |"null"                    |
    |-------------------+----------------+--------------------------|
    |${var:=string}     |"$var"          |"string" (e corra "var=   |
    |                   |                |string")                  |
    |-------------------+----------------+--------------------------|
    |${var:?string}     |"$var"          |echo "string" para stderr |
    |                   |                |(e termina com erro)      |
    +---------------------------------------------------------------+


    Aqui, o símbolo ortográfico dois pontos ":" em todas estas
    operações é na realidade opcional.

      * com ":" = teste de operador para existe e não nulo
   
      * sem ":" = teste de operador para apenas existe

    Tabela 12.5. Lista de substituições de parâmetros de shell chave

    +---------------------------------------------------------------+
    |   formato de substituição de   |          resultado           |
    |           parâmetro            |                              |
    |--------------------------------+------------------------------|
    |${var%suffix}                   |remover o modelo de sufixo    |
    |                                |menor                         |
    |--------------------------------+------------------------------|
    |${var%%suffix}                  |remover o modelo de sufixo    |
    |                                |maior                         |
    |--------------------------------+------------------------------|
    |${var#prefix}                   |remover o modelo de prefixo   |
    |                                |menor                         |
    |--------------------------------+------------------------------|
    |${var##prefix}                  |remover o modelo de prefixo   |
    |                                |maior                         |
    +---------------------------------------------------------------+


%

12.1.3. Condicionais da shell

    Cada comando retorna um estado de saída que pode ser usado para
    expressões condicionais.

      * Sucesso: 0 ("True")
   
      * Erro: não 0 ("False")

    Nota
   
    "0" no contexto condicional da shell significa "Verdadeiro",
    enquanto "0" no contexto condicional de C significa "Falso".

    Nota
   
    "[" é o equivalente do comando test, o qual avalia os seus
    argumentos até ao "]" como uma expressão condicional.

    Os idiomas condicionais básicos a lembrar são os seguintes.

      * "<comando> && <se_sucesso_corre_também_este_comando> || true"

      * "<comando> || <se_não_sucesso_corre_também_este_comando> ||
        true"

      * Um fragmento de script de multi-linhas como o seguinte

    if [ <expressão_condicional> ]; then
     <se_sucesso_corre_este-comando>
    else
     <se_não_sucesso_corre_este_comando>
    fi

    Aqui o "|| true" final foi necessário para assegurar que estes
    script de shell não termina acidentalmente nesta linha quando a
    shell é invocada com a flag "-e".

    Tabela 12.6. Lista de operadores de comparação de ficheiros na
    expressão condicional

    +---------------------------------------------------------------+
    |    equação     |  condição para retornar o verdadeiro lógico  |
    |----------------+----------------------------------------------|
    |-e <ficheiro>   |<ficheiro> existe                             |
    |----------------+----------------------------------------------|
    |-d <ficheiro>   |<ficheiro> existe e é um diretório            |
    |----------------+----------------------------------------------|
    |-f <ficheiro>   |<ficheiro> existe e é um ficheiro normal      |
    |----------------+----------------------------------------------|
    |-w <ficheiro>   |<ficheiro> existe e pode-se escrever nele     |
    |----------------+----------------------------------------------|
    |-x <ficheiro>   |<ficheiro> existe e é executável              |
    |----------------+----------------------------------------------|
    |<ficheiro1> -nt |<ficheiro1> é mais recente que <ficheiro2>    |
    |<ficheiro2>     |(modificação)                                 |
    |----------------+----------------------------------------------|
    |<ficheiro1> -ot |<ficheiro1> é mais antigo que <ficheiro2>     |
    |<ficheiro2>     |(modificação)                                 |
    |----------------+----------------------------------------------|
    |<ficheiro1> -ef |<ficheiro1> e <ficheiro2> estão no mesmo      |
    |<ficheiro2>     |aparelho e no mesmo número de inode           |
    +---------------------------------------------------------------+


    Tabela 12.7. Lista de operadores de comparação de strings na
    expressão condicional

    +---------------------------------------------------------------+
    |    equação    |  condição para retornar o verdadeiro lógico   |
    |---------------+-----------------------------------------------|
    |-z <str>       |o comprimento de <str> é zero                  |
    |---------------+-----------------------------------------------|
    |-n <str>       |o comprimento de <str> não é zero              |
    |---------------+-----------------------------------------------|
    |<str1> = <str2>|<str1> and <str2> são iguais                   |
    |---------------+-----------------------------------------------|
    |<str1> !=      |<str1> and <str2> não são iguais               |
    |<str2>         |                                               |
    |---------------+-----------------------------------------------|
    |<str1> < <str2>|<str1> ordena antes de <str2> (dependente do   |
    |               |locale)                                        |
    |---------------+-----------------------------------------------|
    |<str1> > <str2>|<str1> ordena após <str2> (dependente do       |
    |               |locale)                                        |
    +---------------------------------------------------------------+


    Os operadores de comparação Aritmética de inteiros na expressão
    regular são "-eq", "-ne", "-lt", "-le", "-gt" e "-ge".

%

12.1.4. Ciclos (loops) da shell

    Existem vários idiomas de ciclo para usar na shell POSIX.

      * "for x in foo1 foo2 … ; do command ; done" faz ciclos ao
        atribuir itens da lista "foo1 foo2 …" à variável "x" e a
        executar o "comando".

      * "while condition ; do command ; done" repete o "comando"
        enquanto a "condição" for verdadeira.
   
      * "until condition ; do command ; done" repete o "comando"
        enquanto a "condição" não for verdadeira.

      * "break" permite sair do ciclo.

      * "continue" permite resumir a próxima interacção do ciclo.

    Dica
   
    A interacção numérica tipo linguagem C pode ser realizada a usar 
    seq(1) como o gerador de "foo1 foo2 …".

    Dica
   
    Veja Secção 9.3.9, “Repetir um ciclo de comandos sobre ficheiros”
    .

%

12.1.5. A sequência de processamento da linha de comandos da shell

    A shell processa um script rudemente como a seguinte sequência.

      * A shell lê uma linha.

      * A shell agrupa uma parte de uma linha como um testemunho se
        estiver dentro de "…" ou '…'.

      * A shell divide a outra parte de uma linha em testemunhos como
        o seguinte.

          + Espaços em branco: <espaço> <tab> <nova-linha>

          + Meta-caracteres: < > | ; & ( )

      * A shell verifica a palavra reservada para cada testemunho
        para ajustar o comportamento dele se não dentro de "…" ou
        '…'.

          + palavra reservada: if then elif else fi for in while
            unless do done case esac

      * A shell expande o alias se não estiver dentro de "…" ou '…'.

      * A shell expande o til se não dentro de "…" ou '…'.

          + "~" → diretório home do utilizador atual

          + "~<utilizador>" → diretório home do <utilizador>

      * A shell expande o parâmetro ao seu valor se não dentro de
        '…'.

          + parâmetro: "$PARAMETER" ou "${PARAMETER}"

      * A shell expande a substituição do comando se não dentro de
        '…'.

          + "$( comando )" → o resultado do "comando"

          + "` comando `" → o resultado do "comando"

      * A shell expande o glob nome_de-caminho aos nomes de ficheiros
        correspondentes se não dentro de "…" ou '…'.

          + * → quaisquer caracteres

          + ? → um caractere

          + […] → qualquer um dos caracteres em "…"

      * A shell procura o comando a partir do seguinte e executa-o.

          + definição de função

          + comando builtin

          + ficheiro executável em "$PATH"

      * A shell vai à próxima linha e repete este processo outra vez
        a partir do topo desta sequência.

    Citações singulares (') dentro de aspas não têm efeito.

    Executar "set -x" na shell ou invocar a shell com a opção "-x"
    faz a shell escrever todos os comandos executados. Isto é muito
    útil para depuração.

%

12.1.6. Programas utilitários para script de shell

    De modo a tornar o seu programa de shell o mais portável possível
    entre os sistemas Debian, é uma boa ideia limitar os programas
    utilitários àqueles disponibilizados pelos pacotes essenciais.

      * "aptitude search ~E" lista os pacotes essenciais.

      * "dpkg -L <nome_do-pacote> |grep '/man/man.*/'" lista as
        manpages (manuais) para comandos oferecidos pelo pacote
        <nome_do_pacote>.

    Tabela 12.8. Lista de pacotes que contém programas utilitários
    pequenos para scripts de shell

    +---------------------------------------------------------------+
    |   pacote   | popcon  |tamanho|           descrição            |
    |------------+---------+-------+--------------------------------|
    |coreutils   |V:891,   |17478  |utilitários de núcleo GNU       |
    |            |I:999    |       |                                |
    |------------+---------+-------+--------------------------------|
    |debianutils |V:925,   |230    |utilitários variados específicos|
    |            |I:999    |       |do Debian                       |
    |------------+---------+-------+--------------------------------|
    |bsdmainutils|V:60,    |26     |colecção de mais utilitários do |
    |            |I:996    |       |FreeBSD                         |
    |------------+---------+-------+--------------------------------|
    |bsdutils    |V:673,   |393    |utilitários básicos do          |
    |            |I:999    |       |4.4BSD-Lite                     |
    |------------+---------+-------+--------------------------------|
    |moreutils   |V:11,    |237    |utilitários Unix adicionais     |
    |            |I:35     |       |                                |
    +---------------------------------------------------------------+


    Dica

    Apesar de moreutils poder não existir fora de Debian, oferece
    pequenos programas interessantes. O mais notável é o sponge(8)
    que é bastante útil quando desejar sobrescrever o ficheiro
    original.

%

12.1.7. Diálogo do script de shell

    A interface de utilizador de um programa simples de shell pode
    ser melhorada a partir de interacção aborrecida pelos comandos
    echo e read para uma mais interactiva ao usar um dos chamados
    programas de diálogo, etc.

    Tabela 12.9. Lista de programas de interface de utilizador

    +---------------------------------------------------------------+
    | pacote  |popcon|tamanho|              descrição               |
    |---------+------+-------+--------------------------------------|
    |x11-utils|V:180,|712    |xmessage(1): mostra uma mensagem ou   |
    |         |I:599 |       |questão numa janela (X)               |
    |---------+------+-------+--------------------------------------|
    |         |V:87, |       |mostra caixas de diálogo amigas do    |
    |whiptail |I:995 |71     |utilizador a partir de scripts de     |
    |         |      |       |shell (newt)                          |
    |---------+------+-------+--------------------------------------|
    |         |V:15, |       |mostra caixas de diálogo amigas do    |
    |dialog   |I:123 |1222   |utilizador a partir de scripts de     |
    |         |      |       |shell (ncurses)                       |
    |---------+------+-------+--------------------------------------|
    |zenity   |V:87, |384    |mostra caixas de diálogo gráficas a   |
    |         |I:409 |       |partir de scripts de shell (gtk2.0)   |
    |---------+------+-------+--------------------------------------|
    |         |V:0,  |       |Ferramenta Frontend de Scripts de     |
    |ssft     |I:0   |75     |Shell (wrapper para o zenity, kdialog |
    |         |      |       |e dialog com o gettext)               |
    |---------+------+-------+--------------------------------------|
    |gettext  |V:48, |5843   |"/usr/bin/gettext.sh": traduz mensagem|
    |         |I:312 |       |                                      |
    +---------------------------------------------------------------+


%

12.1.8. Exemplo de script de shell com zenity

    Aqui está um script simples que cria uma imagem ISO com dados
    RS02 fornecidos por dvdisaster(1).

    #!/bin/sh -e
    # gmkrs02 : Copyright (C) 2007 Osamu Aoki <osamu@debian.org>, Public Domain
    #set -x
    error_exit()
    {
      echo "$1" >&2
      exit 1
    }
    # Initialize variables
    DATA_ISO="$HOME/Desktop/iso-$$.img"
    LABEL=$(date +%Y%m%d-%H%M%S-%Z)
    if [ $# != 0 ] && [ -d "$1" ]; then
      DATA_SRC="$1"
    else
      # Select diretory for creating ISO image from folder on desktop
      DATA_SRC=$(zenity --file-selection --diretory  \
        --title="Select the diretory tree root to create ISO image") \
        || error_exit "Exit on diretory selection"
    fi
    # Check size of archive
    xterm -T "Check size $DATA_SRC" -e du -s $DATA_SRC/*
    SIZE=$(($(du -s $DATA_SRC | awk '{print $1}')/1024))
    if [ $SIZE -le 520 ] ; then
      zenity --info --title="Dvdisaster RS02" --width 640  --height 400 \
        --text="The data size is good for CD backup:\\n $SIZE MB"
    elif [ $SIZE -le 3500 ]; then
      zenity --info --title="Dvdisaster RS02" --width 640  --height 400 \
        --text="The data size is good for DVD backup :\\n $SIZE MB"
    else
      zenity --info --title="Dvdisaster RS02" --width 640  --height 400 \
        --text="The data size is too big to backup : $SIZE MB"
      error_exit "The data size is too big to backup :\\n $SIZE MB"
    fi
    # only xterm is sure to have working -e option
    # Create raw ISO image
    rm -f "$DATA_ISO" || true
    xterm -T "genisoimage $DATA_ISO" \
      -e genisoimage -r -J -V "$LABEL" -o "$DATA_ISO" "$DATA_SRC"
    # Create RS02 supplemental redundancy
    xterm -T "dvdisaster $DATA_ISO" -e  dvdisaster -i "$DATA_ISO" -mRS02 -c
    zenity --info --title="Dvdisaster RS02" --width 640  --height 400 \
      --text="ISO/RS02 data ($SIZE MB) \\n created at: $DATA_ISO"
    # EOF

    Pode desejar criar um lançador no ambiente de trabalho com um
    conjunto de comandos algo como "/usr/local/bin/gmkrs02 %d".

%

12.2. Make

    O Make é um utilitário para manutenção de grupos de programas
    Após a execução do make(1), o make lê o ficheiro de regras,
    "Makefile" e atualiza um alvo se depender de ficheiros
    pré-requisitados que foram modificados desde que o alvo foi
    modificado por último, ou se o alvo não existir. A execução
    destas atualizações pode ocorrer concorrentemente.

    A regra de sintaxe do ficheiro é a seguinte.

    target: [ pré-requisitos ... ]
     [TAB]  comando1
     [TAB]  -comando2 # ignora erros
     [TAB]  @comando3 # suprime os ecos

    Aqui "[TAB]" é um código TAB. Cada linha é interpretada pela
    shell após fazer a substituição da variável. Use "$$" para
    inserir "$" para valores de ambiente para um script de shell.

    Podem ser escritas regras implícitas para o destino e
    pré-requisitos, por exemplo, com o seguinte.

    %.o: %.c header.h

    Aqui, o alvo contém o caractere "%" (exatamente um deles). O "%"
    pode corresponder a qualquer substring não vazia nos nomes de
    ficheiros do próprio alvo. Os pré-requisitos usam igualmente "%"
    para mostrar como os seus nomes estão relacionados ao próprio
    nome do alvo.

    Tabela 12.10. Lista de variáveis automáticas do make

    +---------------------------------------------------------------+
    |    variável     |                    valor                    |
    |   automática    |                                             |
    |-----------------+---------------------------------------------|
    |$@               |alvo                                         |
    |-----------------+---------------------------------------------|
    |$<               |primeiro pré-requisito                       |
    |-----------------+---------------------------------------------|
    |$?               |todos os novos pré-requisitos                |
    |-----------------+---------------------------------------------|
    |$^               |todos os pré-requisitos                      |
    |-----------------+---------------------------------------------|
    |$*               |"%" estaminal correspondente no modelo de    |
    |                 |destino                                      |
    +---------------------------------------------------------------+


    Tabela 12.11. Lista de expansões da variável do make

    +----------------------------------------+
    |expansão da variável|     descrição     |
    |--------------------+-------------------|
    |foo1 := bar         |expansão de uma vez|
    |--------------------+-------------------|
    |foo2 = bar          |expansão recursiva |
    |--------------------+-------------------|
    |foo3 += bar         |acrescentar        |
    +----------------------------------------+


    Corra "make -p -f/dev/null" para ver as regras internas
    automáticas.

%

12.3. C

    Pode configurar um ambiente apropriado para compilar programas
    escritos na linguagem de programação C com o seguinte.

    # apt-get install glibc-doc manpages-dev libc6-dev gcc build-essential

    O pacote libc6-dev, isto é, a biblioteca C GNU, disponibiliza uma
    biblioteca standard C a qual é uma colecção de ficheiros
    cabeçalho e rotinas de biblioteca usadas pela linguagem de
    programação C.

    Veja referências para C nos seguintes.

      * "info libc" (Referência de funções da biblioteca C)

      * gcc(1) e "info gcc"
   
      * cada-nome_de_função_da_biblioteca_C(3)

      * Kernighan & Ritchie, "A Linguagem de Programação C", 2ª
        edição (Prentice Hall)

%

12.3.1. Programa C simples (gcc)

    Um simples exemplo, "example.c" pode ser compilado com uma
    biblioteca "libm" num executável "run_example" com o seguinte.

    $ cat > example.c << EOF
    #include <stdio.h>
    #include <math.h>
    #include <string.h>

    int main(int argc, char **argv, char **envp){
            double x;
            char y[11];
            x=sqrt(argc+7.5);
            strncpy(y, argv[0], 10); /* prevent buffer overflow */
            y[10] = '\0'; /* fill to make sure string ends with '\0' */
            printf("%5i, %5.3f, %10s, %10s\n", argc, x, y, argv[1]);
            return 0;
    }
    EOF
    $ gcc -Wall -g -o run_example example.c -lm
    $ ./run_example
            1, 2.915, ./run_exam,     (null)
    $ ./run_example 1234567890qwerty
            2, 3.082, ./run_exam, 1234567890qwerty

    Aqui, o "-lm" é necessário para ligar a biblioteca "/usr/lib/
    libm.so" do pacote libc6 para o sqrt(3). A biblioteca real está
    em "/lib/" com o nome de ficheiro "libm.so.6", o qual é uma
    ligação simbólica para "libm-2.7.so".

    Olhe ao último parâmetro no texto resultante. Existem mais de 10
    caracteres mesmo com "%10s" especificado.

    O uso de funções de operação de memória de ponteiro sem
    verificações de limites como em sprintf(3) e strcpy(3), está
    descontinuado para prevenir exploits de sobrelotação do buffer
    que influenciam os efeitos de transbordo em cima. Em vez disso,
    use snprintf(3) e strncpy(3).

%

12.4. Depuração

    A depuração é uma parte importante das atividades de programação.
    Saber como depurar programas faz de si um bom utilizador de
    Debian capaz de produzir relatórios de bugs significantes.

%

12.4.1. Execução gdb básica

    O depurador principal em Debian é o gdb(1) que lhe permite
    inspeccionar um programa enquanto ele é executado.

    Vamos instalar o gdb e programas relacionados com o seguinte.

    # apt-get install gdb gdb-doc build-essential devscripts

    Um bom tutorial do gdb é disponibilizado pelo "info gdb" ou
    encontrado em qualquer sítio na web. Aqui está um exemplo simples
    de uso do gdb(1) num "program" compilado com a opção "-g" para
    produzir informação de depuração.

    $ gdb program
    (gdb) b 1                # define ponto de paragem na linha 1
    (gdb) run args           # corre o programa com argumentos
    (gdb) next               # próxima linha
    ...
    (gdb) step               # passo em frente
    ...
    (gdb) p parm             # escreve o parm
    ...
    (gdb) p parm=12          # define valor para 12
    ...
    (gdb) quit

    Dica
   
    Muitos comandos do gdb(1) podem ser abreviados. A expansão da Tab
    funciona como na shell.

%

12.4.2. Depurar o pacote Debian

    Como todos os binários instalados devem estar 'despidos' de
    símbolos no sistema Debian por predefinição, a maioria dos
    símbolos de depuração são removidos no pacote normal. De modo a
    depurar pacotes Debian com o gdb(1), ou os pacotes *-dbg
    correspondentes ou *-dbgsym precisam de ser instalados (ex.
    libc6-dbg no caso do libc6, coreutils-dbgsym no caso do
    coreutils).

    Pacotes do estilo antigo proporcionariam o pacote *-dbg dele
    correspondente. É posto directamente dentro do arquivo Debian
    main juntamente com o próprio pacote original. Para os pacotes
    mais recentes, eles podem gerar pacotes *-dbgsym automaticamente
    quando são compilados e esses pacotes de depuração são postos no
    arquivo debian-debug. Por favor consulte artigos na Debian Wiki
    para mais informação.

    Se um pacote a ser depurado não disponibilizar ou o pacote *-dbg
    ou *-dbgsym dele, necessita instalá-lo após recompilá-lo com o
    seguinte.

    $ mkdir /path/new ; cd /path/new
    $ sudo apt-get update
    $ sudo apt-get dist-upgrade
    $ sudo apt-get install fakeroot devscripts build-essential
    $ apt-get source package_name
    $ cd package_name*
    $ sudo apt-get build-dep ./

    Corrigir bugs se necessário.

    Mude a versão de pacote para uma que não colida com as versões
    oficiais de Debian, por exemplo, uma adicionada com "+debug1"
    quando se recompila uma versão de pacote existente, ou uma
    adicionada com "~pre1" quando se compila uma versão de pacote
    ainda não lançada com o seguinte.

    $ dch -i

    Compilar e instalar pacotes com símbolos de depuração com o
    seguinte.

    $ export DEB_BUILD_OPTIONS=nostrip noopt
    $ debuild
    $ cd ..
    $ sudo debi nome_do_pacote*.changes

    Necessita verificar os scripts de construção do pacote e
    assegurar o uso de "CFLAGS=-g -Wall" para compilar binários.

%

12.4.3. Obter um backtrace

    Quando encontrar um crash num programa, é uma boa ideia enviar um
    relatório de bug com informação de backtrace copiada-e-colada.

    O backtrace pode ser obtido com os seguinte passos.

      * Correr o programa sob gdb(1).

      * Reproduzir o erro (crash).
   
          + Isso faz com que volte para o aviso do gdb.

      * Escreva "bt" no aviso do gdb.

    No caso do programa congelar, pode travar o programa ao
    pressionar Ctrl-C no terminal que correr o gdb para obter o aviso
    do gdb.

    Dica

    Muitas vezes, vê um backtrace onde uma ou mais linhas do topo
    estão em "malloc()" ou "g_malloc()". Quando isto acontece, há
    grandes hipóteses do seu backtrace não ser muito útil. O modo
    mais fácil de encontrar alguma informação útil é definir a
    variável de ambiente "$MALLOC_CHECK_" para um valor de 2 (malloc
    (3)). Pode fazer isto enquanto corre o gdb ao fazer o seguinte.

     $ MALLOC_CHECK_=2 gdb hello

%

12.4.4. Comandos gdb avançados

    Tabela 12.12. Lista de comandos gdb avançados

    +---------------------------------------------------------------+
    |    comando     |      descrição dos objetivos do comando      |
    |----------------+----------------------------------------------|
    |(gdb) thread    |obter um backtrace para todos os processos de |
    |apply all bt    |um programa de multi-processo                 |
    |----------------+----------------------------------------------|
    |(gdb) bt full   |obter parâmetros que vêm na pilha das chamadas|
    |                |de função                                     |
    |----------------+----------------------------------------------|
    |(gdb) thread    |obtém um backtrace e parâmetros como a        |
    |apply all bt    |combinação das opções precedentes             |
    |full            |                                              |
    |----------------+----------------------------------------------|
    |(gdb) thread    |obter um backtrace e parâmetros para as 10    |
    |apply all bt    |chamadas do topo para cortar resultados       |
    |full 10         |irrelevantes                                  |
    |----------------+----------------------------------------------|
    |(gdb) set       |escreve um relatório dos resultados do gdb    |
    |logging on      |para um ficheiro (a predefinição é "gdb.txt") |
    +---------------------------------------------------------------+


%

12.4.5. Depurar Erros do X

    Se o programa do GNOME preview1 recebeu um erro do X, deverá ver
    a mensagem que a seguir.

    O programa 'preview1' recebeu um erro do X Window System.

    Neste caso, pode tentar correr o programa com "--sync" e quebrar
    a função "gdk_x_error" de modo a obter um backtrace.

%

12.4.6. Verificar a dependência em bibliotecas

    Use o ldd(1) para encontrar uma dependência de um programa em
    bibliotecas com o seguinte.

    $ ldd /bin/ls
            librt.so.1 => /lib/librt.so.1 (0x4001e000)
            libc.so.6 => /lib/libc.so.6 (0x40030000)
            libpthread.so.0 => /lib/libpthread.so.0 (0x40153000)
            /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x40000000)

    Para que o ls(1) funcione num ambiente 'chroot', as bibliotecas
    em cima têm de estar disponíveis no seu ambiente 'chroot'.

    Veja Secção 9.3.6, “Rastear as atividades de programas”.

%

12.4.7. Ferramentas de detecção de fugas de memória

    Aqui estão várias ferramentas de detecção de fugas de memória em
    Debian.

    Tabela 12.13. Lista de ferramentas de detecção de fugas de
    memória

    +---------------------------------------------------------------+
    |    pacote    |popcon |tamanho|           descrição            |
    |--------------+-------+-------+--------------------------------|
    |libc6-dev     |V:249, |14357  |mtrace(1): funcionalidades de   |
    |              |I:620  |       |depuração do malloc em glibc    |
    |--------------+-------+-------+--------------------------------|
    |valgrind      |V:6,   |80378  |depurador e perfilador de       |
    |              |I:46   |       |memória                         |
    |--------------+-------+-------+--------------------------------|
    |electric-fence|V:0,   |70     |o depurador malloc(3)           |
    |              |I:5    |       |                                |
    |--------------+-------+-------+--------------------------------|
    |leaktracer    |V:0,   |57     |rastreador de fugas de memória  |
    |              |I:3    |       |para programas C++              |
    |--------------+-------+-------+--------------------------------|
    |libdmalloc5   |V:0,   |393    |biblioteca de depuração de      |
    |              |I:3    |       |alocação de memória             |
    +---------------------------------------------------------------+


%

12.4.8. Ferramentas de análise de código estático

    Existem ferramentas tipo lint para análise estática de código.

    Tabela 12.14. Lista de ferramentas para análise de código
    estático

    +---------------------------------------------------------------+
    |   pacote    |popcon|tamanho|            descrição             |
    |-------------+------+-------+----------------------------------|
    |splint       |V:0,  |2315   |ferramenta para verificação       |
    |             |I:4   |       |estática de programas C por bugs  |
    |-------------+------+-------+----------------------------------|
    |             |V:0,  |       |ferramenta para examinar código   |
    |flawfinder   |I:0   |181    |fonte C/C++ e procurar por        |
    |             |      |       |fraquezas na segurança            |
    |-------------+------+-------+----------------------------------|
    |             |V:610,|       |interpretador com verificador de  |
    |perl         |I:992 |705    |código estático interno: B::Lint  |
    |             |      |       |(3perl)                           |
    |-------------+------+-------+----------------------------------|
    |pylint       |V:2,  |1371   |Verificador estático de código    |
    |             |I:13  |       |Python                            |
    |-------------+------+-------+----------------------------------|
    |weblint-perl |V:0,  |32     |Verificado de sintaxe e estilo    |
    |             |I:1   |       |mínimo para HTML                  |
    |-------------+------+-------+----------------------------------|
    |             |V:0,  |       |verificador de ligações rápido e  |
    |linklint     |I:0   |344    |ferramenta de manutenção de sites |
    |             |      |       |web                               |
    |-------------+------+-------+----------------------------------|
    |libxml2-utils|V:22, |182    |utilitários com xmllint(1) para   |
    |             |I:246 |       |validar ficheiros XML             |
    +---------------------------------------------------------------+


%

12.4.9. Desassemblar binário

    Pode desassemblar código binário com o objdump(1) com o seguinte.

    $  objdump -m i386 -b binary -D /usr/lib/grub/x86_64-pc/stage1

    Nota
   
    O gdb(1) pode ser usado para desmontar (desassemblar) código
    interativamente.

%

12.5. Flex — um Lex melhor

    O Flex é um gerador rápido de análise léxica compatível com o
    Lex.

    O tutorial do flex(1) encontra-se em "info flex".

    Tem de fornecer o seu próprio "main()" e "yywrap()". Caso
    contrário, o seu programa flex deverá ficar como isto para
    compilar sem uma biblioteca. Isto é porque o "yywrap" é uma macro
    e a "%option main" liga implicitamente "%option noyywrap".

    %option main
    %%
    .|\n    ECHO ;
    %%

    Alternativamente, pode compilar com a opção "-lfl" do linker no
    final da sua linha de comandos cc(1) (como AT&T-Lex com "-ll").
    Nenhuma "%opção" é necessária neste caso.

%

12.6. Bison — um Yacc melhor

    Vários pacotes disponibilizam um gerador LR parser ou LALR parser
    compatível em frente com o Yacc em Debian.

    Tabela 12.15. Lista de geradores de análise LALR compatíveis com
    Yacc

    +---------------------------------------------------------------+
    |pacote| popcon |tamanho|               descrição               |
    |------+--------+-------+---------------------------------------|
    |bison |V:9,    |2815   |gerador de análise GNU LALR            |
    |      |I:103   |       |                                       |
    |------+--------+-------+---------------------------------------|
    |byacc |V:0, I:6|160    |Gerador de análise Berkeley LALR       |
    |------+--------+-------+---------------------------------------|
    |btyacc|V:0, I:0|243    |gerador de análises de retrocesso      |
    |      |        |       |baseado no byacc                       |
    +---------------------------------------------------------------+


    O tutorial para o bison(1) encontra-se em "info bison".

    Tem de disponibilizar as suas próprias chamadas "main()" e
    "yyerror()". "main()" chama "yyparse()" que chama "yylex()",
    geralmente criada com Flex.

%

12.7. Autoconf

    Autoconf é uma ferramenta para produzir scripts de shell que
    configuram automaticamente pacotes de software em código fonte
    para se adaptarem a muitos tipos de sistemas tipo-Unix a usar o
    sistema de compilação completo do GNU.

    O autoconf(1) produz o script de configuração "configure". O
    "configure" cria automaticamente um "Makefile" personalizado a
    usar o modelo "Makefile.in".

%

12.7.1. Compilar e instalar um programa

    Atenção
   
    Não substitua ficheiros do sistema com os seus programas
    compilados quando os instalar.

    Debian não toca nos ficheiros em "/usr/local/" ou em "/opt".
    Portanto se compilar um programa a partir do código-fonte,
    instale-o em "/usr/local/" para que não interfira com o Debian.

    $ cd src
    $ ./configure --prefix=/usr/local
    $ make
    $ make install # isto coloca os ficheiros no sistema

%

12.7.2. Desinstalar um programa

    Se tiver a fonte original e esta utilizar autoconf(1)/automake(1)
    e se se lembrar como o configurou, execute como o seguinte para
    desinstalar o programa.

    $ ./configure "todas-as-opções-que-fornecer"
    # make uninstall

    Em alternativa, se tiver a absoluta certeza que o processo de
    instalação apenas coloca ficheiros sob "/usr/local/" e não há lá
    nada importante, pode apagar todos os seus conteúdos com o
    seguinte.

    # find /usr/local -type f -print0 | xargs -0 rm -f

    Se não tiver a certeza de onde os ficheiros estão instalados,
    deve considerar usar o checkinstall(8) do pacote checkinstall,
    que disponibiliza um caminho limpo para a desinstalação. Agora
    suporta criar um pacote Debian com a opção "-D".

%

12.8. A loucura dos scripts curtos de Perl

    Apesar de quaisquer scripts AWK poderem ser reescritos
    automaticamente em Perl a usar o a2p(1), scripts AWK de uma linha
    ficam melhor convertidos manualmente para scripts Perl de uma
    linha.

    Vamos pensar a seguir o fragmento do script AWK.

    awk '($2=="1957") { print $3 }' |

    Isto é equivalente a qualquer uma das seguintes linhas.

    perl -ne '@f=split; if ($f[1] eq "1957") { print "$f[2]\n"}' |

    perl -ne 'if ((@f=split)[1] eq "1957") { print "$f[2]\n"}' |

    perl -ne '@f=split; print $f[2] if ( $f[1]==1957 )' |

    perl -lane 'print $F[2] if $F[1] eq "1957"' |

    perl -lane 'print$F[2]if$F[1]eq+1957' |

    Este último é um enigma. Aproveitei-me das seguintes
    funcionalidades do Perl.

      * O espaço em branco é opcional.
   
      * Existe a conversão automática de números para string.

    Veja perlrun(1) para as opções de linha de comandos. Para mais
    scripts Perl doidos, Perl Golf pode ser interessante.

%

12.9. Web

    Páginas web dinâmicas interactivas podem ser feitas conforme a
    seguir.

      * As questões são apresentadas ao explorador do utilizador a
        usar formulários HTML.

      * Preencher e clicar nas entradas do formulário envia uma das
        seguintes strings de URL com parâmetros codificados do
        explorador para o servidor web.

          + "http://www.foo.dom/cgi-bin/program.pl?VAR1=VAL1&VAR2=
            VAL2&VAR3=VAL3"

          + "http://www.foo.dom/cgi-bin/program.py?VAR1=VAL1&VAR2=
            VAL2&VAR3=VAL3"

          + "http://www.foo.dom/program.php?VAR1=VAL1&VAR2=VAL2&VAR3=
            VAL3"

      * O "%nn" no URL é substituído por um caractere com valor
        hexadecimal nn.

      * A variável de ambiente está definida como: "QUERY_STRING=
        "VAR1=VAL1 VAR2=VAL2 VAR3=VAL3"".

      * O programa CGI (qualquer um de "program.*") no servidor web
        executa-se a si próprio com a variável de ambiente
        "$QUERY_STRING".

      * O stdout do programa CGI é enviado ao explorador web e é
        apresentado como uma página web dinâmica e interactiva.

    Por razões de segurança é melhor não embarcar em novos hacks para
    analisar parâmetros CGI. Existem módulos definidos para eles em
    Perl e Python. O PHP vem com estas funcionalidades. Quando é
    necessário o armazenamento de dados no cliente, usam-se cookies
    HTTP. Quando é necessário o processamento de dados no lado do
    cliente, usa-se frequentemente Javascript.

    Para mais, veja Common Gateway Interface, The Apache Software
    Foundation e JavaScript.

    Procurar "CGI tutorial" no Google ao escrever directamente o URL
    codificado http://www.google.com/search?hl=en&ie=UTF-8&q=
    CGI+tutorial no endereço do explorador é uma boa maneira de ver o
    script CGI em acção no servidor da Google.

%

12.10. A tradução do código-fonte

    Existem programas para converter código-fonte.

    Tabela 12.16. Lista de ferramentas de tradução de código-fonte

    +---------------------------------------------------------------+
    | pacote  |popcon|tamanho| palavra |         descrição          |
    |         |      |       |  chave  |                            |
    |---------+------+-------+---------+----------------------------|
    |perl     |V:610,|705    |AWK→PERL |converter código-fonte de   |
    |         |I:992 |       |         |AWK para PERL: a2p(1)       |
    |---------+------+-------+---------+----------------------------|
    |         |V:0,  |       |         |converter código-fonte de   |
    |f2c      |I:6   |442    |FORTRAN→C|FORTRAN 77 para C/C++: f2c  |
    |         |      |       |         |(1)                         |
    |---------+------+-------+---------+----------------------------|
    |         |V:0,  |       |         |conversor de NASM (formato  |
    |intel2gas|I:0   |178    |intel→gas|Intel) ao GNU Assembler     |
    |         |      |       |         |(GAS)                       |
    +---------------------------------------------------------------+


%

12.11. Criar um pacote Debian

    Se desejar criar um pacote Debian, leia o seguinte.

      * Capítulo 2, Gestão de pacotes Debian para compreender o
        sistema básico de pacotes

      * Secção 2.7.13, “Portar um pacote ao sistema stable” para
        compreender o processo básico de portar

      * Secção 9.10.4, “Sistema chroot” para compreender as técnicas
        de chroot básicas

      * debuild(1), pbuilder(1) e pdebuild(1)

      * Secção 12.4.2, “Depurar o pacote Debian” para recompilar para
        depuração

      * Guia dos Novos Maintainers da Debian como tutorial (o pacote
        maint-guide)

      * Referência de Programadores da Debian (o pacote
        developers-reference)

      * Manual de Políticas Debian (o pacote debian-policy)

      * Guia dos Novos Maintainers da Debian (o pacote debmake-doc)

    Existem pacotes como os debmake, dh-make, dh-make-perl, etc., que
    auxiliam no processo em empacotamento.

Apêndice A. Apêndice

    Aqui estão as origens deste documento.

A.1. o labirinto Debian

    O sistema Linux é uma plataforma de computação muito poderosa
    para um computador em rede. No entanto, aprender a usar todas as
    suas capacidades não é fácil. Configurar a lista de trabalhos de
    impressora LPR com uma impressora não-PostScript era um bom
    exemplo para tropeçar. (Não existe mais esse problema porque as
    instalações recentes usam o novo sistema CUPS.)

    Existe um mapa completo e detalhado chamado o "CÓDIGO FONTE".
    Este é muito preciso mas muito difícil de compreender. Existem
    também referências chamadas HOWTO e mini-HOWTO. São mais fáceis
    de compreender mas tendem a dar-lhe demasiados detalhes e a
    perder o objetivo principal. Por vezes tenho problemas a
    encontrar a secção correcta num HOWTO longo quando preciso de
    invocar alguns comandos.

    Espero que este "Debian Reference (versão 2.77)" (2021-01-10
    06:32:51 UTC) disponibilize um bom ponto de partida para pessoas
    no labirinto Debian.

A.2. História do Copyright

    O Debian Reference foi iniciado por mim, Osamu Aoki <osamu at
    debian dot org> como um memo pessoal de administração do sistema.
    Muitos conteúdos vieram do conhecimento que ganhei a partir da
    lista de email debian-user e de outros recursos Debian.

    A seguir uma sugestão de Josip Rodin, que estava muito ativo com
    o Projecto de Documentação de Debian (DDP), o "Debian Reference
    (versão 1, 2001-2007)" foi criado como parte dos documentos DDP.

    Após 6 anos, percebi que a "Debian Reference (versão 1)" estava
    ultrapassada e comecei a reescrever muitos dos seus conteúdos. A
    nova "Debian Reference (versão 2)" é lançada em 2008.

    Os conteúdos do tutorial pode ser rastreados até à sua origem e
    inspiração com o seguinte.

      * "Guia do Utilizador de Linux" por Larry Greenfield (Dezembro
        1996)

          + tornado obsoleto pelo "Debian Tutorial"

      * "Debian Tutorial" por Havoc Pennington. (11 Dezembro, 1998)

          + parcialmente escrito por Oliver Elphick, Ole Tetlie,
            James Treacy, Craig Sawyer e Ivan E. Moore II

          + tornado obsoleto por "Debian GNU/Linux: Guia de
            Instalação e Utilização"

      * "Debian GNU/Linux: Guia de Instalação e Utilização" por John
        Goerzen e Ossama Othman (1999)

          + tornado obsoleto pela "Debian Reference (versão 1)"

    A descrição do pacote e do arquivo podem rastrear alguma da
    origem e inspiração dele no seguinte.

      * "FAQ do Debian" (versão de Março 2002, quando era mantido por
        Josip Rodin)

    Os outros conteúdos podem rastrear alguma da origem e inspiração
    deles no seguinte.

      * "Debian Reference (versão 1)" por Osamu Aoki (2001–2007)
   
          + tornado obsoleto pela nova "Debian Reference (versão 2)"
            em 2008.

    A "Debian Reference (versão 1)" anterior foi criada com muitos
    contribuidores.

      * a maior contribuição de conteúdo de tópicos de configuração
        de rede por Thomas Hood

      * contribuição significativa de conteúdos em tópicos
        relacionados com X e VCS por Brian Nelson

      * a ajuda na construção de scripts de compilação e muitas
        correcções no conteúdo por Jens Seidel

      * revisão extensiva por David Sewell

      * muitas contribuições pelos tradutores, contribuidores e
        relatórios de bugs

    Foram usadas muitas páginas de manual e páginas info do sistema
    Debian como referências principais para escrever este documento.
    De modo extensivo, Osamu Aoki considerou dentro da utilização
    justa, muitas partes delas, especialmente definições de comandos,
    foram usadas como porções de frases após cuidados esforços
    editoriais para as adaptar no estilo e objetivo deste documento.

    A descrição do depurador gdb foi expandida a usar Conteúdos wiki
    Debian de backtrace com consentimento de Ari Pollak, Loïc Minier
    e Dafydd Harries.

    O conteúdo do "Debian Reference (versão 2.77)" (2021-01-10
    06:32:51 UTC) é maioritariamente trabalho meu com excepção do
    descrito acima. Este foi também atualizado pelos contribuidores.

    O Documento "Debian Reference (versão 2)" foi traduzido por
    Américo Monteiro a_monteiro_AT_netcabo.pt.

    O autor, Osamu Aoki, agradece a todos os que ajudaram a tornar
    possível este documento.

A.3. Formato do documento

    A fonte do documento original em Inglês é escrita atualmente em
    ficheiros de texto AsciiDoc. AsciiDoc é usado como conveniência
    apenas porque escreve-se menos do que directamente em XML e
    suporta tabelas num formato muito intuitivo. Deve pensar em
    ficheiro XML e PO como ficheiros fonte reais. Via script de
    compilação,é convertido para formato DocBook XML e os dados
    gerados automaticamente são inseridos para formar uma fonte final
    em Docbook XML. Esta fonte final Docbook XML pode ser convertida
    em HTML, epub, texto simples, PostScript e PDF. (Alguns formatos
    pode ser retirados da distribuição.)

