Référence Debian

                             Osamu Aoki

Copyright © 2013-2021 Osamu Aoki

    Ce guide de référence Debian (version 2.77) (2021-01-10 06:32:51
    UTC) est destiné à procurer un large aperçu du système Debian en
    tant que guide de l’utilisateur d’un système installé. Il couvre
    de nombreux aspects de l’administration du système à l’aide
    d’exemples de commandes de l’interpréteur pour les
    non-développeurs.

Résumé

Ce livre est libre ; vous pouvez le redistribuer et le modifier selon
les termes de la Licence Publique Générale GNU (« GNU GPL ») avec
n’importe quelle version compatible avec les Règles des Logiciels
Libres selon Debian (DFSG).

---------------------------------------------------------------------

Cette Debian Reference (version 2.77) (2021-01-10 06:32:51 UTC) est
destinée à fournir un large aperçu de l’administration d’un système
Debian, sous la forme d’un guide utilisateur de post-installation.

Le lecteur cible est quelqu’un qui désire apprendre les scripts de
l’interpréteur de commandes mais qui ne souhaite pas lire tous les
sources en C pour comprendre le fonctionnement du système GNU /Linux.

Pour le guide d'installation, voir :

  * Debian GNU/Linux : guide d'installation pour le système stable

  * Debian GNU/Linux : guide d'installation pour la version en cours
    de test

1. Clause de non responsabilité

    Toute garantie est rejetée. Toutes les marques déposées sont la
    propriété de leurs détenteurs respectifs.

    Le système Debian lui-même est une cible mouvante. Cela rend
    difficile le maintien à jour et l’exactitude de sa documentation.
    Bien que la version instable (« unstable ») du système Debian ait
    été utilisée pour écrire ce document, certaines parties peuvent
    être dépassées au moment où vous lisez cela.

    Veuillez prendre ce document comme une référence secondaire. Ce
    document ne remplace aucun des guides autorisés. L’auteur et les
    contributeurs ne pourront être tenus pour responsables des
    conséquences des erreurs, omissions ou ambiguïtés que comporte ce
    document.

2. Ce qu’est Debian

    Le Projet Debian est une association de personnes qui ont fait
    cause commune afin de créer un système d’exploitation libre. Sa
    distribution est caractérisée par :

      * un engagement dans la liberté du logiciel : Le contrat social
        Debian et les Lignes directrices du logiciel libre selon
        Debian (DFSG) ;

      * Bénévolat non rémunéré distribué sur Internet

      * Grand nombre de logiciels pré-compilés de haute qualité

      * l’accent sur la stabilité et la sécurité avec un accès facile
        aux mises à jour de sécurité ;

      * Accent mis sur une mise à niveau en douceur vers les
        dernières versions des logiciels par l’utilisation des
        archives unstable et testing

      * la prise en charge d’un grand nombre d’architectures
        matérielles.

    Les éléments des logiciels libres de Debian proviennent de GNU,
    Linux, BSD, X, ISC, Apache, Ghostscript, Common UNIX Printing
    System , Samba, GNOME, KDE, Mozilla, LibreOffice.org, Vim, TeX,
    LaTeX, DocBook, Perl, Python, Tcl, Java, Ruby, PHP, Berkeley DB,
    MariaDB, PostgreSQL, Exim, Postfix, Mutt, FreeBSD, OpenBSD, Plan
    9 et de nombreux autres projets de logiciels libres indépendants.
    Debian intègre cette diversité de logiciels libres dans un seul
    système.

3. À propos de ce document

3.1. Règles

    Les règles suivantes ont été suivies lors de la compilation de ce
    document.

      * fournir un aperçu et passer les cas marginaux (vue d’ensemble
        ) ;

      * le garder court et simple (KISS) ;

      * ne pas réinventer la roue (utiliser des liens pointant vers 
        les références existantes) ;

      * mettre l’accent sur les outils n’ayant pas d’interface
        graphique ou en mode console (utiliser des exemples en ligne
        de commande) ;

      * Soyez objectif (Utilisez popcon, etc.)

    Astuce
   
    J’ai essayé d’éclaircir les aspects hiérarchiques et les niveaux
    les plus bas du système.

%

3.2. Exigences de départ

    Avertissement

    On attend de vous que vous fassiez des efforts pour rechercher
    des réponses par vous-même au-delà de cette documentation. Ce
    document ne donne que des points de départs efficaces.

    Vous devez chercher vous-même une solution dans les sources
    primaires.

      * Le cahier de l'administrateur Debian

      * Le site de Debian https://www.debian.org pour des
        informations générales

      * la documentation dans le répertoire « /usr/share/doc/
        <nom_paquet> » :

      * les pages de manuel (manpage) de style UNIX : « dpkg -L
        <nom_paquet> |grep '/man/man.*/' » ;

      * les pages info de style GNU : « dpkg -L <nom_paquet> |grep '/
        info/' » ;
   
      * les signalements de bogues : http://bugs.debian.org/
        <nom_paquet> ;

      * Le Wiki Debian en https://wiki.debian.org/ pour les sujets
        spécifiques ou changeants

      * les HOWTOs du projet de documentation Linux (TLDP) en http://
        tldp.org/

      * « The Single UNIX Specification » depuis la page d’entrée
        « The UNIX System » de l’Open Group en http://www.unix.org/ ;

      * L’encyclopédie libre de Wikipedia à http://www.wikipedia.org/

    Note

    Pour accéder à une documentation détaillée, vous devrez installer
    les paquets de documentation qui correspondent au nom du paquet
    avec le suffixe « -doc ».

%

3.3. Conventions

    Ce document fournit des informations en utilisant le style de
    présentation simplifié suivant, avec des exemples de commandes de
    l’interpréteur bash(1).

    # <commande avec le compte root>
    $ <commande avec le compte d'un utilisateur>

    Ces invites de l’interpréteur de commandes permettent de
    distinguer le compte utilisé et correspondent à la définition des
    variables d’environnement « PS1='\$' » et « PS2=' ' ». Ces
    valeurs ont été choisies pour ce document dans un but de
    lisibilité, elles ne sont pas représentatives d’un système réel.

    Note
   
    Consultez la signification des variables d’environnement « $PS1 »
    et « $PS2 » dans bash(1).

    L’action demandée à l’administrateur du système est écrite sous
    forme d’une phrase impérative, par exemple « Pressez la touche
    Entrée après la saisie de chaque chaîne de commande dans
    l’interpréteur de commandes. »

    La colonne de description ou similaire dans le tableau peut
    contenir une locution nominale selon la convention de description
    courte du paquet qui supprime les articles se trouvant en tête
    tels que  « un » et « le » (« a », « the »). Elle peut contenir
    une phrase à l’infinitif comme locution nominale sans le « to »
    de tête (NdT : en français, une phrase impérative commençant par
    un verbe à l’infinitif), suivie de la description courte de la
    commande selon la convention des pages de manuel. Cela peut
    sembler bizarre à certaines personnes mais ce sont les choix
    voulus par l’auteur afin de garder cette documentation la plus
    simple possible. Ces locutions nominales, selon cette convention
    de description courte, n’ont pas de majuscule à la première
    lettre et ne se terminent pas par un point.

    Note
   
    Les noms propres, y compris les noms de commandes, gardent leur
    casse indépendamment de l’endroit où ils se trouvent.

    Un morceau de commande cité dans le paragraphe d’un texte sera
    signalé par une police « typewriter » (machine à écrire) entre
    guillemets, comme par exemple « aptitude safe-upgrade ».

    Les données textuelles d’un fichier de configuration citées dans
    un paragraphe seront signalées par une police de type machine à
    écrire entre guillemets, comme par exemple « deb-src ».

    Une commande sera indiquée par son nom dans la police machine à
    écrire suivi, de manière facultative, par le numéro de section de
    la page de manuel entre parenthèses, comme par exemple bash(1).
    Vous êtes encouragé à rechercher des informations complémentaires
    en entrant :

    $ man 1 bash

    Une page de manuel est indiquée par son nom dans la police
    machine à écrire suivie, entre parenthèses, du numéro de la
    section de la page de manuel, comme par exemple, sources.list (5)
    . Vous êtes encouragé à rechercher des informations
    complémentaires en entrant :

    $ man 5 sources.list

    Une page info est indiquée par un fragment entre guillemets de la
    commande correspondante dans la police machine à écrire, comme
    par exemple, « info make ». Vous êtes encouragé à rechercher des
    informations complémentaires en entrant :

    $ info make

    Un nom de fichier est indiqué par une police machine à écrire
    entre guillemets, comme par exemple, « /etc/passwd ». En ce qui
    concerne les fichiers de configuration, vous êtes encouragé à
    rechercher des informations complémentaires en entrant :

    $ sensible-pager "/etc/passwd"

    Un nom de répertoire est indiqué par la police machine à écrire
    entre guillemets, comme par exemple, « /etc/apt/ ». Vous êtes
    encouragé à explorer son contenu en tapant ce qui suit.

    $ mc "/etc/apt/"

    Un nom de paquet est indiqué par son nom dans la police machine à
    écrire, comme par exemple vim. Vous êtes encouragé à rechercher
    des informations complémentaires en entrant :

    $ dpkg -L vim
    $ apt-cache show vim
    $ aptitude show vim

    On peut indiquer l’emplacement d’une documentation par son nom de
    fichier dans la police machine à écrire entre guillemets, comme
    par exemple « /usr/share/doc/sysv-rc/README.runlevels.gz » et « /
    usr/share/doc/base-passwd/users-and-groups.html » ou par son URL,
    comme par exemple https://www.debian.org. Vous êtes encouragé à
    lire la documentation en entrant.

    $ zcat "/usr/share/doc/base-passwd/users-and-groups.txt.gz" | sensible-pager
    $ sensible-browser "/usr/share/doc/base-passwd/users-and-groups.html"
    $ sensible-browser "https://www.debian.org"

    Une variable d’environnement est indiquée par son nom précédé
    d’un « $ » dans la police machine à écrire entre guillemets,
    comme par exemple « $TERM ». Vous êtes encouragé à obtenir sa
    valeur actuelle en entrant :

    $ echo "$TERM"

%

3.4. Le concours de popularité (« popcon »)

    Les données du popcon sont présentées comme une manière objective
    de mesurer la popularité de chaque paquet. Elles sont
    téléchargées depuis 2021-01-10 06:32:17 UTC et contiennent un
    total de 197967 soumissions de rapports pour 178828 paquets
    binaires et 26 architectures.

    Note

    Vous remarquerez que l’archive amd64 unstable ne contient
    actuellement que 62716 paquets. Les données de popularité
    contiennent des rapports venant de nombreuses installations
    anciennes.

    Le numéro de « popcon », précédé par un « V: » pour « votes »,
    est calculé par « 1000 * (soumissions popcon pour le paquet
    exécuté récemment sur le PC)/(nombre total des soumissions
    popcon) ».

    Le numéro de « popcon », précédé par un « I: » pour
    « installations », est calculé par « 1000 * (soumissions popcon
    pour le paquet installé sur le PC)/(nombre total des soumissions
    popcon) ».

    Note

    Les données numériques de popcon ne doivent pas être considérées
    comme des mesures absolues de l’importance des paquets. Il y a de
    nombreux facteurs qui peuvent fausser les statistiques. Par
    exemple, certains systèmes participant au popcon ont monté des
    répertoires tels que « /bin » avec l’option « noatime » afin
    d’améliorer les performances du système et ont, de ce fait,
    désactivé le « vote » de tels systèmes.

%

3.5. Taille du paquet

    Les données correspondant à la taille du paquet sont aussi
    présentées comme une mesure objective de chacun des paquets.
    Elles sont basées sur « Installed-Size: » (« taille installée »)
    indiquée par la commande « apt-cache show » ou « aptitude show  »
    (actuellement sur l’architecture amd64 et pour la version
    unstable). La taille est indiquée en Kio (kibioctet = unité pour
    1024 octets).

    Note

    Si un paquet a une taille de faible valeur numérique, cela peut
    vouloir dire que le paquet de la version unstable est un paquet
    « dummy » qui permet l’installation par dépendances d’autres
    paquets ayant un contenu significatif. Un paquet dummy permet une
    transition en douceur ou un éclatement du paquet.

    Note

    Une taille de paquet suivie de « (*) » indique que la version
    unstable du paquet est absente et que la taille du paquet venant
    de la version experimental a été utilisée en remplacement.

%

3.6. Signalements de bogues concernant ce document

    Si vous découvrez des problèmes dans ce document, veuillez
    signaler les bogues du paquet debian-reference en utilisant 
    reportbug(1). Veuillez inclure des suggestions de correction en
    lançant « diff -u » sur la version en texte brut ou sur le
    source.

%

4. Rappels pour les nouveaux utilisateurs

    Voici quelques rappels pour les nouveaux utilisateurs :

      * Sauvegardez vos données

      * Sécurisez votre mot de passe et vos clés de sécurité

      * KISS (keep it simple stupid)

          + Ne modifiez pas trop votre système

      * Lire vos fichiers journaux

          + La PREMIÈRE erreur est celle qui compte

      * LLSM (Lisez Le Super Manuel)

      * Faîtes une recherche sur Internet avant de poser des
        questions

      * N'utilisez pas le compte root quand cela n'est pas nécessaire

      * Ne modifiez pas le système de gestion des paquets

      * Ne tapez rien que vous ne compreniez pas.

      * Ne modifiez pas les permissions des fichiers (avant un examen
        complet de la sécurité)

      * Ne pas quitter l'interpréteur root avant de TESTER les
        modifications.

      * Ayez toujours un support d’amorçage alternatif (clé USB, CD,
        …)

%

5. Quelques citations pour les nouveaux utilisateurs

    Voici quelques citations intéressantes provenant de la liste de
    diffusion Debian qui pourraient aider les nouveaux utilisateurs à
    y voir plus clair.

      * « This is UNIX. It gives you enough rope to hang yourself. »
        --- Miquel van Smoorenburg <miquels@cistron.nl> (C’est UNIX.
        Il vous donne assez de corde pour vous pendre vous-même).
   
      * « UNIX IS user friendly... It's just selective about who its
        friends are. » --- Tollef Fog Heen <tollef@add.no> (UNIX est
        l’ami de l’utilisateur… Il choisit juste qui sont ses amis).

    L’article Wikipédia « Philosophie d’Unix » contient une liste de
    citations intéressantes.

Chapitre 1. Didacticiels GNU/Linux

    Je pense qu’apprendre un système d’exploitation est comme
    apprendre une nouvelle langue étrangère. Bien que les livres de
    didacticiels et de documentation soient utiles, vous devrez
    pratiquer vous-même. Pour vous aider à vous lancer en douceur, je
    vais développer quelques points fondamentaux.

    La puissance de la conception de Debian GNU/Linux vient du
    système d’exploitation UNIX, c’est-à-dire un système
    d’exploitation multi-utilisateurs, multi-tâches. Vous devrez
    apprendre à tirer parti de la puissance de ces fonctionnalités et
    des similitudes entre UNIX et GNU/Linux.

    N’écartez pas des textes orientés UNIX en ne vous reposant que
    sur les textes GNU/Linux, cela vous priverait de beaucoup
    d’informations utiles.

    Note

    Si vous avez utilisé pendant un certain temps des systèmes
    ressemblant à UNIX avec des outils en ligne de commande, vous
    connaissez sans doute tout ce que j’explique ici. Vous pourrez
    utiliser ce document pour actualiser vos connaissances.

1.1. Bases pour la console

%

1.1.1. L’invite de l’interpréteur de commandes

    Au démarrage du système, si vous n’avez pas installé le système X
    Window avec un gestionnaire d’affichage tel que gdm3, un écran
    d’identification en mode caractères vous est présenté. Supposons
    que le nom d’hôte de votre machine soit toto, l’invite
    d’identification ressemblera alors à ceci :

    toto login :

    Si vous avez installé un environnement graphique (GUI) tel que
    GNOME ou KDE, vous pouvez alors obtenir une telle invite
    d’identification par Ctrl-Alt-F1, vous pourrez ensuite revenir à
    l’environnement graphique par Alt-F7 (consultez Section 1.1.6,
    « Consoles virtuelles » ci-dessous pour davantage
    d’informations).

    À l’invite d’identification, entrez votre nom d’utilisateur, par
    exemple pingouin, et pressez la touche Entrée, entrez ensuite
    votre mot de passe et pressez de nouveau la touche Entrée.

    Note

    Conformément à la tradition UNIX, l’identifiant de l’utilisateur
    et le mot de passe sur un système Debian sont sensibles à la
    casse. L’identifiant de l’utilisateur est habituellement choisi
    uniquement en minuscules. Le premier compte d’utilisateur est
    normalement créé lors de l’installation. Des comptes
    d’utilisateurs supplémentaires peuvent être créés avec la
    commande adduser(8) par l’administrateur (root).

    Le système démarre avec le message de bienvenue qui se trouve
    dans « /etc/motd » (Message du jour : « Message Of The Day ») et
    présente une invite de commande comme :

    Debian GNU/Linux jessie/sid toto tty1
    toto login: pingouin
    Password:
    Last login: Mon Sep 23 19:36:44 JST 2013 on tty3
    Linux snoopy 3.11-1-amd64 #1 SMP Debian 3.11.6-2 (2013-11-01) x86_64

    The programs included with the Debian GNU/Linux system are free software;
    the exact distribution terms for each program are described in the
    individual files in /usr/share/doc/*/copyright.

    Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
    permitted by applicable law.
    toto:~$

    Vous êtes maintenant sous l’interpréteur de commandes
    (« shell »). Le shell interprète vos commandes.

%

1.1.2. Invite de l’interpréteur de commandes sous X

    Si, lors de l’installation, vous avez installé, avec le système X
    Window, un gestionnaire graphique de session tel que gdm3 de
    GNOME en sélectionnant la tâche « Environnement de bureau », un
    écran d’identification graphique vous sera présenté au démarrage
    de votre système. Entrez votre nom d’utilisateur et votre mot de
    passe pour vous connecter à un compte d’utilisateur sans
    privilège. Utilisez la touche de tabulation pour passer du champ
    d’entrée de l’utilisateur à celui du mot de passe ou utilisez la
    souris et un clic-gauche.

    Sous X, vous pouvez obtenir une invite de l’interpréteur de
    commandes en lançant un programme d’émulation de terminal-x comme
    gnome-terminal(1), rxvt(1) ou xterm(1). Sous l’environnement de
    bureau GNOME, il suffit de cliquer « Applications » →
    « Accessoires » → « Terminal ».

    Vous pouvez aussi consulter la Section 1.1.6, « Consoles
    virtuelles » ci-dessous.

    Sous d’autres environnements de bureau (comme fluxbox), il peut
    ne pas y avoir de point d’accès évident au menu. Si cela se
    produit, essayez simplement de faire un clic-droit sur le fond
    d’écran de l’environnement de bureau en espérant voir apparaître
    un menu.

%

1.1.3. Compte de l’administrateur (root)

    Le compte de l’administrateur (root) est encore appelé
    superutilisateur ou utilisateur privilégié. Depuis ce compte,
    vous pouvez effectuer les opérations d’administration du système
    suivantes :

      * lire, écrire et effacer n’importe quel fichier du système
        quelles que soient ses permissions ;

      * Défini l'appartenance et les permissions de n’importe quel
        fichier du système

      * définir le mot de passe de n’importe quel utilisateur
        non-privilégié du système ;

      * vous connecter à n’importe quel compte sans mot de passe.

    La puissance illimitée du compte de l’administrateur fait que
    vous devez être attentif et responsable lorsque vous l’utilisez.

    Avertissement
   
    Ne donnez jamais le mot de passe de l’administrateur à d’autres
    personnes.

    Note

    Les permissions d’un fichier (y compris les fichiers de
    périphériques tels que les CD-ROM ou autres, qui ne sont que des
    fichiers parmi d’autres pour le système Debian) peuvent le rendre
    inutilisable ou inaccessible à des utilisateurs autres que
    l’administrateur. Bien que l’utilisation du compte de
    l’administrateur soit un moyen rapide de test dans une telle
    situation, sa résolution devra être effectuée en définissant
    correctement les droits de fichiers et les membres des groupes
    d’utilisateurs (consultez Section 1.2.3, « Permissions du système
    de fichiers »).

%

1.1.4. Invite de l’interpréteur de commandes pour l’administrateur

    Voici quelques méthodes de base pour obtenir l’invite de
    l’interpréteur de commande de l’administrateur en utilisant le
    mot de passe de « root » .

      * entrez root à l’invite de connexion en mode caractère ;

      * sous l’environnement de bureau GNOME, cliquez
        « Applications » → « Accessoires » → « Terminal
        administrateur » ;

      * entrez « su -l » depuis une invite quelconque de
        l’interpréteur de commandes ;
   
          + cela ne préserve pas l’environnement de l’utilisateur
            actuel ;

      * entrez « su » depuis une invite quelconque de l’interpréteur
        de commandes ;

          + cela préserve une partie de l’environnement de
            l’utilisateur actuel.

%

1.1.5. Outils graphiques d’administration du système

    Lorsque le menu de votre environnement de bureau ne démarre pas
    automatiquement, avec les droits appropriés, l’interface
    graphique des outils d’administration du système, vous pouvez les
    démarrer depuis l’invite de l’interpréteur du compte de
    l’administrateur dans un émulateur de terminal X, tel que 
    gnome-terminal(1), rxvt(1) ou xterm(1). Consultez Section 1.1.4,
    « Invite de l’interpréteur de commandes pour l’administrateur »
    et Section 7.8.5, « Faire tourner X avec le compte de
    l’administrateur ».

    Avertissement

    Ne jamais lancer un affichage X ou un gestionnaire de session
    avec le compte de l’administrateur en entrant root à l’invite
    d’un gestionnaire d’écran tel que gdm3(1).

    Avertissement

    Ne jamais faire tourner de programme distant non sûrs avec une
    interface graphique sous X Window lorsque des informations
    critiques sont affichées parce que votre écran X peut être
    espionné.

%

1.1.6. Consoles virtuelles

    Il y a, dans le système Debian par défaut, six consoles
    commutables en mode caractères de type VT100 disponibles pour
    lancer directement l’interpréteur de commandes sur la machine
    Linux. À moins que vous ne disposiez d’un environnement
    graphique, vous pouvez basculer entre les consoles virtuelles en
    pressant la touche Alt de gauche et, simultanément, l’une des
    touches F1 à F6. Chaque console en mode caractères permet de se
    connecter de manière indépendante à un compte et offre un
    environnement multi-utilisateurs. Cet environnement
    multi-utilisateurs est une fonctionnalité intéressante d’UNIX,
    très vite, on ne peut plus s’en passer.

    Depuis le système X Window, vous avez accès à la console 1 en
    pressant la combinaison de touches Ctrl-Alt-F1, c’est-à-dire que
    la touche Ctrl de gauche, la touche Alt de gauche et la touche F1
    sont pressées simultanément. Vous pouvez revenir au système X
    Window, qui tourne normalement sur la console virtuelle 7, en
    pressant Alt-F7.

    Vous pouvez aussi changer de console virtuelle, par exemple pour
    la console 1, par la commande :

    # chvt 1

%

1.1.7. Comment quitter l’invite de l’interpréteur de commandes

    Pour arrêter l’activité de l’interpréteur de commandes, entrez
    Ctrl-D, c’est-à-dire la touche Ctrl de gauche et la touche d
    pressées simultanément, à l’invite de l’interpréteur. Si vous
    êtes sur une console en mode caractères, cela vous fera retourner
    alors à l’invite d’identification. Même si on se réfère à ces
    caractères de commande avec « control D » en majuscule, il n’est
    pas nécessaire de presser la touche majuscule. Le raccourci ^D,
    est aussi utilisé pour Ctrl-D. Vous pouvez aussi entrer « exit ».

    Si vous êtes sur un émulateur de x-terminal(1), vous pouvez
    fermer la fenêtre de l’émulateur de terminal-x de la même
    manière.

%

1.1.8. Comment arrêter le système

    Comme tout autre système d’exploitation moderne où les opérations
    sur les fichiers mettent en œuvre un cache de données en mémoire
    afin d’améliorer les performances, le système Debian demande que
    l’on exécute une procédure d’arrêt adaptée avant que le système
    ne puisse être mis hors tension. Cela permet de maintenir
    l’intégrité des fichiers, en forçant l’écriture sur disque de
    toutes les informations conservées en mémoire. Si un logiciel de
    contrôle de l’alimentation est disponible, la procédure d’arrêt
    coupera automatiquement l’alimentation du système. (Sinon, vous
    devrez presser le bouton d’alimentation pendant quelques secondes
    une fois la procédure d’arrêt terminée).

    Dans le mode normal multi-utilisateurs, vous pouvez arrêter le
    système depuis la ligne de commandes :

    # shutdown -h now

    Dans le mode normal mono-utilisateur, vous pouvez arrêter le
    système depuis la ligne de commandes :

    # poweroff -i -f

    Pour arrêter le système, vous pouvez aussi utiliser
    Ctrl-Alt-Suppr (la touche Ctrl de gauche, la touche Alt de gauche
    et la touche Suppr pressées simultanément) si la ligne
    ca:12345:ctrlaltdel:/sbin/shutdown -t1 -a -h now » se trouve dans
    le fichier « /etc/inittab ». Consultez inittab(5) pour davantage
    d’informations.

    Consultez Section 6.9.6, « Comment arrêter le système distant par
    SSH ».

%

1.1.9. Récupérer une console propre

    Lorsque l’écran est corrompu après que vous ayez fait des choses
    amusantes comme « cat <un-fichier-binaire> » entrez « reset » à
    l’invite de commande. Il est possible que vous ne voyiez pas ce
    que vous entrez. Vous pouvez aussi entrer « clear » pour nettoyer
    l’écran.

%

1.1.10. Suggestions de paquets supplémentaires pour le débutant

    Bien que même une installation minimale du système Debian sans
    aucune tâche d’environnement de bureau fournisse les
    fonctionnalités UNIX de base, c’est une bonne idée pour les
    débutants d’installer pour commencer quelques paquets de ligne de
    commandes ou de terminal en mode caractères basé sur « curses »
    comme mc et vim avec apt-get(8) en utilisant les commandes
    suivantes :

    # apt-get update
     ...
    # apt-get install mc vim sudo
     ...

    Si vous avez déjà installé ces paquets, aucun nouveau paquet ne
    sera installé.

    Tableau 1.1. Liste de paquets de programmes intéressants en mode
    texte

    +---------------------------------------------------------------+
    | paquet  |popcon|taille|              description              |
    |---------+------+------+---------------------------------------|
    |mc       |V:59, |1482  |gestionnaire de fichiers plein écran en|
    |         |I:236 |      |mode texte                             |
    |---------+------+------+---------------------------------------|
    |sudo     |V:563,|4555  |programme donnant aux utilisateurs des |
    |         |I:806 |      |privilèges d’administration limités    |
    |---------+------+------+---------------------------------------|
    |         |V:106,|      |éditeur de texte UNIX Vi amélioré (Vi  |
    |vim      |I:398 |3231  |IMproved), éditeur de texte pour       |
    |         |      |      |programmeurs (version standard)        |
    |---------+------+------+---------------------------------------|
    |         |V:62, |      |éditeur de texte UNIX Vi amélioré (Vi  |
    |vim-tiny |I:970 |1553  |IMproved), éditeur de texte pour       |
    |         |      |      |programmeurs (version compacte)        |
    |---------+------+------+---------------------------------------|
    |emacs-nox|V:4,  |18364 |GNU Emacs, éditeur de texte extensible |
    |         |I:17  |      |basé sur Lisp                          |
    |---------+------+------+---------------------------------------|
    |w3m      |V:31, |2289  |navigateurs WWW en mode texte          |
    |         |I:284 |      |                                       |
    |---------+------+------+---------------------------------------|
    |gpm      |V:11, |530   |couper-coller à la mode UNIX sur une   |
    |         |I:17  |      |console texte (démon)                  |
    +---------------------------------------------------------------+


    Ce peut être une bonne idée de lire quelques documentations.

    Tableau 1.2. Liste de paquets de documentation

    +---------------------------------------------------------------+
    |       paquet       |popcon|taille|        description         |
    |--------------------+------+------+----------------------------|
    |                    |      |      |projet de documentation     |
    |doc-debian          |I:854 |166   |Debian, (FAQ Debian) et     |
    |                    |      |      |autres documents            |
    |--------------------+------+------+----------------------------|
    |debian-policy       |I:36  |4306  |Charte Debian et documents  |
    |                    |      |      |associés                    |
    |--------------------+------+------+----------------------------|
    |developers-reference|I:6   |1917  |Guides et informations pour |
    |                    |      |      |les responsables Debian     |
    |--------------------+------+------+----------------------------|
    |maint-guide         |I:4   |987   |Guide des nouveaux          |
    |                    |      |      |responsables Debian         |
    |--------------------+------+------+----------------------------|
    |debian-history      |I:1   |4285  |Histoire du projet Debian   |
    |--------------------+------+------+----------------------------|
    |debian-faq          |I:849 |817   |FAQ Debian                  |
    +---------------------------------------------------------------+


    Vous pouvez installer quelques-uns de ces paquets en passant les
    commandes suivantes :

    # apt-get install nom_paquet

%

1.1.11. Compte pour un utilisateur supplémentaire

    Si vous ne souhaitez pas utiliser votre compte d’utilisateur
    principal pour les activités de formation qui suivent, vous
    pouvez créer un compte de formation, par exemple poisson en
    passant la commande qui suit :

    # adduser poisson

    Répondez à toutes les questions.

    Cela va créer un nouveau compte appelé poisson. Après vos
    exercices, vous pourrez supprimer ce compte d’utilisateur et son
    répertoire personnel par :

    # deluser --remove-home poisson

%

1.1.12. Configuration de sudo

    Pour une station de travail typique avec un seul utilisateur tel
    que le système de bureau Debian sur un PC de bureau, il est
    habituel de mettre en œuvre une configuration simple de sudo(8)
    comme suit afin que l’utilisateur non privilégié, par exemple
    pingouin, puisse obtenir les privilèges d’administration avec
    simplement son mot de passe personnel et non avec le mot de passe
    de l’administrateur :

    # echo "pingouin  ALL=(ALL) ALL" >> /etc/sudoers

    Il est aussi habituel, en remplacement, de faire comme suit afin
    que l’utilisateur non privilégié, par exemple pingouin, puisse
    obtenir les privilèges d’administration sans aucun mot de passe
    personnel.

    # echo "pingouin ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers

    Cette astuce ne doit être utilisée qu’avec une station de travail
    mono-utilisateur que vous administrez et dont vous êtes le seul
    utilisateur.

    Avertissement

    Ne configurez pas de cette manière les utilisateurs normaux d’une
    station de travail multi-utilisateurs parce que cela serait très
    grave pour la sécurité du système.

    Attention

    Le mot de passe et le compte du pingouin de l’exemple précédent
    doivent bénéficier de la même protection que le mot de passe et
    le compte de l’administrateur.

    Attention

    Le privilège d’administration, dans ce contexte, appartient à
    quelqu’un autorisé à effectuer les tâches d’administration du
    système sur la station de travail. Ne jamais donner un tel
    privilège à un responsable du département administratif de votre
    entreprise ni à votre patron, à moins qu’ils n’y soient autorisés
    et en soient capables.

    Note

    Pour donner un accès privilégié à certains périphériques et
    certains fichiers, vous devriez envisager l’utilisation d’un 
    groupe donnant un accès limité plutôt que d’utiliser le privilège
    de root par l’intermédiaire de sudo(8).

    Note

    Avec une configuration plus approfondie et prudente, sudo(8) peut
    permettre à d’autres utilisateurs d’obtenir des privilèges
    limités d’administration sur un système partagé sans partager le
    mot de passe de l’administrateur. Cela peut améliorer la
    confiance sur les machines ayant plusieurs administrateurs de
    manière à ce que vous puissiez dire qui a fait quoi. D’un autre
    côté, vous ne devriez pas confier de tels privilèges à quelqu’un
    d’autre.

%

1.1.13. À vous de jouer

    Vous êtres maintenant prêt à jouer avec le système Debian, sans
    risque aussi longtemps que vous utiliserez un compte
    d’utilisateur sans privilège.

    Cela, parce que le système Debian, même après l’installation
    initiale, est configuré avec des permissions de fichiers adaptées
    qui évitent aux utilisateurs non privilégiés d’endommager le
    système. Bien entendu, il peut y avoir certaines failles qui
    peuvent être exploitées mais ceux qui s’inquiètent de ces
    problèmes ne devraient pas lire cette section mais plutôt le
    Manuel de sécurisation (« Securing Debian Manual »).

    Nous allons apprendre le système Debian en tant que système
    semblable à UNIX (« UNIX-like ») avec :

      * Section 1.2, « Système de fichiers de type UNIX » (concept de
        base) ;

      * Section 1.3, « Midnight Commander (MC) » (méthode de survie)
         ;

      * Section 1.4, « L’environnement élémentaire de travail de type
        UNIX » (méthode de base) ;

      * Section 1.5, « La commande simple de l’interpréteur de
        commandes » (mécanisme de l’interpréteur de commandes) ;

      * Section 1.6, « Traitement des données textuelles à la UNIX »
        (méthode de traitement des données textuelles).

%

1.2. Système de fichiers de type UNIX

    Avec GNU/Linux et d’autres systèmes d’exploitation semblables à
    UNIX, les fichiers sont organisés en répertoires. Tous les
    fichiers et les répertoires sont disposés sous forme d’une grosse
    arborescence ancrée sur « / ». On l’appelle un arbre parce que si
    vous dessinez le système de fichiers, il ressemble à un arbre qui
    se trouverait disposé la tête en bas.

    Ces fichiers et répertoires peuvent être répartis sur plusieurs
    périphériques. La commande mount(8) sert à attacher les systèmes
    de fichiers se trouvant sur certains périphériques à la grosse
    arborescence des fichiers. À l’opposé, la commande umount(8) les
    détachera de nouveau. Avec les noyaux Linux récents, mount(8)
    avec certaines options peut lier une partie d’une arborescence de
    fichiers à un autre emplacement ou peut monter un système de
    fichiers de manière partagée, privée, esclave ou « non-liable ».
    Vous trouverez les options de montage prises en compte par chaque
    système de fichiers dans « /usr/share/doc/linux-doc-*/
    Documentation/filesystems/ ».

    Les répertoires d’un système UNIX sont appelés dossiers sur
    d’autres systèmes. Vous remarquez aussi qu’il n’y a, sur aucun
    système UNIX, de concept de lecteur tel que « A: ». Il y a un
    système de fichiers qui comprend tout. C’est un gros avantage
    comparé à Windows.

%

1.2.1. Bases concernant les fichiers UNIX

    Voici les bases des fichiers UNIX :

      * les noms de fichiers sont sensibles à la casse. Ce qui veut
        dire que « MONFICHIER » et « MonFichier » sont des fichiers
        différents ;

      * on se réfère au répertoire racine (« root directory »), qui
        est la racine du système de fichiers, simplement par « / ».
        Ne pas le confondre avec le répertoire personnel de
        l’utilisateur root : « /root » ;

      * un nom de répertoire peut être constitué de n’importe quelle
        lettre ou symbole sauf « / ». Le répertoire racine est une
        exception, son nom est « / » (prononcé « slash » ou « le
        répertoire racine »), il ne peut pas être renommé ;

      * chaque fichier ou répertoire est désigné par un nom de
        fichier entièrement qualifié, nom de fichier absolu ou chemin
        , indiquant la séquence de répertoires que l’on doit
        traverser pour l’atteindre. Les trois expressions sont
        synonymes ;

      * tous les noms de fichiers entièrement qualifiés commencent
        par le répertoire « / » et il y a un / » entre chaque
        répertoire ou fichier dans le nom du fichier. Le premier « /
         » est le répertoire de plus haut niveau, et les autres « / »
        séparent les sous-répertoires successifs jusqu’à ce que l’on
        atteigne la dernière entrée qui est le nom fichier proprement
        dit. Les mots utilisés ici peuvent être source de confusion.
        Prenez comme exemple le nom pleinement qualifié suivant : « /
        usr/share/keytables/us.map.gz ». Cependant, les gens
        utiliseront souvent son nom de base « us.map.gz » seul comme
        nom de fichier ;

      * le répertoire racine comporte de nombreuses branches, telles
        que « /etc/ » et « /usr/ ». Ces sous-répertoires se
        décomposent eux-mêmes en d’autres sous-répertoires comme « /
        etc/init.d/ » et « /usr/local/ ». L’ensemble de la chose, vu
        globalement, s’appelle l’arborescence des répertoires. Vous
        pouvez imaginer un nom de fichier absolu comme une route
        partant de la base de l’arbre (« / ») jusqu’à l’extrémité de
        certaines branches (le fichier). Vous entendrez aussi
        certains parler de l’arborescence des répertoires comme d’un
        arbre généalogique englobant tous les descendants directs
        d’un seul personnage appelé le répertoire racine (« / ») :
        les sous-répertoires ont alors des parents et un chemin
        montre l’ascendance complète d’un fichier. Il y a aussi des
        chemins relatifs qui commencent quelque part ailleurs qu’au
        niveau du répertoire racine. Il faut vous souvenir que le
        répertoire « ../ » indique le répertoire parent. Cette
        terminologie s’applique de la même manière aux autres
        structures ressemblant aux répertoires comme les structures
        de données hiérarchiques ;

      * il n’y a pas de chemin de répertoire spécial correspondant à
        un périphérique physique tel que votre disque dur. C’est
        différent de RT-11, CP/M, OpenVMS, MS-DOS, AmigaOS et
        Microsoft Windows, où le chemin comporte le nom du
        périphérique comme « C:\ ». (Il existe cependant des entrées
        de répertoire qui font référence aux périphériques physiques
        en tant qu’élément du système de fichiers normal. Consultez
        Section 1.2.2, « Fonctionnement interne du système de
        fichiers »).

    Note

    Bien que vous puissiez utiliser la plupart des lettres ou
    symboles dans un nom de fichier, c’est en pratique un mauvaise
    idée de le faire. Il est préférable d’éviter tous les caractères
    qui ont une signification particulière sur la ligne de commandes,
    comme les espaces, tabulations, sauts de ligne, et autres
    caractères spéciaux : { } ( ) [ ] ' ` " \ / > < | ; ! # & ^ * % @
    $. Si vous voulez séparer des mots dans un nom, de bons choix
    sont le point, le tiret et le tiret souligné. Vous pouvez aussi
    mettre une majuscule en tête de chaque mot « CommeCeci ». Les
    utilisateurs Linux expérimentés on tendance à aussi à éviter les
    espaces dans les noms de fichiers.

    Note

    Le mot « root » signifie soit « utilisateur root », soit
    « répertoire root » Le contexte de son utilisation devrait
    permettre de les distinguer.

    Note

    Le mot chemin (« path ») n’est pas utilisé que pour les noms de
    fichiers entièrement qualifiés comme ci-dessus mais aussi pour le
    chemin de recherche des commandes. La signification voulue est
    habituellement claire selon le contexte.

    Les meilleures façons de faire en ce qui concerne la hiérarchie
    des fichiers sont détaillées dans la « norme de hiérarchie du
    système de fichiers » (« Filesystem Hierarchy Standard ») (« /usr
    /share/doc/debian-policy/fhs/fhs-2.3.txt.gz » et hier(7)). Vous
    devriez, pour commencer, mémoriser les éléments suivants :

    Tableau 1.3. Utilisation des répertoires-clés

    +---------------------------------------------------------------+
    |répertoire|             utilisation du répertoire              |
    |----------+----------------------------------------------------|
    |/         |répertoire racine                                   |
    |----------+----------------------------------------------------|
    |/etc/     |fichiers de configuration valables pour l’ensemble  |
    |          |du système                                          |
    |----------+----------------------------------------------------|
    |/var/log/ |fichiers journaux du système                        |
    |----------+----------------------------------------------------|
    |/home/    |tous les répertoires personnels des utilisateurs non|
    |          |privilégiés                                         |
    +---------------------------------------------------------------+


%

1.2.2. Fonctionnement interne du système de fichiers

    En suivant la tradition UNIX, le système Debian GNU/Linux fournit
    un système de fichiers où les données physiques se trouvent sur
    des disques durs et d’autres périphériques de stockage et où les
    interaction avec les périphériques physiques tels que les écrans
    de console et les consoles distantes connectées en séries sont
    représentées de manière unifiée dans « /dev/ ».

    Chaque fichier, répertoire, tube nommé (une manière pour les
    programmes de partager des données) ou périphérique physique sur
    un système Debian GNU/Linux possède une structure de données
    appelée inœud (« inode ») qui décrit les attributs qui lui sont
    associés comme l’utilisateur qui le possède (propriétaire), le
    groupe auquel il appartient, l’heure de dernier accès, etc.
    L’idée de pouvoir presque tout représenter dans le système de
    fichiers était une innovation d’UNIX, et les noyaux modernes de
    Linux ont encore développé plus loin cette idée. À l’heure
    actuelle, même les informations concernant les processus qui
    tournent sur le système se trouvent sur le système de fichiers.

    Cette représentation abstraite et unifiée des entités physiques
    et des processus internes est très puissante puisque cela nous
    permet d’utiliser la même commande pour le même type d’opération
    sur des périphériques complètement différents. Il est même
    possible de changer la manière dont fonctionne le noyau en
    écrivant des données dans des fichiers spéciaux liés aux
    processus en cours d’exécution.

    Astuce

    Si vous avez besoin de connaître la correspondance entre une
    arborescence de fichiers et un périphérique physique, lancez la
    commande mount(8) sans paramètre.

%

1.2.3. Permissions du système de fichiers

    Les permissions du système de fichiers d’un système basé sur UNIX
    sont définies pour trois catégories d’utilisateurs :

      * l’utilisateur qui possède le fichier (u) ;

      * les autres utilisateurs du groupe à qui appartient le fichier
        (g) ;

      * tous les autres utilisateurs (o) dont on parle aussi en tant
        que « monde entier » ou « tout le monde ».

    Pour les fichiers, chaque permission correspondante permet les
    actions suivantes :

      * la permission en lecture (r) permet à son propriétaire de
        voir le contenu du fichier ;

      * la permission en écriture (w) permet à son propriétaire de
        modifier le fichier ;

      * la permission d’exécution (x) permet à son propriétaire de
        lancer le fichier comme une commande.

    Pour les répertoires, chaque permission correspondante permet les
    actions suivantes :

      * la permission en lecture (r) permet à son propriétaire
        d’afficher le contenu du répertoire ;

      * la permission en écriture (w) permet à son propriétaire
        d’ajouter ou supprimer des fichiers de ce répertoires ;

      * la permission d’exécution (x) permet à son propriétaire
        d’accéder aux fichiers du répertoire.

    Ici, la permission en exécution sur un répertoire ne signifie pas
    uniquement l’autorisation de lire des fichiers dans ce répertoire
    mais aussi l’autorisation de voir leurs attributs, tels que leur
    taille et l’heure de modification.

    ls(1) est utilisé pour afficher les informations de permissions
    (et davantage) des fichiers et répertoires. Lorsque cette
    commande est passée avec l’option « -l », elle affiche les
    informations suivantes dans l’ordre donné :

      * type de fichier (premier caractère) ;

      * autorisation d’accès au fichier (neuf caractères, constitués
        de trois caractères pour l’utilisateur, le groupe et « les
        autres », dans cet ordre) ;

      * nombre de liens physiques vers le fichier ;

      * nom de l’utilisateur propriétaire du fichier ;

      * nom du groupe à qui appartient le fichier ;

      * taille du fichier en caractères (octets) ;

      * date et heure du fichier (mtime) ;

      * nom du fichier.

    Tableau 1.4. Liste des premiers caractères de la sortie de « ls
    -l » :

    +------------------------------------------------+
    |caractère|            signification             |
    |---------+--------------------------------------|
    |-        |fichier normal                        |
    |---------+--------------------------------------|
    |d        |répertoire                            |
    |---------+--------------------------------------|
    |l        |lien symbolique                       |
    |---------+--------------------------------------|
    |c        |nœud de périphérique en mode caractère|
    |---------+--------------------------------------|
    |b        |nœud de périphérique en mode bloc     |
    |---------+--------------------------------------|
    |p        |tube nommé                            |
    |---------+--------------------------------------|
    |s        |socket                                |
    +------------------------------------------------+


    chown(1) est utilisé depuis le compte de l’administrateur pour
    modifier le propriétaire d’un fichier. chgrp(1) est utilisé
    depuis le compte du propriétaire du fichier ou de
    l’administrateur pour changer le groupe du fichier. chmod(1) est
    utilisé depuis le compte du propriétaire du fichier ou de
    l’administrateur pour changer les droits d’accès à un fichier ou
    un répertoire. La syntaxe de base pour manipuler le fichier toto
    est la suivante :

    # chown <nouvel_utilisateur> toto
    # chgrp <nouveau_groupe> toto
    # chmod  [ugoa][+-=][rwxXst][,...] toto

    Vous pouvez, par exemple, faire qu’une arborescence de
    répertoires soit la propriété de l’utilisateur toto et partagée
    par le groupe titi en faisant ce qui suit :

    # cd /un/emplacement/
    # chown -R toto:titi .
    # chmod -R ug+rwX,o=rX .

    Il existe trois bits qui donnent des permissions particulières :

      * le bit set user ID (s ou S situé à la place du x) de
        l’utilisateur ;

      * le bit set group ID (s ou S situé à la place du x) du
        groupe ;

      * le bit collant « sticky bit » (t ou T situé à la place du x)
        des « autres ».

    Ici la sortie de « ls -l » avec ces bits est en majuscules si les
    bits d’exécution cachés par ces sorties ne sont pas positionnés.

    Définir set user ID sur un fichier exécutable permet à un
    utilisateur d’exécuter les fichiers avec l’identifiant du
    propriétaire du fichier (par exemple root). De la même manière,
    définir set group ID sur un fichier exécutable permet d’exécuter
    le fichier avec l’identifiant de groupe du fichier (par exemple 
    root). Parce que ces positionnements de bits peuvent créer des
    risques de sécurité, il ne faut les activer qu’avec des
    précautions extrêmes.

    Définir set group ID sur un répertoire permet la création de
    fichiers à la BSD où tous les fichiers créés dans un répertoire
    appartiennent au groupe du répertoire.

    Positionner le sticky bit d’un répertoire empêche un fichier de
    ce répertoire d’être supprimé par un utilisateur qui n’est pas le
    propriétaire du fichier. Pour sécuriser le contenu d’un fichier
    dans des répertoires pouvant être écrits par tout le monde tels
    que « /tmp » ou dans des répertoires pouvant être écrits par le
    groupe, il ne faut pas uniquement supprimer la permission du
    fichier en écriture mais aussi positionner le sticky bit sur le
    répertoire. Sinon, le fichier pourra être supprimé et un nouveau
    fichier créé avec le même nom par un utilisateur quelconque ayant
    accès en écriture au répertoire.

    Voici quelques exemples intéressants de permissions de fichiers.

    $ ls -l /etc/passwd /etc/shadow /dev/ppp /usr/sbin/exim4
    crw------- 1 root root   108, 0 oct.  20 07:12 /dev/ppp
    -rw-r--r-- 1 root root     2718 oct.   5 22:09 /etc/passwd
    -rw-r----- 1 root shadow   1741 oct.   5 22:09 /etc/shadow
    -rwsr-xr-x 1 root root   973824 sept. 23 07:04 /usr/sbin/exim4
    $ ls -ld /tmp /var/tmp /usr/local /var/mail /usr/src
    drwxrwxrwt 17 root root  102400 oct.  20 16:42 /tmp
    drwxrwsr-x 10 root staff   4096 nov.  29  2011 /usr/local
    drwxr-xr-x 13 root root    4096 sept. 30 11:24 /usr/src
    drwxrwsr-x  2 root mail    4096 sept. 27 11:07 /var/mail
    drwxrwxrwt  5 root root    4096 oct.  20 09:14 /var/tmp

    Il existe aussi un mode numérique pour décrire les permissions
    des fichiers avec chmod(1). Ce mode numérique utilise des nombres
    en base 8 (radix=8) codés sur 3 ou 4 chiffres.

    Tableau 1.5. Mode numérique des permissions de fichiers dans les
    commandes chmod(1)

    +---------------------------------------------------------------+
    |  chiffre   |                  signification                   |
    |------------+--------------------------------------------------|
    |1er chiffre |somme de set user ID (=4), set group ID (=2), et  |
    |optionnel   |sticky bit (=1)                                   |
    |------------+--------------------------------------------------|
    |2ème chiffre|somme des permissions de lecture (=4), écriture (=|
    |            |2), et exécution (=1) pour l’utilisateur          |
    |------------+--------------------------------------------------|
    |3ème chiffre|identique pour groupe                             |
    |------------+--------------------------------------------------|
    |4ème chiffre|identique pour autres                             |
    +---------------------------------------------------------------+


    Cela peut sembler compliqué mais c’est en fait assez simple. Si
    vous regardez les quelques premières colonnes (2-10) de la sortie
    de la commande « ls -l » et que vous lisez en représentation
    binaire (base 2) les permissions des fichiers (le « - »
    représentant « 0 » et « rwx » représentant « 1 »), les trois
    derniers chiffres de la valeur numérique du mode devraient vous
    donner la représentation des permissions du fichier en octal
    (base 8).

    Essayez, par exemple, ce qui suit :

    $ touch toto titi
    $ chmod u=rw,go=r toto
    $ chmod 644 titi
    $ ls -l toto titi
    -rw-r--r-- 1 pingouin pingouin 0 oct.  20 16:46 titi
    -rw-r--r-- 1 pingouin pingouin 0 oct.  20 16:46 toto

    Astuce

    Si vous avez besoin d’accéder aux informations affichées par « ls
    -l » depuis un script de l’interpréteur de commandes, vous devrez
    utiliser des commandes pertinentes telles que test(1), stat(1) et
    readlink(1). Vous pouvez aussi utiliser les commandes internes du
    shell, telles que « [ » ou « test ».

1.2.4. Contrôle des permissions pour les fichiers nouvellement
créés : umask

    Les permissions appliquées à un fichier ou à un répertoire venant
    d’être créé sont restreintes par la commande interne du shell
    umask. Consultez dash(1), bash(1) etbuiltins(7).

     (permissions du fichier) = (permissions demandées pour le fichier) & ~(valeur de umask)

    Tableau 1.6. Exemples de valeurs de umask

    +---------------------------------------------------------------+
    |umask|permissions des | permissions des  |     utilisation     |
    |     | fichiers créés |répertoires créés |                     |
    |-----+----------------+------------------+---------------------|
    |0022 |-rw-r--r--      |-rwxr-xr-x        |ne peut être écrit   |
    |     |                |                  |que par l’utilisateur|
    |-----+----------------+------------------+---------------------|
    |0002 |-rw-rw-r--      |-rwxrwxr-x        |peut être écrit par  |
    |     |                |                  |le groupe            |
    +---------------------------------------------------------------+


    Le système Debian utilise par défaut un schéma de groupe privé
    par utilisateur (UPG). Un UPG est créé chaque fois qu’un
    utilisateur est ajouté au système. Un UPG a le même nom que
    l’utilisateur pour lequel il a été créé et cet utilisateur est le
    seul membre de l’UPG. Un principe d’UPG rend sûr le
    positionnement de umask à 0002 car chaque utilisateur a son
    propre groupe privé. (Sur certaines variantes d’UNIX, il est
    assez courant de faire appartenir tous les utilisateurs au même
    groupe users et, dans ce cas, c’est une bonne idée de définir
    umask à 0022 pour des raisons de sécurité).

    Astuce
   
    Activez UPG en plaçant « umask 002 » dans le fichier ~/.bashrc.

%

1.2.5. Permissions pour les groupes d’utilisateurs (group)

    Afin que des permissions attribuées à un groupe soient appliquées
    à un utilisateur particulier, il faut que cet utilisateur soit
    déclaré membre du groupe à l’aide de « sudo vigr » pour /etc/
    group ou « sudo vigr -s » pour /etc/gshadow. La nouvelle
    configuration du groupe n’est effective qu’après une [re]
    connexion de l’utilisateur (ou l’exécution de « exec newgrp »).

    Note

    Vous pouvez aussi ajouter dynamiquement des utilisateurs aux
    groupes durant le processus d’authentification en ajoutant la
    ligne « auth optional pam_group.so » au fichier « /etc/pam.d/
    common-auth » et en définissant « /etc/security/group.conf »
    (consultez Chapitre 4, Authentification).

    Sous le système Debian, les périphériques ne sont qu’un autre
    type de fichier. Si vous avez des problèmes pour accéder à des
    périphériques tel qu’un CD-ROM ou une clé USB depuis le compte
    d’un utilisateur, il faudra rendre cet utilisateur membre du
    groupe concerné.

    Certains groupes importants fournis par le système permettent à
    leurs membres l’accès à des fichiers et des périphériques
    particuliers sans avoir les privilèges de l’administrateur.

    Tableau 1.7. Liste des groupes importants fournis par le système
    pour l’accès aux fichiers

    +---------------------------------------------------------------+
    |groupe | description des fichiers et périphériques accessibles |
    |-------+-------------------------------------------------------|
    |dialout|accès complet et direct aux ports série (« /dev/ttyS   |
    |       |[0-3] »)                                               |
    |-------+-------------------------------------------------------|
    |dip    |accès limité aux ports série pour une connexion «      |
    |       |Dialup IP (réseau commuté) vers des pairs de confiance |
    |-------+-------------------------------------------------------|
    |cdrom  |lecteurs et graveurs de CD-ROM, DVD+/-RW.              |
    |-------+-------------------------------------------------------|
    |audio  |périphérique audio                                     |
    |-------+-------------------------------------------------------|
    |video  |périphérique vidéo                                     |
    |-------+-------------------------------------------------------|
    |scanner|dispositifs de numérisation (scanners)                 |
    |-------+-------------------------------------------------------|
    |adm    |journaux de surveillance du système                    |
    |-------+-------------------------------------------------------|
    |staff  |quelques répertoires où effectuer du travail           |
    |       |d’administration de début : « /usr/local », « /home ». |
    +---------------------------------------------------------------+


    Astuce

    Vous devez être membre du groupe dialout pour pouvoir
    reconfigurer un modem, numéroter vers n’importe où, etc. Mais si
    l’administrateur crée dans « /etc/ppp/peers/ » des fichiers de
    configuration pour des pairs de confiance, vous ne devrez
    appartenir qu’au groupe dip pour créer une connexion commutée
    (« Dialup IP ») vers ces pairs de confiance avec commandes pppd
    (8), pon(1) et poff(1).

    Certains groupes faisant partie du système, permettent à leurs
    membres d’exécuter des commandes particulières sans les
    privilèges de l’administrateur (root).

    Tableau 1.8. Liste des groupes importants fournis par le système
    pour l’exécution de commandes particulières

    +---------------------------------------------------------------+
    |groupe |                 commandes accessibles                 |
    |-------+-------------------------------------------------------|
    |sudo   |exécuter sudo sans son mot de passe.                   |
    |-------+-------------------------------------------------------|
    |       |exécuter des commandes pour ajouter, modifier et       |
    |lpadmin|supprimer des imprimantes de la base de données des    |
    |       |imprimantes                                            |
    +---------------------------------------------------------------+


    Pour une liste complète des groupes et des utilisateurs fournis
    par le système, veuillez consulter une version récente du
    document « Utilisateurs et groupes » (« Users and Groups » se
    trouvant dans  /usr/share/doc/base-passwd/users-and-groups.html »
    qui est fourni par le paquet base-passwd.

    Consultez passwd(5), group(5), shadow(5), newgrp(1), vipw(8), 
    vigr(8) et pam_group(8) pour les commande de gestion des
    utilisateurs et des groupes du système.

%

1.2.6. Horodatage

    Il existe trois types d’horodatage pour un fichier GNU/Linux.

    Tableau 1.9. Liste des types d’horodatage

    +---------------------------------------------------+
    |type |signification (définition historique d'Unix) |
    |-----+---------------------------------------------|
    |mtime|date de modification du fichier (ls -l)      |
    |-----+---------------------------------------------|
    |ctime|date de changement d’état du fichier (ls -lc)|
    |-----+---------------------------------------------|
    |atime|date de dernier accès au fichier (ls -lu)    |
    +---------------------------------------------------+


    Note
   
    ctime n’est pas la date de création du fichier.

    Note
   
    La valeur d'atime sur GNU/Linux peut être en fait différente de
    celle donnée par la définition Unix historique.

      * Écraser un fichier va modifier tous les attributs mtime, 
        ctime et atime du fichier.

      * Modifier le propriétaire ou les droits d’un fichier va
        changer les attributs ctime et atime du fichier.

      * La lecture d’un fichier va modifier l’attribut atime du
        fichier sur le système Unix d'historique.

      * La lecture d’un fichier va modifier l’attribut atime du
        fichier que un système GNU/Linux si son système de fichier
        est monté avec "strictatime".

      * Lire un fichier pour la première fois ou après un jour
        modifie son attribut atime sur un système GNU/Linux avec un
        système de fichiers monté en « relatime » (par défaut depuis
        Linux 2.6.30).

      * Lire un fichier ne modifie pas son attribut atime sous GNU/
        Linux si le système de fichiers est monté avec « noatime ».

    Note

    The "noatime" and "relatime" mount options are introduced to
    improve the filesystem read performance under the normal use
    cases. Simple file read operation under the "strictatime" option
    accompanies the time-consuming write operation to update the 
    atime attribute. But the atime attribute is rarely used except
    for the mbox(5) file. See mount(8).

    Utilisez la commande touch(1) pour modifier l’horodatage des
    fichiers existants.

    En ce qui concerne l’horodatage, la commande ls affiche des
    chaînes différentes avec les paramètres linguistiques non anglais
    (« fr_FR.UTF-8 ») qu’avec le vénérable (« C »).

    $ LANG=fr_FR.UTF-8  ls -l foo
    -rw-rw-r-- 1 pingouin pingouin 0 oct. 16 21:35 foo
    $ LANG=C  ls -l foo
    -rw-rw-r-- 1 pingouin pingouin 0 Oct 16 21:35 foo$ LANG=en_US.UTF-8  ls -l toto

    Astuce
   
    Consultez Section 9.2.5, « Affichage personnalisé de la date et
    de l’heure » pour personnaliser la sortie de « ls -l ».

%

1.2.7. Liens

    Il existe deux méthodes pour associer le fichier « toto » avec un
    nom de fichier différent « titi » :

      * Lien physique

          + Nom dupliqué d’un fichier existant

          + « ln toto titi »
   
      * Lien symbolique ou <symlink>

          + Fichier spécial pointant vers un autre fichier par son
            nom

          + « ln -s toto titi »

    Consultez l’exemple suivant pour des modifications du nombre de
    liens et les subtiles différences dans le résultat de la commande
    rm.

    $ umask 002
    $ echo "Contenu d'origine" > toto
    $ ls -li toto
    1449840 -rw-rw-r-- 1 pingouin pingouin 18 oct.  20 16:50 toto
    $ ln toto titi     # lien physique
    $ ln -s toto tutu  # lien symbolique
    $ ls -li toto titi tutu
    1449840 -rw-rw-r-- 2 pingouin pingouin 18 oct.  20 16:50 titi
    1449840 -rw-rw-r-- 1 pingouin pingouin 18 oct.  20 16:50 toto
    1450180 lrwxrwxrwx 2 pingouin pingouin 18 oct.  20 16:55 tutu -> toto
    $ rm toto
    $ echo "Nouveau contenu" > toto
    $ ls -li toto titi tutu
    1450183 -rw-rw-r-- 2 pingouin pingouin 18 oct.  20 16:56 titi
    1449840 -rw-rw-r-- 1 pingouin pingouin 18 oct.  20 16:50 toto
    1450180 lrwxrwxrwx 2 pingouin pingouin 18 oct.  20 16:55 tutu -> toto
    $ cat titi
    Contenu d'origine
    $ cat tutu
    Nouveau contenu

    Un lien physique peut être mis en place à l’intérieur du même
    système de fichiers, il partage le même numéro d’inœud, ce que
    montre l’option « -i » de ls(1).

    Le lien symbolique a les permissions d’accès nominales au fichier
    de « rwxrwxrwx » comme il apparaît dans l’exemple ci-dessus,
    alors que les permissions d’accès effectives sont celles du
    fichier vers lequel il pointe.

    Attention

    En règle générale — à moins d’avoir une très bonne raison pour
    cela — il faudrait s’abstenir de créer des liens physiques ou des
    liens symboliques compliqués. Cela peut provoquer des cauchemars
    lorsque la combinaison logique des liens symboliques crée une
    boucle dans le système de fichiers.

    Note

    Il est généralement préférable d’utiliser des liens symboliques
    plutôt que des liens physiques à moins que vous n’ayez une bonne
    raison d’utiliser un lien physique.

    Le répertoire « . » est lié au répertoire dans lequel il
    apparaît, le nombre de liens de n’importe quel nouveau répertoire
    commence donc à 2. Le répertoire « .. » est lié au répertoire
    parent, le nombre de liens du répertoire augmente donc lors de
    l’ajout de nouveaux sous-répertoires.

    Si vous venez de passer à Linux depuis Windows, la bonne
    conception d’un système de fichiers UNIX comparé à l’équivalent
    le plus proche que sont les « raccourcis Windows » deviendra vite
    claire. Parce qu’il est implémenté dans le système de fichiers,
    les applications ne voient pas de différence entre un fichier lié
    et son original. Dans le cas de liens physiques, il n’y a
    vraiment aucune différence.

%

1.2.8. Tubes nommés (FIFO)

    Un tube nommé est un fichier qui se comporte comme un tuyau. Vous
    mettez quelque chose dans le tuyau et il ressort à l’autre bout.
    C’est donc appelé une FIFO, ou « premier entré-premier sorti »
    (First-In-First-Out) : la première chose que vous mettez dans le
    tuyau est la première chose qui ressortira à l’autre bout.

    Si vous écrivez vers un tube nommé, le processus qui écrit dans
    le tube ne se termine pas avant que l’information ne soit lue
    depuis le tube. Si vous effectuez une lecture depuis un tube
    nommé, le processus de lecture attendra jusqu’à ce qu’il n’y ait
    plus rien à lire avant de se terminer. La taille d’un tube est
    toujours nulle — il ne stocke pas de données, ce n’est qu’un lien
    entre deux processus, comparable à la fonction fournie par
    l’opérateur « | » dans l’interpréteur de commandes. Cependant,
    comme ce tube a un nom, il n’est pas nécessaire que les deux
    processus se trouvent sur la même ligne de commandes ni même
    qu’ils soient lancés par le même utilisateur. Les tubes sont une
    innovation déterminante d’UNIX.

    Essayez, par exemple, ce qui suit :

    $ cd; mkfifo montube
    $ echo "salut" >montube & # mettre en arrière-plan
    [1] 8022
    $ ls -l montube
    prw-r--r-- 1 pingouin pingouin 0 oct.  20 17:02 montube
    $ cat montube
    salut
    [1]+  Fini                    echo "salut" > montube
    $ ls montube
    montube
    $ rm montube

%

1.2.9. Sockets

    Les sockets sont utilisées de manière intensives dans les
    communications par Internet, les bases de données et le système
    d’exploitation lui-même. Elles sont semblables aux tubes nommés
    (FIFO) et permettent aux processus d’échanger des informations
    même s’ils tournent sur des ordinateurs différents. Pour la
    socket, ces processus n’ont pas besoin de tourner en même temps
    ni de tourner en tant que fils du même processus père. C’est le
    point d’aboutissement du processus d’intercommunication (IPC).
    (« interprocess communication »). L’échange d’informations peut
    avoir lieu entre deux machines au travers du réseau. Les deux
    plus courantes sont la socket Internet (« Internet socket ») et
    la socket du domaine UNIX (« UNIX domain socket »).

    Astuce
   
    « netstat -an » fournit un aperçu très utile des sockets qui sont
    ouvertes sur un système donné.

%

1.2.10. Fichiers de périphériques

    Fichiers de périphériques fait référence aux périphériques
    virtuels ou physiques de votre système, tels que vos disques
    durs, carte vidéo, écran ou clavier. Un exemple de périphérique
    virtuel est la console, représentée par « /dev/console »

    Il y a 2 types de fichiers de périphériques :

      * périphérique en mode caractère (« character device ») :

          + permettent l’accès à un caractère à la fois

          + 1 caractère = 1 octet

          + par exemple, les claviers, les ports série, …
   
      * Périphériques en mode bloc (« block device ») :

          + accèdent aux données par éléments plus importants appelés
            blocs

          + 1 bloc > 1 octet

          + par exemple, les disques durs, …

    Vous pouvez lire et écrire sur les fichiers de périphériques,
    cependant, le fichier peut fort bien contenir des données
    binaires qui peuvent être du charabia incompréhensible pour les
    êtres humains. Écrire des données directement dans ces fichiers
    est parfois utile pour déboguer des connexions matérielles. Vous
    pouvez, par exemple, vider un fichier texte vers le périphérique
    d’impression « /dev/lp0 » ou envoyer des commandes de modem vers
    le port série approprié « /dev/ttyS0 ». Mais, à moins que ce ne
    soit fait avec précautions, cela peut provoquer un désastre
    majeur. Soyez donc prudent.

    Note
   
    Pour l’accès normal à une imprimante, utilisez lp(1).

    On affiche le numéro de nœud du périphérique en utilisant la
    commande ls(1) comme suit :

    $ ls -l /dev/sda /dev/sr0 /dev/ttyS0 /dev/zero
    brw-rw----  1 root disk     8,  0 20 oct.  07:13 /dev/sda
    brw-rw----+ 1 root cdrom   11,  0 20 oct.  07:13 /dev/sr0
    crw-rw----  1 root dialout  4, 64 20 oct.  07:13 /dev/ttyS0
    crw-rw-rw-  1 root root     1,  5 20 oct.  07:13 /dev/zero

      * « /dev/sda » a le numéro majeur de périphérique 8 et le
        numéro mineur de périphérique 0. Il est accessible en lecture
        et écriture aux utilisateurs qui appartiennent au groupe
        disk.

      * « /dev/sr0 » a le numéro majeur de périphérique 11 et le
        numéro mineur de périphérique 0. Il est accessible en lecture
        et écriture aux utilisateurs qui appartiennent au groupe
        cdrom.

      * « /dev/ttyS0 » a le numéro majeur de périphérique 4 et le
        numéro mineur de périphérique 64. Il est accessible en
        lecture et écriture aux utilisateurs qui appartiennent au
        groupe dialout.

      * « /dev/zero » a le numéro majeur de périphérique 1 et le
        numéro mineur de périphérique 5. Il est accessible en lecture
        et écriture à tout le monde.

    Sur les systèmes Linux modernes, le système de fichiers sous « /
    dev/ » est automatiquement rempli par udev(7).

%

1.2.11. Fichiers spéciaux de périphériques

    Il y a aussi certains fichiers spéciaux de périphériques.

    Tableau 1.10. Liste des fichiers spéciaux de périphériques

    +---------------------------------------------------------------+
    | fichier de |action|         description de la réponse         |
    |périphérique|      |                                           |
    |------------+------+-------------------------------------------|
    |/dev/null   |lire  |retourne le « caractère fin de fichier     |
    |            |      |(EOF) »                                    |
    |------------+------+-------------------------------------------|
    |/dev/null   |écrire|ne retourne rien (un puits de données sans |
    |            |      |fond)                                      |
    |------------+------+-------------------------------------------|
    |/dev/zero   |lire  |retourne le « caractère \0 (NULL) » (qui   |
    |            |      |n’est pas identique au chiffre zéro ASCII) |
    |------------+------+-------------------------------------------|
    |            |      |retourne des caractères aléatoires depuis  |
    |/dev/random |lire  |un générateur de nombres aléatoires réel,  |
    |            |      |en donnant une vraie entropie (lent)       |
    |------------+------+-------------------------------------------|
    |            |      |retourne des caractères aléatoires depuis  |
    |/dev/urandom|lire  |un générateur de nombres pseudo-aléatoires,|
    |            |      |sécurisé par chiffrement                   |
    |------------+------+-------------------------------------------|
    |/dev/full   |écrire|retourne une erreur disque plein (ENOSPC)  |
    +---------------------------------------------------------------+


    Ils sont fréquemment utilisés en conjonction avec une redirection
    du shell (consultez Section 1.5.8, « Séquences de commandes
    typiques et redirection de l’interpréteur de commandes »).

%

1.2.12. procfs et sysfs

    procfs et sysfs montés sur « /proc » et « /sys sont des
    pseudo-systèmes de fichiers, ils présentent dans l’espace
    utilisateur des structures de données internes du noyau. En
    d’autres termes, ces entrées sont virtuelles, ce qui signifie
    qu’elles présentent une fenêtre sur le fonctionnement du système
    d’exploitation.

    Le répertoire « /proc » contient (entre autres choses), pour
    chacun des processus tournant sur le système, un sous-répertoire
    dont le nom est l’identifiant du processus (PID). Les utilitaires
    du système qui accèdent aux information des processus, tels que 
    ps(1), obtiennent leurs informations depuis cette structure de
    répertoires.

    Les répertoires qui se trouvent sous « /proc/sys/ » contiennent
    des interfaces permettant de modifier certains paramètres du
    système alors qu’il est en fonctionnement. (Vous pouvez faire la
    même chose au travers de la commande spécialisée sysctl(8) ou de
    son fichier de configuration « /etc/sysctl.conf ).

    Certaines personnes paniquent lorsqu’elles remarquent un fichier
    particulier - « /proc/kcore » — qui est particulièrement énorme.
    C’est (plus ou moins) le contenu de la mémoire de votre
    ordinateur. Il est utilisé pour déboguer le noyau. C’est un
    fichier virtuel qui pointe vers la mémoire de l’ordinateur, ne
    vous inquiétez donc pas de sa taille.

    Les répertoires sous « /sys » contiennent des structures de
    données exportées depuis le noyau, leurs attributs et les liens
    entre elles. Ils contiennent aussi des interfaces pour modifier
    certains paramètres du noyau pendant son fonctionnement.

    Consultez « proc.txt(.gz) », « sysfs.txt(.gz) » et d’autres
    documents en rapport dans la documentation du noyau de Linux (« /
    usr/share/doc/linux-doc-*/Documentation/filesystems/* ») fournie
    par le paquet linux-doc-*.

%

1.2.13. tmpfs

    Le tmpfs est un système de fichiers temporaire qui garde tous les
    fichiers en mémoire virtuelle. Les données du tmpfs dans le page
    cache en mémoire peuvent être déplacées dans l’espace d’échange
    sur disque en cas de besoin.

    Le répertoire « /run » est monté en tmpfs au tout début du
    processus de démarrage. Cela permet d’écrire dessus même quand le
    répertoire racine « / » est monté en lecture seule. C’est le
    nouvel emplacement pour le stockage de fichiers en état
    transitoire qui remplace plusieurs emplacements décrits dans la
    norme de hiérarchie du système de fichiers (« Filesystem
    Hierarchy Standard ») version 2.3 :

      * « /var/run » → « /run »

      * « /var/lock » → « /run/lock »

      * « /dev/shm » → « /run/shm »

    Consultez « tmpfs.txt(.gz) » dans la documentation du noyau de
    Linux (« /usr/share/doc/linux-doc-*/Documentation/filesystems/
    * ») fournie par le paquet linux-doc-*.

%

1.3. Midnight Commander (MC)

    Midnight Commander (MC) est un « couteau Suisse » GNU pour la
    console Linux et d’autres environnements de terminaux. Il permet
    au débutant d’acquérir une expérience de la console pilotée par
    des menus, ce qui est bien plus facile à apprendre que les
    commandes UNIX standard.

    Il vous faudra peut-être installer le paquet Midnight Commander
    dont le nom est « mc » en effectuant ce qui suit :

    $ sudo apt-get install mc

    Utilisez la commande mc(1) pour parcourir le système Debian.
    C’est la meilleure manière d’apprendre. Vous pouvez explorer
    certains emplacements intéressants en utilisant simplement les
    touches de curseur et la touche Entrée :

      * « /etc » et ses sous-répertoires

      * « /var/log » et ses sous-répertoires
   
      * « /usr/share/doc » et ses sous-répertoires

      * « /sbin » et « /bin »

%

1.3.1. Personnalisation de MC

    Pour que MC modifie le répertoire de travail en quittant, et cd
    vers le répertoire, je vous suggère de modifier « ~/.bashrc »
    afin d’inclure un script fourni par le paquet mc :

    . /usr/lib/mc/mc.sh

    Vous trouverez une explication dans mc(1) (option « -P »). (Si
    vous ne comprenez pas exactement ce dont je parle ici, vous
    pourrez le faire plus tard).

%

1.3.2. Démarrer MC

    MC peut être lancé par :

    $ mc

    MC prend en charge toutes les opérations sur les fichiers par
    l’intermédiaire de son menu, ce qui ne demande que peu d’effort
    de la part de l’utilisateur. Pressez simplement F1 pour obtenir
    l’écran d’aide. Vous pouvez jouer avec MC simplement en pressant
    les touches de curseur et les touches de fonctions.

    Note

    Sur certaines consoles telles que gnome-terminal(1), les actions
    sur les touches de fonctions peuvent être récupérées par le
    programme de console. Vous pouvez désactiver cette fonctionnalité
    par « Éditer » → « Raccourcis clavier » pour le terminal gnome.

    Si vous rencontrez un problème de codage de caractères qui
    entraîne une corruption de l’affichage, ajouter « -a » à la ligne
    de commandes de MC peut aider à éviter les problèmes.

    Si cela ne résout pas vos problèmes d’affichage avec MC,
    consultez Section 9.4.6, « Configuration du terminal ».

%

1.3.3. Gestionnaire de fichiers de MC

    Il y a par défaut, deux panneaux de répertoires affichant les
    listes de fichiers. Un autre mode utile est de définir la fenêtre
    de droite à « information » afin de voir les informations de
    privilèges d’accès aux répertoires. Vous trouverez ci-après
    quelques raccourcis clavier essentiels. Si le démon gpm(8)
    tourne, une souris est utilisable avec les consoles Linux en mode
    caractères. (Assurez-vous de presser la touche majuscules pour
    obtenir le comportement normal de couper-coller avec MC).

    Tableau 1.11. Touches de raccourcis de MC

    +---------------------------------------------------------------+
    |  touche   |                    affectation                    |
    |-----------+---------------------------------------------------|
    |F1         |menu d’aide                                        |
    |-----------+---------------------------------------------------|
    |F3         |visualisateur interne de fichiers                  |
    |-----------+---------------------------------------------------|
    |F4         |éditeur interne                                    |
    |-----------+---------------------------------------------------|
    |F9         |activer le menu déroulant                          |
    |-----------+---------------------------------------------------|
    |F10        |quitter Midnight Commander                         |
    |-----------+---------------------------------------------------|
    |Tabulation |passer d’une fenêtre à l’autre                     |
    |-----------+---------------------------------------------------|
    |Ins ou     |marquer le fichier pour des opérations sur         |
    |Ctrl-T     |plusieurs fichiers telles que copier               |
    |-----------+---------------------------------------------------|
    |Suppr      |effacer le fichier (attention, configurez MC dans  |
    |           |le mode d’effacement sécurisé)                     |
    |-----------+---------------------------------------------------|
    |Touches de |autoexplicatif                                     |
    |curseur    |                                                   |
    +---------------------------------------------------------------+


%

1.3.4. Astuces de la ligne de commandes dans MC

      * la commande cd changera le répertoire affiché sur l’écran
        sélectionné ;

      * Ctrl-Entrée ou Alt-Entrée copiera un nom de fichier sur la
        ligne de commandes. Utilisez cela avec les commandes cp(1) et
        mv(1) en association avec l’édition de la ligne de
        commandes ;

      * Alt-Tab affichera les choix de l’interpréteur de commandes
        pour l’expansion du nom de fichier ;
   
      * on peut indiquer le répertoire de départ pour les deux
        fenêtres en paramètre de MC. Par exemple « mc /etc /root » ;

      * Échap + touche n → Fn (par exemple Échap + 1 → F1, etc. ;
        Échap + 0 → F10) ;

      * Presser la touche Échap avant une touche a le même effet que
        presser simultanément Alt et la touche. Par exemple, entrez
        Échap + c pour Alt-C. Échap est appelée métatouche et parfois
        notée « M- ».

%

1.3.5. Éditeur interne de MC

    L’éditeur interne possède une manière intéressante d’effectuer un
    copier-coller. Presser F3 marque le début de la sélection, F3
    pressé une seconde fois marque la fin de la sélection et la met
    en surbrillance. Vous pouvez ensuite déplacer votre curseur. Si
    vous appuyez sur F6, la zone sélectionnée sera déplacée jusqu’à
    l’emplacement du curseur. Si vous pressez sur F5, la zone
    sélectionnée sera copiée et insérée à l’emplacement du curseur.
    F2 enregistrera le fichier. F10 vous permettra de quitter
    l’éditeur. La plupart des touches de déplacement du curseur
    fonctionnent de manière intuitive.

    Cet éditeur peut être directement lancé avec un fichier en
    utilisant l’une des commandes suivantes :

    $ mc -e fichier_à_éditer

    $ mcedit fichier_à_éditer

    Il ne s’agit pas d’un éditeur multi-fenêtres mais on peut faire
    usage de plusieurs consoles Linux pour obtenir le même effet.
    Pour copier d’une fenêtre sur l’autre, utilisez les touches Alt-F
    <n> pour basculer d’une console virtuelle à l’autre et utilisez
    « File→Insert file » ou «File→Copy to file» pour déplacer une
    portion de fichier dans un autre fichier.

    Cet éditeur interne peut être remplacé par n’importe quel autre
    éditeur externe de votre choix.

    De nombreux programmes utilisent aussi les variables
    d’environnement « $EDITOR » ou « $VISUAL » afin de décider quel
    éditeur utiliser. Si, au départ, vous n’êtes à l’aise ni avec vim
    (1) ni avec nano(1), vous pouvez définir ces variable à
    « mcedit » en ajoutant les lignes suivantes au fichier « ~
    /.bashrc » :

    export EDITOR=mcedit
    export VISUAL=mcedit

    Je recommande de les définir à « vim » si possible.

    Si vous n’êtes pas à l’aise avec vim(1), vous pouvez continuer à
    utiliser mcedit(1) pour la plupart des tâches de maintenance du
    système.

%

1.3.6. Visualisateur interne de MC

    MC possède un visualisateur intelligent. C’est un très bon outil
    pour rechercher des mots dans des documents. Je l’utilise
    toujours pour lire les fichiers qui sont dans le répertoire « /
    usr/share/doc ». C’est la manière la plus rapide de naviguer dans
    les masses d’informations sur Linux. Ce visualisateur peut être
    chargé directement utilisant l’une des commandes suivantes :

    $ mc -v chemin/vers/fichier_à_voir

    $ mcview chemin/vers/fichier_à_voir

%

1.3.7. Possibilités de démarrage automatique de MC

    Pressez Entrée sur un fichier, et le programme approprié prendra
    en charge le contenu du fichier (consultez Section 9.3.11,
    « Personnaliser le programme à lancer »). Il s’agit là d’une
    fonctionnalité très pratique de MC.

    Tableau 1.12. Réaction à la touche Entrée dans MC

    +---------------------------------------------------------------+
    |    type de fichier    |      réaction à la touche Entrée      |
    |-----------------------+---------------------------------------|
    |fichier exécutable     |exécuter la commande                   |
    |-----------------------+---------------------------------------|
    |fichier de page de     |envoyer (« pipe ») le contenu au       |
    |manuel                 |logiciel de visualisation              |
    |-----------------------+---------------------------------------|
    |fichier html           |envoyer (« pipe ») le contenu au       |
    |                       |navigateur web                         |
    |-----------------------+---------------------------------------|
    |fichiers « *.tar.gz »  |parcourir le contenu comme si c’était  |
    |et « *.deb »           |un sous-répertoire                     |
    +---------------------------------------------------------------+


    Afin de permettre le fonctionnement de ces visualisateurs et de
    ces fonctionnalités de fichiers virtuels, les fichiers pouvant
    être visualisés ne doivent pas être définis comme étant
    exécutables. Modifiez leur état avec la commande chmod(1) ou par
    l’intermédiaire du menu fichiers de MC.

%

1.3.8. Système de fichiers FTP virtuel de MC

    MC peut être utilisé pour accéder à des fichiers au travers
    d’Internet en utilisant FTP. Allez au menu en pressant F9, entrez
    ensuite « p » pour activer le système de fichiers virtuel FTP.
    Entrez une URL sous la forme
    « nomutilisateur:motdepasse@nommachine.nomdomaine » ce qui va
    permettre de récupérer un répertoire distant qui apparaît alors
    comme s’il était local.

    Essayez l’URL « [deb.debian.org/debian] » et parcourez l’archive
    Debian.

%

1.4. L’environnement élémentaire de travail de type UNIX

    Bien que MC vous permette de faire à peu près n’importe quoi, il
    est très important que vous appreniez à utiliser les outils en
    ligne de commande appelés depuis l’invite de l’interpréteur de
    commandes, et que vous vous familiarisiez avec un environnement
    de travail de type UNIX.

%

1.4.1. L’interpréteur de commandes de connexion

    Vous pouvez choisir votre interpréteur de commandes de connexion
    à l’aide de chsh(1).

    Tableau 1.13. Liste d’interpréteurs de commandes (« shells »)

    +---------------------------------------------------------------+
    |paquet|popcon|taille|Interpréteur|         description         |
    |      |      |      |   POSIX    |                             |
    |------+------+------+------------+-----------------------------|
    |bash  |V:791,|6469  |Oui         |Bash : Shell GNU Bourne      |
    |      |I:999 |      |            |Again. (standard de fait)    |
    |------+------+------+------------+-----------------------------|
    |tcsh  |V:9,  |1316  |Non         |Shell TENEX C : version      |
    |      |I:29  |      |            |améliorée de csh de Berkeley |
    |------+------+------+------------+-----------------------------|
    |dash  |V:907,|221   |Oui         |Le Shell Almquist de Debian. |
    |      |I:992 |      |            |Bon pour les scripts en shell|
    |------+------+------+------------+-----------------------------|
    |      |V:37, |      |            |Z shell : interpréteur       |
    |zsh   |I:73  |2442  |Oui         |standard avec de nombreuses  |
    |      |      |      |            |améliorations                |
    |------+------+------+------------+-----------------------------|
    |mksh  |V:4,  |1469  |Oui         |Une version de Korn shell    |
    |      |I:12  |      |            |                             |
    |------+------+------+------------+-----------------------------|
    |csh   |V:2,  |343   |Non         |C Shell OpenBSD, une version |
    |      |I:8   |      |            |de csh de Berkeley           |
    |------+------+------+------------+-----------------------------|
    |      |      |      |            |Interpréteur de commandes    |
    |      |V:0,  |      |            |autonome avec des commandes  |
    |sash  |I:6   |1054  |Oui         |intégrées. (Ne convient pas  |
    |      |      |      |            |en tant que « /bin/sh »      |
    |      |      |      |            |standard)                    |
    |------+------+------+------------+-----------------------------|
    |ksh   |V:3,  |3284  |Oui         |la vraie version de AT&T du  |
    |      |I:16  |      |            |shell Korn                   |
    |------+------+------+------------+-----------------------------|
    |rc    |V:0,  |169   |Non         |implémentation du shell rc   |
    |      |I:2   |      |            |Plan 9 de AT&T               |
    |------+------+------+------------+-----------------------------|
    |posh  |V:0,  |190   |Oui         |Policy-compliant Ordinary    |
    |      |I:0   |      |            |SHell (dérivé de pdksh)      |
    +---------------------------------------------------------------+


    Astuce

    Les interpréteurs de commandes POSIX partagent une syntaxe
    commune, mais leur comportement peut diverger, même pour des
    choses aussi élémentaires que les variables de l’interpréteur ou
    les expansions de motifs. Veuillez consulter leur documentation
    pour une description détaillée.

    Dans ce chapitre du didacticiel, l’interpréteur interactif sera
    toujours bash.

%

1.4.2. Personnaliser bash

    Vous pouvez personnaliser le comportement de bash(1) à l’aide de
    « ~/.bashrc ».

    Essayez, par exemple, ce qui suit :

    # activer bash-completion
    if ! shopt -oq posix; then
      if [ -f /usr/share/bash-completion/bash_completion ]; then
        . /usr/share/bash-completion/bash_completion
      elif [ -f /etc/bash_completion ]; then
        . /etc/bash_completion
      fi
    fi

    # CD en quittant MC
    . /usr/lib/mc/mc.sh

    # définir une valeur valable de CDPATH
    CDPATH=.:/usr/share/doc:~/Desktop:~
    export CDPATH

    PATH="${PATH+$PATH:}/usr/sbin:/sbin"
    # définir le PATH pour qu'il comporte un répertoire bin privé de l’utilisateur s'il existe
    if [ -d ~/bin ] ; then
      PATH="~/bin${PATH+:$PATH}"
    fi
    export PATH

    EDITOR=vim
    export EDITOR

    Astuce

    Vous pourrez trouver davantage d’informations concernant les
    astuces de personnalisation de bash, comme Section 9.2.7,
    « Commandes colorisées », dans Chapitre 9, Astuces du système.

    Astuce
   
    Le paquet bash-completion permet la complétions programmable pour
    bash.

%

1.4.3. Combinaisons particulières de touches

    Dans un environnement « de type UNIX », certaines séquences de
    touches ont une signification particulière. Vous remarquerez que
    sur une console Linux normale en mode caractères, seules les
    touches Ctrl et Alt situées à gauche fonctionnent de la manière
    voulue. Voici quelques séquences de touches dont il est
    intéressant de se souvenir :

    Tableau 1.14. Liste des raccourcis clavier de bash

    +---------------------------------------------------------------+
    |          touche          | description des raccourcis clavier |
    |--------------------------+------------------------------------|
    |Ctrl-U                    |effacer la ligne avant le curseur   |
    |--------------------------+------------------------------------|
    |Ctrl-H                    |effacer le caractère précédant le   |
    |                          |curseur                             |
    |--------------------------+------------------------------------|
    |                          |terminer l’entrée (quitter          |
    |Ctrl-D                    |l’interpréteur si vous en utilisez  |
    |                          |un)                                 |
    |--------------------------+------------------------------------|
    |Ctrl-C                    |terminer un programme en cours      |
    |                          |d’exécution                         |
    |--------------------------+------------------------------------|
    |Ctrl-Z                    |arrêter temporairement un programme |
    |                          |en le mettant en tâche de fond      |
    |--------------------------+------------------------------------|
    |Ctrl-S                    |arrêter le défilement de l’affichage|
    |                          |à l’écran                           |
    |--------------------------+------------------------------------|
    |Ctrl-Q                    |reprendre le défilement de          |
    |                          |l’affichage                         |
    |--------------------------+------------------------------------|
    |Ctrl-Alt-Suppr            |redémarrer ou arrêter le système,   |
    |                          |consultez inittab(5).               |
    |--------------------------+------------------------------------|
    |Touche Alt de gauche      |touche « meta » pour les interfaces |
    |(optionnellement, touche  |utilisateurs Emacs et similaires    |
    |Windows)                  |                                    |
    |--------------------------+------------------------------------|
    |Flèche haute              |lancer la recherche dans            |
    |                          |l’historique des commandes sous bash|
    |--------------------------+------------------------------------|
    |                          |lancer la recherche incrémentale    |
    |Ctrl-R                    |dans l’historique des commandes sous|
    |                          |bash                                |
    |--------------------------+------------------------------------|
    |Tabulation                |complèter l’entrée du nom de fichier|
    |                          |de la ligne de commandes sous bash  |
    |--------------------------+------------------------------------|
    |Ctrl-V Tab                |entrer une Tabulation sans expansion|
    |                          |de la ligne de commande sous bash   |
    +---------------------------------------------------------------+


    Astuce
   
    La fonctionnalité Ctrl-S du terminal peut être désactivée en
    utilisant stty(1).

%

1.4.4. Opérations de style UNIX avec la souris

    Les opérations de style UNIX avec la souris sont basées sur une
    souris ayant 3 boutons.

    Tableau 1.15. Liste des opérations de style UNIX avec la souris

    +---------------------------------------------------------------+
    |       action       |                 réponse                  |
    |--------------------+------------------------------------------|
    |Clic-gauche et      |sélectionner et copier dans le            |
    |glisser de la souris|presse-papiers                            |
    |--------------------+------------------------------------------|
    |Clic-gauche         |sélectionner le début de la sélection     |
    |--------------------+------------------------------------------|
    |Clic-droit          |sélectionner la fin de la sélection et    |
    |                    |placez-là dans le presse-papiers          |
    |--------------------+------------------------------------------|
    |Clic du milieu      |coller le contenu du presse-papiers à     |
    |                    |l’emplacement du curseur                  |
    +---------------------------------------------------------------+


    La molette centrale des souris à molette modernes est considérée
    comme le bouton du milieu et peut être utilisée pour les
    clics-milieu. Cliquer simultanément le bouton de gauche et le
    bouton de droite sert à émuler le bouton du milieu sur les
    systèmes ayant une souris à 2 boutons. Pour pouvoir utiliser une
    souris avec les consoles Linux en mode caractère, il faut que gpm
    (8) tourne en tant que démon.

%

1.4.5. Le visualisateur de fichiers

    The less(1) command is the enhanced pager (file content browser).
    It reads the file specified by its command argument or its
    standard input. Hit "h" if you need help while browsing with the
    less command. It can do much more than more(1) and can be
    supercharged by executing "eval $(lesspipe)" or "eval $(lessfile)
    " in the shell startup script. See more in "/usr/share/doc/less/
    LESSOPEN". The "-R" option allows raw character output and
    enables ANSI color escape sequences. See less(1).

%

1.4.6. L’éditeur de texte

    Il faudrait que vous soyez compétant avec l’une des variantes des
    programmes Vim ou Emacs qui sont très populaires sur les systèmes
    semblables à UNIX.

    Je pense que s’habituer aux commandes de Vim est une bonne chose,
    car l’éditeur Vi est toujours présent dans le monde Linux et
    UNIX. (En pratique, le vi d’origine ou le nouveau nvi sont des
    programmes que vous trouvez partout. Pour les débutants, j’ai
    plutôt choisi Vim parce qu’il propose de l’aide par
    l’intermédiaire de la touche F1 tout en restant assez semblable
    et plus puissant).

    Si vous choisissez plutôt Emacs ou XEmacs comme éditeur, c’est
    aussi un bon choix évidemment, particulièrement pour la
    programmation. Emacs possède une pléthore d’autres
    fonctionnalités, y compris un lecteur de nouvelles, un éditeur de
    répertoires, un programme de courriel, etc. Lorsqu’il est utilisé
    pour programmer ou éditer des scripts en shell, il reconnaît de
    manière intelligente le format de ce sur quoi vous être en train
    de travailler et il essaie de vous aider. Certaines personnes
    affirment que le seul programme dont ils ont besoin sous Linux
    est Emacs. Dix minutes d’apprentissage d’Emacs maintenant vous
    économiseront des heures plus tard. Il est grandement recommandé
    d’avoir le manuel de GNU Emacs comme référence lors de son
    apprentissage.

    Tous ces programmes sont habituellement accompagnés d’un
    programme d’apprentissage pour vous aider à les utiliser par la
    pratique. Lancez Vim en entrant « vim » et en pressant la touche
    F1. Vous devriez au moins en lire les 35 premières lignes. Suivez
    ensuite le cours en ligne en déplaçant le curseur sur « |tutor| »
    et en pressant Ctrl-].

    Note

    De bons éditeurs, tels que Vim et Emacs, traitent correctement
    les textes codés en UTF-8 et autres codages exotiques. Il est
    préconisé d’utiliser l’environnement X en utilisant les
    paramètres linguistiques UTF-8 et d’installer les programmes
    requis ainsi que les polices assorties. Les éditeurs permettent
    de régler le codage des fichiers indépendamment de celui de
    l’environnement X. Veuillez vous référer à leur documentation
    relative au texte multi-octets.

%

1.4.7. Définir un éditeur de texte par défaut

    Debian est fourni avec de nombreux éditeurs différents. Nous
    recommandons d’installer le paquet vim, comme indiqué ci-dessus.

    Debian offre un accès unifié à l’éditeur par défaut du système
    par l’intermédiaire de la commande « /usr/bin/editor ». Cela
    permet à d’autres programmes (par exemple reportbug(1)) de
    pourvoir l’appeler. Vous pouvez le modifier par la commande qui
    suit :

    $ sudo update-alternatives --config editor

    Pour les débutants, je recommande de choisir « /usr/bin/
    vim.basic » plutôt que « /usr/bin/vim.tiny » car il prend en
    charge la mise en évidence de la syntaxe.

    Astuce

    De nombreux programmes utilisent les variables d’environnement
    « $EDITOR » ou « $VISUAL » pour décider de l’éditeur à utiliser
    (consultez Section 1.3.5, « Éditeur interne de MC » et
    Section 9.3.11, « Personnaliser le programme à lancer »). Pour
    des raisons de cohérence sur le système Debian, définissez-les à
    « /usr/bin/editor ». (Historiquement « $EDITOR » était défini à
    « ed » et « $VISUAL » était défini à « vi »).

%

1.4.8. Personnaliser vim

    Vous pouvez personnaliser le comportement de vim(1) à l’aide de
    « ~/.vimrc ».

    Essayez, par exemple, ce qui suit :

    " -------------------------------
    " Configuration des paramètres linguistiques
    "
    set nocompatible
    set nopaste
    set pastetoggle=<f2>
    syn on
    if $USER == "root"
     set nomodeline
     set noswapfile
    else
     set modeline
     set swapfile
    endif
    " remplissage pour éviter que la ligne du dessus ne soit identifiée comme une ligne de mode (modeline)
    " remplissage
    " remplissage

%

1.4.9. Enregistrer les actions de l’interpréteur de commandes

    La sortie d’une commande de l’interpréteur peut défiler, quitter
    votre écran et être définitivement perdue. C’est une bonne
    habitude d’enregistrer l’activité de l’interpréteur de commandes
    dans un fichier afin de la consulter plus tard. Ce type
    d’enregistrement est essentiel lorsque vous effectuez des tâches
    d’administration quelconques.

    La méthode de base pour enregistrer l’activité de l’interpréteur
    de commandes est de la lancer sous script(1).

    Essayez, par exemple, ce qui suit :

    $ script
    Script started, file is typescript

    Lancez une commande quelconque sous script.

    Pressez Ctrl-D pour quitter le script.

    $ vim typescript

    Consultez Section 9.2.3, « Enregistrer proprement l’activité de
    la console » .

%

1.4.10. Commandes UNIX de base

    Apprenons les commandes UNIX de base. J’utilise ici « UNIX » dans
    son sens générique. Tous les clones d’UNIX proposent
    habituellement des commandes équivalentes. Le système Debian ne
    fait pas exception. Ne vous inquiétez pas si certaines commandes
    ne fonctionnent pas comme vous le voudriez maintenant. Si un
    alias est utilisé dans le shell, la sortie correspondante sera
    différente. Ces exemples ne sont pas destinés à être exécutés
    dans cet ordre.

    Essayez toutes les commandes qui suivent en utilisant un compte
    non privilégié :

    Tableau 1.16. Liste des commandes UNIX de base

    +---------------------------------------------------------------+
    |     commande     |                description                 |
    |------------------+--------------------------------------------|
    |pwd               |afficher le nom du répertoire actuel ou de  |
    |                  |travail                                     |
    |------------------+--------------------------------------------|
    |whoami            |afficher le nom de l’utilisateur actuel.    |
    |------------------+--------------------------------------------|
    |id                |afficher l’identité de l’utilisateur actuel |
    |                  |(nom, uid, gid, et groupes associés)        |
    |------------------+--------------------------------------------|
    |file <toto>       |afficher le type de fichier du fichier «    |
    |                  |<toto> »                                    |
    |------------------+--------------------------------------------|
    |type -p           |afficher l’emplacement du fichier de la     |
    |<nom-de-commande> |commande « <nom-de-commande>  »             |
    |------------------+--------------------------------------------|
    |which             |, ,                                         |
    |<nom-de-commande> |                                            |
    |------------------+--------------------------------------------|
    |type              |afficher des informations sur la commande « |
    |<nom-de-commande> |<nom-de-commande> »                         |
    |------------------+--------------------------------------------|
    |apropos <mot-clé> |rechercher les commandes ayant un rapport   |
    |                  |avec « <mot-clé> »                          |
    |------------------+--------------------------------------------|
    |man -k <mot-clé>  |, ,                                         |
    |------------------+--------------------------------------------|
    |whatis            |afficher une ligne d’explication sur la     |
    |<nom-de-commande> |commande « <nom-de-commande> »              |
    |------------------+--------------------------------------------|
    |man -a            |afficher une explication sur la commande «  |
    |<nom-de-commande> |<nom-de-commande> » (style UNIX)            |
    |------------------+--------------------------------------------|
    |info              |afficher une explication assez longue de la |
    |<nom-de-commande> |commande « <nom-de-commande> » (style GNU)  |
    |------------------+--------------------------------------------|
    |ls                |afficher le contenu du répertoire (tous les |
    |                  |fichiers et répertoires non cachés)         |
    |------------------+--------------------------------------------|
    |ls -a             |afficher le contenu du répertoire (tous les |
    |                  |fichiers et répertoires)                    |
    |------------------+--------------------------------------------|
    |                  |afficher le contenu du répertoire (presque  |
    |ls -A             |tous les fichiers et répertoires, par       |
    |                  |exemple sauter « .. » et « . »)             |
    |------------------+--------------------------------------------|
    |ls -la            |afficher tout le contenu du répertoire de   |
    |                  |façon détaillée                             |
    |------------------+--------------------------------------------|
    |                  |afficher tout le contenu du répertoire avec |
    |ls -lai           |les numéros d’inœuds et les informations    |
    |                  |détaillées                                  |
    |------------------+--------------------------------------------|
    |ls -d             |afficher tous les sous-répertoires du       |
    |                  |répertoire actuel                           |
    |------------------+--------------------------------------------|
    |tree              |afficher le contenu de l’arborescence des   |
    |                  |fichiers                                    |
    |------------------+--------------------------------------------|
    |lsof <toto>       |afficher l’état d’ouverture du fichier «    |
    |                  |<toto> »                                    |
    |------------------+--------------------------------------------|
    |lsof -p <pid>     |afficher les fichiers ouverts par le        |
    |                  |processus de numéro : « <pid> »             |
    |------------------+--------------------------------------------|
    |mkdir <toto>      |créer le nouveau répertoire « <toto> » dans |
    |                  |le répertoire en cours                      |
    |------------------+--------------------------------------------|
    |rmdir <toto>      |supprimer le répertoire « <toto> » du       |
    |                  |répertoire actuel                           |
    |------------------+--------------------------------------------|
    |                  |allez au répertoire « <toto> » se trouvant  |
    |cd <toto>         |dans le répertoire actuel ou dans le        |
    |                  |répertoire figurant dans la variable        |
    |                  |« $CDPATH »                                 |
    |------------------+--------------------------------------------|
    |cd /              |aller au répertoire racine                  |
    |------------------+--------------------------------------------|
    |cd                |aller au répertoire personnel de            |
    |                  |l’utilisateur actuel                        |
    |------------------+--------------------------------------------|
    |cd /<toto>        |aller au répertoire de chemin absolu « /    |
    |                  |<toto> »                                    |
    |------------------+--------------------------------------------|
    |cd ..             |aller au répertoire parent                  |
    |------------------+--------------------------------------------|
    |                  |aller au répertoire « <foo> » se trouvant   |
    |cd ~<toto>        |dans le répertoire personnel de             |
    |                  |l’utilisateur                               |
    |------------------+--------------------------------------------|
    |cd -              |aller au répertoire précédent               |
    |------------------+--------------------------------------------|
    |</etc/motd        |afficher le contenu de « /etc/motd » en     |
    |visualisateur     |utilisant le visualisateur (« pager ») par  |
    |                  |défaut                                      |
    |------------------+--------------------------------------------|
    |touch             |créer un fichier vide « <fichier-poubelle> »|
    |<fichier-poubelle>|                                            |
    |------------------+--------------------------------------------|
    |cp <toto> <titi>  |copier le fichier « <toto> » existant dans  |
    |                  |le nouveau fichier « <titi> »               |
    |------------------+--------------------------------------------|
    |rm                |supprimer le fichier « <fichier-poubelle> » |
    |<fichier-poubelle>|                                            |
    |------------------+--------------------------------------------|
    |                  |renommer le fichier existant « <toto> » avec|
    |mv <toto> <titi>  |le nouveau nom « <titi> » (« <titi> » ne    |
    |                  |doit pas exister)                           |
    |------------------+--------------------------------------------|
    |                  |déplacer le fichier existant « <toto> » vers|
    |mv <toto> <titi>  |le nouvel emplacement « <titi>/<toto> » (le |
    |                  |répertoire « <titi> » doit exister)         |
    |------------------+--------------------------------------------|
    |                  |déplacer le fichier existant « <toto> » vers|
    |mv <toto> <titi>/ |un nouvel emplacement avec le nouveau nom « |
    |<tutu>            |<titi>/<tutu> » (le répertoire « <titi> »   |
    |                  |doit exister mais le répertoire « <titi>/   |
    |                  |<tutu> » ne doit pas exister)               |
    |------------------+--------------------------------------------|
    |                  |rendre le fichier « <toto> » non lisible et |
    |chmod 600 <toto>  |non modifiable par les autres personnes (non|
    |                  |exécutable pour tous)                       |
    |------------------+--------------------------------------------|
    |                  |rendre un fichier existant « <toto> »       |
    |chmod 644 <toto>  |accessible en lecture mais non modifiable   |
    |                  |par les autres personnes (non exécutable    |
    |                  |pour tous)                                  |
    |------------------+--------------------------------------------|
    |                  |rendre un fichier existant « <toto> »       |
    |chmod 755 <toto>  |accessible en lecture mais non modifiable   |
    |                  |par les autres utilisateurs (exécutable pour|
    |                  |tous)                                       |
    |------------------+--------------------------------------------|
    |find . -name      |rechercher les noms de fichier contenant le |
    |<motif>           |« <motif> » de l’interpréteur de commandes  |
    |                  |(plus lent).                                |
    |------------------+--------------------------------------------|
    |                  |rechercher les noms de fichiers contenant en|
    |locate -d .       |utilisant un « <motif> » de l’interpréteur  |
    |<motif>           |de commandes (plus rapide si on utilise une |
    |                  |base de données régulièrement générée)      |
    |------------------+--------------------------------------------|
    |grep -e "<motif>" |rechercher un « <motif> » dans tous les     |
    |*.html            |fichiers se terminant par « .html » dans le |
    |                  |répertoire actuel et tous les afficher      |
    |------------------+--------------------------------------------|
    |top               |afficher en plein écran les informations sur|
    |                  |les processus, pressez « q » pour quitter   |
    |------------------+--------------------------------------------|
    |ps aux |          |afficher les informations concernant tous   |
    |visualisateur     |les processus actifs en utilisant un        |
    |                  |affichage de type BSD                       |
    |------------------+--------------------------------------------|
    |ps -ef |          |afficher les informations concernant tous   |
    |visualisateur     |les processus actifs en utilisant un        |
    |                  |affichage de type UNIX System-V             |
    |------------------+--------------------------------------------|
    |ps aux | grep -e "|afficher tous les processus faisant appel à |
    |[e]xim4*"         |« exim » et « exim4 »                       |
    |------------------+--------------------------------------------|
    |ps axf |          |afficher les informations concernant tous   |
    |visualisateur     |les processus en cours en utilisant une     |
    |                  |sortie ASCII pseudo-graphique               |
    |------------------+--------------------------------------------|
    |kill <1234>       |tuer le processus identifié par             |
    |                  |l’identifiant de processus : « <1234> »     |
    |------------------+--------------------------------------------|
    |                  |compresser « <toto> » afin de créer «       |
    |gzip <toto>       |<toto>.gz » en utilisant le codage          |
    |                  |Lempel-Ziv (LZ77)                           |
    |------------------+--------------------------------------------|
    |gunzip <toto>.gz  |décompresser « <toto>.gz » afin de créer «  |
    |                  |<toto> ».                                   |
    |------------------+--------------------------------------------|
    |                  |compresser « <toto> » pour créer «          |
    |                  |<toto>.bz2 » en utilisant l’algorithme de   |
    |bzip2 <toto>      |compression de tri de texte Burrows-Wheeler |
    |                  |et le codage de Huffman (meilleure          |
    |                  |compression que gzip)                       |
    |------------------+--------------------------------------------|
    |bunzip2 <toto>.bz2|décompresser « <toto>.bz2 » afin de créer « |
    |                  |<toto> »                                    |
    |------------------+--------------------------------------------|
    |                  |compresser « <toto> » pour créer «          |
    |xz <toto>         |<toto>.xz » en utilisant l’algorithme de    |
    |                  |compression de Lempel-Ziv-Markov chain      |
    |                  |(meilleure compression que bzip2)           |
    |------------------+--------------------------------------------|
    |unxz <toto>.xz    |décompresser « <toto>.xz » afin de créer «  |
    |                  |<toto> ».                                   |
    |------------------+--------------------------------------------|
    |tar -xvf          |extraire les fichiers de l’archive «        |
    |<toto>.tar        |<toto>.tar »                                |
    |------------------+--------------------------------------------|
    |tar -xvzf         |extraire les fichiers d’une archive         |
    |<toto>.tar.gz     |« gzippée » « <toto>.tar.gz »               |
    |------------------+--------------------------------------------|
    |tar -xvjf         |extraire les fichiers de l’archive «        |
    |<toto>.tar.bz2    |<toto>.tar.bz2 »                            |
    |------------------+--------------------------------------------|
    |tar -xvJf         |extraire les fichiers de l’archive «        |
    |<toto>.tar.xz     |<toto>.tar.xz »                             |
    |------------------+--------------------------------------------|
    |tar -cvf          |archiver le contenu du répertoire « <titi>/ |
    |<toto>.tar <titi>/| » dans l’archive « <toto>.tar »            |
    |------------------+--------------------------------------------|
    |tar -cvzf         |archiver le contenu du répertoire « <titi>/ |
    |<toto>.tar.gz     | » dans l’archive compressée «              |
    |<titi>/           |<toto>.tar.gz »                             |
    |------------------+--------------------------------------------|
    |tar -cvjf         |archiver le contenu du répertoire « <titi>/ |
    |<toto>.tar.bz2    | » sans l’archive « <toto>.tar.bz2 »        |
    |<titi>/           |                                            |
    |------------------+--------------------------------------------|
    |tar -cvJf         |archiver le contenu du répertoire « <titi>/ |
    |<toto>.tar.xz     | » sans l’archive « <toto>.tar.xz »         |
    |<titi>/           |                                            |
    |------------------+--------------------------------------------|
    |zcat README.gz |  |afficher le contenu du fichier compressé    |
    |visualisateur     |« README.gz » en utilisant le visualisateur |
    |                  |(« pager ») par défaut                      |
    |------------------+--------------------------------------------|
    |zcat README.gz >  |créer le fichier « toto » avec le contenu   |
    |toto              |décompressé de « README.gz »                |
    |------------------+--------------------------------------------|
    |zcat README.gz >> |ajouter le contenu décompressé de           |
    |toto              |« README.gz » à la fin du fichier. (S’il    |
    |                  |n’existe pas, créez-le d’abord).            |
    +---------------------------------------------------------------+


    Note

    UNIX a pour tradition de cacher les fichiers dont le nom commence
    par un « . ». Ce sont traditionnellement des fichiers qui
    contiennent des informations de configuration et des préférences
    de l’utilisateur.

    Note
   
    Pour la commande cd, consultez builtins(7).

    Note

    Le visualisateur (« pager ») par défaut d’un système Debian non
    personnalisé est more(1) qui ne permet pas le défilement vers
    l’arrière. En installant le paquet less à l’aide de la ligne de
    commandes « apt-get install less », less(1) deviendra le
    visualisateur par défaut et vous pourrez faire défiler le texte
    vers l’arrière à l’aide des touches de curseur.

    Note

    « [ » et « ] » dans l’expression rationnelle de la commande « ps
    aux | grep -e "[e]xim4*"" » ci-dessus permet d’éviter une
    correspondance de grep avec lui-même. Le « 4* » de l’expression
    rationnelle signifie 0 ou plusieurs instances du caractère « 4 »
    et permet donc à grep de trouver la correspondance à la fois avec
    « exim » et « exim4 ». Bien que « * » soit utilisé dans le motif
    générique (« glob ») des noms de fichiers de l’interpréteur de
    commandes et dans l’expression rationnelle, leurs significations
    sont différentes. Vous pourrez apprendre les expressions
    rationnelles dans grep(1).

    À titre d’exercice, parcourez les répertoires et jetez un coup
    d’œil au système en vous servant des commandes ci-dessus. Si vous
    avez des questions sur ces commandes de la console, veuillez
    consulter la page de manuel.

    Essayez, par exemple, ce qui suit :

    $ man man
    $ man bash
    $ man builtins
    $ man grep
    $ man ls

    Il peut être un peu difficile de s’habituer au style des pages de
    manuel parce qu’elles sont plutôt succinctes, particulièrement
    les plus anciennes, celles qui sont vraiment traditionnelles.
    Mais une fois que vous y serez familiarisé, vous apprécierez leur
    concision.

    Remarquez que beaucoup de commandes UNIX, y compris celles de GNU
    et BSD, affichent une information d’aide courte si vous les
    exécutez de l’une des façons suivantes (ou parfois sans
    paramètre) :

    $ <nom-de-commande> --help
    $ <nom-de-commande> -h

%

1.5. La commande simple de l’interpréteur de commandes

    Vous avez maintenant une certaine sensation sur la manière
    d’utiliser un système Debian. Nous allons regarder plus
    profondément le mécanisme d’exécution des commandes sous le
    système Debian. J’ai ici, pour les débutants, simplifié la
    réalité. Consultez bash(1) pour l’explication exacte.

    Une simple commande est une séquence de :

     1. assignations de variables (optionnelles) ;

     2. nom de la commande ;

     3. paramètres (optionnels) ;

     4. redirections (optionnelles : > , >> , < , <<, etc.) ;

     5. opérateurs de contrôle (optionnels : &&, || , <nouvelle
        ligne> , ;, &, ( , ) ).

%

1.5.1. Exécution d’une commande et variables d’environnement

    Les valeurs de certaines variables d’environnement modifient le
    comportement de certaines commandes UNIX.

    Les valeurs par défaut des variables d’environnement sont
    définies initialement par le système PAM, certaines d’entre-elles
    peuvent donc être réinitialisées par certains programmes
    d’application :

      * le gestionnaire graphique de session tel que gdm3
        réinitialise les variables d’environnement ;
   
      * dans son code de démarrage, l’interpréteur de commandes
        réinitialise les variables d’environnement dans « ~
        /.bash_profile » et « ~/.bashrc ».

%

1.5.2. La variable « $LANG »

    La valeur complète des paramètres linguistiques indiqués par la
    variable « $LANG est constituée de trois parties « xx_YY.ZZZZ ».

    Tableau 1.17. Les trois parties des paramètres linguistiques

    +---------------------------------------------------------------+
    | valeur des paramètres |             signification             |
    |     linguistiques     |                                       |
    |-----------------------+---------------------------------------|
    |xx                     |codes de langue ISO 639 (en minuscules)|
    |                       |tel que « fr »                         |
    |-----------------------+---------------------------------------|
    |YY                     |codes de pays ISO 3166 (en majuscules),|
    |                       |par exemple « FR »                     |
    |-----------------------+---------------------------------------|
    |ZZZZ                   |le jeu de caractères, toujours défini à|
    |                       |« UTF-8 »                              |
    +---------------------------------------------------------------+


    Pour les codes de langues et de pays, consultez la description
    dans « info gettext ».

    Vous devriez toujours définir le codage des caractères d’un
    système Debian moderne en UTF-8 à moins que vous ne vouliez
    spécifiquement en utiliser un ancien avec de bonnes raisons et
    les connaissances de bases associées.

    Pour des informations détaillées sur la configuration des
    paramètres linguistiques, consultez Section 8.4, « Les paramètres
    linguistiques (« locale ») ».

    Note
   
    On Debian system, make sure to install the locales-all package to
    use all locales.

    Note

    « LANG=en_US » n’est pas « LANG=C » ni « LANG=en_US.UTF-8 ».
    C’est « LANG=en_US.ISO-8859-1 » (consultez Section 8.4.1, « Bases
    du codage »).

    Tableau 1.18. Liste des recommandations de paramètres
    linguistiques

    +---------------------------------------------------------------+
    |    recommandation de paramètres     |      Langue (zone)      |
    |            linguistiques            |                         |
    |-------------------------------------+-------------------------|
    |en_US.UTF-8                          |anglais (USA)            |
    |-------------------------------------+-------------------------|
    |en_GB.UTF-8                          |anglais (Grande-Bretagne)|
    |-------------------------------------+-------------------------|
    |fr_FR.UTF-8                          |français (France)        |
    |-------------------------------------+-------------------------|
    |de_DE.UTF-8                          |allemand (Allemagne)     |
    |-------------------------------------+-------------------------|
    |it_IT.UTF-8                          |italien (Italie)         |
    |-------------------------------------+-------------------------|
    |es_ES.UTF-8                          |espagnol (Espagne)       |
    |-------------------------------------+-------------------------|
    |ca_ES.UTF-8                          |catalan (Espagne)        |
    |-------------------------------------+-------------------------|
    |sv_SE.UTF-8                          |suédois (Suède)          |
    |-------------------------------------+-------------------------|
    |pt_BR.UTF-8                          |portugais (Brésil)       |
    |-------------------------------------+-------------------------|
    |ru_RU.UTF-8                          |russe (Russie)           |
    |-------------------------------------+-------------------------|
    |zh_CN.UTF-8                          |chinois (RP de Chine)    |
    |-------------------------------------+-------------------------|
    |zh_TW.UTF-8                          |chinois (Taiwan)         |
    |-------------------------------------+-------------------------|
    |ja_JP.UTF-8                          |japonais (Japon)         |
    |-------------------------------------+-------------------------|
    |ko_KR.UTF-8                          |coréen (République de    |
    |                                     |Corée)                   |
    |-------------------------------------+-------------------------|
    |vi_VN.UTF-8                          |vietnamien (Vietnam)     |
    +---------------------------------------------------------------+


    L’exécution typique d’une commande utilise une séquence de lignes
    telle que la suivante :

    $ date
    lundi 29 octobre 2012, 10:38:53 (UTC-0400)
    $ LANG=en_US.UTF-8 date
    Mon Oct 29 10:39:00 AST 2012

    Ici, le programme date(1) est exécuté comme tâche au premier plan
    avec différentes valeurs de la variable d’environnement
    « $LANG ».

      * Avec la première commande, « $LANG » est définie à la valeur
        des paramètres linguistiques par défaut du système
        « fr_FR.UTF-8 ».
   
      * Avec la deuxième commande, « $LANG » est définie à la valeur
        des paramètres linguistiques UTF-8 anglais des États-Unis
        « en_US.UTF-8 ».

    Habituellement, la plupart des exécutions de commandes ne sont
    pas précédées de la définition de variables d’environnement. Pour
    les exemples ci-dessus, vous pouvez aussi exécuter :

    $ LANG=en_US.UTF-8
    $ date
    Mon Oct 29 10:40:50 AST 2012

    Comme vous pouvez le voir ici, la sortie de la commande est
    affectée par la variable d’environnement afin que la sortie
    s’effectue en anglais. Si vous désirez que les sous-processus
    héritent de la variable d’environnement (par exemple en appelant
    un script shell), vous devrez alors l’exporter de la manière
    suivante :

    $ export LANG

    Note

    Lorsque vous utilisez un émulateur de terminal classique, la
    variable d’environnement « $LANG » est en général réglée pour
    être exportée par l’environnement de bureau. De sorte que ce qui
    précède n’est pas vraiment un bon exemple pour tester l’effet de
    export.

    Astuce

    En déposant un signalement de bogue, c’est une bonne idée de
    lancer et de vérifier la commande « LANG=en_US.UTF-8 » si vous
    utilisez un environnement autre que l’environnement anglais.

    Consultez locale(5) et locale(7) pour les variables
    d’environnement « $LANG » et associées.

    Note

    Je vous recommande de configurer l’environnement du système en ne
    touchant qu’à la variable « $LANG » en laissant de côté les
    variables « $LC_* » à moins que ce ne soit absolument nécessaire.

%

1.5.3. La variable « $PATH »

    Lorsque vous entrez une commande dans l’interpréteur, il
    recherche la commande dans la liste des répertoires contenus dans
    la variable d’environnement « $PATH ». La valeur de la variable
    d’environnement « $PATH » est aussi appelée « chemin de recherche
    de l’interpréteur de commandes ».

    Dans une installation Debian par défaut, la variable
    d’environnement « $PATH » des comptes d’utilisateurs peut ne pas
    inclure « /sbin » ni « /usr/sbin ». Par exemple, la commande
    ifconfig doit être lancée avec son chemin complet « /sbin/
    ifconfig ». (La commande similaire ip est située dans « /bin ».)

    Vous pouvez modifier la variable d’environnement « $PATH » de
    l’interpréteur de commandes Bash par l’intermédiaire des
    fichiers« ~/.bash_profile » ou « ~/.bashrc ».

%

1.5.4. La variable « $HOME »

    De nombreuses commandes enregistrent la configuration spécifique
    à un utilisateur dans son répertoire personnel et modifient leur
    comportement en fonction de son contenu. Le répertoire personnel
    est identifié par la variable d’environnement « $HOME ».

    Tableau 1.19. Afficher les valeurs de la variable « $HOME »

    +---------------------------------------------------------------+
    |valeur de « $HOME » |   situation d’exécution d’un programme   |
    |--------------------+------------------------------------------|
    |/                   |programme lancé par le processus init     |
    |                    |(démon)                                   |
    |--------------------+------------------------------------------|
    |                    |programme lancé depuis l’interpréteur de  |
    |/root               |commandes normal de l’administrateur      |
    |                    |(« root »)                                |
    |--------------------+------------------------------------------|
    |/home/              |programme lancé depuis l’interpréteur de  |
    |<utilisateur_normal>|commandes d’un utilisateur normal         |
    |--------------------+------------------------------------------|
    |/home/              |programme lancé depuis le menu du bureau  |
    |<utilisateur_normal>|de l’interface graphique de l’utilisateur |
    |--------------------+------------------------------------------|
    |/home/              |programme lancé en tant qu’administrateur |
    |<utilisateur_normal>|avec « sudo programme »                   |
    |--------------------+------------------------------------------|
    |/root               |programme lancé en tant qu’administrateur |
    |                    |avec « sudo -H programme »                |
    +---------------------------------------------------------------+


    Astuce

    L’interpréteur de commandes étend « ~/ » pour former le
    répertoire personnel réel de l’utilisateur, par exemple, « $HOME/
     ». L’interpréteur de commandes étend « ~foo/ » sous la forme du
    répertoire personnel de foo, par exemple, « /home/foo/ ».

%

1.5.5. Options de la ligne de commandes

    Certaines commandes prennent des paramètres. Les paramètres qui
    commencent par « - » ou « -- » sont appelés options et contrôlent
    le comportement de la commande.

    $ date
    lundi 29 octobre 2012, 10:34:38 (UTC-0400)
    $ date -R
    Mon, 29 Oct 2012 10:34:40 -0400

    Ici, le paramètre de la ligne de commandes « -R » modifie le
    comportement de la commande date(1) afin qu’elle donne en sortie
    une chaîne de date conforme à la RFC2822.

%

1.5.6. Motifs génériques (« glob ») de l’interpréteur de commandes

    Souvent, vous voudrez utiliser une commande sur un groupe de
    fichiers sans avoir à tous les entrer. C’est facilité par
    l’utilisation des motifs génériques d’expansion du nom de fichier
    de l’interpréteur de commandes (glob), (on les appelle parfois 
    jokers).

    Tableau 1.20. Motifs génériques d’expansion du nom de fichier de
    l’interpréteur de commandes

    +---------------------------------------------------------------+
    |motif générique |                                              |
    |       de       |  description de la règle de correspondance   |
    | l’interpréteur |                                              |
    |----------------+----------------------------------------------|
    |*               |nom de fichier (segment) ne commençant pas par|
    |                |« . »                                         |
    |----------------+----------------------------------------------|
    |.*              |nom de fichier (segment) commençant par « . » |
    |----------------+----------------------------------------------|
    |?               |exactement un caractère                       |
    |----------------+----------------------------------------------|
    |[…]             |exactement un caractère, chaque caractère     |
    |                |étant l’un de ceux entre crochets             |
    |----------------+----------------------------------------------|
    |[a-z]           |exactement un caractère, chaque caractère     |
    |                |étant compris entre « a » et « z »            |
    |----------------+----------------------------------------------|
    |                |exactement un caractère devant être différent |
    |[^…]            |de tous les caractères entre crochets (sauf « |
    |                |^ »)                                          |
    +---------------------------------------------------------------+


    Essayez, par exemple, ce qui suit :

    $ mkdir poubelle; cd poubelle; touch 1.txt 2.txt 3.c 4.h .5.txt ..6.txt
    $ echo *.txt
    1.txt 2.txt
    $ echo *
    1.txt 2.txt 3.c 4.h
    $ echo *.[hc]
    3.c 4.h
    $ echo .*
    . .. .5.txt ..6.txt
    $ echo .*[^.]*
    .5.txt ..6.txt
    $ echo [^1-3]*
    4.h
    $ cd ..; rm -rf poubelle

    Consultez glob(7).

    Note

    Contrairement à l’expansion normale du nom de fichier par
    l’interpréteur de commandes, le motif « * » de l’interpréteur
    testé par find(1) avec « -name » test etc., correspond au « . »
    du nom de fichier. (Nouvelle fonctionnalité POSIX).

    Note

    On peut modifier le comportement d’expansion de fichiers selon
    des motifs génériques de BASH (« glob ») avec ses options
    « shopt » incluses telles que « dotglob », « noglob »,
    « nocaseglob », « nullglob », « extglob », etc. Consultez bash(1)
    .

%

1.5.7. Valeur de retour d’une commande

    Toutes les commandes retournent comme valeur de retour leur état
    de fin d’exécution (variable : « $? »).

    Tableau 1.21. Codes de retour de la commande

    +---------------------------------------------------------------+
    | état de sortie de la |valeur numérique de | valeur logique de |
    |       commande       |       retour       |      retour       |
    |----------------------+--------------------+-------------------|
    |succès                |zéro, 0             |VRAI               |
    |----------------------+--------------------+-------------------|
    |erreur                |non-nulle, -1       |FAUX               |
    +---------------------------------------------------------------+


    Essayez, par exemple, ce qui suit :

    $ [ 1 = 1 ] ; echo $?
    0
    $ [ 1 = 2 ] ; echo $?
    1

    Note

    Vous remarquerez que, dans le contexte logique de l’interpréteur
    de commandes, un succès est traité comme la valeur logique VRAIE
    qui possède la valeur 0 (zéro). C’est parfois un peu
    contre-intuitif et il fallait le rappeler ici.

1.5.8. Séquences de commandes typiques et redirection de
l’interpréteur de commandes

    Essayez de retenir les idiomes suivants de l’interpréteur de
    commandes entrés sur une seule ligne en tant qu’extrait d’une
    commande de l’interpréteur.

    Tableau 1.22. Idiomes des commandes de l’interpréteur

    +---------------------------------------------------------------+
    | idiome de |                    description                    |
    | commande  |                                                   |
    |-----------+---------------------------------------------------|
    |commande & |exécuter la commande en arrière-plan dans le       |
    |           |sous-shell                                         |
    |-----------+---------------------------------------------------|
    |commande1 ||la sortie standard de commande1 est passée         |
    |commande2  |(« piped ») à l’entrée standard de commande2. Les  |
    |           |deux commandes peuvent tourner simultanément       |
    |-----------+---------------------------------------------------|
    |commande1  |La sortie standard et la sortie d’erreur standard  |
    |2>&1 |     |de commande1 sont toutes les deux passées à        |
    |commande2  |l’entrée standard de commande2. Les deux commandes |
    |           |peuvent tourner simultanément                      |
    |-----------+---------------------------------------------------|
    |commande1 ;|exécuter commande1 et commande2 séquentiellement   |
    |commande2  |                                                   |
    |-----------+---------------------------------------------------|
    |commande1 &|exécuter commande1, en cas de succès, exécuter     |
    |& commande2|commande2 séquentiellement (retourne un succès si à|
    |           |la fois commande1 et commande2 ont été réussies)   |
    |-----------+---------------------------------------------------|
    |commande1 ||exécuter commande1, en cas d’échec, exécuter       |
    || commande2|commande2 séquentiellement (retourne un succès si  |
    |           |commande1 ou commande2 a été réussie)              |
    |-----------+---------------------------------------------------|
    |commande > |rediriger la sortir standard de commande vers le   |
    |toto       |fichier toto (l’écraser)                           |
    |-----------+---------------------------------------------------|
    |commande 2>|rediriger la sortie d’erreur standard de la        |
    |toto       |commande vers le fichier toto (et l’écraser)       |
    |-----------+---------------------------------------------------|
    |commande >>|rediriger la sortie standard de la commande vers le|
    |toto       |fichier toto (ajouter à la fin du fichier)         |
    |-----------+---------------------------------------------------|
    |commande   |rediriger la sortie d’erreur standard de la        |
    |2>> toto   |commande vers le fichier toto (ajouter à la fin du |
    |           |fichier)                                           |
    |-----------+---------------------------------------------------|
    |commande > |rediriger à la fois la sortie standard et l’erreur |
    |toto 2>&1  |standard de la commande vers le fichier « toto »   |
    |-----------+---------------------------------------------------|
    |commande < |rediriger l’entrée standard de la commande vers le |
    |toto       |fichier toto                                       |
    |-----------+---------------------------------------------------|
    |commande <<|rediriger l’entrée standard de la commande vers les|
    |délimiteur |lignes suivantes jusqu’à ce que le « délimiteur »  |
    |           |soit rencontré (ce document)                       |
    |-----------+---------------------------------------------------|
    |           |rediriger l’entrée standard de commande vers les   |
    |command <<-|lignes qui suivent jusqu’à ce que le « délimiteur »|
    |délimiteur |soit rencontré, les caractères de tabulation de    |
    |           |tête sont supprimés des lignes d’entrée)           |
    +---------------------------------------------------------------+


    Le système Debian est un système multi-tâches. Les travaux
    s’exécutant en arrière-plan permettent aux utilisateurs de faire
    tourner plusieurs programmes depuis un seul interpréteur de
    commandes. La gestion des processus en arrière-plan fait appel
    aux commandes internes de l’interpréteur : jobs, fg, bg et kill.
    Veuillez lire les sections de bash(1) se trouvant sous
    « SIGNAUX » et « CONTRÔLE DES TÂCHES » ainsi que builtins(1).

    Essayez, par exemple, ce qui suit :

    $ </etc/motd visualisateur

    $ visualisateur </etc/motd

    $ visualisateur /etc/motd

    $ cat /etc/motd | visualisateur

    Bien que ces 4 exemples de redirections d’interpréteur de
    commande affichent la même chose, le dernier exemple utilise la
    commande supplémentaire cat et gaspille des ressources sans
    raison.

    L’interpréteur de commande vous permet d’ouvrir des fichiers en
    utilisant la commande interne exec avec un descripteur de fichier
    arbitraire.

    $ echo Hello >toto
    $ exec 3<toto 4>titi  # ouvrir les fichiers
    $ cat <&3 >&4       # rediriger stdin vers 3, stdout vers 4
    $ exec 3<&- 4>&-    # fermer les fichiers
    $ cat titi
    Hello

    Les descripteurs de fichiers 0-2 sont prédéfinis.

    Tableau 1.23. Descripteurs de fichier prédéfinis

    +---------------------------------------------------+
    |périphérique|  description  |descripteur de fichier|
    |------------+---------------+----------------------|
    |stdin       |entrée standard|0                     |
    |------------+---------------+----------------------|
    |stdout      |sortie standard|1                     |
    |------------+---------------+----------------------|
    |stderr      |erreur standard|2                     |
    +---------------------------------------------------+


%

1.5.9. Alias de commande

    Vous pouvez définir des alias pour les commandes fréquemment
    utilisées.

    Essayez, par exemple, ce qui suit :

    $ alias la='ls -la'

    Maintenant, « la » fonctionnera comme un raccourci pour « ls
    -la » qui donne la liste de tous les fichier dans le format de
    liste long.

    Vous pouvez afficher la liste de tous les alias existants par la
    commande alias (consultez bash(1) sous « COMMANDES INTERNES DU
    SHELL »).

    $ alias
    ...
    alias la='ls -la'

    Vous pouvez identifier le chemin exact ou identifier la commande
    par type (consultez bash(1) sous « COMMANDES INTERNES DU SHELL
     »).

    Essayez, par exemple, ce qui suit :

    $ type ls
    ls is hashed (/bin/ls)
    $ type la
    la is aliased to ls -la
    $ type echo
    echo is a shell builtin
    $ type file
    file is /usr/bin/file

    Ici, ls a été récemment recherché alors que « file » ne l’a pas
    été, donc « ls » est « hachée », c’est-à-dire que l’interpréteur
    de commandes possède un enregistrement interne permettant un
    accès rapide à l’emplacement de la commande « ls ».

    Astuce
   
    Consultez Section 9.2.7, « Commandes colorisées ».

%

1.6. Traitement des données textuelles à la UNIX

    Dans un environnement de travail à la UNIX, le traitement du
    texte est effectué en passant le texte par des tubes au travers
    d’une chaîne d’outils standards de traitement de texte. C’est une
    autre innovation cruciale d’UNIX.

%

1.6.1. Outils de traitement de texte d’UNIX

    Il existe quelques outils standard de traitement de texte qui
    sont très souvent utilisés sur les systèmes « UNIX-like ».

      * Aucune expression rationnelle n’est utilisée :

          + cat(1) concatène des fichiers et en affiche le contenu
            complet ;

          + tac(1) concatène des fichiers et les affiche en ordre
            inverse ;

          + cut(1) sélectionne des parties de lignes et les affiche
             ;

          + head(1) affiche le début d’un fichier ;

          + tail(1) affiche la fin d’un fichier ;

          + sort(1) trie des lignes de texte ;

          + uniq(1) supprime les lignes dupliquées d’un fichier trié
             ;

          + tr(1) traduit ou supprime des caractères ;

          + diff(1) compare des fichiers ligne par ligne.

      * Une expression rationnelle de base (« Basic regular
        expression - BRE ») est utilisée :

          + grep(1) analyse la correspondance d’un texte avec des
            motifs ;

          + ed(1) est un éditeur par ligne primitif ;

          + sed(1) est un éditeur de flux ;

          + vim(1) est un éditeur en mode écran ;

          + emacs(1) est un éditeur en mode écran. (un peu étendu BRE
            ).

      * Une expression rationnelle étendue (« Extended regular
        expression - ERE ») est utilisée :

          + egrep(1) fait correspondre du texte avec des motifs ;

          + awk(1) effectue un traitement simple du texte ;

          + tcl(3tcl) peut effectuer tous les traitements possibles
            du texte : voir re_syntax(3). Souvent utilisé avec tk
            (3tk) ;

          + perl(1) peut effectuer tous les traitements imaginables
            sur du texte. Voir perlre(1) ;

          + pcregrep(1) du paquet pcregrep fait la correspondance de
            texte avec des motifs d’expressions rationnelles
            compatibles avec Perl (PCRE) (« Perl Compatible Regular
            Expressions ») ;

          + python(1) avec le module re peut faire tous les
            traitements imaginables sur du texte. Consultez « /usr/
            share/doc/python/html/index.html ».

    Si vous n’êtes pas certain de ce que font exactement ces
    commandes veuillez utiliser la commande « man » pour vous en
    faire une idée par vous-même.

    Note

    L’ordre de tri et la plage d’une expression dépendent des
    paramètres linguistiques. Si vous désirez obtenir le comportement
    traditionnel d’une commande, utilisez alors C plutôt que UTF-8 en
    faisant précéder la commande de « LANG=C » (consultez
    Section 1.5.2, « La variable « $LANG » » et Section 8.4, « Les
    paramètres linguistiques (« locale ») »).

    Note

    Les expressions rationnelles de Perl (perlre(1)), Expressions
    rationnelles compatible avec Perl (PCRE) et les expressions
    rationnelles de Python proposées par le module re ont de
    nombreuses extensions courantes par rapport aux expressions
    rationnelles étendues ERE.

%

1.6.2. Expressions rationnelles

    Les expressions rationnelles sont utilisées avec de nombreux
    outils de traitement du texte. Elles sont analogues aux motifs
    génériques « globs » du shell mais elles sont plus compliquées et
    plus puissantes.

    L’expression rationnelle décrit le motif de correspondance, elle
    est constituée de caractères de texte et de métacaractères.

    Un métacaractère est simplement un caractère ayant une
    signification particulière. Il en existe deux styles principaux, 
    BRE et ERE suivant les outils de texte décrits ci-dessus.

    Tableau 1.24. Métacaractères pour BRE et ERE

    +---------------------------------------------------------------+
    |  BRE   | ERE  |    description de l’expression rationnelle    |
    |--------+------+-----------------------------------------------|
    |\ . [ ] |\ . [ |                                               |
    |^ $ *   |] ^ $ |métacaractères courants                        |
    |        |*     |                                               |
    |--------+------+-----------------------------------------------|
    |\+ \? \(|      |métacaractères uniquement BRE, déspécifiés par |
    |\) \{ \}|      |« \ »                                          |
    |\|      |      |                                               |
    |--------+------+-----------------------------------------------|
    |        |+ ? ( |métacaractères uniquement ERE, non déspécifiés |
    |        |) { } |par « \ »                                      |
    |        ||     |                                               |
    |--------+------+-----------------------------------------------|
    |c       |c     |correspond au non métacaractère « c »          |
    |--------+------+-----------------------------------------------|
    |\c      |\c    |correspond au caractère littéral « c » même si |
    |        |      |« c » est un métacaractère en lui-même         |
    |--------+------+-----------------------------------------------|
    |.       |.     |correspond à n’importe quel caractère y compris|
    |        |      |le saut de ligne                               |
    |--------+------+-----------------------------------------------|
    |^       |^     |position au début d’une chaîne de caractères   |
    |--------+------+-----------------------------------------------|
    |$       |$     |position à la fin d’une chaîne de caractères   |
    |--------+------+-----------------------------------------------|
    |\<      |\<    |position au début d’un mot                     |
    |--------+------+-----------------------------------------------|
    |\>      |\>    |position à la fin d’un mot                     |
    |--------+------+-----------------------------------------------|
    |[abc…]  |[abc…]|correspond à n’importe quel caractère dans     |
    |        |      |« abc… »                                       |
    |--------+------+-----------------------------------------------|
    |[^abc…] |[^    |correspond à n’importe quel caractère sauf ceux|
    |        |abc…] |se trouvant dans « abc… »                      |
    |--------+------+-----------------------------------------------|
    |r*      |r*    |correspond à aucune ou plusieurs instances de  |
    |        |      |l’expression rationnelle identifiée par « r »  |
    |--------+------+-----------------------------------------------|
    |r\+     |r+    |correspond à une ou plusieurs instances de     |
    |        |      |l’expression rationnelle identifiée par « r »  |
    |--------+------+-----------------------------------------------|
    |r\?     |r?    |correspond à aucune ou une instance de         |
    |        |      |l’expression rationnelle identifiée par « r »  |
    |--------+------+-----------------------------------------------|
    |r1\|r2  |r1|r2 |correspond à une instance de l’expression      |
    |        |      |rationnelle identifiée par « r1 » ou« r2 ».    |
    |--------+------+-----------------------------------------------|
    |\(r1\|r2|(r1|  |correspond à une des expressions rationnelles  |
    |\)      |r2)   |identifiées par « r1 » ou « r2 » et la traite  |
    |        |      |comme une expression rationnelle entre crochets|
    +---------------------------------------------------------------+


    Une expression rationnelle d’emacs est BRE de base mais elle a
    été étendue afin de traiter « + » et « ? » comme des 
    métacaractères comme dans les ERE. Il n’est dont pas nécessaire
    de les échapper avec « \ » dans les expressions rationnelles
    d’emacs.

    grep(1) peut être utilisé pour effectuer de la recherche de texte
    en utilisant une expression rationnelle.

    Essayez, par exemple, ce qui suit :

    $ egrep 'GNU.*LICENSE|Yoyodyne' /usr/share/common-licenses/GPL
    GNU GENERAL PUBLIC LICENSE
    GNU GENERAL PUBLIC LICENSE
    Yoyodyne, Inc., hereby disclaims all copyright interest in the program

    Astuce
   
    Consultez Section 9.2.7, « Commandes colorisées ».

%

1.6.3. Expressions de remplacement

    Pour l’expression de remplacement, certains caractères ont une
    signification particulière.

    Tableau 1.25. Expressions de remplacement

    +---------------------------------------------------------------+
    |expressions de |   description du texte destiné à remplacer    |
    | remplacement  |          l’expression de replacement          |
    |---------------+-----------------------------------------------|
    |&              |ce à quoi correspond l’expression rationnelle  |
    |               |(utilisez \& avec emacs)                       |
    |---------------+-----------------------------------------------|
    |\n             |ce à quoi la nième expression rationnelle entre|
    |               |crochets correspond (« n » étant un nombre)    |
    +---------------------------------------------------------------+


    Pour chaîne de caractères Perl de remplacement, "$&" est utilisé
    au lieu de "&" et "$n" est utilisé au lieu de "\n".

    Essayez, par exemple, ce qui suit :

    $ echo zzz1abc2efg3hij4 | \
    sed -e 's/\(1[a-z]*\)[0-9]*\(.*\)$/=&=/'
    zzz=1abc2efg3hij4=
    $ echo zzz1abc2efg3hij4 | \
    sed -e 's/\(1[a-z]*\)[0-9]*\(.*\)$/\2===\1/'
    zzzefg3hij4===1abc
    $ echo zzz1abc2efg3hij4 | \
    perl -pe 's/(1[a-z]*)[0-9]*(.*)$/$2===$1/'
    zzzefg3hij4===1abc
    $ echo zzz1abc2efg3hij4 | \
    perl -pe 's/(1[a-z]*)[0-9]*(.*)$/=$&=/'
    zzz=1abc2efg3hij4=

    Vous prêterez ici une attention particulière au style de
    l’expression rationnelle entre crochets et à la manière dont les
    chaînes qui correspondent sont utilisées dans le processus de
    remplacement du texte avec les différents outils.

    Ces expressions rationnelles peuvent aussi être utilisées pour
    les déplacements du curseur et des actions de remplacement de
    texte dans certains éditeurs.

    Un « back slash » (« \ ») en fin de ligne sur la ligne de
    commandes du shell déspécifie le saut de ligne en un caractère
    d’espacement et permet de poursuivre la ligne de commandes de
    l’interpréteur sur la ligne suivante.

    Pour apprendre ces commandes, veuillez lire les pages de manuel
    correspondantes.

%

1.6.4. Substitution globale avec des expressions rationnelles

    La commande ed(1) peut remplacer toutes les instances de
    « REGEX_SOURCE » par « TEXTE_DESTINATION dans « fichier » :

    $ ed fichier <<EOF
    ,s/REGEX_SOURCE/TEXT_DESTINATION/g
    w
    q
    EOF

    La commande sed(1) peut remplacer toutes les instances de
    « REGEX_SOURCE » par « TEXTE_DESTINATION dans « fichier » :

    $ sed -i -e 's/REGEX_SOURCE/TEXTE_DESTINATION/g' fichier

    La commande vim(1) peut remplacer toutes les instances de
    « REGEX_SOURCE » avec « TEXTE_DESTINATION » dans « file » en
    utilisant les commandes « ex(1) :

    $ vim '+%s/REGEX_SOURCE/TEXTE_DESTINATION/gc' '+w' '+q' fichier

    Astuce
   
    L’indicateur « c » dans l’exemple qui précède permet une
    confirmation interactive de chaque substitution.

    Plusieurs fichiers ( fichier1 », « fichier2 » et « fichier3 »)
    peuvent être traités de manière similaire par une expression
    rationnelle avec vim(1) ou perl(1) :

    $ vim '+argdo %s/REGEX_SOURCE/TEXT_DESTINATION/ge|update' '+q' fichier1 fichier2 fichier3

    Astuce
   
    L’indicateur « e » de l’exemple précédent évite qu’une erreur
    « No match » (pas de correspondance) ne casse un mapping :

    $ perl -i -p -e 's/REGEX_SOURCE/TEXTE_DESTINATION/g;' fichier1 fichier2 fichier3

    Dans l’exemple en perl(1) ci-dessus, le « -i » force l’édition
    directe de chaque fichier cible, et le « -p » induit une boucle
    implicite sur tous les fichiers.

    Astuce

    L’utilisation du paramètre « -i.bak » à la place de «  -i »
    conserve le fichier d’origine en ajoutant « .bak » à son nom de
    fichier. Cela permet la récupération plus facile d’erreurs lors
    de substitutions complexes.

    Note
   
    ed(1) et vim(1) sont BRE ; perl(1) est ERE.

1.6.5. Extraire des données d’un tableau contenu dans un fichier
texte

    Considérons un fichier texte « DPL » dans lequel les noms de
    certains des responsables du projet Debian d’avant 2004 et leur
    date d’investiture sont présentés dans un format séparés par des
    espaces :

    Ian     Murdock   August  1993
    Bruce   Perens    April   1996
    Ian     Jackson   January 1998
    Wichert Akkerman  January 1999
    Ben     Collins   April   2001
    Bdale   Garbee    April   2002
    Martin  Michlmayr March   2003

    Astuce
   
    Consultez « Bref historique de Debian » pour la dernière Debian
    leadership history.

    Awk est fréquemment utilisé pour extraire des données de ce type
    de fichiers.

    Essayez, par exemple, ce qui suit :

    $ awk '{ print $3 }' <DPL                   # mois d'investiture
    August
    April
    January
    January
    April
    April
    March
    $ awk '($1=="Ian") { print }' <DPL          # DPL appelé Ian
    Ian     Murdock   August  1993
    Ian     Jackson   January 1998
    $ awk '($2=="Perens") { print $3,$4 }' <DPL # quand Perens a été investi
    April 1996

    Des interpréteurs de commandes comme Bash peuvent aussi être
    utilisés pour analyser ce genre de fichiers.

    Essayez, par exemple, ce qui suit :

    $ while read first last month year; do
        echo $month
      done <DPL
    ... même sortie que le premier exemple Awk

    Ici, la commande interne read utilise les caractères de « $IFS »
    (séparateurs de champs internes) pour scinder les lignes en mots.

    Si vous changez « $IFS » en « : », vous pouvez analyser
    facilement le fichier « /etc/passwd » :

    $ oldIFS="$IFS"   # préserver l’ancienne valeur
    $ IFS=":"
    $ while read user password uid gid rest_of_line; do
        if [ "$user" = "osamu" ]; then
          echo "ID de $user est $uid"
        fi
      done < /etc/passwd
    ID de osamu est 1001
    $ IFS="$oldIFS"   # remet l’ancienne valeur

    (Si Awk est utilisé pour faire la même chose, utilisez « FS=':' »
    pour définir le séparateur de champs).

    IFS est aussi utilisé par l’interpréteur de commandes pour
    scinder le résultat de l’expansion des paramètres, de la
    substitution de commande et de l’expansion arithmétique. Cela ne
    se produit pas pour les mots entre double ou simple apostrophes.
    La valeur de IFS par défaut est <space>, <tab> et <newline>
    combinés.

    Faites attention en utilisant cette astuce IFS dans un shell. Des
    choses étranges peuvent survenir lorsque le shell interprète
    certaines parties du script comme son entrée.

    $ IFS=":,"                        # utiliser « : » et « , » pour IFS
    $ echo IFS=$IFS,   IFS="$IFS"     # echo est une commande interne de Bash
    IFS=  , IFS=:,
    $ date -R                         # simplement une sortie de commande
    Sat, 23 Aug 2003 08:30:15 +0200
    $ echo $(date -R)                 # sous-shell --> entrée du shell principal
    Sat  23 Aug 2003 08 30 36 +0200
    $ unset IFS                       # réinitialiser IFS à sa valeur par défaut
    $ echo $(date -R)
    Sat, 23 Aug 2003 08:30:50 +0200

%

1.6.6. Bouts de scripts pour les tubes

    Les scripts suivants font des choses sympas avec les tubes.

    Tableau 1.26. Liste de parties de scripts pour enchaîner (piping)
    les commandes

    +---------------------------------------------------------------+
    | fragment de script (à entrer |      effet de la commande      |
    |     sur une seule ligne)     |                                |
    |------------------------------+--------------------------------|
    |find /usr -print              |rechercher tous les fichiers se |
    |                              |trouvant sous « /usr »          |
    |------------------------------+--------------------------------|
    |seq 1 100                     |imprimer 1 à 100                |
    |------------------------------+--------------------------------|
    |                              |lancer la commande de manière   |
    || xargs -n 1 <commande>       |répétitive en utilisant chaque  |
    |                              |élément provenant du tube (pipe)|
    |                              |comme paramètre                 |
    |------------------------------+--------------------------------|
    |                              |scinder les éléments séparés par|
    || xargs -n 1 echo             |des espaces provenant du tube   |
    |                              |(pipe) en différentes lignes    |
    |------------------------------+--------------------------------|
    || xargs echo                  |concaténer les lignes provenant |
    |                              |du tube en une seule ligne      |
    |------------------------------+--------------------------------|
    || grep -e                     |extraire du tube les lignes     |
    |<motif_expression_rationnelle>|contenant                       |
    |                              |<motif_expression_rationnelle>  |
    |------------------------------+--------------------------------|
    || grep -v -e                  |extraire du tube les lignes ne  |
    |<motif_expression_rationnelle>|contenant pas                   |
    |                              |<motif_expression_rationnelle>  |
    |------------------------------+--------------------------------|
    |                              |extraire du tube le troisième   |
    || cut -d: -f3 -               |champ, séparé par « : » (fichier|
    |                              |passwd, etc.)                   |
    |------------------------------+--------------------------------|
    |                              |extraire du tube le troisième   |
    || awk '{ print $3 }'          |champ séparé par des caractères |
    |                              |d’espacement                    |
    |------------------------------+--------------------------------|
    || awk -F'\t' '{ print $3 }'   |extraire du tube le troisième   |
    |                              |champ séparé par une tabulation |
    |------------------------------+--------------------------------|
    |                              |supprimer le retour arrière     |
    || col -bx                     |(backspace) et convertir les    |
    |                              |tabulations en espaces          |
    |------------------------------+--------------------------------|
    || expand -                    |convertir les tabulations en    |
    |                              |espaces                         |
    |------------------------------+--------------------------------|
    || sort| uniq                  |trier et supprimer les doublons |
    |------------------------------+--------------------------------|
    || tr 'A-Z' 'a-z'              |convertir de majuscules en      |
    |                              |minuscules                      |
    |------------------------------+--------------------------------|
    || tr -d '\n'                  |concaténer les lignes en une    |
    |                              |seule ligne                     |
    |------------------------------+--------------------------------|
    || tr -d '\r'                  |supprimer le retour à la ligne  |
    |                              |(CR)                            |
    |------------------------------+--------------------------------|
    || sed 's/^/# /'               |ajouter « # » au début de chaque|
    |                              |ligne                           |
    |------------------------------+--------------------------------|
    || sed 's/\.ext//g'            |supprimer « .ext »              |
    |------------------------------+--------------------------------|
    || sed -n -e 2p                |afficher la seconde ligne       |
    |------------------------------+--------------------------------|
    || head -n 2 -                 |afficher les deux premières     |
    |                              |lignes                          |
    |------------------------------+--------------------------------|
    || tail -n 2 -                 |afficher les deux dernières     |
    |                              |lignes                          |
    +---------------------------------------------------------------+


    Un script de l’interpréteur d’une seule ligne peut reboucler sur
    de nombreux fichiers en utilisant find(1) et xargs(1) afin
    d’effectuer des tâches assez complexes. Consultez Section 10.1.5,
    « Idiomes pour la sélection de fichiers » et Section 9.3.9,
    « Répéter une commande en bouclant entre des fichiers ».

    Lorsque l’utilisation de l’interpréteur de commandes en mode
    interactif devient trop compliquée, pensez à écrire un script en
    shell (consultez Section 12.1, « Les scripts de l’interpréteur de
    commande »).

Chapitre 2. Gestion des paquets Debian

    Note
   
    Ce chapitre a été écrit en supposant que le nom de code de la
    dernière version stable est Bullseye.

    Debian est une association de volontaires qui construit des
    distributions cohérentes de paquets binaires de logiciels libres
    pré-compilés et les distribue depuis son archive.

    L’archive Debian est proposée depuis de nombreux sites-miroirs
    distants, on peut y accéder par les méthodes HTTP et FTP. Elle
    est aussi disponible sous forme de CD-ROM/DVD.

    Le système de gestion des paquets Debian, lorsqu’il est
    proprement utilisé, permet à l’utilisateur d’installer sur le
    système des ensembles cohérents de paquets binaires à partir de
    l’archive. Il y a actuellement 62716 paquets disponibles pour
    l’architecture amd64.

    Le système de gestion des paquets de Debian possède un riche
    historique et de nombreux choix de programmes d’interface pour
    l’utilisateur final et de méthodes de fond pour l’accès aux
    archives. Actuellement, nous recommandons ce qui suit :

      * apt(8) pour toutes les opérations interactives en ligne de
        commandes, y compris, l’installation et la suppression de
        paquets et dist-upgrade. Disponible depuis Debian Jessie
        (Debian 8).

      * apt-get(8) pour appeler le système de gestion de paquet
        Debian depuis des scripts. C'est également une option de
        rechange lorsqu'apt n'est pas disponible (souvent le cas avec
        d'anciens systèmes Debian).

      * aptitude(8) pour une interface interactive en mode texte
        permettant de gérer les paquets installés et de faire des
        recherches parmi les paquets disponibles.

    Tableau 2.1. Liste des outils de gestion des paquets de Debian

    +---------------------------------------------------------------+
    |      paquet       |popcon|taille|         description         |
    |-------------------+------+------+-----------------------------|
    |                   |      |      |Advanced Packaging Tool (APT)|
    |                   |      |      |(« outil avancé de           |
    |                   |      |      |paquetage »), frontal de dpkg|
    |apt                |V:868,|4299  |permettant les méthodes      |
    |                   |I:999 |      |d’accès à l’archive « http »,|
    |                   |      |      |« ftp » et « file » (les     |
    |                   |      |      |commandes apt, apt-get et    |
    |                   |      |      |apt-cache sont comprises)    |
    |-------------------+------+------+-----------------------------|
    |                   |V:80, |      |gestionnaire de paquets      |
    |aptitude           |I:431 |4249  |interactif en mode terminal  |
    |                   |      |      |avec aptitude(8)             |
    |-------------------+------+------+-----------------------------|
    |                   |      |      |outil de sélection de tâches |
    |tasksel            |V:36, |393   |pour l’installation sur un   |
    |                   |I:975 |      |système Debian (frontal      |
    |                   |      |      |d’APT)                       |
    |-------------------+------+------+-----------------------------|
    |                   |      |      |paquet d’amélioration d’APT  |
    |unattended-upgrades|V:324,|325   |permettant une installation  |
    |                   |I:447 |      |automatique des mises à      |
    |                   |      |      |niveau de sécurité           |
    |-------------------+------+------+-----------------------------|
    |                   |      |      |gestionnaire de paquets en   |
    |                   |V:3,  |      |mode terminal (standard      |
    |dselect            |I:32  |2591  |précédent, frontal d’APT et  |
    |                   |      |      |d’autres anciennes méthodes  |
    |                   |      |      |d’accès)                     |
    |-------------------+------+------+-----------------------------|
    |dpkg               |V:925,|6856  |système de gestion des       |
    |                   |I:999 |      |paquets pour Debian          |
    |-------------------+------+------+-----------------------------|
    |                   |V:47, |      |gestionnaire de paquets      |
    |synaptic           |I:320 |7873  |graphique (interface         |
    |                   |      |      |graphique GNOME pour APT)    |
    |-------------------+------+------+-----------------------------|
    |                   |      |      |Programmes utilitaires       |
    |apt-utils          |V:339,|1162  |d’APT : apt-extracttemplates |
    |                   |I:996 |      |(1), apt-ftparchive(1) et    |
    |                   |      |      |apt-sortpkgs(1)              |
    |-------------------+------+------+-----------------------------|
    |apt-listchanges    |V:369,|421   |outil de notification des    |
    |                   |I:851 |      |modifications d’un paquet    |
    |-------------------+------+------+-----------------------------|
    |                   |V:7,  |      |affiche la liste des bogues  |
    |apt-listbugs       |I:12  |465   |critiques avant chaque       |
    |                   |      |      |installation par APT         |
    |-------------------+------+------+-----------------------------|
    |                   |V:18, |      |utilitaire de recherche de   |
    |apt-file           |I:78  |90    |paquet d’APT — interface en  |
    |                   |      |      |ligne de commandes           |
    |-------------------+------+------+-----------------------------|
    |                   |V:0,  |      |afficher de manière récursive|
    |apt-rdepends       |I:6   |40    |la liste des dépendances du  |
    |                   |      |      |paquet                       |
    +---------------------------------------------------------------+


2.1. Prérequis pour la gestion des paquets Debian

%

2.1.1. Configuration de paquets

    Voici quelques points-clés de la configuration des paquets sur un
    système Debian :

      * la configuration manuelle effectuée par l’administrateur du
        système est respectée. En d’autres termes, le système de
        configuration des paquets effectue, pour des raisons de
        commodité, une configuration non intrusive ;

      * chaque paquet possède son propre script de configuration avec
        une interface utilisateur standardisée appelée debconf(7) qui
        permet de faciliter le processus initial d’installation du
        paquet ;

      * les développeurs Debian font de leur mieux pour que vos mises
        à jour se fassent de manière impeccable avec les scripts de
        configuration du paquet ;
   
      * l’administrateur du système peut utiliser toutes les
        fonctionnalités des paquets de logiciels. Cependant, celles
        qui présentent un risque de sécurité sont désactivées lors de
        l’installation par défaut ;

      * si vous activez vous-même un service qui présente certains
        risques de sécurité, vous êtes responsable du confinement du
        risque ;

      * Des configurations ésotériques peuvent être activées
        manuellement par l’administrateur du système. Cela peut créer
        une interférence avec les programmes génériques d’assistance
        à la configuration du système.

%

2.1.2. Précautions de base

    Avertissement

    Ne pas installer de paquets provenant d’un mélange aléatoire de
    suites. Cela va probablement casser la cohérence des paquets et
    demande une connaissance en profondeur de la gestion du système,
    comme l’ABI, d’un compilateur, la version d’une bibliothèque, les
    fonctionnalités d’un interpréteur, etc.

    L’administrateur débutant d’un système Debian devrait conserver
    la version stable de Debian en appliquant les mises à jour de
    sécurité. Je veux dire qu’il vaut mieux éviter, par précaution,
    certaines des actions valables suivantes, jusqu’à ce que vous
    ayez très bien compris le système Debian. Voici quelques
    rappels :

      * ne pas inclure testing, ni unstable dans « /etc/apt/
        sources.list » ;

      * ne pas mélanger des archives standard de Debian avec d’autres
        archives telles qu’Ubuntu dans « /etc/apt/sources.list » ;

      * ne pas créer le fichier « /etc/apt/preferences » ;

      * ne pas modifier le comportement par défaut des outils de
        gestion des paquets au travers des fichiers de configuration
        sans en connaître toutes les conséquences ;

      * ne pas installer de paquets quelconques à l’aide de « dpkg -i
        <paquet_quelconque> » ;

      * ne jamais installer de paquets quelconques à l’aide de « dpkg
        --force-all -i <paquet_quelconque> » ;

      * ne pas effacer ni modifier les fichiers se trouvant dans « /
        var/lib/dpkg/ » ;

      * ne pas écraser les fichiers systèmes en installant des
        logiciels directement depuis les sources.

          + Au besoin, les installer dans « /usr/local » ou « /opt ».

    Les effets non compatibles avec le système de gestion des paquets
    Debian engendrés par les actions ci-dessus peuvent rendre votre
    système inutilisable.

    L’administrateur système Debian sérieux, qui s’occupe de serveurs
    dont la mission est critique, devra prendre des précautions
    supplémentaires :

      * ne pas installer de paquets, y compris les mises à jour de
        sécurité provenant de Debian sans les avoir testés
        soigneusement, avec votre configuration particulière, dans
        des conditions sûres.
   
          + Vous êtes finalement, en tant qu’administrateur système,
            responsable de votre système.

          + La longue histoire de stabilité du système Debian n’est
            pas, en elle-même, une garantie.

%

2.1.3. La vie avec d’éternelles mises à jour

    En dépit de mes avertissements précédents, je sais que de
    nombreux lecteurs de ce document voudront utiliser les versions
    testing ou unstable de Debian comme système principal pour des 
    environnements de bureau autoadministrés. Cela parce qu’elles
    fonctionnent très bien, sont fréquemment mises à jour et offrent
    les fonctionnalités les plus récentes.

    Attention

    Pour votre serveur de production, la suite stable avec les mises
    à jour de sécurité est recommandée. On peut dire la même chose
    des PC de bureau sur lesquels vous ne pouvez dépenser que des
    efforts limités d’administration.

    Cela ne demande rien d’autre que de définir la chaîne de la
    distribution dans « /etc/apt/sources.list » avec le nom de suite
    « testing » ou « unstable », ou le nom de code « bookworm » ou
    « sid ». Cela vous permettra de vivre la vie des mises à jour
    éternelles.

    Il y a beaucoup de plaisir à prendre en utilisant testing ou
    unstable mais aussi quelques risques. Même si la version unstable
    du système Debian semble très stable la plupart du temps, il y a
    eu certains problèmes de paquets sur les versions testing et
    unstable et certains d’entre-eux n’ont pas été aisés à résoudre.
    Ce peut être assez douloureux pour vous. Quelquefois, vous pouvez
    avoir un paquet cassé ou une fonctionnalité manquante pendant
    quelques semaines.

    Voici quelques idées pour vous assurer une récupération rapide et
    facile lors de bogues dans les paquets Debian :

      * faites un système avec un double démarrage en installant la
        suite stable du système Debian sur une autre partition ;

      * tenez à disposition le CD d’installation pour un démarrage de
        secours ;

      * pensez à installer apt-listbugs afin de vérifier les
        informations du Système Debian de suivi des bogues (BTS)
        avant de faire une mise à jour ;

      * apprenez suffisamment l’infrastructure du système de paquets
        pour contourner le problème ;

      * Créez un environnement isolé (« chroot ») ou similaire et
        faites-y tourner à l’avance la dernière version du système
        (consultez Section 9.10, « Système virtualisé »).

    (si vous ne savez pas faire l’une quelconque de ces actions de
    précaution, vous n’êtes probablement pas prêt pour les versions
    testing et unstable).

    La Lumière provenant de ce qui suit sauvera une personne de
    l’éternelle lutte karmique de l’enfer des mises à jour et lui
    permettra d’atteindre le nirvana de Debian.

%

2.1.4. Bases concernant l’archive Debian

    Jetez un œil sur l’archive Debian avec le point de vue d’un
    utilisateur du système.

    Astuce
   
    La charte officielle de l’archive Debian est définie dans la
    Charte Debian, chapitre 2 - l’archive Debian.

    Pour un accès HTTP typique, l’archive est indiquée de la manière
    suivante dans le fichier « /etc/apt/sources.list », par exemple
    pour le système stable = bullseye actuel :

    deb http://deb.debian.org/debian/ bullseye main contrib non-free
    deb-src http://deb.debian.org/debian/ bullseye main contrib non-free
   
    deb http://security.debian.org/ bullseye/updates main contrib
    deb-src http://security.debian.org/ bullseye/updates main contrib

    Ici, j’ai tendance à utiliser le nom de code « bullseye » plutôt
    que le nom de la suite « stable » afin d’éviter des surprises
    lorsque la version stable suivante sera diffusée.

    La signification de « /etc/apt/sources.list » est décrite dans 
    sources.list(5), ses points-clés sont les suivants :

      * la ligne « deb » définit les paquets binaires ;

      * la ligne « deb-src » définit les paquets sources ;

      * le premier paramètre est l’URL-racine de l’archive Debian ;
   
      * le deuxième paramètre est le nom de la distribution : soit le
        nom de la suite, soit son nom de code ;

      * le troisième paramètre et les suivants sont la liste des noms
        de sections d’archives valables dans l’archive Debian.

    Les lignes deb-src peuvent être omises sans risque (ou mises en
    commentaire en mettant un « # » au début de la ligne) si ce n’est
    qu’aptitude ne pourra pas avoir accès aux métadonnées liées aux
    sources. Cela accélérera les mises à jour des métadonnées de
    l’archive. L’URL peut-être « http:// », « ftp:// », « file:// »,
    etc.

    Astuce

    Si « sid » est utilisé dans l’exemple ci-dessus plutôt que
    « bullseye », il n’est pas obligatoire d’avoir la ligne « deb:
    http://security.debian.org/ … » pour les mises à jour de sécurité
    dans le fichier « /etc/apt/sources.list » parce qu’il n’y a pas
    de mises à jour de sécurité pour « sid » (unstable).

    Voici la liste des URL des sites d’archives de Debian et les noms
    de suite ou les noms de code utilisés dans le fichier de
    configuration :

    Tableau 2.2. Liste des sites d’archive de Debian

    +---------------------------------------------------------------+
    | URL de l’archive  |nom de la suite (nom de|        but        |
    |                   |         code)         |                   |
    |-------------------+-----------------------+-------------------|
    |http://            |                       |édition stable     |
    |deb.debian.org/    |stable (bullseye)      |(Bullseye)         |
    |debian/            |                       |                   |
    |-------------------+-----------------------+-------------------|
    |http://            |                       |édition testing    |
    |deb.debian.org/    |testing (bookworm)     |(Bookworm)         |
    |debian/            |                       |                   |
    |-------------------+-----------------------+-------------------|
    |http://            |                       |édition unstable   |
    |deb.debian.org/    |unstable (sid)         |(Sid)              |
    |debian/            |                       |                   |
    |-------------------+-----------------------+-------------------|
    |                   |                       |pré-version        |
    |http://            |                       |expérimental       |
    |deb.debian.org/    |experimental           |(optionnelle,      |
    |debian/            |                       |uniquement pour les|
    |                   |                       |développeurs)      |
    |-------------------+-----------------------+-------------------|
    |http://            |                       |mises à jour pour  |
    |deb.debian.org/    |stable-proposed-updates|la prochaine       |
    |debian/            |                       |version de stable  |
    |                   |                       |(optionnel)        |
    |-------------------+-----------------------+-------------------|
    |http://            |                       |mises à jour de    |
    |security.debian.org|stable/updates         |sécurité pour la   |
    |/                  |                       |version stable     |
    |                   |                       |(important)        |
    |-------------------+-----------------------+-------------------|
    |http://            |                       |mises à jour de    |
    |security.debian.org|testing/updates        |sécurité pour la   |
    |/                  |                       |version testing    |
    |                   |                       |(important)        |
    |-------------------+-----------------------+-------------------|
    |                   |                       |mises à jour       |
    |                   |                       |compatibles pour le|
    |http://            |                       |filtrage de spam,  |
    |deb.debian.org/    |bullseye-updates       |les clients de     |
    |debian/            |                       |messagerie         |
    |                   |                       |instantanée, etc.  |
    |                   |                       |pour Bullseye      |
    |-------------------+-----------------------+-------------------|
    |http://            |                       |paquets plus       |
    |deb.debian.org/    |bullseye-backports     |récents rétroportés|
    |debian/            |                       |pour Bullseye      |
    |                   |                       |(optionnel)        |
    +---------------------------------------------------------------+


    Attention

    Seule la version stable pure avec les mises à jour de sécurité
    présente la meilleure stabilité. Faire tourner une version
    principalement stable mélangée à quelques paquets venant des
    versions testing ou unstable est plus risqué que d’utiliser une
    version unstable pure parce que des versions de bibliothèques
    peuvent ne pas correspondre, etc. Si vous avez réellement besoin
    de la dernière version de certains programmes sous la version 
    stable, utilisez alors les paquets venant de bullseye-updates et
    des services backports.debian.org (consultez Section 2.7.4,
    « Mises à jour et rétroportages »). Ces services doivent être
    utilisés avec des précautions supplémentaires.

    Attention

    De base, vous ne devriez avoir qu’une seule des suites stable,
    testing ou unstable sur la ligne « deb ». Si vous avez une
    combinaison des suites stable, testing et unstable sur la ligne
    « deb », les programmes APT vont être ralentis bien que seule la
    dernière archive soit utilisée. Des mentions multiples ont un
    intérêt lorsqu’on utilise le fichier « /etc/apt/preferences »
    avec des objectifs clairs (consultez Section 2.7.3, « Ajuster la
    version candidate »).

    Astuce

    Pour les systèmes Debian ayant les versions stable et testing,
    c’est une bonne idée d’inclure les lignes ayant « http://
    security.debian.org/ » dans le fichier « /etc/apt/sources.list »
    afin d’activer les mises à jour de sécurité comme dans l’exemple
    ci-dessus.

    Note

    Les bogues de sécurité de l’archive stable sont corrigés par
    l’équipe de sécurité de Debian. Cette activité a été assez
    rigoureuse et fiable. Ceux de l’archive testing peuvent être
    corrigés par l’équipe de sécurité de Debian. Pour diverses
    raisons, cette activité n’est pas aussi rigoureuse que pour
    stable et vous pouvez avoir à attendre la migration de paquets
    corrigés de unstable. Ceux de l’archive unstable sont corrigés
    par les responsables individuels. Les paquets de unstable
    maintenus de manière active sont habituellement maintenus dans un
    assez bon état par mise à niveau avec les dernières corrections
    de sécurité des développeurs amonts. Consultez FAQ de sécurité de
    Debian concernant la manière dont Debian gère les bogues de
    sécurité.

    Tableau 2.3. Liste des sections de l’archive de Debian

    +---------------------------------------------------------------+
    |section |  nombre de  |    critères de composant du paquet     |
    |        |   paquets   |                                        |
    |--------+-------------+----------------------------------------|
    |main    |61595        |conforme à DFSG sans dépendance vers    |
    |        |             |non-free                                |
    |--------+-------------+----------------------------------------|
    |contrib |349          |conforme à DFSG mais avec des           |
    |        |             |dépendances vers non-free               |
    |--------+-------------+----------------------------------------|
    |non-free|772          |non conforme à DFSG                     |
    +---------------------------------------------------------------+


    Ici, le nombre de paquets est celui de l’architecture amd64. La
    section main fournit le système Debian (consultez Section 2.1.5,
    « Debian est totalement libre »).

    La meilleure manière d’étudier l’organisation de l’archive Debian
    est de pointer votre navigateur vers chacune des URL des archives
    en y ajoutant dists ou pool.

    On se réfère à la distribution de deux manières, la version ou le
    nom de code. Le mot « distribution » est aussi utilisé comme
    synonyme de version dans de nombreuses documentations. La
    relation entre la version et le nom de code peut être résumée
    comme suit :

    Tableau 2.4. Relation entre version et nom de code

    +---------------------------------------------------------------+
    |     calendrier     |  version =   |  version =   | version =  |
    |                    |    stable    |   testing    |  unstable  |
    |--------------------+--------------+--------------+------------|
    |après la diffusion  |nom de code = |nom de code = |nom de code |
    |de bullseye         |bullseye      |bookworm      |= sid       |
    |--------------------+--------------+--------------+------------|
    |après la diffusion  |nom de code = |nom de code = |nom de code |
    |de bookworm         |bookworm      |trixie        |= sid       |
    +---------------------------------------------------------------+


    L’histoire des noms de code a été décrite dans la FAQ Debian :
    6.2.1 Quels noms de code ont déjà été utilisés ?

    Dans la terminologie la plus stricte de l’archive Debian, le mot
    « section » est spécifiquement utilisé pour la catégorisation des
    paquets par zone d’application. (Cependant l’expression « section
    principale » peut parfois être utilisée pour décrire la section
    de l’archive Debian qui fournit la zone « main »).

    Chaque fois qu’un nouveau chargement est fait par un développeur
    Debian (DD) vers l’archive unstable (par l’intermédiaire du
    traitement d’incoming), le DD doit s’assurer que les paquets
    envoyés sont compatibles avec le dernier ensemble de paquets de
    l’archive unstable.

    Si le DD casse intentionnellement cette compatibilité en raison
    de la mise à jour d’une bibliothèque importante, etc., il y a
    habituellement une annonce sur la liste de diffusion
    debian-devel, etc.

    Avant qu’un ensemble de paquets ne soit déplacé par le script de
    maintenance de l’archive Debian depuis l’archive unstable vers
    l’archive testing, le script de maintenance de l’archive ne se
    contente pas vérifier sa maturité (environ 10 jours) et l’état
    des rapports de bogues pour ces paquets mais essaie aussi de
    s’assurer qu’ils sont compatibles avec le dernier ensemble des
    paquets de l’archive testing. Ce processus rend l’archive testing
    très actuelle et utilisable.

    Par le processus de gel progressif de l’archive dirigé par
    l’équipe de diffusion (« release team »), l’archive testing est
    mûrie afin de la rendre entièrement cohérente et sans bogue avec
    quelques interventions manuelles. Ensuite, la nouvelle version
    stable est créée en assignant le nom de code de l’ancienne
    archive testing à la nouvelle archive stable et en créant un
    nouveau nom de code pour la nouvelle archive testing. Le contenu
    initial de la nouvelle archive testing est exactement le même que
    celui de l’archive stable qui vient d’être diffusée.

    Les archives unstable et testing peuvent toutes les deux souffrir
    temporairement de problèmes en raison de divers facteurs :

      * chargement vers l’archive cassé (la plupart du temps, cela
        concerne unstable) ;

      * délai pour accepter un nouveau paquet dans l’archive (la
        plupart du temps, cela concerne unstable) ;
   
      * problème de temps de synchronisation de l’archive (à la fois
        pour testing et unstable) ;

      * intervention manuelle sur l’archive comme la suppression d’un
        paquet (davantage pour testing), etc.

    Si vous décidez donc d’utiliser ces archives, vous devriez être
    capable de corriger ou de contourner ces types de problèmes.

    Attention

    Pendant les quelques mois qui suivent la diffusion d’une nouvelle
    version stable, la plupart des utilisateur de machines de bureau
    devraient utiliser l’archive stable avec ses mises à jour de
    sécurité même s’ils utilisent habituellement les archives
    unstable ou testing. Pendant cette période de transition, les
    archives unstable et testing ne sont pas bonnes pour la plupart
    des gens. Votre système sera difficile à conserver dans un bon
    état de fonctionnement avec l’archive unstable car elle souffre
    de pics d’importantes mises à jour de paquets fondamentaux.
    L’archive testing n’est pas utile non plus car elle a
    sensiblement le même contenu que l’archive stable sans la prise
    en compte de la sécurité (Debian testing-security-announce
    2008-12). Après environ un mois, l’archive unstable peut être
    utilisée avec précautions.

    Astuce

    Lors du suivi de l’archive testing, un problème causé par la
    suppression d’un paquet est habituellement contournée en
    installant le paquet correspondant de l’archive unstable qui est
    envoyé pour la correction du bogue.

    Consultez la Charte Debian pour la définition des archives.

      * « Sections »

      * « Priorités »
   
      * « Système de base »

      * « Paquets essentiels »

%

2.1.5. Debian est totalement libre

    Debian est totalement libre pour les raisons suivantes :

      * Debian n’installe que des logiciels libres par défaut pour
        respecter les libertés des utilisateurs ;

      * Debian ne fournit que des logiciels libres dans main ;
   
      * Debian recommande de n’utiliser que des logiciels libres de
        main ;

      * Aucun paquet de main ne dépend ou ne recommande de paquets de
        non-free ni de contrib.

    Certaines personnes se demandent si les deux faits suivants sont
    contradictoires ou non.

      * « Debian demeurera totalement libre. » (Premier point du
        contrat social Debian).
   
      * Debian héberge des paquets non-free (non libres) et contrib
        (contributions).

    Ce n’est pas contradictoire pour les raisons suivantes.

      * Le système Debian est totalement libre et ses paquets sont
        hébergés par les serveurs Debian dans la section main de
        l’archive.
   
      * Des paquets hors du système Debian sont hébergés par les
        serveurs Debian dans les sections non-free et contrib de
        l’archive.

    C’est précisément expliqué dans les quatrième et cinquième points
    du contrat social Debian :

      * Nos priorités sont nos utilisateurs et les logiciels libres.

          + Les besoins de nos utilisateurs et de la communauté des
            logiciels libres nous guideront. Nous placerons leurs
            intérêts en tête de nos priorités. Nous répondrons aux
            besoins de nos utilisateurs dans de nombreux types
            d’environnements informatiques différents. Nous ne nous
            opposerons pas aux travaux non libres prévus pour
            fonctionner sur les systèmes Debian. Nous permettrons,
            sans réclamer rétribution, que d’autres créent des
            distributions contenant conjointement des logiciels
            Debian et d’autres travaux. Pour servir ces objectifs,
            nous fournirons un système intégrant des composants de
            grande qualité sans restrictions légales incompatibles
            avec ces modes d’utilisation.

      * Travaux non conformes à nos standards sur les logiciels
        libres.

          + Nous reconnaissons que certains de nos utilisateurs
            demandent à pouvoir utiliser des travaux qui ne sont pas
            conformes aux principes du logiciel libre selon Debian.
            Les paquets correspondant prennent place dans des
            sections nommées « contrib » (« contributions ») et
            « non-free » (« non libre »). Les paquets de ces sections
            ne font pas partie du système Debian, bien qu’ils aient
            été configurés afin d’être utilisés avec lui. Nous
            encourageons les fabricants de CD à lire les licences de
            ces paquets afin de déterminer s’ils peuvent les
            distribuer. Ainsi, bien que les travaux non libres ne
            fassent pas partie de Debian, nous prenons en compte leur
            utilisation et fournissons donc l’infrastructure
            nécessaire (à l’image de notre système de suivi des
            bogues et de nos listes de diffusion).

    Les utilisateurs doivent être conscients des risques lors de
    l’utilisation de paquets des sections non-free et contrib de
    l’archive :

      * l’absence de liberté pour de tels paquets de logiciel ;

      * l’absence de suivi de la part de Debian pour de tels paquets
        de logiciel (Debian ne peut pas suivre correctement un
        logiciel sans avoir accès à son code source) ;

      * la contamination de votre système Debian totalement libre.

    Les principes du logiciel libre selon Debian sont les normes du
    logiciel libre pour Debian. Debian interprète « logiciel » de la
    façon la plus large possible, y compris la documentation, les
    microprogrammes, les logos et données artistiques des paquets.
    Cela rend les normes du logiciel libre de Debian très strictes.

    In order to meet this strict free software standards required for
    main, Debian once unbranded Mozilla software packages such as
    Firefox, Thunderbird, and Seamonkey by removing their logo and
    some artwork data; and ships them as Iceweasel, Icedove, and
    Iceape, respectively. Those packages have restored their original
    names with the release of Debian Stretch (Debian 9) after those
    problems get solved.

    Les paquets typiques de non-free et contrib contiennent des
    paquets librement distribuables des types suivants :

      * Les paquets de documentation sous licence de documentation
        libre GNU avec des sections invariables comme celles de GCC
        et Make (la plupart sont dans la section non-free/doc).

      * Les paquets de microprogramme contenant des données binaires
        sans source comme celles de Section 9.9.6, « Pilotes de
        matériel et microprogramme » dans non-free (la plupart sont
        dans la sectionnon-free/kernel).

      * Les paquets de jeu ou de police avec des restrictions sur
        l’utilisation commerciale ou la modification de contenu.

    Veuillez remarquer que le nombre de paquets de non-free et
    contrib est inférieur à 2 % de ceux dans main. Activer l’accès
    aux sections non-free et contrib ne cache pas la provenance des
    paquets. L’utilisation interactive d’aptitude(8) fournit une
    visibilité totale et un contrôle complet des paquets installés et
    de leur section pour garder le système aussi libre que voulu.

%

2.1.6. Dépendances des paquets

    Le système Debian offre un ensemble cohérent de paquets binaires
    par l’intermédiaire de son mécanisme de déclaration de
    dépendances binaires versionnées dans les champs du fichier
    « control ». En voici une définition un peu simplifiée :

      * « Depends »

          + Cela déclare une dépendance absolue du paquet et tous les
            paquets listés dans ce champ doivent être installés en
            même temps ou à l’avance.

      * « Pre-Depends »

          + Comme pour « Depends » excepté que cela demande une
            installation complète et à l’avance des paquets cités.

      * « Recommends »

          + Cela déclare une dépendance forte mais non absolue. La
            plupart des utilisateurs n’installeront pas le paquet si
            tous les paquets cités dans ce champ ne sont pas
            installés.

      * « Suggests »

          + Cela déclare une dépendance lâche. De nombreux
            utilisateurs de ce paquet pourront tirer profit de
            l’installation des paquets cités dans ce champs mais
            auront cependant des fonctionnalités acceptables sans
            eux.

      * « Enhances »

          + Cela déclare une dépendance lâche comme « Suggests » mais
            fonctionne à l’inverse.

      * « Casse »

          + Cela déclare une incompatibilité de paquet avec
            habituellement une indication de version. La solution est
            en général de mettre à jour tous les paquets indiqués
            dans ce champ.

      * « Conflicts »

          + Cela déclare une incompatibilité absolue. Tous les
            paquets cités dans ce champs doivent être supprimés pour
            installer ce paquet.

      * « Replaces »

          + C’est déclaré lorsque les fichiers installés par ce
            paquet remplacent des fichiers des paquets cités.

      * « Provides »

          + C’est déclaré lorsque ce paquet fournit tous les fichiers
            et les fonctionnalités des paquets cités.

    Note

    Remarquez que définir simultanément « Provides », « Conflicts »
    et « Replaces » pour un paquet virtuel est une configuration
    saine. Cela permet de s’assurer qu’un seul paquet réel
    fournissant ce paquet virtuel puisse être installé à un moment
    donné.

    La définition officielle, y compris les dépendances de sources,
    se trouve dans la Charte Debian ; Chapitre 7 - Déclaration des
    dépendances entre paquets.

%

2.1.7. Flux des événements dans la gestion d’un paquet

    Voici un résumé du flux simplifié des événements de la gestion
    d’un paquet par APT.

      * Mettre à jour (« update ») («apt update», « aptitude update »
        ou « apt-get update ») :

         1. Rechercher les métadonnées d’une archive depuis l’archive
            distante

         2. Reconstruire et mettre à jour les métadonnées locales
            pour qu’elles puissent être utilisées par APT

      * Mettre à niveau (« upgrade ») («apt upgrade» et «apt
        full-upgrade», ou « aptitude safe-upgrade » et « aptitude
        full-upgrade » ou « apt-get upgrade » et « apt-get
        dist-upgrade ») :

         1. Choisir la version candidate, qui est habituellement la
            dernière version disponible, pour tous les paquets
            installés (consultez Section 2.7.3, « Ajuster la version
            candidate » pour les exceptions)

         2. Effectuer la résolution des dépendances du paquet

         3. Rechercher le paquet binaire sélectionné depuis l’archive
            distante si la version candidate est différente de la
            version installée

         4. Dépaqueter les paquets binaires ayant été téléchargés

         5. Lancer le script preinst

         6. Installer les fichiers binaires

         7. Lancer le script postinst

      * Installer («apt install …»,  aptitude install … » ou
        « apt-get install … ») :

         1. Choisir les paquets indiqués sur la ligne de commandes

         2. Effectuer la résolution des dépendances du paquet

         3. Récupérer les paquets binaires sélectionnés depuis
            l’archive distante

         4. Dépaqueter les paquets binaires ayant été téléchargés

         5. Lancer le script preinst

         6. Installer les fichiers binaires

         7. Lancer le script postinst

      * Supprimer («apt remove …», « aptitude remove … » ou « apt-get
        remove … ») :

         1. Choisir les paquets indiqués sur la ligne de commandes

         2. Effectuer la résolution des dépendances du paquet

         3. Lancer le script prerm

         4. Supprimer les fichiers installés à l’exception des
            fichiers de configuration

         5. Lancer le script postrm

      * Purger (« apt purge », « aptitude purge … » ou « apt-get
        purge … ») :

         1. Choisir les paquets indiqués sur la ligne de commandes

         2. Effectuer la résolution des dépendances du paquet

         3. Lancer le script prerm

         4. Supprimer les fichiers installés y compris leurs fichiers
            de configuration

         5. Lancer le script postrm

    J’ai ici intentionnellement sauté des détails techniques dans le
    souci d’avoir une vue d’ensemble.

%

2.1.8. Première réponse aux problèmes de gestion de paquets

    Vous devriez lire l’excellente documentation officielle. Le
    premier document à lire est « /usr/share/doc/<nom_paquet>/
    README.Debian » qui est spécifique à Debian. Les autres documents
    dans « /usr/share/doc/<nom_paquet>/ » devraient aussi être
    consultés. Si vous avez configuré l’interpréteur de commande
    comme dans Section 1.4.2, « Personnaliser bash », entrez ce qui
    suit :

    $ cd <nom_paquet>
    $ pager README.Debian
    $ mc

    Vous aurez besoin d’installer le paquet de documentation
    correspondant au paquet dont le nom possède le suffixe « -doc »
    pour des informations détaillées.

    Si vous rencontrez des problèmes avec un paquet particulier,
    faites d’abord une recherche sur le site du système de suivi des
    bogues Debian (BTS).

    Tableau 2.5. Liste de sites web clés pour résoudre les problèmes
    avec un paquet particulier

    +---------------------------------------------------------------+
    |            site web            |           commande           |
    |--------------------------------+------------------------------|
    |Page d’accueil du système de    |sensible-browser « http://    |
    |suivi des bogues Debian (BTS)   |bugs.debian.org/ »            |
    |--------------------------------+------------------------------|
    |Signalement de bogue d’un nom de|sensible-browser « http://    |
    |paquet connu                    |bugs.debian.org/<nom_paquet> »|
    |--------------------------------+------------------------------|
    |Rapport de bogue concernant un  |sensible-browser « http://    |
    |numéro de bogue connu           |bugs.debian.org/<bug_number> »|
    +---------------------------------------------------------------+


    Rechercher sur Google avec des mots de recherche comprenant
    « site:debian.org », « site:wiki.debian.org »,
    « site:lists.debian.org », etc.

    Pour déposer un signalement de bogue, veuillez utiliser la
    commande reportbug(1).

%

2.2. Opérations de base de la gestion des paquets

    Sur le système Debian, les opérations de gestion des paquets
    basées sur les dépôts peuvent être réalisées à l’aide de nombreux
    outils de gestion de paquets basés sur APT et disponibles dans le
    système Debian. Nous décrirons ici les outils de base de gestion
    des paquets : apt, apt-get/apt-cache et aptitude.

    Pour les opérations de gestion des paquets qui concernent
    l’installation des paquets ou les mises à jour des métadonnées
    des paquets, vous aurez besoin des privilèges de
    l’administrateur.

%

2.2.1. apt comparé à apt-get / apt-cache comparé à aptitude

    Bien qu'aptitude soit un très bon outil interactif et que
    l'auteur l'utilise, voici quelques avertissements que vous
    devriez connaître :

      * La commande aptitude n'est pas recommandée pour une mise à
        niveau du système entre versions sur le système Debian stable
        après la sortie d'une nouvelle version.

          + L'utilisation de "apt full-upgrade" ou de "apt-get
            dist-upgrade" est recommandée pour cela. Voir Bug #
            411280.

      * La commande aptitude suggère parfois la suppression massive
        de paquets lors de la mise à niveau du système sur des
        systèmes Debian en testing ou unstable.
   
          + Cette situation a effrayé de nombreux administrateurs
            système. Pas de panique.

          + Il semblerait que cela soit principalement causé par un
            biais de version parmi des paquets dépendants de, ou
            recommandés par, un méta-paquet tel que gnome-core.

          + Cela peut être résolu en sélectionnant « Annuler les
            actions en attente » dans le menu de commande d'aptitude,
            en quittant aptitude et en utilisant la commande « apt
            full-upgrade ».

    Les commandes apt-get et apt-cache sont les outils les plus 
    basiques de gestion des paquets basés sur APT.

      * apt-get et apt-cache n’offre qu’une interface utilisateur en
        ligne de commandes.

      * apt-get est le mieux adapté pour les mises à jour majeures du
        système entre les versions, etc.

      * apt-get offre un système de résolution des dépendances entre
        paquets robuste.

      * apt-get nécessite moins de ressources matérielles. Il
        consomme moins de mémoire et fonctionne plus rapidement.

      * apt-cache offre une recherche basée sur des expressions
        rationnelles standard sur les noms et les descriptions des
        paquets.

      * apt-get et apt-cache peuvent gérer des versions multiples des
        paquets en utilisant /etc/apt/preferences mais est assez
        lourd.

    The apt command is a high-level commandline interface for package
    management. It is basically a wrapper of apt-get, apt-cache and
    similar commands, originally intended as an end-user interface
    and enables some options better suited for interactive usage by
    default.

      * apt provides a friendly progress bar when installing packages
        using apt install.
   
      * apt will remove cached .deb packages by default after
        sucessful installation of downloaded packages.

    Astuce

    Users are recommended to use the new apt(8) command for 
    interactive usage and use the apt-get(8) and apt-cache(8)
    commands in the shell script.

    La commande aptitude est l’outil de gestion des paquets basé sur
    APT le plus flexible.

      * aptitude offre une interface utilisateur interactive en plein
        écran en mode texte.

      * aptitude offre aussi une interface utilisateur en ligne de
        commandes.

      * aptitude est le mieux adapté pour la gestion interactive
        journalière des paquets comme, par exemple, la vérification
        des paquets installés et la recherche de paquets disponibles.
   
      * aptitude nécessite plus de ressources matérielles. Il
        consomme plus de mémoire et fonctionne moins rapidement.

      * aptitude offre une recherche avancée basée sur des
        expressions rationnelles pour la recherche sur toutes les
        métadonnées des paquets.

      * aptitude peut gérer des versions multiples des paquets sans
        utiliser /etc/apt/preferences et est assez intuitif.

2.2.2. Opérations de base de gestion des paquets en ligne de
commandes

    Voici les opérations de base de gestion des paquets en ligne de
    commandes en utilisant apt(8), aptitude(8), apt-get(8) et 
    apt-cache(8) .

    Tableau 2.6. Opérations de base de gestion des paquets avec la
    ligne de commandes en utilisant apt(8), aptitude(8), apt-get(8)
    et apt-cache(8)

    +---------------------------------------------------------------+
    |  syntaxe   |  syntaxe   |  syntaxe   |                        |
    |   d’apt    | d’aptitude |d’apt-get et|      description       |
    |            |            | apt-cache  |                        |
    |------------+------------+------------+------------------------|
    |            |aptitude    |apt-get     |mettre à jour les       |
    |apt update  |update      |update      |métadonnées de l’archive|
    |            |            |            |du paquet               |
    |------------+------------+------------+------------------------|
    |            |            |            |installer la version    |
    |apt install |aptitude    |apt-get     |candidate du paquet     |
    |toto        |install toto|install toto|« toto » ainsi que ses  |
    |            |            |            |dépendances             |
    |------------+------------+------------+------------------------|
    |            |            |            |installer les versions  |
    |apt upgrade |aptitude    |apt-get     |candidates des paquets  |
    |            |safe-upgrade|upgrade     |installés sans supprimer|
    |            |            |            |aucun autre paquet      |
    |------------+------------+------------+------------------------|
    |            |            |            |installer les versions  |
    |apt         |aptitude    |apt-get     |candidates des paquets  |
    |full-upgrade|full-upgrade|dist-upgrade|installés en supprimant |
    |            |            |            |d’autres paquets si     |
    |            |            |            |nécessaire              |
    |------------+------------+------------+------------------------|
    |            |            |            |supprimer le paquet     |
    |apt remove  |aptitude    |apt-get     |« toto » en laissant ses|
    |toto        |remove toto |remove toto |fichiers de             |
    |            |            |            |configuration           |
    |------------+------------+------------+------------------------|
    |            |            |            |supprimer les paquets   |
    |apt         |            |apt-get     |installés               |
    |autoremove  |N/A         |autoremove  |automatiquement         |
    |            |            |            |lorsqu’ils ne sont plus |
    |            |            |            |nécessaires             |
    |------------+------------+------------+------------------------|
    |            |            |            |purger le paquet        |
    |apt purge   |aptitude    |apt-get     |« toto » ainsi que ses  |
    |toto        |purge toto  |purge toto  |fichiers de             |
    |            |            |            |configuration           |
    |------------+------------+------------+------------------------|
    |            |aptitude    |apt-get     |nettoyer complètement le|
    |apt clean   |clean       |clean       |dépôt local des fichiers|
    |            |            |            |de paquets récupérés    |
    |------------+------------+------------+------------------------|
    |apt         |aptitude    |apt-get     |nettoyer le dépôt local |
    |autoclean   |autoclean   |autoclean   |des fichiers des paquets|
    |            |            |            |périmés                 |
    |------------+------------+------------+------------------------|
    |            |            |            |afficher des            |
    |apt show    |aptitude    |apt-cache   |informations détaillées |
    |toto        |show toto   |show toto   |concernant le paquet    |
    |            |            |            |« toto »                |
    |------------+------------+------------+------------------------|
    |apt search  |aptitude    |apt-cache   |rechercher les paquets  |
    |<expression |search      |search      |qui correspondent à l’  |
    |rationnelle>|<expression |<expression |<expression rationnelle>|
    |            |rationnelle>|rationnelle>|                        |
    |------------+------------+------------+------------------------|
    |            |            |            |expliquer les raisons   |
    |            |aptitude why|            |qui font que les paquets|
    |N/A         |<expression |N/A         |correspondant à l’      |
    |            |rationnelle>|            |<expression rationnelle>|
    |            |            |            |devront être installés  |
    |------------+------------+------------+------------------------|
    |            |            |            |expliquer les raisons   |
    |            |aptitude    |            |pour lesquels les       |
    |            |why-not     |            |paquets qui             |
    |N/A         |<expression |N/A         |correspondent à l’      |
    |            |rationnelle>|            |<expression rationnelle>|
    |            |            |            |ne peuvent pas être     |
    |            |            |            |installés               |
    |------------+------------+------------+------------------------|
    |            |aptitude    |apt-mark    |lister les paquets      |
    |N/A         |search '~i! |showmanual  |installés manuellement  |
    |            |~M'         |            |                        |
    +---------------------------------------------------------------+


    Note

    Bien que la commande aptitude soit disponible avec de riches
    fonctionnalités comme son solveur de paquets avancé, cette
    complexité a causé (et peut encore causer) certaines régressions
    comme le bogue #411123, le bogue #514930 et le bogue #570377. En
    cas de doute, veuillez utiliser les commandes apt, apt-get et
    apt-cache plutôt que la commande aptitude.

    Note

    Puisqu’apt / apt-get et aptitude partagent l’état de paquet
    installé automatiquement (consultez Section 2.5.5, « État des
    paquets pour APT ») après lenny, vous pouvez mélanger ces outils
    sans trop de problème (consultez le Bogue #594490).

    « aptitude why <expression-rationnelle> » peut afficher plus
    d’informations par « aptitude -v why <expression_rationnelle> ».
    On peut obtenir des informations similaires par « apt rdepends
    <paquet>" ou "apt-cache rdepends <paquet> ».

    Lorsque la commande aptitude est lancée en mode ligne de
    commande, et rencontre des problèmes tels que des conflits de
    paquets, vous pouvez passez en mode plein écran en pressant
    ensuite la touche « e » à l’invite de commande

    Vous pouvez indiquer les options de commande juste après
    « aptitude ».

    Tableau 2.7. Options importantes de la commande aptitude(8)

    +---------------------------------------------------------------+
    |option de la|                   description                    |
    |  commande  |                                                  |
    |------------+--------------------------------------------------|
    |-s          |simuler le résultat de la commande                |
    |------------+--------------------------------------------------|
    |-d          |télécharger seulement les paquets sans les        |
    |            |installer ni les mettre à jour                    |
    |------------+--------------------------------------------------|
    |-D          |afficher une courte explication avant les         |
    |            |installations ou les suppressions automatiques    |
    +---------------------------------------------------------------+


    Consultez aptitude(8) et le « manuel de l’utilisateur
    d’aptitude » à « /usr/share/doc/aptitude/README » pour en
    apprendre davantage.

    Astuce

    Le paquet dselect est encore disponible et était l’outil de
    gestion des paquets en mode plein écran préféré des versions
    précédentes.

%

2.2.3. Utilisation interactive d’aptitude

    Pour une gestion interactive des paquets, lancez aptitude en mode
    interactif depuis l’invite de l’interpréteur de commandes à la
    console comme suit :

    $ sudo aptitude -u
    Password:

    Cela va mettre à jour la copie locale des informations de
    l’archive et afficher la liste des paquets en plein écran avec un
    menu. On trouvera la configuration d’aptitude dans « ~/.aptitude/
    config ».

    Astuce

    Si vous désirez utiliser la configuration de l’administrateur
    (root) plutôt que celle de l’utilisateur, utilisez la commande
    « sudo -H aptitude … » en remplacement de « sudo aptitude … »
    dans l’expression précédente.

    Astuce

    Aptitude définit automatiquement les actions en attente lorsqu’il
    est lancé de manière interactive. Si elles ne vous conviennent
    pas, vous pouvez le réinitialiser depuis le menu : « Action » →
    « Annuler les opérations en attente ».

%

2.2.4. Raccourcis clavier d’aptitude

    Les raccourcis clavier principaux pour parcourir l’état des
    paquets et pour définir les « actions prévues » sur ces paquets
    dans le mode plein écran sont les suivants :

    Tableau 2.8. Liste des raccourcis clavier d’aptitude

    +---------------------------------------------------------------+
    |      touche       |                affectation                |
    |-------------------+-------------------------------------------|
    |F10 ou Ctrl-t      |menu                                       |
    |-------------------+-------------------------------------------|
    |?                  |afficher l’aide pour les raccourcis clavier|
    |                   |(liste plus complète)                      |
    |-------------------+-------------------------------------------|
    |F10 → Aide → Manuel|afficher le Manuel de l’utilisateur        |
    |de l’utilisateur   |                                           |
    |-------------------+-------------------------------------------|
    |u                  |mettre à jour les informations de l’archive|
    |                   |des paquets                                |
    |-------------------+-------------------------------------------|
    |+                  |marquer le paquet pour mise à niveau ou    |
    |                   |installation                               |
    |-------------------+-------------------------------------------|
    |-                  |marquer le paquet pour suppression         |
    |                   |(conserver ses fichiers de configuration)  |
    |-------------------+-------------------------------------------|
    |_                  |marquer le paquet pour être purgé          |
    |                   |(supprimer ses fichiers de configuration)  |
    |-------------------+-------------------------------------------|
    |=                  |mettre le paquet dans l’état « conservé »  |
    |-------------------+-------------------------------------------|
    |                   |marquer tous les paquets susceptibles de   |
    |U                  |mise à niveau (fonctionne comme            |
    |                   |full-upgrade)                              |
    |-------------------+-------------------------------------------|
    |g                  |lancer le téléchargement et l’installation |
    |                   |des paquets sélectionnés                   |
    |-------------------+-------------------------------------------|
    |q                  |quitter l’écran actuel et enregistrer les  |
    |                   |modifications                              |
    |-------------------+-------------------------------------------|
    |x                  |quitter l’écran actuel en abandonnant les  |
    |                   |modifications                              |
    |-------------------+-------------------------------------------|
    |Entrée             |afficher les informations concernant un    |
    |                   |paquet                                     |
    |-------------------+-------------------------------------------|
    |C                  |afficher le journal des modifications      |
    |                   |(« changelog ») d’un paquet                |
    |-------------------+-------------------------------------------|
    |l                  |modifier les limites pour les paquets      |
    |                   |affichés                                   |
    |-------------------+-------------------------------------------|
    |/                  |rechercher la première correspondance      |
    |-------------------+-------------------------------------------|
    |\                  |répéter la dernière recherche              |
    +---------------------------------------------------------------+


    L’indication du nom de fichier sur la ligne de commandes et à
    l’invite du menu après avoir pressé « l » et « // » prend
    l’expression rationnelle d’aptitude telle que décrite ci-dessous.
    Une expression rationnelle d’aptitude peut correspondre
    explicitement à un nom de paquet en utilisant une chaîne de
    caractères commençant par « ~n » et suivie du nom de paquet.

    Astuce

    Vous devrez presser « U » pour obtenir la mise à niveau de tous
    les paquets installés vers la version candidate de l’interface
    visuelle. Sinon, seuls les paquets sélectionnés et certains
    paquets ayant des dépendances versionnées sur ces paquets seront
    mis à niveau vers la version candidate.

%

2.2.5. Vues des paquets sous aptitude

    Dans le mode interactif en plein écran d’aptitude(8), les paquets
    de la liste des paquets sont affichés comme dans l’exemple
    suivant.

    idA   libsmbclient                             -2220ko 3.0.25a-1  3.0.25a-2

    Cette ligne signifie, en partant de la gauche :

      * Indicateur d’« état actuel » (la première lettre)

      * Indicateur d’« action prévue » (la seconde lettre)

      * Indicateur « automatique » (la troisième lettre)

      * Nom du paquet

      * Modification de l’utilisation du disque attribuée à
        l’« action prévue »

      * Version actuelle du paquet

      * Version candidate du paquet

    Astuce
   
    La liste complète des indicateurs est donnée en bas de l’écran d’
    Aide affiché en pressant « ? ».

    La version candidate est choisie en fonction des préférences
    locales actuelles (consultez apt_preferences(5) et Section 2.7.3,
    « Ajuster la version candidate »).

    Plusieurs types de vues de paquets sont disponibles depuis le
    menu « Vues ».

    Tableau 2.9. Liste des vues d’aptitude

    +---------------------------------------------------------------+
    |      vue      |   état   |       description de la vue        |
    |---------------+----------+------------------------------------|
    |               |          |consultez Tableau 2.10, « Classement|
    |Vue des paquets|Bon       |par catégories des vues de paquets  |
    |               |          |standard » (défaut)                 |
    |---------------+----------+------------------------------------|
    |               |          |liste des paquets qui sont          |
    |Recommandations|Bon       |recommandés par certains paquets    |
    |d’audit        |          |installés mais qui ne sont pas      |
    |               |          |encore installés sur le système     |
    |---------------+----------+------------------------------------|
    |Liste de paquet|          |liste des paquets sans regroupement |
    |« à plat »     |Bon       |par catégories (pour l’utilisation  |
    |               |          |avec des expressions rationnelles)  |
    |---------------+----------+------------------------------------|
    |Navigateur de  |Très      |liste des paquets classés selon leur|
    |Debtags        |utilisable|entrée debtags                      |
    |---------------+----------+------------------------------------|
    |Navigateur par |          |liste des paquets classés selon leur|
    |catégories     |Obsolète  |catégorie (utiliser plutôt Debtags  |
    |               |          |Browser)                            |
    +---------------------------------------------------------------+


    Note
   
    Merci de nous aider à améliorer le marquage des paquets avec
    debtags !

    La « Vue des paquets » standard classe les paquets un peu comme
    le fait dselect avec quelques fonctionnalités supplémentaires.

    Tableau 2.10. Classement par catégories des vues de paquets
    standard

    +---------------------------------------------------------------+
    |     catégorie     |           description de la vue           |
    |-------------------+-------------------------------------------|
    |Paquets            |liste des paquets organisée sous la forme  |
    |susceptibles de    |section → zone → paquet                    |
    |mise à jour        |                                           |
    |-------------------+-------------------------------------------|
    |Nouveaux paquets   |, ,                                        |
    |-------------------+-------------------------------------------|
    |Paquets installés  |, ,                                        |
    |-------------------+-------------------------------------------|
    |Paquets non        |, ,                                        |
    |installés          |                                           |
    |-------------------+-------------------------------------------|
    |Paquets obsolètes  |, ,                                        |
    |ou créés localement|                                           |
    |-------------------+-------------------------------------------|
    |Paquets virtuels   |liste des paquets ayant la même fonction   |
    |-------------------+-------------------------------------------|
    |                   |liste des paquets ayant les différentes    |
    |Tâches             |fonctions généralement nécessaires à une   |
    |                   |tâche                                      |
    +---------------------------------------------------------------+


    Astuce
   
    La vue des tâches peut être utilisée pour choisir les paquets
    nécessaires à votre tâche.

%

2.2.6. Options de la méthode de recherche avec aptitude

    Aptitude vous offre différentes options pour rechercher des
    paquets en utilisant sa formule d’expressions rationnelles.

      * Ligne de commande du shell :

          + « aptitude search '<expression_rationnelle_aptitude>' »
            afin d’afficher l’état d’installation, le nom du paquet
            et une courte description des paquets correspondants

          + « aptitude show '<nom_paquet>' » pour afficher la
            description détaillée du paquet

      * Mode interactif plein écran :
   
          + « l » pour limiter la vue des paquets à ceux qui
            correspondent

          + « / » pour rechercher un paquet correspondant

          + « \ » pour rechercher en arrière un paquet correspondant

          + « n » pour rechercher le suivant

          + « N » pour rechercher le suivant (en arrière)

    Astuce

    La chaîne du <nom_paquet> est traitée comme la correspondance
    exacte de chaîne pour le nom de paquet à moins qu’il ne soit
    lancé explicitement avec « ~ » pour être la formule d’expression
    rationnelle.

%

2.2.7. Les formules d’expressions rationnelles d’aptitude

    La formule des expressions rationnelles d’aptitude est étendue 
    ERE de manière similaire à mutt (consultez Section 1.6.2,
    « Expressions rationnelles ») et la signification des extensions
    de règles de correspondance spécifiques à aptitude est la
    suivante :

    Tableau 2.11. Liste des formules d’expressions rationnelles
    d’aptitude

    +--------------------------------------------------------------------+
    | description des |                                                  |
    | règles étendues |       formules d’expressions rationnelles        |
    |de correspondance|                                                  |
    |-----------------+--------------------------------------------------|
    |correspond au nom|~n<expression_rationnelle_nom>                    |
    |du paquet        |                                                  |
    |-----------------+--------------------------------------------------|
    |correspond à la  |~d<expression_rationnelle_description>            |
    |description      |                                                  |
    |-----------------+--------------------------------------------------|
    |correspond au nom|~t<expression_rationnelle_tâche>                  |
    |de la tâche      |                                                  |
    |-----------------+--------------------------------------------------|
    |correspond à     |                                                  |
    |l’étiquette      |~G<expression_rationnelle_debtag>                 |
    |debtag           |                                                  |
    |-----------------+--------------------------------------------------|
    |correspond au    |                                                  |
    |responsable du   |~m<expression_rationnelle_responsable>            |
    |paquet           |                                                  |
    |-----------------+--------------------------------------------------|
    |correspond à la  |~s<expression_rationnelle_section>                |
    |section du paquet|                                                  |
    |-----------------+--------------------------------------------------|
    |correspond à la  |~V<expression_rationnelle_version>                |
    |version du paquet|                                                  |
    |-----------------+--------------------------------------------------|
    |correspond à     |~A{bullseye,bookworm,sid}                         |
    |l’archive        |                                                  |
    |-----------------+--------------------------------------------------|
    |correspond à     |~O{debian,…}                                      |
    |l’origine        |                                                  |
    |-----------------+--------------------------------------------------|
    |correspond à la  |~p{extra,important,optional,required,standard}    |
    |priorité         |                                                  |
    |-----------------+--------------------------------------------------|
    |correspond aux   |                                                  |
    |paquets          |~E                                                |
    |essentiels       |                                                  |
    |-----------------+--------------------------------------------------|
    |correspond aux   |~v                                                |
    |paquets virtuels |                                                  |
    |-----------------+--------------------------------------------------|
    |correspond aux   |~N                                                |
    |nouveaux paquets |                                                  |
    |-----------------+--------------------------------------------------|
    |correspond aux   |~a                                                |
    |actions en       |{install,upgrade,downgrade,remove,purge,hold,keep}|
    |attente          |                                                  |
    |-----------------+--------------------------------------------------|
    |correspond aux   |~i                                                |
    |paquets installés|                                                  |
    |-----------------+--------------------------------------------------|
    |correspond aux   |                                                  |
    |paquets installés|                                                  |
    |ayant la marque A|~M                                                |
    |(paquets         |                                                  |
    |installés        |                                                  |
    |automatiquement) |                                                  |
    |-----------------+--------------------------------------------------|
    |correspond aux   |                                                  |
    |paquets installés|                                                  |
    |n’ayant pas la   |~i!~M                                             |
    |marque A (paquets|                                                  |
    |sélectionnés par |                                                  |
    |l’administrateur)|                                                  |
    |-----------------+--------------------------------------------------|
    |correspond aux   |                                                  |
    |paquets installés|~U                                                |
    |et pouvant être  |                                                  |
    |mis à jour       |                                                  |
    |-----------------+--------------------------------------------------|
    |correspond aux   |                                                  |
    |paquets supprimés|~c                                                |
    |mais non purgés  |                                                  |
    |-----------------+--------------------------------------------------|
    |correspond aux   |                                                  |
    |paquets          |                                                  |
    |supprimés, purgés|~g                                                |
    |ou pouvant être  |                                                  |
    |supprimés        |                                                  |
    |-----------------+--------------------------------------------------|
    |correspond aux   |                                                  |
    |paquets ayant une|~b                                                |
    |dépendance cassée|                                                  |
    |-----------------+--------------------------------------------------|
    |correspond aux   |                                                  |
    |paquets ayant une|~B<type>                                          |
    |dépendance cassée|                                                  |
    |de <type>        |                                                  |
    |-----------------+--------------------------------------------------|
    |correspond aux   |                                                  |
    |paquets filtrés  |                                                  |
    |par <motif> ayant|~D[<type>:]<motif>                                |
    |une dépendance de|                                                  |
    |<type>           |                                                  |
    |-----------------+--------------------------------------------------|
    |correspond aux   |                                                  |
    |paquets filtrés  |                                                  |
    |par <motif> ayant|~DB[<type>:]<motif>                               |
    |une dépendance   |                                                  |
    |cassée de <type> |                                                  |
    |-----------------+--------------------------------------------------|
    |correspond aux   |                                                  |
    |paquets vers     |                                                  |
    |lesquels le      |                                                  |
    |paquet filtré par|~R[<type>:]<motif>                                |
    |<motif> déclare  |                                                  |
    |une dépendance de|                                                  |
    |<type>           |                                                  |
    |-----------------+--------------------------------------------------|
    |correspond aux   |                                                  |
    |paquets vers     |                                                  |
    |lesquels le      |                                                  |
    |paquet filtré par|~RB[<type>:]<motif>                               |
    |<motif> a une    |                                                  |
    |dépendance cassée|                                                  |
    |de <type>        |                                                  |
    |-----------------+--------------------------------------------------|
    |correspond aux   |                                                  |
    |paquets desquels |                                                  |
    |dépendent        |~R~i                                              |
    |d’autres paquets |                                                  |
    |installés        |                                                  |
    |-----------------+--------------------------------------------------|
    |correspond aux   |                                                  |
    |paquets desquels |!~R~i                                             |
    |ne dépend aucun  |                                                  |
    |autre paquet     |                                                  |
    |-----------------+--------------------------------------------------|
    |correspond aux   |                                                  |
    |paquets vers     |                                                  |
    |lesquels d’autres|                                                  |
    |paquets installés|~R~i|~Rrecommends:~i                              |
    |dépendent ou     |                                                  |
    |qu’ils           |                                                  |
    |recommandent     |                                                  |
    |-----------------+--------------------------------------------------|
    |correspond au    |                                                  |
    |paquet <motif>   |~S filter <motif>                                 |
    |dont la version  |                                                  |
    |est filtrée      |                                                  |
    |-----------------+--------------------------------------------------|
    |correspond à tous|                                                  |
    |les paquets      |~T                                                |
    |(vrai)           |                                                  |
    |-----------------+--------------------------------------------------|
    |ne correspond à  |                                                  |
    |aucun paquet     |~F                                                |
    |(faux)           |                                                  |
    +--------------------------------------------------------------------+


      * La partie expression rationnelle est la même ERE que celle
        utilisée dans les outils UNIX typiques en utilisant « ^ »,
        « .* », « $ » etc. comme dans egrep(1), awk(1) et perl(1).

      * La dépendance <type> est comprise dans la liste (depends,
        predepends, recommends, suggests, conflicts, replaces,
        provides) et spécifie les relations du paquet avec d’autres
        paquets.

      * Le <type> de relation par défaut est « depends ».

    Astuce

    Lorsqu’un <motif d’expression rationnelle> (« regex_pattern> »)
    est une chaîne de caractères vide, placez « ~T » directement
    après la commande.

    Voici quelques raccourcis.

      * « ~P<term> » == « ~Dprovides:<term> »

      * « ~C<term> » == « ~Dconflicts:<term> »

      * « …~W term » == « (…|term) »

    Les utilisateurs familiers avec mutt comprendront rapidement car
    mutt a été la source d’inspiration pour la syntaxe des
    expressions. Consultez « SEARCHING, LIMITING, AND EXPRESSIONS »
    dans le manuel de l’utilisateur (« /usr/share/doc/aptitude/
    README »).

    Note

    Avec la version lenny d’aptitude(8), la nouvelle forme longue de
    la syntaxe comme « ?broken » peut être utilisée pour la
    correspondance des expressions rationnelles en remplacement de
    l’ancien équivalent « ~b » en forme courte. Le caractère
    d’espacement «   » est maintenant considéré comme l’un des
    caractères de terminaison d’une expression rationnelle en plus du
    caractère tilde « ~ ». Consultez la syntaxe de la nouvelle forme
    longue dans le « Manuel de l’utilisateur ».

%

2.2.8. Résolution des dépendances par aptitude

    La sélection d’un paquet dans aptitude récupère non seulement les
    paquets définis dans son champ « Depends: » mais aussi ceux
    définis dans le champ « Recommends: » si la configuration a été
    faite dans ce sens dans le menu « F10 → Options → Préférences →
    Gestion des dépendances ». Ces paquets installés automatiquement
    seront supprimés automatiquement s’ils ne sont plus nécessaires
    sous aptitude.

    Le drapeau contrôlant le comportement "auto install" de la
    commande aptitude peut aussi être manipulé en utilisant la
    commande apt-mark(8) du paquet apt.

%

2.2.9. Journaux d’activité des paquets

    Vous pouvez vérifier l’activité de l’historique des paquets dans
    les fichiers journaux.

    Tableau 2.12. Fichiers journaux de l’activité des paquets

    +---------------------------------------------------------------+
    |   fichier   |                     contenu                     |
    |-------------+-------------------------------------------------|
    |/var/log/    |Enregistrement des actions au niveau de dpkg pour|
    |dpkg.log     |l’activité de tous les paquets                   |
    |-------------+-------------------------------------------------|
    |/var/log/apt/|Journal de l’activité générique d’APT            |
    |term.log     |                                                 |
    |-------------+-------------------------------------------------|
    |/var/log/    |Journal des actions de la commande aptitude      |
    |aptitude     |                                                 |
    +---------------------------------------------------------------+


    En réalité, il n’est pas aussi facile de comprendre la
    signification de ces journaux. Consultez Section 9.2.10,
    « Enregistrer les modifications dans des fichiers de
    configuration » pour une façon de faire plus simple.

%

2.3. Exemples d’opérations avec aptitude

    Voici quelques exemples d’opérations d’aptitude(8).

2.3.1. Afficher les paquets dont les noms correspondent à une
expression rationnelle

    La commande suivante affiche les paquets dont les noms
    correspondent à une expression rationnelle.

    $ aptitude search '~n(pam|nss).*ldap'
    p libnss-ldap - NSS module for using LDAP as a naming service
    p libpam-ldap - Pluggable Authentication Module allowing LDAP interfaces

    Il vous est assez facile de trouver le nom exact d’un paquet.

%

2.3.2. Parcours en correspondance avec une expression rationnelle

    L’expression rationnelle « ~dipv6 » entrée dans la vue « Nouvelle
    liste des paquets » (« New Flat Package List » depuis l’invite
    « l » limite la vue aux paquets dont la description correspond à
    cette expression rationnelle et vous permet de parcourir les
    informations de manière interactive.

%

2.3.3. Purger pour de bon les paquets supprimés

    Vous pouvez supprimer tous les fichiers de configuration
    subsistant des paquets supprimés.

    Vérifiez le résultat de la commande suivante :

    # aptitude search '~c'

    Si vous pensez que les paquets affichés doivent être purgés,
    exécutez la commande suivante :

    # aptitude purge '~c'

    Vous pouvez avoir envie de faire la même chose en mode interactif
    avec un contrôle plus fin.

    Indiquez l’expression rationnelle « ~c » dans la « Nouvelle liste
    des paquets » en utilisant l’invite « l ». Cela limite la vue des
    paquets à ceux qui correspondent à l’expression rationnelle,
    c’est-à-dire « supprimé mais non purgé ». On peut visualiser tous
    les paquets correspondant à cette expression rationnelle en
    pressant « [ » depuis une section de haut niveau.

    Pressez ensuite « _ » depuis une fenêtre de haut niveau comme
    « Paquets non installés ». Seuls les paquets correspondants à
    l’expression rationnelle se trouvant dans cette section seront
    marqués comme devant être purgés par cette commande. Vous pouvez
    exclure certains paquets de cette opération en pressant de
    manière interactive la touche « = » en face de chacun d’eux.

    Cette technique est assez pratique et fonctionne avec de
    nombreuses autres touches de commande.

%

2.3.4. Toilettage de l’état d’installation automatique/manuel

    Voici comment je nettoie l’état d’installation automatique/manuel
    des paquets (après avoir utilisé un installateur de paquets autre
    qu’aptitude, etc.).

     1. Démarrer aptitude en mode interactif en tant
        qu’administrateur.

     2. Entrer « u », « U », « f » et « g » pour mettre à jour la
        liste des paquets et mettre à niveau les paquets.

     3. Entrer « l » afin de définir la limite d’affichage des
        paquets avec « ~i(~R~i|~Rrecommends:~i) » et entrez « M » sur
        « Paquets installés » automatiquement.

     4. Entrer « l » afin de définir la limite d’affichage des
        paquets avec « ~prequired|~pimportant|~pstandard|~E » et
        entrez « m » sur les « Paquets installés » manuellement.

     5. Entrer « l » pour définir la limite d’affichage des paquets
        avec « ~i!~M » et supprimez tous les paquets inutilisés en
        entrant - » sur chacun d’eux après les avoir affichés en
        entrant « [ » sur « Paquets installés ».
   
     6. Entrer « l » pour définir la limite d’affichage des paquets
        avec « ~i » puis entrez m » sur les « Tâches » pour attribuer
        un marquage « manuellement installé » aux paquets.

     7. Quitter aptitude.

     8. Lancer « apt-get -s autoremove|less » en tant
        qu’administrateur pour vérifier les paquets non utilisés.

     9. Redémarrer aptitude en mode interactif et marquer les paquets
        nécessaires comme « m ».

    10. Redémarrer « apt-get -s autoremove|less » en tant
        qu’administrateur et vérifier à nouveau que « REMOVED » ne
        contient que les paquets voulus.

    11. Lancer « apt-get autoremove|less » en tant qu’administrateur
        pour supprimer automatiquement les paquets inutilisés.

    L’action « m » sur les « Tâches » est facultative pour éviter une
    situation de suppression en masse de paquets dans le futur.

%

2.3.5. Mise à jour pour l’ensemble du système

    Note

    Lors du changement vers une nouvelle version, etc., vous devriez
    envisager d’effectuer une installation propre d’un nouveau
    système même si Debian peut être mis à niveau comme décrit
    ci-dessous. Cela vous donne une chance de supprimer les résidus
    amassés et vous présente la meilleure combinaison des derniers
    paquets. Bien entendu, vous devrez effectuer une sauvegarde
    totale de votre système vers un endroit sûr (consultez
    Section 10.2, « Sauvegarde et restauration ») avant de faire
    cela. Je vous recommande de faire une configuration dual boot en
    utilisant des partitions différentes afin d’effectuer une
    transition en douceur.

    Vous pouvez effectuer une mise à niveau de l’ensemble du système
    vers une nouvelle version en modifiant le contenu du fichier « /
    etc/apt/sources.list » pour qu’il pointe vers la nouvelle version
    et en lançant la commande « apt update; apt dist-upgrade ».

    Pour effectuer la mise à jour depuis stable vers testing ou
    unstable, remplacez « bullseye » dans le fichier « /etc/apt/
    sources.list » d’exemple donné dans Section 2.1.4, « Bases
    concernant l’archive Debian » par « bookworm » ou « sid ».

    En réalité, vous pouvez rencontrer quelques complications en
    raison de problèmes de transition de paquets, le plus souvent
    pour des problèmes de dépendances de paquets. Plus la mise à jour
    est importante, plus vous avez de chances de rencontrer des
    problèmes importants. Lors de la transition de l’ancienne version
    stable vers la nouvelle version stable après sa diffusion, afin
    de minimiser les problèmes vous pouvez lire ses nouvelles Notes
    de diffusion et suivre la procédure exacte qui y est décrite.

    Lorsque vous décidez de changer de la version stable vers la
    version testing avant sa diffusion formelle, il n’y a pas de
    Notes de diffusion pour vous aider. La différence entre stable et
    testing peut être devenue assez importante depuis la diffusion de
    la version stable précédente et rendre compliquée la situation de
    la mise à jour.

    Vous devriez aller vers la mise à niveau complète avec précaution
    tout en récupérant les dernières informations depuis les listes
    de diffusion et en usant de bon sens.

     1. Lire les « Notes de diffusion » précédentes.

     2. Faire la sauvegarde de l’ensemble du système
        (particulièrement les données et les informations de
        configuration).

     3. Avoir un support amorçable prêt au cas où le chargeur initial
        serait cassé.

     4. Informer les utilisateurs du système bien à l’avance.

     5. Enregistrer l’activité de mise à jour avec script(1).

     6. Appliquer « unmarkauto » aux paquets nécessaires, par exemple
        « aptitude unmarkauto vim », afin d’en éviter la suppression.

     7. Minimiser les paquets installés pour réduire les chances de
        conflits de paquets, par exemple supprimer les paquets de la
        tâche « bureau ».

     8. Supprimer le fichier « /etc/apt/preferences » (désactiver
        l’épinglage apt « apt-pinning »).

     9. Essayer de mettre à jour par étapes  : oldstable → stable →
        testing → unstable.

    10. Mettre à jour le fichier « /etc/apt/sources.list » afin qu’il
        pointe uniquement vers la nouvelle archive et lancer
        « aptitude update ».

    11. Installer d’abord, de manière facultative, le nouveau core
        packages, par exemple « aptitude install perl »

    12. Lancer la commande « apt-get -s dist-upgrade » pour contrôler
        quel en sera l’impact.

    13. Et enfin lancer la commande « apt-get dist-upgrade ».

    Attention
   
    Il n’est pas sage de sauter une version majeure de Debian lors de
    la mise à niveau entre versions stable.

    Attention

    Dans les « Notes de diffusion » précédentes, GCC, Linux Kernel,
    initrd-tools, Glibc, Perl, APT tool chain, etc. ont demandé une
    attention particulière pour une mise à niveau de l’ensemble du
    système.

    Pour une mise à jour quotidienne d’unstable, consultez
    Section 2.4.3, « Protection contre les problèmes de paquets ».

2.4. Opérations avancées de gestion des paquets

2.4.1. Opérations avancées de gestion des paquets en ligne de
commandes

    Voici la liste des autres opérations de gestion des paquets pour
    lesquelles aptitude est de trop haut niveau ou n’a pas la
    fonctionnalité requise.

    Tableau 2.13. Liste des opérations avancées de gestion des
    paquets

    +---------------------------------------------------------------+
    |      commande       |                 action                  |
    |---------------------+-----------------------------------------|
    |COLUMNS=120 dpkg -l  |afficher l’état d’un paquet installé pour|
    |<motif_nom_paquet>   |le signalement de bogue                  |
    |---------------------+-----------------------------------------|
    |dpkg -L <nom_paquet> |afficher le contenu d’un paquet installé.|
    |---------------------+-----------------------------------------|
    |dpkg -L <nom_paquet> |afficher les pages de manuel d’un paquet |
    || egrep '/usr/share/ |installé.                                |
    |man/man.*/.+'        |                                         |
    |---------------------+-----------------------------------------|
    |dpkg -S              |afficher les paquets installés dont le   |
    |<motif_nom_fichier>  |nom correspond                           |
    |---------------------+-----------------------------------------|
    |apt-file search      |afficher les paquets de l’archive dont le|
    |<motif_nom_fichier>  |nom correspond                           |
    |---------------------+-----------------------------------------|
    |apt-file list        |afficher le contenu d’un paquet          |
    |<motif_nom_paquet>   |correspondant de l’archive               |
    |---------------------+-----------------------------------------|
    |dpkg-reconfigure     |reconfigurer le paquet exact             |
    |<nom_paquet>         |                                         |
    |---------------------+-----------------------------------------|
    |dpkg-reconfigure -p= |reconfigurer le paquet exact avec la     |
    |low <nom_paquet>     |question la plus détaillée               |
    |---------------------+-----------------------------------------|
    |configure-debian     |reconfigurer les paquets depuis le menu  |
    |                     |en plein écran                           |
    |---------------------+-----------------------------------------|
    |dpkg --audit         |système de vérification des paquets      |
    |                     |partiellement installés                  |
    |---------------------+-----------------------------------------|
    |dpkg --configure -a  |configurer tous les paquets partiellement|
    |                     |installés                                |
    |---------------------+-----------------------------------------|
    |apt-cache policy     |afficher la version disponible, la       |
    |<nom_paquet_binaire> |priorité et les informations concernant  |
    |                     |l’archive du paquet binaire              |
    |---------------------+-----------------------------------------|
    |apt-cache madison    |afficher la version disponible et les    |
    |<nom_paquet>         |informations de l’archive concernant un  |
    |                     |paquet                                   |
    |---------------------+-----------------------------------------|
    |apt-cache showsrc    |afficher les informations concernant le  |
    |<nom_paquet_binaire> |paquet source d’un paquet binaire        |
    |---------------------+-----------------------------------------|
    |apt-get build-dep    |installer les paquets nécessaires à la   |
    |<nom_paquet>         |construction d’un paquet                 |
    |---------------------+-----------------------------------------|
    |aptitude build-dep   |installer les paquets nécessaires à la   |
    |<nom_paquet>         |construction d’un paquet                 |
    |---------------------+-----------------------------------------|
    |apt-get source       |télécharger une source (depuis l’archive |
    |<nom_paquet>         |standard)                                |
    |---------------------+-----------------------------------------|
    |dget <URL pour le    |télécharger un paquet source (depuis une |
    |fichier dsc>         |autre archive)                           |
    |---------------------+-----------------------------------------|
    |dpkg-source -x       |construire une arborescence source depuis|
    |<nom_paquet>_        |un ensemble de paquets source            |
    |<version>-           |(« *.tar.gz » et « *.diff.gz »)          |
    |<version_debian>.dsc |                                         |
    |---------------------+-----------------------------------------|
    |debuild binary       |construire des paquets depuis une        |
    |                     |arborescence source locale               |
    |---------------------+-----------------------------------------|
    |make-kpkg            |construire un paquet du noyau à partir de|
    |kernel_image         |l’arborescence source du noyau           |
    |---------------------+-----------------------------------------|
    |make-kpkg --initrd   |construire un paquet du noyau à partir de|
    |kernel_image         |l’arborescence source du noyau avec      |
    |                     |initramfs activé                         |
    |---------------------+-----------------------------------------|
    |dpkg -i <nom_paquet>_|                                         |
    |<version>-           |installer un paquet local sur le système |
    |<version_debian>_    |                                         |
    |<arch>.deb           |                                         |
    |---------------------+-----------------------------------------|
    |apt install /chemin/ |install a local package to the system,   |
    |vers/<nom_paquet>.dev|meanwhile try to resolve dependency      |
    |                     |automatically                            |
    |---------------------+-----------------------------------------|
    |debi <nom_paquet>_   |                                         |
    |<version>-           |installer des paquets locaux sur le      |
    |<version_debian>_    |système                                  |
    |<arch>.dsc           |                                         |
    |---------------------+-----------------------------------------|
    |dpkg --get-selections|enregistrer l’information d’état de la   |
    |'*' >selection.txt   |sélection des paquets au niveau de dpkg  |
    |---------------------+-----------------------------------------|
    |dpkg --set-selections|définir l’information d’état de sélection|
    |<selection.txt       |des paquets au niveau de dpkg            |
    |---------------------+-----------------------------------------|
    |echo <nom_paquet>    |définir l’information d’état de sélection|
    |hold | dpkg          |des paquets au niveau de dpkg à hold     |
    |--set-selections     |(gelé, équivalent à aptitude hold        |
    |                     |<nom_paquet>)                            |
    +---------------------------------------------------------------+


    Note

    Pour les paquets disponibles en multi-arch(itectures), certaines
    commandes devront parfois être complétées du nom de
    l’architecture cible. Il faut, par exemple, utiliser « dpkg -L
    libglib2.0-0:amd64 » pour obtenir une liste du contenu du paquet
    libglib2.0-0 dans son architecture amd64.

    Attention

    Un outil de plus bas niveau tel que « dpkg -i … » et « debi … »
    devra être utilisé avec précautions par l’administrateur du
    système. Il ne s’assure pas automatiquement des dépendances
    exigées par le paquet. Les options « --force-all » et similaires
    de la ligne de commandes de dpkg (consultez dpkg(1)) ne sont
    prévues pour être utilisées que par des experts. Les utiliser
    sans comprendre entièrement leurs effets peut casser l’ensemble
    de votre système.

    Veuillez noter ce qui suit :

      * Toutes les commandes de configuration et d’installation
        doivent être lancées avec le compte de l’administrateur.

      * Au contraire d’aptitude qui utilise des expressions
        rationnelles (consultez Section 1.6.2, « Expressions
        rationnelles »), les autres commandes de gestion des paquets
        utilisent des motifs semblables aux motifs génériques
        (« glob ») de l’interpréteur de commandes (consultez
        Section 1.5.6, « Motifs génériques (« glob ») de
        l’interpréteur de commandes »).

      * La commande apt-file(1) fournie par le paquet apt-file doit
        être précédée de l’exécution de la commande « apt-file
        update ».

      * configure-debian(8) fourni par le paquet configure-debian
        exécute en fond dpkg-reconfigure(8).

      * dpkg-reconfigure(8) exécute les scripts du paquet en
        utilisant en fond debconf(1).

      * Les commandes « apt-get build-dep », « apt-get source » et
        « apt-cache showsrc » ont besoin d’une entrée « deb-src »
        dans « /etc/apt/sources.list ».

      * dget(1), debuild(1) etdebi(1) ont besoin du paquet
        devscripts.

      * Consultez la procédure de (re)paquetage en utilisant
        « apt-get source » dans Section 2.7.13, « Porter un paquet
        vers le système stable ».

      * La commande make-kpkg exige le paquet kernel-package
        (consultez Section 9.9, « Le noyau »).

      * Consultez Section 12.11, « Créer un paquet Debian » pour la
        réalisation de paquets en général.

%

2.4.2. Vérifier les fichiers de paquets installés

    L’installation de debsums permet, avec debsums(1), la
    vérification des fichiers des paquets installés d’après les
    valeurs de MD5sum se trouvant dans le fichier « /var/lib/dpkg/
    info/*.md5sums » Consultez Section 10.3.5, « La somme de contrôle
    MD5 » pour le fonctionnement de MD5sum.

    Note

    Comme la base de données MD5sum peut être trafiquée par un
    intrus, debsums(1) est d’une utilité restreinte en tant qu’outil
    de sécurité. Il n’est bon que pour la vérification locale des
    modifications de l’administrateur ou des défectuosités en raison
    de problèmes de support.

%

2.4.3. Protection contre les problèmes de paquets

    De nombreux utilisateurs préfèrent suivre la version unstable du
    système Debian parce qu’elle propose de nouvelles fonctionnalités
    et de nouveaux paquets. Cela rend le système davantage sujet aux
    bogues critiques de paquets.

    L’installation du paquet apt-listbugs protège votre système
    contre les bogues critiques en recherchant automatiquement dans
    le BTS de Debian les bogues critiques lors de la mise à jour par
    l’intermédiaire du système APT.

    L’installation du paquet apt-listchanges indique les nouveautés
    importantes se trouvant dans « NEWS.Debian » lors de la mise à
    jour du système avec APT.

%

2.4.4. Rechercher dans les métadonnées du paquet

    Bien que visiter le site Debian à https://packages.debian.org/
    permette aujourd’hui de rechercher facilement les métadonnées des
    paquets, voyons les méthodes plus traditionnelles .

    Les commandes grep-dctrl(1), grep-status(1) et grep-available(1)
    peuvent être utilisées pour effectuer des recherches dans tous
    les fichiers dont le format général est celui d’un fichier de
    contrôle de Debian.

    « dpkg -S <motif_nom_fichier> » peut être utilisé pour rechercher
    les noms de paquets installés par dpkg qui contiennent des
    fichiers dont le nom correspond au motif. Mais les fichiers créés
    par les scripts du responsable du paquet ne sont pas pris en
    compte.

    Si vous devez faire des recherches plus élaborées sur les
    métadonnées de dpkg, il vous faudra lancer la commande « grep -e
    motif_expression_rationnelle * » dans le répertoire « /var/lib/
    dpkg/info/ ». Cela vous permet de rechercher des mots mentionnés
    dans les scripts des paquets et les textes des requêtes
    d’installation.

    Pour rechercher de manière récursive les dépendances de paquets,
    vous devrez utiliser apt-rdepends(8).

%

2.5. Fonctionnement interne de la gestion des paquets Debian

    Voyons comment le système Debian de gestion des paquets
    fonctionne de manière interne. Cela vous permettra de créer votre
    propre solution à certains problèmes de paquets.

%

2.5.1. Métadonnées de l’archive

    Les fichiers de métadonnées de chaque distribution se trouvent
    sur chaque miroir Debian, dans « dist/<nom_de_code> », par
    exemple, « http://deb.debian.org/debian/ ». On peut parcourir la
    structure de son archive à l’aide d’un navigateur web. Il existe
    6 types de métadonnées clés :

    Tableau 2.14. Contenu des métadonnées de l’archive Debian

    +---------------------------------------------------------------+
    |   fichier    |      emplacement      |        contenu         |
    |--------------+-----------------------+------------------------|
    |              |sommet de la           |description de l’archive|
    |Release       |distribution           |et informations         |
    |              |                       |d’intégrité             |
    |--------------+-----------------------+------------------------|
    |              |                       |fichier signature du    |
    |Release.gpg   |sommet de la           |fichier « Release »     |
    |              |distribution           |signé avec la clé de    |
    |              |                       |l’archive               |
    |--------------+-----------------------+------------------------|
    |              |                       |liste de tous les       |
    |Contents-     |sommet de la           |fichiers pour tous les  |
    |<architecture>|distribution           |paquets dans l’archive  |
    |              |                       |pertinente              |
    |--------------+-----------------------+------------------------|
    |              |sommet de chaque       |description de l’archive|
    |Release       |combinaison de         |utilisée pour la règle  |
    |              |distribution/section/  |de apt_preferences(5)   |
    |              |architecture           |                        |
    |--------------+-----------------------+------------------------|
    |              |sommet de chaque       |debian/control          |
    |Packages      |combinaison de         |concaténés des paquets  |
    |              |distribution/section/  |binaires                |
    |              |architecture binaire   |                        |
    |--------------+-----------------------+------------------------|
    |              |sommet de chaque       |debian/control          |
    |Sources       |combinaison            |concaténés des paquets  |
    |              |distribution/section/  |sources                 |
    |              |source                 |                        |
    +---------------------------------------------------------------+


    Dans les archives récentes, ces métadonnées sont enregistrées
    sous forme compressée et différentielle afin de limiter le trafic
    réseau.

%

2.5.2. Fichier « Release » de plus haut niveau et authenticité

    Astuce
   
    Le fichier « Release » de plus haut niveau est utilisé pour
    signer l’archive au moyen du système secure APT.

    Chaque version de l’archive Debian possède un fichier « Release »
    de plus haut niveau, par exemple, « http://deb.debian.org/debian/
    dists/unstable/Release », comme ci-dessous :

    Origin: Debian
    Label: Debian
    Suite: unstable
    Codename: sid
    Date: Sat, 14 May 2011 08:20:50 UTC
    Valid-Until: Sat, 21 May 2011 08:20:50 UTC
    Architectures: alpha amd64 armel hppa hurd-i386 i386 ia64 kfreebsd-amd64 kfreebsd-i386 mips mipsel powerpc s390 sparc
    Components: main contrib non-free
    Description: Debian x.y Unstable - Not Released
    MD5Sum:
     bdc8fa4b3f5e4a715dd0d56d176fc789 18876880 Contents-alpha.gz
     9469a03c94b85e010d116aeeab9614c0 19441880 Contents-amd64.gz
     3d68e206d7faa3aded660dc0996054fe 19203165 Contents-armel.gz
    ...

    Note

    Vous pouvez trouver ici ma justification pour l’utilisation de
    « suite », « nom de code » dans Section 2.1.4, « Bases concernant
    l’archive Debian ». La « distribution » est utilisée pour
    désigner à la fois « suite » et « nom de code ». Tous les noms
    possibles de « sections » de l’archive sont indiqués dans
    l’archive sous « Composants ».

    L’intégrité du fichier « Release » de plus haut niveau est
    vérifiée par une infrastructure cryptographique appelée secure
    apt.

      * Le fichier de signature chiffré « Release.gpg » est créé à
        partir du fichier « Release » réel de plus haut niveau et de
        la clé secrète de l’archive Debian.

      * La clé publique de l’archive Debian peut être placée dans « /
        etc/apt/trusted.gpg » ;

          + automatiquement en installant le trousseau de clés avec
            la dernière version du paquet base-files, ou

          + manuellement, avec les outils gpg ou apt-key en utilisant
            la dernière clé publique de l’archive postée sur
            ftp-master.debian.org.

      * Le système secure APT vérifie de manière cryptographique, à
        l’aide du fichier « Release.gpg » et de la clé publique de
        l’archive Debian de « /etc/apt/trusted.gpg », l’intégrité du
        fichier « Release » de plus haut niveau téléchargé .

    L’intégrité de tous les fichiers « Packages » et « Sources » est
    vérifiée en utilisant les valeurs des sommes MD5 se trouvant dans
    son fichier de plus haut niveau « Release ». L’intégrité de tous
    les fichiers de paquets est vérifiée en utilisant les valeurs des
    sommes MD5 se trouvant dans les fichiers « Packages » et
    « Sources ». Consultez debsums(1) et Section 2.4.2, « Vérifier
    les fichiers de paquets installés ».

    Comme la vérification de la signature cryptographique est un
    processus beaucoup plus consommateur de processeur que les
    calculs de sommes MD5, l’utilisation d’une somme MD5 pour chacun
    des paquets tout en utilisant une signature cryptographique pour
    le fichier « Release » de plus haut niveau allie une bonne
    sécurité avec de bonnes performances (consultez Section 10.3,
    « Infrastructure de sécurité des données »).

%

2.5.3. Fichiers « Release » au niveau de l’archive

    Astuce
   
    Les fichiers « Release » au niveau de l’archive sont utilisés
    pour la règle d’apt_preferences(5).

    Il y a des fichiers « Release » du niveau de l’archive pour tous
    les emplacements d’archives indiqués par une ligne « deb » dans
    « /etc/apt/sources.list » comme, par exemple, « http://
    deb.debian.org/debian/dists/unstable/main/binary-amd64/Release »
    ou « http://deb.debian.org/debian/dists/sid/main/binary-amd64/
    Release » comme suit :

    Archive: unstable
    Origin: Debian
    Label: Debian
    Component: main
    Architecture: amd64

    Attention

    Pour l’entrée « Archive: », les noms de version (« stable »,
    « testing », « unstable », …) sont utilisés dans l’archive Debian
    alors que les noms de code (« trusty", « xenial », « artful », …)
    sont utilisés dans l’archive Ubuntu.

    Pour certaines archives, comme experimental et
    bullseye-backports, qui contiennent des paquets qui ne devraient
    pas être installés automatiquement, il y a une ligne
    supplémentaire, par exemple « http://deb.debian.org/debian/dists/
    experimental/main/binary-amd64/Release » comme suit :

    Archive: experimental
    Origin: Debian
    Label: Debian
    NotAutomatic: yes
    Component: main
    Architecture: amd64

    Remarquez que les archives normales, sans « NotAutomatic: yes »,
    la valeur par défaut de « Pin-Priority » est de 500, alors que
    pour les archives spéciales avec « NotAutomatic: yes » la valeur
    par défaut de « Pin-Priority » est de 1 (consultez 
    apt_preferences(5) et Section 2.7.3, « Ajuster la version
    candidate »).

%

2.5.4. Récupérer les métadonnées d’un paquet

    Lorsqu’on utilise les outils APT, comme aptitude, apt-get,
    synaptic, apt-file, auto-apt, etc., il faut mettre à jour les
    copies locales des métadonnées contenant les informations de
    l’archive Debian. Ces copies locales ont les noms de fichier
    suivants, correspondant aux noms de la distribution, de la
    section et de l’architecture indiquées dans « /etc/apt/
    sources.list » (consultez Section 2.1.4, « Bases concernant
    l’archive Debian »).

      * « /var/lib/apt/lists/deb.debian.org_debian_dists_
        <distribution>_Release »

      * « /var/lib/apt/lists/deb.debian.org_debian_dists_
        <distribution>_Release.gpg »

      * « /var/lib/apt/lists/deb.debian.org_debian_dists_
        <distribution>_<area>_binary-<architecture>_Packages »

      * « /var/lib/apt/lists/deb.debian.org_debian_dists_
        <distribution>_<area>_source_Sources »

      * « /var/cache/apt/apt-file/deb.debian.org_debian_dists_
        <distribution>_Contents-<architecture>.gz » (pour apt-file)

    Les quatre premiers types de fichiers sont partagés par toutes
    les commandes APT pertinentes et sont mis à jour depuis la ligne
    de commandes par « apt-get update » ou « aptitude update ». Les
    métadonnées « Packages » sont mises à jour s’il y a une ligne
    « deb » dans le fichier « /etc/apt/sources.list ». Les
    métadonnées « Sources » sont mises à jour s’il y a une ligne
    « deb-src » dans le fichier « /etc/apt/sources.list ».

    Les métadonnées « Packages » et « Sources » contiennent une
    entrée « Filename: » pointant vers l’emplacement du paquet
    binaire et du paquet source. Actuellement, ces paquets sont
    situés dans l’arborescence du répertoire « pool/ » afin
    d’améliorer le passage d’une version à l’autre.

    On peut effectuer des recherches interactivement dans les copies
    locales des métadonnées « Packages » à l’aide d’aptitude. La
    commande de recherche spécialisée grep-dctrl(1) peut effectuer
    des recherches dans les copies locales des métadonnées
    « Packages » et « Sources ».

    La copie locale des métadonnées « Contents-<architecture> » peut
    être mise à jour par « apt-file update », son emplacement est
    différent des quatre autres. Consultez apt-file(1). (auto-apt
    utilise par défaut un emplacement différent pour la copie locale
    de « Contents-<architecture>.gz »).

%

2.5.5. État des paquets pour APT

    En plus des métadonnées récupérées par téléchargement, l’outil
    APT des versions ultérieures à Lenny enregistre l’état de
    l’installation généré localement dans « /var/lib/apt/
    extended_states » qui est utilisé par tous les outils APT afin de
    suivre tous les paquets installés automatiquement.

%

2.5.6. État des paquets pour aptitude

    En plus des métadonnées récupérées par téléchargement, la
    commande aptitude enregistre l’état de l’installation généré
    localement dans « /var/lib/aptitude/pkgstates » qu’il est le seul
    à utiliser.

%

2.5.7. Copies locales des paquets téléchargés

    Tous les paquets ayant été téléchargés au moyen du mécanisme APT
    sont enregistrés dans le répertoire « /var/cache/apt/archives »
    jusqu’à ce qu’ils en soient supprimés.

    Cette politique de nettoyage des fichiers de cache pour aptitude
    peut être spécifiée sous « Options » → « Préférences » et peut
    être déclenchée manuellement par le menu « Nettoyer le cache des
    paquets » ou « Enlever les fichiers périmés » sous « Actions ».

%

2.5.8. Nom de fichier d’un paquet Debian

    Les fichiers de paquets Debian ont une structure de nom
    particulière.

    Tableau 2.15. Structure du nom des paquets Debian :

    +---------------------------------------------------------------+
    |        type de paquet         |       structure du nom        |
    |-------------------------------+-------------------------------|
    |                               |<package-name>_                |
    |Paquet binaire (encore appelé  |<upstream-version>-            |
    |deb)                           |<debian-version>_              |
    |                               |<architecture>.deb             |
    |-------------------------------+-------------------------------|
    |Le paquet binaire de           |<package-name>_                |
    |l’installateur de Debian (connu|<upstream-version>-            |
    |sous le nom udeb)              |<debian-version>_              |
    |                               |<architecture>.udeb            |
    |-------------------------------+-------------------------------|
    |                               |<package-name>_                |
    |paquet source (source amont)   |<upstream-version>-            |
    |                               |<debian-version>.orig.tar.gz   |
    |-------------------------------+-------------------------------|
    |Paquet source 1.0              |<package-name>_                |
    |(modifications Debian)         |<upstream-version>-            |
    |                               |<debian-version>.diff.gz       |
    |-------------------------------+-------------------------------|
    |Paquet source 3.0 (quilt)      |<package-name>_                |
    |(modifications Debian)         |<upstream-version>-            |
    |                               |<debian-version>.debian.tar.gz |
    |-------------------------------+-------------------------------|
    |                               |<package-name>_                |
    |paquet source (description)    |<upstream-version>-            |
    |                               |<debian-version>.dsc           |
    +---------------------------------------------------------------+


    Astuce
   
    Seuls les formats de paquets source de base sont décrits ici.
    Consultez dpkg-source(1) pour davantage d’informations.

    Tableau 2.16. Caractères utilisables pour chacune des composantes
    des noms de paquets Debian

    +---------------------------------------------------------------+
    |   nom de la    |caractères utilisables (expression |existence |
    |   composante   |           rationnelle)            |          |
    |----------------+-----------------------------------+----------|
    |<nom_paquet>    |[a-z,A-Z,0-9,.,+,-]+               |nécessaire|
    |----------------+-----------------------------------+----------|
    |<epoch>:        |[0-9]+:                            |optionnel |
    |----------------+-----------------------------------+----------|
    |<version_amont> |[a-z,A-Z,0-9,.,+,-,:]+             |nécessaire|
    |----------------+-----------------------------------+----------|
    |<version_debian>|[a-z,A-Z,0-9,.,+,~]+               |optionnel |
    +---------------------------------------------------------------+


    Note

    Vous pouvez vérifier l’ordre des versions d’un paquet à l’aide de
    dpkg(1), par exemple, « dpkg --compare-versions 7.0 gt 7.~pre1 ;
    echo $? ».

    Note

    L’installateur Debian (d-i) utilise udeb comme extension du nom
    de fichier de ses paquets binaires plutôt que le deb normal. Un
    paquet udeb est un paquet deb allégé dont certaines parties non
    essentielles du contenu, comme la documentation, sont supprimées
    afin d’économiser de la place en relâchant les exigences de la
    charte des paquets. Les paquet deb et udeb partagent la même
    structure de paquet. Le « u » signifie micro.

%

2.5.9. La commande dpkg

    dpkg(1) est l’outil de plus bas niveau pour la gestion des
    paquets de Debian. C’est un outil très puissant et il faut
    l’utiliser avec précaution.

    Lors de l’installation d’un paquet appelé « <nom_paquet> », dpkg
    le traite selon l’ordre suivant :

     1. dépaquetage du fichier deb (équivalent à « ar -x ») ;

     2. exécution de « <nom_paquet>.preinst » en utilisant debconf(1)
         ;
   
     3. installation du contenu du paquet sur le système (équivalent
        à « tar -x » ;

     4. exécution de « <nom_paquet>.postinst » en utilisant debconf
        (1).

    Le système debconf fournit une interaction standardisée avec
    l’utilisateur avec la prise en charge de I18N and L10N (
    Chapitre 8, I18N et L10N).

    Tableau 2.17. Fichiers particuliers créés par dpkg

    +---------------------------------------------------------------+
    |       fichier        |         description du contenu         |
    |----------------------+----------------------------------------|
    |/var/lib/dpkg/info/   |liste de fichiers de configuration.     |
    |<nom_paquet>.conffiles|(modifiables par l’utilisateur)         |
    |----------------------+----------------------------------------|
    |/var/lib/dpkg/info/   |liste des fichiers et répertoires       |
    |<nom_paquet>.list     |installés par le paquet                 |
    |----------------------+----------------------------------------|
    |/var/lib/dpkg/info/   |liste des valeurs de hachage MD5 pour   |
    |<nom_paquet>.md5sums  |les fichiers installés par le paquet    |
    |----------------------+----------------------------------------|
    |/var/lib/dpkg/info/   |script du paquet à exécuter avant       |
    |<nom_paquet>.preinst  |l’installation du paquet                |
    |----------------------+----------------------------------------|
    |/var/lib/dpkg/info/   |script du paquet à exécuter après       |
    |<nom_paquet>.postinst |l’installation du paquet                |
    |----------------------+----------------------------------------|
    |/var/lib/dpkg/info/   |script du paquet à exécuter avant la    |
    |<nom_paquet>.prerm    |suppression du paquet                   |
    |----------------------+----------------------------------------|
    |/var/lib/dpkg/info/   |script du paquet à exécuter après la    |
    |<nom_paquet>.postrm   |suppression du paquet                   |
    |----------------------+----------------------------------------|
    |/var/lib/dpkg/info/   |script du paquet pour le système debconf|
    |<nom_paquet>.config   |                                        |
    |----------------------+----------------------------------------|
    |/var/lib/dpkg/        |information d’alternative utilisée par  |
    |alternatives/         |la commande update-alternatives command |
    |<nom_paquet>          |                                        |
    |----------------------+----------------------------------------|
    |/var/lib/dpkg/        |information de disponibilité de tous les|
    |available             |paquets                                 |
    |----------------------+----------------------------------------|
    |/var/lib/dpkg/        |information sur les détournements       |
    |diversions            |utilisés par dpkg(1) et établis avec    |
    |                      |dpkg-divert(8)                          |
    |----------------------+----------------------------------------|
    |/var/lib/dpkg/        |information de remplacement de statut   |
    |statoverride          |utilisé par dpkg(1) et établi avec      |
    |                      |dpkg-statoverride(8)                    |
    |----------------------+----------------------------------------|
    |/var/lib/dpkg/status  |informations d’état pour tous les       |
    |                      |paquets                                 |
    |----------------------+----------------------------------------|
    |/var/lib/dpkg/        |fichier de sauvegarde de première       |
    |status-old            |génération du fichier « var/lib/dpkg/   |
    |                      |status »                                |
    |----------------------+----------------------------------------|
    |/var/backups/         |fichier de sauvegarde de seconde        |
    |dpkg.status*          |génération du fichier « var/lib/dpkg/   |
    |                      |status »                                |
    +---------------------------------------------------------------+


    Le fichier « status » est aussi utilisé par des outils comme dpkg
    (1), « dselect update » et « apt-get -u dselect-upgrade ».

    La commande de recherche spécialisée grep-dctrl(1) peut
    rechercher des copies locales des métadonnées « status » et
    « available »

    Astuce

    Dans l’environnement de l’installateur debian, la commande udpkg
    est utilisée pour ouvrir les paquets udeb. La commande udpkg est
    une version allégée de la commande dpkg.

%

2.5.10. La commande update-alternatives

    Le système Debian possède un mécanisme pour installer
    paisiblement des paquets qui présentent un certain recouvrement
    en utilisant update-alternatives(1). Par exemple, vous pouvez
    faire que la commande vi choisisse de lancer vim alors que les
    paquets vim et nvi sont tous deux installés.

    $ ls -l $(type -p vi)
    lrwxrwxrwx 1 root root 20 2007-03-24 19:05 /usr/bin/vi -> /etc/alternatives/vi
    $ sudo update-alternatives --display vi
    ...
    $ sudo update-alternatives --config vi
      Selection    Command
     ----------------------------------------------
          1        /usr/bin/vim
    *+    2        /usr/bin/nvi

    Appuyez sur <Entrée> pour conserver la valeur par défaut[*] ou choisissez le numéro sélectionné :

    Le système d’alternatives de Debian utilise des liens symboliques
    dans « /etc/alternatives/ » pour enregistrer ses sélections. Le
    processus de sélection utilise le fichier correspondant de « /var
    /lib/dpkg/alternatives/ ».

%

2.5.11. Commande dpkg-statoverride

    Stat overrides, fournie par la commande dpkg-statoverride(8) est
    un moyen d’indiquer à dpkg(1) d’utiliser un propriétaire ou un
    mode différent pour un fichier lorsqu’un paquet est installé. Si
    « --update » est indiqué et que le fichier existe, il est
    immédiatement configuré avec le nouveau propriétaire et le
    nouveau mode.

    Attention

    Une modification directe par l’administrateur du propriétaire ou
    du mode d’un fichier dont le propriétaire est le paquet en
    utilisant les commandes chmod ou chown sera réinitialisée lors
    d’une nouvelle mise à niveau du paquet.

    Note

    J’utilise ici le mot fichier, mais en réalité, ce peut être
    n’importe quel objet d’un système de fichiers que gère dpkg, y
    compris les répertoires, les périphériques, etc.

%

2.5.12. Commande dpkg-divert

    Les fichiers diversions fournis par la commande dpkg-divert(8)
    sont un moyen de forcer dpkg(1) à ne pas installer un fichier à
    son emplacement par défaut, mais à un emplacement détourné
    (« diverted »). L’utilisation de dpkg-divert est destinée à la
    maintenance de paquets par des scripts. Son utilisation
    occasionnelle par l’administrateur du système est obsolète.

%

2.6. Récupérer un système cassé

    En utilisant le système unstable, l’administrateur peut avoir à
    restaurer le système à partir d’une situation où la gestion des
    paquets est défectueuse.

    Attention
   
    Certaines des méthodes décrites ici sont des actions très
    risquées. Vous avez été prévenu !

2.6.1. Incompatibilité avec une ancienne configuration de
l’utilisateur

    Si un programme avec une interface graphique présente une
    instabilité après une mise à niveau amont importante, vous
    devriez songer à des interférences avec les anciens fichiers de
    configurations locaux qu’il avait créés. S’il est stable avec un
    compte d’utilisateur fraîchement créé, cette hypothèse est
    confirmée. (C’est un bogue de réalisation du paquet et c’est le
    plus souvent évité par le responsable du paquet).

    Pour retrouver la stabilité, vous devrez déplacer les fichiers de
    configuration locaux et redémarrer le programme ayant une
    interface graphique. Il vous faudra peut-être lire le contenu de
    l’ancien fichier de configuration pour retrouver plus tard vos
    informations de configuration. (Ne les effacez pas trop
    rapidement).

%

2.6.2. Différents paquets ayant des fichiers communs

    Les systèmes de gestion d’archive au niveau du paquet, tels qu’
    aptitude(8) ou apt-get(1) ne tenteront même pas, grâce aux
    dépendances des paquets, d’installer des paquets ayant des
    fichiers qui se superposent (consultez Section 2.1.6,
    « Dépendances des paquets »).

    Des erreurs du responsable du paquet ou le déploiement de sources
    d’archives mélangées et incohérentes (consultez Section 2.7.2,
    « Paquets venant de sources mélangées ») par l’administrateur du
    système peuvent créer une situation où les dépendances des
    paquets sont décrites de manière incorrecte. Lorsque, dans une
    telle situation, vous installez un paquet qui écrase des fichiers
    en utilisant aptitude(8) ou apt-get(1), dpkg(1) qui dépaquette le
    paquet va retourner une erreur au programme appelant sans écraser
    les fichiers existants.

    Attention

    L’utilisation de programmes tierce partie introduit un risque
    significatif par l’intermédiaire des scripts du responsable qui
    sont lancés avec les privilèges de l’administrateur et peuvent
    effectuer n’importe quoi sur votre système. La commande dpkg(1)
    ne protège que contre l’écrasement des fichiers lors du
    dépaquetage.

    Vous pouvez contourner un tel problème d’installation cassée en
    supprimant d’abord l’ancien paquet, <ancien_paquet>, qui pose des
    problèmes.

    $ sudo dpkg -P <ancien_paquet>

%

2.6.3. Corriger les scripts cassés des paquets

    Lorsqu’une commande dans le script du paquet retourne une erreur
    pour une raison quelconque et que le script retourne une erreur,
    le système de gestion des paquets arrête son action et se termine
    en laissant des paquets partiellement installés. Lorsqu’un paquet
    comporte des bogues dans les scripts de suppression, le paquet
    peut devenir impossible à supprimer et assez déplaisant.

    Pour les problèmes avec le script de paquet de « <nom_paquet> »,
    il vous faudra regarder dans les scripts du paquet suivants :

      * « /var/lib/dpkg/info/<nom_paquet>.preinst »

      * « /var/lib/dpkg/info/<nom_paquet>.postinst »
   
      * « /var/lib/dpkg/info/<nom_paquet>.prerm »

      * « /var/lib/dpkg/info/<nom_paquet>.postrm »

    Éditez le script du paquet posant problème avec le compte de
    l’administrateur en utilisant les techniques suivantes :

      * désactiver la ligne posant problème avec un « # » en tête de
        ligne ;
   
      * forcer un retour avec succès en ajoutant à la fin de la ligne
        qui pose problème « || true ».

    Configurez tous les paquets partiellement installés à l’aide de
    la commande suivante :

    # dpkg --configure -a

%

2.6.4. Récupération avec la commande dpkg

    Comme dpkg est un outil de gestion des paquets de très bas
    niveau, il peut fonctionner dans des situations très difficiles
    telles qu’un système qu’on ne peut pas démarrer et qui n’a pas de
    connexion réseau. Supposons que le paquet toto soit cassé et
    doive être remplacé.

    You may still find cached copies of older bug free version of foo
    package in the package cache directory: "/var/cache/apt/archives/
    ". (If not, you can download it from archive of https://
    snapshot.debian.org/ or copy it from package cache of a
    functioning machine.)

    Si vous pouvez démarrer le système, vous pouvez l’installer avec
    la commande suivante :

    # dpkg -i /chemin/vers/toto_<ancienne-version>_<arch>.deb

    Astuce

    Si la casse du système est minime, vous pouvez faire un retour en
    arrière (downgrade) de tout le système comme dans Section 2.7.10,
    « Retour d’urgence à une version précédente (downgrade)  » en
    utilisant le système de plus haut niveau APT.

    Si votre système ne peut pas être démarré depuis le disque dur,
    vous devrez rechercher d’autres manières de le démarrer :

     1. Démarrez le système en utilisant le CD de l’installateur
        Debian en mode secours (« rescue mode »).

     2. Montez le système qui ne veut pas démarrer sur le disque dur
        sur « /target ».

     3. Installez une version plus ancienne du paquet toto en faisant
        ce qui suit :

    # dpkg --root /target -i /chemin/vers/toto_<ancienne_version>_<arch>.deb

    Cet exemple fonctionne même si la commande dpkg qui se trouve sur
    le disque dur est cassée.

    Astuce

    Tous les systèmes GNU/Linux démarrés depuis un autre système sur
    le disque dur, depuis un CD autonome GNU/Linux, depuis une clé
    USB amorçable, depuis le réseau peuvent être utilisés de manière
    similaire pour restaurer un système cassé.

    Si la tentative d’installation d’un paquet de cette manière
    échoue en raison de la violation de certaines dépendances et que
    vous voulez vraiment le faire, vous pouvez, en dernier ressort,
    outrepasser les dépendances en utilisant les options
    « --ignore-depends », « --force-depends » de dpkg et d’autres
    options. Si vous le faites, vous aurez un sérieux effort à faire
    pour restaurer les dépendances correctes par la suite. Consultez 
    dpkg(8) pour davantage d’informations.

    Note

    Si votre système est sérieusement cassé, vous devriez faire une
    sauvegarde complète du système dans un endroit sûr (consultez
    Section 10.2, « Sauvegarde et restauration ») et effectuer une
    installation propre. Cela demande moins de temps et donne, en fin
    de compte, de meilleurs résultats.

%

2.6.5. Récupérer les données de sélection des paquets

    Si le fichier « /var/lib/dpkg/status » est corrompu pour une
    raison quelconque, le système Debian perd les données de paquets
    sélectionnés et est sérieusement endommagé. Regardez l’ancienne
    version du fichier « /var/lib/dpkg/status » dans « /var/lib/dpkg/
    status-old » ou « /var/backups/dpkg.status.* ».

    Conserver « /var/backups/ » sur une partition séparée peut être
    une bonne idée car ce répertoire contient de nombreuses données
    importantes du système.

    Pour les casses sévères, je recommande de faire une
    réinstallation propre après avoir fait une sauvegarde du système.
    Même si vous avez perdu tout ce qui se trouve dans « /var/ »,
    vous pouvez encore récupérer certaines informations depuis les
    répertoires qui se trouvent dans « /usr/share/doc/ » afin de vous
    guider dans votre nouvelle installation.

    Réinstaller un système (de bureau) minimum.

    # mkdir -p /chemin/vers/ancien/système

    Montez l’ancien système sur « /chemin/vers/ancien/système/ ».

    # cd /chemin/vers/ancien/système/usr/share/doc
    # ls -1 >~/ls1.txt
    # cd /usr/share/doc
    # ls -1 >>~/ls1.txt
    # cd
    # sort ls1.txt | uniq | less

    Le système vous présentera alors les noms de paquets à installer.
    (Il peut y avoir des noms qui ne soient pas des noms de paquets,
    comme, par exemple, « texmf »).

2.7. Astuces pour la gestion des paquets

%

2.7.1. Comment obtenir des paquets Debian

    Vous pouvez rechercher les paquets qui satisfont à vos besoins
    avec aptitude à partir de la description du paquet ou depuis la
    liste se trouvant dans « Tasks ».

    Si vous trouvez deux paquets similaires et que vous vous demandez
    lequel installer sans faire des efforts d’« essais et erreurs »,
    vous pouvez user de bon sens. Je considère que les points
    suivants constituent de bonnes indications pour les paquets à
    privilégier :

      * Essential : yes > no

      * Section : main > contrib > non-free

      * Priorité : required > important > standard > optional > extra

      * Tâches : paquets affichés dans les tâches tels que
        « Environnement de bureau »

      * Les paquets sélectionnés par le paquet de dépendances (par
        exemple, python2.4 par python)

      * Popcon : les votes et le nombre d’installations les plus
        élevés

      * Journaux des modifications (« Changelog ») : mises à jour
        régulières par le responsable

      * BTS : pas de bogue RC (pas de bogue critique, grave ou
        sérieux)

      * BTS : réactivité du responsable aux signalements de bogues

      * BTS : le plus grand nombre de bogues réglés récemment

      * BTS : le plus faible nombre de bogues restants qui ne soient
        pas dans la liste des vœux

    Debian étant un projet basé sur le volontariat avec un modèle
    développement distribué, son archive contient de nombreux paquets
    avec des cibles différentes et de qualité variable. Vous devrez
    choisir vous-même ce que vous voulez en faire.

%

2.7.2. Paquets venant de sources mélangées

    Attention

    Installer des paquets provenant de sources d’archives mélangées
    n’est pas pris en charge par la distribution officielle de Debian
    sauf pour la prise en charge officielle d’une combinaison
    particulière d’archives telle que stable avec security updates et
    bullseye-updates.

    Voici un exemple des opérations pour inclure des paquets d’une
    version amont spécifique plus récente se trouvant dans unstable
    pour une seule occasion tout en suivant testing :

     1. modifier le fichier « /etc/apt/sources.list » de manière
        temporaire avec la seule entrée « unstable » ;

     2. lancer « aptitude update » ;
   
     3. lancer « aptitude install <nom_paquet> » ;

     4. rétablir le fichier « /etc/apt/sources.list » pour testing.

     5. lancer « aptitude update » ;

    Vous ne créez pas le fichier « /etc/apt/preferences » et vous
    n’avez pas besoin de vous préoccuper de l’épinglage apt
    (« apt-pinning ») avec cette approche manuelle. Mais c’est très
    lourd.

    Attention

    En utilisant une source d’archive mixte, vous devez vous assurer
    par vous-même de la compatibilité des paquets car Debian ne la
    garantit pas. S’il existe des incompatibilités de paquets, vous
    pouvez casser votre système. Vous devrez être capable d’apprécier
    ces exigences techniques. L’utilisation de sources mixtes
    d’archives aléatoires est une opération entièrement facultative
    et son utilisation est quelque chose que je ne vous encourage pas
    à faire.

    Les règles générales pour l’installation de paquets de
    différentes archives sont les suivantes :

      * Les paquets non binaires (« Architecture: all ») sont plus 
        sûrs à installer :

          + paquets de documentation : pas d’exigence particulière

          + paquet de programmes d’interpréteur : un interpréteur
            compatible doit être disponible

      * Les paquets binaires (qui ne sont pas « Architecture: all »)
        sont confrontés à de nombreux barrages et ne sont pas sûrs à
        installer
   
          + compatibilité des versions de bibliothèques (y compris
            « libc »)

          + compatibilité des versions des programmes utilitaires en
            rapport

          + compatibilité avec l’ABI du noyau

          + compatibilité avec l’ABI C++

          + …

    Note

    De manière à rendre un paquet plus sûr à installer, certains
    programmes commerciaux binaires et non libres peuvent être
    fournis liés avec des bibliothèques complètement statiques. Vous
    devrez quand même vérifier leurs problèmes de compatibilité avec
    l’ABI, etc.

    Note

    Sauf pour éviter à court terme un paquet cassé, installer des
    paquets binaires depuis des archives officiellement non
    supportées est en général une mauvaise idée. C’est vrai même si
    vous utilisez l’épinglage apt (« apt-pinning ») (consultez
    Section 2.7.3, « Ajuster la version candidate »). Vous devriez
    envisager chroot ou des techniques similaires (consultez
    Section 9.10, « Système virtualisé ») afin de faire tourner des
    programmes en provenance d’archives différentes.

%

2.7.3. Ajuster la version candidate

    Sans le fichier « /etc/apt/preferences », le système APT choisit,
    en utilisant la chaîne de version, la dernière version disponible
    comme version candidate. C’est l’état normal et l’utilisation la
    plus recommandée du système APT. Toutes les combinaisons
    d’archives officiellement prises en charge n’exigent pas le
    fichier « /etc/apt/preferences » car certaines archives qui ne
    peuvent pas être utilisées comme source des mises à jour
    automatiques sont marquées NotAutomatic et gérées proprement.

    Astuce

    La règle de comparaison de la chaîne de version peut être
    vérifiée avec, par exemple « dpkg --compare-versions ver1.1 gt
    ver1.1~1; echo $? » (consultez dpkg(1)).

    Lorsque vous installez régulièrement des paquets depuis un
    mélange de sources d’archives (consultez Section 2.7.2, « Paquets
    venant de sources mélangées »), vous pouvez automatiser ces
    opérations compliquées en créant le fichier « /etc/apt/
    preferences » avec les entrées correctes et en ajustant la règle
    de sélection des paquets pour la version candidate comme décrit
    dans apt_preferences(5). C’est appelé épinglage apt
    (« apt-pinning »).

    Avertissement

    L’utilisation de l’épinglage apt par un débutant est une source
    certaine de problèmes majeurs. Vous devriez éviter l’utilisation
    de l’épinglage apt sauf si vous en avez absolument besoin.

    Attention

    Lorsque vous utilisez l’épinglage apt, vous devez vérifier
    vous-même la compatibilité des paquets car le système Debian ne
    la garantit pas. L’épinglage apt est une opération entièrement
    facultative et je ne vous encourage pas à l’utiliser.

    Attention

    Les fichiers Release au niveau de l’archive (consultez
    Section 2.5.3, « Fichiers « Release » au niveau de l’archive »)
    sont utilisés pour la règle de apt_preferences(5). L’épinglage
    apt ne fonctionne donc qu’avec le nom de « suite » pour les
    archives normales de Debian et les archives de sécurité de Debian
    c’est différent des archives Ubuntu). Par exemple, dans le
    fichier « /etc/apt/preferences », il est possible de mettre
    « Pin: release a=unstable  » mais pas « Pin: release a=sid »

    Attention

    Lorsque vous utilisez une archive ne venant pas de Debian en tant
    que partie d’épinglage apt, vous devez vérifier ce pour quoi
    elles sont prévues et aussi vérifier leur crédibilité. Par
    exemple, Ubuntu et Debian ne sont pas prévues pour être
    mélangées.

    Note

    Même si vous ne créez pas le fichier « /etc/apt/preferences »,
    vous pouvez effectuer des opérations assez complexes sur le
    système sans épinglage apt (consultez Section 2.6.4,
    « Récupération avec la commande dpkg » et Section 2.7.2,
    « Paquets venant de sources mélangées »).

    Voici une explication simplifiée de la technique d’épinglage apt
    (« apt-pinning ») :

    Le système APT choisit la mise à niveau du paquet de plus haute
    priorité d’épinglage (« Pin-Priority ») dans la liste des sources
    de paquets disponible dans le fichier « /etc/apt/sources.list »
    comme paquet de « version candidate. Si la priorité d’épinglage
    du paquet est supérieure à 1000, cette restriction de version
    pour la mise à niveau est levée afin de permettre le retour vers
    une version précédente (consultez Section 2.7.10, « Retour
    d’urgence à une version précédente (downgrade)  »).

    La valeur de priorité d’épinglage de chaque paquet est définie
    par l’entrée « Pin-Priority » dans le fichier « /etc/apt/
    preferences » ou utilise sa valeur par défaut.

    Tableau 2.18. Liste de valeurs remarquables des priorités
    d’épinglage (Pin-Priority) pour la technique d’épinglage apt
    (« apt-pinning ») :

    +---------------------------------------------------------------+
    |  priorité  |   conséquence de l’épinglage apt sur le paquet   |
    |d’épinglage |                                                  |
    |------------+--------------------------------------------------|
    |1001        |installer le paquet même s’il s’agit d’un retour  |
    |            |en arrière                                        |
    |------------+--------------------------------------------------|
    |990         |utilisé par défaut pour l’archive version cible   |
    |------------+--------------------------------------------------|
    |500         |utilisé par défaut pour l’archive normale         |
    |------------+--------------------------------------------------|
    |100         |utilisé par défaut pour l’archive non automatique |
    |            |mais mises à niveau automatiques                  |
    |------------+--------------------------------------------------|
    |100         |utilisé pour le paquet installé                   |
    |------------+--------------------------------------------------|
    |1           |utilisé par défaut pour l’archive non automatique |
    |------------+--------------------------------------------------|
    |-1          |ne jamais installer le paquet même s'il est       |
    |            |recommandé                                        |
    +---------------------------------------------------------------+


    Il y a plusieurs méthodes pour définir l’archive version cible :

      * fichier de configuration « /etc/apt/apt.conf » avec la ligne
        « APT::Default-Release "stable"; »
   
      * option de la ligne de commandes, par exemple, « apt-get
        install -t testing un_paquet »

    L’archive non automatique mais mises à niveau automatiques est
    définie par le serveur d’archive dont le fichier Release au
    niveau de l’archive (consultez Section 2.5.3, « Fichiers
    « Release » au niveau de l’archive ») contient à la fois
    « NotAutomatic: yes » et « ButAutomaticUpgrades: yes ». L’archive
    non automatique est définie par le serveur d’archive dont le
    fichier Release au niveau de l’archive contient « NotAutomatic:
    yes ».

    La situation d’épinglage apt de <paquet> provenant de sources
    d’archive multiple est affichée par « apt-cache policy <paquet>
     ».

      * Une ligne commençant par « Package pin: » affiche la version
        d’épinglage du paquet si l’association n’est définie que pour
        <paquet> par exemple, « Package pin: 0.190 ».

      * Il n’existe pas de ligne avec « Package pin: » s’il n’y a pas
        d’association définie uniquement avec <paquet>.

      * La valeur de Pin-Priority associée uniquement avec <paquet>
        est affichée sur la partie droite de toutes les chaînes de
        version, par exemple, « 0.181 700 ».

      * « 0 » est affiché à droite de toutes les chaînes de version
        s’il n’y a pas d’association définie avec uniquement
        <paquet>, par exemple, « 0.181 0 ».

      * Les valeurs de Pin-Priority des archives (définies par
        « Package: * » dans le fichier « /etc/apt/preferences ») sont
        affichées sur la gauche de tous les chemins vers les
        archives, par exemple, « 100 http://deb.debian.org/debian/
        bullseye-backports/main Packages ».

%

2.7.4. Mises à jour et rétroportages

    Les archives du bullseye-updates et backports.debian.org
    fournissent des paquets mis à niveau pour stable (bullseye).

    Afin d’utiliser ces archives, placez la liste de toutes les
    archives nécessaires dans le fichier « /etc/apt/sources.list » de
    la manière suivante :

    deb http://deb.debian.org/debian/ bullseye main contrib non-free
    deb http://security.debian.org/ bullseye/updates main contrib
    deb http://deb.debian.org/debian/ bullseye-updates main contrib non-free
    deb http://deb.debian.org/debian/ bullseye-backports main contrib non-free

    Il n’est pas nécessaire de définir explicitement la valeur de
    Pin-Priority dans le fichier « /etc/apt/preferences ». Quand de
    nouveaux paquets sont disponibles, la configuration par défaut
    fournit les mises à niveau les plus saines (consultez
    Section 2.5.3, « Fichiers « Release » au niveau de l’archive »).

      * Tous les paquets installés les plus anciens sont mis à niveau
        vers les plus récents à partir de bullseye-updates.
   
      * Seuls les paquets les plus anciens installés à partir de
        bullseye-backports sont mis à niveau vers les plus récents à
        partir de bullseye-backports.

    Chaque fois que vous désirerez installer un paquet nommé « 
    <nom_paquet> » avec ses dépendances depuis l’archive
    bullseye-backports vous-même, vous utiliserez la commande
    suivante en changeant de version cible avec l’option « -t » :

    $ sudo apt-get install -t bullseye-backports <nom_paquet>

%

2.7.5. Blocage des paquets installés par « Recommends »

    Si vous ne voulez pas tirer des paquets particuliers
    automatiquement avec « Recommends », vous devez créer le fichier
    « /etc/apt/preferences » et y placer la liste explicite de tous
    ces paquets au début du fichier comme suit :

    Package: <paquet-1>
    Pin: version *
    Pin-Priority: -1
   
    Package: <paquet-2>
    Pin: version *
    Pin-Priority: -1

%

2.7.6. Suivre testing avec quelques paquets d’unstable

    Voici un exemple de technique d’épinglage apt permettant
    d’inclure de manière régulière une version amont plus récente de
    paquets spécifiques se trouvant dans unstable tout en suivant
    testing. Listez toutes les archives nécessaires dans le fichier
    « /etc/apt/sources.list » de la manière suivante :

    deb http://deb.debian.org/debian/ testing main contrib non-free
    deb http://deb.debian.org/debian/ unstable main contrib non-free
    deb http://security.debian.org/ testing/updates main contrib

    Configurez le fichier « /etc/apt/preferences » comme suit :

    Package: *
    Pin: release a=unstable
    Pin-Priority: 100

    Lorsque vous désirez installer un paquet appelé « <nom_paquet> »
    avec ses dépendances depuis l’archive unstable avec cette
    configuration, vous utilisez la commande suivante qui modifie la
    version cible avec l’option « -t » (la priorité d’épinglage de
    unstable devient 990).

    $ sudo apt-get install -t unstable <nom_paquet>

    Avec cette configuration, l’exécution habituelle de « apt-get
    upgrade » et « apt-get dist-upgrade » (ou « aptitude
    safe-upgrade » et « aptitude full-upgrade » met à niveau les
    paquets qui avaient été installés depuis l’archive testing en
    utilisant l’archive testing actuelle et les paquets qui avaient
    été installés depuis l’archive unstable en utilisant l’archive
    unstable actuelle.

    Attention

    Faites bien attention à ne pas supprimer l’entrée « testing » du
    fichier « /etc/apt/sources.list ». Sans l’entrée « testing », le
    système APT mettra à niveau les paquets en utilisant la nouvelle
    archive unstable.

    Astuce

    J’édite habituellement le fichier « /etc/apt/sources.list » en
    commentant l’entrée correspondant à l’archive « unstable » juste
    après avoir effectué les opérations ci-dessus. Cela évite un
    processus de mise à jour lent en raison du nombre trop important
    d’entrées dans le fichier « /etc/apt/sources.list » bien que cela
    ne permette pas de mettre à niveau les paquets qui avaient été
    installés depuis l’archive unstable en utilisant l’archive
    unstable actuelle.

    Astuce

    Si on utilise « Pin-Priority: 1 » à la place de « Pin-Priority:
    100 » dans le fichier « /etc/apt/preferences », les paquets déjà
    installés ayant une valeur de Pin-Priority de 100 ne seront pas
    mis à niveau depuis l’archive unstable même si l’entrée
    « testing » du fichier « /etc/apt/sources.list » est supprimée.

    Si vous désirez suivre automatiquement un paquet particulier dans
    unstable sans une installation initiale « -t unstable », vous
    devrez créer le fichier « /etc/apt/preferences » et y placer la
    liste explicite de tous ces paquets au début du fichier de la
    manière suivante :

    Package: <paquet-1>
    Pin: release a=unstable
    Pin-Priority: 700
   
    Package: <paquet-2>
    Pin: release a=unstable
    Pin-Priority: 700

    Cela définit la valeur de Pin-Priority pour chacun de ces paquets
    spécifiques. Par exemple, pour suivre la dernière version
    unstable de cette « Référence Debian » en français, vous devrez
    ajouter les entrées suivantes dans le fichier « /etc/apt/
    preferences ».

    Package: debian-reference-fr
    Pin: release a=unstable
    Pin-Priority: 700
   
    Package: debian-reference-common
    Pin: release a=unstable
    Pin-Priority: 700

    Astuce

    Cette technique d’épinglage apt est aussi valable si vous suivez
    l’archive stable. Jusqu’à présent et selon mon expérience, les
    paquets de documentation ont toujours été sûrs à installer depuis
    l’archive unstable.

%

2.7.7. Suivre unstable avec quelques paquets d’experimental

    Voici un autre exemple de technique d’épinglage apt destinée à
    inclure une version amont plus récente de paquets spécifiques se
    trouvant dans experimental tout en suivant unstable. Vous donnez
    la liste de toutes les archives nécessaires dans fichier « /etc/
    apt/sources.list » de la manière suivante :

    deb http://deb.debian.org/debian/ unstable main contrib non-free
    deb http://deb.debian.org/debian/ experimental main contrib non-free
    deb http://security.debian.org/ testing/updates main contrib

    La valeur de Pin-Priority par défaut pour l’archive experimental
    est toujours de 1 (<<100) car c’est une archive non automatique
    (consultez Section 2.5.3, « Fichiers « Release » au niveau de
    l’archive »). Il n’y a pas besoin de définir explicitement de
    valeur de Pin-Priority dans le fichier « /etc/apt/preferences »
    simplement pour utiliser l’archive experimental à moins que vous
    ne désiriez suivre des paquets particuliers dans cette archive de
    manière automatique pour la mise à niveau suivante.

%

2.7.8. Chargement et mise à niveau automatique de paquets

    Le paquet apt est diffusé avec son propre script d’événements
    planifiés (cron) « /etc/cron.daily/apt » afin de gérer le
    téléchargement automatique de paquets. Ce script peut être
    amélioré afin d’effectuer la mise à niveau automatique des
    paquets en installant le paquet unattended-upgrades. Cela peut
    être personnalisé à l’aide de paramètres se trouvant dans « /etc/
    apt/apt.conf.d/02backup » et « /etc/apt/apt.conf.d/
    50unattended-upgrades » comme décrit dans « /usr/share/doc/
    unattended-upgrades/README ».

    Le paquet unattended-upgrades est principalement destiné à des
    mises à jour de sécurité des systèmes stable. Si le risque de
    casser un système stable existant par la mise à niveau
    automatique est plus faible que celui d’avoir un système cassé
    par un intrus utilisant une de ses failles de sécurité qui a été
    fermée par une mise à jour de sécurité, vous devriez envisager
    d’utiliser cette mise à niveau automatique avec les paramètres de
    configuration suivants :

    APT::Periodic::Update-Package-Lists "1";
    APT::Periodic::Download-Upgradeable-Packages "1";
    APT::Periodic::Unattended-Upgrade "1";

    Si vous faites tourner un système unstable, vous ne devriez pas
    utiliser les mises à niveau automatiques car cela cassera
    probablement votre système un jour ou l’autre. Même dans ce cas,
    avec unstable, vous pourrez télécharger des paquets à l’avance
    afin de gagner du temps pour la mise à niveau interactive avec
    les paramètres de configuration suivants :

    APT::Periodic::Update-Package-Lists "1";
    APT::Periodic::Download-Upgradeable-Packages "1";
    APT::Periodic::Unattended-Upgrade "0";

%

2.7.9. Diminuer la bande passante utilisée par APT

    Si vous désirez limiter la bande passante utilisée par APT à, par
    exemple, 800Kib/sec (=100kio/sec), vous devrez configurer APT
    avec son paramètre de configuration comme suit :

    APT::Acquire::http::Dl-Limit "800";

%

2.7.10. Retour d’urgence à une version précédente (downgrade)

    Attention

    Le retour vers une version antérieure n’est pas officiellement
    géré par Debian dans sa conception. Ce ne devrait être fait qu’en
    tant que partie d’un processus de récupération d’urgence. Malgré
    cette situation, on sait que cela fonctionne bien pour de
    nombreux incidents. Avec les systèmes critiques vous devrez
    effectuer une sauvegarde des données importantes du système après
    l’opération de récupération et réinstaller le nouveau système
    depuis le départ.

    Vous pouvez être assez chanceux pour revenir en arrière depuis
    une archive plus récente vers une archive plus ancienne afin de
    récupérer une mise à jour du système en manipulant la version
    candidate (consultez Section 2.7.3, « Ajuster la version
    candidate »). Cette méthode est un remplacement de paresseux des
    nombreuses et fastidieuses commandes « dpkg -i <paquet-cassé>_
    <ancienne-version>.deb » (consultez Section 2.6.4, « Récupération
    avec la commande dpkg »).

    Recherchez les lignes du fichier « /etc/apt/sources.list »
    permettant de suivre unstable ayant la forme suivante :

    deb http://deb.debian.org/debian/ sid main contrib non-free

    Remplacez-la avec la suivante pour suivre testing :

    deb http://deb.debian.org/debian/ bookworm main contrib non-free

    Configurez le fichier « /etc/apt/preferences » comme suit :

    Package: *
    Pin: release a=testing
    Pin-Priority: 1010

    Lancez « apt-get update; apt-get dist-upgrade » pour forcer
    l’installation à une version antérieure des paquets du système.

    Supprimez ce fichier spécial « /etc/apt/preferences » après ce
    retour en arrière d’urgence.

    Astuce

    C’est une bonne idée de supprimer (sans purger) autant de paquets
    que possible afin de limiter les problèmes de dépendances. Vous
    devrez peut-être supprimer et installer manuellement un certain
    nombre de paquets afin de remettre le système dans un état
    antérieur. Le noyau de Linux, le gestionnaire d’amorçage, udev,
    PAM, APT, et les paquets relatifs au réseau ainsi que leurs
    fichiers de configuration demandent une attention particulière.

%

2.7.11. Qui a envoyé le paquet ?

    Bien que le nom du responsable figure dans « /var/lib/dpkg/
    available » et « /usr/share/doc/nom_paquet/changelog » procure
    quelques informations sur « qui se trouve derrière l’activité de
    construction des paquets », celui qui a réellement envoyé le
    paquet est un peu obscur. who-uploads(1) dans le paquet
    devscripts identifie celui qui a réellement envoyé les paquets
    sources Debian.

%

2.7.12. Paquet equivs

    Si vous devez compiler un programme à partir de ses sources pour
    remplacer un paquet Debian, le mieux est d’en faire un paquet
    local réellement « debianisé » (*.deb) et d’utiliser une archive
    privée.

    Si vous choisissez de compiler un programme depuis ses sources et
    de l’installer plutôt sous « /usr/local », vous pouvez avoir
    besoin d’utiliser equivs en dernier ressort pour satisfaire les
    dépendances des paquets manquants.

    Package: equivs
    Priority: optional
    Section: admin
    Description: Circumventing Debian package dependencies
     This package provides a tool to create trivial Debian packages.
     Typically these packages contain only dependency information, but they
     can also include normal installed files like other packages do.
     .
     One use for this is to create a metapackage: a package whose sole
     purpose is to declare dependencies and conflicts on other packages so
     that these will be automatically installed, upgraded, or removed.
     .
     Another use is to circumvent dependency checking: by letting dpkg
     think a particular package name and version is installed when it
     isn't, you can work around bugs in other packages' dependencies.
     (Please do still file such bugs, though.)

%

2.7.13. Porter un paquet vers le système stable

    Pour des mises à niveau partielles du système stable, il est
    souhaitable de reconstruire un paquet dans son environnement en
    utilisant le paquet source. Cela évite des mises à niveau
    massives de paquets en raison de leurs dépendances.

    Ajoutez les entrées suivantes au fichier « /etc/apt/
    sources.list » d’un système stable :

    deb-src http://deb.debian.org/debian unstable  main contrib non-free

    Installez les paquets nécessaires à la compilation et téléchargez
    les sources comme suit :

    # apt-get update
    # apt-get dist-upgrade
    # apt-get install fakeroot devscripts build-essential
    # apt-get build-dep toto
    $ apt-get source toto
    $ cd toto*

    Mettez à jour certains paquets de la chaîne d’outils tels que
    dpkg, et debhelper à partir des paquets rétroportés s’ils sont
    requis pour le rétroportage.

    Exécutez ce qui suit :

    $ dch -i

    Incrémentez la version du paquet, en ajoutant, par exemple
    « +bp1 » dans « debian/changelog »

    Construisez les paquets et installez-les sur le système en
    faisant ce qui suit :

    $ debuild
    $ cd ..
    # debi toto*.changes

%

2.7.14. Serveur mandataire (proxy) pour APT

    Comme effectuer le miroir complet d’une sous-section d’une
    archive Debian gaspille de l’espace disque et de la bande
    passante du réseau, il est souhaitable, lorsque vous administrez
    de nombreux systèmes sur le LAN, de mettre en œuvre un serveur
    mandataire (« proxy ») local pour APT. APT peut être configuré
    pour utiliser un serveur mandataire web (http) générique comme
    squid (consultez Section 6.10, « Autres serveurs d’applications
    réseau ») tel que décrit dans apt.conf(5) et dans « /usr/share/
    doc/apt/examples/configure-index.gz ». La variable
    d’environnement « $http_proxy » peut être utilisée pour
    outrepasser le serveur mandataire défini dans le fichier « /etc/
    apt/apt.conf ».

    Il y a des outils de proxy spécifiques pour l’archive Debian.
    Vous devriez consulter le BTS avant de les installer.

    Tableau 2.19. Liste des outils de proxy spécifiques à l’archive
    Debian

    +---------------------------------------------------------------+
    |   paquet    |popcon|taille|            description            |
    |-------------+------+------+-----------------------------------|
    |             |V:0,  |      |serveur proxy avec cache pour les  |
    |approx       |I:0   |6317  |fichiers de l’archive Debian       |
    |             |      |      |(programme OCaml compilé)          |
    |-------------+------+------+-----------------------------------|
    |             |V:0,  |      |proxy avec cache pour les paquets  |
    |apt-cacher   |I:0   |289   |et les fichiers source Debian      |
    |             |      |      |(programme Perl)                   |
    |-------------+------+------+-----------------------------------|
    |             |V:5,  |      |proxy avec cache pour la           |
    |apt-cacher-ng|I:5   |1488  |distribution de paquets de logiciel|
    |             |      |      |(programme C++ compilé)            |
    +---------------------------------------------------------------+


    Attention

    Lors que Debian réorganise la structure de son archive, ces
    outils de proxy spécialisés ont tendance à exiger que le code
    soit réécrit par le responsable du paquet et peuvent ne plus
    fonctionner pendant un certain temps. D’un autre côté, les
    serveurs mandataires web (http) génériques sont plus robustes et
    s’accommodent plus facilement de tels changements.

%

2.7.15. Petite archive publique de paquets

    Astuce

    Setting up package archive manually is complicated. There are
    several repository management tools available. A comprehensive
    list is available online.

    Voici une démo de création manuelle d’une petite archive publique
    de paquets compatible avec le système d’APT sécurisée (consultez
    Section 2.5.2, « Fichier « Release » de plus haut niveau et
    authenticité »). Définissons un certain nombre de choses .

      * Nom du compte : « toto »

      * Nom de machine : « www.example.com »

      * Paquets nécessaires : apt-utils, gnupg, et autres paquets

      * URL : « http://www.example.com/~toto/ » ( → « /home/foo/
        public_html/index.html »)

      * Architecture des paquets : « amd64 »

    Créez une clé d’archive APT de Toto sur votre serveur en faisant
    ce qui suit :

    $ ssh foo@www.example.com
    $ gpg --gen-key
    ...
    $ gpg -K
    ...
    sec   1024D/3A3CB5A6 2008-08-14
    uid                  Toto (ARCHIVE KEY) <toto@www.example.com>
    ssb   2048g/6856F4A7 2008-08-14
    $ gpg --export -a 3A3CB5A6 >toto.public.key

    Publiez le fichier contenant la clé de l’archive
    « toto.public.key » avec l’ID de clé « 3A3CB5A6 » pour toto

    Créez une arborescence d’archive appelée « Origin: Toto » comme
    suit :

    $ umask 022
    $ mkdir -p ~/public_html/debian/pool/main
    $ mkdir -p ~/public_html/debian/dists/unstable/main/binary-amd64
    $ mkdir -p ~/public_html/debian/dists/unstable/main/source
    $ cd ~/public_html/debian
    $ cat > dists/unstable/main/binary-amd64/Release << EOF
    Archive: unstable
    Version: 4.0
    Component: main
    Origin: Foo
    Label: Foo
    Architecture: amd64
    EOF
    $ cat > dists/unstable/main/source/Release << EOF
    Archive: unstable
    Version: 4.0
    Component: main
    Origin: Foo
    Label: Foo
    Architecture: source
    EOF
    $ cat >aptftp.conf <<EOF
    APT::FTPArchive::Release {
      Origin "Foo";
      Label "Foo";
      Suite "unstable";
      Codename "sid";
      Architectures "amd64";
      Components "main";
      Description "Archive publique de Toto";
    };
    EOF
    $ cat >aptgenerate.conf <<EOF
    Dir::ArchiveDir ".";
    Dir::CacheDir ".";
    TreeDefault::Directory "pool/";
    TreeDefault::SrcDirectory "pool/";
    Default::Packages::Extensions ".deb";
    Default::Packages::Compress ". gzip bzip2";
    Default::Sources::Compress "gzip bzip2";
    Default::Contents::Compress "gzip bzip2";

    BinDirectory "dists/unstable/main/binary-amd64" {
      Packages "dists/unstable/main/binary-amd64/Packages";
      Contents "dists/unstable/Contents-amd64";
      SrcPackages "dists/unstable/main/source/Sources";
    };

    Tree "dists/unstable" {
      Sections "main";
      Architectures "amd64 source";
    };
    EOF

    Vous pouvez automatiser les mises à jour répétitives du contenu
    de l’archive APT sur votre serveur en configurant dupload.

    Placez tous les fichiers de paquets dans « ~toto/public_html/
    debian/pool/main/ » en exécutant « dupload -t toto changes_file »
    dans le client avec « ~/.dupload.conf  » contenant ce qui suite :

    $cfg{'toto'} = {
      fqdn => "www.example.com",
      method => "scpb",
      incoming => "/home/toto/public_html/debian/pool/main",
      # dinstall de ftp-master s'envoie lui-même des courriels
      dinstall_runs => 1,
    };
   
    $cfg{'toto'}{postupload}{'changes'} = "
      echo 'cd public_html/debian ;
      apt-ftparchive generate -c=aptftp.conf aptgenerate.conf;
      apt-ftparchive release -c=aptftp.conf dists/unstable >dists/unstable/Release ;
      rm -f dists/unstable/Release.gpg ;
      gpg -u 3A3CB5A6 -bao dists/unstable/Release.gpg dists/unstable/Release'|
      ssh toto@www.example.com  2>/dev/null ;
      echo 'Archive de paquets créée.'";

    Le script automatique (« hook » postupload lancé par dupload(1)
    crée une archive mise à jour des fichiers lors de chaque dépôt
    (« upload »).

    Vous pouvez ajouter cette petite archive publique à la ligne apt
    de votre système client par ce qui suit :

    $ sudo bash
    # echo "deb http://www.example.com/~foo/debian/ unstable main" \
       >> /etc/apt/sources.list
    # apt-key add toto.public.key

    Astuce
   
    Si l’archive est située sur le système de fichiers local, vous
    pouvez utiliser à la place « deb file:///home/toto/debian/ … ».

%

2.7.16. Enregistrer et copier la configuration du système

    Vous pouvez faire une copie locale de l’état de la sélection des
    paquets et de debconf à l’aide des commandes suivantes :

    # dpkg --get-selections '*' > selection.dpkg
    # debconf-get-selections    > selection.debconf

    Ici, « * » fait que « selection.dpkg » comportera aussi les
    entrées de paquets à « purger ».

    Vous pouvez transférer ces 2 fichiers vers un autre ordinateur,
    et les y installer avec :

    # dselect update
    # debconf-set-selections < myselection.debconf
    # dpkg --set-selections  < myselection.dpkg
    # apt-get -u dselect-upgrade    # ou dselect install

    Si vous envisagez de gérer de nombreux serveurs dans une grappe
    avec pratiquement la même configuration, vous devriez envisager
    d’utiliser un paquet spécialisé tel que fai pour gérer l’ensemble
    du système.

%

2.7.17. Convertir ou installer un paquet binaire non Debian

    alien(1) permet de convertir des paquets binaires fournis dans
    les fichiers de format rpm de Red Hat, slp, de Stampede, tgz de
    Slackware et pkg de Solaris sous forme de paquet deb de Debian.
    Si vous voulez utiliser des paquets d’une autre distribution
    Linux que celle sur laquelle vous avez installé sur votre
    système, vous pouvez utiliser alien pour les convertir depuis
    votre format de paquets préféré et les installer. alien prend
    aussi en charge les paquets LSB.

    Avertissement

    alien(1) ne devrait pas être utilisé pour remplacer des paquets
    essentiels du système, tels que sysvinit, libc6, libpam-modules,
    etc. En pratique, alien(1) ne devrait être utilisé que pour des
    paquets non libres uniquement binaires qui soient conformes à LSB
    et liés statiquement. Pour les logiciels libres, vous devriez
    utiliser leur paquet source pour en faire de vrais paquets
    Debian.

%

2.7.18. Extraire un paquet sans dpkg

    Le contenu du paquet « dpkg*.deb » peut être extrait sans
    utiliser dpkg(1) sur un environnement quelconque UNIX-like en
    utilisant les commandes standards ar(1) et tar(1).

    # ar x /path/to/dpkg_<version>_<arch>.deb
    # ls
    total 24
    -rw-r--r-- 1 bozo bozo  1320 2007-05-07 00:11 control.tar.gz
    -rw-r--r-- 1 bozo bozo 12837 2007-05-07 00:11 data.tar.gz
    -rw-r--r-- 1 bozo bozo     4 2007-05-07 00:11 debian-binary
    # mkdir control
    # mkdir data
    # tar xvzf control.tar.gz -C control
    # tar xvzf data.tar.gz -C data

    Le contenu de l’autre paquet « *.deb  peut être extrait avec la
    commande dpkg-deb(1), elle-même extraite du paquet "dpkg*.deb"
    évoqué au paragraphe précédent ; ou en utilisant les outils
    standards ar(1) et son descendant GNU tar(1) avec les fonctions 
    xz(1) de désarchivage/décompression, comme dans les exemples
    ci-dessus.

    Vous pouvez aussi parcourir le contenu du paquet en utilisant la
    commande mc.

%

2.7.19. Autres lectures concernant la gestion des paquets

    Vous pouvez en apprendre davantage sur la gestion des paquets
    dans les documentations suivantes :

      * Documentations primaires sur la gestion des paquets :

          + aptitude(8), dpkg(1), tasksel(8), apt(8), apt-get(8), 
            apt-config(8), apt-key(8), sources.list(5), apt.conf(5),
            and apt_preferences(5);

          + « /usr/share/doc/apt-doc/guide.html/index.html » et « /
            usr/share/doc/apt-doc/offline.html/index.html » du paquet
            apt-doc ;

          + « /usr/share/doc/aptitude/html/en/index.html » du paquet
            aptitude-doc-fr.

      * Documentations officielles et détaillées sur l’archive
        Debian :
   
          + « Charte Debian, chapitre 2 - L’archive Debian »,

          + « Manuel de référence du développeur Debian, chapitre 4 -
            Ressources pour les développeurs Debian 4.6 L’archive
            Debian » et

          + « FAQ de Debian GNU/Linux, chapitre 6 - Les archives FTP
            Debian ».

      * Didacticiel pour la construction d’un paquet Debian pour les
        utilisateurs Debian :

          + « <Guide du nouveau responsable Debian> » (déprécié).

          + « <Guide des responsables Debian> ».

Chapitre 3. Initialisation du système

    En tant tant qu’administrateur du système, il est sage que vous
    sachiez en gros comment le système Debian est démarré et
    configuré. Bien que les détails exacts figurent dans les fichiers
    sources des paquets installés et dans leurs documentations, c’est
    un peu pénible pour la plupart d’entre-nous.

    J’ai fait de mon mieux pour fournir un aperçu rapide des
    points-clés du système Debian et de sa configuration pour vous
    servir de référence en me basant sur mes propres connaissances
    actuelles et antérieures et celles des autres. Comme le système
    Debian est une cible changeante, la situation sur le système peut
    avoir changé. Avant de faire une quelconque modification au
    système, vous devrez vous référer à la dernière documentation de
    chacun des paquets.

    Astuce
   
    bootup(7) describes the system bootup process based on systemd .
    (Recent Debian)

    Astuce
   
    boot(7) describes the system bootup process based on UNIX System
    V Release 4. (Older Debian)

%

3.1. Aperçu du processus d’amorçage du système

    Le système informatique subit plusieurs phases de processus
    d’amorçage (« boot strap process ») depuis l’événement de mise
    sous tension jusqu’à ce qu’il offre à l’utilisateur un système
    d’exploitation (OS) pleinement fonctionnel.

    Pour des raison de simplicité, je limiterai la discussion à une
    plateforme PC typique avec l’installation par défaut.

    Le processus d’amorçage typique est comme une fusée à quatre
    étages. Chaque étage de la fusée passe le contrôle du système à
    l’étage suivant.

      * Section 3.1.1, « Étage 1 : le BIOS »

      * Section 3.1.2, « Étage 2 : le chargeur initial »
   
      * Section 3.1.3, « Étage 3 : le système mini-Debian »

      * Section 3.1.4, « Étage 4 : le système Debian normal »

    Bien entendu, elles peuvent être configurées de manière
    différente. Par exemple, si vous avez compilé votre propre noyau,
    vous pouvez sautez l’étape avec le système mini-Debian. Ne
    supposez donc pas que c’est le cas sur votre système avant de
    l’avoir vérifié vous-même.

    Note

    Pour les plateformes autres que les PC traditionnels tels que les
    systèmes SUN ou Macintosh, le BIOS sur la ROM et la partition sur
    le disque peuvent être assez différents (Section 9.5.2,
    « Configuration de la partition du disque »). Veuillez dans ce
    cas rechercher ailleurs une documentation spécifique à votre
    plateforme.

%

3.1.1. Étage 1 : le BIOS

    Le BIOS est la première étape du processus d’amorçage, il est est
    démarré par l’événement de mise sous tension. Le BIOS, qui est
    implanté sur une mémoire à lecture seule (ROM), est exécuté
    depuis l’adresse mémoire particulière à laquelle le pointeur de
    programme du processeur est initialisé par l’événement de mise
    sous tension.

    Ce BIOS effectue l’initialisation de base du matériel (POST :
    autotest à la mise sous tension) (« power on self test ») et
    passe le contrôle du système à l’étape suivante que vous lui
    indiquez. Le BIOS est habituellement fourni avec le matériel.

    L’écran de démarrage du BIOS indique en général quelle(s) touche
    (s) presser pour entrer dans l’écran de configuration du BIOS
    afin de paramétrer son comportement. Des touches courantes sont
    F1, F2, F10, Échap, Ins et Suppr. Si l’écran de démarrage de
    votre BIOS est caché par un bel écran graphique, vous pouvez
    essayer de presser différentes touches comme Échap pour
    désactiver cet écran. Ces touches dépendent beaucoup du matériel.

    L’emplacement du matériel et la priorité du code lancé par le
    BIOS peuvent être définis depuis l’écran de configuration du
    BIOS. Typiquement, quelques secteurs de début du premier
    périphérique sélectionné qui est trouvé (disque dur, disquette,
    CD-ROM, …) sont chargés en mémoire et le code initial est
    exécuté. Ce code peut être l’un des suivants :

      * code du chargeur initial ;

      * code du noyau d’un OS de transition comme FreeDOS ;

      * code du système d’exploitation cible s’il peut tenir dans cet
        espace réduit.

    Typiquement, le système est amorcé depuis la partition spécifiée
    du disque dur primaire. Les deux premiers secteurs du disque dur
    d’un PC traditionnel contiennent l’enregistrement maître
    d’amorçage (MBR). (« master boot record »). Les informations de
    partition du disque, y compris la sélection de l’amorçage, sont
    enregistrées à la fin de ce MBR. Le code initial du chargeur
    d’amorçage exécuté depuis le BIOS occupe le reste de ce MBR.

%

3.1.2. Étage 2 : le chargeur initial

    Le chargeur initial (« boot loader ») est le deuxième étage du
    processus d’amorçage, il est lancé depuis le BIOS. Il charge en
    mémoire l’image du noyau du système et l’image initrd et leur
    passe le contrôle. Cette image mémoire initiale (« initrd
    image ») est l’image du système de fichiers racine et sa prise en
    compte dépend du chargeur initial utilisé.

    The Debian system normally uses the Linux kernel as the default
    system kernel. The initrd image for the current 2.6/3.x Linux
    kernel is technically the initramfs (initial RAM filesystem)
    image. The basic initrd image is a compressed cpio archive of
    files in the root filesystem. The kernel can update microcode
    very early during boot before loading this basic initrd image.
    This is facilitated by the combined initrd image which is
    microcode binary blob in uncompressed cpio format followed by the
    basic initrd image.

    Astuce

    You can inspect the content of the initrd image file using 
    lsinitramfs(8) and unmkinitramfs(8) from the initramfs-tools-core
    package. See more on https://wiki.debian.org/initramfs.

    L’installation par défaut du système Debian place, pour la
    plateforme PC, le premier étage du code du chargeur initial GRUB
    sur le MBR. Il existe de nombreux chargeurs d’amorçage et
    d’options de configuration possibles.

    Tableau 3.1. Liste des chargeurs initiaux

    +---------------------------------------------------------------+
    |    paquet    |popcon|taille|initrd|chargeur|   description    |
    |              |      |      |      |initial |                  |
    |--------------+------+------+------+--------+------------------|
    |              |      |      |      |        |assez intelligent |
    |              |      |      |      |        |pour comprendre le|
    |              |V:0,  |      |Pris  |GRUB    |partitionnement du|
    |grub-legacy   |I:2   |735   |en    |Legacy  |disque et des     |
    |              |      |      |charge|        |systèmes de       |
    |              |      |      |      |        |fichiers tels que |
    |              |      |      |      |        |vfat, ext3, ….    |
    |--------------+------+------+------+--------+------------------|
    |              |      |      |      |        |assez intelligent |
    |              |      |      |      |        |pour comprendre le|
    |              |      |      |Pris  |        |partitionnement du|
    |grub-pc       |V:28, |533   |en    |GRUB 2  |disque et des     |
    |              |I:774 |      |charge|        |systèmes de       |
    |              |      |      |      |        |fichiers tels que |
    |              |      |      |      |        |vfat, ext4…       |
    |              |      |      |      |        |(défaut).         |
    |--------------+------+------+------+--------+------------------|
    |              |      |      |      |        |images de secours |
    |              |V:0,  |      |Pris  |        |amorçables de GRUB|
    |grub-rescue-pc|I:1   |6367  |en    |GRUB 2  |2 (CD et          |
    |              |      |      |charge|        |disquettes)       |
    |              |      |      |      |        |(versions PC/BIOS)|
    |--------------+------+------+------+--------+------------------|
    |              |      |      |      |        |réside sur les    |
    |              |V:0,  |      |Pris  |        |emplacements des  |
    |lilo          |I:2   |697   |en    |Lilo    |secteurs de       |
    |              |      |      |charge|        |données du disque |
    |              |      |      |      |        |dur (Ancien).     |
    |--------------+------+------+------+--------+------------------|
    |              |      |      |      |        |il comprend le    |
    |              |V:4,  |      |Pris  |        |système de        |
    |syslinux      |I:48  |343   |en    |Isolinux|fichiers ISO9660. |
    |              |      |      |charge|        |C’est utilisé pour|
    |              |      |      |      |        |le CD d’amorçage. |
    |--------------+------+------+------+--------+------------------|
    |              |      |      |      |        |il comprend le    |
    |              |      |      |      |        |système de        |
    |              |V:4,  |      |Pris  |        |fichiers MSDOS    |
    |syslinux      |I:48  |343   |en    |Syslinux|(FAT). Il est     |
    |              |      |      |charge|        |utilisé par la    |
    |              |      |      |      |        |disquette         |
    |              |      |      |      |        |d’amorçage.       |
    |--------------+------+------+------+--------+------------------|
    |              |      |      |Pris  |        |un nouveau système|
    |loadlin       |V:0,  |90    |en    |Loadlin |est démarré depuis|
    |              |I:1   |      |charge|        |le système FreeDOS|
    |              |      |      |      |        |/MSDOS.           |
    |--------------+------+------+------+--------+------------------|
    |              |      |      |      |        |c’est un logiciel |
    |              |      |      |Non   |        |libre qui se      |
    |              |V:0,  |      |pris  |MBR par |substitue au MBR  |
    |mbr           |I:7   |50    |en    |Neil    |de MSDOS. Il ne   |
    |              |      |      |charge|Turton  |comprend que les  |
    |              |      |      |      |        |partitions sur    |
    |              |      |      |      |        |disques.          |
    +---------------------------------------------------------------+


    Avertissement

    Do not play with boot loaders without having bootable rescue
    media (USB memory stick, CD or floppy) created from images in the
    grub-rescue-pc package. It makes you boot your system even
    without functioning bootloader on the hard disk.

    Le menu de configuration de GRUB Legacy est situé en « /boot/grub
    /menu.lst ». Il peut, par exemple, avoir les entrées suivantes :

    title           Debian GNU/Linux
    root            (hd0,2)
    kernel          /vmlinuz root=/dev/hda3 ro
    initrd          /initrd.img

    Le fichier de menu de configuration de GRUB 2 est situé en  /boot
    /grub/grub.cfg ». Il est automatiquement créé par « /usr/sbin/
    update-grub » depuis les modèles situés dans « /etc/grub.d/* » et
    les paramètres situés en « /etc/default/grub ». Il peut, par
    exemple, avoir les entrées suivantes :

    menuentry "Debian GNU/Linux" {
            set root=(hd0,3)
            linux /vmlinuz root=/dev/hda3
            initrd /initrd.img
    }

    Les paramètres de GRUB pour ces exemples ont la signification
    suivante :

    Tableau 3.2. Signification des paramètres de GRUB

    +---------------------------------------------------------------+
    |Paramètres|                   signification                    |
    | de GRUB  |                                                    |
    |----------+----------------------------------------------------|
    |          |utiliser la 3ème partition du premier disque en la  |
    |root      |désignant par « (hd0,2) » avec GRUB legacy ou par « |
    |          |(hd0,3) » dans GRUB 2                               |
    |----------+----------------------------------------------------|
    |kernel    |utiliser le noyau se trouvant en « /vmlinuz » avec  |
    |          |le paramètre du noyau : « root=/dev/hda3 ro »       |
    |----------+----------------------------------------------------|
    |initrd    |utiliser l’image initrd/initramfs située en « /     |
    |          |initrd.img »                                        |
    +---------------------------------------------------------------+


    Note

    La valeur du numéro de partition utilisé par le programme « GRUB
    legacy » est inférieure d’un unité à celle normalement utilisée
    par le noyau de Linux et les outils utilitaires. Le programme
    GRUB 2 corrige ce problème.

    Astuce

    Un UUID (consultez Section 9.5.3, « Accès à une partition en
    utilisant l’UUID ») peut être utilisé pour identifier un
    périphérique spécial par bloc plutôt que son nom de fichier comme
    « /dev/hda3 », par exemple, « root=UUID=
    81b289d5-4341-4003-9602-e254a17ac232 ro ».

    Astuce

    Si GRUB est le chargeur en usage, le paramètre de démarrage du
    noyau est spécifié dans /boot/grub/grub.cfg. Sur les systèmes
    Debian, il ne faut pas modifier soi-même /boot/grub/grub.cfg. Il
    faut modifier la valeur de GRUB_CMDLINE_LINUX_DEFAULT dans /etc/
    default/grub puis exécuter update-grub(8) qui se charge de la
    mise à jour de /boot/grub/grub.cfg.

    Astuce

    Vous pouvez démarrer un chargeur d’amorçage depuis un autre
    chargeur d’amorçage en utilisant une technique appelée chargement
    en chaîne (« chain loading »).

    Consultez « info grub » et grub-install(8).

%

3.1.3. Étage 3 : le système mini-Debian

    Le système mini-Debian est la troisième étape du processus
    d’amorçage lancée par le chargeur d’amorçage. Elle lance le noyau
    du système avec son système de fichiers racine en mémoire. C’est
    une étape préparatoire facultative du processus de démarrage.

    Note

    Le terme « système mini-Debian » est utilisé par l’auteur pour
    décrire dans ce document cette 3ème étape du processus de
    démarrage. On désigne souvent ce système par système initrd. Un
    système semblable en mémoire est utilisé par l’installateur
    Debian.

    The "/init" program is executed as the first program in this root
    filesystem on the memory. It is a program which initializes the
    kernel in user space and hands control over to the next stage.
    This mini-Debian system offers flexibility to the boot process
    such as adding kernel modules before the main boot process or
    mounting the root filesystem as an encrypted one.

      * The "/init" program is a shell script program if initramfs
        was created by initramfs-tools.

          + Vous pouvez interrompre cette partie du processus
            d’amorçage afin d’obtenir l’invite de l’interpréteur de
            l’administrateur en indiquant « break=init » etc. comme
            paramètre de démarrage du noyau. Consultez le script « /
            init » pour d’autres conditions d’interruption. Cet
            environnement d’interpréteur de commandes est
            suffisamment sophistiqué pour effectuer une bonne
            inspection du matériel de votre machine.

          + Les commandes disponibles avec ce système mini-Debian
            sont des commandes réduites et sont principalement
            fournies par un outil GNU appelé busybox(1).

      * The "/init" program is a binary systemd program if initramfs
        was created by dracut.

          + Commands available in this mini-Debian system are
            stripped down systemd(1) environment.

    Attention
   
    Vous devrez utiliser l’option « -n » de la commande mount lorsque
    vous êtes sur le système de fichiers en lecture seule.

%

3.1.4. Étage 4 : le système Debian normal

    Le système Debian normal est le quatrième étage du processus
    d’amorçage, il est lancé par le système mini-Debian. Le noyau du
    système mini-Debian continue de tourner dans cet environnement.
    Le système de fichiers racine passe de celui en mémoire à celui,
    réel, lu sur le disque dur.

    Le programme init est le premier à être exécuté, assorti du PID=
    1, afin qu’il accomplisse son rôle de processus principal du
    démarrage, qui consiste à commander l’exécution de plusieurs
    programmes. Le chemin par défaut du programme init est « /sbin/
    init » mais il peut être modifié en passant un paramètre de
    démarrage au noyau, comme suit : « init=/chemin/vers/
    programme_init ».

    Le programme d’initialisation par défaut a subi des changements :

      * Les versions de Debian antérieures à squeeze utilisent une
        simple initialisation façon SysV.

      * Debian Wheezy améliore le système d'init de style SysV en
        ordonnançant la séquence de démarrage avec les en-têtes LSB
        et en lançant l’exécution parallèle de scripts de démarrage.

      * Debian jessie change de système d'initialisation par défaut
        au profit de systemd pour une initialisation parallélisée et
        pilotée par événements.

    Astuce
   
    Il est possible de vérifier le niveau d’exécution courant de la
    commande init du système avec la commande « ps --pid 1 -f ».

    Astuce
   
    "/sbin/init" is symlinked to "/lib/systemd/systemd" after Debian
    jessie.

    Tableau 3.3. Liste d’utilitaires d’amorçage initial pour le
    système Debian :

    +---------------------------------------------------------------+
    |      paquet       |popcon|taille|         description         |
    |-------------------+------+------+-----------------------------|
    |                   |      |      |démon init(8) basé sur des   |
    |systemd            |V:810,|15998 |événements pour la           |
    |                   |I:916 |      |concurrence (remplacement de |
    |                   |      |      |sysvinit)                    |
    |-------------------+------+------+-----------------------------|
    |                   |V:802,|      |the manual pages and links   |
    |systemd-sysv       |I:914 |138   |needed for systemd to replace|
    |                   |      |      |sysvinit                     |
    |-------------------+------+------+-----------------------------|
    |                   |V:1,  |      |systemd units to provide cron|
    |systemd-cron       |I:1   |143   |daemon and anacron           |
    |                   |      |      |functionality                |
    |-------------------+------+------+-----------------------------|
    |init-system-helpers|V:675,|131   |helper tools for switching   |
    |                   |I:930 |      |between sysvinit and systemd |
    |-------------------+------+------+-----------------------------|
    |initscripts        |V:91, |176   |scripts pour initialiser et  |
    |                   |I:323 |      |arrêter le système           |
    |-------------------+------+------+-----------------------------|
    |sysvinit-core      |V:7,  |276   |Utilitaires init(8) de type  |
    |                   |I:9   |      |System-V                     |
    |-------------------+------+------+-----------------------------|
    |                   |V:183,|      |Mécanisme de changement de   |
    |sysv-rc            |I:335 |81    |niveau de fonctionnement de  |
    |                   |      |      |type System-V                |
    |-------------------+------+------+-----------------------------|
    |sysvinit-utils     |V:494,|79    |Utilitaires de type System-V |
    |                   |I:999 |      |(startpar(8), bootlogd(8), …)|
    |-------------------+------+------+-----------------------------|
    |                   |V:881,|      |Linux Standard Base 3.2      |
    |lsb-base           |I:999 |49    |fonctionnalité de script     |
    |                   |      |      |d’initialisation             |
    |-------------------+------+------+-----------------------------|
    |                   |      |      |outil pour organiser la      |
    |insserv            |V:210,|150   |séquence de démarrage en     |
    |                   |I:330 |      |utilisant les dépendances du |
    |                   |      |      |script LSB de init.d         |
    |-------------------+------+------+-----------------------------|
    |                   |      |      |outil permettant d’utiliser  |
    |uswsusp            |V:3,  |714   |le programme de l’espace     |
    |                   |I:8   |      |utilisateur de mise en veille|
    |                   |      |      |fourni par Linux             |
    |-------------------+------+------+-----------------------------|
    |                   |V:1,  |      |outil kexec pour le          |
    |kexec-tools        |I:8   |278   |redémarrage par kexec(8)     |
    |                   |      |      |(redémarrage à chaud)        |
    |-------------------+------+------+-----------------------------|
    |systemd-bootchart  |V:0,  |128   |analyseur des performances du|
    |                   |I:1   |      |processus de démarrage       |
    |-------------------+------+------+-----------------------------|
    |bootchart2         |V:0,  |94    |analyseur des performances du|
    |                   |I:0   |      |processus de démarrage       |
    |-------------------+------+------+-----------------------------|
    |                   |V:0,  |      |analyseur des performances du|
    |pybootchartgui     |I:0   |177   |processus de démarrage       |
    |                   |      |      |(virtualisation)             |
    |-------------------+------+------+-----------------------------|
    |mingetty           |V:0,  |38    |getty(8) en mode console     |
    |                   |I:3   |      |uniquement                   |
    |-------------------+------+------+-----------------------------|
    |                   |V:0,  |      |modem intelligent (« smart   |
    |mgetty             |I:1   |315   |modem ») remplaçant de getty |
    |                   |      |      |(8)                          |
    +---------------------------------------------------------------+


    Astuce
   
    Vous trouverez des conseils actualisés pour accélérer le
    processus de démarrage sur Debian wiki:BootProcessSpeedup.

%

3.2. Systemd init

    This section describes how system is started by the systemd(1)
    program with PID=1 (i.e., init process).

    The systemd init process spawns processes in parallel based on
    the unit configuration files (see systemd.unit(5)) which are
    written in declarative style instead of SysV-like procedural
    style. These are loaded from a set of paths (see 
    systemd-system.conf(5)) as follows:

      * "/lib/systemd/system": OS default configuration files

      * "/etc/systemd/system": system administrator configuration
        files which override the OS default configuration files

      * "/run/systemd/system": run-time generated configuration files
        which override the installed configuration files

    Their inter-dependencies are specified by the directives "Wants=
    ", "Requires=", "Before=", "After=", … (see "MAPPING OF UNIT
    PROPERTIES TO THEIR INVERSES" in systemd.unit(5)). The resource
    controls are also defined (see systemd.resource-control(5)).

    The suffix of the unit configuration file encodes their types as:

      * *.service describes the process controlled and supervised by
        systemd. See systemd.service(5).

      * *.device describes the device exposed in the sysfs(5) as udev
        (7) device tree. See systemd.device(5).

      * *.mount describes the file system mount point controlled and
        supervised by systemd. See systemd.mount(5).

      * *.automount describes the file system auto mount point
        controlled and supervised by systemd. See systemd.automount
        (5).

      * *.swap describes the swap device or file controlled and
        supervised by systemd. See systemd.swap(5).

      * *.path describes the path monitored by systemd for path-based
        activation. See systemd.path(5).

      * *.socket describes the socket controlled and supervised by
        systemd for socket-based activation. See systemd.socket(5).

      * *.timer describes the timer controlled and supervised by
        systemd for timer-based activation. See systemd.timer(5).

      * *.slice manages resources with the cgroups(7). See 
        systemd.slice(5).

      * *.scope is created programmatically using the bus interfaces
        of systemd to manages a set of system processes. See 
        systemd.scope(5).

      * *.target groups other unit configuration files to create the
        synchronization point during start-up. See systemd.target(5).

    Upon system start up (i.e., init), the systemd process tries to
    start the "/lib/systemd/system/default.target (normally symlinked
    to "graphical.target"). First, some special target units (see 
    systemd.special(7)) such as "local-fs.target", "swap.target" and
    "cryptsetup.target" are pulled in to mount the filesystems. Then,
    other target units are also pulled in by the target unit
    dependencies. For details, read bootup(7).

    systemd offers backward compatibility features. SysV-style boot
    scripts in "/etc/init.d/rc[0123456S].d/[KS]<name>" are still
    parsed and telinit(8) is translated into systemd unit activation
    requests.

    Attention
   
    Emulated runlevel 2 to 4 are all symlinked to the same
    "multi-user.target".

%

3.2.1. Nom de machine (« hostname »)

    The kernel maintains the system hostname. The system unit started
    by systemd-hostnamed.service sets the system hostname at boot
    time to the name stored in "/etc/hostname". This file should
    contain only the system hostname, not a fully qualified domain
    name.

    Pour afficher le nom de la machine utilisée, lancez la commande 
    hostname (1) sans paramètre.

%

3.2.2. Le système de fichiers

    The mount options of normal disk and network filesystems are set
    in "/etc/fstab". See fstab(5) and Section 9.5.7, « Optimisation
    du système de fichiers à l’aide des options de montage ».

    The configuration of the encrypted filesystem is set in "/etc/
    crypttab". See crypttab(5)

    The configuration of software RAID with mdadm(8) is set in "/etc/
    mdadm/mdadm.conf". See mdadm.conf(5).

    Avertissement

    Une fois tous les systèmes de fichiers montés, les fichiers
    temporaires se trouvant dans « /tmp », « /var/lock » et « /var/
    run » sont effacés lors de chaque démarrage du système.

%

3.2.3. Initialisation de l’interface réseau

    Network interfaces are typically initialized in
    "networking.service" for the lo interface and
    "NetworkManager.service" for other interfaces on modern Debian
    desktop system under systemd.

    Voir Chapitre 5, Configuration du réseau pour savoir comment les
    configurer.

%

3.2.4. Messages du noyau

    The kernel error message displayed to the console can be
    configured by setting its threshold level.

    # dmesg -n3

    Tableau 3.4. Liste des niveaux d’erreur du noyau

    +---------------------------------------------------------------+
    |valeur du niveau| nom du niveau |        signification         |
    |    d’erreur    |   d’erreur    |                              |
    |----------------+---------------+------------------------------|
    |0               |KERN_EMERG     |le système est inutilisable   |
    |----------------+---------------+------------------------------|
    |1               |KERN_ALERT     |une action doit être          |
    |                |               |entreprise immédiatement      |
    |----------------+---------------+------------------------------|
    |2               |KERN_CRIT      |conditions critiques          |
    |----------------+---------------+------------------------------|
    |3               |KERN_ERR       |conditions d’erreur           |
    |----------------+---------------+------------------------------|
    |4               |KERN_WARNING   |conditions d’avertissement    |
    |----------------+---------------+------------------------------|
    |5               |KERN_NOTICE    |condition normale mais        |
    |                |               |significative                 |
    |----------------+---------------+------------------------------|
    |6               |KERN_INFO      |information                   |
    |----------------+---------------+------------------------------|
    |7               |KERN_DEBUG     |messages du niveau de débogage|
    +---------------------------------------------------------------+


%

3.2.5. Messages du système

    Under systemd, both kernel and system messages are logged by the
    journal service systemd-journald.service (a.k.a journald) either
    into a persistent binary data below "/var/log/journal" or into a
    volatile binary data below "/run/log/journal/". These binary log
    data are accessed by the journalctl(1) command.

    Under systemd, the system logging utility rsyslogd(8) changes its
    behavior to read the volatile binary log data (instead of
    pre-systemd default "/dev/log") and to create traditional
    permanent ASCII system log data.

    Les messages du système peuvent être personnalisés au moyen de « 
    /etc/default/rsyslog » et « /etc/rsyslog.conf » à la fois pour le
    fichier journal et pour l’affichage à l’écran. Consultez rsyslogd
    (8) et rsyslog.conf(5). Consultez aussi Section 9.2.2,
    « Analyseur de journaux ».

%

3.2.6. System management under systemd

    The systemd offers not only init system but also generic system
    management functionalities such as journal logging, login
    management, time management, network management. etc..

    The systemd(1) is managed by several commands:

      * the systemctl(1) command controls the systemd system and
        service manager (CLI),

      * the systemsdm(1) command controls the systemd system and
        service manager (GUI),
   
      * the journalctl(1) command queries the systemd journal,

      * the loginctl(1) command controls the systemd login manager,
        and

      * the systemd-analyze(1) analyzes system boot-up performance.

    Here are a list of typical systemd management command snippets.
    For the exact meanings, please read the pertinent manpages.

    Tableau 3.5. List of typical systemd management command snippets

    +---------------------------------------------------------------+
    |        Operation         |   Type    |    Command snippets    |
    |--------------------------+-----------+------------------------|
    |GUI for service manager   |GUI        |"systemadm" (systemd-ui |
    |                          |           |package)                |
    |--------------------------+-----------+------------------------|
    |List all target unit      |Unit       |"systemctl list-units   |
    |configuration             |           |--type=target"          |
    |--------------------------+-----------+------------------------|
    |List all service unit     |Unit       |"systemctl list-units   |
    |configuration             |           |--type=service"         |
    |--------------------------+-----------+------------------------|
    |List all unit             |Unit       |"systemctl list-units   |
    |configuration types       |           |--type=help"            |
    |--------------------------+-----------+------------------------|
    |List all socket units in  |Unit       |"systemctl list-sockets"|
    |memory                    |           |                        |
    |--------------------------+-----------+------------------------|
    |List all timer units in   |Unit       |"systemctl list-timers" |
    |memory                    |           |                        |
    |--------------------------+-----------+------------------------|
    |Start "$unit"             |Unit       |"systemctl start $unit" |
    |--------------------------+-----------+------------------------|
    |Stop "$unit"              |Unit       |"systemctl stop $unit"  |
    |--------------------------+-----------+------------------------|
    |Reload service-specific   |Unit       |"systemctl reload $unit"|
    |configuration             |           |                        |
    |--------------------------+-----------+------------------------|
    |Stop and start all "$unit"|Unit       |"systemctl restart      |
    |                          |           |$unit"                  |
    |--------------------------+-----------+------------------------|
    |Start "$unit" and stop all|Unit       |"systemctl isolate      |
    |others                    |           |$unit"                  |
    |--------------------------+-----------+------------------------|
    |Switch to "graphical" (GUI|Unit       |"systemctl isolate      |
    |system)                   |           |graphical"              |
    |--------------------------+-----------+------------------------|
    |Switch to "multi-user"    |Unit       |"systemctl isolate      |
    |(CLI system)              |           |multi-user"             |
    |--------------------------+-----------+------------------------|
    |Switch to "rescue" (single|Unit       |"systemctl isolate      |
    |user CLI system)          |           |rescue"                 |
    |--------------------------+-----------+------------------------|
    |Send kill signal to       |Unit       |"systemctl kill $unit"  |
    |"$unit"                   |           |                        |
    |--------------------------+-----------+------------------------|
    |Check if "$unit" service  |Unit       |"systemctl is-active    |
    |is active                 |           |$unit"                  |
    |--------------------------+-----------+------------------------|
    |Check if "$unit" service  |Unit       |"systemctl is-failed    |
    |is failed                 |           |$unit"                  |
    |--------------------------+-----------+------------------------|
    |Check status of "$unit|   |Unit       |"systemctl status $unit||
    |$PID|device"              |           |$PID|$device"           |
    |--------------------------+-----------+------------------------|
    |Show properties of "$unit||Unit       |"systemctl show $unit|  |
    |$job"                     |           |$job"                   |
    |--------------------------+-----------+------------------------|
    |Reset failed "$unit"      |Unit       |"systemctl reset-failed |
    |                          |           |$unit"                  |
    |--------------------------+-----------+------------------------|
    |List dependency of all    |Unit       |"systemctl              |
    |unit services             |           |list-dependencies --all"|
    |--------------------------+-----------+------------------------|
    |List unit files installed |Unit file  |"systemctl              |
    |on the system             |           |list-unit-files"        |
    |--------------------------+-----------+------------------------|
    |Enable "$unit" (add       |Unit file  |"systemctl enable $unit"|
    |symlink)                  |           |                        |
    |--------------------------+-----------+------------------------|
    |Disable "$unit" (remove   |Unit file  |"systemctl disable      |
    |symlink)                  |           |$unit"                  |
    |--------------------------+-----------+------------------------|
    |Unmask "$unit" (remove    |Unit file  |"systemctl unmask $unit"|
    |symlink to "/dev/null")   |           |                        |
    |--------------------------+-----------+------------------------|
    |Mask "$unit" (add symlink |Unit file  |"systemctl mask $unit"  |
    |to "/dev/null")           |           |                        |
    |--------------------------+-----------+------------------------|
    |Get default-target setting|Unit file  |"systemctl get-default" |
    |--------------------------+-----------+------------------------|
    |Set default-target to     |Unit file  |"systemctl set-default  |
    |"graphical" (GUI system)  |           |graphical"              |
    |--------------------------+-----------+------------------------|
    |Set default-target to     |Unit file  |"systemctl set-default  |
    |"multi-user" (CLI system) |           |multi-user"             |
    |--------------------------+-----------+------------------------|
    |Show job environment      |Environment|"systemctl              |
    |                          |           |show-environment"       |
    |--------------------------+-----------+------------------------|
    |Set job environment       |           |"systemctl              |
    |"variable" to "value"     |Environment|set-environment variable|
    |                          |           |=value"                 |
    |--------------------------+-----------+------------------------|
    |Unset job environment     |           |"systemctl              |
    |"variable"                |Environment|unset-environment       |
    |                          |           |variable"               |
    |--------------------------+-----------+------------------------|
    |Reload all unit files and |Lifecycle  |"systemctl              |
    |daemons                   |           |daemon-reload"          |
    |--------------------------+-----------+------------------------|
    |Shut down the system      |System     |"systemctl poweroff"    |
    |--------------------------+-----------+------------------------|
    |Shut down and reboot the  |System     |"systemctl reboot"      |
    |system                    |           |                        |
    |--------------------------+-----------+------------------------|
    |Suspend the system        |System     |"systemctl suspend"     |
    |--------------------------+-----------+------------------------|
    |Hibernate the system      |System     |"systemctl hibernate"   |
    |--------------------------+-----------+------------------------|
    |View job log of "$unit"   |Journal    |"journalctl -u $unit"   |
    |--------------------------+-----------+------------------------|
    |View job log of "$unit"   |Journal    |"journalctl -u $unit -f"|
    |("tail -f" style)         |           |                        |
    |--------------------------+-----------+------------------------|
    |Show time spent for each  |Analyze    |"systemd-analyze time"  |
    |initialization steps      |           |                        |
    |--------------------------+-----------+------------------------|
    |List of all units by the  |Analyze    |"systemd-analyze blame" |
    |time to initialize        |           |                        |
    |--------------------------+-----------+------------------------|
    |Load and detect errors in |Analyze    |"systemd-analyze verify |
    |"$unit" file              |           |$unit"                  |
    |--------------------------+-----------+------------------------|
    |Track boot process by the |Cgroup     |"systemd-cgls"          |
    |cgroups(7)                |           |                        |
    |--------------------------+-----------+------------------------|
    |Track boot process by the |Cgroup     |"ps xawf -eo            |
    |cgroups(7)                |           |pid,user,cgroup,args"   |
    |--------------------------+-----------+------------------------|
    |Track boot process by the |Cgroup     |Read sysfs under "/sys/ |
    |cgroups(7)                |           |fs/cgroup/systemd/"     |
    +---------------------------------------------------------------+


    Here, "$unit" in the above examples may be a single unit name
    (suffix such as .service and .target are optional) or, in many
    cases, multiple unit specifications (shell-style globs "*", "?",
    "[]" using fnmatch(3) which will be matched against the primary
    names of all units currently in memory).

    System state changing commands in the above examples are
    typically preceded by the "sudo" to attain the required
    administrative privilege.

    The output of the "systemctl status $unit|$PID|$device" uses
    color of the dot ("●") to summarize the unit state at a glance.

      * White "●" indicates an "inactive" or "deactivating" state.

      * Red "●" indicates a "failed" or "error" state.

      * Green "●" indicates an "active", "reloading" or "activating"
        state.

%

3.2.7. Customizing systemd

    With default installation, many network services (see Chapitre 6,
    Applications réseau) are started as daemon processes after
    network.target at boot time by systemd. The "sshd" is no
    exception. Let's change this to on-demand start of "sshd" as a
    customization example.

    First, disable system installed service unit.

     $ sudo systemctl stop sshd.service
     $ sudo systemctl mask sshd.service

    The on-demand socket activation system of the classic Unix
    services was through the indetd superserver. Under systemd, the
    equivalent can be enabled by adding *.socket and *.service unit
    configuration files.

    sshd.socket for specifying a socket to listen on

    [Unit]
    Description=SSH Socket for Per-Connection Servers

    [Socket]
    ListenStream=22
    Accept=yes

    [Install]
    WantedBy=sockets.target

    sshd@.service as the matching service file of sshd.socket

    [Unit]
    Description=SSH Per-Connection Server
   
    [Service]
    ExecStart=-/usr/sbin/sshd -i
    StandardInput=socket

    Then reload.

     $ sudo systemctl daemon-reload

%

3.3. Le système udev

    À partir de la version 2.6 du noyau Linux, le système udev
    fournit un mécanisme de découverte et d’initialisation
    automatique du matériel (consultez udev(7)). Lors de la
    découverte de chaque périphérique par le noyau, le système udev
    lance un processus utilisateur qui utilise les informations
    provenant du système de fichiers sysfs (consultez Section 1.2.12,
    « procfs et sysfs »), charge les modules du noyau nécessaires
    pour sa prise en charge en utilisant le programme modprobe(8)
    (consultez Section 3.3.1, « Initialisation des modules du noyau »
    ) et crée les nœuds de périphériques en conséquence.

    Astuce

    Si « /lib/modules/<kernel-version>/modules.dep » n’a pas été
    proprement créé par depmod(8) pour quelque raison, les modules
    peuvent ne pas être chargés par le système udev comme on le
    souhaiterait. Lancez « depmod -a » pour corriger ce problème.

    Le nom des nœuds de périphériques peut être configuré par les
    fichiers de règle de udev se trouvant dans « /etc/udev/rules.d/
     ». Les règles actuelles par défaut tendent à créer des noms
    générés dynamiquement ce qui donne des noms de périphériques non
    statiques excepté pour les périphériques cd et réseau. En
    ajoutant vos règles personnalisées semblables à celles existantes
    pour les périphériques cd et réseau, vous pouvez aussi créer des
    noms de périphériques statiques pour les autres périphériques
    comme les clés USB. Consultez « Écrire des règles udev » ou « /
    usr/share/doc/udev/writing_udev_rules/index.html ».

    Comme le système udev est une cible quelque peu mouvante, je
    laisse les détails pour d’autres documentations et je ne donnerai
    ici qu’un minimum d’informations.

    Astuce

    Les nœuds de périphériques n’ont pas besoin d’être statiques pour
    les règles de montage se trouvant dans « /etc/fstab ». Vous
    pouvez utiliser UUID à la place de leur nom de périphérique tel
    que« /dev/sda » pour monter les périphériques. Consultez
    Section 9.5.3, « Accès à une partition en utilisant l’UUID ».

%

3.3.1. Initialisation des modules du noyau

    Le programme modprobe(8) nous permet de configurer, depuis un
    processus utilisateur, un noyau Linux en cours d’exécution en
    ajoutant ou en supprimant des modules du noyau. Le système udev
    (consultez Section 3.3, « Le système udev ») en automatise
    l’appel afin d’aider à l’initialisation du module du noyau.

    Il existe des modules non liés au matériel et des modules qui
    pilotent des éléments matériels particuliers comme les suivants
    qui demandent à être préchargés en les déclarant dans le fichier
    « /etc/modules » (consultez modules(5)).

      * les modules TUN/TAP fournissent un périphérique de réseau
        virtuel point-à-point (TUN) et un périphérique de réseau
        virtuel Ethernet (TAP) ;

      * les modules netfilter fournissent les fonctions de pare-feu
        netfilter (iptables(8), Section 5.10, « Infrastructure de
        netfilter ») ;

      * le module du pilote du temporisateur de chien de garde.

    Les fichiers de configuration du programme modprobe(8) se
    trouvent dans le répertoire « /etc/modprobes.d/ » comme c’est
    expliqué dans modprobe.conf(5). (Si vous souhaitez que certains
    modules du noyau ne soient pas chargés automatiquement, vous
    pouvez les mettre en liste noire dans le fichier« /etc/
    modprobes.d/blacklist »).

    Le fichier « /lib/modules/<version>/modules.dep » généré par le
    programme depmod(8) décrit les dépendances des modules utilisés
    par le programme modprobe(8).

    Note

    Si vous rencontrez des problèmes de chargement de modules lors du
    chargement des modules au démarrage ou avec modprobe(8), « depmod
    -a » peut résoudre ces problèmes en reconstruisant
    « modules.dep ».

    Le programme modinfo(8) affiche des informations concernant les
    modules du noyau.

    Le programme lsmod(8) formate de manière agréable le contenu de
    « /proc/modules », affichant quels sont les modules du noyau
    actuellement chargés.

    Astuce
   
    Vous pouvez identifier le matériel exact installé sur votre
    système. Consultez Section 9.4.3, « Identification du matériel ».

    Astuce

    Vous pouvez configurer le matériel au moment du démarrage pour
    activer les fonctionnalités désirées de ce matériel. Consultez
    Section 9.4.4, « Configuration matérielle ».

    Astuce

    Vous pouvez probablement ajouter la prise en charge d’un
    périphérique particulier en recompilant le noyau. Consultez
    Section 9.9, « Le noyau ».

Chapitre 4. Authentification

    Lorsqu’une personne (ou un programme) demande l’accès au système,
    l’authentification confirme que l’identité est autorisée.

    Avertissement

    Des erreurs de configuration de PAM peuvent vous mettre à la
    porte de votre propre système. Vous devez avoir un CD de secours
    prêt ou une partition de démarrage de remplacement. Pour
    restaurer, démarrez le système depuis l’un de ces moyens de
    secours et corrigez les choses depuis là.

    Avertissement
   
    Ce chapitre est obsolète car il est basé sur Debian 7.0 (1Wheezy)
    sortit en 2013.

%

4.1. Authentification normale d’UNIX

    L’authentification normale d’UNIX est fournie par le module 
    pam_unix(8) avec PAM (Pluggable Authentication Modules :
    « Modules attachables d’authentification ») . Il y a trois
    fichiers de configuration importants, dont les entrées sont
    séparées par des « : », ce sont :

    Tableau 4.1. 3 fichiers de configuration importants pour pam_unix
    (8)

    +---------------------------------------------------------------+
    |fichier|autorisation|utilisateur|groupe|      description      |
    |-------+------------+-----------+------+-----------------------|
    |/etc/  |            |           |      |informations des       |
    |passwd |-rw-r--r--  |root       |root  |comptes utilisateurs   |
    |       |            |           |      |(assainie)             |
    |-------+------------+-----------+------+-----------------------|
    |/etc/  |            |           |      |informations sécurisées|
    |shadow |-rw-r-----  |root       |shadow|des comptes            |
    |       |            |           |      |utilisateurs           |
    |-------+------------+-----------+------+-----------------------|
    |/etc/  |-rw-r--r--  |root       |root  |informations des       |
    |group  |            |           |      |groupes                |
    +---------------------------------------------------------------+


    « /etc/passwd » contient ce qui suit :

     ...
    utilisateur1:x:1000:1000:Nom Utilisateur1,,,:/home/utilisateur1:/bin/bash
    utilisateur2:x:1001:1001:Nom Utilisateur2,,,:/home/utilisateur2:/bin/bash
     ...

    Comme il est expliqué dans passwd(5), les entrées de ce fichier,
    séparées par des « : », ont la signification suivante :

      * nom de l’utilisateur pour la connexion ;

      * entrée de spécification du mot de passe ;

      * identifiant numérique de l’utilisateur ;

      * identifiant numérique du groupe ;

      * nom de l’utilisateur ou champ de commentaire ;

      * répertoire personnel de l’utilisateur ;

      * interpréteur de commandes, optionnel, de l’utilisateur.

    La seconde entrée de « /etc/passwd » était autrefois utilisée
    comme entrée de mot de passe chiffré. Depuis l’introduction de « 
    /etc/shadow », cette entrée est utilisée comme entrée de
    spécification du mot de passe.

    Tableau 4.2. Contenu de la seconde entrée de « /etc/passwd »

    +--------------------------------------------------------------+
    |contenu|                    signification                     |
    |-------+------------------------------------------------------|
    |(vide) |compte sans mot de passe                              |
    |-------+------------------------------------------------------|
    |x      |le mot de passe chiffré se trouve dans « /etc/shadow »|
    |-------+------------------------------------------------------|
    |*      |ce compte ne peut pas se connecter                    |
    |-------+------------------------------------------------------|
    |!      |ce compte ne peut pas se connecter                    |
    +--------------------------------------------------------------+


    « /etc/shadow » contient ceci :

     ...
    utilisateur1:$1$Xop0FYH9$IfxyQwBe9b8tiyIkt2P4F/:13262:0:99999:7:::
    utilisateur2:$1$vXGZLVbS$ElyErNf/agUDsm1DehJMS/:13261:0:99999:7:::
     ...

    Comme c’est expliqué dans shadow(5), les différentes entrées de
    ce fichier, séparées par des « : » ont les significations
    suivantes :

      * nom de l’utilisateur pour la connexion ;

      * mot de passe chiffré (le « $1$ » du début indique
        l’utilisation d’un chiffrement MD5. Le signe « * » indique
        que le compte ne peut pas se connecter) ;

      * Date du dernier changement de mot de passe, exprimé en nombre
        de jours passés depuis le premier janvier 1970.

      * Nombre de jours avant qu’un utilisateur ne soit autorisé à
        changer à nouveau son mot de passe.

      * Nombre de jours avant que l’utilisateur ne soit tenu de
        changer son mot de passe.

      * nombre de jours avant qu’un mot de passe n’arrive à
        expiration et durant lesquels l’utilisateur doit être
        averti ;

      * Nombre de jours durant lesquels un mot de passe devrait
        encore être accepté, passé sa date d’expiration.

      * Date d’expiration du compte, exprimée en nombre de jours
        passés depuis le premier janvier 1970.

      * …

    « /etc/group » contient ce qui suit :

    group1:x:20:utilisateur1,utilisateur2

    Comme il est expliqué dans group(5), les entrées de ce fichier,
    séparées par des « : », ont la signification suivante :

      * nom du groupe ;

      * mot de passe chiffré (non utilisé en pratique) ;
   
      * identifiant numérique du groupe ;

      * liste des noms d’utilisateurs séparés par des « , ».

    Note
   
    « /etc/gshadow » fournit les mêmes fonctions que « /etc/shadow »
    pour « /etc/group » mais n’est pas réellement utilisé.

    Note

    Le groupe d’appartenance réel d’un utilisateur peut être ajouté
    dynamiquement si la ligne « auth optional pam_group.so » est
    ajoutée à « /etc/pam.d/common-auth » et défini dans « /etc/
    security/group.conf ». Consultez pam_group(8).

    Note

    Le paquet base-passwd contient une liste faisant autorité
    d’utilisateurs et de groupes : « /usr/share/doc/base-passwd/
    users-and-groups.html ».

%

4.2. Gestion des informations des comptes et des mots de passes

    Voici quelques commandes importantes pour gérer les informations
    des comptes :

    Tableau 4.3. Liste des commandes servant à gérer les informations
    des comptes

    +---------------------------------------------------------------+
    |      commande      |                 fonction                 |
    |--------------------+------------------------------------------|
    |getent passwd       |consulter les informations du compte «    |
    |<nom_utilisateur>   |<nom_utilisateur> »                       |
    |--------------------+------------------------------------------|
    |getent shadow       |consulter les informations cachées du     |
    |<nom_utilisateur>   |compte « <nom_utilisateur> »              |
    |--------------------+------------------------------------------|
    |getent group        |consulter les informations du groupe «    |
    |<nom_groupe>        |<nom_ groupe> »                           |
    |--------------------+------------------------------------------|
    |passwd              |gérer le mot de passe de ce compte        |
    |--------------------+------------------------------------------|
    |passwd -e           |définir un mot de passe à usage unique    |
    |                    |pour l’activation du compte               |
    |--------------------+------------------------------------------|
    |chage               |gérer les informations de durée de        |
    |                    |validité du mot de passe                  |
    +---------------------------------------------------------------+


    Vous pouvez avoir besoin des droits de l’administrateur pour
    certaines fonctions. Consultez crypt(3) pour le chiffrement des
    mots de passe et des données.

    Note

    On the system set up with PAM and NSS as the Debian salsa
    machine, the content of local "/etc/passwd", "/etc/group" and "/
    etc/shadow" may not be actively used by the system. Above
    commands are valid even under such environment.

%

4.3. Mot de passe de qualité

    Lors de la création d’un mot de passe à l’installation de votre
    système ou avec la commande passwd(1), il vous faudra choisir un
    bon mot de passe composé d’au moins 6 à 8 caractères, comprenant
    au moins un des caractères appartenant à l’ensemble suivant
    conformément à passwd(1) :

      * caractères alphabétiques en minuscules ;

      * chiffres de 0 à 9 ;

      * marques de ponctuation.

    Avertissement

    Ne choisissez pas des mots qui se devinent aisément pour le mot
    de passe. Les noms de compte, les numéros de sécurité sociale,
    les numéros de téléphone, les adresses, les dates anniversaire,
    les noms des membres de votre famille ou de vos animaux
    domestiques, les mots du dictionnaire, les suites simples de
    caractères telles que « 12345 » ou « qwerty »… constituent tous
    de mauvais choix pour le mot de passe.

%

4.4. Créer un mot de passe chiffré

    Il existe des outils autonomes permettant de créer des mots de
    passe chiffrés à partir d’une « semence ».

    Tableau 4.4. Liste d’outils permettant de générer des mots de
    passe

    +---------------------------------------------------------------+
    |paquet |popcon|taille|commande|            fonction            |
    |-------+------+------+--------+--------------------------------|
    |       |V:35, |      |        |frontal de la bibliothèque crypt|
    |whois  |I:393 |364   |mkpasswd|(3) avec fonctionnalités        |
    |       |      |      |        |surabondantes                   |
    |-------+------+------+--------+--------------------------------|
    |openssl|V:794,|1465  |openssl |calculer le hachage du mot de   |
    |       |I:993 |      |passwd  |passe (OpenSSL). passwd(1ssl)   |
    +---------------------------------------------------------------+


%

4.5. PAM et NSS

    De nombreux systèmes modernes semblable à UNIX, comme le système
    Debian, fournissent les mécanismes PAM (Pluggable Authentication
    Modules) et NSS (Name Service Switch) pour la configuration du
    système par l’administrateur local. Leur rôle peut être résumé de
    la manière suivante :

      * PAM offre un mécanisme d’authentification souple qui est
        utilisé par les logiciels applicatifs lorsqu’ils ont besoins
        d’échanger des mots de passe.
   
      * NSS fournit un mécanisme souple de service de noms qui est
        fréquemment utilisé par la bibliothèque standard C pour
        obtenir le nom de groupe de programmes comme ls(1) et id(1).

    Ces systèmes PAM et NSS doivent être configurés de manière
    cohérente.

    Les paquets importants des systèmes PAM et NSS sont les
    suivants :

    Tableau 4.5. Liste des paquets importants des systèmes PAM et NNS

    +---------------------------------------------------------------+
    |      paquet       |popcon|taille|         description         |
    |-------------------+------+------+-----------------------------|
    |                   |      |      |PAM (« Pluggable             |
    |                   |V:807,|      |Authentication Modules »),   |
    |libpam-modules     |I:999 |1032  |Modules attachables          |
    |                   |      |      |d’authentification (service  |
    |                   |      |      |de base)                     |
    |-------------------+------+------+-----------------------------|
    |                   |      |      |Modules attachables          |
    |libpam-ldap        |I:12  |249   |d’authentification permettant|
    |                   |      |      |l’utilisation d’interfaces   |
    |                   |      |      |LDAP                         |
    |-------------------+------+------+-----------------------------|
    |                   |      |      |Modules attachables          |
    |libpam-cracklib    |I:16  |115   |d’authentification permettant|
    |                   |      |      |la prise en compte de        |
    |                   |      |      |cracklib                     |
    |-------------------+------+------+-----------------------------|
    |                   |V:474,|      |Pluggable Authentication     |
    |libpam-systemd     |I:853 |573   |Module to register user      |
    |                   |      |      |sessions for logind          |
    |-------------------+------+------+-----------------------------|
    |                   |      |      |Modules attachables          |
    |libpam-doc         |I:1   |1044  |d’authentification           |
    |                   |      |      |(documentation en html et    |
    |                   |      |      |texte)                       |
    |-------------------+------+------+-----------------------------|
    |                   |      |      |bibliothèque GNU C Library : |
    |libc6              |V:935,|12771 |bibliothèques partagées qui  |
    |                   |I:999 |      |fournissent aussi le service |
    |                   |      |      |« Name Service Switch »      |
    |-------------------+------+------+-----------------------------|
    |glibc-doc          |I:11  |3161  |bibliothèque GNU C : pages de|
    |                   |      |      |manuel                       |
    |-------------------+------+------+-----------------------------|
    |                   |      |      |bibliothèque GNU C : manuel  |
    |glibc-doc-reference|I:5   |12740 |de référence dans les formats|
    |                   |      |      |info, pdf et html (non libre)|
    |-------------------+------+------+-----------------------------|
    |libnss-mdns        |I:526 |150   |module NSS pour la résolution|
    |                   |      |      |des noms DNS Multicast       |
    |-------------------+------+------+-----------------------------|
    |                   |      |      |module NSS pour l’utilisation|
    |libnss-ldap        |I:11  |265   |de LDAP comme service de     |
    |                   |      |      |nommage                      |
    |-------------------+------+------+-----------------------------|
    |                   |      |      |module NSS pour l’utilisation|
    |libnss-ldapd       |I:14  |153   |de LDAP en tant que service  |
    |                   |      |      |de nommage (nouveau fork de  |
    |                   |      |      |libnss-ldap)                 |
    +---------------------------------------------------------------+


      * « The Linux-PAM System Administrators' Guide » de libpam-doc
        est essentiel à l’apprentissage de la configuration de PAM.
   
      * La section « System Databases and Name Service Switch » de
        glibc-doc-reference est essentielle pour l’apprentissage de
        la configuration de NSS.

    Note

    Vous en trouverez une liste plus complète et actuelle avec la
    commande « aptitude search 'libpam-|libnss-' ». L’acronyme NSS
    peut aussi signifier « Network Security Service » qui est
    différent de « Name Service Switch ».

    Note

    PAM est la manière la plus élémentaire d’initialiser des
    variables d’environnement pour tous les programmes avec des
    valeurs par défaut valables pour l’ensemble du système.

    Under systemd, libpam-systemd package is installed to manage user
    logins by registering user sessions in the systemd control group
    hierarchy for logind. See systemd-logind(8), logind.conf(5), and 
    pam_systemd(8).

%

4.5.1. Fichiers de configuration auxquels accèdent PAM et NSS

    Voici quelques fichiers de configuration importants auxquels PAM
    et NSS peuvent accéder :

    Tableau 4.6. Liste des fichiers de configuration auxquels PAM et
    NSS accèdent

    +---------------------------------------------------------------+
    |  fichier de   |                   fonction                    |
    | configuration |                                               |
    |---------------+-----------------------------------------------|
    |/etc/pam.d/    |définir la configuration de PAM pour le «      |
    |<nom_programme>|<nom_programme> », consultez pam(7) et pam.d(5)|
    |---------------+-----------------------------------------------|
    |/etc/          |définir la configuration de NSS avec une entrée|
    |nsswitch.conf  |pour chaque service. Consultez nsswitch.conf(5)|
    |---------------+-----------------------------------------------|
    |/etc/nologin   |limiter la connexion de l’utilisateur à l’aide |
    |               |du module pam_nologin(8)                       |
    |---------------+-----------------------------------------------|
    |/etc/securetty |limiter l’accès de l’administrateur à certains |
    |               |tty à l’aide du module pam_securetty(8)        |
    |---------------+-----------------------------------------------|
    |/etc/security/ |limiter les accès à l’aide du module pam_access|
    |access.conf    |(8)                                            |
    |---------------+-----------------------------------------------|
    |/etc/security/ |définir les limitations en fonction du groupe à|
    |group.conf     |l’aide du module pam_group(8)                  |
    |---------------+-----------------------------------------------|
    |/etc/security/ |définir des variables d’environnement à l’aide |
    |pam_env.conf   |du module pam_env(8)                           |
    |---------------+-----------------------------------------------|
    |/etc/          |définir des variables d’environnement          |
    |environment    |supplémentaires à l’aide du module pam_env(8)  |
    |               |avec le paramètre « readenv=1 »                |
    |---------------+-----------------------------------------------|
    |               |définir les paramètres linguistiques           |
    |/etc/default/  |(« locale ») à l’aide du module pam_env(8) avec|
    |locale         |le paramètre « readenv=1 envfile=/etc/default/ |
    |               |locale » (Debian)                              |
    |---------------+-----------------------------------------------|
    |/etc/security/ |définir les limitations de ressources (ulimit, |
    |limits.conf    |core, …) à l’aide du module pam_linits(8)      |
    |---------------+-----------------------------------------------|
    |/etc/security/ |définir les restrictions de temps à l’aide du  |
    |time.conf      |module pam_time(8)                             |
    |---------------+-----------------------------------------------|
    |/etc/systemd/  |set systemd login manager configuration (see   |
    |logind.conf    |logind.conf(5) and systemd-logind.service(8))  |
    +---------------------------------------------------------------+


    Les limitations dans la sélection des mots de passe est
    implémentée par les modules PAM pam_unix(8) et pam_cracklib(8).
    Ils peuvent être configurés à l’aide de leurs paramètres.

    Astuce
   
    Les noms de fichiers des modules PAM ont le suffixe « .so ».

%

4.5.2. Le système de gestion centralisée moderne

    La gestion centralisée du système peut être mise en œuvre en
    utilisant le serveur centralisé LDAP Protocole léger d’accès aux
    répertoires (« Lightweight Directory Access Protocol ») pour
    administrer de nombreux systèmes semblables à UNIX ou autres sur
    le réseau. Le logiciel OpenLDAP est l’implémentation à sources
    ouvertes du protocole LDAP

    Sur un système Debian, le serveur LDAP fournit les informations
    de compte en utilisant PAM et de NSS avec les paquets libpam-ldap
    et libnss-ldap. Un certain nombre d’actions sont nécessaires pour
    l’activer (je n’ai pas utilisé cette configuration et ce qui suit
    est une information secondaire. Veuillez la lire dans ce
    contexte) :

      * définissez un serveur LDAP centralisé en faisant tourner un
        programme tel que le démon LDAP, slapd(8) ;

      * modifiez les fichiers de configuration de PAM dans le
        répertoire « /etc/pam.d/ » pour utiliser « pam_ldap.so »
        plutôt que le module par défaut « pam_unix.so » ;

          + Debian utilise « /etc/pam_ldap.conf » comme fichier de
            configuration de libpam-ldap et «nbsp;/etc/
            pam_ldap.secret » pour enregistrer le mot de passe de
            root.

      * modifiez la configuration de NSS dans le fichier « /etc/
        nsswitch.conf » pour utiliser « ldap » plutôt que ce qui s’y
        trouve par défaut (« compat » ou « file ») ;

          + Debian utilise « /etc/libnss-ldap.conf » comme fichier de
            configuration de libnss-ldap.

      * vous devez configurer libpam-ldap de manière à ce qu’il
        utilise une connexion SSL (ou TLS) pour la sécurité du mot de
        passe ;

      * vous pouvez configurer libnss-ldap de manière à ce qu’il
        utilise une connexion SSL (ou TLS) afin d’assurer l’intégrité
        des données au prix d’une surcharge du réseau LDAP ;

      * Afin de réduire le trafic réseau de LDAP, vous devrez faire
        tourner nscd(8) localement pour mettre en cache les résultats
        de recherche de LDAP .

    Consultez les documentations dans pam_ldap.conf(5) et « /usr/
    share/doc/libpam-doc/html/ » qui sont fournies par le paquet
    libpam-doc et « info libc 'Name Service Switch' fournie par le
    paquet glibc-doc.

    De manière similaire, vous pouvez mettre en œuvre des systèmes
    centralisés de remplacement avec d’autres méthodes.

      * Intégration d’utilisateur et de groupe au système Windows.

          + Accès aux services de Domaine (Microsoft) avec les
            paquets winbind et libpam_winbind.

          + Consultez winbindd(8) et Intégration de réseaux MS
            Windows avec Samba.
   
      * Intégration d’utilisateur et de groupe à l’ancien système de
        type UNIX.

          + Accès à NIS (appelé initialement YP) ou NIS+ avec le
            paquet nis.

          + Consultez Le Linux NIS(YP)/NYS/NIS+ HOWTO.

4.5.3. « Pourquoi la commande su de GNU ne gère-t-elle pas le groupe
wheel »

    C’est la célèbre phrase de Richard M. Stallman en bas de
    l’ancienne page info su. Ne pas s’inquiéter : la commande su
    actuelle de https://www.debian.org utilise PAM, on peut donc
    restreindre l’accès de su au groupe root en activant la ligne de
    « /etc/pam.d/su »comportant « pam_wheel.so ».

%

4.5.4. Règle de mots de passe plus stricte

    L’installation du paquet libpam-cracklib vous permet de forcer
    des règles plus strictes concernant les mots de passe en mettant,
    par exemple, les lignes suivantes dans « /etc/pam.d/
    common-password » :

    Pour squeeze :

    password required pam_cracklib.so retry=3 minlen=9 difok=3
    password [success=1 default=ignore] pam_unix.so use_authtok nullok md5
    password requisite pam_deny.so
    password required pam_permit.so

%

4.6. Autres contrôles d’accès

    Note

    Consultez Section 9.3.15, « touche Alt-SysRq » pour restreindre
    la fonctionnalité de touche d’appel sécurisée (SAK) (« secure
    attention key ») du noyau.

%

4.6.1. sudo

    sudo(8) est un programme conçu pour permettre à un administrateur
    système de donner des privilèges d’administration limités aux
    utilisateurs et d’enregistrer dans un journal les actions de
    l’administrateur (« root ». sudo ne demande que le mot de passe
    d’un utilisateur normal. Installez le paquet sudo et activez-le
    en définissant les options dans « /etc/sudoers ». Consultez
    l’exemple de configuration dans « /usr/share/doc/sudo/examples/
    sudoers » et Section 1.1.12, « Configuration de sudo ».

    Mon utilisation de sudo sur un système avec un seul utilisateur
    (consultez Section 1.1.12, « Configuration de sudo ») est
    destinée à me protéger moi-même contre ma propre stupidité.
    Personnellement, je considère que l’utilisation de sudo est une
    meilleure alternative que l’utilisation permanente du système
    depuis le compte de l’administrateur. Par exemple, les
    modifications suivantes du propriétaire de « <un_fichier> » par
    « <mon_nom> » :

    $ sudo chown <mon_nom> <un_fichier>

    Bien sûr, si vous connaissez le mot de passe de root (comme
    beaucoup d’utilisateurs de Debian qui ont installé eux-mêmes leur
    système), n’importe quelle commande peut être lancée en tant
    qu’administrateur depuis un compte utilisateur par « su -c ».

%

4.6.2. PolicyKit

    PolicyKit est un composant du système d’exploitation permettant
    de contrôler les droits globaux sur les systèmes de type UNIX.

    Les applications graphiques les plus récentes ne sont pas conçues
    pour fonctionner comme des processus privilégiés. Elles échangent
    avec les processus privilégiés par l’intermédiaire de PolicyKit
    pour réaliser les opérations d’administration.

    PolicyKit limite de telles opérations aux comptes d’utilisateurs
    appartenant au groupe sudo sur le système Debian.

    Consultez polkit(8).

%

4.6.3. SELinux

    Security-Enhanced Linux (SELinux) est une infrastructure pour
    resserrer davantage le modèle des privilèges que le modèle de
    sécurité ordinaire des systèmes semblables à UNIX avec les règles
    de contrôle d’accès obligatoire (MAC) (« mandatory access
    control »). La puissance de l’administrateur peut être restreinte
    sous certaines conditions.

%

4.6.4. Restreindre l’accès à certains services du serveur

    Pour la sécurité du système, il est préférable de désactiver
    autant de programmes de serveurs que possible. Cela devient
    critique pour les services par l’intermédiaire du réseau. Avoir
    des services réseau inutilisés, qu’ils soient activés directement
    en tant que démon ou par l’intermédiaire du programme
    super-serveur, est considéré comme un risque de sécurité.

    De nombreux programmes, tels que sshd(8), utilisent un contrôle
    d’accès basé sur PAM. Il y a de nombreuses manières de
    restreindre l’accès à certains serveurs de services :

      * fichiers de configuration : « /etc/default/<nom_programme>
         » ;

      * service unit configuration for daemon

      * PAM (Modules d’authentification attachables) (« Pluggable
        Authentication Modules ») ;

      * « /etc/inetd.conf » pour le super-serveur ;
   
      * « /etc/hosts.deny » et « /etc/hosts.allow » pour l’enrobeur
        TCP, tcpd(8) ;

      * « /etc/rpc.conf » pour Sun RPC ;

      * « /etc/at.allow » et « /etc/at.deny » pour atd(8) ;

      * « /etc/cron.allow » et « /etc/cron.deny » pour crontab(1) ;

      * un pare-feu réseau de l’infrastructure netfilter.

    See Section 3.2.6, « System management under systemd »,
    Section 4.5.1, « Fichiers de configuration auxquels accèdent PAM
    et NSS », and Section 5.10, « Infrastructure de netfilter ».

    Astuce
   
    Les services Sun RPC doivent être actif pour NFS et les autres
    programmes basés sur RPC.

    Astuce

    Si vous avez des problèmes pour les accès à distance sur un
    système Debian récent, commentez la ligne de configuration posant
    problème, comme « ALL: PARANOID » de « /etc/hosts.deny » si elle
    existe. (Mais vous devrez faire attention au risque de sécurité
    induit par ce type d’action).

%

4.7. Sécurité de l’authentification

    Note

    Les informations données ici pourraient ne répondre que
    partiellement à vos besoins en matière de sécurité mais elles
    devraient néanmoins constituer un bon point de départ.

%

4.7.1. Mot de passe sûr avec Internet

    La couche de transport de nombreux services populaires communique
    les messages, y compris les mots de passe d’authentification, en
    texte clair. C’est une très mauvaise idée de transmettre un mot
    de passe en texte clair dans la jungle d’Internet où il peut être
    intercepté. Vous pouvez faire tourner des services sur une couche
    de transport sécurisée « Sécurité de la couche de transport
    (« Transport Layer Security ») » (TLS) ou son prédécesseur
    « Secure Sockets Layer » (SSL) pour sécuriser par chiffrement la
    communication dans son ensemble, y compris le mot de passe.

    Tableau 4.7. Liste des services et ports sûrs et non sûrs

    +---------------------------------------------------------+
    |   nom de service non sûr   |port|nom de service sûr|port|
    |----------------------------+----+------------------+----|
    |www (http)                  |80  |https             |443 |
    |----------------------------+----+------------------+----|
    |smtp (courrier électronique)|25  |ssmtp (smtps)     |465 |
    |----------------------------+----+------------------+----|
    |données ftp                 |20  |données ftps      |989 |
    |----------------------------+----+------------------+----|
    |ftp                         |21  |ftps              |990 |
    |----------------------------+----+------------------+----|
    |telnet                      |23  |telnets           |992 |
    |----------------------------+----+------------------+----|
    |imap2                       |143 |imaps             |993 |
    |----------------------------+----+------------------+----|
    |pop3                        |110 |pop3s             |995 |
    |----------------------------+----+------------------+----|
    |ldap                        |389 |ldaps             |636 |
    +---------------------------------------------------------+


    Le chiffrement coûte du temps processeur. Comme solution de
    remplacement pour économiser du temps processeur, vous pouvez
    continuer à effectuer les communications en texte clair tout en
    ne sécurisant que le mot de passe avec un protocole
    d’authentification sécurisé comme « Authenticated Post Office
    Protocol » (APOP) pour POP et « Challenge-Response Authentication
    Mechanism MD5 » (CRAM-MD5) pour SMTP et IMAP. (Depuis peu, pour
    envoyer des messages de courrier électronique au travers
    d’internet à votre serveur de courrier depuis votre client de
    courrier, il est devenu habituel d’utiliser le port 587 en
    remplacement du port SMTP 25 habituel pour soumettre le courrier
    afin d’éviter le blocage du port 25 par le fournisseur d’accès au
    réseau tout en vous authentifiant avec CRAM-MD5).

%

4.7.2. Le shell sûr (Secure Shell)

    Le programme SSH, Shell sûr (« Secure Shell ») permet une
    communication chiffrée sûre entre deux machines qui ne sont pas
    « de confiance » au travers d’un réseau non sûr avec une
    authentification sûre. Il est constitué du client OpenSSH, de ssh
    (1), et du démon OpenSSH, sshd (8). SSH peut être utilisé pour
    « tunneler » de manière sécurisée un protocole de communications
    non sûr tel que POP et X au travers d’Internet à l’aide de la
    fonctionnalité de transfert de port.

    Le client essaie de s’authentifier en utilisant
    l’authentification basée sur l’hôte, une clé publique
    d’authentification, une authentification par question-réponse ou
    une authentification par mot de passe. L’utilisation d’une
    authentification par clé publique permet la connexion à distance
    sans mot de passe. Consultez Section 6.9, « Le serveur et les
    utilitaires d’accès à distance (SSH) ».

%

4.7.3. Mesures de sécurité supplémentaires pour Internet

    Même si vous tournez avec des services sécurisés comme des
    serveurs Secure Shell (SSH) et Point-to-point tunneling protocol
    (PPTP), il reste des possibilités d’effraction en utilisant
    depuis Internet une attaque de force brute pour trouver le mot de
    passe, etc. L’utilisation d’une politique de pare-feu (consultez
    Section 5.10, « Infrastructure de netfilter ») conjointement avec
    les outils sûrs qui suivent peut améliorer la sécurité :

    Tableau 4.8. Liste des outils fournissant des mesures de sécurité
    supplémentaires

    +---------------------------------------------------------------+
    |   paquet    |popcon|taille|            description            |
    |-------------+------+------+-----------------------------------|
    |knockd       |V:0,  |102   |démon de serrure électronique IP   |
    |             |I:3   |      |knockd(1) et client konck(1)       |
    |-------------+------+------+-----------------------------------|
    |             |V:112,|      |bannir les IP qui provoquent des   |
    |fail2ban     |I:123 |2092  |erreurs d’authentification         |
    |             |      |      |multiples                          |
    |-------------+------+------+-----------------------------------|
    |libpam-shield|V:0,  |115   |verrouiller les attaquants distants|
    |             |I:0   |      |cherchant à deviner le mot de passe|
    +---------------------------------------------------------------+


%

4.7.4. sécuriser le mot de passe de l’administrateur

    Afin d’éviter que des personnes accèdent à votre machine avec les
    privilèges de l’administrateur, vous devez prendre les mesures
    suivante :

      * rendre impossible l’accès physique au disque dur ;

      * verrouiller le BIOS et interdire l’amorçage depuis un support
        amovible ;

      * définir un mot de passe pour la session interactive de GRUB ;

      * verrouiller l’édition du menu de GRUB.

    Avec un accès physique au disque, réinitialiser le mot de passe
    est relativement facile en suivant les étapes suivantes :

     1. Déplacer le disque dur sur un PC dont le BIOS permet le
        démarrage depuis un CD.

     2. Démarrer le système avec un support de secours (disque
        d’amorçage de Debian, CD Knoppix, CD GRUB…)
   
     3. Monter la partition racine avec les droits en lecture et
        écriture.

     4. Éditer « /etc/passwd » de la partition racine et vider la
        seconde entrée du compte root.

    Si vous avez l’accès en édition au menu GRUB (consultez
    Section 3.1.2, « Étage 2 : le chargeur initial »), avec
    grub-rescue-pc, il est encore plus simple d’effectuer les étapes
    suivantes au moment du démarrage :

     1. Démarrer le système avec les paramètres du noyau modifiés en
        quelque chose qui ressemble à « root=/dev/hda6 rw init=/bin/
        sh ».
   
     2. Éditer « /etc/passwd » et vider la seconde entrée du compte
        root.

     3. Redémarrer le système.

    L’interpréteur de commandes de l’administrateur est maintenant
    accessible sans mot de passe.

    Note

    Une fois que quelqu’un a accès à l’interpréteur de commandes de
    l’administrateur, il peut accéder à l’ensemble du système et en
    réinitialiser tous les mots de passe. De plus, il peut
    compromettre le mot de passe de n’importe quel utilisateur en
    utilisant des outils de cassage de mots de passe par force brute
    tels que les paquets john et crack (consultez Section 9.4.11,
    « Vérification de la sécurité et de l’intégrité du système »).
    Ces mots de passes cassés peuvent permettre de compromettre
    d’autres systèmes.

    La seule solution logicielle raisonnable pour éviter tout ça est
    d’utiliser une partition racine (ou une partition « /etc »)
    chiffrée par logiciel en utilisant dm-crypt et initramfs
    (consultez Section 9.8, « Astuces de chiffrement des données »).
    Vous aurez alors toujours besoin d’un mot de passe pour vous
    connecter au système.

Chapitre 5. Configuration du réseau

    Astuce

    Pour un guide d’ordre général concernant le réseau sous GNU/
    Linux, lire le Guide de l’administrateur réseau de Linux (« Linux
    Network Administrators Guide »).

    Astuce

    Pour un guide actualisé de la gestion réseau sous Debian, lire le
    Guide de l’administrateur Debian - configurer le réseau (« Linux
    Network Administrators Guide »).

    Avertissement

    Au lieu d'utiliser le schéma de nom d'interface réseau
    traditionnel ("eth0","eth1","wlan0",...), le nouveau systemd
    utilise "des Noms d'interface réseau prévisibles (Predictable
    Network Interface Names)" semblable à "enp0s25".

    Avertissement
   
    Ce chapitre est obsolète car il est basé sur Debian 7.0 (1Wheezy)
    sortit en 2013.

    Astuce

    Bien que ce document utilise encore l’ancien ifconfig(8) avec
    IPv4 comme exemples de configuration réseau, Debian se dirige
    vers ip(8) avec IPv4 et IPv6 à partir de Wheezy. Les correctifs
    pour mettre à jour ce document sont les bienvenus.

    Astuce
   
    Sous systemd, networkd peut être utilisé pour gérer les réseaux.
    Consultez systemd-networkd(8).

%

5.1. L’infrastructure de base du réseau

    Passons en revue l’infrastructure de base du réseau sur un
    système Debian moderne.

    Tableau 5.1. Liste des outils de configuration du réseau

    +----------------------------------------------------------------------+
    |       paquets       |popcon|taille|      type       |  description   |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |outil standard  |
    |                     |      |      |                 |pour activer ou |
    |ifupdown             |V:587,|217   |config::ifupdown |désactiver le   |
    |                     |I:991 |      |                 |réseau          |
    |                     |      |      |                 |(spécifique à   |
    |                     |      |      |                 |Debian)         |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |gérer           |
    |ifplugd              |V:3,  |217   |, ,              |automatiquement |
    |                     |I:18  |      |                 |le réseau       |
    |                     |      |      |                 |filaire         |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |script de test  |
    |                     |V:0,  |      |                 |du réseau pour  |
    |ifupdown-extra       |I:1   |106   |, ,              |améliorer le    |
    |                     |      |      |                 |paquet          |
    |                     |      |      |                 |« ifupdown »    |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |définir les     |
    |ifmetric             |V:0,  |37    |, ,              |métriques de    |
    |                     |I:1   |      |                 |routage d’une   |
    |                     |      |      |                 |interface réseau|
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |script de       |
    |                     |      |      |                 |cartographie    |
    |                     |      |      |                 |réseau          |
    |                     |      |      |                 |améliorant le   |
    |guessnet             |V:0,  |422   |, ,              |paquet          |
    |                     |I:0   |      |                 |« ifupdown » par|
    |                     |      |      |                 |l’intermédiaire |
    |                     |      |      |                 |du fichier « /  |
    |                     |      |      |                 |etc/network/    |
    |                     |      |      |                 |interfaces »    |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |script de       |
    |                     |      |      |                 |cartographie    |
    |ifscheme             |V:0,  |59    |, ,              |réseau pour     |
    |                     |I:0   |      |                 |améliorer le    |
    |                     |      |      |                 |paquet          |
    |                     |      |      |                 |« ifupdown »    |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |NetworkManager  |
    |network-manager      |V:358,|14957 |config::NM       |(démon) : gère  |
    |                     |I:440 |      |                 |automatiquement |
    |                     |      |      |                 |le réseau       |
    |---------------------+------+------+-----------------+----------------|
    |                     |V:132,|      |                 |NetworkManager  |
    |network-manager-gnome|I:372 |5540  |, ,              |(frontal de     |
    |                     |      |      |                 |GNOME)          |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |gestionnaire de |
    |wicd                 |I:24  |36(*) |config::wicd     |réseau filaire  |
    |                     |      |      |                 |ou sans fil     |
    |                     |      |      |                 |(métapaquet)    |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |gestionnaire de |
    |                     |V:0,  |      |                 |réseau filaire  |
    |wicd-cli             |I:1   |60(*) |, ,              |ou sans fil     |
    |                     |      |      |                 |(client en ligne|
    |                     |      |      |                 |de commandes)   |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |gestionnaire de |
    |wicd-curses          |V:0,  |176(*)|, ,              |réseau filaire  |
    |                     |I:3   |      |                 |ou sans fil     |
    |                     |      |      |                 |(client Curses) |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |gestionnaire de |
    |wicd-daemon          |V:19, |992(*)|, ,              |réseau filaire  |
    |                     |I:26  |      |                 |ou sans fil     |
    |                     |      |      |                 |(démon)         |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |gestionnaire de |
    |wicd-gtk             |V:15, |576(*)|, ,              |réseau filaire  |
    |                     |I:25  |      |                 |ou sans fil     |
    |                     |      |      |                 |(client GTK+)   |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |outils          |
    |                     |V:300,|      |                 |d’administration|
    |iptables             |I:993 |2520  |config::Netfilter|pour le filtrage|
    |                     |      |      |                 |des paquets et  |
    |                     |      |      |                 |NAT (Netfilter) |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |iproute2, IPv6  |
    |                     |      |      |                 |et autres       |
    |iproute2             |V:672,|2867  |config::iproute2 |configurations  |
    |                     |I:926 |      |                 |avancées du     |
    |                     |      |      |                 |réseau : ip(8), |
    |                     |      |      |                 |tc(8), etc      |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |renommer une    |
    |                     |      |      |                 |interface réseau|
    |ifrename             |V:0,  |125   |, ,              |en fonction de  |
    |                     |I:3   |      |                 |divers critères |
    |                     |      |      |                 |statiques :     |
    |                     |      |      |                 |ifrename(8)     |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |afficher ou     |
    |                     |V:102,|      |                 |modifier les    |
    |ethtool              |I:261 |597   |, ,              |paramètres d’un |
    |                     |      |      |                 |périphérique    |
    |                     |      |      |                 |Ethernet        |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |tester          |
    |                     |      |      |                 |l’accessibilité |
    |                     |V:234,|      |                 |d’une machine   |
    |iputils-ping         |I:997 |113   |test::iproute2   |distante par nom|
    |                     |      |      |                 |de machine ou   |
    |                     |      |      |                 |adresse IP      |
    |                     |      |      |                 |(iproute2)      |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |tester          |
    |                     |      |      |                 |l’accessibilité |
    |iputils-arping       |V:8,  |55    |, ,              |réseau d’une    |
    |                     |I:127 |      |                 |machine distante|
    |                     |      |      |                 |spécifiée par   |
    |                     |      |      |                 |une adresse ARP |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |tracer le chemin|
    |iputils-tracepath    |V:4,  |72    |, ,              |du réseau vers  |
    |                     |I:60  |      |                 |une machine     |
    |                     |      |      |                 |distante        |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |boîte à outils  |
    |                     |      |      |                 |réseau NET-3    |
    |                     |V:234,|      |                 |(net-tools,     |
    |net-tools            |I:634 |991   |config::net-tools|configuration   |
    |                     |      |      |                 |réseau IPv4) :  |
    |                     |      |      |                 |ifconfig(8),    |
    |                     |      |      |                 |etc.            |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |tester          |
    |                     |      |      |                 |l’accessibilité |
    |                     |      |      |                 |réseau d’une    |
    |inetutils-ping       |V:0,  |359   |test::net-tools  |machine distante|
    |                     |I:1   |      |                 |par nom de      |
    |                     |      |      |                 |machine ou      |
    |                     |      |      |                 |adresse IP      |
    |                     |      |      |                 |(ancien, GNU)   |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |tester          |
    |                     |      |      |                 |l’accessibilité |
    |                     |V:2,  |      |                 |réseau d’une    |
    |arping               |I:29  |77    |, ,              |machine distante|
    |                     |      |      |                 |spécifiée par   |
    |                     |      |      |                 |une adresse ARP |
    |                     |      |      |                 |(ancien)        |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |tracer le chemin|
    |                     |V:63, |      |                 |réseau vers une |
    |traceroute           |I:936 |159   |, ,              |machine distante|
    |                     |      |      |                 |(ancien,        |
    |                     |      |      |                 |console)        |
    |---------------------+------+------+-----------------+----------------|
    |isc-dhcp-client      |V:231,|686   |config::low-level|client DHCP     |
    |                     |I:979 |      |                 |                |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |client prenant  |
    |wpasupplicant        |V:332,|3436  |, ,              |en charge WPA et|
    |                     |I:507 |      |                 |WPA2 (IEEE      |
    |                     |      |      |                 |802.11i)        |
    |---------------------+------+------+-----------------+----------------|
    |                     |V:0,  |      |                 |client graphique|
    |wpagui               |I:2   |781   |, ,              |(Qt) pour       |
    |                     |      |      |                 |wpa_supplicant  |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |outils pour     |
    |                     |      |      |                 |manipuler les   |
    |wireless-tools       |V:188,|297   |, ,              |« Extensions    |
    |                     |I:254 |      |                 |Linux sans fil »|
    |                     |      |      |                 |(Linux Wireless |
    |                     |      |      |                 |Extensions)     |
    |---------------------+------+------+-----------------+----------------|
    |ppp                  |V:206,|1054  |, ,              |connexion PPP/  |
    |                     |I:474 |      |                 |PPPoE avec chat |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |assistant de    |
    |pppoeconf            |V:0,  |192   |config::helper   |configuration   |
    |                     |I:8   |      |                 |d’une connexion |
    |                     |      |      |                 |PPPoE           |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |assistant de    |
    |                     |V:1,  |      |                 |configuration   |
    |pppconfig            |I:2   |801   |, ,              |pour une        |
    |                     |      |      |                 |connexion PPP   |
    |                     |      |      |                 |avec chat       |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |assistant de    |
    |                     |      |      |                 |configuration   |
    |wvdial               |V:0,  |249   |, ,              |pour une        |
    |                     |I:5   |      |                 |connexion PPP   |
    |                     |      |      |                 |avec wvdial et  |
    |                     |      |      |                 |ppp             |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |tracer le chemin|
    |mtr-tiny             |V:6,  |161   |test::low-level  |réseau vers une |
    |                     |I:54  |      |                 |machine distante|
    |                     |      |      |                 |(curses)        |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |tracer le chemin|
    |mtr                  |V:4,  |214   |, ,              |réseau vers une |
    |                     |I:43  |      |                 |machine distante|
    |                     |      |      |                 |(curses et GTK+)|
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |outils pour des |
    |                     |      |      |                 |opérations      |
    |gnome-nettool        |V:2,  |2105  |, ,              |d’informations  |
    |                     |I:45  |      |                 |habituelles sur |
    |                     |      |      |                 |le réseau       |
    |                     |      |      |                 |(GNOME)         |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |cartographie    |
    |                     |V:31, |      |                 |réseau /        |
    |nmap                 |I:253 |4452  |, ,              |balayage de     |
    |                     |      |      |                 |ports (Nmap,    |
    |                     |      |      |                 |console)        |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |cartographie    |
    |zenmap               |V:2,  |2939  |, ,              |réseau /        |
    |                     |I:9   |      |                 |balayage de     |
    |                     |      |      |                 |ports (GTK+)    |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |analyseur de    |
    |tcpdump              |V:19, |1329  |, ,              |trafic réseau   |
    |                     |I:204 |      |                 |(Tcpdump,       |
    |                     |      |      |                 |console)        |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |analyseur de    |
    |wireshark            |I:55  |64    |, ,              |trafic réseau   |
    |                     |      |      |                 |(Wireshark,     |
    |                     |      |      |                 |GTK+)           |
    |---------------------+------+------+-----------------+----------------|
    |                     |V:3,  |      |                 |analyseur de    |
    |tshark               |I:34  |407   |, ,              |trafic réseau   |
    |                     |      |      |                 |(console)       |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |produit un      |
    |                     |      |      |                 |résumé des      |
    |tcptrace             |V:0,  |401   |, ,              |connexions à    |
    |                     |I:3   |      |                 |partir d’une    |
    |                     |      |      |                 |sortie de       |
    |                     |      |      |                 |tcpdump         |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |système souple  |
    |                     |V:0,  |      |                 |de détection    |
    |snort                |I:1   |2206  |, ,              |d’intrusion par |
    |                     |      |      |                 |le réseau       |
    |                     |      |      |                 |(Snort)         |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |afficher        |
    |ntopng               |V:1,  |969   |, ,              |l’utilisation du|
    |                     |I:2   |      |                 |réseau dans le  |
    |                     |      |      |                 |navigateur web  |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |clients réseau  |
    |                     |V:64, |      |                 |fournis par     |
    |dnsutils             |I:517 |256   |, ,              |BIND : nslookup |
    |                     |      |      |                 |(8), nsupdate(8)|
    |                     |      |      |                 |, dig(8)        |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |vérifier les    |
    |                     |      |      |                 |zones           |
    |dlint                |V:0,  |53    |, ,              |d’information   |
    |                     |I:7   |      |                 |DNS en utilisant|
    |                     |      |      |                 |des requêtes du |
    |                     |      |      |                 |serveur de noms |
    |---------------------+------+------+-----------------+----------------|
    |                     |      |      |                 |tracer une      |
    |                     |V:0,  |      |                 |chaîne de       |
    |dnstracer            |I:2   |61    |, ,              |serveurs DNS    |
    |                     |      |      |                 |jusqu’à la      |
    |                     |      |      |                 |source          |
    +----------------------------------------------------------------------+


%

5.1.1. Résolution du nom d’hôte

    La résolution du nom d’hôte est actuellement prise en charge
    aussi par le mécanisme NSS (Name Service Switch). Le flux de
    cette résolution est le suivant :

     1. Le fichier « /etc/nsswitch.conf » avec une entrée comme
        « hosts: files dns » donne l’ordre de la résolution du nom
        d’hôte (cela remplace l’ancienne fonctionnalité de l’entrée
        « order » dans « /etc/host.conf »).

     2. La méthode files est d’abord appelée. Si le nom d’hôte est
        trouvé dans le fichier « /etc/hosts », elle retourne toutes
        les adresses valables qui y correspondent et quitte. (Le
        fichier « /etc/host.conf » contient « multi on »).

     3. La méthode dns est appelée. Si le nom d’hôte est trouvé par
        une requête au Système de noms de domaine Internet (DNS)
        (« Internet Domain Name System ») identifié par le fichier « 
        /etc/resolv.conf », elle retourne toutes les adresses
        valables correspondantes et quitte.

    Par exemple, « /etc/hosts » ressemble à ce qui suit :

    127.0.0.1 localhost
    127.0.1.1 <nom_hote>

    # Les lignes suivantes servent pour les machines pouvant utiliser IPv6
    ::1     ip6-localhost ip6-loopback
    fe00::0 ip6-localnet
    ff00::0 ip6-mcastprefix
    ff02::1 ip6-allnodes
    ff02::2 ip6-allrouters
    ff02::3 ip6-allhosts

    Chaque ligne commence par une adresse IP et est suivie du nom
    d’hôte associé.

    L’adresse IP 127.0.1.1 en deuxième ligne de cet exemple pourrait
    ne pas être présente sur d’autres systèmes de type UNIX.
    L’installateur Debian ajoute cette entrée pour les systèmes sans
    adresse IP permanente en tant que contournement pour certains
    programmes (par exemple GNOME) comme expliqué dans le bogue
    nº 719621.

    Le <nom_hote> correspond au nom d’hôte défini dans « /etc/
    hostname ».

    Pour un système avec une adresse IP permanente, cette adresse IP
    devrait être utilisée à la place de 127.0.1.1.

    Pour un système avec une adresse IP permanente et un nom de
    domaine complètement qualifié (FQDN) fourni par le système de
    noms de domaine (DNS), les <nom_hote> et <nom_domaine> canoniques
    devraient être utilisés ici, plutôt que le simple <nom_hote>.

    « /etc/resolv.conf » est un fichier statique si le paquet
    resolvconf n’est pas installé. S’il est installé, c’est un lien
    symbolique. Dans tous les cas, il contient des informations qui
    initialisent les routines du résolveur. Si le DNS est trouvé à
    l’IP=« 192.168.11.1 », il contient ce qui suit :

    nameserver 192.168.11.1

    Le paquet resolvconf fait de ce « /etc/resolv.conf » un lien
    symbolique et gère son contenu automatiquement par le script
    hook.

    Pour une station de travail « compatible PC » sur un réseau local
    ad hoc typique, le nom d’hôte peut être résolu à l’aide du
    Multicast DNS (mDNS, Zeroconf) en plus des méthodes
    traditionnelles par fichiers et dns.

      * Sur les systèmes Debian, Avahi fournit un cadre pour le
        « Multicast DNS Service Discovery ».

      * Il est l’équivalent de Apple Bonjour/Apple Rendezvous.

      * Le greffon de la bibliothèque libnss-mdns fournit une
        résolution de nom d’hôte à l’aide de mDNS pour la fonction
        « GNU Name Service Switch (NSS) » de « GNU C Library (glibc)
         ».

      * Le fichier « /etc/nsswitch.conf  devrait contenir une section
        telle que « hosts: files mdns4_minimal [NOTFOUND=return] dns
        mdns4 ».

      * La résolution est appliquée aux noms d’hôtes se terminant
        avec le pseudo-top-level domain (TLD) « .local ».

      * L’adresse IPV4 de lien-local multicast mDNS « 224.0.0.251 »
        ou son équivalente pour l’IPV6 « FF02::FB  est utilisée pour
        faire une requête DNS sur les noms se terminant en
        « .local ».

    La résolution du nom de machine par le protocole obsolète NETBios
    over TCP/IP utilisé par les systèmes Windows plus anciens peut
    être fournie en installant le paquet winbind. Le fichier « /etc/
    nsswitch.conf » devra avoir une entrée semblable à « hosts: files
    mdns4_minimal [NOTFOUND=return] dns mdns4 wins » afin d’activer
    cette fonctionnalité (les systèmes Windows récents utilisent
    normalement la méthode dns pour la résolution de nom d’hôte).

    Note

    L'expansion de nom de domaine de premier niveau générique
    « generic Top-Level Domains (gTLD) » dans le système de noms de
    domaine est en cours de réalisation. Soyez attentifs aux conflits
    de noms lors du choix d'un nom de domaine utilisé uniquement au
    sein d'un réseau local « LAN ».

%

5.1.2. Nom de l’interface réseau

    Le nom de l’interface réseau, par exemple eth0, est assigné dans
    le noyau Linux à chaque matériel par le mécanisme udev de
    configuration de l’espace utilisateur (consultez Section 3.3,
    « Le système udev »), lorsqu’il est trouvé. On appelle
    l’interface réseau interface physique (« physical interface »)
    dans ifup(8) et interfaces(5).

    De manière à ce que les interfaces réseau aient un nom homogène
    lors des redémarrages en utilisant l’adresse MAC, etc., il existe
    un fichier de règles « /etc/udev/rules.d/
    70-persistent-net.rules ». Ce fichier est créé automatiquement
    par le programme « /lib/udev/write_net_rules », probablement
    lancé par le fichier de règles
    « persistent-net-generator.rules ». Vous pouvez le modifier pour
    changer la règle de nommage.

    Attention

    En éditant le fichier de règles « /etc/udev/rules.d/
    70-persistent-net.rules », vous devrez conserver chaque règle sur
    une seule ligne et l’adresse MAC en minuscule. Par exemple, si
    vous trouvez « FireWire device » et « PCI device » dans ce
    fichier, vous voudrez probablement nommer eth0 le « PCI device »
    et le configurer comme interface réseau primaire.

%

5.1.3. Plage d’adresses réseau du réseau local (« LAN »)

    Un rappel des plages d’adresses IPv4 32 bits de chacune des
    classes réservées à l’utilisation sur un réseau local (LAN) par
    la rfc1918. Ces adresses garantissent qu’aucun conflit ne sera
    créé avec aucune des adresses présentes sur Internet proprement
    dit.

    Tableau 5.2. Liste des plages d’adresses de réseau

    +----------------------------------------------------------------+
    |Classe|  adresses de  |  masque de  |  masque de  |  nombre de  |
    |      |    réseau     |   réseau    |réseau /bits |sous-réseaux |
    |------+---------------+-------------+-------------+-------------|
    |A     |10.x.x.x       |255.0.0.0    |/8           |1            |
    |------+---------------+-------------+-------------+-------------|
    |B     |172.16.x.x —   |255.255.0.0  |/16          |16           |
    |      |172.31.x.x     |             |             |             |
    |------+---------------+-------------+-------------+-------------|
    |C     |192.168.0.x —  |255.255.255.0|/24          |256          |
    |      |192.168.255.x  |             |             |             |
    +----------------------------------------------------------------+


    Note

    Si une de ces adresses est assignée à une machine, cette machine
    ne doit alors pas accéder directement à Internet mais passer par
    une passerelle qui agit en tant que serveur mandataire
    (« proxy ») pour les services individuels ou sinon effectuer une
    traduction d’adresse réseau (NAT) (« Network Address
    Translation ». Un routeur à large bande effectue en général la
    NAT pour l’environnement du LAN de l’utilisateur grand public.

%

5.1.4. La gestion du périphérique réseau

    La plupart des périphériques matériels sont pris en charge par le
    système Debian, il y a quelques périphériques de réseau qui
    exigent, pour les gérer, des microprogrammes non libres d’après
    les principes du logiciel libre selon Debian. Veuillez consulter
    Section 9.9.6, « Pilotes de matériel et microprogramme ».

%

5.2. Configuration moderne de réseau pour ordinateur de bureau

    Network interfaces are typically initialized in
    "networking.service" for the lo interface and
    "NetworkManager.service" for other interfaces on modern Debian
    desktop system under systemd.

    À partir de la version squeeze, les systèmes Debian peuvent gérer
    la connexion au réseau à l’aide de démons tels que NetworkManager
    (NM) (paquet network-manager et les paquets associés) ou Wicd
    (paquet wicd et les paquets associés).

      * Ils sont fournis avec leur propre interface utilisateur
        graphique (GUI) et en ligne de commandes.

      * Ils ont leur propre démon en tant que sytème dorsal.

      * Ils permettent une connexion facile de votre système à
        Internet.

      * Ils permettent une gestion facile de la configuration du
        réseau filaire ou sans fil.

      * Ils nous permettent de configurer le réseau indépendamment de
        l’ancien paquet « ifupdown »

    Note

    Ne pas utiliser ces outils de configuration automatique du réseau
    sur un serveur. Ils ont été prévus principalement pour les
    utilisateurs de système de bureau tournant sur des ordinateurs
    portables.

    Ces outils modernes de configuration du réseau doivent être
    configurés correctement afin d’éviter des conflits avec l’ancien
    paquet ifupdown et son fichier de configuration « /etc/network/
    interfaces ».

    Note

    Certaines fonctionnalités de ces outils de configuration
    automatique du réseau peuvent souffrir de régressions. Ils ne
    sont pas aussi robustes que l’ancien paquet ifupdown. Consultez
    le BTS de network-manager et le BTS de wicd pour en savoir plus
    sur les problèmes et les limitations actuelles.

%

5.2.1. Outils graphiques de configuration du réseau

    Les documentations officielles de NM et Wicd sous Debian sont
    fournies respectivement par « /usr/share/doc/network-manager/
    README.Debian » et « /usr/share/doc/wicd/README.Debian ».

    Essentiellement, la configuration réseau pour un ordinateur de
    bureau est faite de la manière suivante :

     1. Rendez l’utilisateur du bureau, par exemple toto, membre du
        groupe « netdev » à l’aide de la commande suivante (vous
        pouvez aussi le faire automatiquement à l’aide de D-bus sous
        les environnements de bureau modernes comme GNOME et KDE) :

        $ sudo adduser toto netdev

     2. Gardez la configuration de « /etc/network/interfaces » aussi
        simple que possible comme ce qui suit :
   
        auto lo
        iface lo inet loopback

     3. Redémarrez NM ou Wicd de la manière suivante :

        $ sudo /etc/init.d/network-manager restart

        $ sudo /etc/init.d/wicd restart

     4. Configurez votre réseau à l’aide d’une interface graphique.

    Note

    Afin d’éviter les conflits avec ifupdown, seules les interfaces
    qui ne sont pas listées dans « /etc/network/interfaces » sont
    gérées par NM ou Wicd.

    Astuce

    Si vous désirez étendre les possibilités de configuration de NM,
    veuillez récupérer les modules d’extension appropriés et les
    paquets supplémentaires tels que network-manager-openconnect,
    network-manager-openvpn-gnome, network-manager-pptp-gnome,
    mobile-broadband-provider-info, gnome-bluetooth, etc. Il en va de
    même pour ceux de Wicd.

    Attention

    Ces outils de configuration automatique peuvent ne pas être
    compatibles avec des configurations ésotériques de l’ancien
    ifupdown dans « /etc/network/interfaces » telles que celles se
    trouvant en Section 5.6, « Configuration de base du réseau avec
    ifupdown (ancienne) » et Section 5.7, « Configuration réseau
    avancée avec ifupdown (ancienne) ». Consultez le BTS de
    network-manager et le BTS de wicd pour les problèmes et les
    limitations actuels.

%

5.3. The modern network configuration without GUI

    Sous systemd, le réseau peut aussi être configuré dans /etc/
    systemd/network/. Voir : systemd-resolved(8), resolved.conf(5),
    et systemd-networkd(8).

    This allows the modern network configuration without GUI.

    A DHCP client configuration can be set up by creating "/etc/
    systemd/network/dhcp.network". E.g.:

    [Match]
    Name=en*
   
    [Network]
    DHCP=yes

    A static network configuration can be set up by creating "/etc/
    systemd/network/static.network". E.g.:

    [Match]
    Name=en*
   
    [Network]
    Address=192.168.0.15/24
    Gateway=192.168.0.1

%

5.4. Ancienne méthode de configuration et de connexion réseau

    Lorsque la méthode décrite dans Section 5.2, « Configuration
    moderne de réseau pour ordinateur de bureau » ne suffit pas à vos
    besoins, vous pouvez utiliser les anciennes connexion au réseau
    et méthode de configuration qui combinent de nombreux outils
    simples.

    L’ancienne connexion au réseau est spécifique pour chacune des
    méthodes (consultez Section 5.5, « Méthode de connexion réseau
    (ancienne) »).

    Il existe deux types de programmes de bas niveau pour la
    configuration du réseau sous un système Linux (consultez
    Section 5.8.1, « Commandes Iproute2 »).

      * Les programmes net-tools anciens (ifconfig(8), …) proviennent
        du système de réseau NET-3 de Linux. La plupart d’entre-eux
        sont aujourd’hui obsolètes.
   
      * Les nouveaux programmes Linux iproute2 (ip(8), …)
        représentent le système actuel de gestion de réseau sous
        Linux.

    Bien que ces programmes de bas niveau soient puissants, ils sont
    lourds à utiliser. Des systèmes de haut niveau de configuration
    du système ont donc été créés.

    Le paquet ifupdown est le standard de fait pour un tel système de
    configuration de haut niveau du réseau sur Debian. Il vous permet
    d’activer un réseau en utilisant simplement, par exemple, « ifup
    eth0 ». Son fichier de configuration est le fichier /etc/network/
    interfaces » et son contenu typique est le suivant :

    auto lo
    iface lo inet loopback
   
    auto eth0
    iface eth0 inet dhcp

    Le paquet resolvconf a été créé pour complément au système
    ifupdown afin de prendre en charge une reconfiguration en douceur
    de la résolution d’adresse du réseau en automatisant la
    réécriture du fichier de configuration de la résolution « /etc/
    resolv.conf ». Maintenant, la plupart des paquets de Debian
    servant à la configuration du réseau sont modifiés pour utiliser
    le paquet resolvconf (consultez « /usr/share/doc/resolvconf/
    README.Debian »).

    Des scripts d’aide pour le paquet ifupdown comme ifplugd,
    guessnet, ifscheme, etc. ont été créés pour automatiser la
    configuration de l’environnement réseau comme dans le cas d’un PC
    mobile sur un réseau local câblé. Ils sont relativement
    difficiles à utiliser mais fonctionnent bien en conjonction avec
    un système ifupdown existant.

    Cela est expliqué en détail et avec des exemples (consultez
    Section 5.6, « Configuration de base du réseau avec ifupdown
    (ancienne) » et Section 5.7, « Configuration réseau avancée avec
    ifupdown (ancienne) »).

%

5.5. Méthode de connexion réseau (ancienne)

    Attention

    La méthode de test de connexion décrite dans cette section est
    destinée à des fins de test. Elle n’est pas destinée à être
    directement utilisée pour la connexion réseau de tous les jours.
    Vous êtes invité à utiliser à la place NM, Wicd ou le paquet
    ifupdown (consultez Section 5.2, « Configuration moderne de
    réseau pour ordinateur de bureau » et Section 5.6,
    « Configuration de base du réseau avec ifupdown (ancienne) »).

    La connexion typique au réseau et le chemin de connexion pour un
    PC peuvent être résumés comme suit :

    Tableau 5.3. Liste des méthodes de connexions réseau et des
    chemins de connexion

    +--------------------------------------------------------------+
    |    PC     |méthode de |         chemin de connexion          |
    |           | connexion |                                      |
    |-----------+-----------+--------------------------------------|
    |Port série |PPP        |⇔ modem ⇔ POTS ⇔ point d’accès réseau |
    |(ppp0)     |           |commuté ⇔ FAI                         |
    |-----------+-----------+--------------------------------------|
    |Port       |PPPoE/DHCP/|⇔ BB-modem ⇔ BB service ⇔ BB access   |
    |Ethernet   |Statique   |point ⇔ FAI                           |
    |(eth0)     |           |                                      |
    |-----------+-----------+--------------------------------------|
    |Port       |DHCP/      |⇔ LAN ⇔ routeur BB avec traduction    |
    |Ethernet   |Statique   |d’adresse (NAT) (⇔ modem BB …)        |
    |(eth0)     |           |                                      |
    +--------------------------------------------------------------+


    Voici un résumé des scripts de configuration de chaque méthode de
    connexion :

    Tableau 5.4. Liste des configurations de connexions réseau

    +---------------------------------------------------------------+
    | méthode de  |       configuration       |paquets(s) de support|
    |  connexion  |                           |                     |
    |-------------+---------------------------+---------------------|
    |PPP          |pppconfig pour créer un    |pppconfig, ppp       |
    |             |chat déterministe          |                     |
    |-------------+---------------------------+---------------------|
    |PPP          |wvdialconf pour créer un   |ppp, wvdial          |
    |(alternative)|chat heuristique           |                     |
    |-------------+---------------------------+---------------------|
    |PPPoE        |pppoeconf pour créer un    |pppoeconf, ppp       |
    |             |chat déterministe          |                     |
    |-------------+---------------------------+---------------------|
    |DHCP         |décrit dans « /etc/dhcp/   |isc-dhcp-client      |
    |             |dhclient.conf »            |                     |
    |-------------+---------------------------+---------------------|
    |IP statique  |décrit dans « /etc/network/|iproute ou net-tools |
    |(IPv4)       |interfaces »               |(obsolète)           |
    |-------------+---------------------------+---------------------|
    |IP statique  |décrit dans « /etc/network/|iproute              |
    |(IPv6)       |interfaces »               |                     |
    +---------------------------------------------------------------+


    Les acronymes de connexion au réseau ont la signification
    suivante :

    Tableau 5.5. Liste des acronymes de connexion au réseau

    +---------------------------------------------------------------+
    | acronyme |                   signification                    |
    |----------+----------------------------------------------------|
    |POTS      |service téléphonique analogique classique (« plain  |
    |          |old telephone service »)                            |
    |----------+----------------------------------------------------|
    |BB        |large bande                                         |
    |----------+----------------------------------------------------|
    |BB-service|par exemple, l’ADSL, la télévision par câble ou les |
    |          |services sur fibre optique (FTTP)                   |
    |----------+----------------------------------------------------|
    |BB-modem  |par exemple, le modem ADSL, le modem sur réseau     |
    |          |câblé ou le terminal de réseau optique (ONT)        |
    |----------+----------------------------------------------------|
    |LAN       |réseau local (« local area network »)               |
    |----------+----------------------------------------------------|
    |WAN       |réseau étendu                                       |
    |----------+----------------------------------------------------|
    |DHCP      |protocole de configuration dynamique des machines   |
    |          |(« dynamic host configuration protocol »)           |
    |----------+----------------------------------------------------|
    |PPP       |protocole point à point (« point to point           |
    |          |protocol »)                                         |
    |----------+----------------------------------------------------|
    |PPPoE     |protocole point à point avec encapsulation Ethernet |
    |----------+----------------------------------------------------|
    |FAI       |fournisseur d’accès à Internet                      |
    |(« ISP ») |                                                    |
    +---------------------------------------------------------------+


    Note

    Les services de connexion au réseau étendu (WAN) par
    l’intermédiaire du câble du réseau de télévision sont en général
    servis par DHCP ou PPPoE. Ceux qui sont connectés en ADSL et FTTP
    sont en général servis par PPPoE. Vous devrez consulter votre FAI
    afin de connaître les exigences exactes de configuration de la
    connexion WAN.

    Note

    Lorsqu’un routeur large bande (« BB-router ») est utilisé pour
    créer un environnement de réseau local domestique, les PC sur le
    réseau local sont connectés au réseau étendu (WAN) par
    l’intermédiaire du routeur large bande par traduction d’adresse
    réseau (NAT). Dans ce cas, les interfaces réseau des PC sur le
    réseau local sont servies avec des adresses IP statiques ou par
    DHCP depuis le routeur large bande. Le routeur large bande, pour
    se connecter au réseau étendu, doit être configuré en suivant les
    instructions de votre FAI.

%

5.5.1. La connexion DHCP avec Ethernet

    Le réseau moderne domestique ou pour une petite entreprise
    typique (réseau local, LAN) est connecté au réseau étendu
    (« WAN ») (Internet) en utilisant un routeur à large bande grand
    public. Le réseau local derrière ce routeur est habituellement
    configuré par un serveur de protocole de configuration dynamique
    de l’hôte (DHCP) (« dynamic host configuration protocol »)
    tournant sur le routeur.

    Installez simplement le paquet isc-dhcp-client pour Ethernet
    desservi par le protocole de configuration dynamique de l’hôte
    (DHCP).

    Consultez dhclient.conf(5).

%

5.5.2. Connexion Ethernet avec une adresse IP statique

    Il n’y a pas d’action spécifique nécessaire pour la configuration
    Ethernet avec une adresse IP statique.

%

5.5.3. La connexion PPP avec pppconfig

    Le script de configuration pppconfig configure la connexion PPP
    de manière interactive en sélectionnant simplement les éléments
    suivants :

      * numéro de téléphone ;

      * identifiant chez le fournisseur d’accès (FAI) ;

      * mot de passe chez le FAI ;
   
      * vitesse du port ;

      * port de communication avec le modem ;

      * méthode d’authentification.

    Tableau 5.6. Liste des fichiers de configuration pour la
    connexion PPP avec pppconfig

    +---------------------------------------------------------------+
    |    fichier     |                   fonction                   |
    |----------------+----------------------------------------------|
    |/etc/ppp/peers/ |fichier de configuration spécifique à         |
    |<nom_fai>       |<nom_fai> créé par pppconfig pour pppd        |
    |----------------+----------------------------------------------|
    |/etc/chatscripts|fichier de configuration spécifique à         |
    |/<nom_fai>      |<nom_fai> créé par pppconfig pour chat        |
    |----------------+----------------------------------------------|
    |/etc/ppp/options|paramètres généraux d’exécution de pppd       |
    |----------------+----------------------------------------------|
    |/etc/ppp/       |données d’authentification pour PAP (risque de|
    |pap-secret      |sécurité)                                     |
    |----------------+----------------------------------------------|
    |/etc/ppp/       |données d’authentification pour CHAP (plus    |
    |chap-secret     |sécurisé)                                     |
    +---------------------------------------------------------------+


    Attention
   
    La valeur « <nom_fai> » du champ « provider » est supposée si les
    commandes pon et poff sont appelées sans paramètre.

    Vous pouvez tester la configuration de la manière suivante, en
    utilisant des outils de configuration de réseau de bas niveau :

    $ sudo pon <nom_fai>
    ...
    $ sudo poff <nom_fai>

    Consultez « /usr/share/doc/ppp/README.Debian.gz ».

%

5.5.4. Autre connexion PPP avec wvdialconf

    Une approche différente de l’utilisation de pppd(8) est de le
    lancer depuis wvdial(1) qui est fourni par le paquet wvdial.
    Plutôt que pppd faisant tourner chat (8) pour numéroter et
    négocier la connexion, wvdial effectue la numérotation et la
    négociation initiale puis démarre pppd pour effectuer le reste.

    Le script de configuration wvdialconf configure la connexion PPP
    de manière interactive en sélectionnant simplement ce qui suit :

      * numéro de téléphone ;

      * identifiant chez le fournisseur d’accès (FAI) ;

      * mot de passe chez le FAI ;

    wvdial réussit à réaliser la connexion dans la plupart des cas et
    conserve automatiquement la liste des données d’authentification.

    Tableau 5.7. Liste des fichiers de configuration pour une
    connexion PPP avec wvdialconf

    +---------------------------------------------------------------+
    |   fichier    |                    fonction                    |
    |--------------+------------------------------------------------|
    |/etc/ppp/peers|fichier de configuration spécifique à wvdialcréé|
    |/wvdial       |par wvdialconf pour pppd                        |
    |--------------+------------------------------------------------|
    |/etc/         |fichier de configuration créé par wvdialconf    |
    |wvdial.conf   |                                                |
    |--------------+------------------------------------------------|
    |/etc/ppp/     |paramètres généraux d’exécution de pppd         |
    |options       |                                                |
    |--------------+------------------------------------------------|
    |/etc/ppp/     |données d’authentification pour PAP (risque de  |
    |pap-secret    |sécurité)                                       |
    |--------------+------------------------------------------------|
    |/etc/ppp/     |données d’authentification pour CHAP (plus      |
    |chap-secret   |sécurisé)                                       |
    +---------------------------------------------------------------+


    Vous pouvez tester la configuration de la manière suivante, en
    utilisant des outils de configuration de réseau de bas niveau :

    $ sudo wvdial
    ...
    $ sudo killall wvdial

    Consultez wvdial(1) et wvdial.conf(5).

%

5.5.5. La connexion PPPoE avec pppoeconf

    Lorsque votre FAI vous propose une connexion avec PPPoE et que
    vous décidez de connecter directement votre PC au WAN, le réseau
    de votre PC doit être configuré avec PPPoE. PPPoE signifie « PPP
    over Ethernet » (PPP encapsulé par Ethernet). Le script de
    configuration pppoeconf configure la connexion PPPoE de manière
    interactive.

    Les fichiers de configuration sont les suivants :

    Tableau 5.8. Liste des fichiers de configuration pour une
    connexion PPPoE avec pppoeconf

    +---------------------------------------------------------------+
    |       fichier        |                fonction                |
    |----------------------+----------------------------------------|
    |/etc/ppp/peers/       |fichier de configuration spécifique à   |
    |fournisseur-accès-adsl|pppoe créé par pppoeconf pour pppd      |
    |----------------------+----------------------------------------|
    |/etc/ppp/options      |paramètres généraux d’exécution de pppd |
    |----------------------+----------------------------------------|
    |/etc/ppp/pap-secret   |données d’authentification pour PAP     |
    |                      |(risque de sécurité)                    |
    |----------------------+----------------------------------------|
    |/etc/ppp/chap-secret  |données d’authentification pour CHAP    |
    |                      |(plus sécurisé)                         |
    +---------------------------------------------------------------+


    Vous pouvez tester la configuration de la manière suivante, en
    utilisant des outils de configuration de réseau de bas niveau :

    $ sudo /sbin/ifconfig eth0 up
    $ sudo pon fournisseur-accès-adsl
    ...
    $ sudo poff fournisseur-accès-adsl
    $ sudo /sbin/ifconfig eth0 down

    Consultez « /usr/share/doc/pppoeconf/README.Debian ».

%

5.6. Configuration de base du réseau avec ifupdown (ancienne)

    La configuration traditionnelle du réseau TCP/IP sur un système
    Debian utilise le paquet ifupdown comme outil de haut niveau. Il
    y a deux cas typiques :

      * Pour les systèmes utilisant une adresse IP dynamique tels que
        les PC portables, vous devrez configurer le réseau TCP/IP 
        avec le paquet resolvconf et ce qui vous permettra changer
        facilement la configuration de votre réseau (consultez
        Section 5.6.4, « Interfaces réseau gérées par DHCP »).
   
      * Pour les systèmes ayant une adresse IP statique tels que les
        serveurs, vous devrez configurer le réseau TCP/IP sans le
        paquet resolvconf et garder un système simple (see
        Section 5.6.5, « Interface réseau avec une adresse IP fixe »
        ).

    Ces méthodes traditionnelles de configuration sont assez utiles
    si vous désirez définir une configuration avancée ; plus de
    détails dans ce qui suit :

    Le paquet ifupdown fournit l’ossature standardisée pour la
    configuration du réseau de haut niveau sur un système Debian.
    Dans cette section, nous apprenons les bases de la configuration
    du réseau avec ifupdown avec une introduction simplifiée et de
    nombreux exemples typiques.

%

5.6.1. La syntaxe de commande simplifiée

    Le paquet ifupdown contient 2 commandes : ifup(8) et ifdown(8).
    Elles offrent une configuration de réseau de haut niveau à l’aide
    du fichier de configuration « /etc/network/interfaces ».

    Tableau 5.9. Liste des commandes de base de configuration du
    réseau avec ifupdown

    +---------------------------------------------------------------+
    |commande|                        action                        |
    |--------+------------------------------------------------------|
    |ifup    |activer l’interface réseau eth0 avec la configuration |
    |eth0    |eth0 si l’entrée « iface eth0 » existe                |
    |--------+------------------------------------------------------|
    |ifdown  |désactiver l’interface réseau eth0 avec la            |
    |eth0    |configurationeth0 si l’entrée « iface eth0 »          |
    +---------------------------------------------------------------+


    Avertissement

    Ne pas utiliser les outils de configuration de bas niveau tels
    que ifconfig(8) ni les commandes ip(8) pour configurer une
    interface se trouvant dans l’état actif (« up »).

    Note
   
    Il n’y a pas de commande ifupdown.

%

5.6.2. Syntaxe de base de « /etc/network/interfaces »

    La syntaxe clé de « /etc/network/interfaces » telle qu’expliquée
    dans interfaces(5) peut être résumée comme suit :

    Tableau 5.10. Liste des entrées de « /etc/network/interfaces »

    +---------------------------------------------------------------+
    |          entrée           |           signification           |
    |---------------------------+-----------------------------------|
    |                           |démarrer l’interface               |
    |« auto <nom_interface> »   |<nom_interface> lors du démarrage  |
    |                           |du système                         |
    |---------------------------+-----------------------------------|
    |« allow-auto               |, ,                                |
    |<nom_interface> »          |                                   |
    |---------------------------+-----------------------------------|
    |                           |démarrer l’interface               |
    |« allow-hotplug            |<nom_interface> lorsque le noyau   |
    |<nom_interface> »          |détecte un événement « à chaud »   |
    |                           |depuis cette interface             |
    |---------------------------+-----------------------------------|
    |Les lignes qui commencent  |définissent la configuration de    |
    |par « iface <nom_config>   |réseau <nom_config>                |
    |… »                        |                                   |
    |---------------------------+-----------------------------------|
    |Les lignes qui commencent  |définissent une valeur de          |
    |par « mapping              |correspondance de <nom_config> pour|
    |<nom_interface_glob> »     |l’interface correspondant à        |
    |                           |<nom_interface>                    |
    |---------------------------+-----------------------------------|
    |Une ligne commençant par le|est traitée comme commentaire et   |
    |signe « # »                |ignorée (les commentaires de fin de|
    |                           |ligne ne sont pas pris en charge)  |
    |---------------------------+-----------------------------------|
    |Une barre oblique inversée |étend la configuration à la ligne  |
    |(« \ », « back slash » en  |suivante                           |
    |anglais) en fin de ligne   |                                   |
    +---------------------------------------------------------------+


    Les lignes commençant par l’entrée iface ont la syntaxe
    suivante :

    iface <nom_config> <famille_adresse> <nom_méthode>
     <option1> <valeur1>
     <option2> <valeur2>
     ...

    Pour la configuration de base, l’entrée de mapping n’est pas
    utilisée si vous utilisez le nom de l’interface réseau comme nom
    de configuration du réseau (consultez Section 5.7.5, « L’entrée
    « mapping » »).

    Avertissement
   
    Ne pas définir dans « /etc/network/interfaces » d’entrée
    « iface » en double pour une interface réseau

%

5.6.3. L’interface réseau de rebouclage (« loopback »)

    L’entrée de configuration suivante du fichier « /etc/network/
    interfaces » active l’interface réseau « loopback » lo lors du
    démarrage du système (grâce à l’entrée auto) :

    auto lo
    iface lo inet loopback

    Elle existe toujours dans le fichier « /etc/network/interfaces ».

%

5.6.4. Interfaces réseau gérées par DHCP

    Après avoir préparé le système selon Section 5.5.1, « La
    connexion DHCP avec Ethernet », l’interface réseau gérée par le
    DHCP est configurée en créant l’entrée de configuration suivante
    dans le fichier « /etc/network/interfaces » :

    allow-hotplug eth0
    iface eth0 inet dhcp

    Lorsque le noyau de Linux détecte l’interface physique eth0,
    l’entrée allow-hotplug permet à ifup d’activer l’interface et
    l’entrée iface demande à ifup d’utiliser DHCP pour configurer
    l’interface.

%

5.6.5. Interface réseau avec une adresse IP fixe

    Une interface réseau avec une adresse IP fixe est configurée en
    créant de la manière suivante une entrée de configuration du
    fichier « /etc/network/interfaces » :

    allow-hotplug eth0
    iface eth0 inet static
     address 192.168.11.100
     netmask 255.255.255.0
     gateway 192.168.11.1
     dns-domain example.com
     dns-nameservers 192.168.11.1

    Lorsque le noyau de Linux détecte l’interface physique eth0,
    l’entrée allow-hotplug permet à ifup d’activer l’interface et
    l'entrée iface permet à ifup d'utiliser l’IP statique pour la
    configurer.

    Ici, je suppose ce qui suit :

      * plage d’adresses IP du réseau local : 192.168.11.0 -
        192.168.11.255

      * adresse IP de la passerelle : 192.168.11.1

      * adresse IP du PC : 192.168.11.100

      * paquet resolvconf : installé

      * nom de domaine : « example.com »

      * adresse IP address du serveur DNS : 192.168.11.1

    Si le paquet resolvconf n’est pas installé, vous devrez faire
    vous-même la configuration associée au DNS en éditant le fichier
    « /etc/resolv.conf » comme suit :

    nameserver 192.168.11.1
    domain example.com

    Attention

    Les adresses IP utilisées dans l’exemple ci-dessus ne sont pas
    destinées à être recopiées littéralement. Vous devrez adapter les
    adresses IP à la configuration réelle de votre réseau.

%

5.6.6. Les bases de l’interface réseau sans fil

    Le réseau local sans fil (« wireless LAN ou WLAN ») permet une
    connexion sans fil à haute vitesse par une communication en
    spectre étalé « spread-spectrum » sur des bandes radio ne
    nécessitant pas de licence en utilisant un ensemble de normes
    appelées IEEE 802.11.

    Les interfaces WLAN se comportent sensiblement de la même manière
    que les interfaces Ethernet normales mais elles demandent un
    identifiant de réseau et des données de clé de chiffrement lors
    de leur initialisation. Leurs outils réseau de haut niveau sont
    exactement les mêmes que pour les interfaces Ethernet mais les
    noms des interfaces sont un peu différents, comme eth1, wlan0,
    ath0, wifi0, … selon les pilotes du noyau utilisés.

    Astuce

    Le périphérique wmaster0 est le périphérique-maître interne
    utilisé uniquement par SoftMAC avec la nouvelle API mac80211 de
    Linux.

    Voici quelques mot-clés à se souvenir pour le WLAN :

    Tableau 5.11. Liste d’acronymes pour le WLAN

    +---------------------------------------------------------------+
    |acronyme|      en entier      |         signification          |
    |--------+---------------------+--------------------------------|
    |        |                     |ID du réseau sur 16 bits        |
    |NWID    |ID du réseau         |utilisées par les réseaux       |
    |        |                     |WaveLAN pre-802.11 (complètement|
    |        |                     |dépassé)                        |
    |--------+---------------------+--------------------------------|
    |        |                     |nom de réseau des Points d’accès|
    |        |Service Set          |sans fil (AP) interconnectés    |
    |(E)SSID |Identifier (étendu)  |pour former un réseau local sans|
    |        |                     |fil 802.11, identifiant de      |
    |        |                     |domaine                         |
    |--------+---------------------+--------------------------------|
    |        |Wired Equivalent     |première génération de norme de |
    |WEP,    |Privacy              |chiffrement sans fil sur 64 bits|
    |(WEP2)  |(confidentialité     |(128 bits) avec une clé sur 40  |
    |        |équivalente à un     |bits (dépassé)                  |
    |        |réseau câblé)        |                                |
    |--------+---------------------+--------------------------------|
    |        |Wi-Fi Protected      |seconde génération de norme de  |
    |WPA     |Access (Accès Wi-Fi  |chiffrement sans fil (la plus   |
    |        |protégé)             |grande partie de 802.11i),      |
    |        |                     |compatible avec WEP             |
    |--------+---------------------+--------------------------------|
    |        |Wi-Fi Protected      |troisième génération de norme de|
    |WPA2    |Access 2 (Accès      |chiffrement sans fil (802.11i   |
    |        |protégé Wi-FI 2)     |complète), non compatible avec  |
    |        |                     |WEP                             |
    +---------------------------------------------------------------+


    Le choix du protocole est normalement restreint par le routeur
    sans fil déployé.

%

5.6.7. L’interface de réseau local sans fil avec WPA/WPA2

    Vous devrez installer le paquet wpasupplicant afin de prendre en
    compte le WLAN avec les nouveaux protocoles WPA/WPA2.

    Dans le cas d’IP fournies par DHCP sur une connexion WLAN,
    l’entrée du fichier « /etc/network/interfaces » doit être
    similaire à ce qui suit :

    allow-hotplug ath0
    iface ath0 inet dhcp
     wpa-ssid zonemaison
     # la clé psk hexadécimale est encodée depuis une phrase de passe en texte clair
     wpa-psk 000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f

    Consultez « /usr/share/doc/wpasupplicant/README.modes.gz ».

%

5.6.8. L’interface réseau local sans fil avec WEP

    Vous devrez installer le paquet wireless-tools pour prendre en
    charge le WLAN avec l’ancien protocole WEP. (Votre routeur grand
    public peut encore utiliser cette infrastructure non sûre mais
    c’est mieux que rien).

    Attention
   
    Remarquez que le trafic réseau sur votre WLAN avec WEP peut être
    espionné par d’autres.

    Dans le cas d’IP fournies par DHCP sur une connexion WLAN,
    l’entrée du fichier « /etc/network/interfaces » doit être
    similaire à ce qui suit :

    allow-hotplug eth0
    iface eth0 inet dhcp
     wireless-essid Maison
     wireless-key1 0123-4567-89ab-cdef
     wireless-key2 12345678
     wireless-key3 s:mot_de_passe
     wireless-defaultkey 2
     wireless-keymode open

    Consultez « /usr/share/doc/wireless-tools/README.Debian ».

%

5.6.9. La connexion PPP

    Vous devrez d’abord configurer la connexion PPP comme décrit
    précédemment (consultez Section 5.5.3, « La connexion PPP avec
    pppconfig »). Ensuite, ajoutez dans le fichier « /etc/network/
    interfaces » une entrée pour le périphérique PPP primaire ppp0
    comme suit :

    iface ppp0 inet ppp
     provider <nom_fai>

%

5.6.10. La connexion alternative PPP

    Vous devrez d’abord configurer la connexion PPP alternative avec
    wvdial comme décrit précédemment (consultez Section 5.5.4,
    « Autre connexion PPP avec wvdialconf »). Ajoutez ensuite dans le
    fichier « /etc/network/interfaces » une entrée pour le
    périphérique primaire PPP ppp0 comme suit :

    iface ppp0 inet wvdial

%

5.6.11. La connexion PPPoE

    Pour le PC directement connecté au WAN et utilisant PPPoE, vous
    devez configurer votre système pour une connexion PPPoE comme
    cela a été décrit précédemment (consultez Section 5.5.5, « La
    connexion PPPoE avec pppoeconf »). Ajoutez ensuite dans le
    fichier « /etc/network/interfaces » une entrée pour le premier
    périphérique PPPoE eth0 comme suit :

    allow-hotplug eth0
    iface eth0 inet manual
     pre-up /sbin/ifconfig eth0 up
     up ifup ppp0=dsl
     down ifdown ppp0=dsl
     post-down /sbin/ifconfig eth0 down
    # Ce qui suit est utilisé uniquement de manière interne
    iface dsl inet ppp
     provider fournisseur-internet

%

5.6.12. État de configuration réseau de ifupdown

    Le fichier « /etc/network/run/ifstate » enregistre l’état désiré
    de la connexion réseau pour toutes les interfaces réseau
    actuellement actives et gérées par le paquet ifupdown.
    Malheureusement, même si le système ifupdown échoue dans
    l’activation de l’interface comme désiré, le fichier « /etc/
    network/run/ifstate » l’affichera comme active.

    Si la sortie de la commande ifconfig(8) d’une interface n’a pas
    de ligne telle que la suivante, elle ne peut pas être utilisée en
    tant qu’élément d’un réseau IPV4.

      inet addr:192.168.11.2  Bcast:192.168.11.255  Mask:255.255.255.0

    Note

    Pour un périphérique Ethernet connecté en PPPoE, la sortie de la
    commande ifconfig(8) ne produit pas de ligne semblable à celle de
    l’exemple ci-dessus.

%

5.6.13. Configuration réseau de base

    Lorsque vous tentez de reconfigurer une interface, par exemple
    eth0, vous devez d’abord la désactiver par la commande « sudo
    ifdown eth0 ». Cela supprime l’entrée eth0 du fichier « /etc/
    network/run/ifstate » (quelques messages d’erreur peuvent être
    émis si eth0 n’est pas active ou a été mal configurée auparavant.
    Jusqu’à présent, il semble qu’il soit sans danger de le faire
    n’importe quand sur une simple station de travail n’ayant qu’un
    seul utilisateur).

    Vous pouvez maintenant réécrire le contenu du fichier « /etc/
    network/interfaces » selon vos besoins pour reconfigurer
    l’interface réseau eth0.

    Ensuite, vous pourrez réactiver eth0 avec la commande  sudo ifup
    eth0 ».

    Astuce
   
    Vous pouvez (ré)initialiser l’interface réseau simplement par « 
    sudo ifdown eth0;sudo ifup eth0 ».

%

5.6.14. La paquet ifupdown-extra

    Le paquet ifupdown-extra fournit des tests de connexion au réseau
    faciles à utiliser avec le paquet ifupdown.

      * La commande network-test(1) peut être utilisée depuis
        l’interpréteur de commandes.
   
      * Les scripts automatiques sont lancés pour chaque exécution de
        la commande ifup.

    La commande network-test vous libère de l’exécution d’ennuyeuses
    commandes de bas niveau pour analyser les problèmes du réseau.

    Les scripts automatiques sont installés dans « /etc/network/*/ »
    et effectuent ce qui suit :

      * vérifier la connexion du câble réseau

      * vérifier l’utilisation d’une adresse IP dupliquée

      * définir les routes statiques du système basées sur la
        définition de « /etc/network/routes »

      * vérifier si la passerelle réseau peut être atteinte

      * enregistrer les résultats dans le fichier « /var/log/syslog »

    L’enregistrement dans syslog est assez utile pour
    l’administration des problèmes de réseau sur un système distant.

    Astuce

    Le comportement automatique du paquet ifupdown-extra est
    configurable par « /etc/default/network-test » Certaines de ces
    vérifications automatiques ralentissent un peu le démarrage du
    système car elles prennent un certain temps à l’écoute des
    réponses ARP.

%

5.7. Configuration réseau avancée avec ifupdown (ancienne)

    Les fonctionnalités du paquet ifupdown peuvent être améliorées
    au-delà de ce qui est décrit dans Section 5.6, « Configuration de
    base du réseau avec ifupdown (ancienne) » avec des connaissances
    avancées.

    Les fonctionnalités décrites ici sont entièrement facultatives.
    Étant paresseux et minimaliste, je me suis rarement ennuyé à les
    utiliser.

    Attention

    Si vous n’êtes pas arrivé à établir une connexion réseau à l’aide
    des informations de Section 5.6, « Configuration de base du
    réseau avec ifupdown (ancienne) », vous ne ferez qu’empirer la
    situation en utilisant les informations qui suivent :

%

5.7.1. La paquet ifplugd

    Le paquet ifplugd est un ancien outil de configuration
    automatique de réseau qui ne peut gérer que les connexions
    Ethernet. Il permet de régler le problème des connexions et
    déconnexions des câbles Ethernet avec les PC mobiles, etc. Si
    vous avez installé NetworkManager ou Wicd (consultez Section 5.2,
    « Configuration moderne de réseau pour ordinateur de bureau »),
    vous n’avez pas besoin de ce paquet.

    Ce paquet fait tourner un démon qui remplace les fonctionnalités 
    auto ou allow-hotplug (consultez Tableau 5.10, « Liste des
    entrées de « /etc/network/interfaces » ») et qui active les
    interfaces lors de leur connexion au réseau.

    Voici comment utiliser le paquet ifplugd pour le port Ethernet
    interne, par exemple, eth0.

     1. Supprimez l’entrée « auto eth0 » ou « allow-hotplug eth0 » de
        « /etc/network/interfaces »

     2. Conservez les entrées « iface eth0 inet … » et « mapping … »
        de « /etc/network/interfaces »
   
     3. Installez le paquet ifplugd.

     4. Lancez « sudo dpkg-reconfigure ifplugd »

     5. Mettez eth0 comme interface « statique devant être surveillée
        par ifplugd ».

    Le réseau fonctionne maintenant comme vous le désirez.

      * Lors de la mise sous tension ou lors de la découverte du
        matériel, l’interface n’est pas activée par elle-même.

          + Processus de démarrage rapide sans le long délai de
            dépassement de temps de DHCP.

          + Pas d’interface bizarre activée sans une adresse IPV4
            correcte (consultez Section 5.6.12, « État de
            configuration réseau de ifupdown »).

      * L’interface est activée lors de la découverte du câble
        Ethernet.

      * L’interface est désactivée quelque temps après que le câble
        Ethernet ait été débranché.

      * L’interface est activée dans le nouvel environnement de
        réseau lors de la connexion d’un autre câble Ethernet.

    Astuce
   
    Les paramètres de la commande ifplugd(8) peuvent définir son
    comportement tel que le délai de reconfiguration des interfaces.

%

5.7.2. Le paquet ifmetric

    Le paquet ifmetric permet de manipuler a posteriori la métrique
    de routes même avec DHCP.

    Ce qui suit permettra de rendre l’interface eth0 prioritaire sur
    l’interface wlan0 :

     1. installer le paquet ifmetric :

     2. ajouter l’option avec « metric 0 » juste en-dessous de la
        ligne « iface eth0 inet dhcp » dans « /etc/network/
        interfaces ».

     3. ajouter une ligne d’option avec « metric 1 » juste en-dessous
        de la ligne « iface wlan0 inet dhcp » dans « /etc/network/
        interfaces ».

    « metric 0 » indique la route de plus haute priorité et c’est
    celle par défaut. La plus grande valeur de « metric » indique une
    route de moindre priorité. L’adresse IP de l’interface active
    ayant la valeur de « metric » la plus basse devient celle
    d’origine. Consultez ifmetric(8).

%

5.7.3. L’interface virtuelle

    Une seule interface Ethernet physique peut être configurée en
    tant que de multiples interfaces virtuelles avec différentes
    adresses IP. Habituellement, le but est de connecter une
    interface à plusieurs sous-réseaux ayant des IP différentes. Par
    exemple, l’hébergement web virtuel basé sur l’IP avec une seule
    interface réseau est une application de ce type.

    Supposons, par exemple, ce qui suit :

      * une seule interface Ethernet de votre machine est raccordée à
        un « hub Ethernet » (pas au routeur à large bande) :

      * le concentrateur Ethernet est connecté à la fois à Internet
        et au réseau local :

      * le réseau local utilise le sous-réseau 192.168.0.x/24 :

      * votre machine utilise une adresse IP fournie par DHCP avec
        l’interface physique eth0 pour Internet :

      * votre machine utilise 192.168.0.1 avec l’interface virtuelle
        eth0:0 pour le réseau local.

    Les entrées suivantes de « /etc/network/interfaces » permettent
    de configurer votre réseau :

    iface eth0 inet dhcp
     metric 0
    iface eth0:0 inet static
     address 192.168.0.1
     netmask 255.255.255.0
     network 192.168.0.0
     metric 1

    Attention

    Bien que cet exemple de configuration avec traduction d’adresse
    réseau (NAT) en utilisant netfilter/iptables (consultez
    Section 5.10, « Infrastructure de netfilter ») puisse fournir un
    routeur économique pour le réseau local avec une seule interface,
    il n’y a pas, avec votre configuration, de possibilité réelle de
    pare-feu. Vous devriez utiliser deux interfaces physiques avec
    NAT afin de sécuriser le réseau local contre ce qui provient
    d’Internet.

%

5.7.4. Syntaxe de commande avancée

    Le paquet ifupdown fournit une configuration avancée du réseau en
    utilisant le nom configuration réseau et le nom interface réseau.
    J’utilise une terminologie un peu différente de celle utilisée
    dans ifup(8) et interfaces(5).

    Tableau 5.12. Terminologie des périphériques réseau

    +---------------------------------------------------------------+
    |terminologie|     ma      |exemple dans le|                    |
    | de la page |terminologie |texte suivant :|    description     |
    | de manuel  |             |               |                    |
    |------------+-------------+---------------+--------------------|
    |nom de l’   |nom de l’    |               |nom donné dans le   |
    |interface   |interface    |lo, eth0,      |noyau Linux         |
    |physique    |réseau       |<nom_interface>|(utilisant le       |
    |            |             |               |mécanisme udev)     |
    |------------+-------------+---------------+--------------------|
    |nom de l’   |nom de la    |config1,       |noms suivants iface |
    |interface   |configuration|config2,       |dans le fichier « / |
    |logique     |réseau       |<nom_config>   |etc/network/        |
    |            |             |               |interfaces »        |
    +---------------------------------------------------------------+


    Les commandes élémentaires de configuration du réseau se trouvant
    dans Section 5.6.1, « La syntaxe de commande simplifiée » exigent
    que le nom de la configuration réseau de l’entrée iface
    corresponde au nom de l’interface réseau dans le fichier « /etc/
    network/interfaces ».

    Les commandes avancées de configuration du réseau permettent de
    séparer de la manière suivante le nom de la configuration réseau
    et le nom de l’interface réseau dans le fichier « /etc/network/
    interfaces » :

    Tableau 5.13. Liste des commandes avancées de configuration du
    réseau par ifupdown

    +---------------------------------------------------------------+
    | commande  |                      action                       |
    |-----------+---------------------------------------------------|
    |ifup eth0= |activer une interface réseau eth0 avec la          |
    |config1    |configuration config1                              |
    |-----------+---------------------------------------------------|
    |ifdown eth0|désactiver une interface réseau eth0 avec la       |
    |=config1   |configuration config1                              |
    |-----------+---------------------------------------------------|
    |ifup eth0  |activer une interface réseau eth0 avec la          |
    |           |configuration sélectionnée par l’entrée mapping    |
    |-----------+---------------------------------------------------|
    |ifdown eth0|désactiver une interface réseau eth0 avec la       |
    |           |configuration sélectionnée par l’entrée mapping    |
    +---------------------------------------------------------------+


%

5.7.5. L’entrée « mapping »

    Nous avons sauté l’explication de l’entrée mapping du fichier « /
    etc/network/interfaces » dans la Section 5.6.2, « Syntaxe de base
    de « /etc/network/interfaces » » pour éviter des complications.
    Cette entrée possède la syntaxe suivante :

    mapping <motif_nom_interface>
     script <nom_script>
     map <script_entrée1>
     map <script_entrée2>
     map ...

    Cela fournit des fonctionnalités avancées au fichier « /etc/
    network/interfaces » en automatisant le choix de la configuration
    avec le script de « mapping » indiqué par <nom_script>.

    Suivons l’exécution de ce qui suit :

    $ sudo ifup eth0

    Lorsque « <motif_nom_interface> » correspond à « eth0 », cette
    exécution lance l’exécution de la commande suivante afin de
    configurer automatiquement eth0 :

    $ sudo ifup eth0=$(echo -e '<script_entrée1> \n <script_entrée2> \n ...' | <nom_script> eth0)

    Ici, les lignes d’entrée du script contenant « map » sont
    facultatives et peuvent être répétées.

    Note

    Le motif générique (glob) pour l’entrée mapping fonctionne comme
    les motifs génériques des noms de fichiers de l’interpréteur de
    commandes (consultez Section 1.5.6, « Motifs génériques
    (« glob ») de l’interpréteur de commandes »).

%

5.7.6. Configuration réseau commutable manuellement

    Voici comment commuter manuellement entre plusieurs
    configurations de réseau sans réécrire le fichier « /etc/network/
    interfaces » comme dans Section 5.6.13, « Configuration réseau de
    base ».

    Créez un paragraphe distinct dans le fichier « /etc/network/
    interfaces » pour chaque configuration de réseau auquel vous
    souhaitez accéder, comme dans les exemples suivants :

    auto lo
    iface lo inet loopback

    iface config1 inet dhcp

    iface config2 inet static
     address 192.168.11.100
     netmask 255.255.255.0
     gateway 192.168.11.1
     dns-domain example.com
     dns-nameservers 192.168.11.1
   
    iface pppoe inet manual
     pre-up /sbin/ifconfig eth0 up
     up ifup ppp0=dsl
     down ifdown ppp0=dsl
     post-down /sbin/ifconfig eth0 down

    # Ce qui suit n'est utilisé que de manière interne
    iface dsl inet ppp
     provider fai_adsl

    iface pots inet ppp
     provider fai

    Vous remarquez que le nom de configuration de réseau qui est
    l’élément suivant iface n’utilise pas l’élément pour le nom
    d’interface réseau. Notez aussi qu’il n’y a pas d’entrée auto ni
    d’entrée allow-hotplugpour démarrer automatiquement l’interface
    réseau eth0 sur événement.

    Vous êtes maintenant prêt à commuter la configuration de votre
    réseau.

    Déplaçons votre PC vers un réseau local desservi par DHCP. Vous
    activez l’interface réseau (l’interface physique) eth0 en lui
    assignant le nom de configuration réseau (le nom de l’interface
    logique) config1 de la manière suivante :

    $ sudo ifup eth0=config1
    Password:
    ...

    L’interface eth0 est active, configurée par DHCP et connectée au
    réseau local.

    $ sudo ifdown eth0=config1
    ...

    L’interface eth0 est inactive et déconnectée du réseau local.

    Déplaçons votre PC vers un réseau local avec une adresse IP fixe.
    Vous activez l’interface réseau eth0 en lui assignant le nom de 
    configuration réseau config2 de la manière suivante :

    $ sudo ifup eth0=config2
    ...

    L’interface eth0 est active, configurée avec une IP statique et
    connectée au réseau local. Les paramètres supplémentaires donnés
    sous la forme dns-* configurent le contenu de « /etc/
    resolv.conf ». Ce fichier « /etc/resolv.conf » est mieux géré si
    le paquet resolvconf est installé.

    $ sudo ifdown eth0=config2
    ...

    L’interface eth0 est de nouveau inactive et déconnectée du réseau
    local.

    Déplaçons votre PC sur le port d’un modem large bande connecté au
    service par PPPoE. Vous activez l’interface réseaueth0 en lui
    assignant le nom de configuration réseau pppoe de la manière
    suivante :

    $ sudo ifup eth0=pppoe
    ...

    L’interface eth0 est active, configurée avec une connexion PPPoE,
    directement vers le FAI.

    $ sudo ifdown eth0=pppoe
    ...

    L’interface eth0 est de nouveau désactivée et déconnectée.

    Déplaçons votre PC à un emplacement sans réseau local et sans
    modem large bande mais avec un POTS et un modem (modem sur le
    réseau commuté). Vous activez l’interface réseau ppp0 en lui
    assignant le nom de configuration réseau pots de la manière
    suivante :

    $ sudo ifup ppp0=pots
    ...

    L’interface ppp0 est active et connectée à Internet par PPP.

    $ sudo ifdown ppp0=pots
    ...

    L’interface ppp0 est inactive et déconnectée d’Internet.

    Vous devriez vérifier l’état actuel de la configuration du réseau
    du système ifupdown dans le fichier « /etc/network/run/ifstate ».

    Avertissement
   
    Il se peut que vous ayez besoin d’ajuster le nombre à la fin de
    eth*, ppp*, etc. si vous avez plusieurs interfaces réseau.

%

5.7.7. Scripts avec le système ifupdown

    Le système ifupdown lance automatiquement les scripts qui sont
    installés dans « /etc/network/*/ » en exportant les variables
    d’environnement vers les scripts.

    Tableau 5.14. Liste des variables d’environnement passées par le
    système ifupdown

    +---------------------------------------------------------------+
    |   variable    |                 valeur passée                 |
    |d’environnement|                                               |
    |---------------+-----------------------------------------------|
    |« $IFACE »     |nom physique (nom d’interface) de l’interface  |
    |               |en cours de traitement                         |
    |---------------+-----------------------------------------------|
    |« $LOGICAL »   |nom logique (nom de configuration) de          |
    |               |l’interface en cours de traitement             |
    |---------------+-----------------------------------------------|
    |« $ADDRFAM »   |<famille_d_adresses> de l’interface            |
    |---------------+-----------------------------------------------|
    |« $METHOD »    |<nom_méthode> de l’interface. (par exemple     |
    |               |« static »)                                    |
    |---------------+-----------------------------------------------|
    |« $MODE »      |«  » si lancé depuis ifup, « stop » si lancé   |
    |               |depuis ifdown                                  |
    |---------------+-----------------------------------------------|
    |               |comme pour « $MODE » mais avec une plus faible |
    |« $PHASE »     |granularité permettant de distinguer les phases|
    |               |pre-up, post-up, pre-down et post-down         |
    |---------------+-----------------------------------------------|
    |« $VERBOSITY » |indique si « --verbose » a été utilisé.        |
    |               |Positionnée à 1 dans ce cas, à 0 sinon         |
    |---------------+-----------------------------------------------|
    |               |chemin de recherche de la commande : « /usr/   |
    |« $PATH »      |local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/ |
    |               |sbin:/bin »                                    |
    |---------------+-----------------------------------------------|
    |« $IF_<OPTION> |valeur de l’option correspondante de l’entrée  |
    | »             |iface                                          |
    +---------------------------------------------------------------+


    Ici, chaque variable d’environnement, « $IF_<OPTION>  », est
    créée à partir du nom de l’option correspondante comme <option1>
    et <option2> en les préfixant avec « $IF_ », et en convertissant
    la casse en majuscules, en remplaçant les tirets (« - ») par des
    tirets soulignés (« _ ») et en supprimant les caractères non
    alphanumériques.

    Astuce

    Consultez Section 5.6.2, « Syntaxe de base de « /etc/network/
    interfaces » » pour <famille_adresse>, <nom_méthode>, <option1>
    et <option2>.

    Le paquet ifupdown-extra (consultez Section 5.6.14, « La paquet
    ifupdown-extra ») utilise ces variables d’environnement pour
    étendre les fonctionnalités du paquet ifupdown. Le paquet
    ifmetric (consultez Section 5.7.2, « Le paquet ifmetric »)
    installe le script « /etc/network/if-up.d/ifmetric » qui définit
    la métrique par l’intermédiaire de la variable « $IF_METRIC ». Le
    paquet guessnet (consultez Section 5.7.8, « Cartographie réseau
    avec guessnet »), qui fournit une ossature simple et puissante
    pour la sélection automatique de la configuration du réseau par
    le mécanisme de cartographie de réseau (« mapping »), les utilise
    aussi.

    Note

    Pour des exemples plus spécifiques de scripts personnalisés de
    configuration du réseau en utilisant les variables
    d’environnement, vous pouvez consulter les scripts d’exemples se
    trouvant dans « /usr/share/doc/ifupdown/examples/* » et les
    scripts utilisés dans les paquets ifscheme et
    ifupdown-scripts-zg2. Ces scripts supplémentaires ont des
    fonctionnalités qui se chevauchent un peu avec les paquets de
    base ifupdown-extra et guessnet. Si vous installez ces scripts
    supplémentaires, vous devrez les personnaliser afin d’éviter des
    interférences.

%

5.7.8. Cartographie réseau avec guessnet

    Plutôt que de choisir manuellement la configuration comme il est
    décrit dans la Section 5.7.6, « Configuration réseau commutable
    manuellement », vous pouvez utiliser le mécanisme de cartographie
    réseau décrit dans la Section 5.7.5, « L’entrée « mapping » »
    pour sélectionner automatiquement la configuration du réseau à
    l’aide de scripts personnalisés.

    La commande guessnet-ifupdown(8) fournie par le paquet guessnet
    est conçue pour être utilisée comme script de cartographie réseau
    et fournit une infrastructure puissante pour améliorer le système
    ifupdown.

      * Vous listez la condition de test comme valeur des options de 
        guessnet pour chacune des configurations de réseau de
        l’entrée iface.
   
      * La cartographie du réseau choisit la première entrée iface
        donnant un résultat qui ne soit pas en erreur comme
        configuration du réseau.

    Cette double utilisation du fichier « /etc/network/interfaces »
    par le script de mapping, guessnet-ifupdown et l’infrastructure
    d’origine de configuration du réseau, ifupdown, n’a pas d’impact
    négatif car les options de guessnet n’exportent que des variables
    d’environnement supplémentaires vers les scripts lancés par le
    système ifupdown. Consultez guessnet-ifupdown(8) pour davantage
    d’informations.

    Note

    Lorsqu’il est nécessaire d’avoir plusieurs lignes d’options de 
    guessnet dans « /etc/network/interfaces », utilisez les lignes
    d’options commençant par guessnet1, guessnet2 et ainsi de suite,
    car le paquet ifupdown n’autorise pas que les chaînes de
    caractères de début des lignes d’options soient dupliquées.

5.8. Configuration réseau de bas niveau

%

5.8.1. Commandes Iproute2

    Les commandes Iproute2 offrent des possibilités complètes de
    configuration de bas niveau du réseau. Voici une table de
    conversion des commandes obsolètes net-tools obsolètes vers les
    nouvelles commandes iproute2, etc.

    Tableau 5.15. Table de conversion depuis les commandes obsolètes
    net-tools vers les nouvelles commandes iproute2

    +---------------------------------------------------------------+
    | net-tools  |   nouveau   |                                    |
    | obsolètes  |  iproute2,  |            manipulation            |
    |            |    etc.     |                                    |
    |------------+-------------+------------------------------------|
    |ifconfig(8) |ip addr      |adresse de protocole (IP ou IPv6)   |
    |            |             |d’un périphérique                   |
    |------------+-------------+------------------------------------|
    |route(8)    |ip route     |entrée de la table de routage       |
    |------------+-------------+------------------------------------|
    |arp(8)      |ip neigh     |entrée de cache ARP ou NDISC        |
    |------------+-------------+------------------------------------|
    |ipmaddr     |ip maddr     |adresse multicast                   |
    |------------+-------------+------------------------------------|
    |iptunnel    |ip tunnel    |tunnel sur IP                       |
    |------------+-------------+------------------------------------|
    |nameif(8)   |ifrename(8)  |nommer les interfaces réseau en se  |
    |            |             |basant sur l’adresse MAC            |
    |------------+-------------+------------------------------------|
    |mii-tool(8) |ethtool(8)   |paramétrage du périphérique Ethernet|
    +---------------------------------------------------------------+


    Consultez ip(8) et Howto de la suite utilitaire IPROUTE2.

%

5.8.2. Opérations sûres de bas niveau sur le réseau

    Vous pouvez utiliser de manière sûre les commandes de réseau de
    bas niveau de la manière suivante car elles ne modifient pas la
    configuration du réseau :

    Tableau 5.16. Liste des commandes de réseau de bas niveau

    +---------------------------------------------------------------+
    |     commande      |                description                |
    |-------------------+-------------------------------------------|
    |ifconfig           |afficher l’état et l’adresse du lien des   |
    |                   |interfaces actives                         |
    |-------------------+-------------------------------------------|
    |ip addr show       |afficher l’état et l’adresse du lien des   |
    |                   |interfaces actives                         |
    |-------------------+-------------------------------------------|
    |route -n           |afficher toutes les tables de routage sous |
    |                   |forme d’adresses numériques                |
    |-------------------+-------------------------------------------|
    |ip route show      |afficher toutes les tables de routage sous |
    |                   |forme d’adresses numériques                |
    |-------------------+-------------------------------------------|
    |arp                |afficher le contenu actuel des tables de   |
    |                   |cache d’ARP                                |
    |-------------------+-------------------------------------------|
    |ip neigh           |afficher le contenu actuel des tables de   |
    |                   |cache d’ARP                                |
    |-------------------+-------------------------------------------|
    |plog               |afficher le journal du démon ppp           |
    |-------------------+-------------------------------------------|
    |ping yahoo.com     |vérifier la connexion internet vers        |
    |                   |« yahoo.com »                              |
    |-------------------+-------------------------------------------|
    |whois yahoo.com    |vérifier qui a enregistré « yahoo.com »    |
    |                   |dans la base de données des domaines       |
    |-------------------+-------------------------------------------|
    |traceroute         |tracer la connexion Internet vers          |
    |yahoo.com          |« yahoo.com »                              |
    |-------------------+-------------------------------------------|
    |tracepath yahoo.com|tracer la connexion Internet vers          |
    |                   |« yahoo.com »                              |
    |-------------------+-------------------------------------------|
    |mtr yahoo.com      |tracer la connexion Internet vers          |
    |                   |« yahoo.com » (de manière répétitive)      |
    |-------------------+-------------------------------------------|
    |dig                |vérifier les enregistrements DNS de        |
    |[@dns-serveur.com] |« example.com » par « dns-serveur.com »    |
    |example.com [{a|mx||pour un enregistrement « a », « mx » ou    |
    |any}]              |« any »                                    |
    |-------------------+-------------------------------------------|
    |iptables -L -n     |vérifier le filtre de paquets              |
    |-------------------+-------------------------------------------|
    |netstat -a         |rechercher tous les ports ouverts          |
    |-------------------+-------------------------------------------|
    |netstat -l --inet  |rechercher les ports à l’écoute            |
    |-------------------+-------------------------------------------|
    |netstat -ln --tcp  |rechercher les ports TCP à l’écoute        |
    |                   |(numérique)                                |
    |-------------------+-------------------------------------------|
    |dlint example.com  |vérifier les informations de zone DNS de   |
    |                   |« example.com »                            |
    +---------------------------------------------------------------+


    Astuce

    Certains de ces outils de configuration du réseau se trouvent
    dans « /sbin/ ». Il vous faudra peut-être utiliser le chemin
    complet vers la commande comme « /sbin/ifconfig » ou ajouter « /
    sbin » à la liste « $PATH » dans votre fichier « ~/.bashrc »

%

5.9. Optimisation du réseau

    L’optimisation générique du réseau est en dehors des buts de
    cette documentation. Je ne parle que des sujets pertinents pour
    une connexion de l’utilisateur grand public.

    Tableau 5.17. Liste des outils d’optimisation du réseau.

    +---------------------------------------------------------------+
    | paquets |popcon|taille|              description              |
    |---------+------+------+---------------------------------------|
    |iftop    |V:7,  |97    |afficher l’utilisation de la bande     |
    |         |I:115 |      |passante d’une interface réseau        |
    |---------+------+------+---------------------------------------|
    |iperf    |V:4,  |263   |outil de mesure de la bande passante du|
    |         |I:55  |      |protocole Internet                     |
    |---------+------+------+---------------------------------------|
    |         |V:0,  |      |InterFace STATistics Monitoring        |
    |ifstat   |I:8   |60    |(surveillance des statistiques de      |
    |         |      |      |l’interface)                           |
    |---------+------+------+---------------------------------------|
    |bmon     |V:1,  |146   |surveillance portable de la bande      |
    |         |I:17  |      |passante et estimation du débit        |
    |---------+------+------+---------------------------------------|
    |ethstatus|V:0,  |40    |script qui mesure rapidement le débit  |
    |         |I:5   |      |d"une interface réseau                 |
    |---------+------+------+---------------------------------------|
    |bing     |V:0,  |80    |testeur de bande passante empirique et |
    |         |I:1   |      |stochastique                           |
    |---------+------+------+---------------------------------------|
    |bwm-ng   |V:2,  |90    |moniteur de bande passante simple en   |
    |         |I:17  |      |mode console                           |
    |---------+------+------+---------------------------------------|
    |ethstats |V:0,  |23    |moniteur de statistiques Ethernet en   |
    |         |I:0   |      |mode console                           |
    |---------+------+------+---------------------------------------|
    |ipfm     |V:0,  |78    |outil d’analyse de bande passante      |
    |         |I:0   |      |                                       |
    +---------------------------------------------------------------+


%

5.9.1. Rechercher le MTU optimum

    La valeur du Maximum Transmission Unit (MTU) (Unité de
    transmission maximum) peut être déterminée expérimentalement par 
    ping(8) avec l’option « -M do » qui envoie des paquets ICMP dont
    la taille commence par 1500 (avec un décalage de 28 octets pour
    l’en-tête IP+ICMP) et recherche la taille la plus grande sans
    fragmentation d’IP.

    Essayez, par exemple, ce qui suit :

    $ ping -c 1 -s $((1500-28)) -M do www.debian.org
    PING www.debian.org (194.109.137.218) 1472(1500) bytes of data.
    From 192.168.11.2 icmp_seq=1 Frag needed and DF set (mtu = 1454)

    --- www.debian.org ping statistics ---
    0 packets transmitted, 0 received, +1 errors

    Essayez 1454 à la place de 1500

    Vous voyez que ping(8) a réussi avec 1454.

    Ce processus est la découverte du chemin MTU (PMTU) (RFC1191) et
    la commande tracepath(8) peut l’automatiser.

    Astuce

    L’exemple ci-dessus avec une valeur de PMTU de 1454 correspond à
    mon fournisseur FTTP précédent qui utilisait Asynchronous
    Transfer Mode (ATM) comme réseau fédérateur (« backbone ») et
    servait ses clients avec PPPoE. La valeur réelle de PMTU dépend
    de votre environnement, par exemple, 1500 avec mon nouveau
    fournisseur FTTP.

    Tableau 5.18. Lignes directrices pour une valeur optimum de MTU

    +---------------------------------------------------------------+
    |  environnement de   |     MTU     |       justification       |
    |       réseau        |             |                           |
    |---------------------+-------------+---------------------------|
    |Lien commuté (IP :   |576          |standard                   |
    |PPP)                 |             |                           |
    |---------------------+-------------+---------------------------|
    |Lien Ethernet (IP :  |1500         |standard et par défaut     |
    |DHCP ou fixe)        |             |                           |
    |---------------------+-------------+---------------------------|
    |lien Ethernet (IP :  |1492 (=      |2 octets pour l’en-tête PPP|
    |PPPoE)               |1500-8)      |et 6 octets pour l’en-tête |
    |                     |             |PPPoE                      |
    |---------------------+-------------+---------------------------|
    |lien Ethernet (épine |             |spéculations de l’auteur : |
    |dorsale de réseau du |1462 (=      |18 octets pour l’en-tête   |
    |FAI : ATM, IP : DHCP |48*31-18-8)  |Ethernet, 8 octets pour le |
    |ou fixe)             |             |« trailer » SAR            |
    |---------------------+-------------+---------------------------|
    |lien Ethernet (réseau|             |consultez une justification|
    |fédérateur du FAI  : |1454 (=      |dans « Configuration       |
    |ATM, IP : PPPoE)     |48*31-8-18-8)|optimum du MTU pour les    |
    |                     |             |connexions ADSL PPPoE  »   |
    +---------------------------------------------------------------+


    En plus de ces lignes directrices, vous devriez savoir ce qui
    suit :

      * Toute utilisation d’une méthode de tunneling (VPN, etc.) peut
        réduire le MTU optimal en raison de la surcharge qu’elle
        engendre.

      * La valeur de MTU ne doit pas excéder la valeur expérimentale
        déterminée de PMTU .

      * La valeur de MTU la plus élevée est généralement meilleure
        lors que les autres limitations sont remplies.

%

5.9.2. Définir le MTU

    Voici des exemples de définition de la valeur de MTU à partir de
    ses valeurs par défaut 1500 à 1454.

    Pour le DHCP (consultez Section 5.6.4, « Interfaces réseau gérées
    par DHCP »), vous pouvez remplacer les lignes d’entrée iface
    pertinentes du fichier « /etc/network/interfaces » avec ce qui
    suit :

    iface eth0 inet dhcp
     pre-up /sbin/ifconfig $IFACE mtu 1454

    Pour une IP statique (consultez Section 5.6.5, « Interface réseau
    avec une adresse IP fixe »), vous pouvez remplacer les lignes
    d’entrées iface pertinentes du fichier « /etc/network/
    interfaces » avec ce qui suit :

    iface eth0 inet static
     address 192.168.11.100
     netmask 255.255.255.0
     gateway 192.168.11.1
     mtu 1454
     dns-domain example.com
     dns-nameservers 192.168.11.1

    Pour une connexion PPPoE directe (consultez Section 5.5.5, « La
    connexion PPPoE avec pppoeconf »), vous pouvez remplacer la ligne
    « mtu » pertinente du fichier « /etc/ppp/peers/dsl-provider » par
    ce qui suit :

    mtu 1454

    La taille maximum de segment (MSS : « maximum segment size ») est
    utilisée comme mesure de remplacement de la taille des paquets.
    La relation entre MSS et MTU est la suivante :

      * MSS = MTU - 40 pour IPv4
   
      * MSS = MTU - 60 pour IPv6

    Note

    Les optimisations basées sur iptables(8) (consultez Section 5.10,
    « Infrastructure de netfilter ») peuvent limiter la taille des
    paquets au MSS, ce qui est utile pour le routeur. Consultez
    "TCPMSS" dans iptables(8).

%

5.9.3. Optimisation de TCP sur le réseau Internet

    Le débit de TCP peut être maximisé en ajustant les paramètres de
    taille de tampon TCP comme cela est décrit dans « Guide de
    réglage de TCP » (« TCP Tuning Guide ») et « réglage de TCP »
    (« TCP tuning ») pour les réseaux WAN modernes de haut débit et
    de faible latence. À ce jour, les paramètres par défaut de Debian
    fonctionnent bien même lorsque mon réseau local est connecté par
    l’intermédiaire d’un service rapide sur fibre optique (FTTP) à
    1Gb/s.

%

5.10. Infrastructure de netfilter

    Netfilter fournit l’infrastructure pour un pare-feu dynamique
    (« stateful firewall ») et la traduction d’adresses réseau (NAT)
    (« network address translation ») avec des modules du noyau de
    Linux (consultez Section 3.3.1, « Initialisation des modules du
    noyau »).

    Tableau 5.19. Liste d’outils de pare-feu

    +---------------------------------------------------------------+
    |    paquets    |popcon|taille|           description           |
    |---------------+------+------+---------------------------------|
    |               |V:300,|      |outils d’administration pour     |
    |iptables       |I:993 |2520  |netfilter (iptables(8) pour IPv4,|
    |               |      |      |ip6tables(8) for IPv6)           |
    |---------------+------+------+---------------------------------|
    |arptables      |V:0,  |96    |outils d’administration pour     |
    |               |I:2   |      |netfilter (arptables(8) pour ARP)|
    |---------------+------+------+---------------------------------|
    |               |V:15, |      |outils d’administration pour     |
    |ebtables       |I:39  |265   |netfilter (ebtables(8) pour le   |
    |               |      |      |pontage Ethernet)                |
    |---------------+------+------+---------------------------------|
    |iptstate       |V:0,  |116   |surveillance continue de l’état  |
    |               |I:3   |      |de netfilter (semblable à top(1))|
    |---------------+------+------+---------------------------------|
    |shorewall-init |V:0,  |68    |initialisation de Shoreline      |
    |               |I:0   |      |Firewall                         |
    |---------------+------+------+---------------------------------|
    |               |V:5,  |      |Shoreline Firewall, générateur de|
    |shorewall      |I:13  |2458  |fichier de configuration pour    |
    |               |      |      |netfilter                        |
    |---------------+------+------+---------------------------------|
    |               |V:0,  |      |Shoreline Firewall, générateur de|
    |shorewall-lite |I:0   |65    |fichier de configuration pour    |
    |               |      |      |netfilter (version légère)       |
    |---------------+------+------+---------------------------------|
    |               |V:1,  |      |Shoreline Firewall, générateur de|
    |shorewall6     |I:2   |779   |fichier de configuration pour    |
    |               |      |      |netfilter (version IPv6)         |
    |---------------+------+------+---------------------------------|
    |               |V:0,  |      |Shoreline Firewall, générateur de|
    |shorewall6-lite|I:0   |64    |fichier de configuration pour    |
    |               |      |      |netfilter (version légère, IPv6) |
    +---------------------------------------------------------------+


    L’outil netfilter principal de l’espace utilisateur est iptables
    (8). Vous pouvez configurer vous-même netfilter de manière
    interactive depuis l’interpréteur de commandes, enregistrer son
    état avec iptables-save(8) et le restaurer par l’intermédiaire
    d’un script d’init avec iptables-restore(8) lors du redémarrage
    du système.

    Des scripts d’assistant tels que shorewall facilitent ce
    processus.

    Consultez les documentations se trouvant sur http://
    www.netfilter.org/documentation/ (ou dans « /usr/share/doc/
    iptables/html/ »).

      * Linux Networking-concepts HOWTO (HOWTO des concepts réseau de
        Linux)

      * Linux 2.4 Packet Filtering HOWTO (HOWTO du filtrage des
        paquets de Linux 2.4)

      * Linux 2.4 NAT HOWTO (HOWTO du NAT de Linux 2.4)

    Astuce

    Bien qu’elles aient été écrites pour Linux 2.4, la commande 
    iptables(8) et la fonction netfilter du noyau s’appliquent toutes
    deux aux séries 2.6 et 3.x du noyau Linux.

Chapitre 6. Applications réseau

    Après avoir établi une connexion réseau (consultez Chapitre 5, 
    Configuration du réseau), vous pouvez faire tourner diverses
    applications réseau.

    Astuce

    Pour un guide spécifique de Debian moderne sur les
    infrastructures réseaux, lisez Le Livre de l'Administrateur
    Debian - Infrastructure réseau.

    Astuce

    If you enabled "2-Step Verification" with some ISP, you need to
    obtain an application password to access POP and SMTP services
    from your program. You may need to approve your host IP in
    advance.

%

6.1. Navigateurs Web

    Il y a de nombreux paquets de navigateurs web permettant
    d’accéder à des contenus distants avec le protocole de transfert
    hypertexte (« Hypertext Transfer Protocol (HTTP) »).

    Tableau 6.1. Liste de navigateurs web

    +---------------------------------------------------------------+
    |     paquet     |popcon|taille|  type   |    description du    |
    |                |      |      |         |    navigateur web    |
    |----------------+------+------+---------+----------------------|
    |chromium        |V:51, |180040|X        |Chromium (navigateur  |
    |                |I:141 |      |         |libre de Google)      |
    |----------------+------+------+---------+----------------------|
    |                |      |      |         |Firefox (navigateur   |
    |firefox         |V:13, |205631|, ,      |libre de Mozilla,     |
    |                |I:20  |      |         |uniquement disponible |
    |                |      |      |         |dans Debian Unstable) |
    |----------------+------+------+---------+----------------------|
    |                |      |      |         |Firefox ESR (Firefox  |
    |firefox-esr     |V:217,|198436|, ,      |Extended Support      |
    |                |I:437 |      |         |Release = Firefox     |
    |                |      |      |         |Support à Long Terme) |
    |----------------+------+------+---------+----------------------|
    |epiphany-browser|V:4,  |3730  |, ,      |GNOME, Epiphany       |
    |                |I:24  |      |         |respectant HIG        |
    |----------------+------+------+---------+----------------------|
    |konqueror       |V:18, |20763 |, ,      |KDE, Konqueror        |
    |                |I:100 |      |         |                      |
    |----------------+------+------+---------+----------------------|
    |dillo           |V:1,  |1536  |, ,      |Dillo (navigateur     |
    |                |I:7   |      |         |léger, basé sur FLTK) |
    |----------------+------+------+---------+----------------------|
    |w3m             |V:31, |2289  |texte    |w3m                   |
    |                |I:284 |      |         |                      |
    |----------------+------+------+---------+----------------------|
    |lynx            |V:13, |1948  |, ,      |Lynx                  |
    |                |I:98  |      |         |                      |
    |----------------+------+------+---------+----------------------|
    |elinks          |V:6,  |1767  |, ,      |ELinks                |
    |                |I:28  |      |         |                      |
    |----------------+------+------+---------+----------------------|
    |links           |V:6,  |2249  |, ,      |Links (texte          |
    |                |I:39  |      |         |uniquement)           |
    |----------------+------+------+---------+----------------------|
    |links2          |V:1,  |5417  |graphique|Links (graphique en   |
    |                |I:15  |      |         |mode console sans X)  |
    +---------------------------------------------------------------+


%

6.1.1. Configuration du navigateur

    Vous pouvez utiliser les chaînes d’URL spéciales suivantes pour
    confirmer le paramétrage de certains navigateurs :

      * « about: »

      * « about:config »

      * « about:plugins »

    Debian propose pour les navigateurs, dans la section main, de
    nombreux paquets de greffons libres qui peuvent gérer non
    seulement Java (plateforme logicielle) et Flash mais aussi les
    fichiers MPEG, MPEG2, MPEG4, DivX, Windows Media Video (.wmv),
    QuickTime (.mov), MP3 (.mp3), Ogg/Vorbis, les DVD, VCD, etc.
    Debian propose aussi, dans les sections contrib ou non-free, des
    paquets de programmes facilitant l’installation de greffons non
    libres pour les navigateurs.

    Tableau 6.2. Liste des paquets de greffons pour les navigateurs

    +-------------------------------------------------------------------------+
    |                paquet                |popcon|taille|section|description |
    |--------------------------------------+------+------+-------+------------|
    |                                      |      |      |       |Pepper Flash|
    |pepperflashplugin-nonfree             |V:1,  |29    |contrib|Player -    |
    |                                      |I:21  |      |       |browser     |
    |                                      |      |      |       |plugin      |
    |--------------------------------------+------+------+-------+------------|
    |                                      |      |      |       |PPAPI-host  |
    |browser-plugin-freshplayer-pepperflash|I:9   |1135  |contrib|NPAPI-plugin|
    |                                      |      |      |       |adapter for |
    |                                      |      |      |       |pepperflash |
    +-------------------------------------------------------------------------+


    Astuce

    Bien que l’utilisation des paquets Debian ci-dessus soit plus
    facile, il est toujours possible d’installer vous-même des
    greffons de navigateur en installant les fichiers « *.so » dans
    les répertoires de greffons, (par exemple, « /usr/lib/iceweasel/
    plugins/ ») et en redémarrant le navigateur.

    Certains sites web refusent les connexions en se basant sur la
    chaîne « user-agent » de votre navigateur. Vous pouvez contourner
    cette situation en usurpant la chaîne user-agent. Vous pouvez le
    faire, par exemple, en ajoutant la ligne suivante dans les
    fichiers de configuration de l’utilisateur tels que « ~/.gnome2/
    epiphany/mozilla/epiphany/user.js » ou « ~/.mozilla/firefox/
    *.default/user.js » :

    user_pref{"general.useragent.override","Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0)"};

    Vous pouvez aussi ajouter et réinitialiser cette variable en
    entrant l’URL « about:config » et en faisant un clic-droit pour
    afficher son contenu.

    Attention
   
    Usurper la chaîne user-agent peut provoquer de mauvais effets de
    bord avec Java.

%

6.2. Le système de courrier électronique

    Attention

    Si vous êtes sur le point de configurer le serveur de courrier
    pour échanger directement du courrier avec Internet, vous feriez
    mieux de lire ce document élémentaire.

    The mail system involves many server programs and many client
    programs running on multiple hosts. From the functionality, there
    are 3 types of mail agent programs:

      * L'agent de transport de courriel (MTA, voir Section 6.3,
        « Agent de transport de courrier électronique (« MTA ») »)
        est un programme dont le but est le transfert de courriels
        entre différents hôtes.

      * L'agent de distribution de courriel (MDA, voir Section 6.6,
        « Agent de distribution du courriel (MDA) avec filtre ») est
        un programme dont le but est la distribution de messages dans
        les boîtes aux lettres des utilisateurs au sein d'un hôte.

      * Le client de messagerie (MUA, ou encore email client, voir
        Section 6.4, « Agent de courrier électronique de
        l’utilisateur (« MUA ») ») est le programme utilisé pour
        créer des messages et accéder aux messages reçus.

    Note

    Les exemples de configuration suivants ne sont valables que pour
    une station de travail mobile typique avec des connexions
    internet de type grand public.

%

6.2.1. Bases du courrier électronique

    Un courrier électronique est composé de trois parties :
    l’enveloppe, l’en-tête et le corps du message.

    Les renseignements « To » et « From » de l’enveloppe sont
    utilisés par le SMTP pour délivrer le courrier électronique
    (« From » dans l’enveloppe indique l’adresse de rebond,
    « From_ », etc.).

    Les renseignements « To » et « From » de l’en-tête sont affichés
    par le client de messagerie (même s’ils sont généralement
    identiques à ceux de l’enveloppe, ce n’est pas toujours le cas).

    Le client de messagerie (MUA) a besoin d’interpréter l’en-tête du
    message et les données du corps en utilisant les Multipurpose
    Internet Mail Extensions (MIME) pour gérer le type de données et
    l’encodage du contenu.

%

6.2.2. Bases du service de courrier électronique moderne

    De manière à limiter les risques dus au problème des pourriels
    (courriels non désirés et non sollicités), de nombreux
    fournisseurs d’accès à Internet qui fournissent une connexion
    Internet pour le grand public mettent en place des
    contre-mesures.

      * Le service smarthost pour l’envoi des messages de leurs
        clients utilise le port (587) défini dans la rfc4409 avec le
        service de mot de passe (SMTP AUTH) défini dans la rfc4954.

      * La connexion sur le port SMTP (25) depuis les machines de
        leur réseau interne (à l’exception de la sortie propre aux
        serveurs du FAI lui-même) vers Internet est bloquée.

      * La connexion au serveur de courrier entrant du FAI sur le
        port SMTP (25) depuis certaines machines d’une source externe
        douteuse est bloquée. (La connexion des machines dans la
        plage d’adresses IP dynamiques utilisée par les clients du
        réseau commuté ou d’autres connexions Internet grand public
        sont les premières à être bloquées).

      * Anti-spam techniques such as DomainKeys Identified Mail
        (DKIM), Sender_Policy_Framework (SPF), and Domain-based
        Message Authentication, Reporting and Conformance (DMARC) are
        widely used for the email filtering.

      * Le service de DomainKeys Identified Mail peut être fourni
        pour vos messages envoyés par l’intermédiaire du smarthost.

      * The smarthost may rewrite the source mail address to your
        mail account on the smarthost.

    Lors de la configuration de votre système de courrier
    électronique, ou lors de la résolution de problèmes de diffusion
    de courrier, vous devez tenir compte de ces nouvelles
    limitations.

    Attention
   
    It is not realistic to run SMTP server on consumer grade network
    to send mail directly to the remote host reliably.

    Attention
   
    It is not realistic to expect a single smarthost to send mails of
    unrelated source mail addresses to the remote host reliably.

    Attention

    A mail may be rejected by any host en route to the destination
    quietly. Making your mail to appear as authentic as possible is
    the only way to send a mail to the remote host reliably.

    À la lumière de cette situation hostile d’Internet, certains
    fournisseurs de service de courrier électronique comme Yahoo.com
    et Gmail.com offrent un service de courrier électronique sécurisé
    que l’on peut utiliser depuis n’importe où sur Internet en
    utilisant Transport Layer Security (TLS) et son prédécesseur,
    Secure Sockets Layer (SSL).

      * Le service de smarthost sur le port 465 avec l’obsolète SMTP
        sur SSL (SMTPS).

      * Le service de smarthost sur le port 587 avec STARTTLS.

      * Le courrier électronique entrant est accessible par le port
        TLS/POP3 (995) par POP3.

    Pour simplifier, supposons que le smarthost situé à
    « smtp.hostname.dom » exige l’authentification SMTP et utilise le
    port de soumission de messages (587) avec STARTTLS dans le texte
    qui suit.

6.2.3. Stratégie de configuration du courrier électronique pour une
station de travail

    La configuration de courrier électronique la plus simple est que
    le courrier électronique soit émis vers le smarthost du
    fournisseur d’accès et reçu du serveur POP3 de ce fournisseur
    d’accès par le MUA (consultez Section 6.4, « Agent de courrier
    électronique de l’utilisateur (« MUA ») ») lui-même. Ce type de
    configuration est courant avec les MUA entièrement basés sur une
    interface graphique tels que icedove(1), evolution(1), etc. Si
    vous devez filtrer le courriel selon son type, vous utiliserez
    les fonctions de filtrage du MUA. Dans ce cas, l’agent de
    transport du courrier (MTA) local (consultez Section 6.3, « Agent
    de transport de courrier électronique (« MTA ») ») n’aura que la
    distribution locale à effectuer (dans la mesure où expéditeur et
    destinataire sont sur le même hôte).

    Veuillez noter que le système Debian est un système
    multi-utilisateur. Même si vous êtes l'unique usager, il y a de
    nombreux logiciels exécutés en tant que superutilisateur qui
    peuvent vous envoyer un courriel.

    La configuration de courriel de remplacement est que le courriel
    soit envoyé via un MTA local vers le smarthost du FAI et reçu du
    serveur POP3 du FAI par le logiciel de récupération du courriel
    (consultez Section 6.5, « Utilitaire de récupération et de
    rediffusion du courriel distant ») vers une boîte à lettres
    locale. Si vous avez besoin de filtrer le courriel en fonction de
    son type, vous pouvez utiliser un MDA (agent de distribution du
    courriel) avec filtres (consultez Section 6.6, « Agent de
    distribution du courriel (MDA) avec filtre ») pour filtrer les
    courriels vers des boîtes à lettres séparées. Ce type de
    configuration est populaire avec un simple MUA en mode console
    tel que mutt(1), mew(1), etc., bien que ce soit possible avec
    n’importe quel MUA (consultez Section 6.4, « Agent de courrier
    électronique de l’utilisateur (« MUA ») »). Dans ce cas, le MTA
    local (consultez Section 6.3, « Agent de transport de courrier
    électronique (« MTA ») ») doit faire à la fois la diffusion vers
    le smarthost et la diffusion locale). Comme les stations de
    travail mobiles n’ont pas de nom de domaine pleinement qualifié
    (FDQN) valable, vous devez configurer le MTA local pour masquer
    et simuler le nom de courrier local réel pour le courriel sortant
    afin d’éviter des erreurs de distribution (consultez
    Section 6.3.3, « Configuration de l’adresse de courriel »).

    Astuce

    Vous pourrez avoir envie de configurer MUA/MDA afin d’utiliser
    Maildir pour stocker les messages de courrier électronique
    quelque part dans l’arborescence de votre répertoire personnel.

%

6.3. Agent de transport de courrier électronique (« MTA »)

    Pour une station de travail normale le choix habituel pour
    l’agent de transport du courrier électronique (MTA) est soit le
    paquet exim4-*, soit postfix. C’est vraiment laissé à votre
    choix.

    Tableau 6.3. Liste des paquets liés à l’agent de transport du
    courrier pour une station de travail

    +---------------------------------------------------------------+
    |      paquet      |popcon|taille|         description          |
    |------------------+------+------+------------------------------|
    |                  |V:342,|      |Agent de transport de courrier|
    |exim4-daemon-light|I:367 |1493  |électronique Exim4 (MTA : par |
    |                  |      |      |défaut dans Debian)           |
    |------------------+------+------+------------------------------|
    |exim4-base        |V:349,|1704  |Documentation d’Exim4 (texte) |
    |                  |I:377 |      |et fichiers communs           |
    |------------------+------+------+------------------------------|
    |exim4-doc-html    |I:1   |3662  |Documentation d’Exim4 (html)  |
    |------------------+------+------+------------------------------|
    |exim4-doc-info    |I:1   |624   |Documentation d’Exim4 (info)  |
    |------------------+------+------+------------------------------|
    |                  |V:145,|      |Agent de transport de courrier|
    |postfix           |I:160 |4182  |électronique Postfix (MTA :   |
    |                  |      |      |remplacement)                 |
    |------------------+------+------+------------------------------|
    |postfix-doc       |I:9   |4444  |Documentation de Postfix      |
    |                  |      |      |(html+texte)                  |
    |------------------+------+------+------------------------------|
    |                  |V:5,  |      |Implémentation de l’API Cyrus |
    |sasl2-bin         |I:19  |428   |SASL (complément à Postfix    |
    |                  |      |      |pour SMTP AUTH)               |
    |------------------+------+------+------------------------------|
    |cyrus-sasl2-doc   |I:1   |575   |Cyrus SASL - documentation    |
    +---------------------------------------------------------------+


    Bien que suivant le nombre de votes popcon exim4-* semble de
    beaucoup plus populaire que postfix, cela ne signifie pas que
    postfix n’est pas populaire chez les développeurs de Debian. Le
    système de serveur de Debian utilise à la fois exim4 et postfix.
    L’analyse des en-têtes de courriels vers les listes de diffusion
    par les développeurs principaux de Debian montre aussi que ces
    deux MTA ont la même popularité.

    Les paquets exim4-* sont connus pour consommer très peu de
    mémoire et avoir une configuration très souple. Le paquet postfix
    est connu pour être compact, rapide, simple et sûr. Les deux sont
    livrés avec une riche documentation, sont d’aussi bonne qualité
    et ont une aussi bonne licence.

    Il existe dans l’archive Debian un grand choix de paquets
    d’agents de transport du courrier électronique (MTA) avec des
    possibilités et des objectifs différents.

    Tableau 6.4. Liste des choix de paquets Debian d’agent de
    transport du courrier électronique (MTA)

    +---------------------------------------------------------------+
    |      paquet      |popcon|taille|   possibilités et objectif   |
    |------------------+------+------+------------------------------|
    |exim4-daemon-light|V:342,|1493  |complet                       |
    |                  |I:367 |      |                              |
    |------------------+------+------+------------------------------|
    |postfix           |V:145,|4182  |complet (sécurité)            |
    |                  |I:160 |      |                              |
    |------------------+------+------+------------------------------|
    |exim4-daemon-heavy|V:7,  |1643  |complet (souple)              |
    |                  |I:8   |      |                              |
    |------------------+------+------+------------------------------|
    |sendmail-bin      |V:14, |1854  |complet (uniquement lorsque   |
    |                  |I:15  |      |vous serez déjà familiarisé)  |
    |------------------+------+------+------------------------------|
    |nullmailer        |V:7,  |479   |limité, pas de courrier local |
    |                  |I:10  |      |                              |
    |------------------+------+------+------------------------------|
    |ssmtp             |V:8,  |2     |limité, pas de courrier local |
    |                  |I:11  |      |                              |
    |------------------+------+------+------------------------------|
    |courier-mta       |V:0,  |2416  |très complet (interface web,  |
    |                  |I:0   |      |etc.)                         |
    |------------------+------+------+------------------------------|
    |masqmail          |V:0,  |337   |léger                         |
    |                  |I:0   |      |                              |
    |------------------+------+------+------------------------------|
    |esmtp             |V:0,  |128   |léger                         |
    |                  |I:0   |      |                              |
    |------------------+------+------+------------------------------|
    |                  |V:0,  |      |léger (extension de           |
    |esmtp-run         |I:0   |32    |compatibilité avec sendmail   |
    |                  |      |      |vers esmtp)                   |
    |------------------+------+------+------------------------------|
    |msmtp             |V:5,  |547   |léger                         |
    |                  |I:10  |      |                              |
    |------------------+------+------+------------------------------|
    |                  |V:3,  |      |léger (extension de           |
    |msmtp-mta         |I:4   |86    |compatibilité avec sendmail   |
    |                  |      |      |vers msmtp)                   |
    +---------------------------------------------------------------+


%

6.3.1. Configuration d’exim4

    Attention

    Configuring exim4 to send the Internet mail via multiple
    corresponding smarthosts for multiple source email addresses is
    non-trivial. Please set up exim4 only for a single email address
    for the system programs such as popcon and cron and set up msmtp
    for multiple source email addresses for the user programs such as
    mutt.

    Pour le courrier d’Internet par l’intermédiaire d’un smarthost,
    vous (re)configurerez les paquets exim4-* comme suit :

    $ sudo /etc/init.d/exim4 stop
    $ sudo dpkg-reconfigure exim4-config

    Choisir « envoi via relais (« smarthost ») - réception SMTP ou
    fetchmail » : pour « Configuration du serveur de courriel ».

    Définir « Nom de courriel du système » à sa valeur par défaut qui
    est le nom pleinement qualifié (FQDN, consultez Section 5.1.1,
    « Résolution du nom d’hôte »).

    Définir « Liste d’adresses IP où Exim sera en attente de
    connexions SMTP entrantes » à sa valeur par défaut qui est
    « 127.0.0.1 ; ::1 ».

    Supprimer le contenu de « Autres destinations dont le courriel
    doit être accepté ».

    Supprimer le contenu de « Machines à relayer ».

    Définir « Nom réseau ou adresse IP du système « smarthost » » à
    « smtp.hostname.dom:587 ».

    Sélectionner « <Non> » pour « Faut-il cacher le nom local de
    courriel dans les courriels sortants ? ». (Utiliser plutôt « /etc
    /email-addresses » comme dans Section 6.3.3, « Configuration de
    l’adresse de courriel »).

    Donner à « Faut-il optimiser les requêtes DNS (connexion à la
    demande)) ? » l’une des réponses suivantes :

      * « Non » si le système est connecté à Internet au démarrage.
   
      * « Oui » si le système n’est pas connecté à Internet au
        démarrage.

    Définir « Méthode de distribution du courrier local : » à
    « Format « mbox » dans /var/mail ».

    Sélectionner « Oui » pour « Faut-il séparer la configuration dans
    plusieurs fichiers ? ».

    Créer les entrées de mots de passe pour le smarthost en éditant
    «  /etc/exim4/passwd.client ».

    $ sudo vim /etc/exim4/passwd.client
     ...
    $ cat /etc/exim4/passwd.client
    ^smtp.*\.nommachine\.dom:nomutilisateur@nommachine.dom:motdepasse

    Lancer exim4 par la commande suivante :

    $ sudo /etc/init.d/exim4 start

    Le nom de machine dans « /etc/exim4/passwd.client » ne doit pas
    être un alias. Vérifiez le nom de machine réel comme suit :

    $ host smtp.hostname.dom
    smtp.hostname.dom is an alias for smtp99.hostname.dom.
    smtp99.hostname.dom has address 123.234.123.89

    J’utilise une expression rationnelle dans « /etc/exim4/
    passwd.client » pour contourner le problème d’alias. SMTP AUTH
    fonctionne probablement même dans le cas où le FAI déplace la
    machine pointée par l’alias.

    Vous pouvez mettre à jour vous-même la configuration d’exim4 de
    la façon suivante :

      * Mettre à jour les fichiers de configuration d’exim4 dans « /
        etc/exim4/ ».

          + Créer « /etc/exim4/exim4.conf.localmacros » pour
            configurer les macros et éditer « /etc/exim4/
            exim4.conf.template » (configuration en un seul fichier).
   
          + Créer de nouveaux fichiers ou éditer des fichiers
            existants dans les sous-répertoires de « /etc/exim4/
            exim4.conf.d » (configuration séparée en plusieurs
            fichiers).

      * Lancer « invoke-rc.d exim4 reload ».

    Veuillez lire le guide officiel se trouvant à « /usr/share/doc/
    exim4-base/README.Debian.gz » et update-exim4.conf(8).

    Attention

    Le lancement d’exim4 est long si on a choisi « Non » (valeur par
    défaut) à la demande « Faut-il optimiser les requêtes DNS
    (connexion à la demande) ? » lors de la configuration debconf et
    que le système n’est pas connecté à Internet lors du démarrage.

    Avertissement
   
    L’utilisation de mot de passe en texte non chiffré n’est pas
    sécurisée, même si votre FAI le permet.

    Astuce

    Même si l’utilisation de SMTP avec STARTTLS sur le port 587 est
    préférable, certains FAI utilisent encore l’obsolète SMTPS (SSL
    sur le port 465). Exim4, depuis la version 4.77, permet
    d’utiliser ce protocole SMTPS obsolète autant en tant que client
    que serveur.

    Astuce

    Si vous recherchez un MTA léger qui respecte « /etc/aliases »
    pour votre PC de bureau, vous devriez envisager de configurer 
    exim4(8) avec « QUEUERUNNER='queueonly' », « QUEUERUNNER=
    'nodaemon' », etc. dans « /etc/default/exim4 ».

%

6.3.2. Configuration de postfix avec SASL

    Pour utiliser le courrier électronique d’Internet par
    l’intermédiaire d’un smarthost, vous devrez d’abord lire la
    documentation postfix et les pages de manuel importantes.

    Tableau 6.5. Liste des pages de manuel importantes de postfix

    +---------------------------------------------------------------+
    | commande  |                     fonction                      |
    |-----------+---------------------------------------------------|
    |postfix(1) |Programme de contrôle de postfix                   |
    |-----------+---------------------------------------------------|
    |postconf(1)|Utilitaire de configuration de postfix             |
    |-----------+---------------------------------------------------|
    |postconf(5)|Paramètres de configuration de postfix             |
    |-----------+---------------------------------------------------|
    |postmap(1) |Maintenance des tables de consultation de postfix  |
    |-----------+---------------------------------------------------|
    |postalias  |Maintenance de la base de données des alias de     |
    |(1)        |postfix                                            |
    +---------------------------------------------------------------+


    Vous (re)configurez les paquets postfix et sasl2-bin comme suit :

    $ sudo /etc/init.d/postfix stop
    $ sudo dpkg-reconfigure postfix

    Choisir « Internet avec smarthost ».

    Définissez « machine de relais SMTP (blanc pour aucun): » à « 
    [smtp.hostname.dom]:587 » et configurez-le de la manière
    suivante :

    $ sudo postconf -e 'smtp_sender_dependent_authentication = yes'
    $ sudo postconf -e 'smtp_sasl_auth_enable = yes'
    $ sudo postconf -e 'smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd'
    $ sudo postconf -e 'smtp_sasl_type = cyrus'
    $ sudo vim /etc/postfix/sasl_passwd

    Créez les entrées de mots de passe pour le smarthost

    $ cat /etc/postfix/sasl_passwd
    [smtp.hostname.dom]:587     nomutilisateur:motdepasse
    $ sudo postmap hush:/etc/postfix/sasl_passwd

    Lancez postfix comme suit :

    $ sudo /etc/init.d/postfix start

    Ici, l’utilisation de « [ » et « ] » dans le dialogue de
    dpkg-reconfigure et « /etc/postfix/sasl_passwd » permet de
    s’assurer de ne pas vérifier l’enregistrement MX mais d’utiliser
    directement le nom exact de la machine indiquée. Consultez
    « Enabling SASL authentication in the Postfix SMTP client » dans
    « /usr/share/doc/postfix/html/SASL_README.html ».

%

6.3.3. Configuration de l’adresse de courriel

    Il existe plusieurs fichiers de configuration de l’adresse de
    courriel pour l’acheminement du courriel, sa diffusion et les
    agents d’utilisateur.

    Tableau 6.6. Liste des fichiers de configuration liés aux
    adresses de courriel

    +---------------------------------------------------------------+
    |    fichier    |     fonction     |        application         |
    |---------------+------------------+----------------------------|
    |               |nom de machine par|Spécifique à Debian,        |
    |/etc/mailname  |défaut pour le    |mailname(5)                 |
    |               |courrier (sortant)|                            |
    |---------------+------------------+----------------------------|
    |/etc/          |usurpation du nom |Spécifique à exim(8),       |
    |email-addresses|de machine pour le|exim4-config_files(5)       |
    |               |courriel sortant  |                            |
    |---------------+------------------+----------------------------|
    |               |usurpation du nom |Spécifique à postfix(1)     |
    |/etc/postfix/  |de machine pour le|specific, activé après      |
    |generic        |courriel sortant  |l’exécution de la commande  |
    |               |                  |postmap(1).                 |
    |---------------+------------------+----------------------------|
    |               |alias du nom de   |général, activé après       |
    |/etc/aliases   |compte pour le    |l’exécution de la commande  |
    |               |courrier entrant  |newaliases(1).              |
    +---------------------------------------------------------------+


    Le nom de courriel ( mailname » dans le fichier « /etc/mailname »
    est habituellement un nom de domaine entièrement qualifié (FQDN)
    qui est résolu vers l’une des adresses IP de la machine. Pour les
    stations de travail mobiles qui n’ont pas de nom de machine
    pouvant être résolu par une adresse IP, définissez ce mailname à
    la valeur donnée par « hostname -f ». (C’est un choix sûr et qui
    fonctionne à la fois avec exim4-* et postfix.)

    Astuce

    Le contenu de « /etc/mailname » est utilisé par de nombreux
    programmes autres que les MTA pour définir leur comportement par
    défaut. Pour mutt, définissez les variables « hostname » et
    « from » dans le fichier ~/muttrc pour passer outre la valeur de 
    mailname. Pour les programmes du paquet devscripts, comme bts(1)
    et dch(1), exportez les variables d’environnement
    « $DEBFULLNAME » et « $DEBEMAIL » afin de passer outre cette
    définition.

    Astuce

    Le paquet popularity-contest envoie normalement un courriel
    depuis le compte de l’administrateur avec un nom de domaine
    pleinement qualifié (FDQN). Vous devez définir MAILFROM dans /etc
    /popularity-contest.conf comme c’est décrit dans le fichier /usr/
    share/popularity-contest/default.conf. Sinon, votre courriel sera
    rejeté par le serveur SMTP sur « smarthost ». Bien que ce soit
    fastidieux, cette approche est plus sûre que la réécriture par le
    MTA de l’adresse source pour tous les courriels en provenance de
    l’administrateur (« root ») et devrait être utilisé pour les
    autres démons et les scripts des tâches planifiées (« cron ».

    Lors de la définition de mailname avec la valeur donnée par
    « hostname -f », l’usurpation de l’adresse source du courrier par
    le MTA peut être réalisée par l’intermédiaire :

      * du fichier « /etc/email-addresses » pour exim4(8) comme
        expliqué dans exim4-config_files(5)
   
      * du fichier « /etc/postfix/generic » pour postfix(1) comme
        expliqué dans generic(5)

    Pour postfix, les étapes suivantes sont nécessaires :

    # postmap hash:/etc/postfix/generic
    # postconf -e 'smtp_generic_maps = hash:/etc/postfix/generic'
    # postfix reload

    Vous pouvez tester la configuration de l’adresse de courriel de
    la manière suivante :

      * exim(8) avec les options -brw, -bf, -bF, -bV, …
   
      * postmap(1) avec l’option -q

    Astuce

    Il existe, avec Exim, un certain nombre de programmes utilitaires
    tels qu’exiqgrep(8) et exipick(8). Consultez « dpkg -L exim4-base
    |grep man8/ » pour les commandes disponibles.

%

6.3.4. Opération de base du MTA

    Il y a quelques opérations de base du MTA. Certaines peuvent être
    effectuées à l’aide de l’interface de compatibilité avec sendmail
    (1).

    Tableau 6.7. Liste des opérations de base du MTA

    +---------------------------------------------------------------+
    | commande |   commande   |             description             |
    |   exim   |   postfix    |                                     |
    |----------+--------------+-------------------------------------|
    |          |              |lire les courriels depuis l’entrée   |
    |sendmail  |sendmail      |standard et les classer pour la      |
    |          |              |diffusion (-bm)                      |
    |----------+--------------+-------------------------------------|
    |          |              |afficher la file d’attente des       |
    |mailq     |mailq         |courriels avec leur état et leur     |
    |          |              |identifiant de file d’attente        |
    |          |              |(« queue ID ») (-bp)                 |
    |----------+--------------+-------------------------------------|
    |newaliases|newaliases    |initialiser la base de données des   |
    |          |              |alias (-I)                           |
    |----------+--------------+-------------------------------------|
    |exim4 -q  |postqueue -f  |supprimer les courriels en attente   |
    |          |              |(-q)                                 |
    |----------+--------------+-------------------------------------|
    |          |postsuper -r  |                                     |
    |exim4 -qf |ALL deferred; |supprimer tous les courriels         |
    |          |postqueue -f  |                                     |
    |----------+--------------+-------------------------------------|
    |          |postsuper -r  |                                     |
    |exim4 -qff|ALL; postqueue|supprimer tous les courriels gelés   |
    |          |-f            |                                     |
    |----------+--------------+-------------------------------------|
    |exim4 -Mg |postsuper -h  |geler un message d’après son         |
    |queue_id  |queue_id      |identifiant de file d’attente        |
    |----------+--------------+-------------------------------------|
    |exim4 -Mrm|postsuper -d  |supprimer un message d’après son     |
    |queue_id  |queue_id      |identifiant de file d’attente        |
    |----------+--------------+-------------------------------------|
    |N/A       |postsuper -d  |supprimer tous les messages.         |
    |          |ALL           |                                     |
    +---------------------------------------------------------------+


    Astuce
   
    Ce peut être une bonne idée de supprimer tous les messages à
    l’aide d’un script placé dans « /etc/ppp/ip-up.d/* ».

%

6.4. Agent de courrier électronique de l’utilisateur (« MUA »)

    Si vous vous abonnez à une liste de diffusion relative à Debian,
    ce peut être une bonne idée d’utiliser un MUA tel que mutt ou mew
    qui sont le standard de fait pour le participant et sont connus
    pour se comporter comme on le souhaite.

    Tableau 6.8. Liste d’agents de courrier électronique de
    l’utilisateur (MUA)

    +---------------------------------------------------------------+
    |  paquet   |popcon|taille|                type                 |
    |-----------+------+------+-------------------------------------|
    |           |V:31, |      |programme X avec une interface       |
    |evolution  |I:229 |475   |graphique (GNOME 3, suite            |
    |           |      |      |« groupware »)                       |
    |-----------+------+------+-------------------------------------|
    |           |V:57, |      |programme X avec une interface       |
    |thunderbird|I:138 |165180|graphique (GNOME 2, version démarquée|
    |           |      |      |de Mozilla Thunderbird)              |
    |-----------+------+------+-------------------------------------|
    |kmail      |V:34, |18011 |programme X avec une interface       |
    |           |I:88  |      |graphique (KDE)                      |
    |-----------+------+------+-------------------------------------|
    |           |V:37, |      |programme de terminal en mode        |
    |mutt       |I:313 |7056  |caractère, probablement utilisé avec |
    |           |      |      |vim                                  |
    |-----------+------+------+-------------------------------------|
    |mew        |V:0,  |2325  |programme de terminal en mode        |
    |           |I:0   |      |caractères sous (x)emacs             |
    +---------------------------------------------------------------+


%

6.4.1. Le MUA de base — Mutt

    Configurez « ~/.muttrc » comme suit afin d’utiliser mutt comme
    agent utilisateur de courrier électronique (MUA) en conjonction
    avec vim.

    #
    # Fichier de configuration de l’utilisateur pour prendre le pas sur /etc/Muttrc
    #
    # modifier l'adresse électronique d'origine
    set use_from
    set hostname=example.dom
    set from="Prénom Nom <prenom-nom@example.dom>"
    set signature="~/.signature"

    # vim : « gq » pour reformater les citations
    set editor="vim -c 'set tw=72 et ft=mail’"

    # « mutt » utilise Inbox, alors que « mutt -y » donne la liste des boîtes de messagerie
    set mbox_type=Maildir     # utiliser le format Maildir de qmail pour créer les mbox
    set mbox=~/Mail           # conserver toutes les boîtes de messagerie dans $HOME/Mail/
    set spoolfile=+Inbox      # message délivré vers $HOME/Mail/Inbox
    set record=+Outbox        # sauvegarder les messages envoyés vers $HOME/Mail/Outbox
    set postponed=+Postponed  # garder les messages ajournés dans $HOME/Mail/postponed
    set move=no               # ne pas déplacer les messages lus de Inbox vers mbox
    set quit=ask-yes          # ne pas quitter avec seulement « q »
    set delete=yes            # toujours effacer sans confirmation à la fin
    set fcc_clear             # garder les messages envoyés non chiffrés

    # boîtes de messagerie dans Maildir (mise à jour automatique)
    mailboxes `cd ~/Mail; /bin/ls -1|sed -e 's/^/+/' | tr "\n" " "`
    unmailboxes Maillog *.ev-summary

    ## par défaut
    #set index_format="%4C %Z %{%b %d} %-15.15L (%4l) %s"
    ## index des enfilades avec expéditeurs (quand elles sont cachées)
    set index_format="%4C %Z %{%b %d} %-15.15n %?M?(#%03M)&(%4l)? %s"

    ## par défaut
    #set folder_format="%2C %t %N %F %2l %-8.8u %-8.8g %8s %d %f"
    ## simplement les noms de dossier
    set folder_format="%2C %t %N %f"

    Ajoutez ce qui suit dans « /etc/mailcap » ou « ~/.mailcap » afin
    d’afficher le courriel en HTML et les attachements en ligne de
    documents MS Word.

    text/html; lynx -force_html %s; needsterminal;
    application/msword; /usr/bin/antiword '%s'; copiousoutput; description="Microsoft Word Text"; nametemplate=%s.doc

    Astuce

    Mutt peut être utilisé comme client IMAP et comme convertisseur
    de format de boîtes à lettres. Vous pouvez marquer les messages
    avec « t", "T », etc. Ces messages marqués peuvent être copiés
    avec « ;C » entre différentes boîtes à lettres et supprimés à
    l’aide de « ;d » en une seule action.

%

6.4.2. Advanced MUA — Mutt + msmtp

    Mutt can be configured to use multiple source email addresses
    with multiple corresponding smarthosts using msmtp.

    Astuce

    Msmtp is a sendmail emulator which allows to be installed along
    another sendmail emulator which provides the /usr/sbin/sendmail
    command. So you can leave your system mail to be exim4 or
    postfix.

    Let's think about supporting 3 email addresses as an example:

      * "My Name1 <myaccount1@gmail.com>"

      * "My Name2 <myaccount2@gmail.com>"

      * "My Name3 <myaccount3@example.org>"

    Here is an example of ~/.muttrc customization supporting 3
    smarthosts for 3 different source email addresses.

    set use_from
    set from="My Name3 <myaccount3@example.org>"
    set reverse_name
    alternates myaccount1@gmail\.com|myaccount1@gmail\.com|myaccount3@example\.org

    # ...

    # MACRO
    macro compose "1" "<edit-from>^UMy Name1 \<myaccount1@gmail.com\>\n"
    macro compose "2" "<edit-from>^UMy Name2 \<myaccount2@gmail.com\>\n"
    macro compose "3" "<edit-from>^UMy Name3 \<myaccount3@example.org\>\n"

    send2-hook '~f myaccount1@gmail.com' "set sendmail = '/usr/bin/msmtp --read-envelope-from'"
    send2-hook '~f myaccount2@gmail.com' "set sendmail = '/usr/bin/msmtp --read-envelope-from'"
    send2-hook '~f myaccount3@example.org' "set sendmail = '/usr/bin/msmtp --read-envelope-from'"

    # ...

    Let's install msmtp-gnome and set ~/.msmtprc as follows.

    defaults
    logfile ~/.msmtp.log
    domain myhostname.example.org
    tls on
    tls_starttls on
    tls_certcheck on
    tls_trust_file /etc/ssl/certs/ca-certificates.crt
    auth on
    port 587
    auto_from

    account myaccount1@gmail.com
    host smtp.gmail.com
    from  myaccount1@gmail.com
    user  myaccount1@gmail.com

    account myaccount2@gmail.com
    host smtp.gmail.com
    from  myaccount2@gmail.com
    user  myaccount2@gmail.com

    account myaccount3@example.org
    host mail.example.org
    from  myaccount3@example.org
    user  myaccount3@example.org

    account default : myaccount3@example.org

    Then, add password data into the Gnome key ring. For example:

     $ secret-tool store --label=msmtp \
         host smtp.gmail.com \
         service smtp \
         user myaccount1@gmail.com
     ...

    Astuce

    If you don't wish to use the Gnome key ring, you can install
    msmtp package instead and add an entry such as "password
    secret123" to each account in ~/.msmtprc. See memtp documentation
    for more.

%

6.5. Utilitaire de récupération et de rediffusion du courriel distant

    Plutôt que d'utiliser un client de messagerie pour accéder à des
    courriels distants afin de les traiter manuellement, vous
    pourriez vouloir automatiser ce processus afin d'avoir tous les
    courriels distribués à la machine hôte. L'utilitaire de
    récupération et de transfert est l'outil qu’il vous faut.

    Bien que fetchmail(1) ait été le standard de fait pour la
    récupération du courriel sur GNU/Linux, l’auteur préfère
    maintenant getmail(1). Si vous désirez rejeter du courriel avant
    de le télécharger pour économiser de la bande passante,
    mailfilter ou mpop peuvent être utiles. Quels que soient les
    utilitaires de récupération du courrier électronique utilisés,
    c’est une bonne idée de configurer le système afin de diffuser
    les courriels récupérés à un MDA, tel que maildrop, par
    l’intermédiaire d’un tube.

    Tableau 6.9. Listes des utilitaires de récupération et de
    rediffusion du courriel

    +---------------------------------------------------------------+
    |  paquet  |popcon|taille|             description              |
    |----------+------+------+--------------------------------------|
    |fetchmail |V:5,  |814   |récupération du courriel (POP3, APOP, |
    |          |I:17  |      |IMAP) (ancien)                        |
    |----------+------+------+--------------------------------------|
    |getmail   |V:1,  |30    |récupération du courriel (POP3, IMAP4 |
    |          |I:6   |      |et SDPS) (simple, sûr et fiable)      |
    |----------+------+------+--------------------------------------|
    |          |V:0,  |      |récupération du courriel (POP3) avec  |
    |mailfilter|I:0   |291   |une possibilité de filtrage par       |
    |          |      |      |expressions rationnelles              |
    |----------+------+------+--------------------------------------|
    |mpop      |V:0,  |400   |récupération du courriel (POP3) et MDA|
    |          |I:0   |      |avec possibilité de filtrage          |
    +---------------------------------------------------------------+


%

6.5.1. configuration de getmail

    La configuration de getmail(1) est décrite dans la documentation
    de getmail. voici ma configuration permettant l’accès à plusieurs
    comptes POP3 en tant qu’utilisateur.

    Créez « /usr/local/bin/getmails » comme suit :

    #!/bin/sh
    set -e
    if [ -f $HOME/.getmail/running ]; then
      echo "getmail est déjà en fonctionnement... (dans le cas contraire, supprimer $HOME/.getmail/running)" >&2
      pgrep -l "getmai[l]"
      exit 1
    else
      echo "getmail n'a pas tourné... " >&2
    fi
    if [ -f $HOME/.getmail/stop ]; then
      echo "ne pas lancer getmail ... (dans le cas contraire, supprimer $HOME/.getmail/stop)" >&2
      exit
    fi
    if [ "x$1" = "x-l" ]; then
      exit
    fi
    rcfiles="/usr/bin/getmail"
    for fichier in $HOME/.getmail/config/* ; do
      rcfiles="$rcfiles --rcfile $fichier"
    done
    date -u > $HOME/.getmail/running
    eval "$rcfiles $@"
    rm $HOME/.getmail/running

    Configurez-le comme suit :

    $ sudo chmod 755 /usr/local/bin/getmails
    $ mkdir -m 0700 $HOME/.getmail
    $ mkdir -m 0700 $HOME/.getmail/config
    $ mkdir -m 0700 $HOME/.getmail/log

    Créez les fichiers de configuration « $HOME/.getmail/config/
    pop3_name » pour chacun des comptes POP3 comme suit :

    [retriever]
    type = SimplePOP3SSLRetriever
    server = pop.example.com
    username =  nom_pop3@example.com
    password = <votre_mot-de-passe>

    [destination]
    type = MDA_external
    path = /usr/bin/maildrop
    unixfrom = True

    [options]
    verbose = 0
    delete = True
    delivered_to = False
    message_log = ~/.getmail/log/nom_pop3.log

    Configurez-le comme suit :

    $ chmod 0600 $HOME/.getmail/config/*

    Programmez « /usr/local/bin/getmails » pour qu’il soit lancé
    toutes les 15 minutes avec cron(8) en exécutant « sudo crontab -e
    -u <nom_utilisateur> » et en ajoutant l’entrée cron de
    l’utilisateur suivante :

    5,20,35,50 * * * * /usr/local/bin/getmails --quiet

    Astuce

    Les problèmes d’accès POP3 peuvent ne pas venir de getmail.
    Certains services POP3 gratuits courants violent le protocole
    POP3 et leur filtre de SPAM peut ne pas être parfait. Par
    exemple, ils peuvent effacer les messages juste après la commande
    RETR et avant de recevoir la commande DELE et peuvent mettre en
    quarantaines des messages dans la boîte à lettres des Spam. Vous
    pourrez minimiser les dommages en les configurant de manière à
    archiver les messages auxquels ils ont accédé et non les
    supprimer. Consultez aussi « Certains courriels n’ont pas été
    téléchargés ».

%

6.5.2. configuration de fetchmail

    La configuration de fetchmail(1) est effectuée par
    l’intermédiaire de « /etc/default/fetchmail », « /etc/
    fetchmailrc » et « $HOME/.fetchmailrc ». Consultez les exemples
    dans « /usr/share/doc/fetchmail/examples/fetchmailrc.example ».

%

6.6. Agent de distribution du courriel (MDA) avec filtre

    La plupart des programmes de MTA tels que postfix et exim4
    fonctionnent comme des MDA (agent de distribution du courriel,
    « mail delivery agent »). Il existe des MDA spécialisés ayant des
    possibilités de filtrage.

    Bien que procmail(1) ait été le standard de fait comme MDA sous
    GNU/Linux, l’auteur préfère maintenant maildrop(1). Quel que soit
    l’utilitaire de filtrage utilisé, c’est une bonne idée que de
    configurer le système pour distribuer le courriel filtré vers une
    Maildir de style qmail.

    Tableau 6.10. Liste de MDA avec filtrage

    +---------------------------------------------------------------+
    | paquet  |  popcon  |taille|            description            |
    |---------+----------+------+-----------------------------------|
    |procmail |V:40,     |300   |MDA avec filtrage (ancien)         |
    |         |I:277     |      |                                   |
    |---------+----------+------+-----------------------------------|
    |mailagent|V:0, I:5  |1356  |MDA avec filtre en Perl            |
    |---------+----------+------+-----------------------------------|
    |maildrop |V:0, I:2  |1141  |MDA avec langage de filtrage       |
    |         |          |      |structuré                          |
    +---------------------------------------------------------------+


%

6.6.1. configuration de maildrop

    La configuration de maildrop(1) est décrite dans la documentation
    de maildropfilter. Voici un exemple de configuration pour « $HOME
    /.mailfilter » :

    # Configuration locale
    MAILROOT="$HOME/Mail"
    # configurer conformément au contenu de /etc/mailname
    MAILHOST="example.dom"
    logfile $HOME/.maildroplog

    # les règles sont faites pour que la dernière valeur prenne le pas sur la précédente.

    # messages de liste de diffusion ?
    if (     /^Precedence:.*list/:h || /^Precedence:.*bulk/:h )
    {
        # règles pour les messages de liste de diffusion
        # boîte à lettres par défaut pour les messages de liste de diffusion
        MAILBOX="Inbox-list"
        # boîte à lettres par défaut pour les messages de debian.org
        if ( /^(Sender|Resent-From|Resent-Sender): .*debian.org/:h )
        {
            MAILBOX="service.debian.org"
        }
        # boîte à lettres par défaut pour les messages de bugs.debian.org (BTS)
        if ( /^(Sender|Resent-From|Resent-sender): .*@bugs.debian.org/:h )
        {
            MAILBOX="bugs.debian.org"
        }
        # boîte à lettres pour chaque liste de diffusion proprement configurée avec « List-Id: truc » ou « List-Id: ...<truc.bidule> »
        if ( /^List-Id: ([^<]*<)?([^<>]*)>?/:h )
        {
            MAILBOX="$MATCH2"
        }
    }
    else
    {
        # règles pour les messages ne provenant pas de liste de diffusion
        # boîte à lettres de courrier entrant par défaut
        MAILBOX="Inbox-unusual"
        # local mails
        if ( /Envelope-to: .*@$MAILHOST/:h )
        {
            MAILBOX="Inbox-local"
        }
        # Messages en HTML (99% d'indésirables)
        if ( /DOCTYPE html/:b ||\
             /^Content-Type: text\/html/ )
        {
            MAILBOX="Inbox-html"
        }
        # règle de liste noire pour les indésirables
        if ( /^X-Advertisement/:h ||\
             /^Subject:.*BUSINESS PROPOSAL/:h ||\
             /^Subject:.*URGENT.*ASISSTANCE/:h ||\
             /^Subject: *I NEED YOUR ASSISTANCE/:h )
        {
            MAILBOX="Inbox-trash"
        }
        # règle de liste blanche pour les messages normaux
        if ( /^From: .*@debian.org/:h ||\
             /^(Sender|Resent-From|Resent-Sender): .*debian.org/:h ||\
             /^Subject: .*(debian|bug|PATCH)/:h )
        {
            MAILBOX="Inbox"
        }
        # règle de liste blanche pour les messages relatifs au BTS
        if ( /^Subject: .*Bug#.*/:h ||\
             /^(To|Cc): .*@bugs.debian.org/:h )
        {
            MAILBOX="bugs.debian.org"
        }
        # règle de liste blanche pour les messages « getmails » de cron
        if ( /^Subject: Cron .*getmails/:h )
        {
            MAILBOX="Inbox-getmails"
        }
    }

    # vérifier l'existence de $MAILBOX
    `test -d $MAILROOT/$MAILBOX`
    if ( $RETURNCODE == 1 )
    {
        # créer la boîte à lettres au format maildir pour $MAILBOX
        `maildirmake $MAILROOT/$MAILBOX`
    }
    # délivrer vers le répertoire maildir $MAILBOX
    to "$MAILROOT/$MAILBOX/"
    exit

    Avertissement

    À l’inverse de procmail, maildrop ne crée pas automatiquement les
    répertoires maildir manquants. Vous devez les créer vous-même à
    l’avance en utilisant maildirmake(1) comme cela a été fait pour
    « $HOME/.mailfilter » dans l’exemple.

%

6.6.2. configuration de procmail

    Voici une configuration équivalente avec « $HOME/.procmailrc »
    pour procmail(1) :

    MAILDIR=$HOME/Maildir
    DEFAULT=$MAILDIR/Inbox/
    LOGFILE=$MAILDIR/Maillog
    # courriels qui apparaissent clairement mauvais : les mettre dans X-trash et quitter
    :0
    * 1^0 ^X-Advertisement
    * 1^0 ^Subject:.*BUSINESS PROPOSAL
    * 1^0 ^Subject:.*URGENT.*ASISSTANCE
    * 1^0 ^Subject: *I NEED YOUR ASSISTANCE
    X-trash/

    # Diffusion des messages des listes de diffusion
    :0
    * 1^0 ^Precedence:.*list
    * 1^0 ^Precedence:.*bulk
    * 1^0 ^List-
    * 1^0 ^X-Distribution:.*bulk
    {
    :0
    * 1^0 ^Return-path:.*debian-devel-admin@debian.or.jp
    jp-debian-devel/

    :0
    * ^Resent-Sender.*debian-user-request@lists.debian.org
    debian-user/

    :0
    * ^Resent-Sender.*debian-devel-request@lists.debian.org
    debian-devel/

    :0
    * ^Resent-Sender.*debian-announce-request@lists.debian.org
    debian-announce

    :0
    mailing-list/
    }

    :0
    Inbox/

%

6.6.3. Redistribuer le contenu d’une « mbox »

    Vous devrez distribuer vous-même les courriels se trouvant des
    les boîtes à lettres de votre répertoire personnel depuis « /var/
    mail/<nom_utilisateur> » si votre répertoire personnel est plein
    et que procmail(1) échoue. Après avoir fait de la place sur le
    disque dans votre répertoire personnel, lancez ce qui suit :

    # /etc/init.d/${MAILDAEMON} stop
    # formail -s procmail </var/mail/<nom_utilisateur>
    # /etc/init.d/${MAILDAEMON} start

%

6.7. serveur POP3/IMAP4

    Si vous voulez faire tourner un serveur privé sur votre réseau
    local, vous pouvez envisager de faire tourner un serveur POP3 /
    IMAP4 pour la distribution du courrier électronique aux clients
    du réseau local.

    Tableau 6.11. Liste de serveurs POP3/IMAP4

    +---------------------------------------------------------------+
    |   paquet   |popcon|taille|type|          description          |
    |------------+------+------+----+-------------------------------|
    |            |V:2,  |      |    |serveur de courriel Courier -  |
    |courier-pop |I:2   |308   |POP3|serveur POP3 (format maildir   |
    |            |      |      |    |uniquement)                    |
    |------------+------+------+----+-------------------------------|
    |cyrus-pop3d |V:0,  |160   |POP3|système de courrier Cyrus      |
    |            |I:0   |      |    |(prise en charge de POP3)      |
    |------------+------+------+----+-------------------------------|
    |            |V:3,  |      |    |serveur de courriel Courier -  |
    |courier-imap|I:4   |589   |IMAP|serveur IMAP (format maildir   |
    |            |      |      |    |uniquement)                    |
    |------------+------+------+----+-------------------------------|
    |cyrus-imapd |V:1,  |484   |IMAP|système de courrier Cyrus      |
    |            |I:1   |      |    |(prise en charge d’IMAP)       |
    +---------------------------------------------------------------+


%

6.8. Le serveur et les utilitaires d’impression

    In the old Unix-like system, the BSD Line printer daemon (lpd)
    was the standard and the standard print out format of the classic
    free software was PostScript (PS). Some filter system was used
    along with Ghostscript to enable printing to the non-PostScript
    printer. See Section 11.4.1, « Ghostscript ».

    In the modern Debian system, the Common UNIX Printing System
    (CUPS) is the de facto standard and the standard print out format
    of the modern free software is Portable Document Format (PDF).

    The CUPS uses Internet Printing Protocol (IPP). The IPP is now
    supported by other OSs such as Windows XP and Mac OS X and has
    became new cross-platform de facto standard for remote printing
    with bi-directional communication capability.

    Grâce à la fonctionnalité d’autoconversion dépendante du format
    du fichier du système CUPS, passer simplement les données à la
    commande lpr devrait créer la sortie imprimable souhaitée. (Dans
    CUPS, lpr peut être activé en installant la paquet cups-bsd).

    Le système Debian possède certains paquets notables de serveurs
    et d’utilitaires d’impression :

    Tableau 6.12. Liste des serveurs et utilitaires d’impression.

    +----------------------------------------------------------------+
    |         paquet          |popcon|taille|   port   | description |
    |-------------------------+------+------+----------+-------------|
    |                         |V:3,  |      |imprimante|BSD lpr/lpd  |
    |lpr                      |I:4   |362   |(515)     |(démon       |
    |                         |      |      |          |d’impression)|
    |-------------------------+------+------+----------+-------------|
    |lprng                    |V:1,  |3064  |, ,       |, ,          |
    |                         |I:1   |      |          |(Amélioré)   |
    |-------------------------+------+------+----------+-------------|
    |                         |      |      |          |Serveur      |
    |cups                     |V:140,|1141  |IPP (631) |Internet     |
    |                         |I:395 |      |          |d’impression |
    |                         |      |      |          |CUPS         |
    |-------------------------+------+------+----------+-------------|
    |                         |      |      |          |commandes    |
    |                         |      |      |          |d’impression |
    |                         |      |      |          |System V pour|
    |                         |      |      |          |CUPS : lp(1),|
    |cups-client              |V:56, |493   |, ,       |lpstat(1),   |
    |                         |I:454 |      |          |lpoptions(1),|
    |                         |      |      |          |cancel(1),   |
    |                         |      |      |          |lpmove(8),   |
    |                         |      |      |          |lpinfo(8),   |
    |                         |      |      |          |lpadmin(8), …|
    |-------------------------+------+------+----------+-------------|
    |                         |      |      |          |commandes    |
    |                         |      |      |          |d’impression |
    |                         |V:36, |      |          |BSD pour     |
    |cups-bsd                 |I:385 |122   |, ,       |CUPS : lpr(1)|
    |                         |      |      |          |, lpq(1),    |
    |                         |      |      |          |lprm(1), lpc |
    |                         |      |      |          |(8)          |
    |-------------------------+------+------+----------+-------------|
    |                         |V:100,|      |Non       |pilotes      |
    |printer-driver-gutenprint|I:372 |937   |applicable|d’impression |
    |                         |      |      |          |pour CUPS    |
    +----------------------------------------------------------------+


    Astuce
   
    Vous pouvez configurer le système CUPS en pointant votre
    navigateur web sur « http://localhost:631/ ».

%

6.9. Le serveur et les utilitaires d’accès à distance (SSH)

    SSH, le « Secure SHell », est la manière sûre de se connecter au
    travers d’Internet. Une version libre de SSH, appelée OpenSSH,
    est disponible sous Debian sous forme des paquets openssh-client
    et openssh-server.

    Tableau 6.13. Liste des serveurs et des utilitaires d’accès à
    distance

    +--------------------------------------------------------------------------+
    |        paquet        |popcon|taille|        outil         | description  |
    |----------------------+------+------+----------------------+--------------|
    |                      |      |      |                      |client de     |
    |openssh-client        |V:803,|4298  |ssh(1)                |l’interpréteur|
    |                      |I:996 |      |                      |de commandes  |
    |                      |      |      |                      |sécurisé      |
    |----------------------+------+------+----------------------+--------------|
    |                      |      |      |                      |serveur de    |
    |openssh-server        |V:690,|1567  |sshd(8)               |l’interpréteur|
    |                      |I:834 |      |                      |de commandes  |
    |                      |      |      |                      |sécurisé      |
    |----------------------+------+------+----------------------+--------------|
    |                      |      |      |                      |demande à     |
    |                      |      |      |                      |l’utilisateur |
    |ssh-askpass-fullscreen|V:0,  |42    |ssh-askpass-fullscreen|une phrase de |
    |                      |I:0   |      |(1)                   |passe pour    |
    |                      |      |      |                      |ssh-add       |
    |                      |      |      |                      |(GNOME2)      |
    |----------------------+------+------+----------------------+--------------|
    |                      |      |      |                      |demande à     |
    |                      |      |      |                      |l’utilisateur |
    |ssh-askpass           |V:3,  |106   |ssh-askpass(1)        |une phrase de |
    |                      |I:34  |      |                      |passe pour    |
    |                      |      |      |                      |ssh-add (X    |
    |                      |      |      |                      |natif)        |
    +--------------------------------------------------------------------------+


    Attention

    Consultez Section 4.7.3, « Mesures de sécurité supplémentaires
    pour Internet » si votre serveur SSH est accessible depuis
    Internet.

    Astuce

    Utilisez le programme screen(1) pour qu’un processus de
    l’interpréteur de commandes distant survive à une interruption de
    la connexion (consultez Section 9.1, « Le programme screen »).

%

6.9.1. Bases de SSH

    Avertissement
   
    Il ne faut pas que « /etc/ssh/sshd_not_to_be_run » soit présent
    si l’on souhaite faire tourner le serveur OpenSSH.

    SSH possède deux protocoles d’identification :

    Tableau 6.14. Liste des protocoles et méthodes d’authentification SSH

    +--------------------------------------------------------------------+
    |Protocole|            Méthode SSH            |     description      |
    |   SSH   |                                   |                      |
    |---------+-----------------------------------+----------------------|
    |         |                                   |authentification de   |
    |SSH-1    |« RSAAuthentication »              |l’utilisateur basée   |
    |         |                                   |sur une clé d’identité|
    |         |                                   |RSA                   |
    |---------+-----------------------------------+----------------------|
    |         |                                   |authentification de   |
    |, ,      |« RhostsAuthentication »           |l’hôte basée sur      |
    |         |                                   |« .rhosts » (non sûre,|
    |         |                                   |désactivée)           |
    |---------+-----------------------------------+----------------------|
    |         |                                   |authentification de   |
    |         |                                   |l’hôte basée sur      |
    |, ,      |« RhostsRSAAuthentication »        |« .rhosts » combinée  |
    |         |                                   |avec clé d’hôte RSA   |
    |         |                                   |(désactivée)          |
    |---------+-----------------------------------+----------------------|
    |         |                                   |authentification par  |
    |, ,      |« ChallengeResponseAuthentication »|« challenge-response »|
    |         |                                   |RSA                   |
    |---------+-----------------------------------+----------------------|
    |, ,      |« PasswordAuthentication »         |authentification basée|
    |         |                                   |sur un mot de passe   |
    |---------+-----------------------------------+----------------------|
    |         |                                   |authentification de   |
    |SSH-2    |« PubkeyAuthentication »           |l’utilisateur basée   |
    |         |                                   |sur une clé publique  |
    |---------+-----------------------------------+----------------------|
    |         |                                   |authentification de la|
    |         |                                   |machine basée sur « ~ |
    |         |                                   |/.rhosts » ou « /etc/ |
    |, ,      |« HostbasedAuthentication »        |hosts.equiv » combiné |
    |         |                                   |à une authentification|
    |         |                                   |par la clé publique de|
    |         |                                   |la machine            |
    |         |                                   |(désactivée)          |
    |---------+-----------------------------------+----------------------|
    |, ,      |« ChallengeResponseAuthentication »|authentification par  |
    |         |                                   |« challenge-response »|
    |---------+-----------------------------------+----------------------|
    |, ,      |« PasswordAuthentication »         |authentification basée|
    |         |                                   |sur un mot de passe   |
    +--------------------------------------------------------------------+


    Attention
   
    Faites attention à ces différences si vous utilisez un système
    autre que Debian.

    Consultez « /usr/share/doc/ssh/README.Debian.gz", ssh(1), sshd(8)
    , ssh-agent(1), et ssh-keygen(1) pour davantage d’informations.

    Les fichiers suivants sont les fichiers de configuration
    importants :

    Tableau 6.15. Liste des fichiers de configuration de SSH

    +---------------------------------------------------------------+
    |  fichier de   |    description du fichier de configuration    |
    | configuration |                                               |
    |---------------+-----------------------------------------------|
    |/etc/ssh/      |valeurs par défauts des paramètres du client   |
    |ssh_config     |SSH, consultez ssh_config(5).                  |
    |---------------+-----------------------------------------------|
    |/etc/ssh/      |valeurs par défauts des paramètres du serveur  |
    |sshd_config    |SSH, consultez sshd_config(5).                 |
    |---------------+-----------------------------------------------|
    |~/.ssh/        |clés publiques SSH par défaut utilisées pour se|
    |authorized_keys|connecter à ce compte sur ce serveur SSH       |
    |---------------+-----------------------------------------------|
    |~/.ssh/identity|clé secrète SSH-1 RSA de l’utilisateur         |
    |---------------+-----------------------------------------------|
    |~/.ssh/id_rsa  |clé secrète SSH-2 RSA de l’utilisateur         |
    |---------------+-----------------------------------------------|
    |~/.ssh/id_dsa  |clé secrète SSH-2 DSA de l’utilisateur         |
    +---------------------------------------------------------------+


    Astuce
   
    Consultez ssh-keygen(1), ssh-add(1) et ssh-agent(1) pour la
    manière d’utiliser les clés publiques et secrètes de SSH.

    Astuce
   
    Assurez-vous de la validité de la configuration en testant la
    connexion. En cas de problème, utilisez « ssh -v ».

    Astuce
   
    Vous pouvez changer la phrase de passe pour chiffrer les clés
    secrètes SSH plus tard avec « ssh-keygen -p ».

    Astuce

    Vous pouvez ajouter des options aux entrées de « ~/.ssh/
    authorized_keys » afin de limiter les accès à certaines machines
    et les commandes autorisées. Consultez sshd(8) pour obtenir plus
    de renseignements.

    Ce qui suit permettra de démarrer un connexion ssh(1) depuis un
    client :

    Tableau 6.16. Liste d’exemples de démarrage du client SSH

    +---------------------------------------------------------------+
    |               commande               |      description       |
    |--------------------------------------+------------------------|
    |ssh                                   |connexion avec le mode  |
    |nomutilisateur@nommachine..domaine.ext|par défaut              |
    |--------------------------------------+------------------------|
    |ssh -v                                |connexion avec le mode  |
    |nomutilisateur@nommachine..domaine.ext|par défaut et les       |
    |                                      |messages de débogage    |
    |--------------------------------------+------------------------|
    |ssh -1                                |forcer la connexion avec|
    |nomutilisateur@nommachine..domaine.ext|SSH version 1           |
    |--------------------------------------+------------------------|
    |ssh -1 -o RSAAuthentication=no -l     |forcer l’utilisation    |
    |nomutilisateur@nommachine..domaine.ext|d’un mot de passe avec  |
    |                                      |SSH version 1           |
    |--------------------------------------+------------------------|
    |ssh -o PreferredAuthentications=      |forcer l’utilisation    |
    |password -l                           |d’un mot de passe avec  |
    |nomutilisateur@nommachine.domaine.ext |SSH version 2           |
    +---------------------------------------------------------------+


    If you use the same user name on the local and the remote host,
    you can eliminate typing "username@". Even if you use different
    user name on the local and the remote host, you can eliminate it
    using "~/.ssh/config". For Debian Salsa service with account name
    "foo-guest", you set "~/.ssh/config" to contain the following.

    Host salsa.debian.org people.debian.org
        User foo-guest

    Pour l’utilisateur, ssh(1) fonctionne comme un telnet(1)
    intelligent et plus sûr. Contrairement à la commande telnet, la
    commande ssh ne s'arrête pas avec le caractère d’échappement de
    telnet (valeur initiale par défaut Ctrl-]).

%

6.9.2. Redirection de port pour un tunnel SMTP/POP3

    Pour mettre en place un tube pour se connecter au port 25 du
    serveur-distant depuis le port 4025 de localhost, et au port 110
    du serveur-distant depuis le port 4110 de localhost au travers de
    ssh, exécutez ce qui suit sur la machine locale :

    # ssh -q -L 4025:serveur-distant:25 4110:serveur-distant:110 nomutilisateur@serveur-distant

    C’est une manière sécurisée d’effectuer une connexion à des
    serveurs SMTP / POP3 par Internet. Définissez l’entrée
    « AllowTcpForwarding » à « yes » dans « /etc/ssh/sshd_config »
    sur la machine distante.

%

6.9.3. Se connecter sans mot de passe distant

    On peut éviter de devoir se souvenir des mots de passe des
    systèmes distants en utilisant « RSAAuthentication » (protocole
    SSH-1) ou « PubkeyAuthentication » (protocole SSH-2).

    Sur le système distant, définissez les entrées respectives
    suivantes : « RSAAuthentication yes » ou« PubkeyAuthentication
    yes » dans « /etc/ssh/sshd_config ».

    Générez ensuite localement les clés d’identification et installez
    la clé publique sur le système distant en faisant ce qui suit :

      * « RSAAuthentication » : clé RSA pour SSH-1 (obsolète parce
        qu’il a été remplacé).

    $ ssh-keygen
    $ cat .ssh/identity.pub | ssh user1@remote "cat - >>.ssh/authorized_keys"

      * « PubkeyAuthentication » : clé RSA pour SSH-2

    $ ssh-keygen -t rsa
    $ cat .ssh/id_rsa.pub | ssh user1@remote "cat - >>.ssh/authorized_keys"

      * « PubkeyAuthentication » : clé DSA pour SSH-2 (obsolète parce
        qu’elle est lente).

    $ ssh-keygen -t dsa
    $ cat .ssh/id_dsa.pub | ssh user1@remote "cat - >>.ssh/authorized_keys"

    Astuce

    L’utilisation de clés DSA pour SSH-2 est obsolète parce que la
    clé est plus courte et lente. Il n’y a plus de raison de
    contourner le brevet de RSA en utilisant DSA parce qu’il est
    arrivé en fin de validité. DSA signifie Digital Signature
    Algorithm (Algorithme de signature numérique) et il est lent.
    Consultez aussi DSA-1571-1.

    Note

    Pour que « HostbasedAuthentication » fonctionne avec SSH-2, vous
    devez définir les paramètres de « HostbasedAuthentication » à
    « yes » à la fois dans le fichier « /etc/ssh/sshd_config » sur la
    machine serveur et dans le fichier « /etc/ssh/ssh_config » ou « ~
    /.ssh/config » sur la machine client.

%

6.9.4. Clients SSH exotiques

    Il existe quelques clients SSH libres disponibles pour d’autres
    plateformes.

    Tableau 6.17. Liste des clients SSH libres pour d’autres
    plateformes

    +---------------------------------------------------------------+
    |environnement|               programme SSH libre               |
    |-------------+-------------------------------------------------|
    |Windows      |puTTY (http://www.chiark.greenend.org.uk/        |
    |             |~sgtatham/putty/) (GPL)                          |
    |-------------+-------------------------------------------------|
    |Windows      |SSH sous cygwin (http://www.cygwin.com/) (GPL)   |
    |(cygwin)     |                                                 |
    |-------------+-------------------------------------------------|
    |Macintosh    |macSSH (http://www.macssh.com/) (GPL)            |
    |Classic      |                                                 |
    |-------------+-------------------------------------------------|
    |Mac OS X     |OpenSSH ; utilise ssh dans l’application Terminal|
    |             |(GPL)                                            |
    +---------------------------------------------------------------+


%

6.9.5. Configurer ssh-agent

    Il est plus sûr de protéger les clés secrètes de votre
    authentification SSH avec une phrase de passe. Si la phrase de
    passe n’a pas été définie, utilisez « ssh-keygen -p » pour le
    faire.

    Placez votre clé publique SSH (par exemple « ~/.ssh/id_rsa.pub »)
    dans « ~/.ssh/authorized_keys » sur la machine distante en
    utilisant une connexion basée sur un mot de passe comme décrit
    ci-dessus.

    $ ssh-agent bash
    $ ssh-add ~/.ssh/id_rsa
    Enter passphrase for /home/<nom_utilisateur>/.ssh/id_rsa:
    Identity added: /home/<nom_utilisateur>/.ssh/id_rsa (/home/<nom_utilisateur>/.ssh/id_rsa)

    Il n’y a plus besoin de mot de passe distant, à partir de
    maintenant, pour la commande suivante :

    $ scp toto <utilisateur>@remote.host:toto

    Pressez ^D pour quitter la session de l’agent ssh.

    Pour le serveur X, le script de démarrage normal de Debian
    exécute ssh-agent comme processus-père. Vous n’aurez donc à
    exécuter ssh-add qu’une seule fois. Pour davantage
    d’informations, veuillez lire ssh-agent(1) et ssh-add(1).

%

6.9.6. Comment arrêter le système distant par SSH

    Vous devez protéger le processus qui effectue « shutdown -h now »
    (consultez Section 1.1.8, « Comment arrêter le système ») de
    l’arrêt de SSH en utilisant la commande at(1) (consultez
    Section 9.3.13, « Planifier des tâches qui s’exécutent une fois »
    ) comme suit :

    # echo "shutdown -h now" | at now

    Lancer « shutdown -h now » dans une sessionscreen(1) (consultez
    Section 9.1, « Le programme screen ») est une autre manière
    d’effectuer la même chose.

%

6.9.7. Résoudre les problèmes avec SSH

    Si vous rencontrez des problèmes, vérifiez les permissions des
    fichiers de configuration et lancez ssh avec l’option « -v ».

    Utilisez l’option « -p » si vous êtes administrateur et que vous
    rencontrez des problèmes avec un pare-feu. Cela évite
    l’utilisation des ports 1 — 1023 du serveur.

    Si les connexions ssh vers un site distant s’arrêtent subitement
    de fonctionner, cela peut être suite à des bidouilles de
    l’administrateur, le plus probablement un changement de
    « host_key » pendant une maintenance du système. Après s’être
    assuré que c’est bien le cas et que personne n’essaie de se faire
    passer pour la machine distante par une habile bidouille, on peut
    se reconnecter en supprimant sur la machine locale l’entrée
    « host_key » de « ~/.ssh/known_hosts ».

%

6.10. Autres serveurs d’applications réseau

    Voici d’autres serveurs d’applications réseau :

    Tableau 6.18. Liste d’autres serveurs d’applications réseau

    +---------------------------------------------------------------+
    |     paquet      |popcon|taille|protocole|     description     |
    |-----------------+------+------+---------+---------------------|
    |telnetd          |V:1,  |115   |TELNET   |Serveur TELNET       |
    |                 |I:3   |      |         |                     |
    |-----------------+------+------+---------+---------------------|
    |telnetd-ssl      |V:0,  |170   |, ,      |, , (prise en charge |
    |                 |I:0   |      |         |de SSL)              |
    |-----------------+------+------+---------+---------------------|
    |nfs-kernel-server|V:38, |342   |NFS      |Partage de fichiers  |
    |                 |I:79  |      |         |UNIX                 |
    |-----------------+------+------+---------+---------------------|
    |                 |V:102,|      |         |Partage de fichiers  |
    |samba            |I:159 |16629 |SMB      |et d’imprimantes     |
    |                 |      |      |         |Windows              |
    |-----------------+------+------+---------+---------------------|
    |                 |V:2,  |      |         |Partage de fichiers  |
    |netatalk         |I:3   |2077  |ATP      |et d’imprimantes     |
    |                 |      |      |         |Apple/Mac (AppleTalk)|
    |-----------------+------+------+---------+---------------------|
    |                 |V:24, |      |         |Téléchargement       |
    |proftpd-basic    |I:32  |488   |FTP      |généraliste de       |
    |                 |      |      |         |fichiers             |
    |-----------------+------+------+---------+---------------------|
    |apache2          |V:246,|610   |HTTP     |Serveur Web          |
    |                 |I:315 |      |         |généraliste          |
    |-----------------+------+------+---------+---------------------|
    |                 |V:13, |      |         |Serveur mandataire   |
    |squid            |I:15  |8385  |, ,      |(proxy) web          |
    |                 |      |      |         |généraliste          |
    |-----------------+------+------+---------+---------------------|
    |squid3           |V:4,  |240   |, ,      |, ,                  |
    |                 |I:10  |      |         |                     |
    |-----------------+------+------+---------+---------------------|
    |bind9            |V:52, |1063  |DNS      |adresses IP des      |
    |                 |I:65  |      |         |autres machines      |
    |-----------------+------+------+---------+---------------------|
    |isc-dhcp-server  |V:18, |1471  |DHCP     |adresse IP du client |
    |                 |I:54  |      |         |lui-même             |
    +---------------------------------------------------------------+


    Le protocole « Common Internet File System Protocol » (CIFS) est
    le même protocole que Server Message Block (SMB), il est
    largement utilisé par Microsoft Windows.

    Astuce
   
    Consultez Section 4.5.2, « Le système de gestion centralisée
    moderne » pour l’intégration de systèmes de type serveur.

    Astuce

    La résolution de nom d’hôte est normalement fournie par le
    serveur DNS. Pour l’affectation dynamique d’adresse IP hôte par
    DHCP, le DNS dynamique peut être configuré pour la résolution de
    nom d’hôte en utilisant bind9 et isc-dhcp-server comme décrit sur
    la page DDNS du wiki Debian.

    Astuce

    L’utilisation d’un serveur mandataire tel que squid est bien plus
    efficace pour économiser de la bande passante que l’utilisation
    d’un serveur miroir local comportant tout le contenu de l’archive
    Debian.

%

6.11. Autres clients d’applications réseau

    Voici d’autres clients d’applications réseau :

    Tableau 6.19. Liste de clients d’applications réseau

    +---------------------------------------------------------------+
    |    paquet     |popcon|taille|protocole|      description      |
    |---------------+------+------+---------+-----------------------|
    |netcat         |I:41  |16    |TCP/IP   |couteau de l’armée     |
    |               |      |      |         |Suisse pour TCP/IP     |
    |---------------+------+------+---------+-----------------------|
    |               |V:794,|      |         |binaire Secure Socket  |
    |openssl        |I:993 |1465  |SSL      |Layer (SSL) et outils  |
    |               |      |      |         |de chiffrement associés|
    |---------------+------+------+---------+-----------------------|
    |stunnel4       |V:5,  |507   |, ,      |enrobeur SSL universel |
    |               |I:17  |      |         |                       |
    |---------------+------+------+---------+-----------------------|
    |telnet         |V:65, |163   |TELNET   |Client TELNET          |
    |               |I:904 |      |         |                       |
    |---------------+------+------+---------+-----------------------|
    |telnet-ssl     |V:0,  |210   |, ,      |, , (prise en charge de|
    |               |I:3   |      |         |SSL)                   |
    |---------------+------+------+---------+-----------------------|
    |nfs-common     |V:181,|768   |NFS      |Partage de fichiers    |
    |               |I:343 |      |         |UNIX                   |
    |---------------+------+------+---------+-----------------------|
    |               |V:16, |      |         |Client de partage de   |
    |smbclient      |I:174 |2016  |SMB      |fichiers et imprimantes|
    |               |      |      |         |MS Windows             |
    |---------------+------+------+---------+-----------------------|
    |               |      |      |         |commande de montage et |
    |cifs-utils     |V:32, |299   |, ,      |de démontage de        |
    |               |I:123 |      |         |fichiers MS Windows    |
    |               |      |      |         |distants               |
    |---------------+------+------+---------+-----------------------|
    |ftp            |V:18, |137   |FTP      |Client FTP             |
    |               |I:282 |      |         |                       |
    |---------------+------+------+---------+-----------------------|
    |lftp           |V:6,  |2255  |, ,      |, ,                    |
    |               |I:39  |      |         |                       |
    |---------------+------+------+---------+-----------------------|
    |ncftp          |V:3,  |1339  |, ,      |client FTP plein écran |
    |               |I:22  |      |         |                       |
    |---------------+------+------+---------+-----------------------|
    |wget           |V:288,|3477  |HTTP et  |téléchargement web     |
    |               |I:988 |      |FTP      |                       |
    |---------------+------+------+---------+-----------------------|
    |curl           |V:151,|426   |, ,      |, ,                    |
    |               |I:548 |      |         |                       |
    |---------------+------+------+---------+-----------------------|
    |axel           |V:0,  |216   |, ,      |accélérateur de        |
    |               |I:4   |      |         |téléchargement         |
    |---------------+------+------+---------+-----------------------|
    |               |      |      |         |accélérateur de        |
    |aria2          |V:2,  |1854  |, ,      |téléchargement avec    |
    |               |I:19  |      |         |prise en charge de     |
    |               |      |      |         |BitTorrent et Metalink |
    |---------------+------+------+---------+-----------------------|
    |bind9-host     |V:382,|365   |DNS      |host(1) de bind9,      |
    |               |I:948 |      |         |« Priority: standard » |
    |---------------+------+------+---------+-----------------------|
    |dnsutils       |V:64, |256   |, ,      |dig(1) de bind,        |
    |               |I:517 |      |         |« Priority: standard » |
    |---------------+------+------+---------+-----------------------|
    |isc-dhcp-client|V:231,|686   |DHCP     |obtenir une adresse IP |
    |               |I:979 |      |         |                       |
    |---------------+------+------+---------+-----------------------|
    |ldap-utils     |V:14, |718   |LDAP     |obtenir des données    |
    |               |I:75  |      |         |d’un serveur LDAP      |
    +---------------------------------------------------------------+


%

6.12. Le diagnostic des démons du système

    Le programme telnet permet la connexion manuelle aux démons du
    système et leur diagnostic.

    Pour tester le service POP3 brut, essayez ce qui suit :

    $ telnet mail.nom_isp.net pop3

    Pour tester le service POP3, ayant TLS/SSL activé, de certains
    fournisseurs d’accès Internet (FAI), vous devrez avoir un client
    telnet ayant TLS/SSL activé en utilisant l’un des paquets
    telnet-ssl ou openssl.

    $ telnet -z ssl pop.gmail.com 995

    $ openssl s_client -connect pop.gmail.com:995

    Les RFC suivantes proposent les connaissances nécessaires pour
    chaque démon :

    Tableau 6.20. Liste des RFC courantes

    +---------------------------------------------------------------+
    |   RFC    |                    description                     |
    |----------+----------------------------------------------------|
    |rfc1939 et|service POP3                                        |
    |rfc2449   |                                                    |
    |----------+----------------------------------------------------|
    |rfc3501   |service IMAP4                                       |
    |----------+----------------------------------------------------|
    |rfc2821   |service SMTP                                        |
    |(rfc821)  |                                                    |
    |----------+----------------------------------------------------|
    |rfc2822   |Format de fichier de courrier électronique          |
    |(rfc822)  |                                                    |
    |----------+----------------------------------------------------|
    |rfc2045   |Extensions multifonctions du courrier Internet      |
    |          |« Multipurpose Internet Mail Extensions (MIME) »    |
    |----------+----------------------------------------------------|
    |rfc819    |service DNS                                         |
    |----------+----------------------------------------------------|
    |rfc2616   |service HTTP                                        |
    |----------+----------------------------------------------------|
    |rfc2396   |définition d’une URI                                |
    +---------------------------------------------------------------+


    L’utilisation des ports est décrite dans « /etc/services ».

Chapitre 7. Le système X Window

    Avertissement
   
    Ce chapitre est obsolète car il est basé sur Debian 7.0 (1Wheezy)
    sortit en 2013.

    Le système X Window d’un système Debian est basé sur les sources
    de X.Org.

%

7.1. Paquets clés

    Il existe certains paquets (ou métapaquets) prévus pour faciliter
    l’installation.

    Tableau 7.1. Liste des (méta)paquets clés pour X Window

    +---------------------------------------------------------------+
    |   (méta)paquet   |popcon|taille|         description          |
    |------------------+------+------+------------------------------|
    |                  |      |      |bibliothèques X, un serveur X,|
    |xorg              |I:457 |52    |un jeu de polices et un groupe|
    |                  |      |      |de clients et d’utilitaires X |
    |                  |      |      |de base (métapaquet)          |
    |------------------+------+------+------------------------------|
    |xserver-xorg      |V:66, |238   |suite complète de serveurs X  |
    |                  |I:492 |      |avec leur configuration       |
    |------------------+------+------+------------------------------|
    |xbase-clients     |I:26  |46    |assortiment de clients X      |
    |                  |      |      |divers (méta-paquet)          |
    |------------------+------+------+------------------------------|
    |                  |V:372,|      |infrastructure de système de  |
    |x11-common        |I:755 |308   |fichiers pour le système X    |
    |                  |      |      |Window                        |
    |------------------+------+------+------------------------------|
    |xorg-docs         |I:6   |2036  |diverses documentations pour  |
    |                  |      |      |la suite logicielle X.Org     |
    |------------------+------+------+------------------------------|
    |                  |V:54, |      |créer le menu Debian avec     |
    |menu              |I:197 |1509  |toutes les applications       |
    |                  |      |      |prenant en charge un menu     |
    |------------------+------+------+------------------------------|
    |                  |      |      |convertir la structure de     |
    |menu-xdg          |V:31, |27    |menus de Debian vers la       |
    |                  |I:109 |      |structure de menus xdg de     |
    |                  |      |      |freedesktop.org               |
    |------------------+------+------+------------------------------|
    |                  |V:229,|      |utilitaires pour intégrer     |
    |xdg-utils         |I:521 |327   |l’environnement de bureau     |
    |                  |      |      |fourni par freedesktop.org    |
    |------------------+------+------+------------------------------|
    |task-gnome-desktop|I:175 |9     |environnement de bureau       |
    |                  |      |      |standard GNOME (métapaquet)   |
    |------------------+------+------+------------------------------|
    |task-kde-desktop  |I:66  |6     |cœur de l’environnement de    |
    |                  |      |      |bureau KDE (métapaquet)       |
    |------------------+------+------+------------------------------|
    |task-xfce-desktop |I:106 |9     |environnement de bureau léger |
    |                  |      |      |Xfce (métapaquet)             |
    |------------------+------+------+------------------------------|
    |task-lxde-desktop |I:35  |9     |environnement de bureau léger |
    |                  |      |      |LXDE (métapaquet)             |
    |------------------+------+------+------------------------------|
    |                  |      |      |Fluxbox : paquet pour un      |
    |                  |V:2,  |      |gestionnaire X window         |
    |fluxbox           |I:9   |3860  |hautement configurable et     |
    |                  |      |      |faible consommateur de        |
    |                  |      |      |ressources                    |
    +---------------------------------------------------------------+


    Pour les bases de X, veuillez vous référer à X(7)et le LDP
    XWindow-User-HOWTO.

%

7.2. Configurer l’environnement de bureau

    Un environnement de bureau est habituellement constitué de la
    combinaison d’un gestionnaire X Window, d’un gestionnaire de
    fichiers et d’une suite compatible de programmes utilitaires.

    Vous pouvez configurer un environnement de bureau complet tel que
    GNOME, KDE, Xfce ou LXDE depuis le menu des tâches d’aptitude.

    Astuce

    Sous les environnements Debian unstable et testing, le menu
    Tâches peut être désynchronisé de l’état des dernières
    transitions des paquets. Dans une telle situation, vous devrez,
    afin d’éviter des conflits de paquets, désélectionner certains
    paquets ou métapaquets du menu des tâches d’aptitude. Lors de la
    désélection de paquets ou de métapaquets, vous devrez
    sélectionner vous-même certains paquets qui fournissent leurs
    dépendances afin d’éviter qu’ils ne soient automatiquement
    supprimés.

    Vous pouvez aussi mettre en place manuellement un environnement
    simple n’ayant qu’un gestionnaire X Window comme Fluxbox.

    Consultez gestionnaires de fenêtres pour X pour un guide du
    gestionnaire de fenêtres X et de l’environnement de bureau.

%

7.2.1. Menu Debian

    Le système de menus Debian fournit une interface aux programmes
    qu’ils soient en mode texte ou orientés X avec update-menus(1) du
    paquet menu. Chaque paquet installe ses données de menu dans le
    répertoire « /usr/share/menu/ ». Consultez « /usr/share/menu/
    README ».

%

7.2.2. Menu de Freedesktop.org

    Chaque paquet conforme au système de menu xdg du système
    Freedesktop.org installe ses données de menu fournies par
    « *.desktop » dans « /usr/share/applications/ ». Les
    environnements de bureau modernes conformes au standard
    Freedesktop.org utilisent ces données afin de créer leur menu à
    l’aide du paquet xdg-utils. Consultez « /usr/share/doc/xdg-utils/
    README ».

%

7.2.3. Menu Debian sous « Freedesktop.org menu »

    Pour pouvoir accéder au menu traditionnel de Debian depuis un
    gestionnaire d’environnement de bureau se conformant au
    Freedesktop.org menu, tel que GNOME ou KDE, il faut installer le
    paquet menu-xdg.

%

7.3. La relation client - serveur

    Le système X Window est activé sous la forme de la combinaison
    d’un programme serveur et d’un programme client. La signification
    des mots server et client comparés aux mots local et distant
    demande ici une attention particulière.

    Tableau 7.2. Liste de terminologie client/serveur

    +---------------------------------------------------------------+
    |     type     |                  description                   |
    |--------------+------------------------------------------------|
    |              |programme tournant sur une machine locale       |
    |serveur X     |connectée aux périphériques d’affichage et de   |
    |              |saisie de l’utilisateur.                        |
    |--------------+------------------------------------------------|
    |              |programme tournant sur une machine distante qui |
    |client X      |traite des données et dialogue avec le serveur  |
    |              |X.                                              |
    |--------------+------------------------------------------------|
    |serveur       |programme tournant sur une machine distante qui |
    |d’applications|traite des données et dialogue avec les clients |
    |              |de l'application.                               |
    |--------------+------------------------------------------------|
    |client        |programme tournant sur une machine locale       |
    |d’applications|connectée aux périphériques d’affichage et de   |
    |              |saisie de l’utilisateur.                        |
    +---------------------------------------------------------------+


    Les serveurs X modernes ont l’extension de mémoire partagée du
    MIT (the MIT Shared Memory Extension) et communiquent avec leurs
    clients locaux en utilisant la mémoire partagée locale. De cette
    manière le canal de communication inter-processus de réseau
    transparent de la Xlib est contourné, ce qui permet de gagner en
    performance avec des images de grande taille.

%

7.4. Le serveur X

    Consultez xorg(1) pour des informations concernant le serveur X.

%

7.4.1. La (re-)configuration du serveur X

    La (re-)configuration du serveur X s'effectue de la façon
    suivante.

    # dpkg-reconfigure --priority=low x11-common

    Note

    Les noyaux Linux récents ont une bonne prise en charge des
    composants graphiques et des périphériques d'entrées avec DRM,
    KMS, et "udev. Le serveur X a été réécrit pour les utiliser.
    Ainsi "/etc/X11/xorg.conf" n'est habituellement pas présent sur
    votre système. Ces paramètres sont configurés par le noyau. Voir
    "fb/modedb.txt" dans la documentation du noyau Linux.

    Pour les moniteurs à tube de grande taille, c’est une bonne idée
    de définir un taux de rafraîchissement aussi élevé que votre
    moniteur peut le supporter (85 Hz est excellent, 75 Hz est bon)
    afin de réduire le scintillement. Pour les moniteurs à cristaux
    liquides, le taux de rafraîchissement plus faible (60 Hz)
    convient habituellement bien en raison de leur temps de réponse
    qui est plus lent.

    Note

    Attention à ne pas utiliser un taux de rafraîchissement trop
    élevé qui peut entraîner une défaillance matérielle fatale à
    votre moniteur.

%

7.4.2. Les méthodes de connexion au serveur X

    Il y a plusieurs manières de faire accepter au « serveur X »
    (côté affichage) les connexions en provenance d’un « client X »
    (côté application).

    Tableau 7.3. Liste des méthodes de connexion au serveur X

    +-------------------------------------------------------------------------------+
    |    paquet    |popcon|taille|utilisateur|chiffrement|  méthode   |pertinence de|
    |              |      |      |           |           |            |l’utilisation|
    |--------------+------+------+-----------+-----------+------------+-------------|
    |xbase-clients |I:26  |46    |non vérifié|non        |Commande    |obsolète     |
    |              |      |      |           |           |xhost       |             |
    |--------------+------+------+-----------+-----------+------------+-------------|
    |              |      |      |           |           |Commande    |Connexion    |
    |xbase-clients |I:26  |46    |vérifié    |non        |xauth       |locale par un|
    |              |      |      |           |           |            |tube         |
    |--------------+------+------+-----------+-----------+------------+-------------|
    |              |V:803,|      |           |           |Commande ssh|Connexion à  |
    |openssh-client|I:996 |4298  |vérifié    |oui        |-X          |distante par |
    |              |      |      |           |           |            |le réseau    |
    |--------------+------+------+-----------+-----------+------------+-------------|
    |              |V:165,|      |           |           |Gestionnaire|Connexion    |
    |gdm3          |I:229 |5101  |vérifié    |non (XDMCP)|d’affichage |locale par un|
    |              |      |      |           |           |de GNOME    |tube         |
    |--------------+------+------+-----------+-----------+------------+-------------|
    |              |V:53, |      |           |           |Gestionnaire|Connexion    |
    |sddm          |I:95  |1742  |vérifié    |non (XDMCP)|d’affichage |locale par un|
    |              |      |      |           |           |de KDE      |tube         |
    |--------------+------+------+-----------+-----------+------------+-------------|
    |              |V:3,  |      |           |           |Gestionnaire|Connexion    |
    |xdm           |I:6   |686   |vérifié    |non (XDMCP)|d’affichage |locale par un|
    |              |      |      |           |           |de X        |tube         |
    |--------------+------+------+-----------+-----------+------------+-------------|
    |              |V:31, |      |           |           |Gestionnaire|Connexion    |
    |wdm           |I:284 |2289  |vérifié    |non (XDMCP)|d’affichage |locale par un|
    |              |      |      |           |           |WindowMaker |tube         |
    |--------------+------+------+-----------+-----------+------------+-------------|
    |              |      |      |           |           |            |connexion    |
    |              |V:0,  |      |           |           |Gestionnaire|réseau       |
    |ldm           |I:0   |436   |vérifié    |oui        |d’affichage |distante par |
    |              |      |      |           |           |LTSP        |SSH (client  |
    |              |      |      |           |           |            |léger)       |
    +-------------------------------------------------------------------------------+


    Avertissement

    Ne pas utiliser, pour la connexion X, de connexion TCP/IP
    distante sur un réseau non sécurisé à moins que vous n’ayez une
    très bonne raison de le faire telle que l’utilisation du
    chiffrement. Une socket de connexion TCP/IP sans chiffrement est
    susceptible d’une attaque d’espionnage, elle est désactivée par
    défaut sur le système Debian. Utilisez « ssh -X ».

    Avertissement

    Ne pas utiliser non plus de connexion XDMCP sur un réseau non
    sécurisé. Il envoie des données UDP/IP sans chiffrement et
    susceptible d’une attaque d’espionnage.

    Astuce
   
    LTSP signifie Projet de serveur de terminal Linux (« Linux
    Terminal Server Project »).

%

7.5. Démarrer le système X Window

    Le système X Window est habituellement démarré en tant que
    session X qui est la combinaison d’un serveur X et de la
    connexion de clients X. Pour le système de bureau normal, les
    deux tournent sur la station de travail.

    La session X peut être démarrée de l'une des façons suivantes :

      * la commande startx lancée depuis la ligne de commande ;
   
      * One of the X display manager daemon programs *dm started by
        systemd based on the dependency of "graphical.target".

    Astuce

    Le script de démarrage des démons de gestion d’affichage examine
    d’abord le contenu du fichier « /etc/X11/
    default-display-manager » avant leur exécution proprement dite.
    Cela permet de s’assurer qu’un seul programme démon X display
    manager est activé.

    Astuce

    Consultez Section 8.4.5, « Paramètre linguistique spécifique sous
    X Window » pour les variables d’environnement initiales du
    gestionnaire d’affichage X.

    Essentiellement, tous ces programmes exécutent le script « /etc/
    X11/Xsession ". Ensuite, le script « /etc/X11/Xsession » effectue
    une action de type run-parts(8) pour exécuter les scripts se
    trouvant dans le répertoire « /etc/X11/Xsession.d/ ». Le premier
    programme trouvé, dans l’ordre suivant, est exécuté par la
    commande « exec » intégrée :

     1. le script indiqué comme paramètre de « /etc/X11/Xsession »
        par le gestionnaire d’affichage X, s’il est défini ;

     2. le script « ~/.xsession » ou « ~/.Xsession », s’il est
        défini ;

     3. la commande « /usr/bin/x-session-manager », si elle est
        définie ;

     4. la commande « /usr/bin/x-window-manager », si elle est
        définie ;

     5. la commande « /usr/bin/x-terminal-emulator », si elle est
        définie.

    Ce processus est affecté par le contenu de « /etc/X11/
    Xsession.options ». Les programmes exacts vers lesquels pointent
    les commandes « /usr/bin/x-* » sont déterminés par le système
    d’alternatives de Debian et sont modifiés par
    « update-alternatives --config x-session-manager », etc.

    Consultez Xsession(5) pour plus d’informations.

%

7.5.1. Démarrer une session X avec gdm3

    gdm3(1) vous permet de sélectionner le type de session (ou
    d’environnement de bureau : Section 7.2, « Configurer
    l’environnement de bureau »), la langue (ou locale: Section 8.4,
    « Les paramètres linguistiques (« locale ») ») de la session X
    depuis son menu. Il conserve les valeurs par défaut dans "~
    /.dmrc" sous la forme suivante.

    [Desktop]
    Session=default
    Language=fr_FR.UTF-8

%

7.5.2. Personnaliser la session X (méthode classique)

    Sur un système où « /etc/X11/Xsession.options » contient une
    ligne « allow-user-xsession sans caractère « # » la précédant,
    tout utilisateur qui définit « ~/.xsession » ou « ~/.Xsession »
    peut personnaliser l’action de « /etc/X11/Xsession » en passant
    outre le code du système. La dernière commande dans le fichier
    « ~/.xsession » devrait toujours être de la forme « exec
    un_gestionnaire_de_fenêtre_ou_de_session » afin de démarrer vos
    gestionnaires favoris de fenêtres et de session X.

    Si cette fonction est utilisée, la sélection, par l'utilitaire
    système, du gestionnaire d'affichage (ou de connexion) (DM), du
    gestionnaire de session, ou gestionnaire de fenêtres (WM) est
    ignorée.

%

7.5.3. Personnaliser la session X (nouvelle méthode)

    Voici de nouvelles méthodes de personnalisation de la session X
    sans complètement outrepasser le code système comme précédemment.

      * le gestionnaire d’affichage gdm3 peut sélectionner une
        session particulière et la définir comme paramètre de "/etc/
        X11/Xsession".

          + Les fichiers "/etc/profile", "~/.profile", "/etc/
            xprofile", et "~/.xprofile" sont exécutés comme partie
            (intégrante) du processus de démarrage gdm3.
   
      * Le fichier "~/.xsessionrc" est exécuté dans le cadre du
        processus de démarrage (indépendant du bureau)

          + "#allow-user-xsession" dans "/etc/X11/Xsession.options"
            ne restreint pas l'exécution du fichier "~/.xsessionrc".

      * Le fichier "~/.gnomerc" est exécuté dans le cadre du
        processus de démarrage (bureau GNOME uniquement)

    La sélection du gestionnaire d'affichage (ou de connexion) (DM),
    du gestionnaire de session ou du gestionnaire de fenêtres (WM)
    par l'utilitaire système est respectée.

    Ces fichiers de configuration ne devraient contenir ni "exec …"
    ni " exit".

%

7.5.4. Connexion à un client X distant via SSH

    L’utilisation de "ssh -X" active une connexion sécurisée entre le
    serveur X local et une application sur un serveur distant.

    Si on ne désire pas utiliser l’option "-X" de la ligne de
    commande, définir à "yes" les entrées "X11Forwarding" de "/etc/
    ssh/sshd_config" sur la machine distante.

    Démarrez le serveur X sur la station locale.

    Ouvrez un xterm sur la machine locale.

    Lancez ssh(1) pour établir une connexion avec un site distant
    comme suit :

    utilisateur_local @ localhost $ ssh -q -X -l nom_utilisateur@machine_distante.domaine
    Password:

    Lancez comme suit une application X, par exemple « gimp » sur le
    site distant :

    nom_utilisateur @ machine_distante $ gimp &

    Cette méthode permet l’affichage du client X distant comme s’il
    était connecté par une socket UNIX locale.

%

7.5.5. Sécuriser le terminal X au travers d’Internet

    La sécurisation du terminal X par Internet, qui affiche
    localement un environnement de bureau qui tourne entièrement de
    manière distante, peut être facilement réalisée en utilisant des
    paquets spécialisés tels que ldm. Votre machine locale devient un
    client léger sécurisé du serveur d’applications connecté par SSH.

%

7.6. Polices dans X Window

    Fontconfig 2.0 a été créé en 2002 pour fournir une bibliothèque
    indépendante de la distribution destinée à configurer et
    personnaliser l’accès aux polices. Debian, pour les versions
    ultérieures à squeeze, utilise Fontconfig 2.0 pour la
    configuration de ses polices.

    La prise en compte des polices dans le système X Window peut être
    résumée comme suit :

      * Ancien système de gestion des polices côté serveur X

          + Le système de polices de base d’origine de X11 fournit
            une rétrocompatibilité avec les anciennes versions des
            applications X clientes.

          + Les polices de base d’origine de X11 sont installées sur
            le serveur X.

      * Système de prise en charge moderne des polices côté client X

          + Le système X moderne prend en charge toutes les polices
            dont la liste figure ci-dessous (Section 7.6.1, « Polices
            de base », Section 7.6.2, « Polices supplémentaires » et
            Section 7.6.3, « Polices CJK ») avec des fonctionnalités
            avancées telles que l’anti-crénelage.

          + Xft 2.0 connecte les applications X modernes telles que
            celles de GNOME, KDE et LibreOffice avec la bibliothèque
            FreeType 2.0

          + FreeType 2.0 fournit une bibliothèque de tramage des
            polices.

          + Fontconfig fournit une résolution de la spécification des
            polices pour Xft 2.0. Consultez fonts.conf(5) pour sa
            configuration.

          + Toutes les applications X modernes qui utilisent Xft 2.0
            peuvent dialoguer avec un serveur X moderne en utilisant
            l’extension de rendu X (« X Rendering Extension »).

          + L’extension de rendu X déplace l’accès aux polices et la
            génération des images de glyphes du serveur vers le
            client X.

    Tableau 7.4. Table de paquets prenant en charge les systèmes de
    polices de X Window

    +---------------------------------------------------------------+
    |     paquet      |popcon|taille|          description          |
    |-----------------+------+------+-------------------------------|
    |xfonts-utils     |V:66, |415   |Programmes utilitaires des     |
    |                 |I:542 |      |polices du système X Window    |
    |-----------------+------+------+-------------------------------|
    |                 |      |      |Xft, bibliothèque permettant de|
    |libxft2          |V:143,|122   |connecter des applications X   |
    |                 |I:662 |      |avec la bibliothèque de tramage|
    |                 |      |      |des polices FreeType           |
    |-----------------+------+------+-------------------------------|
    |libfreetype6     |V:426,|896   |Bibliothèque de tramage des    |
    |                 |I:994 |      |polices FreeType 2.0           |
    |-----------------+------+------+-------------------------------|
    |                 |V:354,|      |Fontconfig, bibliothèque       |
    |fontconfig       |I:776 |583   |générique de configuration des |
    |                 |      |      |polices — binaires de gestion  |
    |-----------------+------+------+-------------------------------|
    |                 |      |      |Fontconfig, bibliothèque       |
    |fontconfig-config|V:367,|442   |générique de configuration des |
    |                 |I:871 |      |polices — données de           |
    |                 |      |      |configuration                  |
    +---------------------------------------------------------------+


    Vous pouvez vérifier les informations de configuration des
    polices comme suit :

      * « xset q » pour le chemin des police X11 de base

      * « fc-match » pour la police par défaut de fontconfig

      * « fc-list » pour les polices disponibles de fontconfig

    Astuce

    « Unicode et le Pingouin » (« The Penguin and Unicode ») est un
    bon aperçu du système X Window moderne. D’autres documentations
    se trouvant à http://unifont.org/ devraient fournir de bonnes
    informations sur les polices Unicode, les logiciels fonctionnant
    avec Unicode, l’internationalisation et les problèmes
    d’utilisation d’Unicode sur les systèmes d’exploitationfree/libre
    /open source (FLOSS).

%

7.6.1. Polices de base

    Il y a deux types principaux de polices de caractères pour
    ordinateurs.

      * Polices par champs de bits (« bitmap ») (bonnes pour le
        tramage en faible résolution)
   
      * Polices par traits/contours (bonnes pour le tramage en haute
        résolution)

    Alors que le redimensionnement des polices bitmap donne des
    images hachées, le redimensionnement des polices par traits et
    contours donne des images lisses.

    Les polices bitmap sur le système Debian sont habituellement
    fournie sous forme de fichiers de police X11 pcf bitmap
    compressés ayant l’extension de nom de fichier « .pcf.gz ».

    Les polices de type contour sur les système Debian sont fournies
    de la manière suivante :

      * Fichiers de polices PostScript Type 1 avec une extension de
        nom de fichier « .pfb » (fichier binaire de police) et
        « .afm » (fichier de métrique de la police).

      * Fichiers de polices TrueType (ou OpenType) ayant
        habituellement l’extension « .ttf ».

    Astuce
   
    OpenType est prévu pour se substituer à la fois à TrueType et
    PostScript Type 1.

    Tableau 7.5. Table de correspondance des polices PostScript Type 1

    +----------------------------------------------------------------------------+
    | paquet de |popcon|taille|  police  | police |   police    |  source de la  |
    |  police   |      |      |sans-sérif| sérif  |  monospace  |     police     |
    |-----------+------+------+----------+--------+-------------+----------------|
    |PostScript |N/A   |N/A   |Helvetica |Times   |Courier      |Adobe           |
    |-----------+------+------+----------+--------+-------------+----------------|
    |           |      |      |Nimbus    |Nimbus  |             |URW (taille     |
    |gsfonts    |I:599 |4439  |Sans L    |Roman   |Nimbus Mono L|compatible avec |
    |           |      |      |          |No9 L   |             |Adobe)          |
    |-----------+------+------+----------+--------+-------------+----------------|
    |           |      |      |          |        |             |gestion des     |
    |           |      |      |Nimbus    |Nimbus  |             |polices X avec  |
    |gsfonts-x11|I:82  |95    |Sans L    |Roman   |Nimbus Mono L|polices         |
    |           |      |      |          |No9 L   |             |PostScript Type |
    |           |      |      |          |        |             |1.              |
    |-----------+------+------+----------+--------+-------------+----------------|
    |           |      |      |          |        |             |URW étendu      |
    |t1-cyrillic|I:19  |4878  |Helvetian |Times   |Courier libre|(taille         |
    |           |      |      |libre     |libre   |             |compatible avec |
    |           |      |      |          |        |             |Adobe)          |
    |-----------+------+------+----------+--------+-------------+----------------|
    |           |      |      |          |        |             |PostScript      |
    |           |      |      |          |        |             |redimensionnable|
    |           |V:13, |      |          |        |             |et polices      |
    |lmodern    |I:113 |33270 |LMSans*   |LMRoman*|LMTypewriter*|OpenType basées |
    |           |      |      |          |        |             |sur « Computer  |
    |           |      |      |          |        |             |Modern » (venant|
    |           |      |      |          |        |             |de TeX)         |
    +----------------------------------------------------------------------------+


    Tableau 7.6. Table de correspondance des polices TrueType

    +--------------------------------------------------------------------------------------+
    |    paquet de police     |popcon|taille|  police  |  police  |  police  |source de la |
    |                         |      |      |sans-sérif|  sérif   |monospace |   police    |
    |-------------------------+------+------+----------+----------+----------+-------------|
    |                         |      |      |          |          |          |Microsoft    |
    |                         |      |      |          |          |          |(taille      |
    |                         |      |      |          |          |          |compatible   |
    |ttf-mscorefonts-installer|V:1,  |92    |Arial     |Times New |Courier   |avec Adobe)  |
    |                         |I:64  |      |          |Roman     |New       |(cela        |
    |                         |      |      |          |          |          |installe des |
    |                         |      |      |          |          |          |données non  |
    |                         |      |      |          |          |          |libres)      |
    |-------------------------+------+------+----------+----------+----------+-------------|
    |                         |      |      |          |          |          |Projet de    |
    |                         |      |      |          |          |          |polices      |
    |                         |      |      |Liberation|Liberation|Liberation|Liberation   |
    |fonts-liberation         |I:469 |2093  |Sans      |Serif     |Mono      |(taille      |
    |                         |      |      |          |          |          |compatible   |
    |                         |      |      |          |          |          |avec         |
    |                         |      |      |          |          |          |Microsoft)   |
    |-------------------------+------+------+----------+----------+----------+-------------|
    |                         |      |      |          |          |          |GNU freefont |
    |                         |V:50, |      |          |          |          |(taille      |
    |fonts-freefont-ttf       |I:276 |6656  |FreeSans  |FreeSerif |FreeMono  |compatible   |
    |                         |      |      |          |          |          |avec         |
    |                         |      |      |          |          |          |Microsoft)   |
    |-------------------------+------+------+----------+----------+----------+-------------|
    |                         |      |      |          |          |          |DejaVu,      |
    |                         |      |      |DejaVu    |DejaVu    |DejaVu    |Bitstream    |
    |fonts-dejavu             |I:478 |39    |Sans      |Serif     |Sans Mono |Vera avec    |
    |                         |      |      |          |          |          |couverture   |
    |                         |      |      |          |          |          |Unicode      |
    |-------------------------+------+------+----------+----------+----------+-------------|
    |                         |      |      |          |          |          |DejaVu,      |
    |                         |      |      |          |          |          |Bitstream    |
    |                         |      |      |          |          |          |Vera avec    |
    |                         |      |      |          |          |          |couverture   |
    |                         |V:220,|      |DejaVu    |DejaVu    |DejaVu    |Unicode      |
    |fonts-dejavu-core        |I:809 |2954  |Sans      |Serif     |Sans Mono |(sans,       |
    |                         |      |      |          |          |          |sans-bold,   |
    |                         |      |      |          |          |          |serif,       |
    |                         |      |      |          |          |          |serif-bold,  |
    |                         |      |      |          |          |          |mono,        |
    |                         |      |      |          |          |          |mono-bold)   |
    |-------------------------+------+------+----------+----------+----------+-------------|
    |                         |      |      |          |          |          |DejaVu,      |
    |                         |      |      |          |          |          |Bitstream    |
    |                         |      |      |          |          |          |Vera avec    |
    |                         |      |      |          |          |          |couverture   |
    |fonts-dejavu-extra       |I:516 |7493  |N/A       |N/A       |N/A       |Unicode      |
    |                         |      |      |          |          |          |(oblique,    |
    |                         |      |      |          |          |          |italic,      |
    |                         |      |      |          |          |          |bold-oblique,|
    |                         |      |      |          |          |          |bold-italic, |
    |                         |      |      |          |          |          |condensed)   |
    |-------------------------+------+------+----------+----------+----------+-------------|
    |                         |      |      |          |          |          |GNU Unifont, |
    |                         |      |      |          |          |          |avec tous les|
    |                         |      |      |          |          |          |codes de     |
    |                         |      |      |          |          |          |caractères   |
    |                         |      |      |          |          |          |imprimables  |
    |ttf-unifont              |I:21  |21    |N/A       |N/A       |unifont   |d’« Unicode  |
    |                         |      |      |          |          |          |5.1 Basic    |
    |                         |      |      |          |          |          |Multilingual |
    |                         |      |      |          |          |          |Plane (BMP) »|
    |                         |      |      |          |          |          |(Plan de base|
    |                         |      |      |          |          |          |multilingue  |
    |                         |      |      |          |          |          |Unicode 5.1) |
    +--------------------------------------------------------------------------------------+


    Astuce
   
    Les polices DejaVu sont basées sur un sur-ensemble des polices
    Bitstream Vera

%

7.6.2. Polices supplémentaires

    aptitude(8) peut vous aider à trouver facilement de nouvelles
    polices de caractères.

      * La courte liste de paquets sous « Tâches » → « Localisation »

      * La liste des paquets de données de polices filtrée par
        l’expression rationnelle sur debtag :
        « ~Gmade-of::data:font »
   
      * La liste des paquets de polices BDF (bitmap) filtrée par
        l’expression rationnelle sur le nom de paquet : « ~nxfonts- »

      * La liste des paquets de polices TrueType (outline) filtrée
        par l’expression rationnelle sur le nom de paquet : « ~nttf-|
        ~nfonts- »

    Comme les polices libres sont quelque peu limitées,
    l’installation ou le partage de certaines polices TrueType
    commerciales est possible pour les utilisateur de Debian. De
    manière à faciliter ce processus pour l’utilisateur, certains
    paquets pratiques ont été créés.

      * mathematica-fonts
   
      * fonts-mscorefonts-installer

    Vous obtiendrez une vraiment bonne sélection de polices TrueType
    en acceptant de contaminer votre système Libre avec des polices
    non libres.

%

7.6.3. Polices CJK

    Voici quelques points ciblés sur les polices de caractères CJK.

    Tableau 7.7. Table de mots-clés utilisés dans les noms de polices
    CJK afin d’indiquer les types de polices

    +---------------------------------------------------------------+
    |  type de  |  nom de police  | nom de police  | nom de police  |
    |  police   |    Japonaise    |    chinoise    |    coréenne    |
    |-----------+-----------------+----------------+----------------|
    |sans-sérif |gothic, ゴチック |hei, gothic     |dodum, gulim,   |
    |           |                 |                |gothic          |
    |-----------+-----------------+----------------+----------------|
    |serif      |mincho, 明朝     |song, ming      |batang          |
    +---------------------------------------------------------------+


    Un nom de police tel que « VL PGothic » avec « P » est une police
    proportionnelle correspondant à la police de largeur fixe « VL
    Gothic ».

    Par exemple, la table de code Shift_JIS comporte 7070 caractères.
    Ils peuvent être regroupés de la manière suivante :

      * caractères sur un seul octet JIS X 0201 (191 caractères
        encore appelés caractères de demi-largeur)
   
      * caractères sur deux octets JIS X 0208 (6879 caractères encore
        appelés caractères de pleine-largeur)

    Les caractères sur deux octets occupent une largeur double sur
    les consoles qui utilisent des polices CJK de largeur fixe. Afin
    de s’accommoder d’une telle situation, le fichier Hanzi Bitmap
    Font (HBF) File ayant l’extension de nom de fichier « .hbf » peut
    être mis en œuvre pour les polices comportant des caractères sur
    un ou sur deux octets.

    Afin d’économiser la place prise par les fichiers de polices
    TrueType, on peut utiliser un fichier de collection de polices
    TrueType ayant l’extension du nom de fichier « .ttc ».

    Afin de couvrir un espace de code de caractères compliqué, la
    police CID à clé PostScript Type 1 est utilisée avec des fichiers
    CMap qui commencent par « %!PS-Adobe-3.0 Resource-CMap ». C’est
    rarement utilisé pour l’affichage X normal mais est utilisé pour
    le rendu PDF, etc. (consultez Section 7.7.2, « Applications
    utilitaires pour X »).

    Astuce

    Des glyphes multiples sont attendus de certains points du code
    Unicode en raison de l’unification Han. Parmi les plus ennuyeux
    se trouvent « U+3001 IDEOGRAPHIC COMMA » et « U+3002 IDEOGRAPHIC
    FULL STOP » dont la position des caractères diffère selon les
    pays CJK. La priorité de configuration des polices
    japono-centrées sur les chinoises en utilisant « ~/.fonts.conf »
    devrait apaiser l’esprit des Japonais.

7.7. Applications X

%

7.7.1. Applications X de bureautique

    Voici une liste des application de bureautique de base (LO
    signifie LibreOffice) :

    Tableau 7.8. Liste d’applications de bureautique de base pour X

    +---------------------------------------------------------------+
    |                   |      |taille|     |                       |
    |      paquet       |popcon|  du  |type |      description      |
    |                   |      |paquet|     |                       |
    |-------------------+------+------+-----+-----------------------|
    |libreoffice-writer |V:188,|39333 |LO   |traitement de texte    |
    |                   |I:441 |      |     |                       |
    |-------------------+------+------+-----+-----------------------|
    |libreoffice-calc   |V:188,|32973 |LO   |feuille de calcul      |
    |                   |I:436 |      |     |                       |
    |-------------------+------+------+-----+-----------------------|
    |libreoffice-impress|V:176,|9934  |LO   |présentation           |
    |                   |I:433 |      |     |                       |
    |-------------------+------+------+-----+-----------------------|
    |libreoffice-base   |V:145,|7473  |LO   |gestion de base de     |
    |                   |I:325 |      |     |données                |
    |-------------------+------+------+-----+-----------------------|
    |libreoffice-draw   |V:177,|14600 |LO   |éditeur de graphiques  |
    |                   |I:434 |      |     |vectoriels (draw)      |
    |-------------------+------+------+-----+-----------------------|
    |                   |V:174,|      |     |éditeur d’équations et |
    |libreoffice-math   |I:437 |1963  |LO   |de formules            |
    |                   |      |      |     |mathématiques          |
    |-------------------+------+------+-----+-----------------------|
    |abiword            |V:1,  |5141  |GNOME|traitement de texte    |
    |                   |I:12  |      |     |                       |
    |-------------------+------+------+-----+-----------------------|
    |gnumeric           |V:6,  |9933  |GNOME|feuille de calcul      |
    |                   |I:21  |      |     |                       |
    |-------------------+------+------+-----+-----------------------|
    |                   |V:68, |      |     |éditeur de graphiques  |
    |gimp               |I:341 |22313 |GTK  |en champs de bits      |
    |                   |      |      |     |(« bitmap ») (paint)   |
    |-------------------+------+------+-----+-----------------------|
    |inkscape           |V:55, |84823 |GNOME|éditeur de graphiques  |
    |                   |I:209 |      |     |vectoriels (draw)      |
    |-------------------+------+------+-----+-----------------------|
    |dia                |V:5,  |3727  |GTK  |éditeur d’organigrammes|
    |                   |I:31  |      |     |et de diagrammes       |
    |-------------------+------+------+-----+-----------------------|
    |planner            |V:0,  |1146  |GNOME|gestion de projets     |
    |                   |I:5   |      |     |                       |
    |-------------------+------+------+-----+-----------------------|
    |calligrawords      |V:0,  |5717  |KDE  |traitement de texte    |
    |                   |I:7   |      |     |                       |
    |-------------------+------+------+-----+-----------------------|
    |calligrasheets     |V:0,  |10890 |KDE  |feuille de calcul      |
    |                   |I:6   |      |     |                       |
    |-------------------+------+------+-----+-----------------------|
    |calligrastage      |V:0,  |5102  |KDE  |présentation           |
    |                   |I:5   |      |     |                       |
    |-------------------+------+------+-----+-----------------------|
    |calligraplan       |V:0,  |15342 |KDE  |gestion de projets     |
    |                   |I:2   |      |     |                       |
    |-------------------+------+------+-----+-----------------------|
    |kexi               |V:0,  |7576  |KDE  |gestion de base de     |
    |                   |I:2   |      |     |données                |
    |-------------------+------+------+-----+-----------------------|
    |karbon             |V:0,  |3473  |KDE  |éditeur de graphiques  |
    |                   |I:7   |      |     |vectoriels (draw)      |
    +---------------------------------------------------------------+


%

7.7.2. Applications utilitaires pour X

    Voici une liste d’applications de base qui ont attiré mon
    attention :

    Tableau 7.9. Liste d’applications utilitaires de base pour X

    +---------------------------------------------------------------+
    |         |      |taille|     |                                 |
    | paquet  |popcon|  du  |type |           description           |
    |         |      |paquet|     |                                 |
    |---------+------+------+-----+---------------------------------|
    |evince   |V:116,|954   |GNOME|afficheur de documents (pdf)     |
    |         |I:329 |      |     |                                 |
    |---------+------+------+-----+---------------------------------|
    |okular   |V:46, |14646 |KDE  |afficheur de documents (pdf)     |
    |         |I:118 |      |     |                                 |
    |---------+------+------+-----+---------------------------------|
    |calibre  |V:9,  |54876 |KDE  |Convertisseur de livre numérique |
    |         |I:36  |      |     |et gestion de bibliothèque.      |
    |---------+------+------+-----+---------------------------------|
    |fbreader |V:2,  |3074  |GTK  |lectrice de e-book               |
    |         |I:15  |      |     |                                 |
    |---------+------+------+-----+---------------------------------|
    |         |V:31, |      |     |Gestion d’informations           |
    |evolution|I:229 |475   |GNOME|personnelles (logiciel de travail|
    |         |      |      |     |collaboratif et courriel)        |
    |---------+------+------+-----+---------------------------------|
    |         |V:1,  |      |     |Gestion d’informations           |
    |kontact  |I:16  |2152  |KDE  |personnelles (logiciel de travail|
    |         |      |      |     |collaboratif et courriel)        |
    |---------+------+------+-----+---------------------------------|
    |scribus  |V:2,  |30375 |KDE  |éditeur de mise en page de bureau|
    |         |I:23  |      |     |                                 |
    |---------+------+------+-----+---------------------------------|
    |glabels  |V:0,  |1326  |GNOME|éditeur d’étiquettes             |
    |         |I:4   |      |     |                                 |
    |---------+------+------+-----+---------------------------------|
    |gnucash  |V:3,  |32304 |GNOME|gestion financière personnelle   |
    |         |I:12  |      |     |                                 |
    |---------+------+------+-----+---------------------------------|
    |homebank |V:0,  |1044  |GTK  |gestion financière personnelle   |
    |         |I:3   |      |     |                                 |
    |---------+------+------+-----+---------------------------------|
    |kmymoney |V:0,  |12036 |KDE  |gestion financière personnelle   |
    |         |I:2   |      |     |                                 |
    |---------+------+------+-----+---------------------------------|
    |shotwell |V:19, |6451  |GTK  |gestionnaire de photos numériques|
    |         |I:223 |      |     |                                 |
    |---------+------+------+-----+---------------------------------|
    |xsane    |V:17, |2346  |GTK  |interface pour dispositifs de    |
    |         |I:173 |      |     |numérisation (scanner)           |
    +---------------------------------------------------------------+


    Attention

    Le paquet poppler-data (précédemment non libre, consultez
    Section 11.4.1, « Ghostscript ») doit être installé pour
    qu’evince et okular puissent afficher des documents CJK PDF qui
    utilisent des données Cmap (Section 7.6.3, « Polices CJK »).

    Note

    L’installation de logiciels tels que scribus (KDE) sous
    l’environnement de bureau GNOME est acceptable puisqu’il n’existe
    pas de fonctionnalité équivalente sous l’environnement de bureau
    de GNOME. Cependant, l’installation de nombreux paquets ayant les
    mêmes fonctionnalités pollue votre menu.

7.8. Les infos de X

%

7.8.1. Presse-papier

    La sélection X à l'aide des 3 boutons de souris est la fonction
    de presse-papiers native de X (voir Section 1.4.4, « Opérations
    de style UNIX avec la souris »).

    Astuce
   
    La combinaison des touches "SHIFT + INSERT" peut fonctionner
    comme l'équivalent du clic du milieu du bouton de la souris.

    Tableau 7.10. Liste des programmes basé sur X

    +---------------------------------------------------------------+
    |paquet|popcon|taille du |type|           description           |
    |      |      |  paquet  |    |                                 |
    |------+------+----------+----+---------------------------------|
    |xsel  |V:10, |59        |X   |Interface de ligne de commande   |
    |      |I:44  |          |    |pour les sélections X            |
    |------+------+----------+----+---------------------------------|
    |xclip |V:9,  |64        |X   |Interface de ligne de commande   |
    |      |I:49  |          |    |pour les sélections X            |
    +---------------------------------------------------------------+


    Les environnements de bureau modernes (GNOME, KDE, ...) offrent
    plusieurs presse-papier pour couper, copier, et coller en
    utilisant le bouton gauche de la souris et des touches du clavier
    (CTRL-X, CTRL-C et CTRL-V).

7.8.2. Cartographie des claviers et affectation des boutons de souris
sous X

    xmodmap(1) est un utilitaire permettant de modifier les
    cartographies de clavier et l’affectation des boutons de la
    souris sous le système X Window. Afin d’obtenir le code de touche
    (« keycode »), lancez xev(1) sous X et pressez les touches. Afin
    d’obtenir la signification de symbole de touche (« keysym »),
    regardez la définition de la MACRO dans le fichier « /usr/include
    /X11/keysymdef.h » (paquet x11proto-core-dev). Toutes les
    instructions« #define » de ce fichier ont des noms préfixés par
    « XK_ » suivi des noms de symbole de touche (« keysym »).

%

7.8.3. Clients X classiques

    La plupart des programmes clients X traditionnels, tels que xterm
    (1), peuvent être démarrés avec un ensemble d’options en ligne de
    commande afin de préciser leur géométrie, les polices et
    l’affichage.

    Ils utilisent aussi la base de données de ressources X afin de
    configurer leur aspect. Les valeurs par défaut des ressources X
    pour l’ensemble du système se trouvent dans « /etc/X11/Xresources
    /* » et les valeurs par défaut de leurs applications dans « /etc/
    X11/app-defaults/* ». Utilisez ces paramètres comme point de
    départ.

    Le fichier « ~/.Xresources » est utilisé pour enregistrer les
    spécifications de ressources de l’utilisateur. Ce fichier est
    automatiquement fusionné avec les ressources X par défaut lors de
    la connexion. Pour effectuer des modifications à ces définitions
    et les rendre immédiatement effectives, fusionnez-les dans la
    base de données à l’aide de la commande suivante :

    $ xrdb -merge ~/.Xresources

    Consultez x(7) et xrdb(1).

%

7.8.4. Émulateur de terminal X — xterm

    Vous pourrez tout apprendre ce qui concerne xterm(1) sur http://
    dickey.his.com/xterm/xterm.faq.html.

%

7.8.5. Faire tourner X avec le compte de l’administrateur

    Avertissement

    Ne lancez jamais le gestionnaire de session ou d’affichage X avec
    le compte de l’administrateur en entrant root à l’invite d’un
    gestionnaire d’affichage comme gdm3, même si vous prévoyez
    d’effectuer des tâches administratives car c’est considéré comme
    non sûr. L’ensemble de l’architecture de X est considérée comme
    non sûre si elle tourne avec le compte de l’administrateur. Vous
    devez toujours avoir le niveau de privilège le plus bas possible,
    comme avec un compte normal.

    Une manière simple de faire tourner un client X particulier, par
    exemple « toto » en tant que superutilisateur est d’utiliser sudo
    (8) etc. de la manière suivante :

    $ sudo toto &

    $ sudo -s
    # toto &

    $ ssh -X root@localhost
    # toto &

    Attention
   
    N’utiliser ssh(1) que dans ce but est un gaspillage de
    ressources.

    De manière à ce que le client X puisse se connecter au serveur X,
    veuillez noter ce qui suit :

      * Les valeurs des variables d’environnement « $XAUTHORITY » et
        « $DISPLAY » de l’ancien utilisateur doivent être copiées
        dans celles du nouvel utilisateur.
   
      * Le nouvel utilisateur doit avoir la permission de lecture du
        fichier vers lequel pointe la valeur de la variable
        d’environnement « :$XAUTHORITY ».

Chapitre 8. I18N et L10N

    Le multilinguisme (M17N) ou la gestion de la langue natale
    (« Native Language Support ») d’un logiciel applicatif est
    réalisé en deux étapes :

      * L’internationalisation (I18N) : donne la possibilité à un
        logiciel de gérer plusieurs paramètres linguistiques ;
   
      * La localisation (L10N) : permet au logiciel de prendre en
        charge des paramètres linguistiques particuliers.

    Astuce

    Il y a 17, 18, ou 10 lettres entre « m » et « n », « i » et « n »
    ou « l » et « n » dans « multilingualization »,
    « internationalization » et « localization » ce qui correspond à
    M17N, I18N, et L10N.

    Des logiciels modernes, tels que GNOME et KDE, gèrent le
    multilinguisme. Ils sont internationalisés en les faisant gérer
    les données UTF-8 et localisés en leur donnant les messages
    traduits par l’intermédiaire de l’infrastructure gettext(1). Les
    messages traduits peuvent être offerts sous forme de paquets de
    localisation séparés. Ils sont simplement sélectionnés en donnant
    la valeur du paramètres linguistique approprié à des variables
    d’environnement pertinentes.

    La représentation la plus simple d’un texte de données est l’
    ASCII qui suffit à l’anglais et utilise moins de 127 caractères
    (qui peuvent être représentés avec 7 bits). De manière à pouvoir
    prendre en compte bien plus de caractères pour
    l’internationalisation, de nombreux systèmes de codage des
    caractères ont été inventés. Le système moderne et préféré est 
    UTF-8 qui peut prendre en charge tous les caractères connus des
    êtres humains (consultez Section 8.4.1, « Bases du codage »).

    Consultez Introduction à i18n pour davantage d’informations.

    La prise en charge du matériel international est activée par des
    données de configuration du matériel localisées.

    Avertissement
   
    Ce chapitre est obsolète car il est basé sur Debian 7.0 (1Wheezy)
    sortit en 2013.

%

8.1. L’entrée clavier

    Le système Debian peut être configuré pour travailler avec de
    nombreuses configurations de clavier internationales en utilisant
    les paquets keybord-configuration et console-setup.

    # dpkg-reconfigure keybord-configuration
    # dpkg-reconfigure console-setup

    Cela configure le clavier pour la console Linux et X Window met à
    jour les paramètres de configuration dans "/etc/default/keyboard"
    et "/etc/default/console-setup". Cela configure également la
    police de caractères de la console Linux.

    De nombreux caractères non-ASCII, y compris les caractères
    accentués utilisés par de nombreuses langues européennes, peuvent
    être disponibles avec la touche morte, la touche AltGr, et la
    touche compose.

    Pour les langues asiatiques, il faut une gestion plus compliquée
    de la méthode d’entrée telle que IBus qui sera discutée ci-après.

%

8.1.1. Prise en charge de la méthode d’entrée avec iBus

    Les entrées multilingues dans une application sont traitées comme
    suit :

    Clavier                                   Application
       |                                           ^
       |                                           |
       +-> noyau Linux -> Méthode d'entrée -> Gtk, Qt, ou X

    La configuration de l’entrée multilingue du système Debian est
    simplifiée par l’utilisation de la famille de paquets IBus avec
    le paquet im-config. La liste des paquets IBus est la suivante :

    Tableau 8.1. Liste des méthodes d’entrées prises en charge par
    iBus

    +---------------------------------------------------------------+
    |    paquet     |popcon |taille|paramètres linguistiques pris en|
    |               |       |      |             charge             |
    |---------------+-------+------+--------------------------------|
    |ibus           |V:70,  |1581  |infrastructure de méthode       |
    |               |I:87   |      |d’entrée utilisant dbus         |
    |---------------+-------+------+--------------------------------|
    |ibus-mozc      |V:1,   |999   |Japonais                        |
    |               |I:2    |      |                                |
    |---------------+-------+------+--------------------------------|
    |ibus-anthy     |V:0,   |8723  |, ,                             |
    |               |I:1    |      |                                |
    |---------------+-------+------+--------------------------------|
    |ibus-kkc       |V:0,   |214   |, ,                             |
    |               |I:0    |      |                                |
    |---------------+-------+------+--------------------------------|
    |ibus-skk       |V:0,   |244   |, ,                             |
    |               |I:0    |      |                                |
    |---------------+-------+------+--------------------------------|
    |ibus-pinyin    |V:0,   |1434  |Chinois (pour zh_CN)            |
    |               |I:1    |      |                                |
    |---------------+-------+------+--------------------------------|
    |ibus-chewing   |V:0,   |415   |, , (pour zh_TW)                |
    |               |I:0    |      |                                |
    |---------------+-------+------+--------------------------------|
    |ibus-hangul    |V:0,   |288   |Coréen                          |
    |               |I:1    |      |                                |
    |---------------+-------+------+--------------------------------|
    |ibus-table     |V:0,   |1801  |moteur de tables pour iBus      |
    |               |I:1    |      |                                |
    |---------------+-------+------+--------------------------------|
    |ibus-table-thai|I:0    |47    |Thaï                            |
    |---------------+-------+------+--------------------------------|
    |ibus-unikey    |V:0,   |318   |Vietnamien                      |
    |               |I:0    |      |                                |
    |---------------+-------+------+--------------------------------|
    |ibus-m17n      |V:0,   |187   |Multilingue : Indien, Arabe et  |
    |               |I:1    |      |autres                          |
    +---------------------------------------------------------------+


    La méthode kinput2 et d’autres méthodes d’entrée dépendant des
    paramètres linguistiques asiatiques classiques existent encore
    mais ne sont pas recommandées avec l’environnement X UTF-8
    moderne. Les chaînes d’outils SCIM et uim sont une approche
    légèrement plus ancienne de méthode d’entrée internationale de
    l’environnement X UTF-8 moderne.

%

8.1.2. Un exemple pour le japonais

    J’ai trouvé très utile la méthode d’entrée du japonais lancée
    depuis un environnement anglais (« en_US.UTF-8 »). Voici comment
    j’ai procédé avec iBus pour GNOME3 :

     1. Installez le paquet d’outil d’entrée du japonais ibus-anthy
        avec ses paquets recommandés comme im-config.

     2. Exécutez « im-config » depuis l’interpréteur de commandes de
        l’utilisateur et sélectionnez « ibus » comme méthode de
        saisie.

     3. Sélectionnez "Settings" → "Keyboard" → "Input Sources" →
        click "+" dans "Input Sources" → "Japanese" → "Japanese
        (anthy)" et cliquez "Add".

     4. Sélectionnez « Japonais » et cliquez sur « Ajouter » pour
        activer le support de la disposition de clavier japonnais
        sans conversion de caractère. (Vous pouvez choisir autant de
        sources d’entrée que souhaité.)

     5. Reconnectez-vous au compte utilisateur.

     6. Vérifiez le paramétrage par « im-config ».

     7. Spécifiez la source d’entrée par un clic-droit sur l’icône de
        barre d’outils de l’interface graphique.

     8. Choisissez parmi les sources d’entrée installées avec
        SUPER+ESPACE. (en général, SUPER désigne la touche Windows)

    Veuillez noter ce qui suit :

      * im-config(8) se comporte différemment selon que la commande
        est exécutée depuis le compte de l’administrateur ou non.

      * im-config(8) active la meilleure méthode de saisie sur le
        système par défaut sans intervention de l’utilisateur.

      * L’entrée du menu de l’interface graphique pour im-config(8)
        est désactivée par défaut pour éviter de l’encombrer.

%

8.1.3. Désactiver la méthode d’entrée

    Si vous désirez effectuer une entrée sans passer par XIM (le
    mécanisme utilisé par X), définissez la valeur de « $XMODIFIERS »
    à « none » lors du lancement d’un programme. Ce peut être le cas
    si vous utilisez l’infrastructure d’entrée japonaise egg sous 
    emacs(1) alors qu'ibus est désactivé. Depuis l’interpréteur de
    commandes, lancez ce qui suit :

    $ XMODIFIERS=none emacs

    Pour ajuster la commande exécutée par le menu Debian, placez la
    configuration personnalisée dans « /etc/menu/ » en suivant la
    méthode décrite dans « /usr/share/doc/menu/html ».

%

8.2. L’affichage de sortie

    La console Linux ne peut afficher qu’un nombre restreint de
    caractères. (Vous devrez avoir un programme de terminal
    particulier tel que jfbterm(1) pour afficher les langues non
    européennes sur des consoles autres que la console X).

    Le système X Window peut afficher tous les caractères UTF-8 dès
    que les données de polices de caractères existent. (Le codage des
    données de police d’origine est pris en charge par le système X
    Window de manière transparente pour l’utilisateur).

%

8.3. East Asian Ambiguous Character Width Characters

    Under the East Asian locale, the box drawing, Greek, and Cyrillic
    characters may be displayed wider than your desired width to
    cause the unaligned terminal output (see Unicode Standard Annex #
    11).

    You can work around this problem:

      * gnome-terminal: Edit → Preferences → Profiles → Edit →
        Compatibility → Ambiguous-wide characters → Narrow
   
      * ncurses : paramètre l'environnement export
        NCURSES_NO_UTF8_ACS=0.

%

8.4. Les paramètres linguistiques (« locale »)

    Ce qui suit met l’accent sur les paramètres linguistiques pour
    les applications tournant sous l’environnement X Window lancé par
    gdm3(1).

%

8.4.1. Bases du codage

    La variable d’environnement « LANG=xx_YY.ZZZZ » définit les
    paramètres linguistiques avec le code de langue « xx », le code
    de pays « yy » et le codage « ZZZZ » (consultez Section 1.5.2,
    « La variable « $LANG » »).

    Le système Debian actuel définit normalement les paramètres
    linguistiques avec « LANG=xx_YY.UTF-8 ». Cela utilise le codage
    UTF-8 avec le jeu de caractèresUnicode. Ce système de codage
    UTF-8 est un système de code multi-octets qui utilise
    intelligemment les éléments du code. Les données ASCII, qui sont
    uniquement constituées de code sur 7 bits, sont toujours des
    données UTF-8 valables qui ne comportent qu’un octet par
    caractère.

    Le système Debian précédent définissait habituellement les
    paramètres linguistiques avec « LANG=C » ou « LANG=xx_YY » (sans
    « .UTF-8 »).

      * Le jeu de caractères ASCII est utilisé avec « LANG=C » ou
        « LANG=POSIX ».
   
      * Le système de codage traditionnel sous UNIX est utilisé avec
        « LANG=xx_YY ».

    Le système de codage traditionnel actuel utilisé pour « LANG=
    xx_YY » peut être identifié en vérifiant « /usr/share/i18n/
    SUPPORTED ». Par exemple, « en_US » utilise le codage
    « ISO-8859-1 » et « fr_FR@euro » utilise le codage « ISO-8859-15.

    Astuce
   
    Pour la signification des valeurs de codage, consultez
    Tableau 11.2, « Liste de valeurs de codage et leur utilisation ».

8.4.2. Justification de l’utilisation d’UTF-8 dans les paramètres
linguistiques

    L'ensemble de caractères Unicode peut représenter pratiquement
    tous les caractères humainement connus avec une notation codée
    s'entendant de 0 à 10FFFF en notation hexadécimale. Son stockage
    requiert au moins 21 bits.

    Le système d'encodage de texte UTF-8 adapte le code des
    charactères Unicode dans un flux de données 8 bits adapté et
    compatible avec le système de traitement des données ASCII. UTF
    signifie Format de Transformation Unicode (« Unicode
    Transformation Format »).

    Je recommande l’utilisation de paramètres linguistiques UTF-8
    pour votre bureau, par exemple « LANG=fr_FR.UTF-8 ». La première
    partie du paramètre linguistique (« locale ») détermine comment
    les messages seront présentés par les applications. Par exemple, 
    gedit(1) (éditeur de texte pour le Bureau GNOME ) avec le
    paramètre de langue « LANG=fr_FR.UTF-8 » peut afficher et éditer
    des données textuelles avec des caractères chinois tout en
    présentant les menus en français, dans la mesure où les polices
    et les méthodes d’entrée sont installées.

    Je recommande aussi de ne définir que la variable d’environnement
    « $LANG », je ne vois pas beaucoup d’avantages à définir une
    combinaison compliquée de variables « LC_* » (consultez locale(1)
    ) avec les paramètres linguistiques UTF-8.

    Même le texte anglais en texte brut peut contenir des caractères
    non-ASCII, par exemple les guillemets apostrophes culbutés
    gauches et droits ne sont pas disponibles en ASCII.

    “texte entre doubles marques de citation” n'est pas "doubles marques de citation ASCII"
    ‘texte entre simples marques de citation’ n'est pas 'simples marques de citation ASCII'

    Lorsque le texte brut ASCII est converti en UTF-8, il a
    exactement le même contenu et la même taille que le texte
    original en ASCII. Il n’y a donc rien à perdre en mettant en
    œuvre des paramètres régionaux UTF-8.

    Certains programmes utilisent davantage de mémoire lors de
    l’utilisation de I18N. Cela parce qu’ils sont codés avec
    l’utilisation interne d’UTF-32(UCS4) pour la prise en compte
    d’Unicode afin d’optimiser la vitesse, ils utilisent 4 octets
    pour chaque caractère ASCII indépendamment de la « locale »
    sélectionnée. De nouveau, il n’y a rien à perdre en mettant en
    œuvre des paramètres linguistiques UTF-8.

    Les anciens systèmes de codage propriétaires non UTF-8 tendent à
    avoir une différence mineure mais ennuyeuse pour certains
    caractères tels que les caractères graphiques pour de nombreux
    pays. La mise en œuvre du système UTF-8 sur les systèmes
    d’exploitation modernes a pratiquement résolu ces problèmes de
    codage conflictuels.

%

8.4.3. Reconfiguration des paramètres linguistiques

    Pour accéder à un paramètre linguistique particulier, les données
    du paramètre linguistique doivent être compilées à partir de la
    base de données des paramètres linguistiques. (Le système Debian
    n’est pas installé avec tous les paramètres linguistiques
    précompilés à moins que vous n’ayez installé le paquet
    locales-all). La liste complète des paramètres linguistiques pris
    en charge pour être compilés se trouve dans « /usr/share/i18n/
    SUPPORTED ». On y trouve la liste de tous les noms des
    « locale ». La commande ci-après affiche la liste de tous les
    paramètres linguistiques UTF-8 déjà compilés sous forme binaire :

    $ locale -a | grep utf8

    L’exécution de la commande suivante va reconfigurer le paquet
    locales :

    # dpkg-reconfigure locales

    Ce processus se déroule en trois étapes :

     1. mettre à jour la liste des paramètres linguistiques
        disponibles ;

     2. les compiler sous forme binaire ;
   
     3. définir la valeur des paramètres linguistiques par défaut
        pour l’ensemble du système dans « /etc/default/locale » pour
        une utilisation par PAM (consultez Section 4.5, « PAM et
        NSS »).

    La liste des paramètres linguistiques disponibles devra comporter
    « fr_FR.UTF-8 » et toutes les langues intéressantes avec
    « UTF-8 ».

    Pour l’anglais des USA, le paramètre linguistique recommandé est
    « en_US.UTF-8 ». Pour les autres langues, assurez-vous de bien
    choisir une valeur avec « UTF-8 » (NdT : prendre « de_FR.UTF-8 »
    pour la langue française en France) . Les caractères
    internationaux sont tous pris en charge par l’un quelconque de
    ces paramétrages.

    Note
   
    Bien que le paramètre linguistique « C » utilise des messages en
    anglais, il ne prend en compte que les caractères ASCII.

%

8.4.4. Valeur de la variable d’environnement « $LANG »

    La valeur de la variable d’environnement « $LANG » est définie et
    modifiée par de nombreuses applications.

      * Elle est définie au départ par le mécanisme PAM de login(1)
        pour les programmes de console locale de Linux

      * Elle est définie au départ par le mécanisme PAM du
        gestionnaire d’affichage pour tous les programmes X

      * Elle est définie au départ par le mécanisme PAM dessh(1) pour
        les programmes de la console distante

      * Modifiée par certains gestionnaires d’affichage tels que gdm3
        (1) pour tous les programmes X

      * Modifiée par le code de démarrage de la session X par
        l’intermédiaire de « ~/.xsessionrc » pour tous les programmes
        X

      * Modifiée par le code de démarrage de l’interpréteur de
        commandes, par exemple « ~/.bashrc », pour tous les
        programmes de console

    Astuce

    C’est une bonne idée de définir les paramètres linguistiques par
    défaut pour l’ensemble du système à « en_US.UTF-8 » pour un
    maximum de compatibilité.

%

8.4.5. Paramètre linguistique spécifique sous X Window

    Vous pouvez choisir vos paramètres linguistiques spécifiques sous
    X Window indépendamment de leur valeur par défaut valable pour
    l’ensemble du système en utilisant une personnalisation de PAM
    (consultez Section 4.5, « PAM et NSS ») comme suit :.

    Cet environnement devrait vous apporter la meilleure expérience
    d’environnement de bureau stable. Vous avez accès à un terminal
    en mode caractères fonctionnel avec des messages lisibles même
    lorsque le système X Window ne fonctionne pas. Cela devient
    essentiel pour des langues qui utilisent des caractères non
    romains tels que le chinois, le japonais et le coréen.

    Note

    Il peut exister une autre manière comme l’amélioration du paquet
    de gestion de session de X mais veuillez lire ce qui suit qui est
    la méthode générique et basique pour définir les paramètres
    linguistiques. Pour gdm3(1), je sais que l’on peut sélectionner
    la « locale » de la session X par l’intermédiaire de son memu.

    La ligne suivante définit l’emplacement du fichier de
    l’environnement de langue dans le fichier de configuration de
    PAM, tels que « /etc/pam.d/gdm3 » :

    auth    required        pam_env.so read_env=1 envfile=/etc/default/locale

    Modifiez-la avec ce qui suit :

    auth    required        pam_env.so read_env=1 envfile=/etc/default/locale-x

    Pour le japonais, créez un fichier « /etc/default/locale-x » avec
    les permissions « -rw-r--r-- 1 root root » et contenant ce qui
    suit :

    LANG="ja_JP.UTF-8"

    Conservez le fichier « /etc/default/locale » suivant par défaut
    pour les autres programmes :

    LANG="en_US.UTF-8"

    C’est la technique la plus générique pour personnaliser les
    paramètres linguistiques et faire que la fenêtre du menu de
    sélection de gdm3(1) lui-même soit affichée dans la bonne langue.

    Pour ce cas, vous pouvez aussi simplement modifier les paramètres
    linguistiques en utilisant le fichier « ~/.xsessionrc ».

%

8.4.6. Coder les noms de fichiers

    Pour les échanges de données entre plateformes (consultez
    Section 10.1.7, « Périphériques d’enregistrement amovibles »), il
    vous faudra peut-être monter certains systèmes de fichiers ayant
    un codage particulier. Par exemple, , la commande mount(8) pour
    un système de fichiers vfat suppose que l’on utilise CP437 si on
    l’utilise sans option. Vous devrez fournir les options explicites
    à mount pour utiliser des noms de fichiers codés en UTF-8 ou en
    CP932.

    Note

    Lors du montage automatique d’un clé USB pouvant être branchée à
    chaud sur un environnement de bureau moderne comme GNOME, vous
    pouvez indiquer ces options de montage avec un clic-droit sur
    l’icône du bureau. Cliquez l’onglet « Drive », cliquez
    « Paramètres » pour l’étendre et entrez « utf8 » dans « Options
    de montage ». La prochaine fois que vous monterez cette clé
    mémoire, le montage avec UTF-8 sera activé.

    Note

    Si vous êtes en train de mettre à jour le système ou de déplacer
    des disques depuis un ancien système qui n’était pas UTF-8, les
    noms de fichiers avec des caractères non ASCII peuvent être codés
    avec des codages historiques et obsolètes tels que ISO-8859-1 ou
    eucJP. Veuillez consulter l’aide des outils de conversion de
    texte pour les convertir en UTF-8. Consultez Section 11.1,
    « Outils de conversion de données textuelles ».

    Samba utilise Unicode pour les clients les plus récents (Windows
    NT, 200x, XP) mais utilise par défaut CP850 pour des clients plus
    anciens (DOS et Windows 9x/Me). Cette valeur par défaut pour les
    anciens clients peut être modifiée en utilisant « dos charset »
    dans le fichier « /etc/samba/smb.conf », par exemple, avecCP932
    pour le japonais.

%

8.4.7. Messages et documentation traduits

    Il existe des traductions de nombreux messages et documents
    affichés par le système Debian, comme les messages d’erreur, la
    sortie standard des programmes,les menus et les pages de manuel.
    La GNU gettext(1) command tool chain est utilisé comme outil de
    base pour la plupart des activités de traduction.

    Dans « Tâches » → « Localisation » aptitude(8) fournit une liste
    exhaustive de paquets binaires utiles qui ajoutent les
    traductions de messages aux applications et fournissent de la
    documentation traduite.

    Vous pouvez, par exemple, obtenir les messages traduits pour une
    page de manuel en installant le paquet manpages-<LANG>. Pour lire
    la page de manuel de <nom_programme> en italien depuis « /usr/
    share/man/it/ », lancez le programme de la manière suivante :

    LANG=it_IT.UTF-8 man <nom_programme>

%

8.4.8. Effet des paramètres linguistiques

    L’ordre de tri des caractères avec sort(1) est affecté par le
    choix de la langue des paramètres linguistiques. Les paramètres
    linguistiques espagnol et anglais effectuent le tri de manière
    différente.

    Le format de date de ls(1) est affecté par les paramètres
    linguistiques. Les formats de date de « LANG=C ls -l » et « LANG=
    en_US.UTF-8 » sont différents (consultez Section 9.2.5,
    « Affichage personnalisé de la date et de l’heure »).

    La ponctuation des nombres est différente selon les paramètres
    linguistiques.Par exemple, avec les paramètres linguistiques
    anglais, Mille un est affiché sous la forme « 1,000.1 » alors
    qu’avec les paramètres linguistiques allemands ce sera
    « 1.000,1 ». Vous pouvez voir cette différence dans un programme
    de feuille de calculs.

Chapitre 9. Astuces du système

    Je décris ici les astuces de base pour configurer et gérer les
    systèmes, la plupart depuis la console.

%

9.1. Le programme screen

    screen(1) est un outil très utile pour ceux qui accèdent à un
    site distant par l’intermédiaire d’une connexion non fiable ou
    intermittente car il gère les interruptions de connexion au
    réseau.

    Tableau 9.1. Liste de programmes gérant les interruptions de
    connexion au réseau

    +---------------------------------------------------------------+
    |paquet|popcon |taille|               description               |
    |------+-------+------+-----------------------------------------|
    |screen|V:127, |1013  |multiplexeur de terminal avec une        |
    |      |I:281  |      |émulation de terminal VT100/ANSI         |
    |------+-------+------+-----------------------------------------|
    |tmux  |V:34,  |830   |terminal multiplexer alternative (Use    |
    |      |I:136  |      |"Control-B" instead)                     |
    +---------------------------------------------------------------+


%

9.1.1. Scénario d’utilisation de screen(1)

    screen(1) ne permet pas uniquement de faire tourner plusieurs
    processus dans une fenêtre de terminal, mais aussi à un processus
    de l’interpréteur de commandes distant de survivre à
    d’éventuelles interruptions de la connexion. Voici un scénario
    typique de screen(1) :

     1. vous-vous connectez à une machine distante ;

     2. vous démarrez screen sur une seule console ;

     3. vous exécutez plusieurs programmes dans les fenêtres screen
        créées avec ^A c (« Ctrl-A » suivi de « c ») ;

     4. vous passez d’une des fenêtres multiples de screen à l’autre
        avec ^A n (« Ctrl-A » suivi de « n ») ;

     5. vous avez alors besoin de quitter votre terminal, mais vous
        ne voulez pas perdre votre travail en cours perdant la
        connexion.

     6. vous pouvez détacher la session screen par différentes
        méthodes :

          + débrancher brutalement votre connexion réseau ;

          + entrer ^A d (« Ctrl-A » suivi de « d ») et en quittant
            manuellement la connexion distante :

          + entrer ^A DD (« Ctrl-A » suivi de « DD ») pour détacher
            screen et vous déconnecter.

     7. Vous vous reconnectez à la même machine distante (même depuis
        un autre terminal) ;

     8. Vous lancez screen avec « screen -r » ;

     9. screen réattache magiquement toutes les fenêtres screen
        précédentes avec tous les programmes qui y tournent.

    Astuce

    Avec screen, vous pouvez économiser des frais de connexion pour
    les connexions limitées, telles que les connexion commutées ou
    par paquets, parce que vous laissez un processus actif alors que
    vous êtes déconnecté. Vous pouvez le ré-attacher plus tard,
    lorsque vous vous reconnectez.

%

9.1.2. Raccourcis clavier de la commande screen

    Dans une session screen, toutes les entrées clavier sont envoyées
    vers votre fenêtre actuelle sauf les séquences de touche de
    commande. Toutes les séquences de touche de commande screen sont
    entrées par ^A (« Ctrl-A ») suivi d’un seule touche [plus les
    paramètres]. Voici celles dont il est important de se souvenir.

    Tableau 9.2. Liste des raccourcis clavier de screen

    +---------------------------------------------------------------+
    |affectation|                   signification                   |
    |-----------+---------------------------------------------------|
    |^A ?       |afficher l’aide de screen (afficher les raccourcis |
    |           |clavier)                                           |
    |-----------+---------------------------------------------------|
    |^A c       |créer une nouvelle fenêtre et basculer vers        |
    |           |celle-ci                                           |
    |-----------+---------------------------------------------------|
    |^A n       |aller à la fenêtre suivante                        |
    |-----------+---------------------------------------------------|
    |^A p       |aller à la fenêtre précédente                      |
    |-----------+---------------------------------------------------|
    |^A 0       |aller à la fenêtre 0                               |
    |-----------+---------------------------------------------------|
    |^A 1       |aller à la fenêtre 1                               |
    |-----------+---------------------------------------------------|
    |^A w       |afficher la liste des fenêtres                     |
    |-----------+---------------------------------------------------|
    |^A a       |envoyer un Ctrl-A à la fenêtre actuelle en tant    |
    |           |qu’entrée clavier                                  |
    |-----------+---------------------------------------------------|
    |^A h       |écrire dans un fichier une copie de la fenêtre     |
    |           |actuelle                                           |
    |-----------+---------------------------------------------------|
    |^A H       |commencer et finir l’enregistrement de la fenêtre  |
    |           |en cours vers un fichier                           |
    |-----------+---------------------------------------------------|
    |^A ^X      |verrouiller le terminal (protégé par un mot de     |
    |           |passe)                                             |
    |-----------+---------------------------------------------------|
    |^A d       |détacher la session screen du terminal             |
    |-----------+---------------------------------------------------|
    |^A DD      |détacher la session screen et se déconnecter       |
    +---------------------------------------------------------------+


    Consultez screen(1) pour davantage d’informations.

9.2. Enregistrer et présenter des données

%

9.2.1. Le démon de journal

    De nombreux programmes enregistrent leur activité dans le
    répertoire « /var/log/ ».

      * Démon de journal du système : rsyslogd(8)

    Consultez Section 3.2.5, « Messages du système » et
    Section 3.2.4, « Messages du noyau ».

%

9.2.2. Analyseur de journaux

    Voici les principaux analyseurs de journaux
    (« ~Gsecurity::log-analyzer » dans aptitude(8)).

    Tableau 9.3. Liste des analyseurs de journaux système

    +---------------------------------------------------------------+
    |    paquet    |popcon|taille|           description            |
    |--------------+------+------+----------------------------------|
    |logwatch      |V:16, |2265  |analyseur de journal avec une     |
    |              |I:18  |      |sortie sympathique en Perl        |
    |--------------+------+------+----------------------------------|
    |              |V:112,|      |bannir les IP qui provoquent des  |
    |fail2ban      |I:123 |2092  |erreurs d’authentification        |
    |              |      |      |multiples                         |
    |--------------+------+------+----------------------------------|
    |analog        |V:4,  |3534  |analyseur des journaux du serveur |
    |              |I:109 |      |web                               |
    |--------------+------+------+----------------------------------|
    |              |V:9,  |      |analyseur des journaux du serveur |
    |awstats       |I:15  |6910  |web puissant ayant de nombreuses  |
    |              |      |      |fonctionnalités                   |
    |--------------+------+------+----------------------------------|
    |sarg          |V:3,  |843   |générateur de rapport d’analyse de|
    |              |I:3   |      |squid                             |
    |--------------+------+------+----------------------------------|
    |pflogsumm     |V:1,  |111   |résumer les entrées de journal de |
    |              |I:4   |      |postfix                           |
    |--------------+------+------+----------------------------------|
    |syslog-summary|V:0,  |30    |résumer le contenu du fichier     |
    |              |I:2   |      |journal syslog                    |
    |--------------+------+------+----------------------------------|
    |fwlogwatch    |V:0,  |479   |analyseur des journaux du pare-feu|
    |              |I:0   |      |                                  |
    |--------------+------+------+----------------------------------|
    |squidview     |V:0,  |189   |surveiller et analyser les        |
    |              |I:1   |      |fichiers access.log de squid      |
    |--------------+------+------+----------------------------------|
    |              |      |      |visualisateur de fichier journal  |
    |swatch        |V:0,  |101   |avec correspondance d’expressions |
    |              |I:0   |      |rationnelles, mise en évidence et |
    |              |      |      |« hooks »                         |
    |--------------+------+------+----------------------------------|
    |              |V:0,  |      |analyseur et filtre de données    |
    |crm114        |I:0   |1119  |diverses, dont les pourriels      |
    |              |      |      |(CRM114)                          |
    |--------------+------+------+----------------------------------|
    |icmpinfo      |V:0,  |44    |interpréter les messages ICMP     |
    |              |I:0   |      |                                  |
    +---------------------------------------------------------------+


    Note

    CRM114 fournit une architecture de vocabulaire pour écrire des
    filtres fuzzy avec la bibliothèque d’expressions rationnelles
    TRE. Une de ses utilisations courantes est le filtrage des
    pourriels mais il peut aussi être utilisé pour l’analyse de
    journaux.

%

9.2.3. Enregistrer proprement l’activité de la console

    La simple utilisation de script(1) (consultez Section 1.4.9,
    « Enregistrer les actions de l’interpréteur de commandes ») pour
    enregistrer l’activité de l’interpréteur de commandes produit un
    fichier avec des caractères de contrôle. Cela peut être évité en
    utilisant col(1) comme suit :

    $ script
    Script started, file is typescript

    faites quelque chose… et pressez Ctrl-D pour quitter script.

    $ col -bx <typescript >fichier_propre
    $ vim fichier_propre

    si vous n’avez pas script (par exemple pendant le processus
    d’amorçage dans l’initramfs), vous pouvez alors utiliser ce qui
    suit :

    $ sh -i 2>&1 | tee typescript

    Astuce

    Certains émulateurs de terminaux X tels que gnome-terminal
    peuvent faire de l’enregistrement. Il faudra peut-être augmenter
    la taille du tampon de lignes pour le défilement vers l’arrière.

    Astuce

    Vous pouvez utiliser screen(1) avec « ^A H » (consultez
    Section 9.1.2, « Raccourcis clavier de la commande screen ») pour
    effectuer des enregistrement de la console.

    Astuce

    Vous pouvez utiliser emacs(1) avec « M-x shell », « M-x eshell »
    ou « M-x term » pour effectuer l’enregistrement de la console.
    Vous pourrez ensuite utiliser « C-x C-w » pour enregistrer le
    tampon dans un fichier.

%

9.2.4. Affichage personnalisé des données de texte

    Bien que des outils de visualisation de texte (« pager » tels que
    more(1) et less(1) (consultez Section 1.4.5, « Le visualisateur
    de fichiers ») et des outils personnalisés de mise en évidence et
    de formatage (consultez Section 11.1.8, « Mettre en évidence et
    formater des données en texte brut ») peuvent afficher des
    données textuelles de manière agréable, les éditeurs généralistes
    (consultez Section 1.4.6, « L’éditeur de texte ») sont plus
    souples et paramétrables.

    Astuce
   
    Pour vim(1) et ses alias de visualisation de texte view(1),
    « :set hls » active la recherche avec mise en évidence.

%

9.2.5. Affichage personnalisé de la date et de l’heure

    Le format par défaut de la date et de l’heure de la commande
    « "ls -l » dépend des paramètres régionaux (consultez la valeur
    en Section 1.2.6, « Horodatage »). La variable « $LANG » est
    d’abord visée, elle peut être surchargée par la variable
    « $LC_TIME ».

    Le format réel de l’affichage pour chaque paramètre linguistique
    dépend de la version de la bibliothèque C standard (paquet libc6)
    utilisée. Par exemple, les différentes versions de Debian ont des
    valeurs par défaut différentes.

    Si vous désirez vraiment personnaliser ce format d’affichage de
    la date et de l’heure plus loin que ne le fait locale, vous
    pouvez définir la valeur de style d’heure avec le paramètre
    « --time-style » ou par la valeur de « $TIME_STYLE » (consultez 
    ls(1), date(1), « info coreutils 'ls invocation' »).

    Tableau 9.4. Exemples d’affichage de la date et de l’heure pour
    la commande « ls -l » avec wheezy

    +---------------------------------------------------------------+
    |valeur de style pour |    locale    | affichage de la date et  |
    |       l’heure       |              |         l’heure          |
    |---------------------+--------------+--------------------------|
    |iso                  |n’importe     |01-19 00:15               |
    |                     |laquelle      |                          |
    |---------------------+--------------+--------------------------|
    |long-iso             |n’importe     |2009-01-19 00:15          |
    |                     |laquelle      |                          |
    |---------------------+--------------+--------------------------|
    |full-iso             |n’importe     |2009-01-19                |
    |                     |laquelle      |00:15:16.000000000 +0900  |
    |---------------------+--------------+--------------------------|
    |locale               |C             |Jan 19 00:15              |
    |---------------------+--------------+--------------------------|
    |locale               |en_US.UTF-8   |Jan 19 00:15              |
    |---------------------+--------------+--------------------------|
    |locale               |es_ES.UTF-8   |ene 19 00:15              |
    |---------------------+--------------+--------------------------|
    |+%d.%m.%y %H:%M      |n’importe     |19.01.09 00:15            |
    |                     |laquelle      |                          |
    |---------------------+--------------+--------------------------|
    |+%d.%b.%y %H:%M      |C ou          |19.Jan.09 00:15           |
    |                     |en_US.UTF-8   |                          |
    |---------------------+--------------+--------------------------|
    |+%d.%b.%y %H:%M      |es_ES.UTF-8   |19.ene.09 00:15           |
    +---------------------------------------------------------------+


    Astuce

    Vous pouvez éviter d’entrer des options longues sur la ligne de
    commande en utilisant les alias de commande, par exemple « alias
    ls='ls --time-style=+%d.%m.%y\ %H:%M' » (consultez Section 1.5.9,
    « Alias de commande »).

    Astuce
   
    ISO 8601 est suivie pour ces formats iso.

%

9.2.6. Écho colorisé de l’interpréteur de commandes

    L’écho de l’interpréteur de commandes sur la plupart des
    terminaux peut être colorisé en utilisant le code ANSI
    d’échappement (consultez « /usr/share/doc/xterm/
    ctlseqs.txt.gz »).

    Essayez, par exemple, ce qui suit :

    $ ROUGE=$(printf "\x1b[31m")
    $ NORMAL=$(printf "\x1b[0m")
    $ INVERSE=$(printf "\x1b[7m")
    $ echo "${ROUGE}TEXTE-ROUGE${NORMAL} ${INVERSE}TEXTE-INVERSE${NORMAL}"

%

9.2.7. Commandes colorisées

    Les commandes colorisées sont pratiques pour examiner la sortie
    d’une commande dans l’environnement interactif. J’inclus ce qui
    suit dans mon fichier « ~/.bashrc ».

    if [ "$TERM" != "dumb" ]; then
        eval "`dircolors -b`"
        alias ls='ls --color=always'
        alias ll='ls --color=always -l’
        alias la='ls --color=always -A'
        alias less='less -R'
        alias ls='ls --color=always'
        alias grep='grep --color=always'
        alias egrep='egrep --color=always'
        alias fgrep='fgrep --color=always'
        alias zgrep='zgrep --color=always'
    else
        alias ll='ls -l’
        alias la='ls -A'
    fi

    L’utilisation d’alias réserve les effets de couleurs à
    l’utilisation interactives des commandes. Il a l’avantage sur
    l’exportation de la variable d’environnement « export
    GREP_OPTIONS='--color=auto' » car la couleur peut être affichée
    avec des programmes de visualisation (« pager » tels que less(1).
    Si vous souhaitez supprimer la couleur lors du tubage (« piping »
    à destination d’autres programmes, utilisez plutôt « --color=
    auto » dans l’exemple ci-dessus pour « ~/.bashrc ».

    Astuce
   
    Vous pouvez désactiver ces alias dans l’environnement interactif
    en appelant l’interpréteur de commandes par « TERM=dumb bash ».

9.2.8. Enregistrer l’activité de l’éditeur pour des répétitions
complexes

    Vous pouvez enregistrer l’activité de l’éditeur pour des
    répétitions complexes.

    Pour Vim, de la manière suivante :

      * « qa » : démarre l’enregistrement des caractères entrés dans
        le registre appelé « a ».

      * … activité de l’éditeur

      * « q » : termine l’enregistrement des caractères entrés.

      * « @a » : exécute le contenu du registre « a ».

    Pour Emacs, de la manière suivante :

      * « :C-x ( » : commencer la définition d’une macro clavier.

      * … activité de l’éditeur
   
      * « C-x ) » : terminer la définition d’une macro clavier.

      * « C-x e » : exécuter une macro clavier.

%

9.2.9. Enregistrer l’image graphique d’une application X

    Il existe plusieurs manières d’enregistrer l’image graphique
    d’une application X, y compris un affichage xterm.

    Tableau 9.5. Liste des outils de manipulation d’images

    +------------------------------------------------------------+
    |   paquet    |  popcon   |taille|         commande          |
    |-------------+-----------+------+---------------------------|
    |xbase-clients|I:26       |46    |xwd(1)                     |
    |-------------+-----------+------+---------------------------|
    |gimp         |V:68, I:341|22313 |Interface graphique du menu|
    |-------------+-----------+------+---------------------------|
    |imagemagick  |I:400      |218   |import(1)                  |
    |-------------+-----------+------+---------------------------|
    |scrot        |V:8, I:80  |70    |scrot(1)                   |
    +------------------------------------------------------------+


9.2.10. Enregistrer les modifications dans des fichiers de
configuration

    Il existe des outils spécialisés pour enregistrer les
    modifications de la configuration avec l’aide du système DVCS.

    Tableau 9.6. Liste de paquets pour enregistrer un historique de
    configuration dans VCS

    +---------------------------------------------------------------+
    |  paquet   |popcon|taille|             description             |
    |-----------+------+------+-------------------------------------|
    |           |      |      |enregistrer les fichiers de          |
    |etckeeper  |V:27, |162   |configuration et leurs métadonnées   |
    |           |I:32  |      |avec Git (par défaut), Mercurial ou  |
    |           |      |      |Bazaar (nouveau)                     |
    |-----------+------+------+-------------------------------------|
    |changetrack|V:0,  |71    |enregistrer les fichiers de          |
    |           |I:0   |      |configuration avec RCS (ancien)      |
    +---------------------------------------------------------------+


    Je recommande l’utilisation avec git(1) du paquet etckeeper, il
    met l’ensemble de « /etc » sous le contrôle de VCS. Son guide
    d’installation et un tutoriel se trouvent dans « /usr/share/doc/
    etckeeper/README.gz ».

    Essentiellement, l’exécution de « sudo etckeeper init »
    initialise le dépôt git pour « /etc » exactement comme le
    processus décrit dans Section 10.6.5, « Git pour l’enregistrement
    de l’historique de la configuration » mais avec quelques scripts
    automatiques (« hook ») permettant une configuration plus
    approfondie.

    Alors que vous effectuez des modifications de votre
    configuration, vous pouvez aussi utiliser git(1) normalement pour
    l’enregistrer. Il enregistre parfaitement les modifications
    chaque fois que vous lancez des commandes de gestion de paquet.

    Astuce

    Vous pouvez parcourir l’historique des modifications de « /etc »
    en exécutant « sudo GIT_DIR=/etc/.git gitk » avec une vue claire
    des nouveaux paquets installés et les changements de version des
    paquets.

%

9.3. Surveiller, contrôler et démarrer l’activité des programmes

    L’activité des programmes peut être surveillée et contrôlée à
    l’aide d’outils spécialisés.

    Tableau 9.7. Liste des outils de surveillance et de contrôle de
    l’activité des programmes

    +---------------------------------------------------------------+
    | paquet  |popcon|taille|              description              |
    |---------+------+------+---------------------------------------|
    |coreutils|V:891,|17478 |nice(1) : lancer un programme avec une |
    |         |I:999 |      |priorité d’ordonnancement modifiée     |
    |---------+------+------+---------------------------------------|
    |         |V:673,|      |renice(1) : modifier la priorité       |
    |bsdutils |I:999 |393   |d’ordonnancement d’un programme en     |
    |         |      |      |cours d’exécution                      |
    |---------+------+------+---------------------------------------|
    |         |V:739,|      |utilitaires du système de fichiers « / |
    |procps   |I:999 |792   |proc » : ps(1), top(1), kill(1), watch |
    |         |      |      |(1), …                                 |
    |---------+------+------+---------------------------------------|
    |         |V:427,|      |utilitaires du système de fichiers « / |
    |psmisc   |I:845 |679   |proc » : killall(1), fuser(1), peekfd  |
    |         |      |      |(1), pstree(1)                         |
    |---------+------+------+---------------------------------------|
    |         |V:15, |      |time(1) : lancer un programme qui      |
    |time     |I:279 |82    |indique l’utilisation des ressources du|
    |         |      |      |système en fonction du temps           |
    |---------+------+------+---------------------------------------|
    |         |V:161,|      |sar(1), iostat(1), mpstat(1), … :      |
    |sysstat  |I:183 |1918  |outils de mesure des performances du   |
    |         |      |      |système pour Linux                     |
    |---------+------+------+---------------------------------------|
    |isag     |V:0,  |116   |Générateur interactif de graphes de    |
    |         |I:3   |      |l’activité système pour sysstat        |
    |---------+------+------+---------------------------------------|
    |         |      |      |lsof(8) : afficher la liste des        |
    |lsof     |V:391,|451   |fichiers ouverts par un processus en   |
    |         |I:946 |      |cours d’utilisation en utilisant       |
    |         |      |      |l’option « -p                          |
    |---------+------+------+---------------------------------------|
    |strace   |V:16, |2367  |strace(1) : tracer les appels système  |
    |         |I:153 |      |et les signaux                         |
    |---------+------+------+---------------------------------------|
    |ltrace   |V:1,  |363   |ltrace(1) : tracer les appels de       |
    |         |I:21  |      |bibliothèque                           |
    |---------+------+------+---------------------------------------|
    |xtrace   |V:0,  |353   |xtrace(1) : tracer la communication    |
    |         |I:0   |      |entre un client X11 et le serveur      |
    |---------+------+------+---------------------------------------|
    |powertop |V:9,  |662   |powertop(1) : information concernant la|
    |         |I:217 |      |puissance électrique utilisée          |
    |---------+------+------+---------------------------------------|
    |         |V:805,|      |faire tourner des processus en arrière |
    |cron     |I:997 |263   |plan selon un calendrier depuis le     |
    |         |      |      |démon cron(8)                          |
    |---------+------+------+---------------------------------------|
    |         |V:409,|      |ordonnanceur de type cron pour les     |
    |anacron  |I:482 |99    |systèmes qui ne tournent pas 24 heures |
    |         |      |      |sur 24                                 |
    |---------+------+------+---------------------------------------|
    |         |V:162,|      |at(1) ou batch(1) : lancer un travail à|
    |at       |I:310 |161   |une heure déterminée ou en dessous d’un|
    |         |      |      |niveau de charge donné                 |
    +---------------------------------------------------------------+


    Astuce

    Le paquet procps fournit des fonctions très basiques de
    surveillance, de contrôle et de lancement des activités du
    programme. Vous devriez toutes les apprendre.

%

9.3.1. Temps d’un processus

    Afficher la durée du processus indiqué dans la commande.

    # time une_commande >/dev/null
    real    0m0.035s       # temps horloge (temps réel écoulé)
    user    0m0.000s       # temps en mode utilisateur
    sys     0m0.020s       # temps en mode noyau

%

9.3.2. La priorité d’ordonnancement

    Une valeur de politesse (« nice » est utilisée pour contrôler la
    priorité d’ordonnancement du processus.

    Tableau 9.8. Liste des valeurs de politesse pour la priorité
    d’ordonnancement

    +---------------------------------------------------------------+
    |   valeur de    |          priorité d’ordonnancement           |
    |   politesse    |                                              |
    |----------------+----------------------------------------------|
    |19              |la plus basse priorité d’un processus (poli)  |
    |----------------+----------------------------------------------|
    |0               |très haute priorité de processus pour un      |
    |                |utilisateur                                   |
    |----------------+----------------------------------------------|
    |-20             |très haute priorité d’un processus pour root  |
    |                |(non poli)                                    |
    +---------------------------------------------------------------+


    # nice  -19 top                                      # très poli
    # nice --20 wodim -v -eject speed=2 dev=0,0 disk.img # très rapide

    Parfois, une valeur extrême de politesse (« nice ») fait plus de
    mal que de bien au système. Utilisez cette commande avec
    précaution.

%

9.3.3. La commande ps

    La commande ps(1) sous Debian comporte à la fois les
    fonctionnalités de BSD et de SystemV, elle aide à identifier
    l’activité des processus de manière statique.

    Tableau 9.9. Liste des styles de la commande ps

    +--------------------------------------------+
    | style  |commande typique|     fonction     |
    |--------+----------------+------------------|
    |BSD     |ps aux          |afficher %CPU %MEM|
    |--------+----------------+------------------|
    |System V|ps -efH         |afficher le PPID  |
    +--------------------------------------------+


    Les processus fils zombies (« defunct ») peuvent être tués par
    l’identifiant du processus parent identifié dans le champ
    « PPID »

    La commande pstree(1) affiche une arborescence des processus.

%

9.3.4. La commande top

    top(1) sous Debian a de riches fonctionnalités et aide à
    identifier de manière dynamique quels sont les processus qui ont
    une activité curieuse.

    It is an interactive full screen program. You can get its usage
    help press by pressing the "h"-key and terminate it by pressing
    the "q"-key.

%

9.3.5. Afficher les fichier ouverts par un processus

    Vous pouvez afficher la liste des fichiers ouverts par un
    processus avec un identifiant de processus (PID), par exemple de
    1 en faisant ce qui suit :

    $ sudo lsof -p 1

    PID=1 est habituellement le programme init.

%

9.3.6. Tracer l’activité d’un programme

    Vous pouvez tracer l’activité d’un programme avec strace(1), 
    ltrace(1) ou xtrace(1) pour les appels système, les appels
    bibliothèque ou la communication entre le serveur et le client
    X11.

    Vous pouvez tracer les appels système de la commande ls de la
    manière suivante :

    $ sudo strace ls

9.3.7. Identification des processus qui utilisent des fichiers ou des
sockets

    Vous pouvez aussi identifier les processus qui utilisent des
    fichiers par fuser(1), par exemple pour « /var/log/mail.log » en
    faisant ce qui suit :

    $ sudo fuser -v /var/log/mail.log
                         UTIL.       PID ACCÈS  COMMANDE
    /var/log/mail.log:   root       2946 F.... rsyslogd

    Vous voyez que le fichier « /var/log/mail.log » est ouvert en
    écriture par la commande rsyslogd(8).

    Vous pouvez aussi identifier les processus qui utilisent des
    sockets par fuser(1), par exemple, pour « smtp/tcp » par ce qui
    suit :

    $ sudo fuser -v smtp/tcp
                         USER        PID ACCESS COMMAND
    smtp/tcp:            Debian-exim   3379 F.... exim4

    Vous savez maintenant que exim4(8) tourne sur votre système pour
    gérer les connexions TCP du port SMTP (25).

%

9.3.8. Répéter une commande avec un intervalle constant

    watch(1) execute un programme de manière répétitive avec un
    intervalle constant tout en affichant sa sortie en plein écran.

    $ watch w

    Cela permet l’affichage, mis à jour toutes les deux secondes, de
    qui est connecté au système.

%

9.3.9. Répéter une commande en bouclant entre des fichiers

    Il existe plusieurs manières de répéter une boucle de commande
    entre des fichiers correspondant à une condition, par exemple,
    correspondant au motif « glob » « *.ext ».

      * Méthode de la boucle « for» » de l’interpréteur de commandes
        (consultez Section 12.1.4, « Boucles de l’interpréteur de
        commandes ») :

    for x in *.ext; do if [ -f "$x"]; then commande "$x" ; fi; done

      * combinaison de find(1) et de xargs(1) :

    find . -type f -maxdepth 1 -name '*.ext' -print0 | xargs -0 -n 1 commande

      * find(1) avec l’option « -exec » avec une commande :

    find . -type f -maxdepth 1 -name '*.ext' -exec commande '{}' \;

      * find(1) avec l’option « -exec » avec un court script de
        l’interpréteur :

    find . -type f -maxdepth 1 -name '*.ext' -exec sh -c "commande '{}' && echo 'succès'" \;

    Les exemple ci-dessus ont été écrits afin d’assurer une prise en
    compte correcte de noms de fichiers étranges tels que ceux qui
    comportent des espaces. Consultez Section 10.1.5, « Idiomes pour
    la sélection de fichiers » pour une utilisation avancée de find
    (1).

%

9.3.10. Lancer un programme depuis l’interface graphique

    Pour l'interface en ligne de commande (CLI), le premier programme
    trouvé dans les répertoires spécifiés dans la variable
    d'environnement $PATH, et dont le nom correspond, est exécuté.
    Voir Section 1.5.3, « La variable « $PATH » »

    Pour l'interface utilisateur graphique (GUI) conforme aux
    standards freedesktop.org, le fichier *.desktop présent dans le
    répertoire /usr/share/applications fournit les attributs
    nécessaires à l'affichage de chaque programme dans le menu
    graphique (GUI). Voir Section 7.2.2, « Menu de Freedesktop.org »

    Par exemple, le fichier chromium.desktop définit les attributs
    pour le "Navigateur Web Chromium" tel que "Name" pour le nom du
    programme, "Exec" pour le chemin et les paramètres d'exécution du
    programme, "Icon" pour l'icône utilisée, etc. (voir la
    Spécification d'Entrée de fichier Desktop) comme suit :

    [Desktop Entry]
    Version=1.0
    Name=Navigateur Web Chromium
    GenericName=Navigateur Web
    Comment=Access Internet
    Comment[fr]=Explorer le Web
    Exec=/usr/bin/chromium %U
    Terminal=false
    X-MultipleArgs=false
    Type=Application
    Icon=chromium
    Categories=Network;WebBrowser;
    MimeType=text/html;text/xml;application/xhtml_xml;x-scheme-handler/http;x-scheme-handler/https;
    StartupWMClass=Chromium
    StartupNotify=true

    Ceci est une description extrêmement simplifiée. Les fichiers
    *.desktop sont analysés comme suit:

    L'environnement de bureau définit les variables d'environnement
    $XDG_DATA_HOME et $XDG_DATA_DIR. Par exemple, sous GNOME 3 :

      * « $XDG_DATA_HOME » n'est pas paramétré. (La valeur par défaut
        de « $HOME/.local/share » est utilisée.)
   
      * « $XDG_DATA_DIRS » est paramétré à « /usr/share/gnome:/usr/
        local/share/:/usr/share/ ».

    Les répertoires de base (voir Spécification du répertoire de base
    XDG et les répertoires des « applications » sont donc les
    suivants :

      * $HOME/.local/share/ → $HOME/.local/share/applications

      * /usr/share/gnome/ → /usr/share/gnome/applications/
   
      * /usr/local/share/ → /usr/local/share/applications

      * /usr/share/ → /usr/share/applications

    Les fichiers *.desktop sont parcourus dans ces répertoires
    applications dans cet ordre.

    Astuce

    Une entrée de menu « graphique » personnalisée peut être créée en
    ajoutant un fichier « *.desktop » dans le dossier « $HOME/.local/
    share/applications/ ».

    Astuce

    De la même façon, si un fichier « *.desktop » est créé dans le
    répertoire « autostart » dans ces répertoires de base, le
    programme spécifié dans le fichier « *.desktop » est exécuté
    automatiquement lorsque l'environnement de bureau est démarré.
    Consultez la Spécification de démarrage automatique
    d'applications.;

    Astuce

    De la même façon, si un fichier « *.desktop » est créé dans le
    répertoire « $HOME/Desktop » et que l'environnement de bureau est
    configuré afin de prendre en charge l'exécution depuis une icône
    de bureau, le programme qui y est spécifié est exécuté lorsqu'on
    clique sur l'icône. Veuillez noter que le nom du répertoire
    « $HOME/Desktop » est dépendant de la localisation. Consultez 
    xdg-user-dirs-update(1).

%

9.3.11. Personnaliser le programme à lancer

    Certains programmes lancent automatiquement d’autres programmes.
    Voici des points-clés pour la personnalisation de ce processus :

      * Menu de configuration des applications :

          + bureau GNOME : « Paramètres » → « Système » → « Détails »
            → « Applications par défaut »

          + bureau KDE : « K » → « Centre de contrôle » →
            « Composants KDE » → « Sélection de composant »

          + navigateur Iceweasel : « Éditer » → « Préférences » →
            « Applications »

          + mc(1) : « /etc/mc/mc.ext »

      * des variables d’environnement telles que « $BROWSER »,
        « $EDITOR », « $VISUAL » et « $PAGER » (consultez eviron(7))

      * le système update-alternatives(1) pour des programmes tels
        que « editor », « view », « x-www-browser »,
        « gnome-www-browser » et « www-browser » (consultez
        Section 1.4.7, « Définir un éditeur de texte par défaut »)

      * le contenu des fichiers « ~/.mailcap » et « /etc/mailcap »
        qui associe un type MIME avec un programme (consultez mailcap
        (5))

      * le contenu des fichiers « ~/.mime.types » et « /etc/
        mime.types » qui associe l’extension du nom de fichier avec
        un type MIME (consultez run-mailcap(1))

    Astuce

    update-mime(8) met à jour le fichier ≤ /etc/mailcap » en
    utilisant le fichier « /etc/mailcap.order » (consultez 
    mailcap.order(5)).

    Astuce

    Le paquet debianutils fournit sensible-browser(1), 
    sensible-editor(1), et sensible-pager(1) qui prennent des
    décisions raisonnables concernant l’éditeur, le visualisateur, le
    navigateur à appeler respectivement. Je vous recommande de lire
    ces scripts de l’interpréteur de commandes.

    Astuce

    De façon à faire tourner une application de console telle que
    mutt sous X en tant qu’application préférée, vous devriez créer
    une application X comme suit et définir « /usr/local/bin/
    mutt-term » comme étant votre application préférée à lancer comme
    il est décrit :

    # cat /usr/local/bin/mutt-term <<EOF
    #!/bin/sh
    gnome-terminal -e "mutt \$@"
    EOF
    chmod 755 /usr/local/bin/mutt-term

%

9.3.12. Tuer un processus

    Utilisez kill(1) pour tuer (ou envoyer un signal à) un processus
    avec son identifiant de processus.

    Utilisez killall(1) ou pkill(1) pour faire la même chose avec le
    nom de commande du processus et d’autres attributs.

    Tableau 9.10. Liste des signaux couramment utilisés avec la
    commande kill

    +--------------------------------------------------+
    |valeur du signal|nom du signal|     fonction      |
    |----------------+-------------+-------------------|
    |1               |HUP          |redémarrer le démon|
    |----------------+-------------+-------------------|
    |15              |TERM         |tuer normalement   |
    |----------------+-------------+-------------------|
    |9               |KILL         |tuer « dur »       |
    +--------------------------------------------------+


%

9.3.13. Planifier des tâches qui s’exécutent une fois

    Exécutez de la manière suivante la commande at(1) pour planifier
    un travail qui s’exécute une fois 

    $ echo 'command -args'| at 3:40 monday

%

9.3.14. Planifier des tâches qui s’exécutent régulièrement

    Utilisez cron(8) pour planifier des tâches qui s’exécutent
    régulièrement. Consultez crontab(1) et crontab(5).

    Vous pouvez planifier le lancement des processus en tant
    qu’utilisateur normal, par exemple toto en créant un fichier 
    crontab(5) file comme « /var/spool/cron/crontabs/toto » avec la
    commande « crontab -e ».

    Voici un exemple de fichier crontab(5).

    # utilise /bin/sh pour exécuter les commandes, quoi que dise /etc/passwd
    SHELL=/bin/sh
    # envoie un courrier électronique à Paul contenant tous les résultats,
    # quelle que soit la personne à qui appartient la crontab
    MAILTO=paul
    # Minute Heure JourDuMois Mois JourDeLaSemaine commande
    # est exécuté à 00:05 chaque jour
    5  0  *  * *   $HOME/bin/daily.job >> $HOME/tmp/out 2>&1
    # est exécuté à 14:15 le 1e de chaque mois -- le résultat est envoyé à Paul
    # par courrier électronique
    15 14 1  * *   $HOME/bin/monthly
    # est exécuté à 22:00 chaque jour de la semaine(1-5), ennuie Joe.
    # % pour une nouvelle ligne, dernier % pour cc:
    0 22 *   * 1-5 mail -s "Il est 10h" joe%Joe,%%Ou sont tes enfants ?%.%%
    23 */2 1 2 *   echo "run 23 minutes after 0am, 2am, 4am ..., on Feb 1"
    5  4 *   * sun echo "run at 04:05 every sunday"
    # est exécuté à 03:40 le premier lundi de chaque mois
    40 3 1-7 * *   [ "$(date +%a)" == "Mon" ] && command -args

    Astuce

    Sur un système qui ne tourne pas en permanence, installez le
    paquet anacron afin de planifier les tâches périodiques à des
    intervalles particulier dès que le temps de fonctionnement
    « uptime » de la machine le permet. Consultez anacron(8) et 
    anacrontab(5).

    Astuce

    Vous pouvez lancer périodiquement les scripts de maintenance
    planifiée du système, depuis le compte de l’administrateur en les
    plaçant dans « /etc/cron.hourly/ », « /etc/cron.daily/ », « /etc/
    cron.weekly/ » ou « /etc/cron.monthly/ ». L"échéancier
    d’exécution de ces scripts peut être personnalisé dans « /etc/
    crontab » et « /etc/anacrontab ».

%

9.3.15. touche Alt-SysRq

    Une assurance contre le mauvais fonctionnement du système est
    fournie par l’option de compilation du noyau « Magic SysRq key »
    (touche SAK) qui est maintenant une valeur par défaut pour les
    noyaux de Debian. Presser Alt-SysRq (NDT : Alt-Sys ou Alt-Impr
    écran sur un clavier français) suivi par une des touches
    suivantes permet de reprendre par magie le contrôle du système.

    Tableau 9.11. Listes des touches de commande SAK (« Secure
    attention keys »)

    +---------------------------------------------------------------+
    |   touche   |                                                  |
    |  suivant   |             description de l’action              |
    |  Alt-Sys   |                                                  |
    |------------+--------------------------------------------------|
    |r           |restaurer le clavier depuis le mode raw (brut)    |
    |            |après un plantage de X                            |
    |------------+--------------------------------------------------|
    |0           |changer le niveau de journalisation de la console |
    |            |à 0 afin de réduire les messages d’erreurs        |
    |------------+--------------------------------------------------|
    |k           |kill (tuer) tous les processus sur la console     |
    |            |virtuelle actuelle                                |
    |------------+--------------------------------------------------|
    |e           |envoyer un SIGTERM à tous les processus, sauf init|
    |            |(8)                                               |
    |------------+--------------------------------------------------|
    |i           |envoyer un SIGKILL à tous les processus, sauf init|
    |            |(8)                                               |
    |------------+--------------------------------------------------|
    |s           |synchroniser tous les systèmes de fichiers montés |
    |            |afin d'éviter la corruption des données           |
    |------------+--------------------------------------------------|
    |u           |remonter en lecture seule tous les systèmes de    |
    |            |fichiers montés (umount)                          |
    |------------+--------------------------------------------------|
    |b           |reboot (redémarrer) le système sans effectuer de  |
    |            |synchronisation ni de démontage                   |
    +---------------------------------------------------------------+


    Astuce
   
    Se référer aux pages de manuel de signal(7), kill(1) et sync(1)
    afin de mieux comprendre la description ci-dessus.

    La combinaison de « Alt-Sys s », « Alt-Sys u » et « Alt-Sys r »
    permet de se tirer de situation vraiment désastreuse et obtenir à
    nouveau l'accès à un clavier opérationnel sans avoir à arrêter le
    système.

    Consultez « /usr/share/doc/linux-doc-3.*/Documentation/
    sysrq.txt.gz ».

    Attention

    la fonctionnalité Alt-SysRq peut être considérée comme un risque
    de sécurité permettant à des utilisateurs d’accéder à des
    fonctions ayant le privilège de l’administrateur. Placer « echo 0
    >/proc/sys/kernel/sysrq » dans « /etc/rc.local » ou
    « kernel.sysrq = 0 » dans « /etc/sysctl.conf » désactive la
    fonctionnalité Alt-SysRq.

    Astuce

    Depuis un terminal SSH, etc., vous pouvez utiliser la
    fonctionnalité Alt-SysRq en écrivant vers « /proc/
    sysrq-trigger ». Par exemple;, « echo s > /proc/sysrq-trigger;
    echo u > /proc/sysrq-trigger » depuis l’invite de l’interpréteur
    de commandes de l’administrateur syncs (synchronise) et umount
    (démonte) tous les systèmes de fichiers montés.

9.4. Astuces de maintenance du système

%

9.4.1. Qui se trouve sur le système ?

    Vous pouvez rechercher qui se trouve sur le système par les
    commandes suivantes :

      * who(1) affiche qui est connecté.

      * w(1) affiche qui est connecté et ce qu’il fait.

      * last(1) affiche une liste des derniers utilisateurs
        connectés.

      * lastb(1) affiche une liste des utilisateurs s’étant mal
        connectés.

    Astuce
   
    « /var/run/utmp » et « /var/log/wtmp » conservent ces
    informations de l’utilisateur. Consultez login(1) et utmp(5).

%

9.4.2. Prévenir tout le monde

    Vous pouvez envoyer un message à toutes les personnes connectées
    au système avec wall(1) en faisant ce qui suit :

    $ echo "Nous allons arrêter le système dans une heure" | wall

%

9.4.3. Identification du matériel

    Pour les périphériques similaires à PCI (AGP, PCI-Express,
    CardBus, ExpressCard, etc.), lspci(8) (probablement avec l’option
    « -nn ») est un bon point de départ pour l’identification du
    matériel.

    Vous pouvez aussi identifier le matériel en lisant le contenu de
    « /proc/bus/pci/devices » ou en parcourant l’arborescence de
    répertoires se trouvant sous « /sys/bus/pci » (consultez
    Section 1.2.12, « procfs et sysfs »).

    Tableau 9.12. Listes des outils d’identification du matériel

    +---------------------------------------------------------------+
    |  paquet   |popcon|taille|             description             |
    |-----------+------+------+-------------------------------------|
    |pciutils   |V:195,|196   |utilitaires PCI de Linux : lspci(8)  |
    |           |I:992 |      |                                     |
    |-----------+------+------+-------------------------------------|
    |usbutils   |V:84, |324   |utilitaires USB de Linux : lsusb(8)  |
    |           |I:862 |      |                                     |
    |-----------+------+------+-------------------------------------|
    |pcmciautils|V:13, |97    |utilitaires PCMCIA pour Linux :      |
    |           |I:21  |      |pccardctl(8)                         |
    |-----------+------+------+-------------------------------------|
    |scsitools  |V:0,  |390   |collection d’outils pour la gestion  |
    |           |I:3   |      |des périphériques SCSI : lsscsi(8)   |
    |-----------+------+------+-------------------------------------|
    |procinfo   |V:0,  |135   |informations sur le système obtenues |
    |           |I:13  |      |dans « /proc » : lsdev(8)            |
    |-----------+------+------+-------------------------------------|
    |lshw       |V:12, |842   |informations concernant la           |
    |           |I:94  |      |configuration matérielle : lshw(1)   |
    |-----------+------+------+-------------------------------------|
    |discover   |V:41, |90    |système d’identification du          |
    |           |I:947 |      |matériel : discover(8)               |
    +---------------------------------------------------------------+


%

9.4.4. Configuration matérielle

    Bien que l'essentiel de la configuration du matériel puisse être
    gérée au moyen des outils graphiques qui accompagnent les
    environnements de bureau graphiques modernes comme GNOME ou KDE,
    c’est une bonne idée de connaître certaines méthodes de base
    permettant de le configurer.

    Tableau 9.13. Liste des outils de configuration du matériel

    +---------------------------------------------------------------+
    |     paquet      |popcon|taille|          description          |
    |-----------------+------+------+-------------------------------|
    |                 |V:137,|      |Police de la console Linux et  |
    |console-setup    |I:959 |411   |utilitaires de table de        |
    |                 |      |      |caractères                     |
    |-----------------+------+------+-------------------------------|
    |x11-xserver-utils|V:282,|511   |utilitaires pour le serveur X  |
    |                 |I:534 |      | : xset(1), xmodmap(1)         |
    |-----------------+------+------+-------------------------------|
    |                 |      |      |démon servant à gérer les      |
    |                 |      |      |événements délivrés par        |
    |                 |V:145,|      |l’Interface avancée de         |
    |acpid            |I:318 |176   |configuration et de gestion de |
    |                 |      |      |l’énergie ACPI (« Advanced     |
    |                 |      |      |Configuration and Power        |
    |                 |      |      |Interface »)                   |
    |-----------------+------+------+-------------------------------|
    |                 |V:17, |      |utilitaire d’affichage des     |
    |acpi             |I:302 |45    |informations des périphériques |
    |                 |      |      |ACPI                           |
    |-----------------+------+------+-------------------------------|
    |                 |V:0,  |      |démon permettant de mettre un  |
    |sleepd           |I:0   |86    |ordinateur portable en veille  |
    |                 |      |      |lorsqu’il est inactif          |
    |-----------------+------+------+-------------------------------|
    |                 |      |      |optimisation de l’accès aux    |
    |hdparm           |V:408,|256   |disques durs (consultez        |
    |                 |I:718 |      |Section 9.5.9, « Optimisation  |
    |                 |      |      |du disque dur »)               |
    |-----------------+------+------+-------------------------------|
    |                 |V:134,|      |contrôle et surveillance des   |
    |smartmontools    |I:197 |2117  |systèmes de stockage en        |
    |                 |      |      |utilisant S.M.A.R.T.           |
    |-----------------+------+------+-------------------------------|
    |setserial        |V:5,  |117   |collection d’outils pour gérer |
    |                 |I:9   |      |les ports série                |
    |-----------------+------+------+-------------------------------|
    |memtest86+       |V:1,  |2391  |collection d’outils pour gérer |
    |                 |I:29  |      |la mémoire physique            |
    |-----------------+------+------+-------------------------------|
    |scsitools        |V:0,  |390   |collection d’outils pour gérer |
    |                 |I:3   |      |le matériel SCSI               |
    |-----------------+------+------+-------------------------------|
    |setcd            |V:0,  |35    |optimisation de l’accès au     |
    |                 |I:1   |      |lecteur de CD                  |
    |-----------------+------+------+-------------------------------|
    |big-cursor       |I:1   |27    |curseurs de souris plus grands |
    |                 |      |      |pour X                         |
    +---------------------------------------------------------------+


    Ici, ACPI est une infrastructure de gestion de l’alimentation
    électrique du système plus récente qu’APM.

    Astuce
   
    L’ajustement de la fréquence d’horloge des processeurs modernes
    est gérée par des modules du noyaux tels que acpi_cpufreq.

%

9.4.5. Heure système et matérielle

    Ce qui suit permet de définir l’heure du système et du matériel à
    MM/DD hh:mm, CCYY :

    # date MMDDhhmmCCYY
    # hwclock --utc --systohc
    # hwclock --show

    Sur un système Debian, l’heure est normalement affichée en heure
    locale mais l’heure système et matérielle utilisent
    habituellement l’heure TUC(GMT).

    Si l’heure matérielle (BIOS) est réglée en TUC, modifiez le
    réglage pour « UTC=yes » dans le fichier « /etc/default/rcS ».

    La commande suivante relance la configuration du fuseau horaire
    utilisé par le système Debian.

    # dpkg-reconfigure tzdata

    Si vous désirez ajuster l’heure de votre système par
    l’intermédiaire du réseau, vous pouvez envisager l’utilisation du
    service NTP avec un paquet tel que ntp, ntpdate ou chrony.

    Astuce

    Sous systemd, utilisez plutôt systemd-timesyncdpour la
    synchronisation avec l'heure du réseau. Voir systemd-timesyncd(8)
    .

    Consultez ce qui suit.

      * Comment gérer précisément la date et l’heure

      * Projet de services publics NTP

      * Le paquet ntp-doc

    Astuce
   
    ntptrace(8) du paquet ntp peut suivre la trace d’une chaîne de
    serveurs NTP jusqu’à la source primaire.

%

9.4.6. Configuration du terminal

    Il existe plusieurs composants pour configurer la console en mode
    caractères et les fonctionnalités du système ncurses(3).

      * Le fichier « /etc/terminfo/*/* » (terminfo(5))

      * La variable d’environnement « $TERM »(term(7))

      * setterm(1), stty(1), tic(1) et toe(1)

    Si l’entrée terminfo pour xterm ne fonctionne pas avec un xterm
    non Debian, changez le type de terminal dans « $TERM » de
    « xterm » pour une version limitée en fonctionnalités comme
    « xterm-r6 » lorsque vous-vous connectez à distance à un système
    Debian. Consultez « /usr/share/doc/libncurses5/FAQ » pour
    davantage d’informations. « dumb » est le plus petit dénominateur
    commun pour « $TERM ».

%

9.4.7. L’infrastructure de gestion du son

    Les pilotes de périphériques des cartes sons pour les versions
    actuelles de Linux sont fournies par Advanced Linux Sound
    Architecture (ALSA). ALSA fournit un mode d’émulation du système
    précédent Open Sound System (OSS) pour des raisons de
    compatibilité.

    Astuce
   
    Utilisez « cat /dev/urandom > /dev/audio » ou speaker-test(1)
    pour tester les hauts-parleurs (^C pour arrêter).

    Astuce

    Si vous n’arrivez pas à obtenir de sons, il est possible que
    votre haut-parleur soit connecté à une sortie muette (« muted »).
    Les systèmes de son modernes ont de nombreuses sorties. alsamixer
    (1) du paquet alsa-utils est pratique pour configurer les
    paramètres de volume et de coupure son

    Les logiciels applicatifs peuvent être configurés pour non
    seulement accéder aux périphériques sonores directement mais
    aussi pour y accéder par l’intermédiaire d’un système de serveur
    de son.

    Tableau 9.14. Liste des paquets son

    +---------------------------------------------------------------+
    |     paquet      |popcon|taille|          description          |
    |-----------------+------+------+-------------------------------|
    |alsa-utils       |V:341,|2283  |utilitaires de configuration et|
    |                 |I:476 |      |d’utilisation d’ALSA           |
    |-----------------+------+------+-------------------------------|
    |                 |V:2,  |      |Compatibilité OSS sous ALSA    |
    |oss-compat       |I:29  |20    |évitant les erreurs « /dev/dsp |
    |                 |      |      |not found  »                   |
    |-----------------+------+------+-------------------------------|
    |                 |V:4,  |      |serveur du kit de connexion    |
    |jackd            |I:27  |9     |audio JACK. (JACK) (faible     |
    |                 |      |      |latence)                       |
    |-----------------+------+------+-------------------------------|
    |                 |V:1,  |      |bibliothèque du kit de         |
    |libjack0         |I:13  |338   |connexion JACK. (JACK) (faible |
    |                 |      |      |latence)                       |
    |-----------------+------+------+-------------------------------|
    |nas              |V:0,  |243   |serveur du système audio réseau|
    |                 |I:0   |      |(NAS)                          |
    |-----------------+------+------+-------------------------------|
    |libaudio2        |V:60, |165   |bibliothèque du serveur audio  |
    |                 |I:488 |      |réseau (NAS)                   |
    |-----------------+------+------+-------------------------------|
    |pulseaudio       |V:350,|6398  |serveur PulseAudio, remplaçant |
    |                 |I:471 |      |d’ESD                          |
    |-----------------+------+------+-------------------------------|
    |libpulse0        |V:289,|969   |bibliothèque du client         |
    |                 |I:604 |      |PulseAudio, remplace ESD       |
    |-----------------+------+------+-------------------------------|
    |libgstreamer1.0-0|V:372,|5280  |GStreamer : moteur de son de   |
    |                 |I:574 |      |GNOME                          |
    |-----------------+------+------+-------------------------------|
    |libphonon4       |I:121 |680   |Phonon : moteur de son de KDE  |
    +---------------------------------------------------------------+


    Il y a habituellement un moteur de son commun pour chacun des
    environnements de bureau les plus courants. Chaque moteur de son
    utilisé par l’application peut choisir de se connecter à un
    serveur de son différent.

%

9.4.8. Désactiver l’économiseur d’écran

    Pour désactiver l’écran de veille, utilisez les commandes
    suivantes :

    Tableau 9.15. Liste des commandes pour désactiver l’économiseur
    d’écran

    +---------------------------------------------------------------+
    |              environnement               |      commande      |
    |------------------------------------------+--------------------|
    |Console Linux                             |setterm -powersave  |
    |                                          |off                 |
    |------------------------------------------+--------------------|
    |Système X Window (couper l’économiseur    |xset s off          |
    |d’écran)                                  |                    |
    |------------------------------------------+--------------------|
    |X Window (désactive dpms)                 |xset -dpms          |
    |------------------------------------------+--------------------|
    |X Window (interface de configuration      |xscreensaver-command|
    |graphique d’économiseur d’écran)          |-prefs              |
    +---------------------------------------------------------------+


%

9.4.9. Désactiver les bips

    On peut toujours débrancher le haut-parleur du PC pour désactiver
    les bips. La suppression du module du noyau pcspkr le fait pour
    vous.

    Ce qui suit évite que le programme readline(3) utilisé parbash(1)
    ne bipe lors de l'apparition d'un caractère d'alerte (ASCII=7).

    $ echo "set bell-style none">> ~/.inputrc

%

9.4.10. Utilisation de la mémoire

    Vous avez à votre disposition deux moyens d'obtenir l'état
    d'utilisation de la mémoire.

      * Le message de démarrage du noyau dans « /var/log/dmesg »
        donne exactement la taille de la mémoire disponible.
   
      * free(1) et top(1) affichent des informations concernant les
        ressources mémoire sur le système actif.

    Voici un exemple.

    # grep '\] Memory' /var/log/dmesg
    [    0.004000] Memory: 990528k/1016784k available (1975k kernel code, 25868k reserved, 931k data, 296k init)
    $ free -k
                 total       used       free     shared    buffers     cached
    Mem:        997184     976928      20256          0     129592     171932
    -/+ buffers/cache:     675404     321780
    Swap:      4545576          4    4545572

    Vous pourriez vous demander « dmesg me rapporte 990 Mo de mémoire
    libre et « free -k » me dit que 320 Mo sont libres. Il manque
    plus de 600 Mo… ».

    Ne vous inquiétez pas de la taille importante de « used » et de
    la petite taille de « free » sur la ligne « Mem: », mais lisez ce
    qui se trouve sous celle-ci (675404 et 321780 dans l’exemple
    ci-dessous) et détendez-vous.

    Pour mon MacBook avec 1Go=1048576k DRAM (la mémoire vidéo en
    prend une partie), je peux voir ce qui suit :

    Tableau 9.16. Taille mémoire affichée

    +---------------------------------------------------------------+
    |             affiché              |           taille           |
    |----------------------------------+----------------------------|
    |Taille totale dans dmesg          |1016784k = 1Go - 31792k     |
    |----------------------------------+----------------------------|
    |Libre dans dmesg                  |990528k                     |
    |----------------------------------+----------------------------|
    |Total sous l’interpréteur de      |997184k                     |
    |commandes                         |                            |
    |----------------------------------+----------------------------|
    |Libre sous l’interpréteur de      |20256k (mais réellement     |
    |commandes                         |321780k)                    |
    +---------------------------------------------------------------+


%

9.4.11. Vérification de la sécurité et de l’intégrité du système

    Une mauvaise maintenance du système peut rendre votre système
    vulnérable à une attaque externe.

    Pour la vérification de la sécurité et de l’intégrité du système,
    vous pouvez démarrer avec ce qui suit :

      * Le paquet debsums, consultez debsums(1) et Section 2.5.2,
        « Fichier « Release » de plus haut niveau et authenticité ».

      * Le paquet chkrootkit, consultez chkrootkit(1).

      * La familles de paquets clamav, consultez clamscan(1) et 
        freshclam(1).

      * FAQ de sécurité Debian.

      * Manuel de sécurisation de Debian.

    Tableau 9.17. Liste d’outils pour la vérification de la sécurité
    et de l’intégrité du système

    +---------------------------------------------------------------+
    |  paquet  |popcon|taille|             description              |
    |----------+------+------+--------------------------------------|
    |          |V:8,  |      |démon pour poster à l’administrateur  |
    |logcheck  |I:10  |102   |les anomalies des fichiers journaux du|
    |          |      |      |système                               |
    |----------+------+------+--------------------------------------|
    |          |V:5,  |      |utilitaire pour vérifier les fichiers |
    |debsums   |I:42  |107   |des paquets installés d’après leur    |
    |          |      |      |somme de contrôle MD5                 |
    |----------+------+------+--------------------------------------|
    |chkrootkit|V:5,  |970   |détecteur de rootkit.                 |
    |          |I:24  |      |                                      |
    |----------+------+------+--------------------------------------|
    |clamav    |V:13, |774   |utilitaire anti-virus pour UNIX ‑     |
    |          |I:58  |      |interface en ligne de commandes.      |
    |----------+------+------+--------------------------------------|
    |tiger     |V:2,  |7822  |signale les vulnérabilités du système |
    |          |I:3   |      |pour la sécurité                      |
    |----------+------+------+--------------------------------------|
    |tripwire  |V:2,  |11521 |vérificateur d’intégrité des fichiers |
    |          |I:3   |      |et répertoires                        |
    |----------+------+------+--------------------------------------|
    |john      |V:2,  |452   |outils de casse des mots de passe     |
    |          |I:12  |      |actifs                                |
    |----------+------+------+--------------------------------------|
    |          |      |      |Environnement avancé de détection     |
    |aide      |V:1,  |2063  |d’intrusion (« Advanced Intrusion     |
    |          |I:2   |      |Detection Environment »)              |
    |          |      |      |— bibliothèque statique               |
    |----------+------+------+--------------------------------------|
    |integrit  |V:0,  |329   |programme de vérification de          |
    |          |I:0   |      |l’intégrité des fichiers              |
    |----------+------+------+--------------------------------------|
    |crack     |V:0,  |149   |programme pour deviner les mots de    |
    |          |I:1   |      |passe                                 |
    +---------------------------------------------------------------+


    Voici un script simple pour rechercher des fichiers typiques
    ayant des permissions incorrectes d’écriture pour tout le monde.

    # find / -perm 777 -a \! -type s -a \! -type l -a \! \( -type d -a -perm 1777 \)

    Attention

    Comme le paquet debsums utilise des sommes de contrôle MD5
    enregistrées de manière statique, on ne peut pas lui faire
    entièrement confiance comme outil d’audit de la sécurité envers
    des attaques malveillantes.

%

9.5. Astuces relatives au stockage des données

    Démarrer votre système avec un CD autonome de Linux ou avec un CD
    de l’installateur debian en mode secours (rescue) vous facilite
    la reconfiguration de l’enregistrement des données sur votre
    disque de démarrage.

%

9.5.1. Utilisation de l’espace disque

    L’utilisation de l’espace disque peut être estimée à l’aide de
    programmes fournis par les paquets mount, coreutils et xdu :

      * mount(8) indique tous les systèmes de fichiers (disques)
        montés.

      * df(1) indique l’espace disque occupé par les systèmes de
        fichiers.

      * du(1) indique l’espace disque occupé par une arborescence de
        répertoires.

    Astuce

    La sortie de du(1) peut être renvoyée vers xdu(1x) pour réaliser
    une présentation graphique et interactive avec « du -k . |xdu »,
    « sudo du -k -x / |xdu », etc.

%

9.5.2. Configuration de la partition du disque

    Bien que fdisk(8) ait été considéré comme un standard pour la
    configuration de la partition du disque dur, il mérite une
    certaine attention. « Données de partition du disque », « table
    de partition » et « Étiquette de disque » sont tous des
    synonymes.

    La plupart des PC utilisent le principe de l’Enregistrement
    Maître de démarrage (MBR) (« Master Boot Record ») pour
    enregistrer les données de partition du disque sur le premier
    secteur, c’est-à-dire, le secteur 0 LBA (512 octets).

    Note

    Certains PC récent avec une Extensible Firmware Interface (EFI),
    ce qui comprend les Macs basés sur Intel, utilisent un principe
    de GUID Partition Table (GPT) pour enregistrer les données de
    partitionnement du disque ailleurs que sur le premier secteur.

    Alors que fdisk(8) a été l’outil standard de partitionnement de
    disque, parted(8) le remplace maintenant.

    Tableau 9.18. Listes de paquets de gestion de la partition du
    disque

    +---------------------------------------------------------------+
    |  paquet  |popcon|taille|  GPT   |         description         |
    |----------+------+------+--------+-----------------------------|
    |          |V:891,|      |Non pris|divers utilitaires systèmes  |
    |util-linux|I:999 |4598  |en      |dont fdisk(8) etcfdisk(8)    |
    |          |      |      |charge  |                             |
    |----------+------+------+--------+-----------------------------|
    |          |V:363,|      |Pris en |programme GNU de             |
    |parted    |I:561 |304   |charge  |redimensionnement des        |
    |          |      |      |        |partitions Parted            |
    |----------+------+------+--------+-----------------------------|
    |gparted   |V:19, |2046  |Pris en |éditeur de partitions de     |
    |          |I:132 |      |charge  |GNOME basé sur libparted     |
    |----------+------+------+--------+-----------------------------|
    |gdisk     |V:278,|852   |Pris en |éditeur de partitions pour   |
    |          |I:513 |      |charge  |disque GPT                   |
    |----------+------+------+--------+-----------------------------|
    |          |V:16, |      |Pris en |programme pour créer des     |
    |kpartx    |I:29  |87    |charge  |mappages de périphériques    |
    |          |      |      |        |pour les partitions          |
    +---------------------------------------------------------------+


    Attention

    Bien que parted(8) prétend pouvoir créer et redimensionner aussi
    les systèmes de fichiers, il est plus sûr de toucher à ces
    choses-là en utilisant des outils spécialisés et bien maintenus
    tels que mkfs(8) (mkfs.msdos(8), mkfs.ext2(8), mkfs.ext3(8), 
    mkfs.ext4(8), …) et resize2fs(8).

    Note

    De manière à passer de GPT à MBR, il vous faut d’abord effacer
    les premiers blocs du disque directement (consultez
    Section 9.7.6, « Effacer le contenu d’un fichier ») et utiliser
    « parted /dev/sdx mklabel gpt » ou « parted /dev/sdx mklabel
    msdos » afin de le mettre en place. Vous remarquerez que
    « msdos » est utilisé ici pour MBR.

%

9.5.3. Accès à une partition en utilisant l’UUID

    Bien que la reconfiguration de votre partition ou l’ordre
    d’activation des supports d’enregistrement amovibles puisse
    conduire à des noms de partitions différents, vous pouvez y
    accéder de manière homogène. Cela vous aidera aussi si vous avez
    plusieurs disques et que votre BIOS ne leur donne pas toujours le
    même nom de périphérique.

      * mount(8) avec l’option « -U » peut monter un périphérique en
        mode bloc en utilisant l’UUID plutôt que son nom de fichier
        de périphérique comme « /dev/sda3 ».
   
      * « /etc/fstab » (consultez fstab(5)) peut utiliser l’UUID.

      * Les chargeurs initiaux (Section 3.1.2, « Étage 2 : le
        chargeur initial ») peuvent aussi utiliser UUID.

    Astuce
   
    Vous pouvez tester l’UUID d’un périphérique spécial en mode bloc
    avec blkid(8).

    Astuce

    Les nœuds de périphériques comme les supports d’enregistrement
    amovibles peuvent être rendus statiques en utilisant, si besoin,
    des règles udev. Consultez Section 3.3, « Le système udev ».

%

9.5.4. LVM2

    LVM2 est un gestionnaire de volume logique pour le noyau Linux.
    Avec LVM2, les partitions peuvent être créées sur des volumes
    logiques plutôt que sur des disques durs physiques.

    LVM requiert ce qui suit :

      * le support « device-mapper » dans le noyau Linux (présent par
        défaut sur les noyaux Debian)

      * La bibliothèque de support du « device-mapper » en espace
        utilisateur (du paquet libdevmapper*)

      * le paquet des outils LVM2 en espace utilisateur (lvm2)

    Démarrez l’apprentissage de LVM2 par la lecture des pages de
    manuel suivantes :

      * lvm(8): les bases du mécanisme de LVM2 (liste de toutes les
        commandes LVM2) 

      * lvm.conf(5): le fichier de configuration pour LVM2 

      * lvs(8): information sur les rapports relatifs aux volumes
        logiques 

      * vgs(8): information sur les rapports relatifs aux groupes de
        volumes

      * pvs(8): information sur les rapports relatifs aux volumes
        physiques.

%

9.5.5. Configuration de systèmes de fichiers

    Pour le système de fichiers ext4, le paquet e2fsprogs fournit les
    éléments suivants :

      * mkfs.ext4(8) pour créer un nouveau système de fichiers ext4

      * fsck.ext4(8) pour vérifier et réparer un système de fichiers
        ext4 existant

      * tune2fs(8) pour configurer le superbloc d’un système de
        fichiers ext4

      * debugfs(8) pour un débogage interactif du système de fichiers
        ext4. (Il possède la commande undel permettant de récupérer
        des fichiers effacés.)

    Les commandes mkfs(8) et fsck(8) font partie du paquet e2fsprogs
    en tant que frontal à de nombreux programmes dépendant du système
    de fichiers (mkfs.fstype etfsck.fstype). Pour le système de
    fichiers ext4, il y a mkfs.ext4(8) et fsck.ext4(8) (ils sont liés
    par un lié symboliquement à mke2fs(8) ete2fsck(8)).

    Des commandes semblables sont disponibles pour chaque système de
    fichiers pris en charge par Linux.

    Tableau 9.19. Liste des paquets de gestion des systèmes de
    fichiers

    +---------------------------------------------------------------+
    |   paquet    |popcon|taille|            description            |
    |-------------+------+------+-----------------------------------|
    |e2fsprogs    |V:576,|1449  |utilitaires pour les systèmes de   |
    |             |I:999 |      |fichiers ext2/ext3/ext4            |
    |-------------+------+------+-----------------------------------|
    |reiserfsprogs|V:11, |1132  |utilitaire pour le système de      |
    |             |I:29  |      |fichiers Reiserfs                  |
    |-------------+------+------+-----------------------------------|
    |             |V:128,|      |utilitaire pour le système de      |
    |dosfstools   |I:524 |235   |fichiers FAT (Microsoft :MS-DOS,   |
    |             |      |      |Windows)                           |
    |-------------+------+------+-----------------------------------|
    |xfsprogs     |V:21, |3191  |utilitaire pour le système de      |
    |             |I:98  |      |fichiers XFS (SGI : IRIX)          |
    |-------------+------+------+-----------------------------------|
    |             |V:186,|      |utilitaire pour le système de      |
    |ntfs-3g      |I:512 |1479  |fichiers NTFS (Microsoft : Windows |
    |             |      |      |NT, …)                             |
    |-------------+------+------+-----------------------------------|
    |jfsutils     |V:1,  |1577  |utilitaire pour le système de      |
    |             |I:12  |      |fichiers JFS (IBM : AIX, OS/2)     |
    |-------------+------+------+-----------------------------------|
    |reiser4progs |V:0,  |1373  |utilitaire pour le système de      |
    |             |I:4   |      |fichiers Reiser4                   |
    |-------------+------+------+-----------------------------------|
    |             |V:0,  |      |utilitaire pour les systèmes de    |
    |hfsprogs     |I:8   |356   |fichiers HFS et HFS Plus (Apple :  |
    |             |      |      |Mac OS)                            |
    |-------------+------+------+-----------------------------------|
    |btrfs-progs  |V:38, |4027  |utilitaire pour le système de      |
    |             |I:64  |      |fichiers Btrfs                     |
    |-------------+------+------+-----------------------------------|
    |             |V:3,  |      |programme pour mettre à zéro les   |
    |zerofree     |I:94  |25    |blocs libres des systèmes de       |
    |             |      |      |fichiers ext2, ext3 et ext4        |
    +---------------------------------------------------------------+


    Astuce

    Le système de fichiers ext4 est le système de fichiers par défaut
    pour les systèmes Linux. Son utilisation est fortement
    recommandée, sauf cas spécifiques.

    Astuce

    Le système de fichiers Btrfs est disponible dans le noyau
    Linux 3.2 (Debian Wheezy). Il devrait devenir le prochain système
    de fichiers par défaut après ext4.

    Avertissement

    Vous ne devriez pas encore utiliser le système de fichiers Btrfs
    pour vos données essentielles avant que la fonctionnalité fsck(8)
    n’atteigne l’espace dynamique du noyau et qu’il soit pris en
    charge par le chargeur d’amorçage.

    Astuce

    Certains outils permettent l’accès au système de fichiers sans
    prise en charge par le noyau Linux (consultez Section 9.7.2,
    « Manipulation des fichiers sans monter le disque »).

9.5.6. Création et vérification de l’intégrité d’un système de
fichiers

    La commande mkfs(8) permet de créer un système de fichiers sur un
    système Linux. La commande fsck(8) permet de vérifier l’intégrité
    du système de fichiers et de le réparer sur un système Linux.

    Maintenant, par défaut, Debian n'utilise pas fsck après la
    création d'un système de fichier.

    Attention
   
    En général, il n’est pas sûr de faire tourner fsck sur un système
    de fichiers monté.

    Astuce

    Vous pouvez exécuter la commande fsck(8) sans risque sur tous les
    systèmes de fichiers incluant le système de fichiers racine au
    redémarrage avec le paramètre "enable_periodic_fsck" dans "/etc/
    mke2fs.conf" et le compteur de montage maximum mis à 0 en
    utilisant "tune2fs -c0 /dev/<partition_name>". Voir mke2fs.conf
    (5) et tune2fs(8).

    Astuce
   
    Vous trouverez les résultats de la commande fsck(8) lancée depuis
    le script de démarrage dans « /var/log/fsck/ ».

9.5.7. Optimisation du système de fichiers à l’aide des options de
montage

    La configuration statique de base du système de fichiers est
    donnée par « /etc/fstab ». Par exemple,

    # <système fic> <point montage> <type>  <options>       <dump>  <pass>
    proc            /proc           proc    defaults        0       0
    UUID=709cbe4c-80c1-56db-8ab1-dbce3146d2f7 / ext4 noatime,errors=remount-ro 0 1
    UUID=817bae6b-45d2-5aca-4d2a-1267ab46ac23 none swap sw  0       0
    /dev/scd0       /media/cdrom0   udf,iso9660 user,noauto 0       0

    Astuce

    Un UUID (consultez Section 9.5.3, « Accès à une partition en
    utilisant l’UUID ») peut être utilisé pour identifier un
    périphérique bloc au lieu des noms de périphériques blocs normaux
    comme « /dev/sda1 », ou « /dev/sda2 »,…

    Les performances et les caractéristiques d’un système de fichiers
    peuvent être optimisées à l’aide des options de montage utilisées
    (consultez fstab(5) et mount(8)). Les principales options sont
    les suivantes :

      * l’option « defaults » implique les options par défaut :
        « rw,suid,dev,exec,auto,nouser,async » (général) ;

      * les options « noatime » ou « relatime » sont très efficace
        pour accélérer la vitesse de lecture (général) ;

      * l’option « user » permet à un utilisateur normal de monter le
        système de fichiers. Cette option implique la combinaison
        d’options « noexec,nosuid,nodev » (général, utilisée pour les
        CD et les périphériques de stockage USB).

      * la combinaison d’options « noexec,nodev,nosuid » est utilisée
        pour améliorer la sécurité (général) ;

      * l’option « noauto » limite le montage uniquement à une
        opération explicite (général) ;

      * l’option « data=journal » pour ext3fs peut améliorer
        l’intégrité des données lors d’une panne de courant, elle
        s’accompagne d’une légère baisse de la vitesse d’écriture.

    Astuce

    Vous devez donner au noyau le paramètre de démarrage (consultez
    Section 3.1.2, « Étage 2 : le chargeur initial »), par exemple
    « rootflags=data=journal » afin de mettre en œuvre pour le
    système de fichiers racine un mode de journalisation autre que
    celui par défaut. Pour lenny, le mode de journalisation par
    défaut est « rootflags=data=ordered ». Pour squeeze, il s’agit de
    « rootflags=data=writeback ».

%

9.5.8. Optimisation du système de fichiers à l’aide du superbloc

    Les caractéristiques du système de fichiers peuvent être
    optimisées par l’intermédiaire de son superbloc en utilisant la
    commande tune2fs(8).

      * L’exécution de « sudo tune2fs -l /dev/hda1 » affiche le
        contenu du superbloc du système de fichiers situé sur « /dev/
        hda1 ».

      * L’exécution de « sudo tune2fs -c 50 /dev/hda1 » modifie la
        fréquence des vérifications du système de fichiers (exécution
        de fsck lors du démarrage) à 50 démarrages sur « /dev/hda1 ».

      * L’exécution de la commande « sudo tune2fs -j /dev/hda1 »
        ajoute la possibilité de journalisation au système de
        fichiers, c’est-à-dire la conversion de système de fichiers
        de ext2 vers ext3 sur « /dev/hda1 » (effectuez cela sur un
        système de fichiers non monté).

      * L’exécution de « sudo tune2fs -O extents,uninit_bg,dir_index
        /dev/hda1 && fsck -pf /dev/hda1 » le convertit de ext3 vers
        ext4 sur « /dev/hda1 ». (À effectuer sur un système de
        fichiers non monté).

    Astuce

    En dépit de son nom, tune2fs(8) ne fonctionne pas uniquement sur
    le système de fichiers ext2 mais aussi sur les systèmes de
    fichiers ext3 et ext4.

%

9.5.9. Optimisation du disque dur

    Avertissement

    Veuillez vérifier votre matériel et lire la page de manuel 
    hdparam(8) avant de jouer avec la configuration de vos disques
    durs parce que ce peut être assez dangereux pour l’intégrité des
    données.

    Vous pouvez tester la vitesse de lecture d’un disque dur, par
    exemple « /dev/hda » par « hdparm -tT /dev/hda ». Vous pouvez
    accélérer certains disques (E)IDE avec « hdparm -q -c3 -d1 -u1
    -m16 /dev/hda » en activant la prise en charge des E/S 32 bits
    (« (E)IDE 32-bit I/O support »), en positionnant l’indicateur
    d’utilisation de dma « using_dma flag », en positionnant
    l’indicateur de démasquage des interruptions (« interrupt-unmask
    flag ») et en positionnant les E/S multiples sur 15 secteurs
    (« multiple 16 sector I/O ») (dangereux !).

    Vous pouvez tester la fonctionnalité de cache d’un disque dur,
    par exemple « /dev/sda » par « hdparm -W /dev/sda ». Vous pouvez
    désactiver le cache en écriture avec « hdparm -W 0 /dev/sda ».

    Vous pouvez réussir à lire un CD-ROM vraiment mal pressé sur un
    lecteur de CD-ROM moderne rapide en le ralentissant avec « setcd
    -x 2 ».

%

9.5.10. Optimisation du SSD

    Les performances et l’usure du solid-state drive (SSD) peuvent
    être optimisées comme suit.

      * Utiliser le dernier noyau (>= 3.2).

      * Réduire les écritures sur le disque pour les accès en
        lecture.

          + Définir les options de montage « noatime » ou
            « relatime » dans /etc/fstab.

      * Activer la commande TRIM.

          + Définir l’option de montage « discard » dans /etc/fstab
            pour les systèmes de fichiers ext4 et Btrfs, les
            partitions de swap, etc. Consultez fstab(5).

          + Définir l’option « discard » dans /etc/lvm/lvm.conf pour
            LVM. Consultez lvm.conf(5).
   
          + Définir l’option « discard » dans /etc/crypttab pour
            dm-crypt. Consultez crypttab(5).

      * Activer le schéma d’allocation d’espace disque optimisé pour
        SSD.

          + Définir l’option de montage « ssd » dans /etc/fstab pour
            Brtfs.

      * Vider les données sur le disque toutes les dix minutes pour
        les ordinateurs portables.

          + Définir l’option de montage « commit=600 » dans /etc/
            fstab. Consultez fstab(5).

          + Configurer pm-utils pour utiliser laptop-mode même sous
            tension. Consultez le bogue Debian nº 659260.

    Avertissement

    Modifier l’intervalle de vidage de données à dix minutes, au lieu
    de la valeur par défaut de cinq secondes, peut rendre les données
    vulnérables aux coupures de courant.

%

9.5.11. Utiliser SMART pour prédire les défaillances des disques durs

    Vous pouvez surveiller et enregistrer les disques durs conformes
    à SMART à l’aide du démon smartd(8).

     1. Activez la fonctionnalité SMART dans le BIOS.

     2. Installez le paquet smartmontools.

     3. Identifiez vos disques durs en en affichant la liste avec df
        (1).

          + Supposons que le disque dur à surveiller soit « /dev/
            hda ».

     4. Contrôlez la sortie de « smartctl -a /dev/hda » pour voir si
        la fonctionnalité SMART est effectivement activée.

          + Si elle ne l’est pas, activez-la avec « smartctl -s on -a
            /dev/hda ».

     5. Autorisez le fonctionnement du démon smartd(8) par l’action
        suivante :

          + décommentez « start_smartd=yes » dans le fichier « /etc/
            default/smartmontools » ;

          + relancez le démon smartd(8) avec « sudo /etc/init.d/
            smartmontools restart ».

    Astuce

    Le démon smartd(8) peut être personnalisé par l’intermédiaire du
    fichier /etc/smartd.conf y compris pour la manière d’être informé
    des avertissements.

9.5.12. Indication du répertoire de stockage temporaire à l’aide de
$TMPDIR

    Les applications créent normalement des fichiers temporaires dans
    le répertoire de stockage temporaire « /tmp ». Si « /tmp » ne
    fournit pas assez d’espace, vous pouvez indiquer un autre
    répertoire de stockage temporaire à l’aide de la variable $TMPDIR
    pour les programmes qui l’intègrent.

%

9.5.13. Étendre l’espace de stockage utile à l’aide de LVM

    Les partitions créées sur le gestionnaire de volumes logiques
    (LVM) (« Logical Volume Manager ») (fonctionnalité de Linux) au
    moment de l’installation peuvent être facilement redimensionnées
    en y concaténant des extensions (« extents ») ou en en tronquant
    les extensions sur plusieurs périphériques de stockage sans
    reconfiguration majeure du système.

9.5.14. Extension de l’espace de stockage en montant une autre
partition

    Si vous avez une partition vide (par exemple « /dev/sdx »), vous
    pouvez la formater avec mkfs.ext4(1) et la monter (« mount(8) »)
    sur un répertoire où vous avez besoin de davantage d’espace (vous
    devrez copier les données d’origine).

    $ sudo mv répertoire-travail ancien-répertoire
    $ sudo mkfs.ext4 /dev/sdx
    $ sudo mount -t ext4 /dev/sdx répertoire-travail
    $ sudo cp -a ancien-répertoire/* répertoire-travail
    $ sudo rm -rf ancien-répertoire

    Astuce

    Vous pouvez aussi monter un fichier image de disque vide
    (consultez Section 9.6.5, « Réaliser le fichier image d’un disque
    vide ») en tant que périphérique de rebouclage (consultez
    Section 9.6.3, « Monter le fichier image du disque »).
    L’utilisation réelle du disque croît avec les données réellement
    enregistrées.

9.5.15. Extension de l’espace de stockage en remontant un autre
répertoire

    Si vous avez un répertoire vide (par exemple, « /chemin/vers/
    répertoire-temporaire ») sur une autre partition avec de l’espace
    disponible, vous pouvez le remonter avec l’option « --bind » vers
    un répertoire (par exemple « répertoire-travail ») où vous avez
    besoin de place.

    $ sudo mount --bind /chemin/vers/répertoire-temporaire répertoire-travail

9.5.16. Expansion of usable storage space by overlay-mounting another
directory

    If you have usable space in another partition (e.g., "/path/to/
    empty" and "/path/to/work"), you can create a directory in it and
    stack that on to an old directory (e.g., "/path/to/old") where
    you need space using the OverlayFS for Linux kernel 3.18 or newer
    (Debian Stretch 9.0 or newer).

    $ sudo mount -t overlay overlay \
      -olowerdir=/chemin/de/l'ancien-répertoire,upperdir=/chemin/répertoire/vide,workdir=/chemin/de/travail

    Here, "/path/to/empty" and "/path/to/work" should be on the
    RW-enabled partition to write on "/path/to/old".

9.5.17. Extension de l’espace utilisable à l’aide de liens
symboliques

    Attention

    This is a deprecated method. Some software may not function well
    with "symlink to a directory". Instead, use the "mounting"
    approaches described in the above.

    Si vous avez un répertoire vide (par exemple, « /chemin/vers/
    répertoire-temporaire ») sur une autre partition avec de l’espace
    disponible, vous pouvez créer un lien symbolique vers ce
    répertoire avec ln(8).

    $ sudo mv répertoire-travail ancien-répertoire
    $ sudo mkdir -p /chemin/vers/répertoire-temporaire
    $ sudo ln -sf /chemin/vers/répertoire-temporaire répertoire-travail
    $ sudo cp -a ancien-répertoire/* répertoire-travail
    $ sudo rm -rf ancien-répertoire

    Avertissement

    N’utilisez pas de « liens symboliques vers un répertoire » pour
    un répertoire géré par le système comme par exemple « /opt ». De
    tels liens symboliques peuvent être écrasés lors de la mise à
    niveau du système.

%

9.6. Le fichier image du disque

    Nous discutons ici des manipulations sur l’image disque.

%

9.6.1. Créer le fichier image du disque

    Le fichier image du disque, « disk.img » d’un périphérique non
    monté, par exemple, le second périphérique SCSI ou Serial ATA « /
    dev/sdb » peut être créé en utilisant cp(1) ou dd(1) comme suit :

    # cp /dev/sdb disque.img
    # dd if=/dev/sdb of=disque.img

    L’image disque du master boot record (MBR) (secteur principal
    d’amorçage) (consultez Section 9.5.2, « Configuration de la
    partition du disque ») qui se trouve sur le premier secteur du
    disque primaire IDE peut être faite en utilisant dd(1) comme
    suit :

    # dd if=/dev/hda of=mbr.img bs=512 count=1
    # dd if=/dev/hda of=mbr-nopart.img bs=446 count=1
    # dd if=/dev/hda of=mbr-part.img skip=446 bs=1 count=66

      * « mbr.img » : MBR avec la table des partitions

      * « mbr-nopart.img » : MBR sans la table des partitions

      * « mbr-part.img » : table de partition du MBR seul

    Si vous avez un périphérique SCSI ou Serial ATA comme disque
    d’amorçage, remplacez « /dev/hda » avec « /dev/sda ».

    Si vous réalisez une image d’une partition du disque d’origine,
    remplacez « /dev/hda » par « /dev/hda1 », etc.

%

9.6.2. Écrire directement sur le disque

    Le fichier image du disque « disk.img » peut être écrit vers un
    disque non monté, par exemple le second disque SCSI « /dev/sdb »
    avec la taille correspondante par ce qui suit :

    # dd if=disk.img of=/dev/sdb

    De la même manière, le fichier image de la partition du disque,
    « partition.img » peut être écrit sur une partition non montée,
    par exemple, la première partition du second disque SCSI « /dev/
    sdb1 » avec la taille correspondante comme suit :

    # dd if=partition.img of=/dev/sdb1

%

9.6.3. Monter le fichier image du disque

    L’image disque « partition.img », qui contient une partition
    image unique, peut être monté et démonté en utilisant le
    périphérique de rebouclage (loop device) de la manière suivante :

    # losetup -v -f partition.img
    Loop device is /dev/loop0
    # mkdir -p /mnt/loop0
    # mount -t auto /dev/loop0 /mnt/loop0
    ...hack...hack...hack
    # umount /dev/loop0
    # losetup -d /dev/loop0

    Cela peut être simplifié de la manière suivante :

    # mkdir -p /mnt/loop0
    # mount -t auto -o loop partition.img /mnt/loop0
    ...hack...hack...hack
    # umount partition.img

    Chaque partition de l’image disque « disk.img » contenant
    plusieurs partitions peut être montée en utilisant le
    périphérique de rebouclage (loop device). Étant donné que le
    périphérique de rebouclage ne gère pas, par défaut, les
    partitions, il faut le réinitialiser de la manière suivante :

    # modinfo -p loop # verify kernel capability
    max_part:Maximum number of partitions per loop device
    max_loop:Maximum number of loop devices
    # losetup -a # verify nothing using the loop device
    # rmmod loop
    # modprobe loop max_part=16

    Maintenant, le périphérique de rebouclage peut gérer jusqu’à 16
    partitions.

    # losetup -v -f disk.img
    Loop device is /dev/loop0
    # fdisk -l /dev/loop0

    Disk /dev/loop0: 5368 MB, 5368709120 bytes
    255 heads, 63 sectors/track, 652 cylinders
    Units = cylinders of 16065 * 512 = 8225280 bytes
    Disk identifier: 0x452b6464

          Device Boot      Start         End      Blocks   Id  System
    /dev/loop0p1               1         600     4819468+  83  Linux
    /dev/loop0p2             601         652      417690   83  Linux
    # mkdir -p /mnt/loop0p1
    # mount -t ext4 /dev/loop0p1 /mnt/loop0p1
    # mkdir -p /mnt/loop0p2
    # mount -t ext4 /dev/loop0p2 /mnt/loop0p2
    ...hack...hack...hack
    # umount /dev/loop0p1
    # umount /dev/loop0p2
    # losetup -d /dev/loop0

    En remplacement, des effets similaires peuvent être obtenus en
    utilisant les périphériques device mapper créés par kpartx(8) du
    paquet kpartx de la manière suivante :

    # kpartx -a -v disk.img
    ...
    # mkdir -p /mnt/loop0p2
    # mount -t ext4 /dev/mapper/loop0p2 /mnt/loop0p2
    ...
    ...hack...hack...hack
    # umount /dev/mapper/loop0p2
    ...
    # kpartx -d /mnt/loop0

    Note

    Vous pouvez monter une partition unique d’une telle image de
    disque avec le périphérique de rebouclage en utilisant un
    décalage pour sauter le MBR ou autre. Mais c’est susceptible
    d’induire des erreurs.

%

9.6.4. Nettoyage d’un fichier image du disque

    Un fichier image disque « disk.img » peut être nettoyé de tous
    les fichiers supprimés pour donner une image propre « new.img »
    de la manière suivante :

    # mkdir old; mkdir new
    # mount -t auto -o loop disk.img old
    # dd bs=1 count=0 if=/dev/zero of=new.img seek=5G
    # mount -t auto -o loop new.img new
    # cd old
    # cp -a --sparse=always ./ ../new/
    # cd ..
    # umount new.img
    # umount disk.img

    Si « disk.img » est un système de fichiers ext2, ext3 ou ext4,
    vous pouvez aussi utiliser zerofree(8) du paquet zerofree de la
    manière suivante :

    # losetup -f -v disk.img
    Loop device is /dev/loop3
    # zerofree /dev/loop3
    # cp --sparse=always disk.img new.img

%

9.6.5. Réaliser le fichier image d’un disque vide

    Le fichier image du disque vide « disk.img », qui pourra
    s’étendre jusqu’à 5Gio peut être fait en utilisant dd(1) comme
    suit :

    $ dd bs=1 count=0 if=/dev/zero of=disk.img seek=5G

    Vous pouvez créer un système de fichiers ext4 sur cette image
    disque « disk.img » en utilisant le périphérique de rebouclage
    (loop device) de la manière suivante :

    # losetup -f -v disk.img
    Loop device is /dev/loop1
    # mkfs.ext4 /dev/loop1
    ...hack...hack...hack
    # losetup -d /dev/loop1
    $ du  --apparent-size -h disk.img
    5.0G  disk.img
    $ du -h disk.img
    83M disk.img

    Pour « disk.img », sa taille de fichier est de 5.0 Gio et son
    utilisation disque est uniquement de 83Mio. Cette discordance est
    possible car ext4 sait maintenir un fichier creux (sparse).

    Astuce
   
    L’utilisation réelle sur le disque du fichier creux croît au fur
    et à mesure qu’on y écrit des données .

    En utilisant des opérations similaires sur les périphériques
    créés par loop device ou les périphériques device mapper comme
    dans Section 9.6.3, « Monter le fichier image du disque », vous
    pouvez partitionner cette image disque « disk.img » en utilisant 
    parted(8) ou fdisk(8), et y créer un système de fichiers en
    utilisant mkfs.ext4(8), mkswap(8), etc.

%

9.6.6. Créer un fichier image ISO9660

    On peut faire le fichier image ISO9660, « cd.iso », depuis
    l’arborescence de répertoire source située à
    « répertoire_source », en utilisant genisoimage(1) fourni
    parcdrkit de la manière suivante :

    #  genisoimage -r -J -T -V volume_id -o cd.iso répertoire_source

    De la même manière, on peut créer le fichier image ISO9660
    amorçable « cdboot.iso » depuis une arborescence comme celle de
    debian-installer située en « source_directory », de la manière
    suivante :

    #  genisoimage -r -o cdboot.iso -V volume_id \
       -b isolinux/isolinux.bin -c isolinux/boot.cat \
       -no-emul-boot -boot-load-size 4 -boot-info-table répertoire_source

    Ici, le chargeur d’amorçage Isolinux (consultez Section 3.1.2,
    « Étage 2 : le chargeur initial ») est utilisé pour l’amorçage.

    Vous pouvez calculer la valeur de la somme md5 (md5sum) et
    construire des image ISO9660 directement depuis un lecteur de
    CD-ROM de la manière suivante :

    $ isoinfo -d -i /dev/cdrom
    CD-ROM is in ISO 9660 format
    ...
    Logical block size is: 2048
    Volume size is: 23150592
    ...
    # dd if=/dev/cdrom bs=2048 count=23150592 conv=notrunc,noerror | md5sum
    # dd if=/dev/cdrom bs=2048 count=23150592 conv=notrunc,noerror > cd.iso

    Avertissement

    Vous devrez prendre garde d’éviter le bogue de lecture anticipée
    du système de fichiers ISO9660 de Linux comme ci-dessus afin
    d’obtenir les résultats corrects.

%

9.6.7. Écriture directe sur CD/DVD-R/RW

    Astuce
   
    Un DVD n’est qu’un gros CD pour wodim(1) qui est fourni par
    cdrkit.

    Vous pouvez rechercher un périphérique utilisable comme suit :

    # wodim --devices

    Le CD-R vierge est alors inséré dans le graveur de CD et le
    fichier image ISO9660 « cd.iso » est écrit vers le périphérique,
    par exemple; « /dev/hda » en utilisant wodim(1) de la manière
    suivante :

    # wodim -v -eject dev=/dev/hda cd.iso

    Si un CD-RW est utilisé à la place d’un CD-R, faites alors ce qui
    suit :

    # wodim -v -eject blank=fast dev=/dev/hda cd.iso

    Astuce

    Si votre système de bureau monte automatiquement le CD,
    démontez-le par la commande « sudo unmount /dev/hda » depuis un
    terminal avant d’utiliser wodim(1).

%

9.6.8. Monter le fichier image ISO9660

    Si « cd.iso » contient une image ISO9660, ce qui suit permet
    alors de le monter manuellement sur « /cdrom » :

    # mount -t iso9660 -o ro,loop cd.iso /cdrom

    Astuce

    Les systèmes de bureau modernes peuvent monter automatiquement
    les supports amovibles tels que les CD formatés en ISO9960
    (consultez Section 10.1.7, « Périphériques d’enregistrement
    amovibles »).

%

9.7. Les données binaires

    Nous allons ici discuter de la manipulation directe des données
    binaires sur le support d’enregistrement.

%

9.7.1. Afficher et éditer des données binaires

    La méthode la plus basique pour visualiser des données binaires
    est d’utiliser la commande « od -t x1 ».

    Tableau 9.20. Liste des paquets permettant de visualiser et
    d’éditer des données binaires

    +---------------------------------------------------------------+
    |    paquet     |popcon|taille|           description           |
    |---------------+------+------+---------------------------------|
    |               |V:891,|      |paquet de base utilisant od(1)   |
    |coreutils      |I:999 |17478 |pour vider des fichiers (HEX,    |
    |               |      |      |ASCII, OCTAL, …)                 |
    |---------------+------+------+---------------------------------|
    |               |V:60, |      |paquets utilitaires qui utilisent|
    |bsdmainutils   |I:996 |26    |hd(1) pour vider les fichiers    |
    |               |      |      |(HEX, ASCII, OCTAL, …)           |
    |---------------+------+------+---------------------------------|
    |hexedit        |V:1,  |72    |éditeurs et visualisateurs       |
    |               |I:12  |      |binaires (HEX, ASCII)            |
    |---------------+------+------+---------------------------------|
    |bless          |V:0,  |1028  |éditeur hexadécimal complet      |
    |               |I:4   |      |(GNOME)                          |
    |---------------+------+------+---------------------------------|
    |okteta         |V:1,  |1508  |éditeur hexadécimal complet      |
    |               |I:15  |      |(KDE4)                           |
    |---------------+------+------+---------------------------------|
    |ncurses-hexedit|V:0,  |132   |éditeur et visualisateur binaire |
    |               |I:2   |      |(HEX, ASCII, EBCDIC)             |
    |---------------+------+------+---------------------------------|
    |beav           |V:0,  |133   |éditeur et visualisateur binaire |
    |               |I:0   |      |(HEX, ASCII, EBCDIC, OCTAL, …)   |
    +---------------------------------------------------------------+


    Astuce

    HEX est utilisé comme l'acronyme du format hexadécimal en base
    16. OCTAL désigne le format octal en base 8. ASCII est employé
    pour Code américain standard pour l’échange d’informations
    (« American Standard Code for Information Interchange »)
    c’est-à-dire le code pour texte normal en anglais. EBCDIC
    signifie Code d’échange étendu décimal codé binaire (« Extended
    Binary Coded Decimal Interchange Code »), il est utilisé avec par
    les systèmes d’exploitation des mainframe IBM.

%

9.7.2. Manipulation des fichiers sans monter le disque

    Il existe des outils permettant de lire et d’écrire des fichiers
    sans avoir à monter le disque.

    Tableau 9.21. Liste des paquets pour manipuler les fichiers sans
    monter le disque

    +---------------------------------------------------------------+
    | paquet |popcon |taille|              description              |
    |--------+-------+------+---------------------------------------|
    |mtools  |V:10,  |389   |utilitaires pour les fichiers MSDOS    |
    |        |I:83   |      |sans les monter                        |
    |--------+-------+------+---------------------------------------|
    |hfsutils|V:0,   |1884  |utilitaires pour les fichiers HFS et   |
    |        |I:7    |      |HFS+ sans les monter                   |
    +---------------------------------------------------------------+


%

9.7.3. Redondance des données

    Les systèmes s’appuyant sur le RAID logiciel offert par le noyau
    Linux permettent une redondance des données au niveau du système
    de fichiers du noyau afin d’obtenir un haut niveau de fiabilité
    du système de stockage.

    Il existe aussi des outils pour ajouter des données de redondance
    aux fichiers au niveau du programme applicatif permettant
    d’obtenir de hauts niveaux de fiabilité de stockage.

    Tableau 9.22. Liste d’outils pour ajouter des données de
    redondance aux fichiers

    +---------------------------------------------------------------+
    |  paquet  |popcon|taille|             description              |
    |----------+------+------+--------------------------------------|
    |par2      |V:4,  |271   |Parity Archive Volume Set, pour       |
    |          |I:15  |      |vérifier et réparer des fichiers      |
    |----------+------+------+--------------------------------------|
    |          |V:0,  |      |protection des supports CD et DVD     |
    |dvdisaster|I:2   |1741  |contre les pertes de données, les     |
    |          |      |      |rayures et le vieillissement          |
    |----------+------+------+--------------------------------------|
    |          |V:0,  |      |outil de sauvegarde utilisant des     |
    |dvbackup  |I:0   |413   |caméscopes MiniDV (fournissant rsbep  |
    |          |      |      |(1))                                  |
    |----------+------+------+--------------------------------------|
    |          |V:0,  |      |récupération de blocs en utilisant une|
    |vdmfec    |I:0   |97    |correction d’erreur vers l’avant      |
    |          |      |      |(« Forward Error Correction »)        |
    +---------------------------------------------------------------+


%

9.7.4. Récupération de fichiers de données et analyse par autopsie

    Il y a des outils pour la récupération des données et l’analyse
    par autopsie.

    Tableau 9.23. Liste de paquets pour la récupération de données et
    l’analyse par autopsie

    +---------------------------------------------------------------+
    |   paquet    |popcon|taille|            description            |
    |-------------+------+------+-----------------------------------|
    |             |V:3,  |      |utilitaires pour l’examen de       |
    |testdisk     |I:38  |1426  |partitions et la récupération de   |
    |             |      |      |disque                             |
    |-------------+------+------+-----------------------------------|
    |             |V:0,  |      |utilitaire pour la récupération de |
    |magicrescue  |I:3   |259   |fichiers et de recherche des octets|
    |             |      |      |magiques                           |
    |-------------+------+------+-----------------------------------|
    |scalpel      |V:0,  |87    |récupérateur de fichiers sobre de  |
    |             |I:4   |      |haute performance                  |
    |-------------+------+------+-----------------------------------|
    |myrescue     |V:0,  |83    |récupérer des données depuis des   |
    |             |I:3   |      |disques endommagés                 |
    |-------------+------+------+-----------------------------------|
    |             |V:1,  |      |utilitaire pour récupérer des      |
    |extundelete  |I:11  |148   |fichiers effacés d’un système de   |
    |             |      |      |fichiers ext3/4                    |
    |-------------+------+------+-----------------------------------|
    |             |V:0,  |      |utilitaire pour récupérer des      |
    |ext4magic    |I:4   |233   |fichiers effacés d’un système de   |
    |             |      |      |fichiers ext3/4                    |
    |-------------+------+------+-----------------------------------|
    |             |V:0,  |      |outil pour aider à la récupération |
    |ext3grep     |I:3   |281   |de fichiers effacés sur un système |
    |             |      |      |de fichiers ext3                   |
    |-------------+------+------+-----------------------------------|
    |             |V:0,  |      |programme de récupération de       |
    |scrounge-ntfs|I:3   |50    |données pour les systèmes de       |
    |             |      |      |fichiers NTFS                      |
    |-------------+------+------+-----------------------------------|
    |gzrt         |V:0,  |33    |boîte à outils de récupération gzip|
    |             |I:0   |      |                                   |
    |-------------+------+------+-----------------------------------|
    |sleuthkit    |V:2,  |1511  |outil pour autopsie (« forensics   |
    |             |I:24  |      |analysis« ». (Sleuthkit)           |
    |-------------+------+------+-----------------------------------|
    |autopsy      |V:0,  |1027  |interface graphique à SleuthKit    |
    |             |I:2   |      |                                   |
    |-------------+------+------+-----------------------------------|
    |foremost     |V:0,  |104   |application d’autopsie pour la     |
    |             |I:7   |      |récupération de données            |
    |-------------+------+------+-----------------------------------|
    |guymager     |V:0,  |1030  |outil de création d’image          |
    |             |I:1   |      |d’autopsie basée sur Qt            |
    |-------------+------+------+-----------------------------------|
    |dcfldd       |V:0,  |106   |version améliorée de dd pour les   |
    |             |I:5   |      |autopsies et la sécurité           |
    +---------------------------------------------------------------+


    Astuce

    Vous pouvez annuler l'effacement de fichiers sur un système de
    fichiers ext2 en utilisant les commandes list_deleted_inodes et
    undel de debugfs(8) dans le paquet e2fsprogs.

%

9.7.5. Éclater un gros fichier en petits fichiers

    Lorsque les données ont un volume trop important pour pouvoir
    être sauvegardée dans un seul fichier, vous pouvez en sauvegarder
    le contenu après l’avoir éclaté en morceaux de, par exemple,
    2000Mio et réassembler ces morceaux par la suite sous la forme du
    fichier d’origine.

    $ split -b 2000m gros_fichier
    $ cat x* >gros_fichier

    Attention
   
    Assurez-vous ne pas pas avoir de nom de fichier commençant par
    « x » afin d’éviter des plantages de nom.

%

9.7.6. Effacer le contenu d’un fichier

    Pour effacer le contenu d’un fichier comme, par exemple, un
    fichier journal, n’utilisez pas la commande rm(1) pour supprimer
    le fichier et recréer ensuite un fichier vide parce qu’on peut
    encore accéder au fichier dans l’intervalle entre les commandes.
    Voici la manière sûre d’effacer le contenu d’un fichier :

    $ :>fichier_a_effacer

%

9.7.7. Fichiers fictifs

    Les commandes suivantes créent des fichiers factices ou vides.

    $ dd if=/dev/zero    of=5kb.file bs=1k count=5
    $ dd if=/dev/urandom of=7mb.file bs=1M count=7
    $ touch zero.file
    $ : > alwayszero.file

    Vous obtiendrez les fichiers suivants :

      * « 5kb.file » avec 5K de zéros ;

      * « 7mb.file » avec 7Mo de données aléatoires ;

      * « zero.file » devrait être un fichier de 0 octet. S’il
        existait, son mtime est mis à jour alors que son contenu et
        sa taille sont conservés ;

      * « alwayszero.file  fait toujours 0 octet. S’il existait son
        mtime est mis à jour et son contenu vidé.

%

9.7.8. Effacer l’ensemble du disque dur

    Il existe plusieurs manières d’effacer complètement les données
    d’un périphérique semblable à un disque dur, par exemple, une clé
    USB se trouvant en « /dev/sda ».

    Attention

    Vérifiez d’abord l’emplacement de votre clé USB avec mount(8)
    avant d’exécuter ces commandes. Le périphérique pointé par « /dev
    /sda » peut être le disque dur SCSI ou un disque dur SATA sur
    lequel se trouve l’ensemble de votre système.

    Effacer tout le contenu du disque en réinitialisant toutes les
    données à 0 avec la commande suivante :

    # dd if=/dev/zero of=/dev/sda

    Tout effacer en écrasant les données existantes par des données
    aléatoires par la commande suivante :

    # dd if=/dev/urandom of=/dev/sda

    Effacer de manière très efficace toutes les données en les
    écrasant avec des données aléatoires par la commande suivante :

    # shred -v -n 1 /dev/sda

    Comme dd(1) est disponible depuis l’interpréteur de commandes de
    nombreux CD amorçables de Linux tels que le CD de l’installateur
    Debian, vous pouvez effacer complètement votre système installé
    en lançant la commande d’effacement du disque dur du système, par
    exemple, « /dev/hda », « /dev/sda », etc. depuis un tel support,

%

9.7.9. Effacer l’ensemble du disque dur

    Une zone inutilisée du disque dur (ou d’une clé mémoire USB), par
    ex. « /devsdb1 » peut encore contenir les données effacées
    elles-mêmes puisqu’elles ne sont que déliées du système de
    fichiers. Elles peuvent être nettoyées en les surchargeant.

    # mount -t auto /dev/sdb1 /mnt/foo
    # cd /mnt/foo
    # dd if=/dev/zero of=junk
    dd: writing to `junk': No space left on device
    ...
    # sync
    # umount /dev/sdb1

    Avertissement

    C’est en général suffisamment bon pour votre clé mémoire USB.
    Mais ce n’est pas parfait. La plupart des noms des fichiers
    effacés et leurs attributs peuvent être cachés et rester dans le
    système de fichiers.

%

9.7.10. Récupérer des fichiers supprimés mais encore ouverts

    Même si vous avez accidentellement supprimé un fichier, tant que
    ce fichier est en cours d’utilisation par une application
    quelconque, (en mode lecture ou écriture); il est possible de
    récupérer un tel fichier.

    Essayez, par exemple, ce qui suit :

    $ echo toto > titi
    $ less titi
    $ ps aux | grep ' less[ ]'
    bozo    4775  0.0  0.0  92200   884 pts/8    S+   00:18   0:00 less titi
    $ rm titi
    $ ls -l /proc/4775/fd | grep titi
    lr-x------ 1 bozo bozo 64 2008-05-09 00:19 4 -> /home/bozo/titi (deleted)
    $ cat /proc/4775/fd/4 >titi
    $ ls -l
    -rw-r--r-- 1 bozo bozo 4 2008-05-09 00:25 titi
    $ cat titir
    toto

    Exécutez sur un autre terminal (lorsque vous avez le paquet lsof
    installé) comme suit

    $ ls -li titi
    2228329 -rw-r--r-- 1 bozo bozo 4 2008-05-11 11:02 titi
    $ lsof |grep titi|grep less
    less 4775 bozo 4r REG 8,3 4 2228329 /home/bozo/titi
    $ rm titi
    $ lsof |grep titi|grep less
    less 4775 bozo 4r REG 8,3 4 2228329 /home/bozo/titi (deleted)
    $ cat /proc/4775/fd/4 >titi
    $ ls -li titi
    2228302 -rw-r--r-- 1 bozo bozo 4 2008-05-11 11:05 titi
    $ cat titi
    toto

%

9.7.11. Rechercher tous les liens physiques

    Les fichiers ayant des liens physiques peuvent être identifiés
    par « ls -li ».

    $ ls -li
    total 0
    2738405 -rw-r--r-- 1 root root 0 2008-09-15 20:21 titi
    2738404 -rw-r--r-- 2 root root 0 2008-09-15 20:21 tutu
    2738404 -rw-r--r-- 2 root root 0 2008-09-15 20:21 toto

    « tutu » et « toto » ont tous les deux un nombre de liens égal à
    "« 2 » (>1), ce qui indique qu’ils ont des liens physiques. Leur
    numéro d’inœud commun est « 2738404 ». Cela signifie qu’ils
    représentent le même fichier lié par des liens physiques. Si vous
    n’arrivez pas à trouver de fichiers liés par des liens physiques,
    vous pouvez les rechercher parinœud, par exemple « 2738404 », de
    la manière suivante :

    # find /chemin/vers/point/de/montage -xdev -inum 2738404

%

9.7.12. Consommation d’espace disque invisible

    Tous les fichiers supprimés mais ouverts prennent de l’espace
    disque même s’ils ne sont pas visibles par la commande du(1)
    normale. On peut en afficher la liste avec leur taille par la
    commande suivante :

    # lsof -s -X / |grep deleted

%

9.8. Astuces de chiffrement des données

    Avec un accès physique à votre PC, n’importe qui peut facilement
    obtenir les privilèges de l’administrateur et accéder à tous les
    fichiers de votre PC (consultez Section 4.7.4, « sécuriser le mot
    de passe de l’administrateur »). Cela signifie qu’un système avec
    un mot de passe de connexion ne permet pas de sécuriser vos
    données personnelles ou sensibles en cas de vol de votre PC. Vous
    devez déployer des technologies de chiffrements des données pour
    assurer cette protection. Bien que GNU privacy guard (consultez
    Section 10.3, « Infrastructure de sécurité des données ») puisse
    chiffrer des fichiers, il demande quelques efforts de la part de
    l’utilisateur.

    dm-crypt et eCryptfs facilitent de manière native le chiffrement
    automatique des données par l’intermédiaire de modules du noyau
    de Linux avec un minimum d’efforts de la part de l’utilisateur.

    Tableau 9.24. Liste d’utilitaires de chiffrement des données

    +---------------------------------------------------------------+
    |    paquet    |popcon|taille|           description            |
    |--------------+------+------+----------------------------------|
    |              |V:29, |      |utilitaires pour chiffrer un      |
    |cryptsetup    |I:78  |402   |périphérique en mode bloc         |
    |              |      |      |(dm-crypt / LUKS)                 |
    |--------------+------+------+----------------------------------|
    |              |      |      |utilitaires pour chiffrer un      |
    |              |V:4,  |      |périphérique en mode bloc         |
    |cryptmount    |I:5   |228   |(dm-crypt / LUKS), l’accent étant |
    |              |      |      |mis sur le montage et le démontage|
    |              |      |      |par un utilisateur normal         |
    |--------------+------+------+----------------------------------|
    |              |V:3,  |      |utilitaires pour systèmes de      |
    |ecryptfs-utils|I:5   |460   |fichiers empilés (« stackable »)  |
    |              |      |      |chiffrés (eCryptfs)               |
    +---------------------------------------------------------------+


    Dm-crypt est un système de fichiers chiffré qui utilise
    device-mapper. Device-mapper effectue le « mapping » d’un
    périphérique en mode bloc sur un autre.

    eCryptfs est un autre système de fichiers chiffré utilisant un
    système de fichiers empilé. Un système de fichiers empilé
    s’empile lui-même par dessus un répertoire existant d’un système
    de fichiers monté.

    Attention
   
    Le chiffrement des données a un coût en matière de temps
    processeur, etc. Veuillez comparer ses avantages à son coût.

    Note

    Le système Debian dans son ensemble peut être installé sur un
    disque chiffré par l’installateur debian (lenny ou plus récent)
    en utilisant dm-crypt/LUKS et initramfs.

    Astuce

    Consultez Section 10.3, « Infrastructure de sécurité des
    données » pour un utilitaire de chiffrement de l’espace
    utilisateur : GNU Privacy Guard.

%

9.8.1. Chiffrement des disques amovibles à l’aide de dm-crypt/LUKS

    Vous pouvez chiffrer le contenu des périphériques de masse
    amovible, par exemple, une clé USB sur « /dev/sdx » en utilisant
    dm-crypt/LUKS. Il suffit de le formater de la manière suivante :

    # badblocks -c 1024 -s -w -t random -v /dev/sdx
    # fdisk /dev/sdx
    ... "n" "p" "1" "return" "return" "w"
    # cryptsetup luksFormat /dev/sdx1
    ...
    # cryptsetup open --type luks /dev/sdx1 sdx1
    ...
    # ls -l /dev/mapper/
    total 0
    crw-rw---- 1 root root  10, 60 2008-10-04 18:44 control
    brw-rw---- 1 root disk 254,  0 2008-10-04 23:55 sdx1
    # mkfs.vfat /dev/mapper/sdx1
    ...
    # cryptsetup luksClose sdx1

    Il peut alors être monté simplement comme un périphérique normal
    sur « /media/<étiquette_disque> » à l’exception de la demande de
    mot de passe (consultez Section 10.1.7, « Périphériques
    d’enregistrement amovibles ») sous un environnement de bureau
    moderne tel que GNOME en utilisant gnome-mount(1). La différence
    est que toutes les données qui y seront écrites seront chiffrées.
    Vous pouvez aussi formater le support dans un système de fichiers
    différent, par exemple ext4 avec « mkfs.ext4 /dev/sdx1 ».

    Note

    Si vous êtes vraiment paranoïaque en ce qui concerne la sécurité
    des données, vous pourrez réécrire par dessus plusieurs fois (à
    l'aide de la commande « badblocks » dans l’exemple ci-dessus).
    Cette opération prend cependant beaucoup de temps.

%

9.8.2. Partition d’échange chiffrée avec dm-crypt

    Supposons que votre « /etc/fstab » d’origine comporte ce qui
    suit :

    /dev/sda7 swap sw 0 0

    Vous pouvez chiffrer la partition d’échange en utilisant dm-crypt
    par ce qui suit :

    # aptitude install cryptsetup
    # swapoff -a
    # echo "cswap /dev/sda7 /dev/urandom swap" >> /etc/crypttab
    # perl -i -p -e "s/\/dev\/sda7/\/dev\/mapper\/cswap/" /etc/fstab
    # /etc/init.d/cryptdisks restart
     ...
    # swapon -a

9.8.3. Monter des disques amovibles chiffrés à l’aide de dm-crypt/
LUKS

    Une partition de disque chiffrée créée avec dm-crypt/LUKS sur « /
    dev/sdc5 » peut être montée sur « /mnt » de la façon suivante :

    $ sudo cryptsetup open /dev/sdc5 ninja --type luks
    Enter passphrase for /dev/sdc5: ****
    $ sudo lvm
    lvm> lvscan
      inactive          '/dev/ninja-vg/root' [13.52 GiB] inherit
      inactive          '/dev/ninja-vg/swap_1' [640.00 MiB] inherit
      ACTIVE            '/dev/goofy/root' [180.00 GiB] inherit
      ACTIVE            '/dev/goofy/swap' [9.70 GiB] inherit
    lvm> lvchange -a y /dev/ninja-vg/root
    lvm> exit
      Exiting.
    $ sudo mount /dev/ninja-vg/root /mnt

%

9.8.4. Chiffrer les fichiers automatiquement avec eCryptfs

    Vous pouvez chiffrer automatiquement les fichiers se trouvant
    sous « ~/Private/ » en utilisant eCryptfs et le paquet
    ecryptfs-utils.

      * Lancez ecryptfs-setup-private(1) et configurez « ~/Private/ »
        en suivant les invites.

      * Activez « ~/Private/ » en lançant ecryptfs-mount-private(1).

      * Déplacez les fichiers de données sensibles vers « ~/Private/
         » et faites les liens symboliques à la demande.

          + Candidats : « ~/.fetchmailrc », « ~/.ssh/identity », « ~
            /.ssh/id_rsa », « »~/.ssh/id_dsa » et d’autres fichiers
            ayant « go-rwx »

      * Déplacez les répertoires ayant des données sensibles vers un
        sous-répertoire de « ~/Private/ » et faites les liens
        symboliques nécessaires.

          + Candidats : « ~/.gnupg » et d’autres répertoires avec
            « go-rwx »

      * Créez le lien symbolique de « ~/Desktop/Private/ » vers « ~/
        Private/ » pour faciliter les opérations du bureau.

      * Désactiver « ~/Private/ » en lançant ecryptfs-umount-private
        (1).

      * Activez « ~/Private/ » à l’aide de « ecryptfs-mount-private »
        lorsque vous avez besoin de vos données chiffrées.

    Astuce

    Comme eCryptfs ne chiffre que sélectivement les fichiers
    sensibles, son coût en matière de ressources système est bien
    moindre que l’utilisation de dm-crypt sur l’ensemble du système
    de fichiers racine ou sur le périphérique « /home ». Il ne
    demande aucun effort particulier sur l’allocation de l’espace
    disque mais ne peut conserver la confidentialité de toutes les
    métadonnées du système de fichiers.

%

9.8.5. Montage automatique de eCryptfs

    Si vous utilisez votre mot de passe de connexion pour envelopper
    les clés de chiffrement, vous pouvez automatiser le montage de
    eCryptfs par PAM (Pluggable Authentication Modules).

    Insérez la ligne suivante juste avant « pam_permit.so » dans « /
    etc/pam.d/common-auth » :

    auth required pam_ecryptfs.so unwrap

    Insérez la ligne suivante en tant que toute dernière ligne de « /
    etc/pam.d/common-session :

    session optional pam_ecryptfs.so unwrap

    Insérez la ligne suivante comme première ligne active de « /etc/
    pam.d/common-password :

    password required pam_ecryptfs.so

    C’est assez pratique.

    Avertissement

    Les erreurs de configuration de PAM peuvent vous interdire
    l’accès à votre propre système. Consultez Chapitre 4, 
    Authentification.

    Attention

    Si vous utilisez votre mot de passe de connexion pour encapsuler
    les clés de chiffrement, vos données chiffrées sont aussi sûre
    que l’est votre mot de passe de connexion (consultez Section 4.3,
    « Mot de passe de qualité »). À moins que vous ne preniez le soin
    de définir un mot de passe fort, vos données encourent un risque
    lorsque quelqu’un lance un logiciel de casse de mots de passe
    après avoir volé votre ordinateur (consultez Section 4.7.4,
    « sécuriser le mot de passe de l’administrateur »).

%

9.9. Le noyau

    Debian distribue des noyaux Linux modulaires sous forme de
    paquets pour les architectures prises en compte.

%

9.9.1. Noyau Linux 2.6/3.x

    Les noyaux Linux 2.6/3.x possèdent quelques fonctionnalités
    remarquables comparés à 2.4.

      * Les périphériques sont créés par le système udev (consultez
        Section 3.3, « Le système udev »).

      * Les accès en lecture et écriture aux périphériques CD et DVD
        IDE CD/DVD n’utilisent plus le module ide-scsi.

      * Les fonctions de filtrage des paquets réseau utilisent les
        modules iptable du noyau.

    Le saut de version de Linux passant de 2.6.39 à 3.0 n’est pas lié
    à des changements technologiques majeurs, mais à la célébration
    de son 20ème anniversaire.

%

9.9.2. Paramètres du noyau

    De nombreuses fonctionnalités du noyau peuvent être configurées
    par l’intermédiaire de paramètres du noyau de la manière
    suivante :

      * Paramètres du noyau initialisés par le gestionnaire
        d’amorçage (consultez Section 3.1.2, « Étage 2 : le chargeur
        initial »)

      * Paramètres du noyau modifiés par sysctl(8) lors du
        fonctionnement du système pour ceux auxquels on a accès par
        l’intermédiaire de sysfs (consultez Section 1.2.12, « procfs
        et sysfs »)

      * Paramètres des modules définis par les paramètres de modprobe
        (8) lors de l’activation d’un module (consultez
        Section 9.6.3, « Monter le fichier image du disque »)

    Consultez « kernel-parameters.txt(.gz) » et d’autres documents en
    rapport dans la documentation du noyau de Linux (« /usr/share/doc
    /linux-doc-3.*/Documentation/filesystems/* ») fournie par le
    paquet linux-doc-3.*.

%

9.9.3. En-têtes du noyau

    La plupart des programmes normaux n’ont pas besoin des en-têtes
    du noyau et peuvent de fait être cassés si vous les utilisez
    directement pour la compilation. Ils devront être compilés avec
    les en-têtes se trouvant dans « /usr/include/linux » et « /usr/
    include/asm » qui sont fournis, sur les systèmes Debian, par le
    paquet libc6-dev (créé à partir du paquet source glibc).

    Note

    Pour compiler certains programmes spécifiques au noyau, comme les
    modules du noyau, à partir de sources externes et le démon de
    montage automatique (amd), vous devez inclure dans votre ligne de
    commandes un chemin vers les en-têtes du noyau correspondants,
    par exemple « -I/usr/src/linux-version-particulière/include/ ».
    module-assistant(8) (ou sa forme abrégée m-a) aide les
    utilisateurs à construire et à installer facilement des paquets
    de modules pour un ou plusieurs noyaux personnalisés.

%

9.9.4. Compiler le noyau et les modules associés

    Debian a sa propre manière de compiler le noyau et les modules
    associés.

    Tableau 9.25. Liste des paquets-clés à installer pour la
    compilation du noyau sur un système Debian

    +---------------------------------------------------------------+
    |    paquet     |popcon|taille|           description           |
    |---------------+------+------+---------------------------------|
    |               |      |      |paquets essentiels pour la       |
    |build-essential|I:499 |20    |construction de paquets Debian : |
    |               |      |      |make, gcc, …                     |
    |---------------+------+------+---------------------------------|
    |bzip2          |V:157,|122   |utilitaires de compression et de |
    |               |I:970 |      |décompression des fichiers bz2   |
    |---------------+------+------+---------------------------------|
    |libncurses5-dev|I:116 |6     |bibliothèques de développement et|
    |               |      |      |documentations pour ncurses      |
    |---------------+------+------+---------------------------------|
    |               |V:305,|      |git :: système distribué de      |
    |git            |I:478 |35040 |contrôle de version utilisé par  |
    |               |      |      |le noyau de Linux                |
    |---------------+------+------+---------------------------------|
    |               |V:35, |      |fournit l’environnement fakeroot |
    |fakeroot       |I:521 |228   |pour construire le paquet sans   |
    |               |      |      |être administrateur (« root »)   |
    |---------------+------+------+---------------------------------|
    |               |V:371,|      |outil pour construire une image  |
    |initramfs-tools|I:989 |112   |mémoire initiale (« initramds ») |
    |               |      |      |(spécifique à Debian)            |
    |---------------+------+------+---------------------------------|
    |               |      |      |prise en charge dynamique des    |
    |dkms           |V:70, |294   |modules du noyau (dynamic kernel |
    |               |I:219 |      |module support : DKMS)           |
    |               |      |      |(générique)                      |
    |---------------+------+------+---------------------------------|
    |               |V:9,  |      |scripts d’assistance pour un     |
    |devscripts     |I:57  |2623  |responsable de paquet Debian     |
    |               |      |      |(spécifique à Debian)            |
    +---------------------------------------------------------------+


    Si vous utilisez un initrd dans Section 3.1.2, « Étage 2 : le
    chargeur initial », veuillez lire les informations
    correspondantes dans initramfs-tools(8), update-initramfs(8), 
    mkinitramfs(8) et initramfs.conf(5).

    Avertissement

    Ne mettez pas de liens symboliques vers le répertoire de
    l’arborescence des source (par exemple « /usr/src/linux* »)
    depuis « /usr/include/linux » et « /usr/include/asm » lors de la
    compilation des sources du noyau de Linux. (Certains documents
    périmés le suggèrent).

    Note

    Lors de la compilation du dernier noyau de Linux sous un système
    Debian stable, l’utilisation des derniers outils rétroportés
    depuis la distribution Debian unstable peuvent être nécessaires.

    Note

    Le gestionnaire de modules dynamique du noyau (« dynamic kernel
    module support (DKMS) » est une nouvelle architecture
    indépendante de la distribution conçue pour permettre la mise à
    jour de modules individuels du noyau sans modifier l’ensemble du
    noyau. Cela est utilisé pour la maintenance de modules hors
    arborescence. Cela rend aussi très facile la reconstruction des
    modules après la mise à niveau des noyaux.

9.9.5. Compiler les sources du noyau : recommandations de l’équipe en
charge du noyau Debian

    Pour construire des paquets binaires d’un noyau personnalisé à
    partir des sources du noyau amont, vous devriez utiliser la cible
    « deb-pkg » fournie pour cela.

    $ sudo apt-get build-dep linux
    $ cd /usr/src
    $ wget http://www.kernel.org/pub/linux/kernel/v3.11/linux-<version>.tar.bz2
    $ tar -xjvf linux-<version>.tar.bz2
    $ cd linux-<version>
    $ cp /boot/config-<version> .config
    $ make menuconfig
     ...
    $ make deb-pkg

    Astuce

    Le paquet linux-source-<version> fournit les sources du noyau
    Linux avec les correctifs Debian en tant que « /usr/src/linux-
    <version>.tar.bz2 ».

    Pour construire des paquets binaires particuliers à partir du
    paquet source Debian, vous devriez utiliser les cibles
    « binary-arch_<architecture>_<jeu_de_fonctionnalités>_<saveur> »
    dans « debian/rules.gen ».

    $ sudo apt-get build-dep linux
    $ apt-get source linux
    $ cd linux-3.*
    $ fakeroot make -f debian/rules.gen binary-arch_i386_none_686

    Consultez les renseignements complémentaires :

      * wiki Debian : KernelFAQ ;

      * wiki Debian : DebianKernel ;

      * Debian Linux Kernel Handbook: https://
        kernel-handbook.debian.net

%

9.9.6. Pilotes de matériel et microprogramme

    Le pilote de matériel est le code s’exécutant sur le système
    cible. La plupart des pilotes de matériel sont maintenant
    disponibles sont forme de logiciels libres et font partie des
    paquets Debian du noyau dans la section main.

      * Pilote de processeur graphique

          + Pilote Intel (main)

          + Pilote AMD ou ATI (main)

          + Pilote NVIDIA (main pour le pilote nouveau et non-free
            pour les pilotes binaires pris en charge par le
            constructeur)

      * Pilote de Softmodem

          + Paquets martian-modem et sl-modem-dkms (non libres)

    Le microprogramme est le code ou les données chargées sur le
    périphérique (par exemple le microcode de processeur, le code de
    rendu exécuté sur les processeurs graphiques, ou les données de
    FPGA ou de CPLD, etc.) Certains paquets de microprogramme sont
    disponibles sous forme de logiciel libre, mais beaucoup de
    paquets de microprogramme ne le sont pas car ils contiennent des
    données binaires sans source.

      * firmware-linux-free (main)

      * firmware-linux-nonfree (non libre)

      * firmware-linux-* (non libre)
   
      * *-firmware (non libre)

      * intel-microcode (non libre)

      * amd64-microcode (non libre)

    Veuillez remarquer que les paquets de non-free et contrib ne font
    pas partie du système Debian. La configuration pour activer et
    désactiver les sections non-free et contrib est décrite en
    Section 2.1.4, « Bases concernant l’archive Debian ». Vous
    devriez être conscient des aspects négatifs associés à
    l’utilisation de paquets de non-free et contrib décrits dans
    Section 2.1.5, « Debian est totalement libre ».

%

9.10. Système virtualisé

    L’utilisation d’un système virtualisé permet de faire tourner
    simultanément plusieurs instances du système sur une plateforme
    unique.

    Astuce
   
    Consultez http://wiki.debian.org/fr/SystemVirtualization .

%

9.10.1. Outils de virtualisation

    Il a plusieurs paquets associés à la virtualisation et à
    l’émulation du système sous Debian au-delà d’un simple chroot.
    Certains paquets vous facilitent la mise en place d’un tel
    système.

    Tableau 9.26. Liste des outils de virtualisation

    +---------------------------------------------------------------+
    |    paquet     |popcon|taille|           description           |
    |---------------+------+------+---------------------------------|
    |               |V:7,  |      |outil spécialisé pour l’exécution|
    |schroot        |I:10  |2708  |d’un paquet binaire de Debian    |
    |               |      |      |dans un chroot                   |
    |---------------+------+------+---------------------------------|
    |               |V:1,  |      |outil pour construire des paquets|
    |sbuild         |I:4   |286   |binaires de Debian depuis les    |
    |               |      |      |sources Debian                   |
    |---------------+------+------+---------------------------------|
    |pbuilder       |V:2,  |966   |constructeur personnel de paquets|
    |               |I:16  |      |pour des paquets Debian          |
    |---------------+------+------+---------------------------------|
    |debootstrap    |V:6,  |298   |amorcer un système Debian de base|
    |               |I:63  |      |(écrit en sh)                    |
    |---------------+------+------+---------------------------------|
    |cdebootstrap   |V:0,  |116   |amorcer un système Debian (écrit |
    |               |I:3   |      |en C)                            |
    |---------------+------+------+---------------------------------|
    |               |      |      |Gestionnaire de machine          |
    |virt-manager   |V:10, |2298  |virtuelle : application du       |
    |               |I:42  |      |gestionnaire de bureau pour la   |
    |               |      |      |gestion des machines virtuelles  |
    |---------------+------+------+---------------------------------|
    |libvirt-clients|V:43, |1167  |programmes pour la bibliothèque  |
    |               |I:62  |      |libvirt                          |
    |---------------+------+------+---------------------------------|
    |bochs          |V:0,  |7194  |Bochs : émulateur PC IA-32       |
    |               |I:1   |      |                                 |
    |---------------+------+------+---------------------------------|
    |qemu           |I:34  |94    |QEMU : émulateur de processeur   |
    |               |      |      |générique rapide                 |
    |---------------+------+------+---------------------------------|
    |qemu-system    |I:21  |95    |QEMU : binaires pour l’émulation |
    |               |      |      |d’un système complet             |
    |---------------+------+------+---------------------------------|
    |qemu-user      |V:0,  |89671 |QEMU : binaires pour l’émulation |
    |               |I:13  |      |en mode utilisateur              |
    |---------------+------+------+---------------------------------|
    |qemu-utils     |V:11, |6083  |QEMU : utilitaires               |
    |               |I:107 |      |                                 |
    |---------------+------+------+---------------------------------|
    |               |      |      |KVM : virtualisation complète sur|
    |qemu-kvm       |V:10, |107   |les plateformes x86 ayant une    |
    |               |I:61  |      |virtualisation assistée par le   |
    |               |      |      |matériel                         |
    |---------------+------+------+---------------------------------|
    |               |V:12, |      |VirtualBox : solution de         |
    |virtualbox     |I:16  |106495|virtualisation x86 sur i386 et   |
    |               |      |      |amd64                            |
    |---------------+------+------+---------------------------------|
    |xen-tools      |V:0,  |727   |outils pour gérer le serveur     |
    |               |I:4   |      |virtuel XEN de Debian            |
    |---------------+------+------+---------------------------------|
    |wine           |V:19, |192   |Wine : implémentation de l’API   |
    |               |I:82  |      |Windows (suite standard)         |
    |---------------+------+------+---------------------------------|
    |               |V:2,  |      |DOSBox : émulateur x86 avec      |
    |dosbox         |I:18  |2742  |graphisme Tandy/Herc/CGA/EGA/VGA/|
    |               |      |      |SVGA, son et DOS                 |
    |---------------+------+------+---------------------------------|
    |dosemu         |V:0,  |4891  |DOSEMU : l’émulateur DOS de Linux|
    |               |I:2   |      |                                 |
    |---------------+------+------+---------------------------------|
    |vzctl          |V:0,  |1112  |OpenVZ solution de virtualisation|
    |               |I:1   |      |de serveur - outils de contrôle  |
    |---------------+------+------+---------------------------------|
    |vzquota        |V:0,  |236   |OpenVZ solution de virtualisation|
    |               |I:1   |      |de serveur - outils de quota     |
    |---------------+------+------+---------------------------------|
    |lxc            |V:10, |18761 |Conteneurs Linux outils de       |
    |               |I:15  |      |l’espace utilisateur             |
    +---------------------------------------------------------------+


    Consultez l’article de Wikipedia Comparaison de machines pour
    plateforme virtuelle pour une comparaison détaillée entre les
    différentes solutions de plateformes de virtualisation.

%

9.10.2. Étapes de la virtualisation

    Note
   
    Certaines fonctionnalités décrites ici ne sont disponibles que
    dans squeeze ou versions supérieures.

    Note
   
    Les noyaux par défaut de Debian prennent en charge KVM depuis
    lenny.

    La virtualisation met en œuvre plusieurs étapes :

      * Créer un système de fichiers vide (une arborescence de
        fichiers ou une image disque).

          + L’arborescence de fichiers peut être créée par « mkdir -p
            /path/to/chroot ».

          + L’image disque brute peut être créée à l’aide de dd(1)
            (consultez Section 9.6.1, « Créer le fichier image du
            disque » et Section 9.6.5, « Réaliser le fichier image
            d’un disque vide »).

          + qemu-img(1) peut être utilisé pour créer et convertir des
            fichiers d’image disque pris en charge par QEMU.

          + Les formats de fichier brut et VMDK peuvent être utilisés
            en tant que formats courants par les outils de
            virtualisation.

      * Monter l’image disque dans le système de fichiers avec mount
        (8) (optionnel).

          + Pour l’image disque brute, le montage doit être fait avec
            un périphérique de rebouclage ou des périphériques device
            mapper (consultez Section 9.6.3, « Monter le fichier
            image du disque »).

          + Les images disques prises en charge par QEMU seront
            montées en tant que périphériques réseau en mode bloc>
            (consultez Section 9.10.3, « Monter le fichier image du
            disque virtuel  »).

      * Peupler le système de fichiers cible avec les données
        requises.

          + L’utilisation de programmes tels que debootstrap et
            cdebootstrap facilite ce processus (consultez
            Section 9.10.4, « Système protégé (chroot) »).

          + Utiliser les installateurs des systèmes d’exploitation
            sous l’émulation du système complet.

      * Lancer un programme dans l’environnement virtualisé.

          + chroot fournit un environnement virtualisé de base,
            suffisant pour y compiler des programmes, y faire tourner
            des applications en mode console et des démons.

          + QEMU fournit une émulation de processeur
            interplateformes.

          + QEMU avec KVM fournit une émulation système complète avec
            la virtualisation assistée par le matériel.

          + VirtualBox fournit une émulation du système complet sur
            i386 amd64 avec ou sans la virtualisation assistée par le
            matériel.

%

9.10.3. Monter le fichier image du disque virtuel

    Pour le fichier image disque brut, consultez Section 8.4, « Les
    paramètres linguistiques (« locale ») ».

    Pour d’autres fichiers d’images disques virtuels, vous pouvez
    utiliser qemu-nbd(8) pour les exporter en utilisant le protocole
    network block device et en les montant à l’aide du module nbd du
    noyau.

    qemu-nbd(8) gère les formats de disques pris en compte par QEMU :
    QEMU gère les formats de disques suivants  raw, qcow2, qcow,
    vmdk, vdi, bochs, cow (mode utilisateur de Linux copy-on-write),
    parallels, dmg, cloop, vpc, vvfat (VFAT virtuelle) et
    host_device.

    Le network block device peut gérer des partitions de la même
    manière que le périphérique de rebouclage (« loop device »
    (consultez Section 9.6.3, « Monter le fichier image du disque »).
    Vous pouvez monter la première partition de « disk.img » de la
    manière suivante :

    # modprobe nbd max_part=16
    # qemu-nbd -v -c /dev/nbd0 disk.img
    ...
    # mkdir /mnt/part1
    # mount /dev/nbd0p1 /mnt/part1

    Astuce
   
    Vous ne pouvez exporter que la première partition de « disk.img »
    en utilisant l’option « -P 1 » de qemu-nbd(8).

%

9.10.4. Système protégé (chroot)

    chroot(8) propose la plupart des moyens simples pour faire
    tourner simultanément plusieurs instances de l’environnement GNU/
    Linux sur un même système sans redémarrer.

    Attention

    Les exemple ci-dessous supposent que le système père et le
    système chroot partagent tous les deux la même architecture de
    processeur.

    Vous pouvez apprendre comment configurer et utiliser chroot(8) en
    lançant le programme pbuilder(8) sous script(1) comme suit :

    $ sudo mkdir /sid-root
    $ sudo pbuilder --create --no-targz --debug --buildplace /sid-root

    Vous pouvez voir comment debootstrap(8) ou cdebootstrap(1)
    installent les données du système pour l’environnement sid sous
    « /sid-root ».

    Astuce

    debootstrap(8) ou cdebootstrap(1) sont utilisés pour installer
    Debian avec l’installateur Debian. Ils peuvent aussi être
    utilisés pour installer Debian sur un système sans utiliser de
    disque d’installation de Debian, mais en provenance d’une autre
    distribution GNU/Linux.

    $ sudo pbuilder --login --no-targz  --debug --buildplace /sid-root

    Vous pouvez voir ci-après comment un shell système tournant sous
    l’environnement sid est créé :

     1. Copier la configuration locale (« /etc/hosts », « /etc/
        hostname », « /etc/resolv.conf »)

     2. Monter le système de fichiers « /proc »

     3. Monter le système de fichiers « /dev/pts »

     4. Créer « /usr/sbin/policy-rc.d » qui existe toujours avec 101

     5. Lancer « chroot /sid-root bin/bash -c 'exec -a -bash bin/
        bash' »

    Note

    Certains programmes sous chroot peuvent demander l’accès à
    davantage de fichiers du système parent pour fonctionner que ceux
    que fournit pbuilder. Par exemple, on peut avoir besoin de monter
    liés (« bind-mount ») ou de copier « /sys », « /etc/passwd », « /
    etc/group », « /var/run/utmp », « /var/log/wtmp », etc.

    Note

    Le fichier « /usr/sbin/policy-rc.d » évite que des programmes
    démons ne soient démarrés automatiquement sur le système Debian.
    Consultez « /usr/share/doc/sysv-rc/README.policy-rc.d.gz ».

    Astuce

    Le but d’origine du paquet spécialisé d’environnement protégé
    (chroot) pbuilder est de construire une système protégé et de
    construire un paquet depuis cet environnement. C’est le système
    idéal à utiliser pour vérifier que les dépendances de
    construction d’un paquet sont correctes et pour s’assurer que les
    dépendances de construction erronées ou non nécessaires
    n’existent pas dans le paquet résultant.

    Astuce
   
    De même, le paquet schroot peut vous donner l’idée de faire
    tourner un système chroot i386 sous le système parent amd64.

%

9.10.5. Systèmes de bureaux multiples

    Je vous recommande d’utiliser QEMU ou VirtualBox sur un système
    Debian stable afin de faire tourner des systèmes de bureau
    multiples en utilisant la virtualisation. Cela vous permet de
    lancer des applications de bureau de Debian unstable et testing
    sans les risques qui leur sont habituellement associés.

    Comme QEMU pur est très lent, il est recommandé de l’accélérer
    avec KVM lorsque le sysètme hôte le prend en charge.

    L’image disque virtuelle « virtdisk.qcow2 » qui contient un
    système Debian pour QEMU peut être créée en utilisant un CD
    minimal de debian-installer de la manière suivante :

    $ wget http://cdimage.debian.org/debian-cd/5.0.3/amd64/iso-cd/debian-503-amd64-netinst.iso
    $ qemu-img create -f qcow2 virtdisk.qcow2 5G
    $ qemu -hda virtdisk.qcow2 -cdrom debian-503-amd64-netinst.iso -boot d -m 256
    ...

    Vous trouverez des astuces supplémentaires sur le wiki Debian :
    QEMU.

    VirtualBox est fourni avec des outils ayant une interface
    graphique Qt et est assez intuitif. Son interface graphique et
    ses outils en ligne de commandes sont expliqués dans le Manuel de
    l’utilisateur de VirtualBox et le Manuel de l’utilisateur
    VirtualBox (PDF).

    Astuce

    Faire tourner d’autres distributions de GNU/Linux comme Ubuntu et
    Fedora sous une virtualisation est une bonne manière d’en étudier
    les astuces de configuration. D’autres systèmes d’exploitation
    propriétaires peuvent aussi tourner de manière agréable sous la
    virtualisation GNU/Linux.

Chapitre 10. Gestion des données

    Des outils et astuces pour gérer les données binaires ou
    textuelles sur le système sont décrits.

%

10.1. Partager, copier et archiver

    Avertissement

    Il ne faut pas accéder de manière non coordonnée en écriture à
    des périphériques et des fichiers à haut trafic depuis différents
    processus pour éviter une compétition d’accès (« race
    condition ». Pour l’éviter, on peut utiliser les mécanismes de
    verrouillage de fichier (« File locking » en utilisant flock(1).

    La sécurité des données et leur partage contrôlé présentent
    plusieurs aspects.

      * La création d’une archive des données

      * L’accès à un stockage distant

      * La duplication

      * Le suivi de l’historique des modifications

      * La facilité de partage des données

      * La prévention de l’accès non autorisé aux données

      * La détection des modifications de fichier non autorisées

    Cela peut être réalisé avec certaines combinaisons d’outils.

      * Outils d’archivage et de compression

      * Outils de copie et de synchronisation

      * Systèmes de fichiers par le réseau

      * Supports d’enregistrement amovibles
   
      * L’interpréteur de commandes sécurisé

      * Le système d’authentification

      * Outils de système de contrôle de version

      * Outils de hachage et de chiffrement

%

10.1.1. Outils d’archivage et de compression

    Voici un résumé des outils d’archivage et de compression
    disponible sur le système Debian :

    Tableau 10.1. Liste des outils d’archivage et de compression

    +---------------------------------------------------------------+
    |  paquet  |popcon|taille|extension|commande|    commentaire    |
    |----------+------+------+---------+--------+-------------------|
    |tar       |V:905,|3098  |.tar     |tar(1)  |archiveur standard |
    |          |I:999 |      |         |        |(standard de fait) |
    |----------+------+------+---------+--------+-------------------|
    |          |      |      |         |        |archiveur de style |
    |cpio      |V:412,|1136  |.cpio    |cpio(1) |UNIX System V,     |
    |          |I:998 |      |         |        |utiliser avec find |
    |          |      |      |         |        |(1)                |
    |----------+------+------+---------+--------+-------------------|
    |          |      |      |         |        |archiveur pour la  |
    |binutils  |V:164,|97    |.ar      |ar(1)   |création de        |
    |          |I:678 |      |         |        |bibliothèques      |
    |          |      |      |         |        |statiques          |
    |----------+------+------+---------+--------+-------------------|
    |fastjar   |V:2,  |183   |.jar     |fastjar |archiveur pour Java|
    |          |I:29  |      |         |(1)     |(semblable à zip)  |
    |----------+------+------+---------+--------+-------------------|
    |          |      |      |         |        |nouvel archiveur   |
    |pax       |V:13, |170   |.pax     |pax(1)  |standard POSIX,    |
    |          |I:26  |      |         |        |compromis entre tar|
    |          |      |      |         |        |et cpio            |
    |----------+------+------+---------+--------+-------------------|
    |          |      |      |         |gzip(1),|utilitaire de      |
    |gzip      |V:883,|245   |.gz      |zcat(1),|compression GNU    |
    |          |I:999 |      |         |…       |LZ77 (standard de  |
    |          |      |      |         |        |fait)              |
    |----------+------+------+---------+--------+-------------------|
    |          |      |      |         |        |utilitaire de      |
    |          |      |      |         |        |transformée par tri|
    |          |      |      |         |        |de blocs de        |
    |          |      |      |         |bzip2(1)|Burrows-Wheeler    |
    |bzip2     |V:157,|122   |.bz2     |, bzcat |permettant un taux |
    |          |I:970 |      |         |(1), …  |de compression plus|
    |          |      |      |         |        |élevé que gzip(1)  |
    |          |      |      |         |        |(plus lent que gzip|
    |          |      |      |         |        |avec une syntaxe   |
    |          |      |      |         |        |similaire)         |
    |----------+------+------+---------+--------+-------------------|
    |          |      |      |         |        |utilitaire de      |
    |          |      |      |         |        |compression LZMA   |
    |lzma      |V:2,  |149   |.lzma    |lzma(1) |avec un plus haut  |
    |          |I:29  |      |         |        |taux de compression|
    |          |      |      |         |        |que gzip(1)        |
    |          |      |      |         |        |(obsolète)         |
    |----------+------+------+---------+--------+-------------------|
    |          |      |      |         |        |utilitaire de      |
    |          |      |      |         |        |compression XZ avec|
    |          |      |      |         |        |un plus haut taux  |
    |          |      |      |         |xz(1),  |de compression que |
    |xz-utils  |V:454,|612   |.xz      |xzdec(1)|bzip2(1) (plus lent|
    |          |I:977 |      |         |, …     |que gzip mais plus |
    |          |      |      |         |        |rapide que bzip2;  |
    |          |      |      |         |        |le remplaçant de   |
    |          |      |      |         |        |LZMA utilitaire de |
    |          |      |      |         |        |compression)       |
    |----------+------+------+---------+--------+-------------------|
    |          |      |      |         |        |archiveur de       |
    |          |V:89, |      |         |7zr(1), |fichiers 7-Zip avec|
    |p7zip     |I:464 |987   |.7z      |p7zip(1)|un haut taux de    |
    |          |      |      |         |        |compression        |
    |          |      |      |         |        |(compression LZMA) |
    |----------+------+------+---------+--------+-------------------|
    |          |      |      |         |        |archiveur de       |
    |          |      |      |         |        |fichiers 7-Zip avec|
    |p7zip-full|V:113,|4664  |.7z      |7z(1),  |un haut taux de    |
    |          |I:486 |      |         |7za(1)  |compression        |
    |          |      |      |         |        |(compression LZMA  |
    |          |      |      |         |        |et autres)         |
    |----------+------+------+---------+--------+-------------------|
    |          |      |      |         |        |utilitaire de      |
    |          |      |      |         |        |compression LZO    |
    |          |      |      |         |        |avec de plus hautes|
    |          |      |      |         |        |vitesses de        |
    |          |V:9,  |      |         |        |compression et de  |
    |lzop      |I:76  |164   |.lzo     |lzop(1) |décompression que  |
    |          |      |      |         |        |gzip(1) (plus      |
    |          |      |      |         |        |faible taux de     |
    |          |      |      |         |        |compression que    |
    |          |      |      |         |        |gzip avec une      |
    |          |      |      |         |        |syntaxe similaire) |
    |----------+------+------+---------+--------+-------------------|
    |          |V:51, |      |         |        |InfoZIP : outil    |
    |zip       |I:432 |608   |.zip     |zip(1)  |d’archive et de    |
    |          |      |      |         |        |compression DOS    |
    |----------+------+------+---------+--------+-------------------|
    |          |V:154,|      |         |        |InfoZIP : outil de |
    |unzip     |I:798 |566   |.zip     |unzip(1)|désarchivage et de |
    |          |      |      |         |        |décompression DOS  |
    +---------------------------------------------------------------+


    Avertissement

    Ne positionnez par la variable « $TAPE » à moins que vous ne
    sachiez à quoi vous attendre. Elle modifie le comportement de tar
    (1).

    Note
   
    L’archive tar(1) utilise l’extension de fichier « .tgz » ou
    « .tar.gz ».

    Note
   
    L’archive tar(1) avec compression xz utilise l’extension de
    fichier « .txz » ou « .tar.xz ».

    Note
   
    La méthode de compression habituelle des outils FOSS tels que tar
    (1) a été modifiée de la manière suivante : gzip → bzip2 → xz

    Note
   
    cp(1), scp(1) et tar(1) peuvent avoir certaines limitations pour
    des fichiers spéciaux. cpio(1) est plus souple.

    Note

    cpio(1) est conçu pour être utilisé avec find(1) et d’autres
    commandes et est adapté à la création de scripts de sauvegarde
    car la partie correspondant à la sélection de fichier du script
    peut être testée indépendamment.

    Note

    La structure interne des fichiers de données de Libreoffice est
    composée de fichiers « .jar » qui peut être ouvert également par
    unzip.

    Note

    The de-facto cross platform archive tool is zip. Use it as "zip
    -rX" to attain the maximum compatibility. Use also the "-s"
    option, if the maximum file size matters.

%

10.1.2. Outils de copie et de synchronisation

    Voici une liste d’outils simples de copie et de sauvegarde sur le
    système Debian :

    Tableau 10.2. Liste des outils de copie et de synchronisation

    +---------------------------------------------------------------+
    |    paquet    |popcon|taille|outil|          fonction          |
    |--------------+------+------+-----+----------------------------|
    |              |V:891,|      |GNU  |copier localement des       |
    |coreutils     |I:999 |17478 |cp   |fichiers et répertoires     |
    |              |      |      |     |(« -a » pour récursif)      |
    |--------------+------+------+-----+----------------------------|
    |              |      |      |     |copier à distance des       |
    |openssh-client|V:803,|4298  |scp  |fichiers et des répertoires |
    |              |I:996 |      |     |(client, « -r » pour        |
    |              |      |      |     |récursif)                   |
    |--------------+------+------+-----+----------------------------|
    |              |V:690,|      |     |copier à distance des       |
    |openssh-server|I:834 |1567  |sshd |fichiers et des répertoires |
    |              |      |      |     |(serveur distant)           |
    |--------------+------+------+-----+----------------------------|
    |              |V:281,|      |     |synchronisation et          |
    |rsync         |I:560 |677   |-    |sauvegarde distantes        |
    |              |      |      |     |unidirectionnelles          |
    |--------------+------+------+-----+----------------------------|
    |              |V:4,  |      |     |synchronisation et          |
    |unison        |I:17  |14    |-    |sauvegarde distantes        |
    |              |      |      |     |bidirectionnelles           |
    +---------------------------------------------------------------+


    Copier des fichiers avec rsync(8) offres des fonctionnalités plus
    riches que les autres méthodes.

      * algorithme de transfert delta qui n’envoie que la différence
        entre les fichiers source et les fichiers existants sur la
        destination

      * algorithme de vérification rapide (par défaut) recherchant
        les fichiers dont la taille ou l’heure de dernière
        modification a été modifiée

      * Les options « --exclude » et « --exclude-from » sont
        semblables à celles de tar(1)

      * La syntaxe « un slash en fin de répertoire source » qui évite
        la création d’un niveau de répertoire supplémentaire à la
        destination.

    Astuce

    L’exécution du script bkup mentionné dans Section 10.2.3, « Un
    script de copie pour la sauvegarde des données » avec l’option
    « -gl » sous cron(8) fournira une fonctionnalité très semblable à
    dumpfs de Plan9 pour l’archivage des données statiques.

    Astuce

    Les outils de système de contrôle de version (VCS) de
    Tableau 10.11, « Liste d’outils pour les systèmes de contrôle de
    version » peuvent fonctionner comme outils de synchronisation et
    de copie multi-voies.

%

10.1.3. Idiomes pour les archives

    Voici quelques manières d’archiver et de désarchiver le contenu
    entier du répertoire « ./source » en utilisant différents outils.

    GNU tar(1) :

    $ tar -cvJf archive.tar.xz ./source
    $ tar -xvJf archive.tar.xz

    ou encore, comme suit :

    $ find ./source -xdev -print0 | tar -cvJf archive.tar.xz --null -F -

    cpio(1) :

    $ find ./source -xdev -print0 | cpio -ov --null > archive.cpio; xz archive.cpio
    $ zcat archive.cpio.xz | cpio -i

%

10.1.4. Idiomes pour la copie

    Voici quelques manières d’archiver et de désarchiver le contenu
    entier du répertoire « ./source » en utilisant différents outils.

      * Copie locale du répertoire « ./source » → répertoire « /
        dest »
   
      * Faire le copie distante du répertoire « ./source » de la
        machine locale → répertoire « /dest » situé sur la machine
        « user@host.dom »

    rsync(8) :

    # cd ./source; rsync -aHAXSv . /dest
    # cd ./source; rsync -aHAXSv . user@host.dom:/dest

    Vous pouvez, en remplacement, utiliser la syntaxe « un slash en
    fin du répertoire source ».

    # rsync -aHAXSv ./source/ /dest
    # rsync -aHAXSv ./source/ user@host.dom:/dest

    ou encore, comme suit :

    # cd ./source; find . -print0 | rsync -aHAXSv0 --files-from=- . /dest
    # cd ./source; find . -print0 | rsync -aHAXSv0 --files-from=- . user@host.dom:/dest

    GNU cp(1) et openSSH scp(1) :

    # cd ./source; cp -a . /dest
    # cd ./source; scp -pr . user@host.dom:/dest

    GNU tar(1) :

    # (cd ./source && tar cf - . ) | (cd /dest && tar xvfp - )
    # (cd ./source && tar cf - . ) | ssh user@host.dom '(cd /dest && tar xvfp - )'

    cpio(1) :

    # cd ./source; find . -print0 | cpio -pvdm --null --sparse /dest

    Vous pouvez remplacer « . » par « truc » dans tous les exemples
    comportant « . » pour copier les fichiers du répertoire « ./
    source/truc » vers le répertoire « /dest/truc ».

    Vous pouvez remplacer « . » par le chemin absolu « /chemin/vers/
    source/truc » dans tous les exemples comportant « . » pour éviter
    « cd ./source; ». Cela permet de copier les fichiers vers
    différents emplacements selon les outils utilisés de la manière
    suivante :

      * « /dest/truc » : rsync(8), GNU cp(1) et scp(1)
   
      * « /dest/chemin/vers/source/truc »: GNU tar(1) et cpio(1)

    Astuce
   
    rsync(8) et GNU cp(1) possèdent l’option « -u » pour sauter les
    fichiers qui sont plus récents sur la destination.

%

10.1.5. Idiomes pour la sélection de fichiers

    find(1) est utilisé pour la sélection de fichiers pour les
    commandes d’archive et de copie (consultez Section 10.1.3,
    « Idiomes pour les archives » et Section 10.1.4, « Idiomes pour
    la copie ») ou pour xargs(1) (consultez Section 9.3.9, « Répéter
    une commande en bouclant entre des fichiers »). Cela peut être
    amélioré en utilisant ces paramètres de commande.

    La syntaxe de base de find(1) peut être résumée comme suit :

      * Ses paramètres conditionnels sont évalués de gauche à droite.

      * L’évaluation s’arrête lors que son résultat est déterminé.

      * Le « OU logique » (indiqué par « -o » entre les éléments
        conditionnels) a une plus faible priorité que le « ET
        logique » (indiqué par « -a » ou rien entre éléments
        conditionnels).

      * Le « NON logique » (indiqué par « ! » avant un élément
        conditionnel) a une priorité plus élevée que le « ET
        logique ».

      * « -prune » retourne toujours un VRAI logique et, si c’est un
        répertoire, la recherche de fichier est arrêtée au-delà de ce
        point.

      * « -name » correspond à la base du nom de fichier avec les
        motifs génériques de l’interpréteur de commandes (voir
        Section 1.5.6, « Motifs génériques (« glob ») de
        l’interpréteur de commandes ») mais il correspond aussi à son
        « . » de début avec des métacaractères comme « * » et « ? »
        (nouvelle fonctionnalité POSIX).

      * « -regex » correspond au chemin complet par défaut dans le
        style BRE Emacs (consultez Section 1.6.2, « Expressions
        rationnelles »).

      * « -size » correspond au fichier en se basant sur la taille du
        fichier (valeur précédée de « + » pour plus grand et précédée
        de « - » pour plus petit)

      * « -newer » correspond au fichier plus récent que celui
        indiqué comme paramètre.

      * « -print0 » retourne toujours la valeur logique VRAI et
        affiche sur la sortie standard le nom de fichier en entier
        (terminé par le caractère null).

    find(1) est souvent utilisé dans un style idiomatique comme ce
    qui suit :

    # find /chemin/vers/ \
        -xdev -regextype posix-extended \
        -type f -regex ".*\.cpio|.*~" -prune -o \
        -type d -regex ".*/\.git" -prune -o \
        -type f -size +99M -prune -o \
        -type f -newer /chemin/vers/horodatage -print0

    Cela signifie que les actions suivantes doivent être effectuées :

     1. rechercher tous les fichiers en partant de « /chemin/vers » ;

     2. limiter globalement sa recherche à l’intérieur du système de
        fichiers et utiliser ERE (consultez Section 1.6.2,
        « Expressions rationnelles ») ;

     3. exclure les fichiers correspondant à l’expression rationnelle
        de « .*\.cpio » ou « .*~ » de la recherche en arrêtant le
        traitement ;
   
     4. exclure les répertoires qui correspondent à l’expression
        rationnelle de « .*/\.git » de la recherche en arrêtant le
        traitement ;

     5. exclure les fichiers plus gros que 99 Megaoctets (unités de
        1048576 octets) de la recherche en arrêtant le traitement ;

     6. Afficher les noms de fichiers qui satisfont aux conditions de
        recherche ci-dessus et qui sont plus récents que « /chemin/
        vers/horodatage ».

    Remarquez l’utilisation idiomatique de « -prune -o » pour exclure
    les fichiers dans l’exemple ci-dessus.

    Note

    Pour les systèmes UNIX-like autre que Debian, certaines options
    peuvent ne pas être prises en compte par find(1). Dans un tel
    cas, essayez d’adapter la méthode de correspondance et remplacez
    « -print0 » par « -print ». Vous devrez aussi ajuster les
    commandes associées.

%

10.1.6. Support d’archive

    Lors du choix d’un support d’enregistrement de données
    informatiques destiné à l’archivage de données importantes, il
    faut faire attention à leurs limitations. Pour des petites
    sauvegardes de données personnelles, j’utilise des CD-R et des
    DVD-R provenant d’une grande marque et je les range dans un
    endroit frais, à l’ombre, sec et propre. (Les supports d’archive
    sur bande semblent être populaires pour les utilisations
    professionnelles).

    Note

    Un coffre-fort anti-feu est destiné aux documents sur papier. La
    plupart des supports de stockage de données informatiques ont une
    tolérance en température inférieure à celle du papier. J’utilise
    en général plusieurs copies chiffrées stockées dans différents
    endroits sûrs.

    Durées de vie optimistes des moyens d’archivage trouvées sur le
    net (la plupart à partir d’informations des constructeurs).

      * 100 ans et plus : papier non acide et encre

      * 100 ans : stockage optique (CD/DVD, CD/DVD-R)
   
      * 30 ans : supports magnétiques (bande, disquette)

      * 20 ans : disque optique à changement de phase (CD-RW)

    Cela ne prend pas en compte les défaillances mécaniques dues aux
    manipulations, etc.

    Nombre de cycles d’écriture optimistes des moyens d’archivage
    trouvées sur le net (la plupart à partir d’informations des
    constructeurs).

      * plus de 250 000 : disque dur

      * plus de 10 000 cycles : mémoires Flash
   
      * 1000 cycles : CD/DVD-RW

      * 1 cycle : CD/DVD-R, papier

    Attention

    Ces chiffres de durée de vie et de nombre de cycles ne devront
    pas être utilisés pour des décisions concernant l’enregistrement
    de données critiques. Veuillez consulter les informations
    spécifiques au produit fournies par le constructeur.

    Astuce

    Comme les CD/DVD-R et le papier n’ont qu’un cycle d’écriture de
    1, ils évitent de manière inhérente le risque de perte de données
    par écrasement. C’est un avantage !

    Astuce

    Si vous devez faire des sauvegardes fréquentes et rapides d’un
    gros volume de données, un disque dur sur une liaison réseau à
    haute vitesse peut être la seule option réaliste.

%

10.1.7. Périphériques d’enregistrement amovibles

    Les périphériques d’enregistrement amovibles possibles sont les
    suivants.

      * Clé USB

      * Disque dur

      * Graveur de disque optique

      * Appareil photographique numérique

      * Lecteur de musique numérique

    Ils peuvent être connectés à l’aide de n’importe quel moyen
    suivant.

      * USB

      * FireWire

      * PC-Card

    Les environnements de bureau modernes comme GNOME et KDE peuvent
    monter ces périphériques amovibles automatiquement sans entrée
    correspondante dans « /etc/fstab »

      * Le paquet udisks fournit un démon et les utilitaires associés
        pour monter et démonter ces périphériques.

      * D-bus crée les événements pour initialiser les processus
        automatiques.

      * PolicyKit fournit les droits nécessaires.

    Astuce
   
    Les périphériques montés automatiquement pourraient avoir
    l’option de montage « uhelper= » qui est utilisée par umount(8).

    Astuce

    Le montage automatique sous les environnements de bureau modernes
    ne se produit que lorsque ces périphériques amovibles ne se
    trouvent pas dans « /etc/fstab ».

    Le point de montage sous les environnements de bureau modernes
    est choisi avec le nom « /media/<étiquette_disque> », il peut
    être personnalisé avec les outils suivants :

      * mlabel(1) pour le système de fichiers FAT ;

      * genisoimage(1) avec l’option « -V » pour le système de
        fichiers ISO9660 ;

      * tune2fs(1) avec l’option « -L » pour le système de fichiers
        ext2, ext3 ou ext4.

    Astuce
   
    Le choix du codage doit être fourni comme option de montage
    (consultez Section 8.4.6, « Coder les noms de fichiers »).

    Astuce

    L'utilisation d'une interface graphique pour démonter un système
    de fichiers peut supprimer son point de montage créé
    dynamiquement tel que « /dev/sdc ». Si vous souhaitez conserver
    son point de montage, démontez-le à l'aide de la commande umount
    (8) lancée depuis un interpréteur de commandes.

%

10.1.8. Choix de système de fichiers pour les données partagées

    Lors du partage de données avec d’autres systèmes à l’aide de
    périphériques de stockage amovibles, vous devez les formatez avec
    un système de fichiers pris en charge par les deux systèmes.
    Voici une liste de choix de systèmes de fichiers :

    Tableau 10.3. Liste de choix de systèmes de fichiers pour des
    périphériques amovibles avec des scénarios typiques d’utilisation

    +---------------------------------------------------------------+
    |système |                                                      |
    |   de   |   description d’un scénario typique d’utilisation    |
    |fichiers|                                                      |
    |--------+------------------------------------------------------|
    |FAT12   |partage de données sur disquettes entre plateformes   |
    |        |(<32Mio)                                              |
    |--------+------------------------------------------------------|
    |        |partage entre plateformes de données sur des          |
    |FAT16   |périphériques semblables à des disques durs de faible |
    |        |capacité (<2Gio)                                      |
    |--------+------------------------------------------------------|
    |        |partage entre plateformes de données sur périphériques|
    |FAT32   |semblables à des disques durs de grande capacité      |
    |        |(<8Tio, pris en charge par plus récent que MS         |
    |        |Windows95 OSR2)                                       |
    |--------+------------------------------------------------------|
    |        |partage entre plateformes de données sur périphériques|
    |        |semblables à des disques durs de grande capacité (pris|
    |NTFS    |en charge de manière native par MS Windows NT et      |
    |        |versions plus récentes; et pris en charge par NTFS-3G |
    |        |par l’intermédiaire de FUSE sous Linux)               |
    |--------+------------------------------------------------------|
    |ISO9660 |partage entre plateformes de données sur CD-R et DVD+/|
    |        |-R                                                    |
    |--------+------------------------------------------------------|
    |UDF     |écriture incrémentale de CD-R et de DVD+/-R (nouveau) |
    |--------+------------------------------------------------------|
    |système |                                                      |
    |de      |enregistrement efficace en matière d’espace disque de |
    |fichiers|fichiers de données unix sur disquette                |
    |MINIX   |                                                      |
    |--------+------------------------------------------------------|
    |système |                                                      |
    |de      |partage de données sur disque dur avec les anciens    |
    |fichiers|systèmes Linux                                        |
    |ext2    |                                                      |
    |--------+------------------------------------------------------|
    |système |                                                      |
    |de      |partage de données sur disque dur avec les anciens    |
    |fichiers|systèmes Linux                                        |
    |ext3    |                                                      |
    |--------+------------------------------------------------------|
    |système |                                                      |
    |de      |partage de données sur disque dur avec les systèmes   |
    |fichiers|Linux actuels                                         |
    |ext4    |                                                      |
    +---------------------------------------------------------------+


    Astuce

    Consultez Section 9.8.1, « Chiffrement des disques amovibles à
    l’aide de dm-crypt/LUKS » pour le partage de données entre
    plateformes en utilisant le chiffrement au niveau du
    périphérique.

    Le système de fichiers FAT est pris en charge par la plupart des
    systèmes d’exploitation modernes et est assez utile pour
    l'échange des données par l’intermédiaire de supports du type
    disque dur amovible.

    Pour le formatage de périphériques de type disque dur amovible
    pour l’échange de données entre plateformes avec un système de
    fichiers FAT, ce qui suit peut être un choix sûr :

      * les partitionner avec fdisk(8), cfdisk(8) ou parted(8)
        (consultez Section 9.5.2, « Configuration de la partition du
        disque ») en une seule partition primaire et la marquer comme
        suit :

          + type « 6 » pour FAT16 pour les supports faisant moins de
            2Go.

          + type « c » pour FAT32 (LBA) pour les supports plus gros.

      * formater la partition primaire avec mkfs.vfat(8) comme suit :

          + simplement son nom de périphérique, par exemple « /dev/
            sda1 », pour la FAT16

          + L’option explicite et le nom de périphérique, par exemple
            « -F 32 /dev/sda1 », pour la FAT32

    Lors de l’utilisation des systèmes de fichiers FAT ou ISO9660
    pour le partage de données ce qui suit sera une précaution sûre :

      * Archiver d’abord les fichiers dans un fichier d’archive en
        utilisant tar(1) ou cpio(1) afin de conserver les noms de
        fichiers longs, les permissions de fichiers d’origine d’UNIX
        et les informations de propriétaire.

      * Découper le fichier d’archive en éléments de moins de 2 Gio à
        l’aide de la commande split(1) afin de le protéger contre les
        limitations de taille de fichier.

      * Chiffrer le fichier d’archive afin de sécuriser son contenu
        contre un accès non autorisé.

    Note

    La taille maximum d’un fichier FAT, par conception, est de (2^32
    - 1) octets = (4GiB - 1 octet). Pour certaines applications sur
    le système 32 bits plus ancien, la taille maximum était même plus
    faible (2^31 - 1) octets = (2Gio - 1 octet). Debian ne souffre
    pas de ce dernier problème.

    Note

    Microsoft lui-même ne recommande pas l’utilisation de FAT pour
    des disques ou des partitions de plus de 200 Mo. Microsoft met en
    avant ces limitations comme une utilisation inefficace de
    l’espace disque dans ses « Informations générales sur les
    systèmes de fichiers FAT, HPFS et NTFS ». Bien sûr, on peut
    normalement utiliser le système de fichiers ext4 pour Linux.

    Astuce

    Pour davantage d’informations sur les systèmes de fichiers et les
    accès aux systèmes de fichiers, veuillez consulter « Filesystems
    HOWTO ».

%

10.1.9. Partage de données au travers du réseau

    Lors du partage de données avec d’autres systèmes au travers du
    réseau, vous devrez utiliser un service commun. Voici quelques
    éléments :

    Tableau 10.4. Liste des services réseau à choisir avec le
    scénario typique d’utilisation

    +---------------------------------------------------------------+
    |   service réseau    |    description d’un scénario typique    |
    |                     |              d’utilisation              |
    |---------------------+-----------------------------------------|
    |                     |partage de fichiers par l’intermédiaire  |
    |SMB/CIFS système de  |de « Microsoft Windows Network »,        |
    |fichiers monté avec  |consultez smb.conf(5) et le HOWTO et     |
    |Samba                |guide de référence officiel de Samba     |
    |                     |3.x.x ou le paquet samba-doc             |
    |---------------------+-----------------------------------------|
    |système de fichiers  |partager des fichiers par « UNIX/Linux   |
    |monté au travers du  |Network », consultez exports(5) et Linux |
    |réseau NFS avec le   |NFS-HOWTO                                |
    |noyau Linux          |                                         |
    |---------------------+-----------------------------------------|
    |service HTTP         |partager des fichiers entre client et    |
    |                     |serveur web                              |
    |---------------------+-----------------------------------------|
    |                     |partager des fichiers entre le client et |
    |service HTTPS        |le serveur web avec un chiffrement Secure|
    |                     |Sockets Layer (SSL) ou Transport Layer   |
    |                     |Security (TLS)                           |
    |---------------------+-----------------------------------------|
    |service FTP          |partager des fichiers entre serveur et   |
    |                     |client FTP                               |
    +---------------------------------------------------------------+


    Bien que ces systèmes de fichiers montés au travers du réseau et
    les méthodes de transfert au travers du réseau soient assez
    pratiques pour partager des données, elles peuvent être non
    sûres. Leur connexion réseau doit être sécurisée par ce qui
    suit :

      * chiffrez-la avec SSL/TLS

      * tunnelez-la par SSH
   
      * tunnelez-la par VPN

      * limitez-la derrière un pare-feu sûr

    consultez aussi Section 6.10, « Autres serveurs d’applications
    réseau » et Section 6.11, « Autres clients d’applications
    réseau ».

%

10.2. Sauvegarde et restauration

    Nous savons tous que les ordinateurs sont parfois victimes de
    pannes ou que des erreurs humaines provoquent des dommages au
    système et aux données. Les opérations de sauvegarde et de
    restauration sont les parties essentielles d’une administration
    système réussie. Vous serez victime, un jour ou l’autre, de tous
    les modes de défaillance possibles.

    Astuce

    Mettez en place un système de sauvegardes simple et faites une
    sauvegarde fréquente de votre système. Avoir des données de
    sauvegarde est plus important que la qualité technique de votre
    méthode de sauvegarde.

    Il y a 3 facteurs-clé qui permettent de définir une méthode
    pratique de sauvegarde et de restauration.

     1. Ce qu’il faut sauvegarder et restaurer :

          + les fichiers que vous avez directement créés : données de
            « ~/ » ;

          + les fichiers de données créés par les applications que
            vous utilisez : données de « /var/ » (sauf « /var/cache/
             », « /var/run/ » et « /var/tmp/ ») :

          + les fichiers de configuration du système : fichiers de « 
            /etc/ » ;

          + logiciels locaux : données se trouvant dans « /usr/local/
             » ou « /opt/ » ;

          + informations concernant l’installation du système : un
            mémo en texte concernant les étapes-clés ((partition, …)
             ;

          + un jeu de données testé : confirmé par des opérations de
            restauration expérimentales réalisées à l’avance.
   
     2. Comment sauvegarder et restaurer :

          + entreposer les données de manière sûre : protection des
            données contre la réécriture et les défaillances du
            système ;

          + sauvegardes fréquentes ! sauvegardes planifiées ;

          + sauvegardes redondantes : duplication (miroir) des
            données ;

          + processus indéréglable : sauvegarde facile en une seule
            commande.

     3. Risques et coûts :

          + valeur des données perdues ;

          + ressources nécessaires pour effectuer les sauvegardes :
            humaines, matérielles, logicielles, …

          + mode de défaillance avec leur probabilité.

    Note

    Ne sauvegardez pas le contenu des pseudo systèmes de fichiers se
    trouvant dans /proc, /sys, /tmp, et /run (voir Section 1.2.12,
    « procfs et sysfs » et Section 1.2.13, « tmpfs »). À moins que
    vous ne sachiez exactement ce que vous faites, ce ne sont que
    d’énormes quantités de données inutiles.

    Comme pour l’enregistrement sécurisé de données, les données
    doivent se trouver de préférences sur différentes partitions de
    disque ou sur des disques différents ou des machines différentes
    afin de résister à une corruption du système de fichiers. Les
    données importantes seront, de préférence écrites sur des
    supports à écriture unique tels que les CD/DVD-R afin de prévenir
    l’écrasement accidentel des données (consultez Section 9.7, « Les
    données binaires » pour la manière d’écrire sur le support
    d’enregistrement depuis la ligne de commandes de l’interpréteur.
    L’interface graphique de l’environnement de bureau GNOME vous
    donne un accès facile depuis le menu : « Places→CD/DVD
    Creator :»).

    Note

    Il faudra peut-être arrêter certains démons d’applications comme
    le MTA (consultez Section 6.3, « Agent de transport de courrier
    électronique (« MTA ») ») lors de la sauvegarde des données.

    Note

    Vous devez prendre des précautions supplémentaires lors de la
    sauvegarde et de la restauration des fichiers de données relatifs
    à l’identité comme « /etc/ssh/ssh_host_dsa_key », « /etc/ssh/
    ssh_host_rsa_key », « ~/.gnupg/* », « ~/.ssh/* », « /etc/
    passwd », « /etc/shadow », « /etc/fetchmailrc »,
    « popularity-contest.conf », « /etc/ppp/pap-secrets » et « /etc/
    exim4/passwd.client ». Certaines de ces données ne peuvent pas
    être recréées en entrant la même chaîne de caractères d’entrée
    sur le système.

    Note

    Si vous faites tourner une tâche programmée (« cron » en tant que
    processus d’utilisateur, vous devrez restaurer les fichiers de « 
    /var/spool/cron/crontabs » et redémarrer cron(8). Consultez
    Section 9.3.14, « Planifier des tâches qui s’exécutent
    régulièrement  » pour cron(8) et crontab(1).

%

10.2.1. Suites d’utilitaires de sauvegarde

    Voici une liste d’utilitaires de sauvegarde notables disponibles
    sur le système Debian :

    Tableau 10.5. Liste de suites d’utilitaires de sauvegarde

    +---------------------------------------------------------------+
    |    paquet    |popcon|taille|           description            |
    |--------------+------+------+----------------------------------|
    |              |V:1,  |      |BSD 4.4 dump(8) et restore(8) pour|
    |dump          |I:6   |352   |les systèmes de fichiers ext2/ext3|
    |              |      |      |/ext4.                            |
    |--------------+------+------+----------------------------------|
    |              |      |      |sauvegarder et restaurer avec     |
    |xfsdump       |V:0,  |854   |xfsdump(8) et xfsrestore(8) pour  |
    |              |I:9   |      |le système de fichiers XFS sous   |
    |              |      |      |GNU/Linux et IRIX                 |
    |--------------+------+------+----------------------------------|
    |backupninja   |V:4,  |355   |système de sauvegarde meta-backup |
    |              |I:5   |      |léger et extensible               |
    |--------------+------+------+----------------------------------|
    |              |V:10, |      |Bacula : sauvegarde, restauration |
    |bacula-common |I:15  |2158  |et vérification par le réseau -   |
    |              |      |      |fichiers communs                  |
    |--------------+------+------+----------------------------------|
    |              |      |      |Bacula : sauvegarde, restauration |
    |bacula-client |I:3   |183   |et vérification par le réseau -   |
    |              |      |      |métapaquet du client              |
    |--------------+------+------+----------------------------------|
    |              |V:1,  |      |Bacula : sauvegarde, restauration |
    |bacula-console|I:5   |107   |et vérification par le réseau -   |
    |              |      |      |console en mode texte             |
    |--------------+------+------+----------------------------------|
    |              |      |      |Bacula : sauvegarde, restauration |
    |bacula-server |I:1   |183   |et vérification par le réseau -   |
    |              |      |      |métapaquet du serveur             |
    |--------------+------+------+----------------------------------|
    |              |      |      |Amanda : Advanced Maryland        |
    |              |V:0,  |      |Automatic Network Disk Archiver   |
    |amanda-common |I:2   |10031 |(Libs). (Archiveur de disque par  |
    |              |      |      |le réseau de Maryland avancé et   |
    |              |      |      |automatique.                      |
    |--------------+------+------+----------------------------------|
    |              |V:0,  |      |Amanda : Advanced Maryland        |
    |amanda-client |I:2   |1089  |Automatic Network Disk Archiver   |
    |              |      |      |(Client)                          |
    |--------------+------+------+----------------------------------|
    |              |V:0,  |      |Amanda : Advanced Maryland        |
    |amanda-server |I:0   |1076  |Automatic Network Disk Archiver   |
    |              |      |      |(Serveur)                         |
    |--------------+------+------+----------------------------------|
    |backup-manager|V:1,  |572   |outil de sauvegarde en ligne de   |
    |              |I:2   |      |commandes                         |
    |--------------+------+------+----------------------------------|
    |              |      |      |outil de sauvegarde et            |
    |backup2l      |V:0,  |114   |restauration de faible maintenance|
    |              |I:1   |      |pour des supports pouvant être    |
    |              |      |      |montés (basé sur disque)          |
    |--------------+------+------+----------------------------------|
    |              |      |      |BackupPC est un système de hautes |
    |backuppc      |V:3,  |3182  |performances pour effectuer la    |
    |              |I:3   |      |sauvegarde de PC au niveau de     |
    |              |      |      |l’entreprise (basé sur disques)   |
    |--------------+------+------+----------------------------------|
    |duplicity     |V:7,  |1761  |sauvegarde incrémentale (distante)|
    |              |I:15  |      |                                  |
    |--------------+------+------+----------------------------------|
    |flexbackup    |V:0,  |243   |sauvegarde incrémentale (distante)|
    |              |I:0   |      |                                  |
    |--------------+------+------+----------------------------------|
    |rdiff-backup  |V:7,  |733   |sauvegarde incrémentale (distante)|
    |              |I:15  |      |                                  |
    |--------------+------+------+----------------------------------|
    |restic        |V:1,  |20595 |sauvegarde incrémentale (distante)|
    |              |I:3   |      |                                  |
    |--------------+------+------+----------------------------------|
    |rsnapshot     |V:5,  |462   |sauvegarde incrémentale (distante)|
    |              |I:11  |      |                                  |
    |--------------+------+------+----------------------------------|
    |slbackup      |V:0,  |151   |sauvegarde incrémentale (distante)|
    |              |I:0   |      |                                  |
    +---------------------------------------------------------------+


    Les outils de sauvegarde ont chacun des objectifs particuliers.

      * Mondo Rescue est un système de sauvegarde qui facilite la
        restauration rapide d’un système complet depuis de CD/DVD
        etc. sans passer par le processus normal d’installation d’un
        système.

      * Regular backups of user data can be realized by a simple
        script (Section 10.2.2, « Script d’exemple pour la sauvegarde
        du système ») and cron(8).

      * Bacula, Amanda et BackupPC sont des suites de sauvegardes
        ayant des fonctionnalités avancées qui sont orientées vers
        les sauvegardes fréquentes au travers du réseau.

    Les outils de base décrits dans Section 10.1.1, « Outils
    d’archivage et de compression » et Section 10.1.2, « Outils de
    copie et de synchronisation » peuvent être utilisés pour
    faciliter la sauvegarde du système au moyen de scripts
    personnalisés. De tels scripts peuvent être améliorés comme
    suit :

      * Le paquet restic permet les sauvegardes incrémentales
        (distantes) .

      * le paquet rdiff-backup permet les sauvegardes incrémentales
        (distantes) ;

      * le paquet dump facilite l’archivage et la restauration d’un
        système de fichiers entier de manière incrémentielle et
        efficace.

    Astuce

    Consultez les fichiers dans « /usr/share/doc/dump/ » et
    « « Est-ce que dump est vraiment obsolète ? » pour en savoir plus
    sur le paquet dump.

%

10.2.2. Script d’exemple pour la sauvegarde du système

    Pour un système de bureau personnel Debian sur lequel tourne la
    version unstable, je n’ai besoin de protéger que les données
    personnelles et les données critiques. Je réinstalle cependant le
    système une fois par an. Je ne vois donc aucune raison de
    sauvegarder l’ensemble du système ou d’installer un utilitaire de
    sauvegarde ayant des fonctionnalités avancées.

    J’utilise un simple script pour réaliser des archives de
    sauvegarde et les graver sur CD/DVD en utilisant une interface
    graphique. Voici un exemple de script pour ce faire :

    #!/bin/sh -e
    # Copyright (C) 2007-2008 Osamu Aoki <osamu@debian.org>, Public Domain
    BUUID=1000; USER=osamu # UID and name of a user who accesses backup files
    BUDIR="/var/backups"
    XDIR0=".+/Mail|.+/Desktop"
    XDIR1=".+/\.thumbnails|.+/\.?Trash|.+/\.?[cC]ache|.+/\.gvfs|.+/sessions"
    XDIR2=".+/CVS|.+/\.git|.+/\.svn|.+/Downloads|.+/Archive|.+/Checkout|.+/tmp"
    XSFX=".+\.iso|.+\.tgz|.+\.tar\.gz|.+\.tar\.bz2|.+\.cpio|.+\.tmp|.+\.swp|.+~"
    SIZE="+99M"
    DATE=$(date --utc +"%Y%m%d-%H%M")
    [ -d "$BUDIR" ] || mkdir -p "BUDIR"
    umask 077
    dpkg --get-selections \* > /var/lib/dpkg/dpkg-selections.list
    debconf-get-selections > /var/cache/debconf/debconf-selections

    {
    find /etc /usr/local /opt /var/lib/dpkg/dpkg-selections.list \
         /var/cache/debconf/debconf-selections -xdev -print0
    find /home/$USER /root -xdev -regextype posix-extended \
      -type d -regex "$XDIR0|$XDIR1" -prune -o -type f -regex "$XSFX" -prune -o \
      -type f -size  "$SIZE" -prune -o -print0
    find /home/$USER/Mail/Inbox /home/$USER/Mail/Outbox -print0
    find /home/$USER/Desktop  -xdev -regextype posix-extended \
      -type d -regex "$XDIR2" -prune -o -type f -regex "$XSFX" -prune -o \
      -type f -size  "$SIZE" -prune -o -print0
    } | cpio -ov --null -O $BUDIR/BU$DATE.cpio
    chown $BUUID $BUDIR/BU$DATE.cpio
    touch $BUDIR/backup.stamp

    C’est destiné à être un script d’exemple exécuté avec le compte
    de l’administrateur.

    Vous devrez le modifier et l’exécuter comme suit :

      * éditez ce script afin de couvrir l’ensemble de vos données
        importantes (consultez Section 10.1.5, « Idiomes pour la
        sélection de fichiers » et Section 10.2, « Sauvegarde et
        restauration ») ;

      * remplacez « find … -print0 » par « find … -newer $BUDIR/
        backup.stamp -print0 » afin d’effectuer des sauvegardes
        incrémentales ;

      * transférez les sauvegardes sur la machine distante en
        utilisant scp(1) ou rsync(1) ou gravez-les sur CD/DVD pour
        plus de sécurité (j’utilise l’interface graphique du bureau
        GNOME pour graver les CD/DVD. Consultez Section 12.1.8,
        « Exemple de script avec zenity » pour une redondance
        supplémentaire).

    Faites simple !

    Astuce

    Vous pouvez récupérer les données de configuration de debconf
    avec « debconf-set-selections debconf-selections » et les données
    de sélection de dpkg avec « dpkg --set-selection
    <dpkg-selections.list".

%

10.2.3. Un script de copie pour la sauvegarde des données

    Pour les données se trouvant sous l’arborescence d’un répertoire,
    une copie avec « cp -a » permet une sauvegarde normale.

    Pour un gros ensemble de données statiques ne devant pas être
    réécrites se trouvant dans une arborescence de répertoires telle
    que celle se trouvant sous le répertoire « /var/cache/apt/
    packages/ », les liens physiques avec « cp -al » fournissent une
    alternative à la sauvegarde normale avec une utilisation efficace
    de l’espace disque.

    Voici un script de copie, que j’ai appelé bkup, destiné à la
    sauvegarde de données. Ce script copie tous les fichiers
    (non-VCS) du répertoire actuel vers le répertoire daté du
    répertoire parent ou sur une machine distante.

    #!/bin/sh -e
    # Copyright (C) 2007-2008 Osamu Aoki <osamu@debian.org>, Public Domain
    fdot(){ find . -type d \( -iname ".?*" -o -iname "CVS" \) -prune -o -print0;}
    fall(){ find . -print0;}
    mkdircd(){ mkdir -p "$1";chmod 700 "$1";cd "$1">/dev/null;}
    FIND="fdot";OPT="-a";MODE="CPIOP";HOST="localhost";EXTP="$(hostname -f)"
    BKUP="$(basename $(pwd)).bkup";TIME="$(date  +%Y%m%d-%H%M%S)";BU="$BKUP/$TIME"
    while getopts gcCsStrlLaAxe:h:T f; do case $f in
    g)  MODE="GNUCP";; # cp (GNU)
    c)  MODE="CPIOP";; # cpio -p
    C)  MODE="CPIOI";; # cpio -i
    s)  MODE="CPIOSSH";; # cpio/ssh
    t)  MODE="TARSSH";; # tar/ssh
    r)  MODE="RSYNCSSH";; # rsync/ssh
    l)  OPT="-alv";; # lien physique (GNU cp)
    L)  OPT="-av";;  # copier (GNU cp)
    a)  FIND="fall";; # tout rechercher
    A)  FIND="fdot";; # rechercher ce qui n'est pas CVS/ .???/
    x)  set -x;; # trace
    e)  EXTP="${OPTARG}";; # hostname -f
    h)  HOST="${OPTARG}";; # utilisateur@remotehost.example.com
    T)  MODE="TEST";; # tester le mode de recherche
    \?) echo "utiliser -x pour une trace."
    esac; done
    shift $(expr $OPTIND - 1)
    if [ $# -gt 0 ]; then
      for x in $@; do cp $OPT $x $x.$TIME; done
    elif [ $MODE = GNUCP ]; then
      mkdir -p "../$BU";chmod 700 "../$BU";cp $OPT . "../$BU/"
    elif [ $MODE = CPIOP ]; then
      mkdir -p "../$BU";chmod 700 "../$BU"
      $FIND|cpio --null --sparse -pvd ../$BU
    elif [ $MODE = CPIOI ]; then
      $FIND|cpio -ov --null | ( mkdircd "../$BU"&&cpio -i )
    elif [ $MODE = CPIOSSH ]; then
      $FIND|cpio -ov --null|ssh -C $HOST "( mkdircd \"$EXTP/$BU\"&&cpio -i )"
    elif [ $MODE = TARSSH ]; then
      (tar cvf - . )|ssh -C $HOST "( mkdircd \"$EXTP/$BU\"&& tar xvfp - )"
    elif [ $MODE = RSYNCSSH ]; then
      rsync -aHAXSv ./ "${HOST}:${EXTP}-${BKUP}-${TIME}"
    else
      echo "Une autre idée à sauvegarder ?"
      $FIND |xargs -0 -n 1 echo
    fi

    C’est destiné à être un exemple de commandes. Veuillez lire le
    script et le modifier vous-même avant de l’utiliser.

    Astuce

    J’ai installé ce bkup dans mon répertoire « /usr/local/bin/ ».
    J’utilise cette commande bkup, sans aucune option, depuis mon
    répertoire de travail lorsque j’ai besoin d’un instantané
    temporaire de sauvegarde.

    Astuce

    Pour faire un instantané historique d’une arborescence de
    fichiers sources ou d’une arborescence de fichiers de
    configuration, il est plus facile et efficace d’utiliser git(7)
    (consultez Section 10.6.5, « Git pour l’enregistrement de
    l’historique de la configuration »).

%

10.3. Infrastructure de sécurité des données

    L’infrastructure de sécurité des données est fournie par la
    combinaison d’un outil de chiffrement des données, d’un outil de
    condensé de messages et d’un outil de signature.

    Tableau 10.6. Liste des outils d’une infrastructure de sécurité
    des données

    +---------------------------------------------------------------+
    |    paquet    |popcon|taille| commande |      description      |
    |--------------+------+------+----------+-----------------------|
    |              |V:531,|      |          |GNU Privacy Guard -    |
    |gnupg         |I:950 |787   |gpg(1)    |outil de signature et  |
    |              |      |      |          |de chiffrement OpenPGP |
    |--------------+------+------+----------+-----------------------|
    |              |V:880,|      |          |GNU Privacy Guard -    |
    |gpgv          |I:999 |859   |gpgv(1)   |outil de vérification  |
    |              |      |      |          |de signature           |
    |--------------+------+------+----------+-----------------------|
    |              |      |      |          |extraire seulement     |
    |paperkey      |V:1,  |58    |paperkey  |l’information secrète  |
    |              |I:13  |      |(1)       |de clés secrètes       |
    |              |      |      |          |OpenPGP                |
    |--------------+------+------+----------+-----------------------|
    |              |      |      |          |utilitaires pour       |
    |              |V:29, |      |cryptsetup|périphérique en mode   |
    |cryptsetup    |I:78  |402   |(8), …    |bloc dm-crypto prenant |
    |              |      |      |          |en charge le           |
    |              |      |      |          |chiffrement LUKS       |
    |--------------+------+------+----------+-----------------------|
    |              |      |      |          |utilitaires pour le    |
    |ecryptfs-utils|V:3,  |460   |ecryptfs  |chiffrement de systèmes|
    |              |I:5   |      |(7), …    |de fichiers empilés    |
    |              |      |      |          |ecryptfs               |
    |--------------+------+------+----------+-----------------------|
    |coreutils     |V:891,|17478 |md5sum(1) |calculer et vérifier un|
    |              |I:999 |      |          |condensé MD5 de message|
    |--------------+------+------+----------+-----------------------|
    |              |V:891,|      |          |calculer et vérifier un|
    |coreutils     |I:999 |17478 |sha1sum(1)|condensé SHA1 de       |
    |              |      |      |          |message                |
    |--------------+------+------+----------+-----------------------|
    |              |V:794,|      |openssl   |calculer un condensé de|
    |openssl       |I:993 |1465  |(1ssl)    |message avec « openssl |
    |              |      |      |          |dgst » (OpenSSL)       |
    +---------------------------------------------------------------+


    Consultez la Section 9.8, « Astuces de chiffrement des données »
    sur dm-crypto et ecryptfs qui implémente l’infrastructure de
    chiffrement automatique des données par l’intermédiaire de
    modules du noyau de Linux.

%

10.3.1. Gestion de clés pour GnuPG

    Voici les commandes de GNU Privacy Guard pour la gestion de base
    des clés :

    Tableau 10.7. Liste des commandes de GNU Privacy Guard pour la
    gestion des clés

    +---------------------------------------------------------------+
    |       commande       |              description               |
    |----------------------+----------------------------------------|
    |gpg --gen-key         |générer une nouvelle clé                |
    |----------------------+----------------------------------------|
    |gpg --gen-revoke      |générer une clé de révocation pour      |
    |ID_de_mon_utilisateur |ID_de_mon_utilisateur                   |
    |----------------------+----------------------------------------|
    |gpg --edit-key        |éditer la clé de manière interactive,   |
    |ID_utilisateur        |« help » pour obtenir de l’aide         |
    |----------------------+----------------------------------------|
    |gpg -o fichier        |exporter toutes les clés vers fichier   |
    |--export              |                                        |
    |----------------------+----------------------------------------|
    |gpg --import fichier  |importer toutes les clés depuis fichier |
    |----------------------+----------------------------------------|
    |gpg --send-keys       |envoyer la clé de ID_utilisateur vers le|
    |ID_utilisateur        |serveur de clés                         |
    |----------------------+----------------------------------------|
    |gpg --recv-keys       |recevoir la clé de ID_utilisateur du    |
    |ID_utilisateur        |serveur de clés                         |
    |----------------------+----------------------------------------|
    |gpg --list-keys       |afficher la liste des clés de           |
    |ID_utilisateur        |ID_utilisateur                          |
    |----------------------+----------------------------------------|
    |gpg --list-sigs       |afficher la liste des signatures de     |
    |ID_utilisateur        |ID_utilisateur                          |
    |----------------------+----------------------------------------|
    |gpg --check-sigs      |vérifier la signature de ID_utilisateur |
    |ID_utilisateur        |                                        |
    |----------------------+----------------------------------------|
    |gpg --fingerprint     |vérifier l’empreinte de ID_utilisateur  |
    |ID_utilisateur        |                                        |
    |----------------------+----------------------------------------|
    |gpg --refresh-keys    |mettre à jour le porte-clé local        |
    +---------------------------------------------------------------+


    Voici la signification du code de confiance

    Tableau 10.8. Liste de la signification des codes de confiance

    +---------------------------------------------------------------+
    |code|               description de la confiance                |
    |----+----------------------------------------------------------|
    |-   |pas de confiance d’utilisateur assignée/pas encore        |
    |    |calculée                                                  |
    |----+----------------------------------------------------------|
    |e   |échec du calcul de la confiance                           |
    |----+----------------------------------------------------------|
    |q   |pas assez d’informations pour le calcul                   |
    |----+----------------------------------------------------------|
    |n   |ne jamais faire confiance à cette clé                     |
    |----+----------------------------------------------------------|
    |m   |confiance marginale                                       |
    |----+----------------------------------------------------------|
    |f   |confiance complète                                        |
    |----+----------------------------------------------------------|
    |u   |confiance ultime                                          |
    +---------------------------------------------------------------+


    Ce qui suit permet d’envoyer ma clé « 1DD8D791 » vers le serveur
    de clé populaire « hkp://keys.gnupg.net » :

    $ gpg --keyserver hkp://keys.gnupg.net --send-keys 1DD8D791

    Une bonne configuration de serveur de clés dans « ~/.gnupg/
    gpg.conf » (ou à l’ancien emplacement « ~/.gnupg/options »)
    contient ce qui suit :

    keyserver hkp://keys.gnupg.net

    Ce qui suit obtient les clés inconnues du serveur de clés :

    $ gpg --list-sigs --with-colons | grep '^sig.*\[User ID not found\]' |\
      cut -d ':' -f 5| sort | uniq | xargs gpg --recv-keys

    Il y avait un bogue dans OpenPGP Public Key Server (pre version
    0.9.6) qui corrompait les clés ayant plus de 2 sous-clés. Le
    paquet du serveur gnupg (>1.2.1-2) peut gérer ces sous-clés
    corrompues. Consultez gpg(1) sous l’option
    « --repair-pks-subkey-bug ».

%

10.3.2. Utilisation de GnuPG sur des fichiers

    Voici des exemples d’utilisation des commandes de GNU Privacy
    Guard sur des fichiers :

    Tableau 10.9. Liste des commandes de GNU Privacy Guard sur des
    fichiers

    +---------------------------------------------------------------+
    |       commande       |              description               |
    |----------------------+----------------------------------------|
    |gpg -a -s fichier     |signer « fichier » dans un fichier ASCII|
    |                      |blindé fichier.asc                      |
    |----------------------+----------------------------------------|
    |gpg --armor --sign    |, ,                                     |
    |fichier               |                                        |
    |----------------------+----------------------------------------|
    |gpg --clearsign       |signer un fichier en clair              |
    |fichier               |                                        |
    |----------------------+----------------------------------------|
    |gpg --clearsign       |envoyer un message signé en clair à     |
    |fichier|mail          |truc@example.org                        |
    |truc@example.org      |                                        |
    |----------------------+----------------------------------------|
    |gpg --clearsign       |                                        |
    |--not-dash-escaped    |signer en clair un fichier_rustine      |
    |fichier_rustine       |                                        |
    |----------------------+----------------------------------------|
    |gpg --verify fichier  |vérifier fichier signé en texte clair   |
    |----------------------+----------------------------------------|
    |gpg -o fichier.sig -b |créer une signature détachée            |
    |fichier               |                                        |
    |----------------------+----------------------------------------|
    |gpg -o fichier.sig    |, ,                                     |
    |--detach-sig fichier  |                                        |
    |----------------------+----------------------------------------|
    |gpg --verify          |vérifier un fichier avec fichier.sig    |
    |fichier.sig fichier   |                                        |
    |----------------------+----------------------------------------|
    |gpg -o                |chiffrement par clé publique destiné au |
    |fichier_chiffré.gpg -r|« nom » depuis le « fichier » vers      |
    |nom -e fichier        |« fichier_chiffré.gpg » binaire         |
    |----------------------+----------------------------------------|
    |gpg -o                |                                        |
    |fichier_chiffré.gpg   |, ,                                     |
    |--recipient nom       |                                        |
    |--encrypt fichier     |                                        |
    |----------------------+----------------------------------------|
    |gpg -o                |chiffrement par clé publique destiné au |
    |fichier_chiffré.asc -a|« nom » depuis le « fichier » vers le   |
    |-r nom -e fichier     |fichier ASCII blindé                    |
    |                      |« fichier_chiffré.asc »                 |
    |----------------------+----------------------------------------|
    |gpg -o                |chiffrement symétrique depuis           |
    |fichier_chiffré.gpg -c|« fichier » vers « fichier_chiffré.gpg »|
    |fichier               |                                        |
    |----------------------+----------------------------------------|
    |gpg -o                |                                        |
    |fichier_chiffré.gpg   |, ,                                     |
    |--symmetric fichier   |                                        |
    |----------------------+----------------------------------------|
    |gpg -o                |chiffrement symétrique prévu destiné au |
    |fichier_chiffré.asc -a|« nom » depuis le « fichier » vers le   |
    |-c fichier            |fichier ASCII blindé                    |
    |                      |« fichier_chiffré.asc »                 |
    |----------------------+----------------------------------------|
    |gpg -o fichier -d     |                                        |
    |fichier_crypt.gpg -r  |déchiffrement                           |
    |nom                   |                                        |
    |----------------------+----------------------------------------|
    |gpg -o fichier        |                                        |
    |--decrypt             |, ,                                     |
    |fichier_chiffré.gpg   |                                        |
    +---------------------------------------------------------------+


%

10.3.3. Utiliser GnuPG avec Mutt

    Ajoutez ce qui suit à « ~/.muttrc » afin d’éviter que GnuPG qui
    est lent ne démarre automatiquement, tout en permettant son
    utilisation en entrant « S » depuis l’index du menu :

    macro index S ":toggle pgp_verify_sig\n"
    set pgp_verify_sig=no

%

10.3.4. Utiliser GnuPG avec Vim

    Le greffon gnupg vous permet de lancer GnuPG de manière
    transparente pour les fichiers ayant l’extension « .gpg »,
    « .asc » et « .ppg ».

    # aptitude install vim-scripts vim-addon-manager
    $ vim-addons install gnupg

%

10.3.5. La somme de contrôle MD5

    md5sum(1) fournit un utilitaire permettant de créer un fichier de
    résumé en utilisant la méthode se trouvant dans rfc1321 et en
    l’utilisant pour vérifier chaque fichier qu’il contient.

    $ md5sum toto titi >tutu.md5
    $ cat tutu.md5
    d3b07384d113edec49eaa6238ad5ff00  toto
    c157a79031e1c40f85931829bc5fc552  titi
    $ md5sum -c tutu.md5
    toto: OK
    titi: OK

    Note

    Le calcule de somme de contrôle MD5 consomme moins de ressources
    processeur que celles utilisées pour le chiffrement des
    signatures en utilisant GNU Privacy Guard (GnuPG).
    Habituellement, pour s’assurer de l’intégrité des données, seul
    le résumé de plus haut niveau est signé par chiffrement.

%

10.4. Outils pour fusionner le code source

    Il existe de nombreux outils pour fusionner du code source. Les
    commandes qui suivent ont attiré mon attention :

    Tableau 10.10. Liste d’outils destinés à fusionner du code source

    +---------------------------------------------------------------+
    |  paquet  |popcon|taille| commande  |       description        |
    |----------+------+------+-----------+--------------------------|
    |diffutils |V:871,|1598  |diff(1)    |comparer des fichiers     |
    |          |I:991 |      |           |ligne à ligne             |
    |----------+------+------+-----------+--------------------------|
    |          |V:871,|      |           |comparer et fusionner     |
    |diffutils |I:991 |1598  |diff3(1)   |trois fichiers ligne par  |
    |          |      |      |           |ligne                     |
    |----------+------+------+-----------+--------------------------|
    |vim       |V:106,|3231  |vimdiff(1) |comparer deux fichiers    |
    |          |I:398 |      |           |côte à côte dans vim      |
    |----------+------+------+-----------+--------------------------|
    |          |V:99, |      |           |appliquer un fichier de   |
    |patch     |I:725 |248   |patch(1)   |différences (« diff ») à  |
    |          |      |      |           |un original               |
    |----------+------+------+-----------+--------------------------|
    |          |V:0,  |      |           |gérer une série de        |
    |dpatch    |I:11  |191   |dpatch(1)  |rustines (patch) pour les |
    |          |      |      |           |paquets Debian            |
    |----------+------+------+-----------+--------------------------|
    |          |      |      |           |afficher un histogramme   |
    |diffstat  |V:16, |73    |diffstat(1)|des modifications         |
    |          |I:154 |      |           |apportées par le fichier  |
    |          |      |      |           |de différences            |
    |----------+------+------+-----------+--------------------------|
    |          |      |      |           |créer une rustine (patch) |
    |patchutils|V:18, |232   |combinediff|cumulative à partir de    |
    |          |I:150 |      |(1)        |deux rustines             |
    |          |      |      |           |incrémentales             |
    |----------+------+------+-----------+--------------------------|
    |          |V:18, |      |dehtmldiff |extraire un fichier de    |
    |patchutils|I:150 |232   |(1)        |différences d’une page    |
    |          |      |      |           |HTML                      |
    |----------+------+------+-----------+--------------------------|
    |          |V:18, |      |filterdiff |extraire ou exclure des   |
    |patchutils|I:150 |232   |(1)        |différences d’un fichier  |
    |          |      |      |           |de différences            |
    |----------+------+------+-----------+--------------------------|
    |          |      |      |           |corriger les fichiers de  |
    |patchutils|V:18, |232   |fixcvsdiff |différences créés par CVS |
    |          |I:150 |      |(1)        |que patch(1) interprète   |
    |          |      |      |           |mal                       |
    |----------+------+------+-----------+--------------------------|
    |patchutils|V:18, |232   |flipdiff(1)|échanger l’ordre de deux  |
    |          |I:150 |      |           |rustines                  |
    |----------+------+------+-----------+--------------------------|
    |          |      |      |           |afficher quels sont les   |
    |patchutils|V:18, |232   |grepdiff(1)|fichiers modifiés par une |
    |          |I:150 |      |           |rustine correspondant un  |
    |          |      |      |           |une expression rationnelle|
    |----------+------+------+-----------+--------------------------|
    |          |V:18, |      |interdiff  |afficher les différences  |
    |patchutils|I:150 |232   |(1)        |entre deux fichiers de    |
    |          |      |      |           |différence unifiés        |
    |----------+------+------+-----------+--------------------------|
    |          |V:18, |      |           |afficher quels sont les   |
    |patchutils|I:150 |232   |lsdiff(1)  |fichiers modifiés par une |
    |          |      |      |           |rustine                   |
    |----------+------+------+-----------+--------------------------|
    |          |      |      |           |recalculer les nombres et |
    |patchutils|V:18, |232   |recountdiff|les décalages dans un     |
    |          |I:150 |      |(1)        |contexte unifié de        |
    |          |      |      |           |fichiers de différences   |
    |----------+------+------+-----------+--------------------------|
    |          |      |      |           |corriger les décalages et |
    |patchutils|V:18, |232   |rediff(1)  |les nombres d’un fichier  |
    |          |I:150 |      |           |de différences édité      |
    |          |      |      |           |manuellement              |
    |----------+------+------+-----------+--------------------------|
    |patchutils|V:18, |232   |splitdiff  |séparer les rustines      |
    |          |I:150 |      |(1)        |incrémentales             |
    |----------+------+------+-----------+--------------------------|
    |          |V:18, |      |unwrapdiff |réparer les correctifs    |
    |patchutils|I:150 |232   |(1)        |dont les mots ont été     |
    |          |      |      |           |coupés                    |
    |----------+------+------+-----------+--------------------------|
    |wiggle    |V:0,  |174   |wiggle(1)  |appliquer les rustines    |
    |          |I:0   |      |           |rejetées                  |
    |----------+------+------+-----------+--------------------------|
    |quilt     |V:3,  |788   |quilt(1)   |gérer une série de        |
    |          |I:33  |      |           |rustines                  |
    |----------+------+------+-----------+--------------------------|
    |meld      |V:14, |2972  |meld(1)    |comparer et fusionner des |
    |          |I:39  |      |           |fichiers (GTK)            |
    |----------+------+------+-----------+--------------------------|
    |          |      |      |           |afficher les différences  |
    |dirdiff   |V:0,  |166   |dirdiff(1) |et fusionner les          |
    |          |I:2   |      |           |modifications entre deux  |
    |          |      |      |           |arbres de répertoires     |
    |----------+------+------+-----------+--------------------------|
    |          |V:0,  |      |           |comparer deux fichiers mot|
    |docdiff   |I:0   |555   |docdiff(1) |par mot ou caractère par  |
    |          |      |      |           |caractère                 |
    |----------+------+------+-----------+--------------------------|
    |imediff   |V:0,  |157   |imediff(1) |interactive full screen 2/|
    |          |I:0   |      |           |3-way merge tool          |
    |----------+------+------+-----------+--------------------------|
    |makepatch |V:0,  |102   |makepatch  |créer des fichiers de     |
    |          |I:0   |      |(1)        |rustines étendus          |
    |----------+------+------+-----------+--------------------------|
    |makepatch |V:0,  |102   |applypatch |appliquer des fichiers de |
    |          |I:0   |      |(1)        |rustines étendus          |
    |----------+------+------+-----------+--------------------------|
    |          |V:9,  |      |           |afficher les différences  |
    |wdiff     |I:72  |644   |wdiff(1)   |de mots entre deux        |
    |          |      |      |           |fichiers texte            |
    +---------------------------------------------------------------+


%

10.4.1. Extraire des différences pour des fichiers sources

    La procédure suivante vous permet d'extraire les différences
    entre deux fichiers sources et créer un fichier de différences
    unifié « fichier.patch0 » ou « fichier.patch1 » selon
    l’emplacement du fichier.

    $ diff -u fichier.ancien fichier.nouveau > fichier.patch0
    $ diff -u ancien/fichier nouveau/fichier > fichier.patch1

%

10.4.2. Fusionner les mises à jour des fichiers source

    Le fichier de différences (« diff » (encore appelé fichier
    « patch » ou rustine) est utilisé pour envoyer une mise à jour de
    programme. Celui qui reçoit applique cette mise à jour à un autre
    fichier de la manière suivante :

    $ patch -p0 fichier < fichier.patch0
    $ patch -p1 fichier < fichier.patch1

%

10.4.3. Mise à jour par fusion de 3 sources

    Si vous avez trois versions d’un code source, vous pouvez
    effectuer de manière efficace une fusion des trois en utilisant 
    diff3(1) de la manière suivante :

    $ diff3 -m fichier.mien fichier.ancien fichier.votre > fichier

%

10.5. Systèmes de contrôle de version

    Voici un résumé des systèmes de contrôle de version (VCS) sur le
    système Debian.

    Note

    Si vous débutez avec les systèmes VCS, vous devriez commencer
    votre apprentissage avec Git, dont la popularité croît
    rapidement.

    Tableau 10.11. Liste d’outils pour les systèmes de contrôle de
    version

    +---------------------------------------------------------------+
    |  paquet  |popcon|taille|  outil   | type du |   commentaire   |
    |          |      |      |          |   VCS   |                 |
    |----------+------+------+----------+---------+-----------------|
    |cssc      |V:0,  |2044  |CSSC      |local    |clone de SCCS    |
    |          |I:2   |      |          |         |UNIX (obsolète)  |
    |----------+------+------+----------+---------+-----------------|
    |rcs       |V:3,  |562   |RCS       |local    |« SCCS UNIX en   |
    |          |I:19  |      |          |         |mieux »          |
    |----------+------+------+----------+---------+-----------------|
    |          |V:5,  |      |          |         |standard         |
    |cvs       |I:41  |4609  |CVS       |distant  |précédent de VCS |
    |          |      |      |          |         |distant          |
    |----------+------+------+----------+---------+-----------------|
    |          |      |      |          |         |« CVS en mieux »,|
    |subversion|V:20, |4858  |Subversion|distant  |de fait le       |
    |          |I:109 |      |          |         |nouveau standard |
    |          |      |      |          |         |de VCS distant   |
    |----------+------+------+----------+---------+-----------------|
    |          |      |      |          |         |DVCS rapide en C |
    |git       |V:305,|35040 |Git       |distribué|(utilisé par le  |
    |          |I:478 |      |          |         |noyau de Linux et|
    |          |      |      |          |         |d’autres)        |
    |----------+------+------+----------+---------+-----------------|
    |mercurial |V:8,  |1053  |Mercurial |distribué|DVCS en Python   |
    |          |I:48  |      |          |         |avec un peu de C |
    |----------+------+------+----------+---------+-----------------|
    |          |      |      |          |         |DVCS influencé   |
    |bzr       |V:2,  |28    |Bazaar    |distribué|par tla écrit en |
    |          |I:16  |      |          |         |Python (utilisé  |
    |          |      |      |          |         |par Ubuntu)      |
    |----------+------+------+----------+---------+-----------------|
    |          |      |      |          |         |DVCS avec une    |
    |darcs     |V:0,  |23159 |Darcs     |distribué|algèbre          |
    |          |I:7   |      |          |         |intelligente des |
    |          |      |      |          |         |rustines (lent)  |
    |----------+------+------+----------+---------+-----------------|
    |          |      |      |          |         |DVCS             |
    |tla       |V:0,  |1011  |GNU arch  |distribué|principalement de|
    |          |I:2   |      |          |         |Tom Lord         |
    |          |      |      |          |         |(Historique)     |
    |----------+------+------+----------+---------+-----------------|
    |monotone  |V:0,  |5815  |Monotone  |distribué|DVCS en C++      |
    |          |I:0   |      |          |         |                 |
    |----------+------+------+----------+---------+-----------------|
    |          |      |      |          |         |Interface        |
    |          |      |      |          |         |graphique        |
    |tkcvs     |V:0,  |1498  |CVS, …    |distant  |d’affichage d’une|
    |          |I:1   |      |          |         |arborescence de  |
    |          |      |      |          |         |dépôt VCS (CVS,  |
    |          |      |      |          |         |Subversion, RCS) |
    |----------+------+------+----------+---------+-----------------|
    |          |      |      |          |         |Interface        |
    |          |V:6,  |      |          |         |graphique        |
    |gitk      |I:42  |1723  |Git       |distribué|d’affichage d’une|
    |          |      |      |          |         |arborescence de  |
    |          |      |      |          |         |dépôt VCS (Git)  |
    +---------------------------------------------------------------+


    VCS est parfois appelé système de contrôle de révision (RCS), ou
    gestion de configuration logicielle (SCM).

    Un VCS distribué comme Git est, de nos jours, l’outil de choix.
    CVS et Subversion peuvent continuer à être utiles pour se joindre
    à certaines activités existantes sur les logiciels libres.

    Debian provides free Git services via Debian Salsa service. Its
    documentation can be found at https://wiki.debian.org/Salsa .

    Attention
   
    Debian has closed its old alioth services and the old alioth
    service data are available at alioth-archive as tarballs.

    Il existe quelques bases pour la création d’un accès à une
    archive VCS.

      * Utilisez « umask 002 » (consultez Section 1.2.4, « Contrôle
        des permissions pour les fichiers nouvellement créés :
        umask »)

      * Rattacher tous les fichiers d’archives VCS à un groupe
        pertinent
   
      * Activer l’identifiant de groupe de tous les répertoires
        d’archive VCS (schéma de création de fichiers semblable à
        BSD), consultez Section 1.2.3, « Permissions du système de
        fichiers »)

      * Rattacher au groupe l’utilisateur partageant l’archive VCS

%

10.5.1. Comparaison de commandes VCS

    Voici une comparaison très simplifiée des commandes natives de
    VCS destinées à donner une vue d’ensemble. La séquence de
    commandes typique peut demander des options et des paramètres.

    Tableau 10.12. Comparaison des commandes natives de VCS

    +---------------------------------------------------------------+
    |     Git     | CVS  |Subversion|           fonction            |
    |-------------+------+----------+-------------------------------|
    |git init     |cvs   |svn create|créer le dépôt (local)         |
    |             |init  |          |                               |
    |-------------+------+----------+-------------------------------|
    |-            |cvs   |-         |se connecter au dépôt distant  |
    |             |login |          |                               |
    |-------------+------+----------+-------------------------------|
    |git clone    |cvs co|svn co    |vérifiez le dépôt distant comme|
    |             |      |          |arborescence de travail        |
    |-------------+------+----------+-------------------------------|
    |git pull     |cvs up|svn up    |mettre à jour l’arborescence de|
    |             |      |          |travail depuis le dépôt distant|
    |-------------+------+----------+-------------------------------|
    |             |cvs   |          |ajouter des fichiers de        |
    |git add .    |add   |svn add   |l’arborescence de travail vers |
    |             |      |          |le VCS                         |
    |-------------+------+----------+-------------------------------|
    |git rm       |cvs rm|svn rm    |supprimer du VCS des fichiers  |
    |             |      |          |de l’arborescence de travail   |
    |-------------+------+----------+-------------------------------|
    |-            |cvs ci|svn ci    |déposer des modifications au   |
    |             |      |          |dépôt distant                  |
    |-------------+------+----------+-------------------------------|
    |git commit -a|-     |-         |déposer des modifications sur  |
    |             |      |          |le dépôt local                 |
    |-------------+------+----------+-------------------------------|
    |git push     |-     |-         |mettre à jour le dépôt distant |
    |             |      |          |à l’aide du dépôt local        |
    |-------------+------+----------+-------------------------------|
    |             |cvs   |          |afficher l’état de             |
    |git status   |status|svn status|l’arborescence de travail      |
    |             |      |          |d’après le VCS                 |
    |-------------+------+----------+-------------------------------|
    |git diff     |cvs   |svn diff  |diff <dépôt_de_référence>      |
    |             |diff  |          |<arborescence_de_travail>      |
    |-------------+------+----------+-------------------------------|
    |git repack -a|-     |-         |réempaqueter le dépôt local en |
    |-d; git prune|      |          |un seul paquet                 |
    |-------------+------+----------+-------------------------------|
    |             |      |          |Interface graphique d’affichage|
    |gitk         |tkcvs |tkcvs     |de l’arborescence d’un dépôt   |
    |             |      |          |VCS                            |
    +---------------------------------------------------------------+


    Attention

    L’appel d’une sous-commande git directement avec « git-xyz »
    depuis la ligne de commandes est devenu obsolète depuis début
    2006.

    Astuce

    S'il existe un fichier exécutable « git-foo » dans le chemin
    spécifié par « $PATH » alors entrer la commande « git foo » sans
    guillemets appellera ce « git-foo ». C'est une fonctionnalité de
    la commande « git ».

    Astuce

    Des outils avec interface graphique comme tkcvs(1) et gitk(1)
    vous seront d’une aide appréciable pour le suivi de l’historique
    de révision des fichiers. L’interface Web fournie par de
    nombreuses archives publiques pour parcourir leurs dépôts est
    assez utile aussi.

    Astuce

    Git peut travailler directement avec différents dépôts VCS tels
    que ceux proposés par CVS et Subversion et il fournit un dépôt
    local pour les modifications locales à l’aide des paquets git-cvs
    et git-svn. Consultez git pour les utilisateurs de CVS et
    Section 10.6.4, « Git pour le dépôt Subversion ».

    Astuce
   
    Git possède des commandes qui n’ont pas d’équivalent dans CVS ni
    Subversion : « fetch », « rebase », « cherry-pick », …

%

10.6. Git

    Git peut tout faire pour la gestion du code source soit local ou
    distant. Cela signifie que vous pouvez enregistrer les
    modifications de code source sans avoir besoin d’une connexion
    réseau avec le dépôt distant.

%

10.6.1. Configuration du client Git

    Vous pourrez définir certains éléments de configuration globaux,
    comme votre nom et votre adresse de courriel utilisée par Git,
    dans « ~/.gitconfig » de la manière suivante :

    $ git config --global nom.utilisateur "Prénom Nom"
    $ git config --global nom-utilisateur.email votre-nom@example.com

    Si vous avez l’habitude d’utiliser les commandes de CVS ou de
    Subversion, vous pourrez définir certains alias de commandes
    comme suit :

    $ git config --global alias.ci "commit -a"
    $ git config --global alias.co checkout

    Vous pouvez vérifier votre configuration globale de la manière
    suivante :

    $ git config --global --list

%

10.6.2. Références de Git

    Consultez ce qui suit.

      * page de manuel : git(1) (/usr/share/doc/git-doc/git.html)

      * Manuel de l’utilisateur de Git (/usr/share/doc/git-doc/
        user-manual.html)

      * Un tutoriel d’introduction à git « A tutorial introduction to
        git » (/usr/share/doc/git-doc/gittutorial.html)

      * Un tutoriel d’introduction à git : deuxième partie « A
        tutorial introduction to git: part two » (/usr/share/doc/
        git-doc/gittutorial-2.html)

      * Utilisation de tous les jours de GIT en 20 commandes
        « Everyday GIT With 20 Commands Or So » (/usr/share/doc/
        git-doc/everyday.html)

      * git pour les utilisateurs de CVS « git for CVS users » (/usr/
        share/doc/git-doc/gitcvs-migration.html)

          + Cette documentation décrit aussi comment configurer un
            serveur tel que CVS et extraire d’anciennes données de
            CVS vers Git.

      * Autres ressources git disponibles sur le web

          + Git - Cours pour les familiers de Subversion « SVN Crash
            Course »

          + La magie de Git « Git Magic » (/usr/share/doc/gitmagic/
            html/index.html)

    Les commandes git-gui(1) et gitk(1) rendent très facile
    l’utilisation de Git.

    Avertissement

    Ne pas utiliser d'espaces dans la chaîne de balise même si
    certains outils comme gitk(1) vous permettent de le faire. Cela
    peut perturber d'autres commandes de git.

%

10.6.3. Commandes de Git

    Même si votre source amont utilise un VCS différent, c’est une
    bonne idée d’utiliser git(1) pour l’activité locale parce qu’il
    vous permet de gérer votre copie locale de l’arborescence des
    sources sans connexion réseau amont. Voici quelques paquets et
    commandes utilisés avec git(1).

    Tableau 10.13. Liste des paquets et des commandes relatifs à git

    +-----------------------------------------------------------------+
    |     paquet     |popcon|taille|     commande      | description  |
    |----------------+------+------+-------------------+--------------|
    |                |      |      |                   |Documentation |
    |git-doc         |I:15  |11762 |N/A                |officielle de |
    |                |      |      |                   |git           |
    |----------------+------+------+-------------------+--------------|
    |                |      |      |                   |« Git Magic »,|
    |                |      |      |                   |le guide le   |
    |gitmagic        |I:1   |721   |N/A                |plus facile à |
    |                |      |      |                   |comprendre    |
    |                |      |      |                   |pour Git      |
    |----------------+------+------+-------------------+--------------|
    |                |      |      |                   |Git, système  |
    |                |      |      |                   |de contrôle de|
    |git             |V:305,|35040 |git(7)             |version       |
    |                |I:478 |      |                   |rapide,       |
    |                |      |      |                   |évolutif et   |
    |                |      |      |                   |distribué     |
    |----------------+------+------+-------------------+--------------|
    |                |      |      |                   |Interface     |
    |                |V:6,  |      |                   |graphique de  |
    |gitk            |I:42  |1723  |gitk(1)            |navigateur de |
    |                |      |      |                   |dépôt Git avec|
    |                |      |      |                   |historique    |
    |----------------+------+------+-------------------+--------------|
    |                |      |      |                   |Interface     |
    |git-gui         |V:2,  |2317  |git-gui(1)         |graphique pour|
    |                |I:24  |      |                   |Git (pas      |
    |                |      |      |                   |d’historique) |
    |----------------+------+------+-------------------+--------------|
    |                |      |      |                   |importer des  |
    |git-svn         |V:1,  |1144  |git-svnimport(1)   |données venant|
    |                |I:22  |      |                   |de Subversion |
    |                |      |      |                   |dans Git      |
    |----------------+------+------+-------------------+--------------|
    |                |      |      |                   |fournit un    |
    |                |      |      |                   |fonctionnement|
    |git-svn         |V:1,  |1144  |git-svn(1)         |bidirectionnel|
    |                |I:22  |      |                   |entre         |
    |                |      |      |                   |Subversion et |
    |                |      |      |                   |Git           |
    |----------------+------+------+-------------------+--------------|
    |                |      |      |                   |importer des  |
    |git-cvs         |V:0,  |1279  |git-cvsimport(1)   |données venant|
    |                |I:10  |      |                   |de CVS dans   |
    |                |      |      |                   |Git           |
    |----------------+------+------+-------------------+--------------|
    |                |      |      |                   |exporter une  |
    |                |      |      |                   |proposition   |
    |git-cvs         |V:0,  |1279  |git-cvsexportcommit|(« commit »)  |
    |                |I:10  |      |(1)                |récupéré de   |
    |                |      |      |                   |Git vers un   |
    |                |      |      |                   |CVS           |
    |----------------+------+------+-------------------+--------------|
    |                |V:0,  |      |                   |émulateur de  |
    |git-cvs         |I:10  |1279  |git-cvsserver(1)   |serveur CVS   |
    |                |      |      |                   |pour Git      |
    |----------------+------+------+-------------------+--------------|
    |                |      |      |                   |envoyer une   |
    |                |      |      |                   |série de      |
    |git-email       |V:0,  |966   |git-send-email(1)  |rustines sous |
    |                |I:11  |      |                   |forme de      |
    |                |      |      |                   |courriel à    |
    |                |      |      |                   |partir de Git |
    |----------------+------+------+-------------------+--------------|
    |                |V:0,  |      |                   |quilt         |
    |stgit           |I:0   |603   |stg(1)             |par-dessus git|
    |                |      |      |                   |(Python)      |
    |----------------+------+------+-------------------+--------------|
    |                |      |      |                   |automatise la |
    |git-buildpackage|V:2,  |4193  |git-buildpackage(1)|mise en paquet|
    |                |I:12  |      |                   |Debian avec   |
    |                |      |      |                   |Git           |
    |----------------+------+------+-------------------+--------------|
    |                |V:0,  |      |                   |quilt         |
    |guilt           |I:0   |146   |guilt(7)           |par-dessus git|
    |                |      |      |                   |(SH/AWK/SED/…)|
    +-----------------------------------------------------------------+


    Astuce

    Avec git(1), vous travaillez sur une branche locale avec de
    nombreuses commit et vous utilisez quelque chose comme « git
    rebase -i master » pour réorganiser plus tard l’historique des
    modifications. Cela vous permet de faire des modifications
    propres de l’historique. Consultez git-rebase(1) et 
    git-cherry-pick(1).

    Astuce

    Si vous désirez retrouver un répertoire propre sans perdre l’état
    actuel du répertoire de travail, vous pouvez utiliser « git
    stash ». Consultez git-stash(1).

%

10.6.4. Git pour le dépôt Subversion

    Un dépôt Subversion en « svn+ssh://svn.example.org/project/module
    /trunk » peut être extrait vers un dépôt Git local en « ./dest »
    puis renvoyé vers le dépôt subversion. Par exemple :

    $ git svn clone -s -rHEAD svn+ssh://svn.example.org/project dest
    $ cd dest
    ... effectuer des modifications
    $ git commit -a
    ... travailler encore avec git
    $ git svn dcommit

    Astuce
   
    L’utilisation de « rHEAD » nous permet d’éviter de devoir cloner
    l’ensemble du contenu de l’historique du dépôt Subversion.

%

10.6.5. Git pour l’enregistrement de l’historique de la configuration

    Vous pouvez enregistrer vous-même un historique chronologique de
    la configuration en utilisant les outils Git. Voici un exemple
    simple, pour vous exercer, d’enregistrement du contenu de « /etc/
    apt/ ».

    $ cd /etc/apt/
    $ sudo git init
    $ sudo chmod 700 .git
    $ sudo git add .
    $ sudo git commit -a

    Dépôt (« commit ») d’une configuration avec sa description

    Effectuez les modifications dans les fichiers de configuration.

    $ cd /etc/apt/
    $ sudo git commit -a

    Déposez (« commit ») la configuration avec sa description et
    retournez à vos occupations habituelles.

    $ cd /etc/apt/
    $ sudo gitk --all

    Vous avez avec vous l’historique complet de la configuration.

    Note

    sudo(8) est nécessaire pour travailler avec n’importe quelles
    permissions sur les données de configuration. Pour les données de
    configuration de l’utilisateur, sudo peut être omis.

    Note

    La commande « chmod 700 .git » de l’exemple ci-dessus est
    nécessaire pour protéger les données de l’archive d’un accès en
    écriture non autorisé.

    Astuce

    Pour une configuration plus complète de l’enregistrement de
    l’historique de configuration, voyez le paquet etckeeper
    package : Section 9.2.10, « Enregistrer les modifications dans
    des fichiers de configuration ».

%

10.7. CVS

    CVS is an older version control system before Subversion and Git.

    Attention
   
    Many URLs found in the below examples for CVS don't exist any
    more.

    Consultez ce qui suit.

      * cvs(1)

      * « /usr/share/doc/cvs/html-cvsclient »

      * « /usr/share/doc/cvs/html-info »

      * « /usr/share/doc/cvsbook »

      * « info cvs »

%

10.7.1. Configuration du dépôt CVS

    La configuration suivante permet de ne faire des dépôts
    (« commit ») vers le dépôt du CVS que par les membres du groupe
    « src » et l’administration du CVS que par un membre du groupe
    « staff », réduisant ainsi la chance de se détruire soi-même.

    # cd /var/lib; umask 002; mkdir cvs
    # export CVSROOT=/srv/cvs/projet
    # cd $CVSROOT
    # chown root:src .
    # chmod 2775 .
    # cvs -d $CVSROOT init
    # cd CVSROOT
    # chown -R root:staff .
    # chmod 2775 .
    # touch val-tags
    # chmod 664 history val-tags
    # chown root:src history val-tags

    Astuce

    Vous pouvez restreindre la création d’un nouveau projet en
    modifiant le propriétaire du répertoire « $CVSROOT » pour
    « root:staff » et ses permissions à « 3775 ».

%

10.7.2. Accès local à CVS

    La variable « $CVSROOT » pointe vers le dépôt par défaut. Ce qui
    suit définit « $CVSROOT » pour l’accès local :

    $ export CVSROOT=/srv/cvs/project

%

10.7.3. Accès distant à CVS avec pserver

    Many public CVS servers provide read-only remote access to them
    with account name "anonymous" via pserver service. For example,
    Debian web site contents were maintained by webwml project via
    CVS at Debian alioth service. The following was used to set up
    "$CVSROOT" for the remote access to this old CVS repository.

    $ export CVSROOT=:pserver:anonymous@anonscm.debian.org:/cvs/webwml
    $ cvs login

    Note

    Comme pserver est sujet à des attaques d’espionnage et peu sûr,
    l’accès en écriture est habituellement désactivé par les
    administrateurs du serveur.

%

10.7.4. Accès distant à CVS avec ssh

    The following was used to set up "$CVS_RSH" and "$CVSROOT" for
    the remote access to the old CVS repository by webwml project
    with SSH.

    $ export CVS_RSH=ssh
    $ export CVSROOT=:ext:account@cvs.alioth.debian.org:/cvs/webwml

    Vous pouvez aussi utiliser une clé publique d’authentification
    pour SSH, ce qui élimine l’invite à distance pour l’entrée du mot
    de passe.

%

10.7.5. Importer une nouvelle source dans CVS

    Créez un nouvel emplacement d’arborescence locale des sources
    dans « ~/chemin/vers/module1 » par la commande suivante :

    $ mkdir -p ~/chemin/vers/module1; cd ~/chemin/vers/module1

    Mettez des fichiers dans la nouvelles arborescence locale de
    sources se trouvant en « ~/chemin/vers/module1 ».

    Importez-les vers CVS avec les paramètres suivants :

      * Module name : « module1 »

      * Vendor tag: « Branche-principale » (étiquette pour toute la
        branche)

      * Release tag: « Version-initiale » (étiquette pour une version
        spécifique)

    $ cd ~/chemin/vers/module1
    $ cvs import -m "Start module1" module1 Branche-principale Version-initiale
    $ rm -Rf . # optionnel

%

10.7.6. Permissions des fichiers du dépôt CVS

    CVS n’écrase pas un fichier du dépôt actuel mais le remplace par
    un autre. La permission en écriture vers le répertoire du dépôt
    est donc critique. Lancez ce qui suit, pour chaque nouveau module
    de « module1 » dans le dépôt à « /srv/cvs/projet », afin de vous
    assurer, si nécessaire, que cette condition est remplie :

    # cd /srv/cvs/projet
    # chown -R root:src module1
    # chmod -R ug+rwX   module1
    # chmod    2775     module1

%

10.7.7. Flux de travail avec CVS

    Voici un exemple de flux de travail typique utilisant CVS.

    Vérifiez tous les modules disponibles du projet CVS pointé par
    « $CVSROOT » comme suit :

    $ cvs rls
    CVSROOT
    module1
    module2
    ...

    Récupérez le « module1 » depuis son répertoire par défaut « ./
    module1 » de la manière suivante :

    $ cd ~/path/to
    $ cvs co module1
    $ cd module1

    Effectuez les modifications de contenu au besoin.

    Vérifiez les modifications par un équivalent de « diff -u
    [repository] [local] » de la manière suivante :

    $ cvs diff -u

    Vous-vous apercevez que vous avez cassé sévèrement un fichier
    appelé « fichier_à_restaurer » mais que les autres fichiers sont
    corrects.

    Écrasez le fichier « fichier_à_restaurer » avec une copie propre
    venant du CVS de la manière suivante :

    $ cvs up -C fichier_à_restaurer

    Enregistrez l’arborescence source locale vers le CVS comme suit :

    $ cvs ci -m "Décrire les modifications"

    Créez et ajoutez le fichier « fichier_à_ajouter » au CVS comme
    suit :

    $ vi fichier_à_ajouter
    $ cvs add fichier_à_ajouter
    $ cvs ci -m "Ajout de fichier_à_ajouter"

    Fusionnez la dernière version depuis le CVS comme suit :

    $ cvs up -d

    Recherchez les lignes commençant par « C filename » qui indiquent
    des modifications en conflit.

    Recherchez du code non modifié dans « .#nom_fichier.version ».

    Recherchez « <<<<<<< » et « >>>>>>> » dans les fichiers qui
    indiquent des conflits de modifications.

    Au besoin, éditez les fichiers pour résoudre les conflits.

    Ajoutez l’étiquette de version (« release tag« ») « Version-1 »
    comme suit :

    $ cvs ci -m "dernière proposition pour Version-1"
    $ cvs tag Version-1

    Poursuivez l’édition.

    Supprimez l’étiquette de version « Version-1  » comme suit :

    $ cvs tag -d Version-1

    Vérifiez les modifications du CVS comme suit :

    $ cvs ci -m "vraiment la dernière proposition pour Version-1"

    Ajoutez de nouveau, de la manière suivante, l’étiquette
    « Version-1 » à HEAD de « main » du CVS mis à jour :

    $ cvs tag Version-1

    Créez une branche avec une étiquette de branche « collante »
    Version-initiale-corrections-de-bogues » depuis la version
    d’origine pointée par l’étiquette « Version-initiale » et
    exportez-la vers le répertoire ~/chemin/vers/ancien » comme
    suit :

    $ cvs rtag -b -r Version-initiale Version-initiale-corrections-de-bogues module1
    $ cd ~/chemin/vers
    $ cvs co -r Version-initiale-corrections-de-bogues -d ancien module1
    $ cd ancien

    Astuce

    Utilisez  -D 2005-12-20 » (format de date ISO 8601) plutôt que
    « -r Version-initiale » pour indiquer une date particulière comme
    point de branche.

    Travaillez sur cette arborescence locale possédant l’étiquette
    « collante » « Version-initiale-corrections-de-bogues » qui est
    basée sur la version d’origine.

    Travaillez vous-même sur cette branche… jusqu’à ce que quelqu’un
    d’autre rejoigne cette branche
    « Version-initiale-corrections-de-bogues ».

    Synchronisez les fichiers modifiés par d’autres sur cette
    branche, en créant de nouveaux répertoires si nécessaire, de la
    manière suivante :

    $ cvs up -d

    Au besoin, éditez les fichiers pour résoudre les conflits.

    Vérifiez les modifications du CVS comme suit :

    $ cvs ci -m "checked into this branch"

    Mettez à jour l’arborescence locale depuis HEAD de main en
    supprimant l’étiquette collante (« sticky tag ») (« -A ») et sans
    expansion de mots-clés (« -kk ») comme suit :

    $ cvs up -d -kk -A

    Mettez à jour l’arborescence locale (contenu = HEAD de main) en
    fusionnant depuis la branche
    « Version-initiale-corrections-de-bogues » et sans expansion des
    mots-clés en faisant ce qui suit :

    $ cvs up -d -kk -j Version-initiale-corrections-de-bogues

    Corrigez les conflits avec l’éditeur.

    Vérifiez les modifications du CVS comme suit :

    $ cvs ci -m "Version-initiale-corrections-de-bogues fusionnée"

    Réalisez une archive de la manière suivante :

    $ cd ..
    $ mv ancien ancien-module1-corrections_bogues
    $ tar -cvzf ancien-module1-corrections_bogues.tar.gz ancien-module1-corrections_bogues
    $ rm -rf ancien-module1-corrections_bogues

    Astuce

    La commande « cvs up » peut prendre l’option « -d » pour créer de
    nouveaux répertoires et l’option « -P » pour supprimer les
    répertoires vides.

    Astuce

    Vous pouvez ne vérifier qu’un sous-répertoire de « module1 » en
    indiquant son nom comme, par exemple, « cvs co module1/
    sous-répertoire ».

    Tableau 10.14. Options importantes des commandes CVS (à utiliser
    comme premier(s) paramètre(s) à cvs(1))

    +---------------------------------------------------------------+
    |option|                     signification                      |
    |------+--------------------------------------------------------|
    |-n    |simulation, pas d’effet                                 |
    |------+--------------------------------------------------------|
    |-t    |afficher les messages montrant les étapes des actions de|
    |      |cvs                                                     |
    +---------------------------------------------------------------+


%

10.7.8. Derniers fichiers venant du CVS

    Pour obtenir les derniers fichiers du CVS, utilisez « tomorrow »
    comme suit :

    $ cvs ex -D tomorrow nom_module

%

10.7.9. Administration de CVS

    Ajoutez l’alias « mx » à un projet CVS (serveur local) de la
    manière suivante :

    $ export CVSROOT=/srv/cvs/projet
    $ cvs co CVSROOT/modules
    $ cd CVSROOT
    $ echo "mx -a module1" >>modules
    $ cvs ci -m "mx est maintenant un alias de module1"
    $ cvs release -d .

    Vous pouvez maintenant vérifier « module1 » (alias : « mx »)
    depuis le CVS vers le répertoire « new » de la manière suivante :

    $ cvs co -d nouveau mx
    $ cd nouveau

    Note
   
    Afin de pouvoir effectuer la procédure précédente, vous devrez
    avoir les permissions d’accès aux fichiers appropriées.

%

10.7.10. Bit d’exécution pour la vérification (« checkout ») du CVS

    Lorsque vous vérifiez des fichiers du CVS, leur bit
    d’autorisation en exécution est conservé.

    Si vous rencontrez des problèmes de droits d’exécution avec un
    fichier récupéré, par exemple « nom_fichier », modifiez-en les
    permissions dans le répertoire correspondant du dépôt CVS par ce
    qui suit afin de corriger ce problème :

    # chmod ugo-x nom_de_fichier

%

10.8. Subversion

    Subversion is an older version control system before Git but
    after CVS. It lacks tagging and branching features found in CVS
    and Git.

    You need to install subversion, libapache2-mod-svn and
    subversion-tools packages to set up a Subversion server.

%

10.8.1. Configuration du dépôt Subversion

    Actuellement, le paquet subversion ne configure pas le dépôt, on
    doit donc le faire manuellement. Un emplacement possible pour le
    dépôt se trouve en « /srv/svn/projet ».

    Créez un répertoire de la manière suivante :

    # mkdir -p        /srv/svn/projet

    Créez la base de données du dépôt comme suit :

    # svnadmin create /srv/svn/projet

%

10.8.2. Accès à Subversion par l’intermédiaire d’un serveur Apache2

    Si vous n’avez accès au dépôt de Subversion que par un serveur
    Apache2, il vous suffira de ne rendre le dépôt accessible en
    écriture que par le serveur WWW de la manière suivante :

    # chown -R www-data:www-data /srv/svn/projet

    Ajouter (ou décommenter) ce qui suit dans « /etc/apache2/
    mods-available/dav_svn.conf » afin de permettre l’accès au dépôt
    avec une authentification de l’utilisateur.

    <Location /projet>
      DAV svn
      SVNPath /srv/svn/projet
      AuthType Basic
      AuthName "Dépôt subversion"
      AuthUserFile /etc/subversion/passwd
    <LimitExcept GET PROPFIND OPTIONS REPORT>
        Require valid-user
    </LimitExcept>
    </Location>

    Créer un fichier d’authentification des utilisateurs avec la
    commande suivante :

    # htpasswd2 -c /etc/subversion/passwd nom_utilisateur

    Redémarrez Apache2.

    Votre nouveau dépôt Subversion est accessible à l’URL « http://
    localhost/projet » et « http://example.com/projet » depuis svn(1)
    (en supposant que l’URL du serveur web est « http://example.com/
     »).

%

10.8.3. Accès local à Subversion par un groupe

    Ce qui suit configure le dépôt Subversion pour un accès local par
    un groupe, projet, par exemple :

    # chmod  2775     /srv/svn/projet
    # chown -R root:src /srv/svn/projet
    # chmod -R ug+rwX   /srv/svn/projet

    Votre nouveau dépôt Subversion est accessible aux utilisateurs
    locaux appartenant au groupe projetà l’URL « file:///localhost/
    srv/svn/projet » ou « file:///srv/svn/projet » depuis svn(1) .
    Vous devrez lancer des commandes comme svn, svnserve, svnlook et
    svnadmin avec « umask 002 » afin de permettre l’accès au groupe.

%

10.8.4. Accès distant à Subversion avec SSH

    Un dépôt Subversion accessible à un groupe se trouve pour SSH à
    l’URL « example.com:/srv/svn/projet », vous pouvez y accéder avec
    svn(1) à l’URL « svn+ssh://example.com:/srv/svn/projet".

%

10.8.5. Structure de répertoires de Subversion

    Afin de compenser le manque de branches et d’étiquettes, de
    nombreux projets utilisent une arborescence de répertoires
    semblable à la suivante pour Subversion :

      ----- module1
        |   |-- branches
        |   |-- tags
        |   |   |-- version-1.0
        |   |   `-- version-2.0
        |   |
        |   `-- trunk
        |       |-- fichier1
        |       |-- fichier2
        |       `-- fichier3
        |
        `-- module2

    Astuce

    Vous devez utiliser la commande « svn copy … » pour marquer les
    branches et les étiquettes. Cela permet de s’assurer que
    Subversion enregistre correctement l’historique de modification
    des fichiers et économise l’espace disque.

%

10.8.6. Importer une nouvelle source vers Subversion

    Créez un nouvel emplacement d’arborescence locale des sources
    dans « ~/chemin/vers/module1 » par la commande suivante :

    $ mkdir -p ~/chemin/vers/module1; cd ~/chemin/vers/module1

    Mettez des fichiers dans la nouvelles arborescence locale de
    sources se trouvant en « ~/chemin/vers/module1 ».

    Importez-le dans Subversion avec les paramètres suivants :

      * Module name : « module1 »

      * URL du site Subversion : « file:///srv/svn/projet »
   
      * Répertoire de Subversion : « module1/trunk »

      * Étiquette de Subversion : « module1/tags/Version-initiale »

    $ cd ~/chemin/vers/module1
    $ svn import file:///srv/svn/projet/module1/trunk -m "Lancement module1"
    $ svn cp file:///srv/svn/projet/module1/trunk file:///srv/svn/projet/module1/tags/Version-initiale

    ou encore, comme suit :

    $ svn import ~/chemin/vers/module1 file:///srv/svn/projet/module1/trunk -m "Lancement module1"
    $ svn cp file:///srv/svn/projet/module1/trunk file:///srv/svn/projet/module1/tags/Version-initiale

    Astuce
   
    Vous pouvez remplacer des formats d’URL comme « file:///… » par
    d’autres formats d’URL comme «  http://… » et « svn+ssh://… ».

%

10.8.7. Flux de travail avec Subversion

    Voici un exemple typique de flux de travail utilisant Subversion
    avec son client natif.

    Astuce

    Les commandes du client proposées par le paquet git-svn peuvent
    proposer un mode d’utilisation de remplacement pour Subversion en
    utilisant la commande git. Consultez Section 10.6.4, « Git pour
    le dépôt Subversion ».

    Vérifiez de la manière suivante tous les modules disponibles
    depuis le projet pointé par l’URL « file:///srv/svn/projet » :

    $ svn list file:///srv/svn/projet
    module1
    module2
    ...

    Récupérez « module1/trunk » dans un répertoire « module1 » comme
    suit :

    $ cd ~/chemin/vers
    $ svn co file:///srv/svn/projet/module1/trunk module1
    $ cd module1

    Effectuez les modifications de contenu au besoin.

    Vérifiez les modifications par un équivalent de « diff -u
    [repository] [local] » de la manière suivante :

    $ svn diff

    Vous-vous apercevez que vous avez cassé sévèrement un fichier
    appelé « fichier_à_restaurer » mais que les autres fichiers sont
    corrects.

    Écrasez le fichier « fichier_a_annuler » avec une nouvelle copie
    propre depuis Subversion comme suit :

    $ svn revert fichier_a_annuler

    Enregistrez l’arbre local des sources mis à jour vers Subversion
    comme suit :

    $ svn ci -m "Décrire les modifications"

    Créez et ajoutez le fichier « fichier_a_ajouter » dans Subversion
    comme suit :

    $ vi fichier_a_ajouter
    $ svn add fichier_a_ajouter
    $ svn ci -m "fichier_a_ajouter ajouté"

    Fusionnez la dernière version depuis Subversion comme suit :

    $ svn up

    Recherchez les lignes commençant par « C filename » qui indiquent
    des modifications en conflit.

    Recherchez le code non modifié, par exemple « nom_fichier.r6 »,
    « nom_fichier.r9 » et « nom_fichier.mien ».

    Recherchez « <<<<<<< » et « >>>>>>> » dans les fichiers qui
    indiquent des conflits de modifications.

    Au besoin, éditez les fichiers pour résoudre les conflits.

    Ajoutez l’étiquette de version (« release tag« ») « Version-1 »
    comme suit :

    $ svn ci -m "dernier « commit » pour la Release-1"
    $ svn cp file:///srv/svn/projet/module1/trunk file:///srv/svn/projet/module1/tags/Release-1

    Poursuivez l’édition.

    Supprimez l’étiquette de version « Version-1  » comme suit :

    $ svn rm file:///srv/svn/projet/module1/tags/Release-1

    Récupérez les modifications depuis Subversion comme suit :

    $ svn ci -m "vraiment le dernier commit pour Release-1"

    Ajoutez de nouveau la balise « Version-1 » depuis la version mise
    à jour de HEAD de trunk de Subversion comme suit :

    $ svn cp file:///srv/svn/projet/module1/trunk file:///srv/svn/projet/module1/tags/Version-1

    Créez une branche dont le chemin est « module1/branches/
    Release-initial-bugfixes » depuis la version initiale pointée par
    le chemin « module1/tags/Release-initial » et récupérez-le vers
    le répertoire « ~/chemin/vers/ancien » comme suit :

    $ svn cp file:///srv/svn/projet/module1/tags/Version-initiale file:///srv/svn/projet/module1/branches/Version-initale-corrections-de-bogues
    $ cd ~/chemin/vers
    $ svn co file:///srv/svn/projet/module1/branches/Version-initiale-corrections-de-bogues ancien
    $ cd ancien

    Astuce

    Utilisez « module1/trunk@{2005-12-20} » (format de date ISO 8601)
    plutôt que « module1/tags/Release-initial » pour indiquer une
    date particulière comme point de branche.

    Travaillez sur cet arbre de sources local pointant vers la
    branche « Version-initiale-corrections-de-bogues » qui est basée
    sur la version initiale.

    Travaillez vous-même sur cette branche… jusqu’à ce que quelqu’un
    d’autre rejoigne cette branche
    « Version-initiale-corrections-de-bogues ».

    Effectuez la synchronisation avec les fichiers de cette branche
    modifiés par d’autres comme suit :

    $ svn up

    Au besoin, éditez les fichiers pour résoudre les conflits.

    Récupérez les modifications depuis Subversion comme suit :

    $ svn ci -m "récupérés dans cette branche"

    Mettez à jour l’arborescence local avec HEAD de trunk de la
    manière suivante :

    $ svn switch file:///srv/svn/projet/module1/trunk

    Mettez à jour l’arborescence locale (contenu = HEAD de trunk) en
    fusionnant depuis la branche
    « Version-initiale-corrections-de-bogues » par ce qui suit :

    $ svn merge file:///srv/svn/projet/module1/branches/Version-initiale-corrections-de-bogues

    Corrigez les conflits avec l’éditeur.

    Récupérez les modifications depuis Subversion comme suit :

    $ svn ci -m "Version-initiale-corrections-de-bogues fusionnée"

    Réalisez une archive de la manière suivante :

    $ cd ..
    $ mv ancien ancien-module1-corrections_bogues
    $ tar -cvzf ancien-module1-corrections_bogues.tar.gz ancien-module1-corrections_bogues
    $ rm -rf ancien-module1-corrections_bogues

    Astuce
   
    Vous pouvez remplacer des formats d’URL comme « file:///… » par
    d’autres formats d’URL comme «  http://… » et « svn+ssh://… ».

    Astuce

    Vous pouvez ne vérifier (« checkout ») qu’un sous-répertoire de
    « module1 » en indiquant son nom comme, par exemple, « svn co
    file:///srv/svn/projet/module1/trunk/sous-répertoire module1/
    sous-répertoire », etc.

    Tableau 10.15. Options importantes des commandes de Subversion (à
    utiliser comme premier(s) paramètre(s) de svn(1))

    +---------------------------------------------------------------+
    | option  |                    signification                    |
    |---------+-----------------------------------------------------|
    |--dry-run|simulation, pas d’effet                              |
    |---------+-----------------------------------------------------|
    |-v       |affichage détaillé des messages d’activité de        |
    |         |Subversion                                           |
    +---------------------------------------------------------------+


Chapitre 11. Conversion de données

    Description des outils et astuces pour convertir différents
    formats de données sur un système Debian.

    Les outils basés sur des standards sont de très bonne qualité
    mais la prise en charge des formats propriétaires est limitée.

%

11.1. Outils de conversion de données textuelles

    Mes yeux ont été attirés par les paquets suivants de conversions
    de données textuelles :

    Tableau 11.1. Liste des outils de conversion de texte

    +---------------------------------------------------------------+
    | paquet |popcon|taille|  mot clé  |        description         |
    |--------+------+------+-----------+----------------------------|
    |        |      |      |           |convertisseur de codage de  |
    |        |V:935,|      |jeu de     |texte entre différents      |
    |libc6   |I:999 |12771 |caractères |paramètres linguistiques à  |
    |        |      |      |           |l’aide d’iconv(1)           |
    |        |      |      |           |(fondamental)               |
    |--------+------+------+-----------+----------------------------|
    |        |      |      |           |convertisseur de codage de  |
    |        |V:3,  |      |           |texte entre différents      |
    |recode  |I:25  |603   |charset+eol|paramètres linguistiques    |
    |        |      |      |           |(flexible avec plus d’alias |
    |        |      |      |           |et de fonctionnalités)      |
    |--------+------+------+-----------+----------------------------|
    |        |      |      |           |convertisseur de codage de  |
    |konwert |V:1,  |134   |jeu de     |texte entre différents      |
    |        |I:54  |      |caractères |paramètres linguistiques (le|
    |        |      |      |           |luxe)                       |
    |--------+------+------+-----------+----------------------------|
    |nkf     |V:0,  |358   |jeu de     |jeux de caractères pour le  |
    |        |I:11  |      |caractères |japonais                    |
    |--------+------+------+-----------+----------------------------|
    |tcs     |V:0,  |518   |jeu de     |jeu de caractères du        |
    |        |I:0   |      |caractères |traducteur                  |
    |--------+------+------+-----------+----------------------------|
    |        |V:0,  |      |jeu de     |remplacer les lettres       |
    |unaccent|I:0   |29    |caractères |accentuées par leur         |
    |        |      |      |           |équivalent accentué         |
    |--------+------+------+-----------+----------------------------|
    |        |V:1,  |      |eol (fin de|convertisseur de format de  |
    |tofrodos|I:25  |55    |ligne)     |texte entre DOS et UNIX :   |
    |        |      |      |           |fromdos(1) et todos(1)      |
    |--------+------+------+-----------+----------------------------|
    |        |V:0,  |      |eol (fin de|convertisseur de format de  |
    |macutils|I:1   |298   |ligne)     |texte entre Macintosh et    |
    |        |      |      |           |UNIX :frommac(1) et tomac(1)|
    +---------------------------------------------------------------+


%

11.1.1. Convertir un fichier texte avec iconv

    Astuce

    iconv(1) fait partie du paquet libc6 et est toujours disponible
    sur pratiquement tous les systèmes de type Unix pour permettre la
    conversion des codages de caractères.

    Vous pouvez convertir les codages de caractères d’un fichier
    texte par iconv(1) en effectuant ce qui suite :

    $ iconv -f codage1 -t codage2 entrée.txt >sortie.txt

    La valeur des codages n’est pas sensible à la casse et ignore « -
     » et « _ » pour la correspondance. On peut vérifier quels sont
    les codages pris en charge à l’aide de la commande « iconv -l ».

    Tableau 11.2. Liste de valeurs de codage et leur utilisation

    +---------------------------------------------------------------+
    | valeur de |                    utilisation                    |
    |  codage   |                                                   |
    |-----------+---------------------------------------------------|
    |           |American Standard Code for Information Interchange |
    |ASCII      |(Code américain standard pour l’échange            |
    |           |d’informations), code sur 7 bits sans caractère    |
    |           |accentué                                           |
    |-----------+---------------------------------------------------|
    |UTF-8      |norme actuelle multi-langues pour tous les systèmes|
    |           |d’exploitation modernes                            |
    |-----------+---------------------------------------------------|
    |ISO-8859-1 |ancienne norme pour les langues d’Europe de        |
    |           |l’ouest, ASCII + lettres accentuées                |
    |-----------+---------------------------------------------------|
    |ISO-8859-2 |ancienne norme pour les langues d’Europe de l’est, |
    |           |ASCII + lettres accentuées                         |
    |-----------+---------------------------------------------------|
    |ISO-8859-15|ancienne norme pour les langues d’Europe de        |
    |           |l’ouest, ISO-8859-1 avec le signe euro             |
    |-----------+---------------------------------------------------|
    |           |page de code 850, caractères de DOS Microsoft avec |
    |CP850      |graphiques pour les langues de l’Europe de l’est,  |
    |           |variante de ISO-8859-1                             |
    |-----------+---------------------------------------------------|
    |CP932      |page de code 932, variante style Microsoft Windows |
    |           |de Shift-JIS pour le japonais                      |
    |-----------+---------------------------------------------------|
    |CP936      |page de code 936, variante style Microsoft Windows |
    |           |de GB2312, GBK ou GB18030 pour le chinois simplifié|
    |-----------+---------------------------------------------------|
    |           |page de code 949, variante style Microsoft Windows |
    |CP949      |de EUC-KR de «  Unified Hangul Code » pour le      |
    |           |coréen                                             |
    |-----------+---------------------------------------------------|
    |CP950      |page de code 950, variante style Microsoft Windows |
    |           |de Big5 pour le chinois traditionnel               |
    |-----------+---------------------------------------------------|
    |CP1251     |page de code 1251, encodage de style Microsoft     |
    |           |Windows pour l’alphabet cyrillique                 |
    |-----------+---------------------------------------------------|
    |CP1252     |page de code 1252, variante style Microsoft Windows|
    |           |de ISO-8859-15 pour les langues d’Europe de l’ouest|
    |-----------+---------------------------------------------------|
    |KOI8-R     |ancienne norme UNIX de russe pour l’alphabet       |
    |           |cyrillique                                         |
    |-----------+---------------------------------------------------|
    |ISO-2022-JP|codage standard du courrier électronique japonais  |
    |           |n’utilisant que des codes à 7 bits                 |
    |-----------+---------------------------------------------------|
    |eucJP      |ancien code UNIX de japonais sur 8 bits et         |
    |           |complètement différent de Shift-JIS                |
    |-----------+---------------------------------------------------|
    |Shift-JIS  |norme JIS X 0208 Annexe 1 pour le japonais         |
    |           |(consultez CP932)                                  |
    +---------------------------------------------------------------+


    Note

    Certains codages ne sont pris en compte que pour la conversion de
    données et ne sont pas utilisés en tant que valeur de paramètre
    linguistique (Section 8.4.1, « Bases du codage »).

    Pour les jeux de caractères qui tiennent dans un seul octet tels
    que les jeux de caractères ASCII et ISO-8859, le codage des
    caractères signifie à peu près la même chose que le jeu de
    caractères.

    Pour les jeux de caractères ayant de nombreux caractères tels que
    JIS X 0213 pour le japonais ou Universal Character Set (UCS,
    Unicode, ISO-10646-1) (jeu de caractère universel) pour
    pratiquement toutes les langues, il y a de nombreux schémas de
    codage pour les insérer dans les séquences d’octets de données.

      * EUC et ISO/IEC 2022 (connu aussi en tant que JIS X 0202) pour
        le japonais

      * UTF-8, UTF-16/UCS-2 et UTF-32/UCS-4 pour l’Unicode

    Pour ceux-ci, il y a une différence claire entre le jeu de
    caractères et le codage des caractères.

    Page de code est utilisée comme synonyme de table de codage de
    caractères pour certaines d’entre-elles spécifiques au
    fournisseur.

    Note

    Veuillez remarquer que la plupart des systèmes de codage
    partagent le même code avec ASCII pour les caractères sur 7 bits.
    Mais il y a quelques exceptions, lors de la conversion de
    programmes C et des données d’URL anciens en japonais depuis ce
    qui est parfois appelé format de codage shift-JIS vers le format
    UTF-8, utilisez « CP932 » comme nom de codage plutôt que
    « shift-JIS » afin d’obtenir le résultat attendu : 0x5C → « \ »
    et 0x7E → « ~ ». Sinon, ils seront convertis vers les mauvais
    caractères.

    Astuce

    On peut aussi utiliser recode(1) qui offre plus de
    fonctionnalités que celles combinées de iconv(1), fromdos(1), 
    todos(1), frommac(1) et tomac(1). Pour plus de détails, consultez
    « info recode ».

%

11.1.2. Vérifier que les fichiers sont codés en UTF-8 avec iconv

    Vous pouvez vérifier si un fichier texte est codé en UTF-8 à
    l’aide d’iconv(1) en effectuant ce qui suit :

    $ iconv -f utf8 -t utf8 input.txt >/dev/null || echo "Trouvé non-UTF-8"

    Astuce
   
    Utilisez l’option « --verbose » dans les exemples ci-dessus pour
    trouver le premier caractère non UTF-8.

%

11.1.3. Convertir les noms de fichiers avec iconv

    Voici un exemple de script pour convertir le codage des noms de
    fichiers, dans un seul répertoire, depuis celui créé par un
    ancien système d’exploitation vers celui d’un système
    d’exploitation moderne en UTF-8.

    #!/bin/sh
    ENCDN=iso-8859-1
    for x in *;
     do
     mv "$x" "$(echo "$x" | iconv -f $ENCDN -t utf-8)"
    done

    La variable « $ENCDN » spécifie l'encodage d'origine des noms de
    fichier sous d'anciens OS de la même façon que dans Tableau 11.2,
    « Liste de valeurs de codage et leur utilisation ».

    Pour les cas plus compliqués, veuillez monter le système de
    fichiers (par exemple une partition d’un disque dur) contenant de
    tels noms de fichiers avec le codage correct comme option de 
    mount(8) (consultez Section 8.4.6, « Coder les noms de fichiers »
    ) et copier son contenu complet vers un autre système de fichiers
    monté en UTF-8 avec la commande « cp -a ».

%

11.1.4. Convertir les fins de ligne (EOL)

    Le format de fichier texte, particulièrement le code de fin de
    ligne (EOL), dépend de la plateforme.

    Tableau 11.3. Liste des styles d’EOL pour différentes plateformes

    +-----------------------------------------------------------+
    |   plateforme   |code pour EOL|contrôle|décimal|hexadécimal|
    |----------------+-------------+--------+-------+-----------|
    |Debian (unix)   |LF           |^J      |10     |0A         |
    |----------------+-------------+--------+-------+-----------|
    |MSDOS et Windows|CR-LF        |^M^J    |13 10  |0D 0A      |
    |----------------+-------------+--------+-------+-----------|
    |Apple Macintosh |CR           |^M      |13     |0D         |
    +-----------------------------------------------------------+


    Les programmes de conversion du format des fins de lignes (EOL), 
    fromdos(1), todos(1), frommac(1) et tomac(1) sont assez
    pratiques. recode(1) peut aussi être utile.

    Note

    Certaines données sur un système Debian, telles que les données
    de la page wiki du paquet python-moinmoin, utilisent le CR-LF du
    style MSDOS comme code de fin de ligne (EOL). La règle précédente
    n’est donc que générale.

    Note

    La plupart des éditeurs (par exemple vim, emacs, gedit…) peuvent
    prendre en compte de manière transparente les fichiers ayant une
    fin de ligne (EOL) de style MSDOS.

    Astuce

    L’utilisation de « sed -e '/\r$/!s/$/\r/' » en remplacement de 
    todos(1) est préférable lorsque vous désirez unifier le style de
    caractère de fin de ligne vers le style MSDOS depuis un style
    mixte MSDOS et UNIX (par exemple, après avoir fusionné deux
    fichiers de style MSDOS avec diff3(1)). Cela parce que todos
    ajoute un retour charriot (CR) à toutes les lignes.

%

11.1.5. Convertir les tabulations (TAB)

    Il y a quelques programmes spécialisés dans la conversion des
    codes de tabulations.

    Tableau 11.4. Liste des commande de conversion de TAB des paquets
    bsdmainutils et coreutils

    +----------------------------------------------------------+
    |             fonction              |bsdmainutils|coreutils|
    |-----------------------------------+------------+---------|
    |étendre les tabulations en espaces |« col -x »  |expand   |
    |-----------------------------------+------------+---------|
    |convertir les espaces en tabulation|« col -h »  |unexpand |
    +----------------------------------------------------------+


    indent(1) du paquet indent reformate complètement les espaces
    dans un programme en C.

    Des programmes d’édition tels que vim et emacs peuvent aussi être
    utilisés pour la conversion des tabulations. Par exemple avec
    vim, vous pouvez étendre les tabulation avec la séquence de
    commandes « :set expandtab » et « :%retab ». Vous pouvez revenir
    en arrière de cette conversion par la séquence de commandes
    « :set noexpandtab » et « :%retab! ».

%

11.1.6. Éditeurs avec conversion automatique

    Les éditeurs de textes modernes et intelligents comme le
    programme vim sont assez habiles et prennent assez bien en compte
    les systèmes de codage de caractères et tous les formats de
    fichiers. Vous devriez utiliser ces éditeurs avec les paramètres
    linguistiques UTF-8 dans une console compatible avec UTF-8 pour
    une meilleure compatibilité.

    Un ancien fichier texte UNIX d’Europe de l’Ouest, « u-file.txt »
    enregistré dans le codage latin1 (iso-8859-1) peut être édité
    avec vim de la manière suivante :

    $ vim u-file.txt

    C’est possible car le mécanisme d’autodétection du codage du
    fichier dans vim suppose d’abord que le codage est UTF-8 et, s’il
    échoue, suppose qu’il est latin1.

    Un ancien fichier texte en polonais, « pu-file.txt », enregistré
    avec le codage latin2 (iso-8859-2) peut être édité avec vim de la
    manière suivante :

    $ vim '+e ++enc=latin2 pu-file.txt'

    Un ancien fichier texte UNIX en japonais, « ju-file.txt »,
    enregistré avec le codage eucJP peut être édité avec vim de la
    manière suivante :

    $ vim '+e ++enc=eucJP ju-file.txt'

    Un ancien fichier MS-Windows en japonais, « jw-file.txt »,
    enregistré dans le codage appelé shift-JIS (plus précisément :
    CP932) peut être édité avec vim de la manière suivante :

    $ vim '+e ++enc=CP932 ++ff=dos jw-file.txt'

    Lorsqu’un fichier est ouvert avec les options « ++enc » et
    « ++ff », « :w » sur la ligne de commandes de Vim l’enregistre
    dans son format d’origine et écrase le fichier d’origine. Vous
    pouvez aussi indiquer le format d’enregistrement et le nom du
    fichier sur la ligne de commandes de Vim, par exemple, « :w ++enc
    =utf8 nouveau.txt ».

    Veuillez vous rapporter à mbyte.txt « multi-byte text support »
    dans l’aide en ligne de vim et Tableau 11.2, « Liste de valeurs
    de codage et leur utilisation » pour les valeurs de paramètres
    linguistiques utilisés avec « ++enc ».

    La famille de programmes emacs peut effectuer des fonctions
    équivalentes.

%

11.1.7. Extraire du texte brut

    Ce qui suit permet de lire une page web sous forme de fichier
    texte. C’est très utile pour copier des informations de
    configuration depuis le Web ou pour appliquer des outils textuels
    de base d’UNIX comme grep(1) à la page web .

    $ w3m -dump http://www.site-distant.com/help-info.html >fichier-texte

    De la même manière, vous pouvez extraire des données en texte
    brut vers d’autres formats en utilisant ce qui suit :.

    Tableau 11.5. Liste d’outils pour extraite des données en texte
    brut

    +---------------------------------------------------------------+
    | paquet  |popcon|taille|    mot clé     |       fonction       |
    |---------+------+------+----------------+----------------------|
    |         |V:31, |      |                |convertisseur HTML    |
    |w3m      |I:284 |2289  |html→texte      |vers texte avec la    |
    |         |      |      |                |commande « w3m -dump »|
    |---------+------+------+----------------+----------------------|
    |         |V:3,  |      |                |convertisseur avancé  |
    |html2text|I:33  |274   |html→texte      |HTML vers texte (ISO  |
    |         |      |      |                |8859-1)               |
    |---------+------+------+----------------+----------------------|
    |         |      |      |                |convertisseur HTML    |
    |lynx     |V:13, |1948  |html→texte      |vers texte avec la    |
    |         |I:98  |      |                |commande « lynx       |
    |         |      |      |                |-dump »               |
    |---------+------+------+----------------+----------------------|
    |         |      |      |                |convertisseur HTML    |
    |elinks   |V:6,  |1767  |html→texte      |vers texte avec la    |
    |         |I:28  |      |                |commande « elinks     |
    |         |      |      |                |-dump »               |
    |---------+------+------+----------------+----------------------|
    |         |      |      |                |convertisseur HTML    |
    |links    |V:6,  |2249  |html→texte      |vers texte avec la    |
    |         |I:39  |      |                |commande « links      |
    |         |      |      |                |-dump »               |
    |---------+------+------+----------------+----------------------|
    |         |      |      |                |convertisseur HTML    |
    |links2   |V:1,  |5417  |html→texte      |vers texte avec la    |
    |         |I:15  |      |                |commande « links2     |
    |         |      |      |                |-dump »               |
    |---------+------+------+----------------+----------------------|
    |         |V:2,  |      |                |convertir des fichiers|
    |antiword |I:10  |589   |MSWord→texte,ps |MSWord en texte brut  |
    |         |      |      |                |ou en ps              |
    |---------+------+------+----------------+----------------------|
    |         |V:27, |      |                |convertir les fichier |
    |catdoc   |I:127 |675   |MSWord→texte,TeX|MSWord en texte brut  |
    |         |      |      |                |ou en TeX             |
    |---------+------+------+----------------+----------------------|
    |         |V:1,  |      |                |extraire du texte     |
    |pstotext |I:3   |126   |ps/pdf→texte    |depuis des fichiers   |
    |         |      |      |                |PostScript et PDF     |
    |---------+------+------+----------------+----------------------|
    |unhtml   |V:0,  |43    |html→texte      |supprimer les balise  |
    |         |I:0   |      |                |d’un fichier HTML     |
    |---------+------+------+----------------+----------------------|
    |         |V:1,  |      |                |convertisseur du texte|
    |odt2txt  |I:7   |60    |odt→texte       |OpenDocument vers     |
    |         |      |      |                |texte                 |
    +---------------------------------------------------------------+


%

11.1.8. Mettre en évidence et formater des données en texte brut

    Vous pouvez mettre en évidence et formater des données en texte
    brut de la manière suivante :

    Tableau 11.6. Liste des outils pour mettre en évidence des
    données de texte brut

    +---------------------------------------------------------------+
    |     paquet     |popcon|taille|   mot clé   |   description    |
    |----------------+------+------+-------------+------------------|
    |                |      |      |             |MACRO Vim pour    |
    |                |      |      |             |convertir du code |
    |vim-runtime     |V:19, |31723 |mise en      |source en HTML    |
    |                |I:435 |      |évidence     |avec « :source    |
    |                |      |      |             |$VIMRUNTIME/syntax|
    |                |      |      |             |/html.vim »       |
    |----------------+------+------+-------------+------------------|
    |                |      |      |             |convertisseur pour|
    |cxref           |V:0,  |1193  |c→html       |les programmes C  |
    |                |I:0   |      |             |vers latex et HTML|
    |                |      |      |             |(langage C)       |
    |----------------+------+------+-------------+------------------|
    |                |      |      |             |convertit de      |
    |src2tex         |V:0,  |622   |mise en      |nombreux codes    |
    |                |I:0   |      |évidence     |sources en TeX    |
    |                |      |      |             |(langage C)       |
    |----------------+------+------+-------------+------------------|
    |                |      |      |             |convertit de      |
    |                |      |      |             |nombreux codes    |
    |                |      |      |             |source vers des   |
    |                |      |      |             |fichiers HTML,    |
    |                |V:0,  |      |mise en      |XHTML, LaTeX,     |
    |source-highlight|I:7   |1992  |évidence     |Texinfo, séquences|
    |                |      |      |             |d’échappement en  |
    |                |      |      |             |couleur ANSI et   |
    |                |      |      |             |DocBook files avec|
    |                |      |      |             |mise en évidence  |
    |                |      |      |             |(C++)             |
    |----------------+------+------+-------------+------------------|
    |                |      |      |             |convertit de      |
    |                |      |      |             |nombreux codes    |
    |                |      |      |             |sources en        |
    |highlight       |V:1,  |1083  |mise en      |fichiers HTML,    |
    |                |I:12  |      |évidence     |XHTML, RTF, LaTeX,|
    |                |      |      |             |TeX ou XSL-FO avec|
    |                |      |      |             |mise en évidence  |
    |                |      |      |             |(C++)             |
    |----------------+------+------+-------------+------------------|
    |                |      |      |             |coloriseur        |
    |grc             |V:0,  |190   |texte→couleur|générique pour    |
    |                |I:3   |      |             |n’importe quoi    |
    |                |      |      |             |(Python)          |
    |----------------+------+------+-------------+------------------|
    |                |V:0,  |      |             |convertisseur de  |
    |txt2html        |I:3   |259   |texte→html   |texte vers HTML   |
    |                |      |      |             |(Perl)            |
    |----------------+------+------+-------------+------------------|
    |                |      |      |             |formateur de      |
    |markdown        |V:0,  |57    |texte→html   |documents textes  |
    |                |I:8   |      |             |Markdown vers (X) |
    |                |      |      |             |HTML (Perl)       |
    |----------------+------+------+-------------+------------------|
    |                |      |      |             |formateur de      |
    |asciidoc        |I:13  |81    |texte→tout   |documents textes  |
    |                |      |      |format       |AsciiDoc vers XML/|
    |                |      |      |             |HTML (Python)     |
    |----------------+------+------+-------------+------------------|
    |                |V:8,  |      |texte→tout   |Marqueur de       |
    |pandoc          |I:47  |151714|format       |conversion global |
    |                |      |      |             |(Haskell)         |
    |----------------+------+------+-------------+------------------|
    |                |      |      |             |formateur de      |
    |python-docutils |V:12, |1771  |texte→tout   |documents         |
    |                |I:133 |      |format       |ReStructured Text |
    |                |      |      |             |vers XML (Python) |
    |----------------+------+------+-------------+------------------|
    |                |      |      |             |conversion de     |
    |                |      |      |             |documents de texte|
    |                |V:0,  |      |texte→tout   |vers HTML, SGML,  |
    |txt2tags        |I:1   |342   |format       |LaTeX, page de    |
    |                |      |      |             |manuel, MoinMoin, |
    |                |      |      |             |Magic Point et    |
    |                |      |      |             |PageMaker (Python)|
    |----------------+------+------+-------------+------------------|
    |                |      |      |             |document universel|
    |udo             |V:0,  |583   |texte→tout   |- utilitaire de   |
    |                |I:0   |      |format       |traitement de     |
    |                |      |      |             |texte (language C)|
    |----------------+------+------+-------------+------------------|
    |                |      |      |             |convertisseur de  |
    |                |      |      |             |documents depuis  |
    |stx2any         |V:0,  |264   |texte→tout   |un texte brut     |
    |                |I:0   |      |format       |structuré vers    |
    |                |      |      |             |d’autres formats  |
    |                |      |      |             |(m4)              |
    |----------------+------+------+-------------+------------------|
    |                |      |      |             |convertisseur de  |
    |rest2web        |V:0,  |527   |texte→html   |documents depuis  |
    |                |I:0   |      |             |ReStructured Text |
    |                |      |      |             |vers html (Python)|
    |----------------+------+------+-------------+------------------|
    |                |      |      |             |système de        |
    |                |V:0,  |      |texte→tout   |préparation de    |
    |aft             |I:0   |235   |format       |document de       |
    |                |      |      |             |« forme libre »   |
    |                |      |      |             |(Perl)            |
    |----------------+------+------+-------------+------------------|
    |                |      |      |             |langage de        |
    |yodl            |V:0,  |610   |texte→tout   |pré-document et   |
    |                |I:0   |      |format       |outils pour le    |
    |                |      |      |             |manipuler         |
    |----------------+------+------+-------------+------------------|
    |                |V:0,  |      |texte→tout   |analyseur simple  |
    |sdf             |I:0   |1445  |format       |de documents      |
    |                |      |      |             |(Perl)            |
    |----------------+------+------+-------------+------------------|
    |                |      |      |             |infrastructure de |
    |                |V:0,  |      |texte→tout   |structuration, de |
    |sisu            |I:0   |5344  |format       |publication et de |
    |                |      |      |             |recherche de      |
    |                |      |      |             |documents (Ruby)  |
    +---------------------------------------------------------------+


%

11.2. Données XML

    Le langage de balisage extensible (« The Extensible Markup
    Language (XML) » est un langage de balisage de documents dont les
    informations sont structurées.

    Consultez une introduction sur XML.COM.

      * « Qu’est-ce qu’XML ? »

      * « Qu’est-ce qu’XSLT ? »
   
      * « Qu’est-ce qu’XSL-FO ? »

      * « Qu’est-ce qu’XLink ? »

%

11.2.1. Conseils de base pour XML

    Le texte en XML ressemble un peu à HTML. Il vous permet de gérer
    de nombreux formats de sortie pour un document. Un système XML
    facile est le paquet docbook-xsl qui est utilisé ici.

    Chaque fichier XML commence par la déclaration XML standard
    suivante :

    <?xml version="1.0" encoding="UTF-8"?>

    La syntaxe de base d’un élément XML est balisée de la manière
    suivante :

    <name attribute="value">contenu</nom>

    Un élément XML dont le contenu est vide est balisé de la façon
    raccourcie suivante :

    <name attribute="value"/>

    « attribute="value" » dans les exemples ci-dessus est optionnel.

    L’action commentaire en XML est balisée comme suit :

    <!-- comment -->

    En plus d’ajouter des balises, XML demande des conversions
    mineures de contenu en utilisant des entités prédéfinies pour les
    caractères suivants :

    Tableau 11.7. Liste des entités XML prédéfinies

    +------------------------------------------------+
    |entité prédéfinie|caractère devant être converti|
    |-----------------+------------------------------|
    |&quot;           |" : double apostrophe         |
    |-----------------+------------------------------|
    |&apos;           |' : apostrophe                |
    |-----------------+------------------------------|
    |&lt;             |< : inférieur à               |
    |-----------------+------------------------------|
    |&gt;             |> : supérieur à               |
    |-----------------+------------------------------|
    |&amp;            |& : esperluette               |
    +------------------------------------------------+


    Attention
   
    « < » ou « & » ne peuvent pas être utilisés dans des attributs ni
    des éléments.

    Note

    Lorsqu’on utilise des entités définies par l’utilisateur de style
    SGML, par exemple « &some-tag: », la première définition prend le
    pas sur les suivantes. La définition de l’entité est exprimée par
    « <!ENTITY une-balise "valeur entité">".

    Note

    Tant que le balisage XML est fait de manière cohérente avec un
    jeu particulier de nom de balises (soit certaines données comme
    valeur de contenu ou d’attribut), la conversion vers un autre XML
    est une tâche triviale en utilisant Extensible Stylesheet
    Language Transformations (XSLT).

%

11.2.2. Traitement XML

    Il existe de nombreux outils pour traiter les fichiers XML tels
    quele langage extensible de feuilles de style (« the Extensible
    Stylesheet Language XSL «).

    En gros, une fois créé un fichier XML correctement formaté, vous
    pouvez le convertir vers n’importe quel format en utilisant le
    langage extensible de transformation des feuilles de style (XSLT)
    (« Extensible Stylesheet Language Transformations  »).

    Le Langage extensible de feuilles de style pour le formatage des
    objets (XSL-FO) (« Extensible Stylesheet Language for Formatting
    Objects  » est censé être la solution au formatage. Le paquet fop
    est nouveau dans l’archive main de Debian du fait de ses
    dépendances vers le langage de programmation Java. Le code LaTeX
    est donc habituellement créé depuis XML en utilisant XSLT, et le
    système LaTeX est utilisé pour créer des fichiers imprimables
    comme DVI, PostScript et PDF.

    Tableau 11.8. Liste d’outils XML

    +---------------------------------------------------------------+
    |  paquet   |popcon|taille| mot  |         description          |
    |           |      |      | clé  |                              |
    |-----------+------+------+------+------------------------------|
    |docbook-xml|V:15, |2133  |xml   |Définition de type de document|
    |           |I:280 |      |      |XML (DTD) pour DocBook        |
    |-----------+------+------+------+------------------------------|
    |           |V:15, |      |      |processeur en ligne de        |
    |xsltproc   |I:104 |160   |xslt  |commandes XSLT (XML→ XML,     |
    |           |      |      |      |HTML, texte brut, etc.)       |
    |-----------+------+------+------+------------------------------|
    |           |      |      |      |feuilles de style XSL pour le |
    |docbook-xsl|V:13, |14870 |xml/  |traitement de DocBook XML vers|
    |           |I:165 |      |xslt  |divers formats de sortie avec |
    |           |      |      |      |XSLT                          |
    |-----------+------+------+------+------------------------------|
    |xmlto      |V:1,  |130   |xml/  |convertisseur XML-vers-tout   |
    |           |I:23  |      |xslt  |avec XSLT                     |
    |-----------+------+------+------+------------------------------|
    |dbtoepub   |V:0,  |37    |xml/  |Convertisseur Docbook XML vers|
    |           |I:0   |      |xslt  |.epub                         |
    |-----------+------+------+------+------------------------------|
    |           |V:3,  |      |xml/  |convertir les fichiers Docbook|
    |dblatex    |I:16  |4643  |xslt  |en documents DVI, PostScript, |
    |           |      |      |      |PDF avec XSLT                 |
    |-----------+------+------+------+------------------------------|
    |fop        |V:1,  |291   |xml/  |convertir les fichiers Docbook|
    |           |I:24  |      |xsl-fo|XML en PDF                    |
    +---------------------------------------------------------------+


    Comme XML est un sous-ensemble du Langage généralisé de balisage
    ( Standard Generalized Markup Language SGML »), il peut être
    traité par les nombreux outils disponibles pour SGML, comme
    Document Style Semantics and Specification Language (DSSSL).

    Tableau 11.9. Liste des outils DSSSL

    +---------------------------------------------------------------+
    |   paquet    |popcon|taille| mot |         description         |
    |             |      |      | clé |                             |
    |-------------+------+------+-----+-----------------------------|
    |             |V:2,  |      |     |processeur DSSSL à la norme  |
    |openjade     |I:38  |1019  |dsssl|ISO/IEC 10179:1996 DSSSL (le |
    |             |      |      |     |plus récent)                 |
    |-------------+------+------+-----+-----------------------------|
    |             |      |      |     |feuilles de style DSSSL pour |
    |docbook-dsssl|V:1,  |2604  |xml/ |le traitement des DocBook XML|
    |             |I:23  |      |dsssl|vers divers formats de sortie|
    |             |      |      |     |avec DSSSL                   |
    |-------------+------+------+-----+-----------------------------|
    |             |      |      |     |utilitaires pour les fichiers|
    |             |      |      |     |DocBook y compris la         |
    |docbook-utils|V:0,  |281   |xml/ |conversion avec DSSSL vers   |
    |             |I:16  |      |dsssl|d’autres formats (HTML, RTF, |
    |             |      |      |     |PS, man, PDF) avec des       |
    |             |      |      |     |commandes docbook2*          |
    |-------------+------+------+-----+-----------------------------|
    |             |V:0,  |      |SGML/|convertisseur depuis SGML et |
    |sgml2x       |I:0   |90    |dsssl|XML utilisant les feuilles de|
    |             |      |      |     |style DSSSL                  |
    +---------------------------------------------------------------+


    Astuce
   
    yelp de GNOME est parfois pratique pour lire les fichiers XML
    DocBook directement car il effectue un rendu propre sous X.

%

11.2.3. Extraire des données XML

    Vous pouvez extraire des données HTML ou XML depuis d’autres
    formats en utilisant ce qui suit :

    Tableau 11.10. Liste d’outils d’extraction de données XML

    +---------------------------------------------------------------+
    | paquet  |popcon|taille|    mot clé     |     description      |
    |---------+------+------+----------------+----------------------|
    |         |      |      |                |convertisseur de      |
    |wv       |V:0,  |717   |MSWord→n’importe|document depuis       |
    |         |I:7   |      |quoi            |Microsoft Word vers   |
    |         |      |      |                |HTML, LaTeX, etc.     |
    |---------+------+------+----------------+----------------------|
    |texi2html|V:0,  |1833  |texi→html       |convertisseur de      |
    |         |I:8   |      |                |Texinfo vers HTML     |
    |---------+------+------+----------------+----------------------|
    |         |      |      |                |convertisseur de page |
    |man2html |V:0,  |138   |manpage→html    |de manuel en HTML     |
    |         |I:2   |      |                |(prise en charge de   |
    |         |      |      |                |CGI)                  |
    |---------+------+------+----------------+----------------------|
    |         |V:0,  |      |                |convertisseur de      |
    |unrtf    |I:4   |148   |rtf→html        |documents de RTF vers |
    |         |      |      |                |HTML, etc             |
    |---------+------+------+----------------+----------------------|
    |         |      |      |                |convertisseur depuis  |
    |info2www |V:1,  |76    |info→html       |GNU info vers HTML    |
    |         |I:3   |      |                |(prise en charge de   |
    |         |      |      |                |CGI)                  |
    |---------+------+------+----------------+----------------------|
    |         |      |      |                |convertisseur de      |
    |ooo2dbk  |V:0,  |217   |sxw→xml         |documents             |
    |         |I:0   |      |                |OpenOffice.org SXW en |
    |         |      |      |                |DocBook XML           |
    |---------+------+------+----------------+----------------------|
    |         |      |      |                |fichiers WordPerfect  |
    |wp2x     |V:0,  |202   |WordPerfect→any |5.0 et 5.1 vers TeX,  |
    |         |I:0   |      |                |LaTeX, troff, GML et  |
    |         |      |      |                |HTML                  |
    |---------+------+------+----------------+----------------------|
    |doclifter|V:0,  |451   |troff→xml       |convertisseur de troff|
    |         |I:0   |      |                |vers DocBook XML      |
    +---------------------------------------------------------------+


    Vous pouvez convertir les fichiers HTML non-XML en XHTML qui est
    une instance XML correctement formatée. XHTML peut être traité
    par les outils XML.

    Tableau 11.11. Liste d’outils d’impression élégante du XML

    +---------------------------------------------------------------+
    |   paquet    |popcon|taille|   mot clé    |    description     |
    |-------------+------+------+--------------+--------------------|
    |             |      |      |              |outil XML en ligne  |
    |             |      |      |              |de commandes xmllint|
    |libxml2-utils|V:22, |182   |xml↔html↔xhtml|(1) (vérification de|
    |             |I:246 |      |              |la syntaxe,         |
    |             |      |      |              |reformatage,        |
    |             |      |      |              |décomposition…)     |
    |-------------+------+------+--------------+--------------------|
    |             |V:2,  |      |              |vérificateur de     |
    |tidy         |I:14  |84    |xml↔html↔xhtml|syntaxe et          |
    |             |      |      |              |reformateur HTML    |
    +---------------------------------------------------------------+


    Une fois qu’un fichier XML propre est créé, vous pouvez utiliser
    la technologie XSLT pour extraire des données dans le contexte de
    balisage, etc.

%

11.3. Composition

    Le programme UNIX troff, développé à l’origine par AT&T, peut
    être utilisé pour une composition simple. Il est habituellement
    utilisé pour créer des pages de manuel.

    TeX, créé par Donald Knuth, est un outil très puissant de
    composition et c’est le standard de fait. LaTeX, écrit à
    l’origine par Leslie Lamport permet un accès de haut niveau à la
    puissance de TeX.

    Tableau 11.12. Liste des outils de typographie

    +---------------------------------------------------------------+
    |paquet |popcon|taille| mot |            description            |
    |       |      |      | clé |                                   |
    |-------+------+------+-----+-----------------------------------|
    |texlive|V:3,  |71    |(La) |système TeX pour la composition,   |
    |       |I:50  |      |TeX  |l’aperçu et l’impression           |
    |-------+------+------+-----+-----------------------------------|
    |groff  |V:3,  |11838 |troff|système de formatage de texte GNU  |
    |       |I:64  |      |     |troff                              |
    +---------------------------------------------------------------+


%

11.3.1. Composition roff

    Traditionnellement, roff est le système de traitement de texte
    principal sous UNIX. Consultez roff(7), groff(7), groff(1), 
    grotty(1), troff(1), groff_mdoc(7), groff_man(7), groff_ms(7), 
    groff_me(7), groff_mm(7), et « info groff ».

    Vous pouvez lire ou imprimer un bon didacticiel et document de
    référence sur la macro « -me » dans « /usr/share/doc/groff/ » en
    installant le paquet groff.

    Astuce

    « groff -Tascii -me - » produit une sortie en texte brut avec du
    code d’échappement ANSI. Si vous désirez obtenir une sortie
    semblable à une page de manuel avec de nombreux « ^H » et « _ »,
    utilisez plutôt « GROFF_NO_SGR=1 groff -Tascii -me - ».

    Astuce
   
    Pour supprimer les « ^H » et les « _ » d’un fichier texte issu de
    groff, filtrez le par « col -b -x ».

%

11.3.2. TeX/LaTeX

    La distribution logicielle TeX Live offre un système TeX complet.
    Le métapaquet texlive fournit une bonne sélection de paquets de
    TeX Live qui devraient suffire aux tâches les plus courantes.

    De nombreuses références sont disponibles pour TeX et LaTeX :

      * The teTeX HOWTO : le guide local de teTeX sous Linux ;

      * tex(1) ;

      * latex(1) ;

      * texdoc(1) ;

      * texdoctk(1) ;

      * « The TeXbook », par Donald E. Knuth, (Addison-Wesley) ;

      * « LaTeX - A Document Preparation System », par Leslie
        Lamport, (Addison-Wesley) ;

      * « The LaTeX Companion », par Goossens, Mittelbach, Samarin,
        (Addison-Wesley).

    C’est l’environnement de composition typographique le plus
    puissant. De nombreux processeurs SGML l’utilisent comme
    processeur de texte en « backend ». Lyx qu’on trouvera dans le
    paquet lyx et GNU TeXmacs qui provient du paquet texmacs offrent
    un environnement d’édition agréable en mode WYSIWYG pour LaTeX
    bien que nombreux sont ceux qui choisissent d’utiliser Emacs et
    Vim pour éditer les sources.

    De nombreuses ressources sont disponibles en ligne :

      * The TEX Live Guide - TEX Live 2007 ( /usr/share/doc/
        texlive-doc-base/english/texlive-en/live.html ») (paquet
        texlive-doc-base) ;

      * Un guide simple pour Latex et Lyx (« A Simple Guide to Latex/
        Lyx »)

      * Traitement de texte avec LaTeX (« Word Processing Using
        LaTeX »)

      * Guide local de l’utilisateur de teTeX et LaTeX (« Local User
        Guide to teTeX/LaTeX »)

    Lorsque les documents deviennent plus importants, TeX cause
    parfois des erreurs. Vous devez augmenter la taille de l’espace
    dans « /etc/texmf/texmf.cnf » (ou, de manière plus rigoureuse,
    éditez « /etc/texmf/texmf.d/95NonPath » et lancez update-texmf(8)
    ) afin de corriger cela.

    Note

    Les sources au format TeX de « The TeXbook » sont disponibles à
    l'adresse http://tug.ctan.org/tex-archive/systems/knuth/dist/tex/
    texbook.tex. Ce fichier contient la plupart des macros
    nécessaires. J’ai entendu dire que vous pouvez traiter ce
    document avec tex(1) après avoir commenté les lignes 7 à 10 et
    ajouté « \input manmac \proofmodefalse ». Je recommande vivement
    l’achat de ce livre (et de tous les autres livres de Donald E.
    Knuth) plutôt que d’utiliser la version en ligne mais la version
    source est un très bon exemple d’utilisation de TeX !

%

11.3.3. Imprimer convenablement une page de manuel

    Vous pouvez imprimer convenablement une page de manuel en
    PostScript en utilisant l’une des commandes suivantes :

    $ man -Tps une_page_de_manuel  lpr

%

11.3.4. Créer une page de manuel

    Bien que l’écriture d’une page de manuel (manpage) dans le format
    troff brut soit possible, il existe quelques paquets facilitant
    cette tâche :

    Tableau 11.13. Liste de paquets facilitant la création de pages
    de manuel

    +---------------------------------------------------------------+
    |    paquet    |popcon|taille|  mot clé   |     description     |
    |--------------+------+------+------------+---------------------|
    |              |V:0,  |      |            |macros de conversion |
    |docbook-to-man|I:13  |191   |SGML→manpage|de DocBook SGML vers |
    |              |      |      |            |roff man             |
    |--------------+------+------+------------+---------------------|
    |              |      |      |            |générateur           |
    |help2man      |V:0,  |498   |text→manpage|automatique d’une    |
    |              |I:10  |      |            |pages de manuel      |
    |              |      |      |            |depuis --help        |
    |--------------+------+------+------------+---------------------|
    |              |V:0,  |      |            |convertisseur depuis |
    |info2man      |I:0   |134   |info→manpage|GNU info vers POD ou |
    |              |      |      |            |page de manuel       |
    |--------------+------+------+------------+---------------------|
    |              |V:0,  |      |            |convertir du texte   |
    |txt2man       |I:1   |114   |text→manpage|brut ASCII au format |
    |              |      |      |            |d’une page de manuel |
    +---------------------------------------------------------------+


%

11.4. Données imprimables

    Sur un système Debian, les données imprimables sont définies dans
    le format PostScript. Common UNIX Printing System (CUPS) utilise
    Ghostscript en tant que programme de tramage « rasterisation »
    pour les imprimantes non-PostScript.

%

11.4.1. Ghostscript

    Le cœur de la manipulation des données imprimables est
    l’interpréteur Ghostscript PostScript (PS) qui génère une image
    tramée (« raster image »).

    La licence de la dernière version amont de Ghostscript par
    Artifex a été modifiée d’AFPL vers GPL et fusionnée avec les
    dernières modifications de version d’ESP telles que celles
    relatives à CUPS version 8.60 sous forme d’une version unifiée.

    Tableau 11.14. Liste des interpréteurs Ghostscript PostScript

    +---------------------------------------------------------------+
    |     paquet     |popcon|taille|          description           |
    |----------------+------+------+--------------------------------|
    |ghostscript     |V:252,|231   |L’interpréteur GPLGhostscript   |
    |                |I:598 |      |PostScript/PDF                  |
    |----------------+------+------+--------------------------------|
    |                |V:15, |      |interpréteur GPL Ghostscript    |
    |ghostscript-x   |I:65  |223   |PostScript/PDF - prise en charge|
    |                |      |      |de l’affichage X                |
    |----------------+------+------+--------------------------------|
    |                |      |      |bibliothèque de rendu PDF       |
    |libpoppler95    |I:3   |4172  |dérivée du visualisateur PDF    |
    |                |      |      |xpdf                            |
    |----------------+------+------+--------------------------------|
    |                |V:217,|      |bibliothèque de rendu PDF       |
    |libpoppler-glib8|I:481 |449   |(bibliothèque partagée basée sur|
    |                |      |      |GLib)                           |
    |----------------+------+------+--------------------------------|
    |                |V:111,|      |CMaps pour PDF la bibliothèque  |
    |poppler-data    |I:637 |13090 |de rendu (pour la prise en      |
    |                |      |      |charge de CJK : Adobe-*)        |
    +---------------------------------------------------------------+


    Astuce
   
    « gs -h » permet d’afficher la configuration de Ghostscript.

%

11.4.2. Fusionner deux fichiers PS ou PDF

    Vous pouvez fusionner deux fichiers PostScript (PS) ou Portable
    Document Format (PDF) en utilisant gs(1) de Ghostscript.

    $ gs -q -dNOPAUSE -dBATCH -sDEVICE=pswrite -sFichierSortie=blabla.ps -f toto1.ps toto2.ps
    $ gs -q -dNOPAUSE -dBATCH -sDEVICE=pdfwrite -sFichierSortie=blabla.pdf -f toto1.pdf toto2.pdf

    Note

    Le format PDF qui est un format imprimable multi-plateformes
    largement utilisé, est essentiellement un format PS compressé
    avec quelques fonctionnalités et extensions supplémentaires .

    Astuce

    For command line, psmerge(1) and other commands from the psutils
    package are useful for manipulating PostScript documents. pdftk
    (1) from the pdftk package is useful for manipulating PDF
    documents, too.

%

11.4.3. Utilitaires pour les données imprimables

    Les paquets suivants fournissant des utilitaires pour les données
    imprimables ont attiré mon attention :

    Tableau 11.15. Liste des utilitaires pour les données imprimables

    +---------------------------------------------------------------+
    |   paquet    |popcon|taille|   mot clé   |     description     |
    |-------------+------+------+-------------+---------------------|
    |             |      |      |             |utilitaires PDF ::   |
    |poppler-utils|V:241,|689   |pdf→ps,text,…|pdftops, pdfinfo,    |
    |             |I:434 |      |             |pdfimages, pdftotext,|
    |             |      |      |             |pdffonts             |
    |-------------+------+------+-------------+---------------------|
    |             |V:6,  |      |             |outils de conversion |
    |psutils      |I:105 |219   |ps→ps        |de document          |
    |             |      |      |             |PostScript           |
    |-------------+------+------+-------------+---------------------|
    |             |      |      |             |créer des posters de |
    |poster       |V:0,  |58    |ps→ps        |grande dimension à   |
    |             |I:5   |      |             |partir de pages      |
    |             |      |      |             |PostScript           |
    |-------------+------+------+-------------+---------------------|
    |             |      |      |             |convertir du text    |
    |enscript     |V:1,  |2132  |text→ps,     |ASCII en PostScript, |
    |             |I:20  |      |html, rtf    |HTML, RTF ou         |
    |             |      |      |             |Pretty-Print         |
    |-------------+------+------+-------------+---------------------|
    |             |      |      |             |Convertisseur de     |
    |a2ps         |V:1,  |3651  |text→ps      |« N’importe quoi vers|
    |             |I:15  |      |             |PostScript » et      |
    |             |      |      |             |imprimeur élégant    |
    |-------------+------+------+-------------+---------------------|
    |             |      |      |             |outil de conversion  |
    |pdftk        |I:51  |28    |pdf→pdf      |de documents PDF :   |
    |             |      |      |             |pdftk                |
    |-------------+------+------+-------------+---------------------|
    |html2ps      |V:0,  |249   |html→ps      |convertisseur de HTML|
    |             |I:3   |      |             |vers PostScript      |
    |-------------+------+------+-------------+---------------------|
    |gnuhtml2latex|V:0,  |27    |html→latex   |convertisseur de html|
    |             |I:1   |      |             |vers latex           |
    |-------------+------+------+-------------+---------------------|
    |             |      |      |             |convertir des        |
    |latex2rtf    |V:0,  |480   |latex→rtf    |documents de LaTeX en|
    |             |I:6   |      |             |RTF qui peuvent être |
    |             |      |      |             |lus par MS Word      |
    |-------------+------+------+-------------+---------------------|
    |             |      |      |             |convertisseur de     |
    |ps2eps       |V:3,  |98    |ps→eps       |PostScript vers EPS  |
    |             |I:68  |      |             |(PostScript          |
    |             |      |      |             |encapsulé)           |
    |-------------+------+------+-------------+---------------------|
    |             |      |      |             |convertisseur de     |
    |             |V:0,  |      |             |texte vers PostScript|
    |e2ps         |I:0   |109   |text→ps      |avec la prise en     |
    |             |      |      |             |charge du codage     |
    |             |      |      |             |japonais             |
    |-------------+------+------+-------------+---------------------|
    |impose+      |V:0,  |119   |ps→ps        |Utilitaires          |
    |             |I:0   |      |             |PostScript           |
    |-------------+------+------+-------------+---------------------|
    |             |      |      |             |imprime élégamment de|
    |             |      |      |             |nombreux codes source|
    |             |V:0,  |      |             |(C, C++, Java,       |
    |trueprint    |I:0   |146   |text→ps      |Pascal, Perl, Pike,  |
    |             |      |      |             |Sh, et Verilog) vers |
    |             |      |      |             |PostScript. (langage |
    |             |      |      |             |C)                   |
    |-------------+------+------+-------------+---------------------|
    |             |      |      |             |convertisseur de PDF |
    |pdf2svg      |V:0,  |30    |ps→svg       |vers le format       |
    |             |I:4   |      |             |Scalable vector      |
    |             |      |      |             |graphics (« SVG »)   |
    |-------------+------+------+-------------+---------------------|
    |             |V:0,  |      |             |convertisseur de PDF |
    |pdftoipe     |I:0   |71    |ps→ipe       |vers le format IPE   |
    |             |      |      |             |d’XML                |
    +---------------------------------------------------------------+


%

11.4.4. Imprimer avec CUPS

    Les commandes lp(1) et lpr(1) proposées par le Common UNIX
    Printing System (CUPS) fournissent toutes deux des options de
    personnalisation des données imprimables.

    Vous pouvez imprimer 3 copies d’un fichier en utilisant une des
    commandes suivantes :

    $ lp -n 3 -o Collate=True NomFichier

    $ lpr -#3 -o Collate=True NomFichier

    Vous pouvez personnaliser davantage le fonctionnement de
    l’imprimante en utilisant des options d’impression telles que
    « -o number-up=2 », « -o page-set=even », « -o page-set=odd »,
    « -o scaling=200 », « -o natural-scaling=200 », etc., documentées
    sur Impression et options en ligne de commande.

%

11.5. La conversion de données de courrier électronique

    Les paquets suivants, destinés à la conversion de données de
    courrier électronique, ont attiré mon attention :

    Tableau 11.16. Liste de paquets facilitant la conversion de
    données de courrier électronique

    +---------------------------------------------------------------+
    | paquet  |popcon|taille|mot clé|          description          |
    |---------+------+------+-------+-------------------------------|
    |sharutils|V:4,  |1421  |mail   |shar(1), unshar(1), uuencode(1)|
    |         |I:55  |      |       |, uudecode(1)                  |
    |---------+------+------+-------+-------------------------------|
    |mpack    |V:1,  |106   |MIME   |encoder et décoder des messages|
    |         |I:18  |      |       |MIME : mpack(1) et munpack(1)  |
    |---------+------+------+-------+-------------------------------|
    |         |      |      |       |dépaqueter des attachements    |
    |tnef     |V:1,  |110   |ms-tnef|MIME de type « application/    |
    |         |I:10  |      |       |ms-tnef » qui est un format    |
    |         |      |      |       |propre à Microsoft             |
    |---------+------+------+-------+-------------------------------|
    |         |      |      |       |encodeur et décodeur pour les  |
    |uudeview |V:0,  |109   |mail   |formats suivants : uuencode,   |
    |         |I:5   |      |       |xxencode, BASE64, quoted       |
    |         |      |      |       |printable et BinHex            |
    +---------------------------------------------------------------+


    Astuce

    Le serveur de protocole Internet d’accès au messages
    (« d’Internet Message Access Protocol ») version 4 (IMAP4)
    (consultez Section 6.7, « serveur POP3/IMAP4 ») peut être utilisé
    pour déplacer des courriels depuis des systèmes de courriels
    propriétaires si le logiciel de courriel client peut aussi être
    configuré pour utiliser le serveur IMAP4.

%

11.5.1. Bases concernant les données de courrier électronique

    Les données (SMTP) de courrier électronique doivent être limitées
    à des séries de données de 7 bits. Les données binaires et les
    données textuelles sur 8 bits sont codées dans un format sur
    7 bits avec Multipurpose Internet Mail Extensions (MIME) et la
    sélection du jeu de caractères (consultez Section 8.4.1, « Bases
    du codage »).

    Le format standard d’enregistrement du courrier électronique est
    « mbox » selon la RFC2822 (RFC822 mise à jour). Consultez mbox(5)
    (fourni par le paquet mutt.

    Pour les langues européennes, on utilise habituellement pour le
    courriel « Content-Transfer-Encoding: quoted-printable » avec le
    jeu de caractères ISO-8859-1 car il n’y a pas beaucoup de
    caractères de 8 bits. Si le texte européen est codé en UTF-8, on
    préférera utiliser « Content-Transfer-Encoding:
    quoted-printable » car ce sont essentiellement des données sur 7
    bits.

    Pour le japonais, « Content-Type: text/plain; charset=
    ISO-2022-JP » est habituellement utilisé pour le courriel afin de
    conserver le texte sur 7 bits. Mais les anciens systèmes
    Microsoft peuvent envoyer des données de courriel en Shift-JIS
    sans le déclarer proprement. Si le texte japonais est codé en
    UTF-8, on utilisera de préférence Base64 car il comporte de
    nombreuses données sur 8 bits. La situation des autres langues
    asiatiques est similaire.

    Note

    Pour les données de courriel non-UNIX accessibles par un logiciel
    client ne venant pas de Debian, il est possible de dialoguer avec
    le serveur IMAP4, il vous faudra peut-être les déplacer en
    lançant votre propre serveur IMAP4 (consultez Section 6.7,
    « serveur POP3/IMAP4 »).

    Note

    Si vous utilisez d’autres formats d’enregistrement de courriel,
    les mettre dans le format mbox est une bonne première étape. Un
    programme client souple comme mutt(1) peut être pratique pour le
    faire.

    Vous pouvez éclater le contenu d’une boîte à lettre en messages
    séparés en utilisant procmail(1) et formail(1).

    Chaque message de courrier électronique peut être dépaqueté en
    utilisant munpack(1) qui provient du paquet mpack (ou d’autres
    outils spécialisés) afin d’en obtenir le contenu codé en MIME.

%

11.6. Outils de données graphiques

    Les paquets suivants contenant des outils pour la conversion,
    l’édition et l’organisation de données graphiques ont attiré mon
    attention :

    Tableau 11.17. Liste d’outils pour les données graphiques

    +-------------------------------------------------------------------------+
    |         paquet         |popcon|taille|     mot clé     |  description   |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |Programme de    |
    |                        |      |      |                 |manipulation    |
    |gimp                    |V:68, |22313 |image (bitmap)   |d’images GNU    |
    |                        |I:341 |      |                 |( GNU Image     |
    |                        |      |      |                 |Manipulation    |
    |                        |      |      |                 |Program »)      |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |programmes de   |
    |imagemagick             |I:400 |218   |image (bitmap)   |manipulation    |
    |                        |      |      |                 |d’images        |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |programmes de   |
    |                        |V:3,  |      |                 |manipulation    |
    |graphicsmagick          |I:17  |5224  |image (bitmap)   |d’images        |
    |                        |      |      |                 |(dérivés        |
    |                        |      |      |                 |d’imagemagick)  |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |Interface       |
    |                        |V:17, |      |                 |graphique X11 de|
    |xsane                   |I:173 |2346  |image (bitmap)   |SANE basée sur  |
    |                        |      |      |                 |GTK+ (Scanner   |
    |                        |      |      |                 |Access Now Easy)|
    |------------------------+------+------+-----------------+----------------|
    |                        |V:32, |      |                 |outils de       |
    |netpbm                  |I:409 |4302  |image (bitmap)   |conversion      |
    |                        |      |      |                 |graphique       |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |convertit les   |
    |                        |      |      |                 |icônes et       |
    |                        |V:21, |      |                 |curseurs de MS  |
    |icoutils                |I:127 |221   |png↔ico (bitmap) |Windows de et   |
    |                        |      |      |                 |vers des formats|
    |                        |      |      |                 |PNG             |
    |                        |      |      |                 |(favicon.ico)   |
    |------------------------+------+------+-----------------+----------------|
    |scribus                 |V:2,  |30375 |ps/pdf/SVG/…     |éditeur DTP     |
    |                        |I:23  |      |                 |Scribus         |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |suite de        |
    |libreoffice-draw        |V:177,|14600 |image            |bureautique     |
    |                        |I:434 |      |(vectorielle)    |LibreOffice -   |
    |                        |      |      |                 |dessin          |
    |------------------------+------+------+-----------------+----------------|
    |                        |V:55, |      |image            |éditeur SVG     |
    |inkscape                |I:209 |84823 |(vectorielle)    |(Scalable Vector|
    |                        |      |      |                 |Graphics)       |
    |------------------------+------+------+-----------------+----------------|
    |dia                     |V:5,  |3727  |image            |éditeur de      |
    |                        |I:31  |      |(vectorielle)    |diagrammes (Gtk)|
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |Outil de        |
    |xfig                    |V:2,  |1793  |image            |génération      |
    |                        |I:15  |      |(vectorielle)    |interactive de  |
    |                        |      |      |                 |figures sous X11|
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |convertisseur de|
    |                        |      |      |                 |fichiers        |
    |                        |V:4,  |      |ps/pdf→image     |PostScript et   |
    |pstoedit                |I:98  |988   |(vectorielle)    |PDF en          |
    |                        |      |      |                 |graphiques      |
    |                        |      |      |                 |vectoriels      |
    |                        |      |      |                 |éditables (SVG) |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |outils de       |
    |                        |      |      |                 |conversion de   |
    |libwmf-bin              |V:10, |113   |Windows/image    |métafichiers    |
    |                        |I:211 |      |(vectorielle)    |Windows (données|
    |                        |      |      |                 |graphiques      |
    |                        |      |      |                 |vectorielles)   |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |conversion de   |
    |                        |V:0,  |      |fig→sxd          |fichiers XFig   |
    |fig2sxd                 |I:0   |149   |(vectorielle)    |dans le format  |
    |                        |      |      |                 |OpenOffice.org  |
    |                        |      |      |                 |Draw            |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |outil de        |
    |                        |V:2,  |      |                 |post-traitement |
    |unpaper                 |I:19  |460   |image→image      |pour des pages  |
    |                        |      |      |                 |numérisées pour |
    |                        |      |      |                 |OCR             |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |logiciel OCR    |
    |                        |V:8,  |      |                 |libre basé sur  |
    |tesseract-ocr           |I:37  |1500  |image→texte      |le moteur       |
    |                        |      |      |                 |commercial OCR  |
    |                        |      |      |                 |de HP           |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |moteur de       |
    |                        |      |      |                 |données OCR :   |
    |                        |V:7,  |      |                 |fichier de      |
    |tesseract-ocr-eng       |I:37  |4032  |image→texte      |langue de       |
    |                        |      |      |                 |tesseract-ocr   |
    |                        |      |      |                 |pour le texte en|
    |                        |      |      |                 |anglais         |
    |------------------------+------+------+-----------------+----------------|
    |gocr                    |V:1,  |531   |image→texte      |logiciel OCR    |
    |                        |I:13  |      |                 |libre           |
    |------------------------+------+------+-----------------+----------------|
    |ocrad                   |V:0,  |303   |image→texte      |logiciel OCR    |
    |                        |I:5   |      |                 |libre           |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |Programme de    |
    |                        |V:71, |      |                 |visualisation   |
    |eog                     |I:264 |10189 |image (Exif)     |d’images « Eye  |
    |                        |      |      |                 |of Gnome »      |
    |                        |      |      |                 |(l’œil de Gnome)|
    |------------------------+------+------+-----------------+----------------|
    |                        |V:5,  |      |                 |visionneuse et  |
    |gthumb                  |I:22  |5475  |image (Exif)     |gestionnaire de |
    |                        |      |      |                 |photos (GNOME)  |
    |------------------------+------+------+-----------------+----------------|
    |                        |V:6,  |      |                 |Visualiseur     |
    |geeqie                  |I:21  |14643 |image (Exif)     |d’images        |
    |                        |      |      |                 |utilisant GTK+  |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |gestionnaire de |
    |shotwell                |V:19, |6451  |image (Exif)     |photos          |
    |                        |I:223 |      |                 |numériques      |
    |                        |      |      |                 |(GNOME)         |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |Application     |
    |                        |      |      |                 |destinée à      |
    |                        |      |      |                 |rapatrier des   |
    |                        |V:0,  |      |                 |données         |
    |gtkam                   |I:6   |1154  |image (Exif)     |numériques      |
    |                        |      |      |                 |depuis les      |
    |                        |      |      |                 |appareils photo |
    |                        |      |      |                 |numériques      |
    |                        |      |      |                 |(GTK+)          |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |Le client en    |
    |                        |      |      |                 |ligne de        |
    |gphoto2                 |V:1,  |955   |image (Exif)     |commande pour   |
    |                        |I:12  |      |                 |appareil photo  |
    |                        |      |      |                 |numérique       |
    |                        |      |      |                 |gphoto2         |
    |------------------------+------+------+-----------------+----------------|
    |gwenview                |V:28, |10570 |image (Exif)     |visionneuse     |
    |                        |I:97  |      |                 |d’images (KDE)  |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |gestion des     |
    |                        |      |      |                 |appareils photo |
    |kamera                  |I:97  |798   |image (Exif)     |numériques dans |
    |                        |      |      |                 |les applications|
    |                        |      |      |                 |KDE             |
    |------------------------+------+------+-----------------+----------------|
    |                        |V:2,  |      |                 |application de  |
    |digikam                 |I:13  |2646  |image (Exif)     |gestion photos  |
    |                        |      |      |                 |numériques (KDE)|
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |Outil pour      |
    |exiv2                   |V:3,  |321   |image (Exif)     |manipuler les   |
    |                        |I:44  |      |                 |méta-données    |
    |                        |      |      |                 |EXIF/IPTC       |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |transformer les |
    |exiftran                |V:1,  |70    |image (Exif)     |images JPEG des |
    |                        |I:21  |      |                 |appareils photo |
    |                        |      |      |                 |numériques      |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |manipuler la    |
    |                        |      |      |                 |partie non      |
    |                        |      |      |                 |graphique des   |
    |jhead                   |V:1,  |109   |image (Exif)     |fichiers JPEG   |
    |                        |I:11  |      |                 |compatibles avec|
    |                        |      |      |                 |Exif (appareils |
    |                        |      |      |                 |photo           |
    |                        |      |      |                 |numériques)     |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |utilitaire en   |
    |                        |      |      |                 |ligne de        |
    |                        |      |      |                 |commandes pour  |
    |exif                    |V:1,  |339   |image (Exif)     |afficher les    |
    |                        |I:12  |      |                 |informations    |
    |                        |      |      |                 |EXIF contenues  |
    |                        |      |      |                 |dans les        |
    |                        |      |      |                 |fichiers JPEG   |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |utilitaire pour |
    |                        |      |      |                 |lire les balises|
    |exiftags                |V:0,  |292   |image (Exif)     |Exif depuis un  |
    |                        |I:5   |      |                 |fichier JPEG    |
    |                        |      |      |                 |d’appareil photo|
    |                        |      |      |                 |numérique       |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |lire les        |
    |exifprobe               |V:0,  |499   |image (Exif)     |métadonnées des |
    |                        |I:4   |      |                 |images          |
    |                        |      |      |                 |numériques      |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |décoder les     |
    |                        |V:2,  |      |                 |images brutes   |
    |dcraw                   |I:19  |535   |image (Raw)→ppm  |(« raw ») des   |
    |                        |      |      |                 |appareils photo |
    |                        |      |      |                 |numériques      |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |rechercher des  |
    |                        |V:0,  |      |                 |images          |
    |findimagedupes          |I:1   |79    |image→fingerprint|visuellement    |
    |                        |      |      |                 |similaires ou   |
    |                        |      |      |                 |dupliquées      |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |assembler des   |
    |                        |      |      |                 |images pour en  |
    |ale                     |V:0,  |839   |image→image      |améliorer la    |
    |                        |I:0   |      |                 |fidélité ou     |
    |                        |      |      |                 |créer des       |
    |                        |      |      |                 |mosaïques       |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |créer des       |
    |imageindex              |V:0,  |145   |image (Exif)→html|galeries HTML   |
    |                        |I:2   |      |                 |statiques depuis|
    |                        |      |      |                 |des images      |
    |------------------------+------+------+-----------------+----------------|
    |outguess                |V:0,  |261   |jpeg,png         |outil universel |
    |                        |I:2   |      |                 |Stéganographique|
    |------------------------+------+------+-----------------+----------------|
    |                        |V:4,  |      |                 |éditeur de      |
    |librecad                |I:18  |8205  |DXF              |données de CAO  |
    |                        |      |      |                 |(KDE)           |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |éditeur de      |
    |blender                 |V:4,  |79166 |blend, TIFF,     |contenu 3D pour |
    |                        |I:38  |      |VRML, …          |l’animation,    |
    |                        |      |      |                 |etc.            |
    |------------------------+------+------+-----------------+----------------|
    |                        |V:0,  |      |                 |Éditeur de      |
    |mm3d                    |I:0   |3778  |ms3d, obj, dxf, …|modèles 3D basé |
    |                        |      |      |                 |sur OpenGL      |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |métapaquet pour |
    |open-font-design-toolkit|I:0   |10    |ttf, ps, …       |la conception de|
    |                        |      |      |                 |polices libres  |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |éditeur pour les|
    |fontforge               |V:0,  |4191  |ttf, ps, …       |polices PS,     |
    |                        |I:8   |      |                 |TrueType et     |
    |                        |      |      |                 |OpenType        |
    |------------------------+------+------+-----------------+----------------|
    |                        |      |      |                 |programme pour  |
    |                        |      |      |                 |l’ajustement à  |
    |xgridfit                |V:0,  |806   |ttf              |la grille et    |
    |                        |I:0   |      |                 |l'optimisation  |
    |                        |      |      |                 |de rendu des    |
    |                        |      |      |                 |polices TrueType|
    +-------------------------------------------------------------------------+


    Astuce

    Recherchez d’autres outils pour les images en utilisant
    l’expression rationnelle « ~Gworks-with::image » dans aptitude(8)
    (consultez Section 2.2.6, « Options de la méthode de recherche
    avec aptitude »).

    Bien que des programmes ayant une interface graphique comme gimp
    (1) soient très puissants, des outils en ligne de commandes comme
    imagemagick(1) sont assez utiles pour la manipulation automatique
    d’images au moyen de scripts.

    Le format standard de fait pour les images d’appareils photo
    numériques est Exchangeable Image File Format (EXIF) qui est
    composé d’une image au format JPEG à laquelle sont ajoutées des
    balises de métadonnées. Il peut contenir des informations telles
    que la date, l’heure ou les paramètres de l’appareil photo.

    Le brevet de compression de données sans perte Lempel-Ziv-Welch
    (LZW) est arrivé en fin de validité. Les utilitaires du format
    Graphics Interchange Format (GIF) qui utilise la méthode de
    compression LZW peuvent être maintenant librement disponibles sur
    un système Debian.

    Astuce

    Tous les appareils photo numériques ou les scanners ayant un
    support d’enregistrement amovible fonctionnent sous Linux avec
    des lecteurs « USB storage » s’ils sont conformes à la Design
    rule for Camera Filesystem et utilisent un système de fichiers
    FAT. Consultez Section 10.1.7, « Périphériques d’enregistrement
    amovibles ».

%

11.7. Diverses conversions de données

    Il y a de nombreux programmes pour convertir les données. Les
    paquets suivants ont attiré mon attention en utilisant
    l’expression rationnelle « ~Guse::converting » avec aptitude(8)
    (consultez Section 2.2.6, « Options de la méthode de recherche
    avec aptitude »).

    Tableau 11.18. Liste d’outils divers de conversion de données

    +---------------------------------------------------------------+
    | paquet  |popcon|taille| mot clé |         description         |
    |---------+------+------+---------+-----------------------------|
    |         |V:2,  |      |rpm/     |convertisseur de paquets     |
    |alien    |I:34  |161   |tgz→deb  |étrangers vers des paquets   |
    |         |      |      |         |Debian                       |
    |---------+------+------+---------+-----------------------------|
    |         |      |      |         |convertisseur de « Electric  |
    |         |V:0,  |      |         |Book » (Livre électronique - |
    |freepwing|I:0   |421   |EB→EPWING|populaire au Japon) en un    |
    |         |      |      |         |simple format JIS X 4081 (un |
    |         |      |      |         |sous-ensemble de EPWING V1)  |
    |---------+------+------+---------+-----------------------------|
    |         |V:9,  |      |         |Convertisseur de livre       |
    |calibre  |I:36  |54876 |tout→EPUB|numérique et gestion de      |
    |         |      |      |         |bibliothèque.                |
    +---------------------------------------------------------------+


    Vous pouvez aussi extraire des données depuis le format RPM avec
    ce qui suit :

    $ rpm2cpio fichier.src.rpm | cpio --extract

Chapitre 12. Programmation

    Je donne quelques indications pour apprendre à programmer sous le
    système Debian, suffisantes pour suivre le code source mis en
    paquets. Voici les paquets importants correspondant aux paquets
    de documentation pour la programmation .

    Tableau 12.1. Liste de paquets pour aider à la programmation

    +---------------------------------------------------------------+
    |    paquet     |popcon|taille|          documentation          |
    |---------------+------+------+---------------------------------|
    |autoconf       |V:41, |1846  |« info autoconf » fourni par     |
    |               |I:282 |      |autoconf-doc                     |
    |---------------+------+------+---------------------------------|
    |automake       |V:42, |1830  |« info automake » fourni par     |
    |               |I:279 |      |automake1.10-doc                 |
    |---------------+------+------+---------------------------------|
    |bash           |V:791,|6469  |« info bash » fourni par bash-doc|
    |               |I:999 |      |                                 |
    |---------------+------+------+---------------------------------|
    |bison          |V:9,  |2815  |« info bison » fourni par        |
    |               |I:103 |      |bison-doc                        |
    |---------------+------+------+---------------------------------|
    |cpp            |V:319,|42    |« info cpp » fourni par cpp-doc  |
    |               |I:770 |      |                                 |
    |---------------+------+------+---------------------------------|
    |ddd            |V:0,  |4184  |« info ddd » fourni par ddd-doc  |
    |               |I:10  |      |                                 |
    |---------------+------+------+---------------------------------|
    |exuberant-ctags|V:5,  |341   |exuberant-ctags(1)               |
    |               |I:37  |      |                                 |
    |---------------+------+------+---------------------------------|
    |flex           |V:9,  |1279  |« info flex » fourni par flex-doc|
    |               |I:93  |      |                                 |
    |---------------+------+------+---------------------------------|
    |gawk           |V:368,|2558  |« info gawk » fourni par gawk-doc|
    |               |I:454 |      |                                 |
    |---------------+------+------+---------------------------------|
    |gcc            |V:165,|45    |« info gcc » fourni par gcc-doc  |
    |               |I:604 |      |                                 |
    |---------------+------+------+---------------------------------|
    |gdb            |V:13, |9789  |« info gdb » fourni par gdb-doc  |
    |               |I:114 |      |                                 |
    |---------------+------+------+---------------------------------|
    |gettext        |V:48, |5843  |« info gettext » fourni par      |
    |               |I:312 |      |gettext-doc                      |
    |---------------+------+------+---------------------------------|
    |gfortran       |V:11, |16    |« info gfortran » fourni par     |
    |               |I:98  |      |gfortran-doc (Fortran 95)        |
    |---------------+------+------+---------------------------------|
    |fpc            |I:3   |121   |fpc(1) et les pages html fournies|
    |               |      |      |par fp-doc (Pascal)              |
    |---------------+------+------+---------------------------------|
    |glade          |V:0,  |1730  |l’aide fournie par le menu (UI   |
    |               |I:8   |      |Builder)                         |
    |---------------+------+------+---------------------------------|
    |libc6          |V:935,|12771 |« info libc » fourni par         |
    |               |I:999 |      |glibc-doc et glibc-doc-reference |
    |---------------+------+------+---------------------------------|
    |make           |V:157,|1592  |« info make » fourni par make-doc|
    |               |I:609 |      |                                 |
    |---------------+------+------+---------------------------------|
    |xutils-dev     |V:1,  |1466  |imake(1), xmkmf(1), etc.         |
    |               |I:12  |      |                                 |
    |---------------+------+------+---------------------------------|
    |mawk           |V:372,|242   |mawk(1)                          |
    |               |I:997 |      |                                 |
    |---------------+------+------+---------------------------------|
    |               |V:610,|      |perl(1) et les pages html        |
    |perl           |I:992 |705   |fournies par perl-doc et         |
    |               |      |      |perl-doc-html                    |
    |---------------+------+------+---------------------------------|
    |python         |V:293,|68    |python(1) et les pages html      |
    |               |I:923 |      |fournies par python-doc          |
    |---------------+------+------+---------------------------------|
    |tcl            |V:31, |22    |tcl(3) et les pages de manuel    |
    |               |I:414 |      |détaillées fournies par tcl-doc  |
    |---------------+------+------+---------------------------------|
    |tk             |V:30, |22    |tk(3) et les pages de manuel     |
    |               |I:406 |      |détaillées fournies par tk-doc   |
    |---------------+------+------+---------------------------------|
    |ruby           |V:137,|35    |ruby(1) et la référence          |
    |               |I:318 |      |interactive fournir par ri       |
    |---------------+------+------+---------------------------------|
    |vim            |V:106,|3231  |menu d’aide (F1) fourni par      |
    |               |I:398 |      |vim-doc                          |
    |---------------+------+------+---------------------------------|
    |susv2          |I:0   |16    |aller chercher « The Single UNIX |
    |               |      |      |Specifications v2 »              |
    |---------------+------+------+---------------------------------|
    |susv3          |I:0   |16    |aller chercher « The Single UNIX |
    |               |      |      |Specifications v3 »              |
    +---------------------------------------------------------------+


    Une référence en ligne est accessible en entrant « man name »
    après l’installation des paquets manpages et manpages-dev. Les
    références en ligne des outils GNU tools sont disponibles en
    entrant « info nom_programme » après l’installation des paquets
    de documentation pertinents. Vous devrez peut-être inclure les
    archives contrib et non-free en plus de l’archive main car
    certaines documentations GFDL ne sont pas considérées comme
    conformes à DFSG.

    Avertissement
   
    N’utilisez pas « test » comme nom d’un fichier exécutable.
    « test » fait partie de l’interpréteur de commandes.

    Attention

    Vous devrez installer les programmes directement compilés à
    partir des sources dans « /usr/local » ou « /opt » afin d’éviter
    des collisions avec les programmes du système.

    Astuce

    Les exemples de code pour la création de « Song 99 Bottles of
    Beer » devraient vous donner de bonnes indications sur
    pratiquement tous les langages de programmation.

%

12.1. Les scripts de l’interpréteur de commande

    Le script de l’interpréteur de commandes (« shell script » est un
    fichier texte dont le bit d’exécution est positionné et qui
    contient des commandes dans le format suivant :

    #!/bin/sh
     ... lignes de commandes

    La première ligne indique l’interpréteur qui sera utilisé pour
    lire et exécuter le contenu de ce fichier.

    La lecture des scripts de l’interpréteur de commandes est la 
    meilleure manière de comprendre comment fonctionne un système de
    type UNIX. Je donne ici quelques indications et rappels de la
    programmation avec l’interpréteur de commandes. Consultez
    « Erreurs en shell » (http://www.greenend.org.uk/rjk/2001/04/
    shell.html) pour apprendre à partir d’erreurs.

    Contrairement à l’interpréteur de commandes en mode interactif
    (consultez Section 1.5, « La commande simple de l’interpréteur de
    commandes » et Section 1.6, « Traitement des données textuelles à
    la UNIX »), les scripts de l’interpréteur de commandes utilisent
    souvent des paramètres, des conditions et des boucles.

%

12.1.1. Compatibilité de l’interpréteur de commandes avec POSIX

    De nombreux scripts systèmes peuvent être interprétés par
    n’importe lequel des interpréteurs de commande POSIX (consultez
    Tableau 1.13, « Liste d’interpréteurs de commandes (« shells ») »
    ). L’interpréteur de commandes par défaut pour le système est « /
    bin/sh » qui est un lien symbolique pointant vers le programme
    réel.

      * bash(1) pour lenny ou plus ancien
   
      * dash(1) pour squeeze ou plus récent

    Évitez d’écrire des scripts de l’interpréteur de commandes avec
    des bashismes ou des zshismes afin de les rendre portables entre
    tous les interpréteurs POSIX. Vous pouvez le vérifier en
    utilisant checkbashisms(1).

    Tableau 12.2. Liste de bashismes typiques

    +---------------------------------------------------------------+
    |          Bon : POSIX          |      À éviter : bashisme      |
    |-------------------------------+-------------------------------|
    |if [ "$toto" = "$titi" ] ; then|if [ "$toto" == "$titi" ] ;    |
    |…                              |then …                         |
    |-------------------------------+-------------------------------|
    |diff -u fichier.c.orig         |diff -u fichier.c{.orig,}      |
    |fichier.c                      |                               |
    |-------------------------------+-------------------------------|
    |mkdir /tototiti /tototutu      |mkdir /toto{titi,tutu}         |
    |-------------------------------+-------------------------------|
    |funcname() { … }               |function funcname() { … }      |
    |-------------------------------+-------------------------------|
    |format octal : « \377 »        |format hexadécimal : « \xff »  |
    +---------------------------------------------------------------+


    La commande « echo » doit être utilisée avec les précautions
    suivantes car son implémentation diffère selon que l’on utilise
    les commandes internes ou externes de l’interpréteur de
    commandes :

      * Éviter d’utiliser toutes les options de commandes sauf
        « -n ».
   
      * Éviter d’utiliser les séquences d’échappement dans les
        chaînes de caractères car leur prise en compte varie.

    Note
   
    Bien que l’option « -n » ne soit pas vraiment de la syntaxe
    POSIX, elle est généralement acceptée.

    Astuce

    Utilisez la commande « printf » plutôt que la commande « echo »
    si vous avez besoin d’intégrer des séquences d’échappement dans
    la chaîne de sortie.

%

12.1.2. Paramètres de l’interpréteur de commandes

    Des paramètres spéciaux de l’interpréteur de commandes sont
    souvent utilisés dans les scripts de l’interpréteur de commandes.

    Tableau 12.3. Liste des paramètres de l’interpréteur de commandes

    +---------------------------------------------------------------+
    |paramètre de l’interpréteur|              valeur               |
    |       de commandes        |                                   |
    |---------------------------+-----------------------------------|
    |$0                         |nom de l’interpréteur ou du script |
    |                           |de l’interpréteur                  |
    |---------------------------+-----------------------------------|
    |$1                         |premier (1er) paramètre de         |
    |                           |l’interpréteur                     |
    |---------------------------+-----------------------------------|
    |$9                         |neuvième (9ème) paramètre de       |
    |                           |l’interpréteur                     |
    |---------------------------+-----------------------------------|
    |$#                         |nombres de paramètres positionnels |
    |---------------------------+-----------------------------------|
    |"$*"                       |"$1 $2 $3 $4 … "                   |
    |---------------------------+-----------------------------------|
    |"$@"                       |"$1" "$2" "$3" "$4" …              |
    |---------------------------+-----------------------------------|
    |$?                         |valeur de retour de la commande la |
    |                           |plus récente                       |
    |---------------------------+-----------------------------------|
    |$$                         |PID de ce script de l’interpréteur |
    |                           |de commandes                       |
    |---------------------------+-----------------------------------|
    |$!                         |PID de la tâche de fond la plus    |
    |                           |récemment lancée                   |
    +---------------------------------------------------------------+


    Les expansions de paramètre les plus courantes à retenir sont
    mentionnées ci-dessous :

    Tableau 12.4. Liste des expansions de paramètre de l’interpréteur

    +---------------------------------------------------------------+
    |    forme de     | valeur si var |   valeur si var n’est pas   |
    | l’expression du |est positionnée|         positionnée         |
    |    paramètre    |               |                             |
    |-----------------+---------------+-----------------------------|
    |${var:-chaîne}   |« $var »       |« chaîne »                   |
    |-----------------+---------------+-----------------------------|
    |${var:+chaîne}   |« chaîne »     |« null »                     |
    |-----------------+---------------+-----------------------------|
    |${var:=chaîne}   |« $var »       |« chaîne » (et lancer « var= |
    |                 |               |chaîne »)                    |
    |-----------------+---------------+-----------------------------|
    |${var:?chaîne}   |« $var »       |echo « chaîne » vers stderr  |
    |                 |               |(et quitter avec une erreur) |
    +---------------------------------------------------------------+


    Ici, les deux points « : » dans tous ces opérateurs sont en fait
    optionnels.

      * avec « : » = opérateur de test pour existe et différent de
        null

      * sans « : » = opérateur de test pour existe uniquement

    Tableau 12.5. Liste des substitutions-clés de paramètres de
    l’interpréteur

    +---------------------------------------------------------------+
    | forme de substitution de  |             résultat              |
    |         paramètre         |                                   |
    |---------------------------+-----------------------------------|
    |${var%suffixe}             |supprimer le motif de suffixe le   |
    |                           |plus petit                         |
    |---------------------------+-----------------------------------|
    |${var%%suffixe}            |supprimer le motif de suffixe le   |
    |                           |plus grand                         |
    |---------------------------+-----------------------------------|
    |${var#préfixe}             |supprimer le motif de préfixe le   |
    |                           |plus petit                         |
    |---------------------------+-----------------------------------|
    |${var##préfixe}            |supprimer le motif de suffixe le   |
    |                           |plus grand                         |
    +---------------------------------------------------------------+


%

12.1.3. Opérateurs conditionnels de l’interpréteur

    Chaque commande retourne un état de sortie qui peut être utilisé
    pour des expressions conditionnelles.

      * Succès : 0 (« Vrai »)
   
      * Erreur : différent de 0 (« Faux »)

    Note

    « 0 » dans le contexte conditionnel de l’interpréteur signifie
    « Vrai » alors que « 0 » dans le contexte conditionnel de C
    signifie « Faux ».

    Note
   
    « [ » est l’équivalent de la commande test, qui évalue, comme
    expression conditionnelle, les paramètres jusqu’à « ] ».

    Les idiomes conditionnels de base à retenir sont les suivants :

      * « <commande> && <si_succès_lancer_aussi_cette_commande> ||
        true »

      * « <commande> ||
        <en_cas_de_non_succès_lancer_aussi_cette_commande> || true »

      * Un morceau de script sur plusieurs lignes comme le suivant :

    if [ <expression_conditionnelle> ]; then
     <si_succès_lancer_cette_commande>
    else
     <si_pas_de_succes_lancer_cette_commande>
    fi

    Ici, le « || true » était nécessaire pour s’assurer que ce script
    de l’interpréteur ne se termine pas accidentellement à cette
    ligne lorsque l’interpréteur est appelé avec l’indicateur « -e ».

    Tableau 12.6. Liste des opérateurs de comparaison dans les
    expressions conditionnelles

    +---------------------------------------------------------------+
    |   équation    |  condition pour retourner une valeur logique  |
    |               |                     vraie                     |
    |---------------+-----------------------------------------------|
    |-e <fichier>   |<fichier> existe                               |
    |---------------+-----------------------------------------------|
    |-d <fichier>   |<fichier> existe et est un répertoire          |
    |---------------+-----------------------------------------------|
    |-f <fichier>   |<fichier> existe et est un fichier normal      |
    |               |(« régulier »)                                 |
    |---------------+-----------------------------------------------|
    |-w <fichier>   |<fichier> existe et peut être écrit            |
    |---------------+-----------------------------------------------|
    |-x <fichier>   |<fichier> existe et est exécutable             |
    |---------------+-----------------------------------------------|
    |<fichier1> -nt |<fichier1> est plus récent que <fichier2>      |
    |<fichier2>     |(modification)                                 |
    |---------------+-----------------------------------------------|
    |<fichier1> -ot |<fichier1> est plus ancien que <fichier2>      |
    |<fichier2>     |(modification)                                 |
    |---------------+-----------------------------------------------|
    |<fichier1> -ef |<fichier1> et <fichier2> sont sur le même      |
    |<fichier2>     |périphérique et le même numéro d’inœud         |
    +---------------------------------------------------------------+


    Tableau 12.7. Liste des opérateurs de comparaison de chaîne de
    caractères dans les expressions conditionnelles

    +---------------------------------------------------------------+
    |  équation  |condition pour retourner une valeur logique vraie |
    |------------+--------------------------------------------------|
    |-z <str>    |la longueur de <str> est nulle                    |
    |------------+--------------------------------------------------|
    |-n <str>    |la longueur de <str> est non nulle                |
    |------------+--------------------------------------------------|
    |<str1> =    |<str1> et <str2> sont égales                      |
    |<str2>      |                                                  |
    |------------+--------------------------------------------------|
    |<str1> !=   |<str1> et <str2> ne sont pas égales               |
    |<str2>      |                                                  |
    |------------+--------------------------------------------------|
    |<str1> <    |<str1> est trié avant <str2> (dépendant des       |
    |<str2>      |paramètres linguistiques)                         |
    |------------+--------------------------------------------------|
    |<str1> >    |<str1> est trié après <str2> (dépendant des       |
    |<str2>      |paramètres linguistiques)                         |
    +---------------------------------------------------------------+


    Les opérateurs de comparaison arithmétique entière dans les
    expressions conditionnelles sont « -eq », « -ne », « -lt »,
    « -le », « -gt » et « -ge ».

%

12.1.4. Boucles de l’interpréteur de commandes

    Il existe un certains nombre d’idiomes de boucles qu’on peut
    utiliser avec un interpréteur de commandes POSIX.

      * « for x in toto1 toto2 ... ; do commande ; done » boucle en
        assignant les éléments de la liste « toto1 toto2 ... » à la
        variable « x » et et en exécutant la « commande ».

      * « "while condition ; do commande ; done » répète la
        « commande » tant que la « condition » est vraie.
   
      * « until condition ; do commande ; done » répète la
        « commande » tant que « « condition » n’est pas vraie.

      * « break » permet de quitter la boucle.

      * « continue » permet de reprendre l’itération suivante de la
        boucle.

    Astuce

    Les itérations numériques semblables à celles du langage C
    peuvent être réalisées en utilisant seq(1) comme générateur de
    « toto1 toto2 … ».

    Astuce
   
    Consultez Section 9.3.9, « Répéter une commande en bouclant entre
    des fichiers ».

12.1.5. Séquence de traitement de la ligne de commandes de
l’interpréteur

    En gros, l’interpréteur de commandes traite un script de la
    manière suivante :

      * l’interpréteur de commandes lit une ligne :

      * l’interpréteur de commandes regroupe une partie de la ligne
        sous forme d’un élément (« token » si elle se trouve entre
        "…" ou '…' :

      * l’interpréteur de commandes découpe les autres parties de la
        ligne en éléments comme suit :

          + Espaces : <espace> <tabulation> <saut-de-ligne>

          + Métacaractères : < > | ; & ( )

      * l’interpréteur de commandes vérifie les mots réservés pour
        chacun des éléments et ajuste son comportement s’il ne se
        trouve pas entre "…" ou '…'.

          + mot réservé : if then elif else fi for in while unless do
            done case esac

      * L’interpréteur de commandes étend les alias s’ils ne se
        trouvent pas entre "…" ou '…'.

      * l’interpréteur de commandes étend les tilde s’ils ne se
        trouvent pas entre "…" ou '…'.

          + « ~ » → répertoire personnel de l’utilisateur actuel

          + « ~<utilisateur> » → répertoire personnel de l’
            <utilisateur>

      * l’interpréteur de commandes étend les paramètres en leur
        valeur s’ils ne sont pas entre '…'.

          + paramètre : « $PARAMETRE » ou « ${PARAMETRE} »

      * l’interpréteur de commandes étend la substitution de commande
        si elle n’est pas entre '…'.

          + « $( commande ) » → sortie de la « commande »

          + « ` commande ` » → sortie de la « commande »

      * l’interpréteur de commandes étend les motifs génériques du
        chemin aux fichiers correspondants s’ils ne sont pas entre
         "…" ou '…'.

          + * → n’importe quel caractère

          + ? → un caractère

          + […] → un caractère quelconque parmi « … »

      * l’interpréteur de commandes recherche la commande dans ce qui
        suit et l’exécute.

          + définition de fonction

          + commande interne (« builtin »)

          + fichier exécutable dans « $PATH »

      * l’interpréteur de commandes passe à la ligne suivante et
        recommence ce traitement depuis le début de la séquence.

    Des guillemets simples dans des guillemets doubles n’ont pas
    d’effet.

    Exécuter « set -x » dans le script de l’interpréteur ou l’appel
    du script avec l’option « -x » fait imprimer par l’interpréteur
    de commandes toutes les commandes exécutées. C’est assez pratique
    pour le débogage.

12.1.6. Programmes utilitaires pour les scripts de l’interpréteur de
commandes

    De façon à rendre vos programmes de l’interpréteur de commandes
    aussi portables que possible dans tous les systèmes Debian, c’est
    une bonne idée de limiter les programmes utilitaires à ceux
    fournis par les paquets essentiels.

      * « aptitude search ~E » » affiche la liste des essentiels.

      * « dpkg -L <nom_paquet> |grep '/man/man.*/' » affiche la liste
        des pages de manuel pour les commandes que fournit le paquet
        <nom_paquet>.

    Tableau 12.8. Lites des paquets comportant des petits programmes
    utilitaires pour les scripts de l’interpréteur de commandes

    +---------------------------------------------------------------+
    |   paquet   | popcon |taille|           description            |
    |------------+--------+------+----------------------------------|
    |coreutils   |V:891,  |17478 |utilitaires du cœur de GNU        |
    |            |I:999   |      |                                  |
    |------------+--------+------+----------------------------------|
    |debianutils |V:925,  |230   |divers utilitaires spécifiques à  |
    |            |I:999   |      |Debian                            |
    |------------+--------+------+----------------------------------|
    |bsdmainutils|V:60,   |26    |collection d’autres utilitaires   |
    |            |I:996   |      |provenant de FreeBSD              |
    |------------+--------+------+----------------------------------|
    |bsdutils    |V:673,  |393   |utilitaires de base provenant de  |
    |            |I:999   |      |4.4BSD-Lite                       |
    |------------+--------+------+----------------------------------|
    |moreutils   |V:11,   |237   |utilitaires supplémentaires d’UNIX|
    |            |I:35    |      |                                  |
    +---------------------------------------------------------------+


    Astuce

    Bien que moreutils puisse ne pas exister en dehors de Debian, il
    propose d’intéressants petits programmes. Le plus remarquable est
    sponge(8) qui est bien pratique pour écrire directement sur le
    fichier d’origine.

%

12.1.7. Dialogue de l’interpréteur de commandes

    L’interface utilisateur d’un simple programme d’interpréteur de
    commandes peut être améliorée au-delà de l’interaction bête des
    commandes echo et read afin de devenir plus interactive en
    utilisant un des programmes appelés « dialogues », etc.

    Tableau 12.9. Liste d’interfaces utilisateur

    +---------------------------------------------------------------+
    | paquet  |popcon|taille|              description              |
    |---------+------+------+---------------------------------------|
    |x11-utils|V:180,|712   |xmessage(1) : afficher un message ou   |
    |         |I:599 |      |une question dans une fenêtre (X)      |
    |---------+------+------+---------------------------------------|
    |         |V:87, |      |afficher des boîtes de dialogues       |
    |whiptail |I:995 |71    |conviviales depuis des scripts de      |
    |         |      |      |l’interpréteur de commandes (newt)     |
    |---------+------+------+---------------------------------------|
    |         |V:15, |      |afficher des boîtes de dialogues       |
    |dialog   |I:123 |1222  |conviviales depuis des scripts de      |
    |         |      |      |l’interpréteur de commandes (ncurses)  |
    |---------+------+------+---------------------------------------|
    |         |V:87, |      |afficher de boîtes de dialogue         |
    |zenity   |I:409 |384   |graphiques depuis des scripts de       |
    |         |      |      |l’interpréteur de commandes (gtk2.0)   |
    |---------+------+------+---------------------------------------|
    |         |      |      |Outil frontal de scripts de            |
    |ssft     |V:0,  |75    |l’interpréteur de commandes (enrobeur  |
    |         |I:0   |      |pour zenity, kdialog et dialog avec    |
    |         |      |      |gettext)                               |
    |---------+------+------+---------------------------------------|
    |gettext  |V:48, |5843  |« /usr/bin/gettext.sh »: traduire des  |
    |         |I:312 |      |messages                               |
    +---------------------------------------------------------------+


%

12.1.8. Exemple de script avec zenity

    Voici un exemple simple qui crée une image ISO avec des données
    RS02 fournies par dvdisaster(1) :

    #!/bin/sh -e
    # gmkrs02 : Copyright (C) 2007 Osamu Aoki <osamu@debian.org>, Public Domain
    #set -x
    error_exit()
    {
      echo "$1" >&2
      exit 1
    }
    # Initialiser les variables
    DATA_ISO="$HOME/Desktop/iso-$$.img"
    LABEL=$(date +%Y%m%d-%H%M%S-%Z)
    if [ $# != 0 ] && [ -d "$1" ]; then
      DATA_SRC="$1"
    else
      # Sélectionner le répertoire pour la création de l’image ISO à partir d'un dossier du bureau
      DATA_SRC=$(zenity --file-selection --directory  \
        --title="Sélectionner la racine de l’arborescence de répertoires pour créer l’image ISO") \
        || error_exit "Quitter lors de la sélection du répertoire"
    fi
    # Vérifier la taille de l’archive
    xterm -T "Check size $DATA_SRC" -e du -s $DATA_SRC/*
    SIZE=$(($(du -s $DATA_SRC | awk '{print $1}')/1024))
    if [ $SIZE -le 520 ] ; then
      zenity --info --title="Dvdisaster RS02" --width 640  --height 400 \
        --text="La taille des données convient à pour une sauvegarde sur CD :\\n $SIZE Mo"
    elif [ $SIZE -le 3500 ]; then
      zenity --info --title="Dvdisaster RS02" --width 640  --height 400 \
        --text="La taille des données convient à pour une sauvegarde sur DVD :\\n $SIZE Mo"
    else
      zenity --info --title="Dvdisaster RS02" --width 640  --height 400 \
        --text="La taille des données est trop grande pour une sauvegarde : $SIZE Mo"
      error_exit "Taille de données trop importante pour la sauvegarde :\\n $SIZE Mo"
    fi
    # on n'est certain d'avoir une option -e fonctionnelle uniquement avec xterm
    # Créer une image ISO brute
    rm -f "$DATA_ISO" || true
    xterm -T "genisoimage $DATA_ISO" \
      -e genisoimage -r -J -V "$LABEL" -o "$DATA_ISO" "$DATA_SRC"
    # Créer la redondance RS02 supplémentaire
    xterm -T "dvdisaster $DATA_ISO" -e  dvdisaster -i "$DATA_ISO" -mRS02 -c
    zenity --info --title="Dvdisaster RS02" --width 640  --height 400 \
      --text="Données ISO/RS02 ($SIZE Mo) \\n créées sur : $DATA_ISO"
    # EOF

    Vous désirerez peut-être créer un lanceur sur le bureau avec une
    commande définie comme « /usr/local/bin/gmkrs02 %d ».

%

12.2. Make

    Make est un utilitaire destiné à la maintenance d’un groupe de
    programmes. Lors de l’exécution de make(1), make lit le fichier
    de règles, « Makefile » et met à jour une cible si elle dépend de
    fichiers qui ont été modifiés depuis que la cible a été modifiée
    pour la dernière fois ou si la cible n’existe pas. L’exécution de
    ces mises à jour peut être faite simultanément.

    La syntaxe du fichier de règles est la suivante :

    cible: [ prérequis... ]
     [TAB]  commande1
     [TAB]  -commande2 # ignorer les erreurs
     [TAB]  @commande3 # supprimer l’écho

    Ici, « [TAB] » est un code de tabulation. Chaque ligne est
    interprétée par l’interpréteur de commandes après que make ait
    effectué la substitution des variables. Utilisez « \ » à la fin
    d’une ligne pour poursuivre le script. Utilisez « $$ » pour
    entrer un « $ » pour les valeurs des variables d’environnement
    d’un script de l’interpréteur de commandes.

    On peut écrire des règles implicites pour la cible et les
    prérequis, par exemple, de la manière suivante :

    %.o: %.c header.h

    Ici, la cible contient le caractère « % » (exactement 1
    caractère). Le caractère « % » peut correspondre à n’importe
    quelle sous-chaîne non vide des noms de fichiers de la cible
    actuelle. De même pour les prérequis, utilisez « % » pour
    afficher la manière dont leur nom est en relation avec le nom de
    la cible actuelle.

    Tableau 12.10. Liste des variables automatiques de make

    +---------------------------------------------------------------+
    |     variables      |                  valeur                  |
    |    automatiques    |                                          |
    |--------------------+------------------------------------------|
    |$@                  |cible                                     |
    |--------------------+------------------------------------------|
    |$<                  |première exigence                         |
    |--------------------+------------------------------------------|
    |$?                  |toutes les exigences plus récentes        |
    |--------------------+------------------------------------------|
    |$^                  |toutes les exigences                      |
    |--------------------+------------------------------------------|
    |$*                  |« % » correspond au radical dans le motif |
    |                    |cible                                     |
    +---------------------------------------------------------------+


    Tableau 12.11. Liste de l’expansion des variables de make

    +---------------------------------------------+
    |expansion de la variable|    description     |
    |------------------------+--------------------|
    |toto := titi            |expansion à la volée|
    |------------------------+--------------------|
    |toto2 = titi            |expression récursive|
    |------------------------+--------------------|
    |toto3+= titi            |ajouter             |
    +---------------------------------------------+


    Exécutez « make -p -f/dev/null » afin de voir les règles
    automatiques internes.

%

12.3. C

    Vous pouvez définir un environnement propre pour compiler des
    programmes écrits dans le langage de programmation C par ce qui
    suit :

    # apt-get install glibc-doc manpages-dev libc6-dev gcc build-essential

    Le paquet libc6-dev, c’est-à-dire la bibliothèque GNU C, fournit
    la bibliothèque C standard qui est une collection de fichiers
    d’en-têtes et de routines de bibliothèque utilisée par le langage
    de programmation C.

    Consultez les références pour C comme suit; :

      * « info libc » (références des fonctions de la bibliothèque C)

      * gcc(1) et « info gcc »
   
      * chaque_nom_de_fonction_de la_bibliothèque_C(3)

      * Kernighan & Ritchie, « Le langage de programmation C », 2ème
        édition (Prentice Hall)

%

12.3.1. Programme simple en C (gcc)

    Un exemple simple « example.c » peut être compilé avec la
    bibliothèque « libm » pour donner l’exécutable « run_example »
    par ce qui suit :

    $ cat > example.c << EOF
    #include <stdio.h>
    #include <math.h>
    #include <string.h>

    int main(int argc, char **argv, char **envp){
            double x;
            char y[11];
            x=sqrt(argc+7.5);
            strncpy(y, argv[0], 10); /* évite les débordements de tampon */
            y[10] = '\0'; /* remplir afin d'être certain que la chaîne se termine par'\0' */
            printf("%5i, %5.3f, %10s, %10s\n", argc, x, y, argv[1]);
            return 0;
    }
    EOF
    $ gcc -Wall -g -o run_example example.c -lm
    $ ./run_example
            1, 2.915, ./run_exam,     (null)
    $ ./run_example 1234567890qwerty
            2, 3.082, ./run_exam, 1234567890qwerty

    Ici, « -lm » est nécessaire pour lier la bibliothèque « /usr/lib/
    libm.so » depuis le paquet libc6 pour sqrt(3). La bibliothèque
    réelle se trouve dans « /lib/ » avec le nom de fichier
    « libm.so.6 » avec un lien symbolique vers « libm-2.7.so ».

    Regardez le dernier paramètre du texte en sortie. Il y a plus de
    10 caractères bien que « %10s » soit indiqué.

    L’utilisation de fonctions effectuant des opérations sur des
    pointeurs en mémoire sans vérification des limites, telles que 
    sprintf(3) et strcpy(3) a été rendue obsolète afin d’éviter les
    exploits de débordements de tampons qui utilisent les effets des
    débordements ci-dessus. Utilisez snprintf(3) et strncpy(3) en
    remplacement..

%

12.4. Déboguer

    Le débogage est une partie de l’activité de programmations.
    Savoir comment déboguer des programmes fera de vous un bon
    utilisateur de Debian qui pourra produire des rapports de bogues
    documentés.

%

12.4.1. Exécution de base de gdb

    Le debogueur primaire sous Debian est gdb(1), il vous permet
    d’inspecter un programme alors qu’il tourne.

    Installons gdb et les programmes associés par ce qui suit :

    # apt-get install gdb gdb-doc build-essential devscripts

    Un bon didacticiel de gdb est proposé par « info gdb «» ou peut
    être trouvé ailleurs sur le web. Voici un exemple simple
    d’utilisation de gdb(1) sur un « program » compilé avec l’option
    « -g » qui produit les informations de débogage.

    $ gdb program
    (gdb) b 1                # définit un point d'arrêt à la ligne 1
    (gdb) run args           # lancer les programmes avec des paramètres
    (gdb) next               # ligne suivante
    ...
    (gdb) step               # avancer d'un pas
    ...
    (gdb) p parm             # afficher parm
    ...
    (gdb) p parm=12          # définir sa valeur à 12
    ...
    (gdb) quit

    Astuce

    De nombreuses commandes de gdb(1) possèdent une abréviation.
    L’expansion à l’aide de la touche de tabulation fonctionne comme
    avec l’interpréteur de commandes.

%

12.4.2. Déboguer un paquet Debian

    Since all installed binaries should be stripped on the Debian
    system by default, most debugging symbols are removed in the
    normal package. In order to debug Debian packages with gdb(1),
    either corresponding *-dbg packages or *-dbgsym packages need to
    be installed (e.g. libc6-dbg in the case of libc6,
    coreutils-dbgsym in the case of coreutils).

    Old-style packages would provide its corresponding *-dbg package.
    It is placed directly inside Debian main archive alongside of the
    original package itself. For newer packages, they may generate
    *-dbgsym packages automatically when built and those debug
    packages are placed separately in debian-debug archive. Please
    refer to articles on Debian Wiki for more information.

    Si un paquet à déboguer ne possède pas ni paquet *-dbg, ni paquet
    *-dbgsym correspondant, vous devrez l’installer après l’avoir
    reconstruit comme suit .

    $ mkdir /path/new ; cd /path/new
    $ sudo apt-get update
    $ sudo apt-get dist-upgrade
    $ sudo apt-get install fakeroot devscripts build-essential
    $ apt-get source package_name
    $ cd package_name*
    $ sudo apt-get build-dep ./

    Corriger les bogues si nécessaire.

    Modifier la version du paquet pour ne pas entrer en collision
    avec les versions officielles de Debian, par exemple, en ajoutant
    « +debug1 » pour la compilation d’une version de paquet
    existante, ou « ~pre1 » pour la compilation d’une version de
    paquet qui n’est pas encore diffusée de la manière suivante :

    $ dch -i

    Compiler et installer les paquets avec les symboles de débogage
    comme suit :

    $ export DEB_BUILD_OPTIONS="nostrip noopt"
    $ debuild
    $ cd ..
    $ sudo debi package_name*.changes

    Vous devrez vérifier les scripts de construction du paquet et
    vous assurer que les options « CFLAGS=-g -Wall » sont
    positionnées pour la compilation des binaires.

%

12.4.3. Obtenir une trace

    Si vous rencontrez un plantage de programme, signaler le bogue
    avec un copier-coller des informations de trace est une bonne
    idée.

    La trace peut être obtenue de la manière suivante :

      * Lancer le programme sous gdb(1) ;

      * Reproduire le plantage ;
   
          + Vous allez être ramené à l’invite de gdb ;

      * Entrez « bt » à l’invite de gdb ;

    Si le programme se fige, vous pouvez le planter en pressant
    Ctrl-C dans le terminal où tourne gdb pour récupérer l’invite de
    gdb ;

    Astuce

    Souvent, vous voyez une trace où une ou plusieurs des lignes de
    départ se trouvent dans « malloc() » ou « g_malloc() ». Lorsque
    cela arrive, il y a des chances pour que votre trace ne soit pas
    très utile. La meilleure façon de trouver des informations utiles
    est de définir la variable d’environnement « $MALLOC_CHECK_ » à
    la valeur 2 (malloc(3)). Vous pouvez le faire en lançant gdb de
    la manière suivante :

     $ MALLOC_CHECK_=2 gdb hello

%

12.4.4. Commandes avancées de gdb

    Tableau 12.12. Liste des commandes avancées de gdb

    +---------------------------------------------------------------+
    |    commande    |   description des objectifs des commandes    |
    |----------------+----------------------------------------------|
    |(gdb) thread    |obtenir une trace de tous les processus d’un  |
    |apply all bt    |programme multi-processus (multi-threaded)    |
    |----------------+----------------------------------------------|
    |(gdb) bt full   |obtenir les paramètres qui se trouvent sur la |
    |                |pile d’appel des fonctions                    |
    |----------------+----------------------------------------------|
    |(gdb) thread    |obtenir une trace et les paramètres en        |
    |apply all bt    |combinant les options précédentes             |
    |full            |                                              |
    |----------------+----------------------------------------------|
    |(gdb) thread    |obtenir une trace et les paramètres des 10    |
    |apply all bt    |premiers appels en supprimant ce qui n’est pas|
    |full 10         |significatif                                  |
    |----------------+----------------------------------------------|
    |(gdb) set       |écrire le journal de sortie de gdb dans un    |
    |logging on      |fichier (le fichier par défaut est            |
    |                |« gdb.txt »)                                  |
    +---------------------------------------------------------------+


%

12.4.5. Déboguer les erreurs de X

    Si un programme apercu1 de GNOME a reçu une erreur X, vous
    devriez obtenir un message comme suit :

    Le programme 'apercu1' a reçu une erreur du système X Window.

    Dans ce cas, vous pouvez essayer de faire tourner le programme
    avec « --sync » et arrêter sur la fonction « gdk_x_error » de
    manière à obtenir une trace.

%

12.4.6. Vérifier les dépendances avec les bibliothèques

    Utilisez ldd(1) pour trouver les dépendances d’un programme avec
    des bibliothèques :

    $ ldd /bin/ls
            librt.so.1 => /lib/librt.so.1 (0x4001e000)
            libc.so.6 => /lib/libc.so.6 (0x40030000)
            libpthread.so.0 => /lib/libpthread.so.0 (0x40153000)
            /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x40000000)

    Pour que ls(1) fonctionne dans un environnement `chroot`é, les
    bibliothèques ci-dessus doivent être disponibles dans votre
    environnement `chroot`é.

    Consultez Section 9.3.6, « Tracer l’activité d’un programme ».

%

12.4.7. Outils de détection des fuites de mémoire

    Il y a plusieurs outils de détection des fuites de mémoire
    disponibles sous Debian.

    Tableau 12.13. Liste des outils de détection des fuites de
    mémoire

    +---------------------------------------------------------------+
    |    paquet    |popcon |taille|           description           |
    |--------------+-------+------+---------------------------------|
    |libc6-dev     |V:249, |14357 |mtrace(1) : fonctionnalité de    |
    |              |I:620  |      |débogage de malloc dans glibc    |
    |--------------+-------+------+---------------------------------|
    |valgrind      |V:6,   |80378 |débogueur mémoire et optimiseur  |
    |              |I:46   |      |                                 |
    |--------------+-------+------+---------------------------------|
    |electric-fence|V:0,   |70    |débogueur malloc(3)              |
    |              |I:5    |      |                                 |
    |--------------+-------+------+---------------------------------|
    |leaktracer    |V:0,   |57    |traceur de fuites de mémoire pour|
    |              |I:3    |      |les programmes C++               |
    |--------------+-------+------+---------------------------------|
    |libdmalloc5   |V:0,   |393   |bibliothèque de débogage de      |
    |              |I:3    |      |l’allocation mémoire             |
    +---------------------------------------------------------------+


%

12.4.8. Outils d’analyse du code statique

    Il y a des outils tels que lint pour l’analyse du code statique.

    Tableau 12.14. Liste des outils d’analyse du code statique :

    +---------------------------------------------------------------+
    |   paquet    |popcon|taille|            description            |
    |-------------+------+------+-----------------------------------|
    |             |V:0,  |      |outil pour vérifier de manière     |
    |splint       |I:4   |2315  |statique les bogues d’un programme |
    |             |      |      |en C                               |
    |-------------+------+------+-----------------------------------|
    |             |      |      |outil pour examiner le code source |
    |flawfinder   |V:0,  |181   |en C/C++ et rechercher des         |
    |             |I:0   |      |faiblesses du point de vue de la   |
    |             |      |      |sécurité                           |
    |-------------+------+------+-----------------------------------|
    |             |V:610,|      |interpréteur ayant un vérificateur |
    |perl         |I:992 |705   |de code statique interne : B::Lint |
    |             |      |      |(3perl)                            |
    |-------------+------+------+-----------------------------------|
    |pylint       |V:2,  |1371  |vérificateur de code statique      |
    |             |I:13  |      |Python                             |
    |-------------+------+------+-----------------------------------|
    |weblint-perl |V:0,  |32    |vérificateur de syntaxe et de style|
    |             |I:1   |      |minimal pour HTML                  |
    |-------------+------+------+-----------------------------------|
    |linklint     |V:0,  |344   |vérificateur rapide de liens et    |
    |             |I:0   |      |outils de maintenance de sites web |
    |-------------+------+------+-----------------------------------|
    |libxml2-utils|V:22, |182   |utilitaires avec xmllint(1) pour   |
    |             |I:246 |      |valider les fichiers XML           |
    +---------------------------------------------------------------+


%

12.4.9. Désassembler un binaire

    Vous pouvez désassembler du code binaire avec objdump(1) en
    faisant ce qui suit :

    $  objdump -m i386 -b binary -D /usr/lib/grub/x86_64-pc/stage1

    Note
   
    gdb(1) peut être utilisé pour désassembler du code de manière
    interactive

%

12.5. Flex -- un meilleur Lex

    Flex est un générateur d’analyse lexicale rapide compatible avec
    Lex.

    On trouve un didacticiel de flex(1) dans « info flex ».

    Vous devez fournir vos propres « main() » et « yywrap() ». Sinon
    votre programme flex devrait ressembler à ce qui suit pour se
    compiler sans bibliothèque (cela parce que « yywrap » est une
    macro et que « %option main » active de manière implicite
    « %option noyywrap ».

    %option main
    %%
    .|\n    ECHO ;
    %%

    Sinon, vous pouvez compiler avec l’option de l’éditeur de liens
    « -lfl » à la fin de la ligne de commandes de cc(1) (comme AT&
    T-Lex avec « -ll »). L’option « %option » n’est pas nécessaire
    dans ce cas.

%

12.6. Bison -- un meilleur Yacc

    Un certain nombre de paquets fournissent un analyseur LR à
    lecture anticipée (« lookahead ») compatible avec Yacc ou un
    générateur d’analyseur LALR sous Debian.

    Tableau 12.15. Liste de générateurs d’analyseur LALR compatible
    avec Yacc

    +---------------------------------------------------------------+
    |paquet|popcon |taille|               description               |
    |------+-------+------+-----------------------------------------|
    |bison |V:9,   |2815  |générateur d’analyseur GNU LALR          |
    |      |I:103  |      |                                         |
    |------+-------+------+-----------------------------------------|
    |byacc |V:0,   |160   |générateur d’analyseur Berkeley LALR     |
    |      |I:6    |      |                                         |
    |------+-------+------+-----------------------------------------|
    |btyacc|V:0,   |243   |générateur d’analyseur avec retour       |
    |      |I:0    |      |arrière basé sur byacc                   |
    +---------------------------------------------------------------+


    On trouve un didacticiel de bison(1) dans « info bison ».

    Vous devez fournir vos propre « main() » et « yyerror() ». « main
    () » appelle « yyparse() » qui appelle « yylex() »,
    habituellement créé avec Flex.

%

12.7. Autoconf

    Autoconf est un outil destiné à produire des scripts en shell qui
    configurent automatiquement un code source de logiciel pour
    l’adapter à de nombreux types de systèmes « UNIX-like » en
    utilisant l’ensemble du système de construction GNU.

    autoconf(1) produit le script de configuration « configure ».
    « configure » crée automatiquement un « Makefile » en utilisant
    le patron « Makefile.in ».

%

12.7.1. Compiler et installer un programme

    Avertissement
   
    Ne pas écraser les fichiers du système avec les programmes que
    vous avez compilés en les installant.

    Debian ne touche pas aux fichiers se trouvant dans « /usr/local/
     » ou « /opt ». Donc, si vous compilez un programme depuis ses
    sources, installez-le dans « /usr/local/ » de manière à ce qu’il
    n’interfère pas avec Debian.

    $ cd src
    $ ./configure --prefix=/usr/loca
    $ make
    $ make install # cela met les fichiers dans le système

%

12.7.2. Désinstaller un programme

    Si vous avez les sources d’origine et s’ils utilisent autoconf(1)
    et automake(1) et si vous-vous souvenez comment vous l’avez
    configuré, exécutez-le comme suit pour désinstaller le
    programme :

    $ ./configure « toutes-les-options-que-vous-lui-avez-passé »
    # make uninstall

    Sinon, si vous êtes absolument certain que le processus
    d’installation n’a mis des fichiers que sous « /usr/local/ » et
    qu’il n’y a là rien d’important, vous pouvez supprimer tout son
    contenu avec :

    # find /usr/local -type f -print0 | xargs -0 rm -f

    Si vous n’êtes pas certain de l’emplacement où les fichiers ont
    été installés, vous devriez envisager d’utiliser checkinstall(8)
    du paquet checkinstall qui fournit une voie propre pour la
    désinstallation. Il prend maintenant en charge la création d’un
    paquet Debian à l’aide de l’option « -D ».

%

12.8. Folie de courts scripts en Perl

    Bien que tous les scripts en AWK puissent être réécrits
    automatiquement en Perl en utilisant a2p(1), il est plus facile
    de convertir manuellement les scripts AWK constitués d’une seule
    ligne en scripts Perl d’une seule ligne.

    Regardons le bout de script AWK suivant :

    awk '($2=="1957") { print $3 }' |

    Il est équivalent à l’une quelconque des lignes suivantes :

    perl -ne '@f=split; if ($f[1] eq "1957") { print "$f[2]\n"}' |

    perl -ne 'if ((@f=split)[1] eq "1957") { print "$f[2]\n"}' |

    perl -ne '@f=split; print $f[2] if ( $f[1]==1957 )' |

    perl -lane 'print $F[2] if $F[1] eq "1957"' |

    perl -lane 'print$F[2]if$F[1]eq+1957' |

    La dernière est une devinette. Elle tire parti des
    fonctionnalités suivantes de Perl :

      * L’espace est optionnel.
   
      * Il existe une conversion automatique des nombres en chaîne de
        caractères.

    Consultez perlrun(1) pour les options de la ligne de commandes.
    Pour des scripts en Perl plus fous, il peut être intéressant de
    consulter Perl Golf.

%

12.9. Web

    Des pages web dynamiques et interactives simples peuvent être
    faites de la manière suivante :

      * Les requêtes sont présentées au navigateur de l’utilisateur
        en utilisant des formulaires HTML.

      * Remplir et cliquer sur les entrées de formulaires envoie une
        des chaînes d’URL suivantes avec des paramètres codés depuis
        le navigateur vers le serveur web.

          + « http://www.foo.dom/cgi-bin/programme.pl?VAR1=VAL1&VAR2=
            VAL2&VAR3=VAL3 »

          + « http://www.foo.dom/cgi-bin/programme.py?VAR1=VAL1&VAR2=
            VAL2&VAR3=VAL3 »

          + « http://www.foo.dom/programme.php?VAR1=VAL1&VAR2=VAL2&
            VAR3=VAL3 »

      * « %nn » dans l’URL est remplacé par le caractère dont la
        valeur hexadécimale est nn.

      * La variable d’environnement est définie à : « QUERY_STRING=
        "VAR1=VAL1 VAR2=VAL2 VAR3=VAL3" ».

      * Le programme CGI (l’un quelconque des « programme.* ») sur le
        serveur web s’exécute lui-même avec la variable
        d’environnement « $QUERY_STRING ».

      * La sortie standard (stdout) du programme CGI est envoyée au
        navigateur web et présentée sous forme d’une page web
        dynamique interactive.

    Pour des raisons de sécurité, il est préférable de ne pas
    réaliser soi-même de nouvelles bidouilles pour analyser les
    paramètres CGI. Il existe des modules bien établis pour cela, en
    Perl et Python. PHP est fourni avec ces fonctionnalités.
    Lorsqu’il est nécessaire d’enregistrer des données du client, on
    utilise des cookies HTTP. Lorsqu’un traitement de données est
    nécessaire côté client, on utilise fréquemment Javascript.

    Pour davantage d’informations, consultez Common Gateway
    Interface, The Apache Software Foundation et JavaScript.

    Rechercher « CGI tutorial » sur Google en entrant l’URL encodée
    http://www.google.com/search?hl=en&ie=UTF-8&q=CGI+tutorial
    directement dans la barre d’adresse du navigateur est une bonne
    méthode pour voir un script CGI en action sur le serveur Google.

%

12.10. La conversion du code source

    Il existe des programmes pour convertir les codes sources.

    Tableau 12.16. Liste des outils de conversion de code source

    +---------------------------------------------------------------+
    | paquet  |popcon|taille| mot clé |         description         |
    |---------+------+------+---------+-----------------------------|
    |perl     |V:610,|705   |AWK→PERL |convertir le code source de  |
    |         |I:992 |      |         |AWK vers PERL : a2p(1)       |
    |---------+------+------+---------+-----------------------------|
    |         |V:0,  |      |         |convertir le code source de  |
    |f2c      |I:6   |442   |FORTRAN→C|FORTRAN 77 vers C/C++ : f2c  |
    |         |      |      |         |(1)                          |
    |---------+------+------+---------+-----------------------------|
    |         |V:0,  |      |         |convertisseur depuis NASM    |
    |intel2gas|I:0   |178   |intel→gas|(format Intel) vers          |
    |         |      |      |         |l’Assembleur GNU (GAS)       |
    +---------------------------------------------------------------+


%

12.11. Créer un paquet Debian

    Si vous désirez créer un paquet Debian, lisez ce qui suit :

      * Chapitre 2, Gestion des paquets Debian pour comprendre les
        bases du système de paquets

      * Section 2.7.13, « Porter un paquet vers le système stable »
        pour comprendre les bases du processus de portage

      * Section 9.10.4, « Système protégé (chroot) » pour comprendre
        les techniques de base d’un environnement isolé (« chroot »)

      * debuild(1), pbuilder(1) et pdebuild(1)
   
      * Section 12.4.2, « Déboguer un paquet Debian » pour recompiler
        avec les informations de débogage

      * Guide du nouveau responsable Debian comme tutoriel (paquet
        maint-guide)

      * Référence du développeur Debian (paquet developers-reference)

      * Charte Debian (paquet debian-policy)

      * Guide pour les responsables Debian (le paquet debmake-doc)

    Il existe des paquets tels que debmake, dh-make, dh-make-perl,
    etc., qui facilitent la réalisation des paquets.

Annexe A. Annexe

    Voici les fondements de ce document.

A.1. Le labyrinthe de Debian

    Le système Linux est une plateforme informatique très performante
    pour un ordinateur connecté au réseau. Cependant, apprendre à
    utiliser toutes ses possibilités n’est pas si facile. Configurer
    LPR avec une imprimante qui ne soit pas PostScript en était un
    bon exemple. (Il n’y a plus de problème maintenant car les
    nouvelles installations utilisent CUPS).

    Il existe une carte très détaillée appelée « CODE SOURCE ». Elle
    est très précise mais très difficile à comprendre. Il existe
    aussi des références appelées HOWTO et mini-HOWTO. Elles sont
    plus faciles à comprendre mais ont tendance à trop se concentrer
    sur des détails et perdent de vue les aspects généraux. J’ai de
    temps en temps des problèmes à trouver la bonne section dans un
    long HOWTO quand j’ai besoin d’exécuter certaines commandes.

    I hope this "Debian Reference (version 2.77)" (2021-01-10
    06:32:51 UTC) provides a good starting direction for people in
    the Debian maze.

A.2. Historique du Copyright

    La Référence Debian fut lancée par moi-même, Osamu Aoki <osamu at
    debian dot org> en tant qu’aide-mémoire personnel pour
    l’administration système. De nombreuses parties proviennent des
    connaissances que j’ai acquises sur la liste de diffusion
    debian-user et d’autres ressources Debian.

    En suivant les suggestions de Josip Rodin, qui a été très actif
    dans le Projet de documentation Debian (DDP), la « Référence
    Debian (version 1, 2001-2007) » a été créée en tant que partie
    des documents du DDP.

    Au bout de 6 années, j'ai réalisé que la « Référence Debian
    (version 1) » était dépassée et ai commencé à en réécrire de
    nombreux passages. La nouvelle « Référence Debian (version 2) » a
    été diffusée en 2008.

    Le contenu de ce tutoriel tire son origine et son inspiration
    dans ce qui suit :

      * « Linux User's Guide » de Larry Greenfield (décembre 1996)

          + rendu obsolète par « Debian Tutorial »

      * « Debian Tutorial » de Havoc Pennington. (11 décembre 1998)

          + écrit partiellement par Oliver Elphick, Ole Tetlie, James
            Treacy, Craig Sawyer et Ivan E. Moore II

          + rendu obsolète par « Debian GNU/Linux: Guide to
            Installation and Usage »

      * « Debian GNU/Linux: Guide to Installation and Usage » de John
        Goerzen et Ossama Othman (1999)

          + rendue obsolète par la « Référence Debian (version 1) »

    Les descriptions des paquets et des archives peuvent trouver une
    partie de leur origine et de leur inspiration dans ce qui suit :

      * « FAQ Debian » (version de mars 2002, alors qu’elle était
        maintenue par Josip Rodin)

    Le reste du contenu peut trouver son origine et son inspiration
    dans ce qui suit :

      * « Référence Debian (version 1) » de Osamu Aoki (2001–2007)
   
          + obsoleted by the newer "Debian Reference (version 2)" in
            2008.

    La version précédente « Référence Debian (version 1) » avait été
    créée par de nombreux contributeurs :

      * la contribution principale pour les sujets relatifs à la
        configuration du réseau par Thomas Hood :

      * une importante contribution au contenu sur les sujets
        relatifs à X et VCS par Brian Nelson :

      * l’aide pour les scripts de construction et de nombreuses
        corrections de contenu par Jens Seidel :

      * une relecture intensive de David Sewell :

      * de nombreuses contributions par les traducteurs, les
        contributeurs et ceux qui ont signalés des bogues.

    De nombreuses pages de manuel et de pages info du système Debian
    ont été utilisées comme référence primaire pour écrire ce
    document. Dans la mesure où Osamu Aoki considérait que c’était
    compris dans une utilisation équitable (« fair use »), de
    nombreuses parties d’entre-elles, particulièrement les
    définitions des commandes, ont été utilisées comme morceaux de
    phrases après un effort éditorial soigneux afin de les insérer
    dans le style et avec les objectifs de ce document.

    La description du débogueur gdb a été augmentée en utilisant le
    contenu du wiki Debian sur les « backtrace » avec le consentement
    d’Ari Pollak, Loïc Minier et Dafydd Harries.

    Le contenu de « Référence Debian (version 2.77) » (2021-01-10
    06:32:51 UTC) est principalement mon propre travail à l’exception
    de ce qui est mentionné ci-dessus. Il a aussi été mis à jour par
    les contributeurs.

    Le document « Référence Debian (version 1) » a été traduit par
    Guillaume Erbs (gerbs chez free point fr) et al.

    Le document « Référence Debian (version 2) » a été traduit par
    Jean-Luc Coulon (f5ibh) (jean-luc.coulon chez wanadoo.fr) à
    partir de la version 1, et est maintenu avec l'aide de David
    Prévot (david chez tilapin point org) et la liste de
    contributeurs (debian-l10n-french chez lists point debian point
    org).

    L’auteur, Osamu Aoki, remercie tous ceux qui ont aidé à rendre
    possible ce document.

A.3. Format du document

    La source du document original en anglais est actuellement écrite
    sous forme de fichiers texte AsciiDoc. AsciiDoc n’est utilisé que
    par facilité car il demande moins de frappe que l’XML natif et
    prend en charge les tableaux dans un format très intuitif. Vous
    devez avoir à l’esprit que les fichiers XML et PO sont les vrais
    fichiers sources. Ils sont convertis dans le format XML DocBook
    par le script de construction et les données créées
    automatiquement sont insérées afin de former un source final XML
    Docbook. Ce source final XML Docbook peut être converti en HTML,
    epub, en text brut, en PostScript et en PDF. (Certains formats
    peuvent être omis pour la distribution.)

